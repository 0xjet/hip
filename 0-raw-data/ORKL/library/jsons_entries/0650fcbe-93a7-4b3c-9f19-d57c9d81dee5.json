{
    "id": "0650fcbe-93a7-4b3c-9f19-d57c9d81dee5",
    "created_at": "2023-03-03T02:06:33.162972Z",
    "updated_at": "2025-03-27T02:15:37.925357Z",
    "deleted_at": null,
    "sha1_hash": "47d78e557f31380c7fb6afc516fffc010e337b29",
    "title": "2023-02-12 - TrueBot Analysis Part I - A short glimpse into packed TrueBot samples",
    "authors": "",
    "file_creation_date": "2023-03-01T09:33:04Z",
    "file_modification_date": "2023-03-01T09:33:04Z",
    "file_size": 3447813,
    "plain_text": "# TrueBot Analysis Part I - A short glimpse into packed TrueBot samples\n\n**[malware.love/malware_analysis/reverse_engineering/2023/02/12/analyzing-truebot-packer.html](https://malware.love/malware_analysis/reverse_engineering/2023/02/12/analyzing-truebot-packer.html)**\n\nFebruary 12, 2023\n\n12 Feb 2023 » [malware_analysis,](https://malware.love/category/malware_analysis) [reverse_engineering](https://malware.love/category/reverse_engineering)\nIn October 2022, [Microsoft published a blog post about Raspberry Robin and it’s role in the](https://www.microsoft.com/en-us/security/blog/2022/10/27/raspberry-robin-worm-part-of-larger-ecosystem-facilitating-pre-ransomware-activity/)\ncurrent cyber crime ecosystem. Microsoft reported, among other things, that they have\nobserved Raspberry Robin delivering the well-known malware families IcedID, Bumblebee\nand TrueBot besides the already known delivery of FakeUpdates/SocGholish. At this time I\nwas not really aware of TrueBot or I simply had forgotten about it.\n\n[In December 2022, Cisco Talos published a blog post in which they reported increased](https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/)\nactivity from TrueBot and mentioned that TrueBot might be related to TA505. They have\nobserved TrueBot delivering Grace (aka FlawedGrace and GraceWire) as a follow-up\npayload, which is known to be exclusive tooling of TA505.\n\nSince I have already analyzed some TA505 campaigns a few years ago and anything\nrelated to Raspberry Robin is of interest to me, TrueBot now had my attention and I finally\nfound some time to take a closer look and here we are.\n\nI have decided to start a small blog series that will cover the following points:\n\n1. Analyzing different packed samples and identifying decryption/unpacking code\n2. How to statically unpack with Python using Malduck?\n3. Analyzing TrueBot Capabilities\n4. IOC/Config extraction with Python using Malduck\n5. C2/Bot Emulation\n6. Bonus (maybe): Infrastructure analysis\n\nThe blog series is structured so that we gain the knowledge step by step to be able to take\nthe next step.\n\nIn this first post, we’ll look at some packed samples and gain enough knowledge to write a\nstatic unpacker in the next step.\n\n## Identifying decryption/unpacking code\n\n[We are primarily looking at the packed samples that Talos also mentioned in their blog post](https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/)\nincluding one sample that I have found on VirusTotal. All of these files are 32 Bit samples,\nmostly DLLs except for one sample which is a regular executable.\n\n\n-----\n\n```\n092910024190a2521f21658be849c4ac9ae6fa4d5f2ecd44c9055cc353a26875\n\n1ef8cdbd3773bd82e5be25d4ba61e5e59371c6331726842107c0f1eb7d4d1f49\n\n2d50b03a92445ba53ae147d0b97c494858c86a56fe037c44bc0edabb902420f7\n\n31272235fcdce1d28542c0bc30c069cdb861ff34dd645fe5143ad911fdb1e8a9\n\n55d1480cd023b74f10692c689b56e7fd6cc8139fb6322762181daead55a62b9e\n\n58b671915e239e9682d50a026e46db0d775624a61a56199f7fd576b0cef4564d\n\n6210a9f5a5e1dc27e68ecd61c092d2667609e318a95b5dade3c28f5634a89727\n\n68a86858b4638b43d63e8e2aaec15a9ebd8fc14d460dd74463db42e59c4c6f89\n\n72813522a065e106ac10aa96e835c47aa9f34e981db20fa46a8f36c4543bb85d\n\n7a64bc69b60e3cd3fd00d4424b411394465640f499e56563447fe70579ccdd00\n\n7e39dcd15307e7de862b9b42bf556f2836bf7916faab0604a052c82c19e306ca\n\nbf3c7f0ba324c96c9a9bff6cf21650a4b78edbc0076c68a9a125ebcba0e523c9\n\nc3743a8c944f5c9b17528418bf49b153b978946838f56e5fca0a3f6914bee887\n\nc3b3640ddf53b26f4ebd4eedf929540edb452c413ca54d0d21cc405c7263f490\n\nc6c4f690f0d15b96034b4258bdfaf797432a3ec4f73fbc920384d27903143cb0\n\n```\nIf you look at the binary, you will relatively quickly stumble upon a large binary blob that is\nreferenced in only one function in the binary. The two loops in which the blob is referenced\nshould give you a good indication that something might be decrypted here, see the\nscreenshot below.\n\nI have checked all available samples and the decryption algorithm is identical in each case,\nhowever, there are a few different variations, how the decryption function is called. In the\nmost common variant there is an export, which calls a wrapper function, which in turn calls\nthe decryption function. Sometimes there is only one wrapper function, sometimes several,\nand sometimes the decryption code is directly in the export of the DLL.\n\n\n-----\n\nRegular executable where the call to decryption function is located in WinMain:\n\n\n-----\n\nDecryption code directly in an exported function:\n\n\n-----\n\nThe decryption algorithm uses a hardcoded key and is XOR’ing through the entire binary\nblob, with incrementing the iterator by the length of the key. Additionally, another part of the\ndecryption “formula” is a boolean and operation with a hardcoded value. By using a\ndebugger, it’s pretty easy to get to the unpacked code. However, since we want a have\nstatic unpacker, I reimplemented the function in Python.\n\n\n-----\n\n```\ndef decrypt(data_blob, key, param):\n\n  result = list(data_blob)\n\n  i = 0\n\n  while i < len(key):\n\n    x = i\n\n    key_xor = key[i] ^ param\n\n    while x <= len(result) - 1:\n\n      result[x] = result[x] ^ key_xor ^ ((x & 0xff) & param)\n\n      x += len(key)\n\n    i += 1\n\n  return result\n\n```\nNow, all we need to decrypt is the binary blob, the decryption key and the parameter for the\n```\nand operation. In my next blog post, I will describe how to get these values with help of\n\n```\nPython and Malduck.\n\n**Related Posts**\n\n[TrueBot Analysis Part II - Static unpacker (Categories:](https://malware.love/malware_analysis/reverse_engineering/2023/02/18/analyzing-truebot-static-unpacking.html) [malware_analysis,](https://malware.love/category/malware_analysis.html)\n[reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n[Python stealer distribution via excel maldoc (Categories:](https://malware.love/malware_analysis/reverse_engineering/2021/05/19/unknown-python-stealer.html) [malware_analysis,](https://malware.love/category/malware_analysis.html)\n[reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n[Having fun with an Ursnif VBS dropper (Categories:](https://malware.love/malware_analysis/reverse_engineering/2020/11/27/analyzing-a-vbs-dropper.html) [malware_analysis,](https://malware.love/category/malware_analysis.html)\n[reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n[Trickbot tricks again [UPDATE] (Categories: malware_analysis,](https://malware.love/malware_analysis/reverse_engineering/2020/11/22/trickbot-fake-ips-part2.html) [reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n[Trickbot tricks again (Categories:](https://malware.love/malware_analysis/reverse_engineering/2020/11/17/trickbots-latest-trick.html) [malware_analysis,](https://malware.love/category/malware_analysis.html) [reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-12 - TrueBot Analysis Part I - A short glimpse into packed TrueBot samples.pdf"
    ],
    "report_names": [
        "2023-02-12 - TrueBot Analysis Part I - A short glimpse into packed TrueBot samples.pdf"
    ],
    "threat_actors": [
        {
            "id": "42a6a29d-6b98-4fd6-a742-a45a0306c7b0",
            "created_at": "2022-10-25T15:50:23.710403Z",
            "updated_at": "2025-03-27T02:00:55.531313Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "Whisper Spider"
            ],
            "source_name": "MITRE:Silence",
            "tools": [
                "Winexe",
                "SDelete"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "88e53203-891a-46f8-9ced-81d874a271c4",
            "created_at": "2022-10-25T16:07:24.191982Z",
            "updated_at": "2025-03-27T02:02:10.13692Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "ATK 86",
                "Contract Crew",
                "TAG-CR8",
                "TEMP.TruthTeller",
                "Whisper Spider"
            ],
            "source_name": "ETDA:Silence",
            "tools": [
                "EDA",
                "EmpireDNSAgent",
                "Farse",
                "Ivoke",
                "Kikothac",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Meterpreter",
                "ProxyBot",
                "ReconModule",
                "Silence.Downloader",
                "TiniMet",
                "TinyMet",
                "TrueBot",
                "xfs-disp.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1677809193,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1677663184,
    "ts_modification_date": 1677663184,
    "files": {
        "pdf": "https://archive.orkl.eu/47d78e557f31380c7fb6afc516fffc010e337b29.pdf",
        "text": "https://archive.orkl.eu/47d78e557f31380c7fb6afc516fffc010e337b29.txt",
        "img": "https://archive.orkl.eu/47d78e557f31380c7fb6afc516fffc010e337b29.jpg"
    }
}