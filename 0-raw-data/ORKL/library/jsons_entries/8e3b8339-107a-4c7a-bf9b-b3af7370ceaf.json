{
    "id": "8e3b8339-107a-4c7a-bf9b-b3af7370ceaf",
    "created_at": "2023-01-12T15:03:16.750713Z",
    "updated_at": "2025-03-27T02:06:15.52743Z",
    "deleted_at": null,
    "sha1_hash": "0e2a2eedbfc83e8820db61e4447625df74f044e2",
    "title": "2017-01-18 - Spora - the Shortcut Worm that is also a Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T02:20:48Z",
    "file_modification_date": "2022-05-28T02:20:48Z",
    "file_size": 612184,
    "plain_text": "# Spora - the Shortcut Worm that is also a Ransomware\n\n**gdatasoftware.com/blog/2017/01/29442-spora-worm-and-ransomware**\n\n01/18/2017\n\nG DATA Blog\nSpora spreads via USB drives like Gamarue and Dinihou aka Jenxcus whilst also encrypting files. The sophistication of this threat could easily\nmake it the new Locky. We discuss its infection and encryption procedure and show how it uses statistical values about encrypted files to\ncalculate the ransom amount.\n\n## HTA email Attachment as common infection vector\n\n[Spora's ransom note was first spotted by the ID Ransomware maintainers and announced via Twitter by](https://id-ransomware.malwarehunterteam.com/) [MalwareHunterTeam. Several](https://twitter.com/malwrhunterteam/status/818787821980893184)\nmalware researchers and Twitter users were amazed by the good-looking, professional ransomware website and ransom note. Experience\nshowed that most of these websites are in a bad shape. The first sample was provided by a member of Bleepingcomputer and discussed in\ntheir [Spora support topic.](https://www.bleepingcomputer.com/forums/t/636975/spora-ransomware-support-and-help-topic/?p=4157580)\n\nThis sample is an HTA application with obfuscated VBScript code. According to Bleepingcomputer it arrived in a ZIP archive via email\nattachment. Submissions on VirusTotal show the filename Скан-копия _ 10 января 2017г. Составлено и подписано главным бухгалтером.\nЭкспорт из 1С.a01e743_рdf.hta.\n\nThe HTA file writes a JScript file to %TEMP%\\close.js and executes it. The JScript file in turn is a dropper for a Word document that is written\nto %TEMP%\\doc_6d518e.docx and a PE file that is saved to %TEMP%\\81063163ded.exe. Both files are opened by close.js, the Word\ndocument with a parameter to show and focus the window, and the PE file with a parameter to hide it. As a result the document will be opened\nby the set default application for .docx files, e.g., Word, but an error message is shown because it is corrupt. The PE file 81063163ded.exe has\na seemingly random name, but it is actually hardcoded by the dropper. The PE file is UPX packed and contains the actual payload.\n\nError message, appears after opening the corrupt document\n\n## Worm-like behavior similar to Dinihou and Gamarue\n\nWhile ZCryptor had already been deemed a combination of ransomware and worm due to its usage of autorun.inf, Spora goes some steps\nfurther using the same techniques as Gamarue and Dinihou. The functionality of autorun.inf had been removed in Windows 7 and was patched\non Windows XP and Windows Vista more than seven years ago, thus making it an ineffective technique for worms to spread via removable\ndrives. The trick is: [Gamarue, Dinihou and now also Spora use Windows shortcuts (.LNK files) instead.](https://www.gdatasoftware.com/blog/2015/03/24274-the-andromeda-gamarue-botnet-is-on-the-rise-again)\n\nSpora adds the hidden attribute to files and folders on the desktop, in the root of removable drives and the system drive. These hidden files\nand folders are, with the standard folder options, not visible anymore. Spora then puts Windows shortcuts with the same name and icon as the\nhidden files and folders as a visible replacement. Those .LNK files open the original file to avoid raising any suspicion and simultaneously\nexecute the malware. An example: the folder C:\\Windows will be hidden and a file named C:\\Windows.lnk will be created; it looks exactly like\nthe original folder if the standard folder options on Windows are set.\n\nThe .LNK files use the following command to execute the worm and open the original file. If the original file is a folder it will open Windows\nExplorer to show its contents:\n\n\n-----\n\n/c e p o e e e o g a e & type o %%t p%%\\ o & sta t o g a e %%t p%%\\ o\n\nThe worm copies itself as hidden file alongside the .LNK files, its filename is generated by calculating the CRC32 checksum for the\nVolumeSerialNumber. The result is put into the pattern %08x-%04x-%04x-%02x%02x-%02x%02x%02x%02 (see address 0x405492). This\nmeans, the name for the malware file can be, e.g., a277a133-ecde-c0f5-1591-ab36e22428bb.exe.\n\nThis function calculates the CRC32 based on the VolumeSerialNumber of the disk\n\n.LNK files and a copy of the malware have been created in the root of\n\nthe system drive.\nThe worm deletes the registry value HKCR\\lnkfile\\isShortcut with the effect that the shortcut icons don't show the characteristic bent arrow in\nthe lower left corner, which would be telltale sign to the user that something is wrong.\n\nSimply navigating through the folders on your system and desktop using double-click will execute the worm. Using this strategy, it will not only\nspread to removable drives like USB thumb drives, it will also encrypt newly created files on the system. This renders the system unusable, for\nstoring or working on any pictures or documents, until it is disinfected.\n\n\n-----\n\nFunction that deletes the isShortcut value in the registry\n\n## Encryption\n\nSpora actually does not rename encrypted files and targets a comparably small set of extensions. The encryption procedure is shown in the\ndiagram below.\n\n.backup, .7z, .rar, .zip, .tiff, .jpeg, .jpg, .accdb, .sqlite, .dbf, .1cd, .mdb, .cd, .cdr, .dwg, .psd, .pdf, .odt, .rtf, .docx, .xlsx, .doc, .xls\n\n\n-----\n\nThe Spora\n\nencryption shown in an info graphic\nSpora generates a pair of RSA keys, C1 and C2 (1024 bit). This newly generated public RSA key C2 is used to encrypt the per-file AES keys\nwhich are also generated by Spora. The generated private RSA key C1 on the other hand is stored in the .KEY file. That file is encrypted using\na newly generated AES Key B (256 bit). The attacker's public RSA key A2 is used to encrypt AES key B. The encrypted key B is appended to\nthe .KEY file. The figure below shows the code that writes the .KEY file's content including the encrypted AES key B to disk.\n\nA second important file is the .LST file which contains a list of all encrypted files. Its encryption works analogous to the .KEY file encryption. A\nnew AES key is generated, used to encrypt the .LST contents, encrypted by the public RSA key A2 of the attacker and appended to the .LST\nfile in encrypted form (see screenshot below):\n\nThe encrypted content of the .KEY file and the encrypted AES Key are written to disk\n\n\n-----\n\nAES key F is encrypted by public RSA key A and the .LST file contents are encrypted using AES key F\n\n(256 bit).\nUsing this encryption scheme, Spora does not have to obtain a key from a command and control server and can work offline. The user has to\nupload the .KEY file to the payment site.\n\nThe .KEY file is only decryptable by the ransomware authors. Using their private RSA key A1 they could decrypt the AES Key B that was\nappended to the .KEY file. They could decrypt the remaining .KEY file contents including the user's private RSA key C1 using AES key B.\nThen they may put the private RSA key C1 into a decrypter that they send to the user after they have received the payment. This handling\nensures that the attackers' private RSA key A1 is not exposed and that the decrypter only works for one user.However, this also means that\nthere is only one private RSA key A1 for several infections. If that key is leaked or obtained by law enforcement, it can be used to decrypt all\nfiles that were encrypted by this variant of Spora and as such we can consider it a master key.\n\nThe Spora payment site includes a chat system and provides several decryption packages with varying prices\n\n## Statistics about encrypted files\n\nSpora counts the number of encrypted files for six different extension categories. They are listed in the table below.\n\nPosition/ID Category File Extensions\n\n1 Office Document odt rtf docx xlsx doc xls\n\n\n-----\n\n2 PDF .pdf\n\n3 CorelDraw, AutoCAD, Photoshop .cdr, .dwg, .psd\n\n4 Database .accdb, .sqlite, .dbf, .1cd, .mdb, .cd\n\n5 Image .tiff, .jpeg, .jpg\n\n6 Archive .backup, .7z, .rar, .zip\n\nThe .KEY file saves these statistical values in the form date|user name|locale|cat1|cat2|cat3|cat4|cat5|cat6, e.g.\n13.1.2017|horst|USA|10|2|3|0|103|51\n\nThe same statistics will be used for the naming scheme of the .LST file, the .KEY file and the ransom note. Let's take the following triplet of\n.KEY file, .LST file and ransom note as example.\n\nRU302-15XRK-GXTFO-GZTET-KTXFF-ORTXA-AYYYY.LST\nRU302-15XRK-GXTFO-GZTET-KTXFF-ORTXA-AYYYY.KEY\nRU302-15XRK-GXTFO-GZTET-KTXFF-ORTXA-AYYYY.HTML\n\nThe first two letters of the filename are the locale which is RU in our example. The following five letters are the first characters of the MD5 hash\nfor the contents of the .KEY file, in our example '30215'. The counters start right after the MD5 substring at the 8th letter. They have to be\ndecoded using the substitution table below:\n\n1 2 3 4 5 6 7 8 9 I Padding\n\nZ X R O A H F G E K T Y\n\nThat means the file name RU302-15XRK-GXTFO-GZTET-KTXFF-ORTXA-AYYYY translates to Russia as location, the characters '30215' for\nthe beginning of the MD5 hash, 12971 encrypted office documents, 6370 encrypted PDF, 8 encrypted CorelDraw/AutoCAD/Photoshop files, 9\nencrypted database files, 16632 encrypted images and 144 encrypted archives.\n\nAfter uploading the .KEY file to Spora's payment website, the ransom amount will be calculated depending on the number of encrypted files.\n[The table below shows some examples, sorted by the amount of ransom asked (thanks to xXToffeeXx for providing these):](https://twitter.com/PolarToffee)\n\nOffice Documents PDF CorelDraw/AutoCAD/Photoshop Databases Images Archives Ransom in USD\n\n2284 1550 1211 89 79 up to 110\n\n489 471 4 796 6 79 up to 110\n\n5223 374 206 12 12694 198 90 up to 120\n\n7791 7341 2194 8587 782 128 up to 170\n\n11160 9354 24 69 9774 242 146 up to 190\n\n12851 5188 1851 51 331031 1281 199 up to 250\n\n21173 7087 5 149 7069 730 214 up to 270\n\n25146 25829 29598 5463 105943 5818 280 up to 350\n\n138964 95087 218249 846 277541 22449 280 up to 350\n\n11810 7272 15306 10 27651 1471 280 up to 350\n\n30503 2135 40098 37 25271 1580 280 up to 350\n\n26375 20505 12178 3016 31505 2487 280 up to 350\n\n82319 40707 16931 114 38520 3607 280 up to 360\n\n## Additional behavior\n\nSpora does not bypass User Account Control (UAC). This means, the user will be asked whether the malware is allowed to make changes to\nthe computer in use. Spora deletes shadow volume copies and disables Windows error recovery and startup repair.\n\n\n-----\n\nShadow volume copy deletion\n\n## List of files involved\n\nFilenames Description SHA256 Detected As\n\n\nСкан-копия _ 10\nянваря 2017г.\nСоставлено и\nподписано\nглавным\nбухгалтером.\nЭкспорт из\n1С.a01e743_рdf.hta\n\n\nHTA\ndropper\n\n\nclose.js JScript\ndropper\n\n\n81063163ded.exe,\na277a133-ecdec0f5-1591ab36e22428bb.exe\n\n\nSpora PE\nfile, UPX\npacked\n\n\n3fb2e50764dea9266ca8c20681a0e0bf60feaa34a52699cf2cf0c07d96a22553 Script.TrojanDropper.Spora.A\n\ne2fe74d890ddb516b4f21a6588c6e0bdbf3dd6f8c5116d707d08db7ebddf505a Script.TrojanDropper.Spora.G\n\ndbfd24cd70f02ddea6de0a851c1ef0f45f18b4f70e6f3d0f2e2aec0d1b4a2cbf Win32.Worm.Spora.B\n\n0ba39054a70802d0b59a18b873aab519e418dc9b0c81400d27614c9c085409ad \n\ndoc_6d518e.docx Corrupt\nWord\ndocument\n\nWindows.lnk Malicious\nshortcut\n\n\nWin32.Worm.SporaLnk.A\n\n\nRU302-15XRKGXTFO-GZTETKTXFF-ORTXAAYYYY.HTML\n\nRU302-15XRKGXTFO-GZTETKTXFF-ORTXAAYYYY.KEY\n\n\nRansom\nnote\n\n\nContains\nstatistics,\ncampaignID,\nusername,\nlocale,\ntimestamp\nand private\nRSA key\nC1;\nencrypted\n\n\n\n\n\n\nRU302-15XRKGXTFO-GZTETKTXFF-ORTXAAYYYY.LST\n\n\nList of\nencrypted\nfiles;\nencrypted\n\n\n\n\n[Malware](https://www.gdatasoftware.com/blog/malware)\n[Mails](https://www.gdatasoftware.com/blog/mails)\n[Microsoft Windows](https://www.gdatasoftware.com/blog/microsoft-windows)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-01-18 - Spora - the Shortcut Worm that is also a Ransomware.pdf"
    ],
    "report_names": [
        "2017-01-18 - Spora - the Shortcut Worm that is also a Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535796,
    "ts_updated_at": 1743041175,
    "ts_creation_date": 1653704448,
    "ts_modification_date": 1653704448,
    "files": {
        "pdf": "https://archive.orkl.eu/0e2a2eedbfc83e8820db61e4447625df74f044e2.pdf",
        "text": "https://archive.orkl.eu/0e2a2eedbfc83e8820db61e4447625df74f044e2.txt",
        "img": "https://archive.orkl.eu/0e2a2eedbfc83e8820db61e4447625df74f044e2.jpg"
    }
}