{
    "id": "0c899d9e-0521-47b0-9ace-9069c20f1a2f",
    "created_at": "2023-01-12T15:04:57.772652Z",
    "updated_at": "2025-03-27T02:06:01.472857Z",
    "deleted_at": null,
    "sha1_hash": "83418978ba62c2bcdaa9427e80ca55b0e65985fd",
    "title": "2018-04-16 - Malware Analysis- New Trojan Double Dropper",
    "authors": "",
    "file_creation_date": "2022-05-28T23:35:42Z",
    "file_modification_date": "2022-05-28T23:35:42Z",
    "file_size": 1638022,
    "plain_text": "# Malware Analysis: New Trojan Double Dropper\n\n**[engineering.salesforce.com/malware-analysis-new-trojan-double-dropper-5ed0a943adb](https://engineering.salesforce.com/malware-analysis-new-trojan-double-dropper-5ed0a943adb)**\n\nVishal Thakur July 13, 2021\n\n[Vishal Thakur](https://malienist.medium.com/?source=post_page-----5ed0a943adb--------------------------------)\n[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbacf5a190f41&operation=register&redirect=https%3A%2F%2Fengineering.salesforce.com%2Fmalware-analysis-new-trojan-double-dropper-5ed0a943adb&user=Vishal+Thakur&userId=bacf5a190f41&source=post_page-bacf5a190f41----5ed0a943adb---------------------follow_byline-----------)\nApr 16, 2018\n\n\n5 min read\n\nIn this article, we will analyze a new trojan dropper — so new it has yet to be named. It is a\nnewly observed VBS malware that uses multiple layers of code obfuscation and very wellstructured code to drop and execute two embedded RATs.\n\n[For now, I’m calling it “Schneiken:” https://github.com/vithakur/schneiken](https://github.com/vithakur/schneiken)\n\nThere are three main layers of encoding. All encoding is in Base64. This particular malware\nworks by dropping two RATs on the disk. The first one is Dunihi RAT and the second one is\nRatty JRAT.\n\nSome malware only using half the code of this malware, have also been discovered in the\nwild. Here’s an example, wrongly being detected as Valyria by some AVs\n(1213003eb7cb1e26a97dc310f47892fc). This malware is only dropping the Dunihi RAT, not\nthe Ratty JRAT.\n\nLet’s begin analyzing this malware by looking at the flow of the campaign.\n\n**Campaign Flow:**\n\nPhish > HREF > PDF > HREF > ZIP > VBS > Dunihi + JRAT > C2\n\n**Code Structure:**\n\nStage1 > stage2\n\nStage2 > vCNkCxcKEd.vbs > Dunihi RAT AND Stage3\n\nStage3 > Ratty (JRAT) + Watcher.vbs + Master.vbs\n\n_“\\RATTY.jar” — JRAT_\n\n\n-----\n\n_\\rXvOlRHjpw.vbs — Watcher_\n\n_“\\UhVHQvjFGb.vbs” — Master_\n\n## Analysis\n\nLet’s take a look at the execution, step by step.\n\n## Stage 1\n\nAt this stage, the code structure is quite simple. All of the stage 2 code is base64 encoded\nand simple replace statement fixes minor obfuscations that are there in the code to add\nanother layer of obfuscation to the already encoded code.\n\nTake a look at the “zzzzzzzzzz” function. It uses the ADODB stream object to process the\nstring as binary data. This means that the decoded code can be executed after it has been\nsuccessfully decoded.\n\nLet’s take a look at this code block and layout the purpose of important lines:\n\n\n-----\n\nThis function is then called on by the Private Function “decode64”, which in turn uses the\nMicrosoft XMLDOM object to further process the data.\n\nThe last item to be called id the Private Sub, where all the decoding takes place.\n\nAs we can see in the block below, the encoded data streches into almost a thousand lines.\n\nNow let’s take a look at the flow of the code in this stage:\n\n\n-----\n\nAnd finally, let’s take a look at the encoded string itself:\n\nOnce decoded, the malware moves into the next stage.\n\n## Stage 2\n\n\n-----\n\nIn this stage, two important things take place. First, a new file is created. This file, as we can\nsee in the code block below, is named “vCNkCxcKEd.vbs”. This file will decode into the\nwatcher code that makes sure that the code is running at all times.\n\nThe second thing that happens at this stage is the creation of stage 3 code:\n\nThe first part of stage 2 execution should give us another VBS script by the name of\nvCNkCxcKEd.VBS. This script, on execution, should give us the decoded, ready-to-go\nversion of the Dunihi RAT.\n\n\n-----\n\nThis what the Dunihi RAT should look like after the encoded string shown above in stage 2 is\ndecoded:\n\n## Stage 3\n\nThis is the final stage of the main malware execution. This stage will get us all the files that\nare needed for the successful execution of the malware.\n\nStage 3 results in creation of three files:\n\n\n-----\n\n\\RATTY.jar —\n“\\rXvOlRHjpw.vbs” —\n“\\UhVHQvjFGb.vbs” —\n\nThe first file to be executed is the Watcher. Watcher then runs the other two:\n\nWatcher makes sure the RAT and the master file are running. If they are not found to be\nrunning, it executes them. Let’s have a look at the code block:\n\n\n-----\n\nThe master makes sure the watcher is running. If it is not running, it executes it.\n\nIt also adds the required entries to the registry\n\nAt this point in the execution flow, all the files have been successfully deployed and\nexecuted. The RAT will now establish connection back to the C2 and start executing the\ncommands it has been programmed to run.\n\n## Conclusion\n\n\n-----\n\nThis malware is new at the time of this writing. The infection vector is phishing emails but it\ncomes fully packed and loaded to drop a complete JRAT on the victim’s computer and have\nit up and running within seconds of execution.\n\nAt this time the embedded RATs are Ratty JRAT and Dunihi RAT, but for the purpose of this\npost, we will not be analyzing those. I will include the details at the end of the post though.\n\nAll the de-obfuscated and decoded files can be found at one of my git repos:\n[https://github.com/vithakur/schneiken.](https://github.com/vithakur/schneiken)\n\n**Schneiken Dropper:**\n\nFileName: TT COPY.vbs\n\nMD5: 47f21544a7479cae3e20488731ba6aa6\n\n**JRAT:**\n\nFileName: RATTY.jar\n\nMD5: 9b93c76d2dacf7adaacfc1e99dae8089\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-04-16 - Malware Analysis- New Trojan Double Dropper.pdf"
    ],
    "report_names": [
        "2018-04-16 - Malware Analysis- New Trojan Double Dropper.pdf"
    ],
    "threat_actors": [
        {
            "id": "ee3363a4-e807-4f95-97d8-b603c31b9de1",
            "created_at": "2023-01-06T13:46:38.485884Z",
            "updated_at": "2025-03-27T02:00:02.845851Z",
            "deleted_at": null,
            "main_name": "FIN6",
            "aliases": [
                "Camouflage Tempest",
                "MageCart Group 6",
                "G0037",
                "TA4557",
                "SKELETON SPIDER",
                "ITG08",
                "White Giant",
                "GOLD FRANKLIN",
                "ATK88"
            ],
            "source_name": "MISPGALAXY:FIN6",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "12517c87-040a-4627-a3df-86ca95e5c13f",
            "created_at": "2022-10-25T16:07:23.61665Z",
            "updated_at": "2025-03-27T02:02:09.889471Z",
            "deleted_at": null,
            "main_name": "FIN6",
            "aliases": [
                "ATK 88",
                "Camouflage Tempest",
                "FIN6",
                "Gold Franklin",
                "ITG08",
                "Skeleton Spider",
                "TAAL",
                "TAG-CR2",
                "White Giant"
            ],
            "source_name": "ETDA:FIN6",
            "tools": [
                "AbaddonPOS",
                "Agentemis",
                "AmmyyRAT",
                "Anchor_DNS",
                "BlackPOS",
                "CmdSQL",
                "Cobalt Strike",
                "CobaltStrike",
                "FlawedAmmyy",
                "FrameworkPOS",
                "Grateful POS",
                "JSPSPY",
                "Kaptoxa",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LockerGoga",
                "MMon",
                "Magecart",
                "Meterpreter",
                "Mimikatz",
                "More_eggs",
                "NeverQuest",
                "POSWDS",
                "Reedum",
                "Ryuk",
                "SCRAPMINT",
                "SONE",
                "SpicyOmelette",
                "StealerOne",
                "Taurus Loader Stealer Module",
                "Terra Loader",
                "TerraStealer",
                "Vawtrak",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "cobeacon",
                "grabnew"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ea7bfe06-7c23-481d-b8ba-eafa6cda3bc9",
            "created_at": "2022-10-25T15:50:23.317961Z",
            "updated_at": "2025-03-27T02:00:55.440858Z",
            "deleted_at": null,
            "main_name": "FIN6",
            "aliases": [
                "FIN6",
                "Magecart Group 6",
                "ITG08",
                "Skeleton Spider",
                "TAAL",
                "Camouflage Tempest"
            ],
            "source_name": "MITRE:FIN6",
            "tools": [
                "FlawedAmmyy",
                "GrimAgent",
                "FrameworkPOS",
                "More_eggs",
                "Cobalt Strike",
                "Windows Credential Editor",
                "AdFind",
                "PsExec",
                "LockerGoga",
                "Ryuk",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535897,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653780942,
    "ts_modification_date": 1653780942,
    "files": {
        "pdf": "https://archive.orkl.eu/83418978ba62c2bcdaa9427e80ca55b0e65985fd.pdf",
        "text": "https://archive.orkl.eu/83418978ba62c2bcdaa9427e80ca55b0e65985fd.txt",
        "img": "https://archive.orkl.eu/83418978ba62c2bcdaa9427e80ca55b0e65985fd.jpg"
    }
}