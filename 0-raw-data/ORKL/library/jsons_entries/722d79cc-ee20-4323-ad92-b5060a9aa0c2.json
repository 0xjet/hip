{
    "id": "722d79cc-ee20-4323-ad92-b5060a9aa0c2",
    "created_at": "2023-01-12T15:05:57.356036Z",
    "updated_at": "2025-03-27T02:15:37.912388Z",
    "deleted_at": null,
    "sha1_hash": "33710389fc2662322b106426f5e693abc20be0b2",
    "title": "2020-05-22 - Operation TA505- investigating the ServHelper backdoor with NetSupport RAT. Part 2.",
    "authors": "",
    "file_creation_date": "2022-05-28T03:15:35Z",
    "file_modification_date": "2022-05-28T03:15:35Z",
    "file_size": 1704170,
    "plain_text": "# Operation TA505: investigating the ServHelper backdoor with NetSupport RAT. Part 2.\n\n**[ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/operation-ta505-part2/](https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/operation-ta505-part2/)**\n\nPositive Technologies\n\nPublished on 22 May 2020\n\n\n-----\n\nAt the end of July 2019, we encountered an interesting piece of malware distributed by the\n[TA505 group, and on July 22, 2019 uploaded it into ANY.RUN to put it through a dynamic](https://app.any.run/tasks/0682cb1b-eef1-4242-8ef2-2b6c206dd18a/)\nanalysis. Viewing the results, two anomalies attracted our attention—in addition to the tags\nusually displayed for TA505 ServHelper, the \"netsupport\" tag also appeared; additionally, the\nNetSupport RAT was listed among network signature events.\n\nMalware download date and\n\ntags displayed in the ANY.RUN online analyzer\n\nNetSupport RAT network signature event in the ANY.RUN sandbox\nThis might seem strange at first glance, since the ServHelper backdoor already provides\nattackers with a significant amount of control over their victims' computers. To get a better\nunderstanding of what's going on, let's take a closer look at how the malware functions.\n\n## NSIS and PowerShell droppers\n\n\n-----\n\nThe executable PE file that begins our analysis is an installer on the Nullsoft Scriptable\nInstall System (NSIS) platform. This NSIS script, which is responsible for installation, extracts\nand runs a nested PowerShell script:\n\nNSIS script instructions\nThe PowerShell script that is run contains a Base64-encoded buffer (truncated in the image\nbelow for clarity), which, after decoding, is decrypted by the Triple DES (3DES) algorithm in\nCBC mode:\n\nData decryption in the PowerShell script\nThe first segment of the script defines a function called heller, which raises system privileges\nand allows UAC defenses to be bypassed. Two techniques are implemented to this end:\n\nTechnique 1 — using the SilentCleanup task in the Task Scheduler:\n\nSilentCleanup can be launched by the user, in which case it runs with elevated\nprivileges. The path to the executable file is specified in its properties using the\n%windir% environment variable, the value of which can be reset—to trigger the launch\nof a PowerShell script, for instance. In this case, running the task will cause the\nPowerShell script to launch with admin privileges, bypassing the UAC.\nThis technique is used by hackers to target Windows 8 and Windows 10 systems.\n[The code behind this technique is identical to the module implementation for the](https://vulners.com/zdt/1337DAY-ID-32920)\nMetasploit framework.\n\n\n-----\n\nScript containing the SilentCleanup workaround\nTechnique 2 — using the sysprep.exe system utility and DLL side-loading:\n\nFirst, a helper script is created to relaunch the PowerShell script in the directory\nC:\\Windows\\Temp. Then a CAB archive is created containing an auxiliary DLL,\nCRYPTBASE.dll (the PowerShell script contains both x86 and x64 versions of the\nlibrary). This archive is then unpacked into the folder C:\\Windows\\System32\\Sysprep\nusing the wusa.exe system utility. Next, the sysprep.exe system utility launches,\nloading the DLL which was previously unpacked, and the DLL proceeds to execute a\nhelper script. The outcome is that the PowerShell script will be relaunched with\nadministrator privileges, bypassing the UAC.\nHackers use this technique to target Windows 7 systems.\n\n[• You can read a detailed description of this technique here, and find samples of its](http://www.labofapenetrationtester.com/2015/09/bypassing-uac-with-powershell.html)\n[implementation in this project on Github.](https://github.com/samratashok/nishang/blob/master/Escalation/Invoke-PsUACme.ps1)\n\nScript\n\ncontaining the sysprep.exe utility workaround\nThe script contains a large number of comments, an unused Test-Administrator function, and\nuninitialized variables. This indicates that the code was copied directly without concern for\nconciseness.\n\nOnce the script has been run with the necessary privileges, the second segment is executed.\nAt this stage, the target payloads are decoded:\n\nThe string is decoded from Base64.\nThe data is decompressed using Deflate.\nThe string is re-decoded from Base64.\n\n\n-----\n\nAlgorithm for decoding the payload\nAs a result, the following files will be created in the system:\n\n%systemroot%\\help\\hlp11.dat — a x86/x64 version of the RDP Wrapper Library. This is\nused to expand the functionality of the RDP service, including the allowance of multiple\nsimultaneous connections. It is important to note that the library is modified: after being\nlaunched, linear XOR quickly decodes the string c:\\windows\\help\\hlp12.dat, then\ndownloads the DLL via the resulting path:\n\nDecryption of the DLL path and\n\nDLL download\n\n%systemroot%\\help\\hlp12.dat—a x86/x64 version of the ServHelper backdoor.\nDiscussed in the next section.\n%systemroot%\\help\\hlp13.dat—a configuration file for the RDP Wrapper Library.\n%systemroot%\\system32\\rdpclip.exe—an RDP component allowing the exchange of\nclipboard data.\n%systemroot%\\system32\\rfxvmt.dll—an RDP component for data transfer using\n[RemoteFX.](https://en.wikipedia.org/wiki/RemoteFX)\n\nOnce the payload bas been extracted and written, the script configures its components:\n\nThe owner of the rfxvmt.dll component is changed to NT SERVICE\\TrustedInstaller and\nthe new owner is granted permissions.\nThe port value for RDP connections is changed from 3389 (the standard value) down\nto 720.\nA network services account is added as a local administrator.\nhlp11.dat is registered as an RDP service and the RDP is rebooted.\n\n\n-----\n\nAll temporary files that were created are deleted.\n\n## ServHelper RAT → Dropper\n\nOne result of the droppers is a DLL called hlp12.dat, which is a malware ServHelper. Both\nx86 and x64 versions can be created, depending on the OS bit depth (there are no\nfundamental differences between the two). Both are written in Delphi; one is packaged in\nUPX 3.95 (x64) and the other in PeCompact 2.20 (x86). The distribution and operation of this\n[backdoor have already been analyzed by researchers at Proofpoint and](https://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505) [Trend Micro. Our](https://blog.trendmicro.com/trendlabs-security-intelligence/ta505-at-it-again-variety-is-the-spice-of-servhelper-and-flawedammyy/)\nparticular case does not differ significantly in its capabilities from previously investigated\ninstances. In particular, it is worth noting that the algorithm for decrypting the strings has not\n[changed (a Vigenère cipher is used):](https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher)\n\nPseudocode for string decoding using a Vigenère cipher\nInterestingly, not all strings are encrypted. For instance, domains and web links are left in\ntheir unencrypted format:\n\n\n-----\n\nUnencrypted domains and web links\nFollowing one of these links (hxxp://letitbe.icu/2.txt) triggers the download of an encrypted file\n(MD5: 0528104f496dd13438dd764e747d0778). It is worth nothing that the byte value 0x09 is\nrepeated frequently at the end of this file:\n\nRepetitions of the byte 0x09 in the downloaded file\nDuplicate bytes are frequently a sign of encryption using a single-byte XOR. In this case, the\ncode confirms this hypothesis:\n\n\n-----\n\nFunction for single-byte XOR\n\nencryption A single-byte value is\n\npassed to the XOR function as an argument\nAfter decryption we get a ZIP archive with the following contents:\n\n\n-----\n\nContents of the\n\ndecrypted ZIP archive\n[All these files are legitimate software for PC remote control using NetSupport Manager — a](https://www.netsupportmanager.com/)\nproduct which has been repeatedly exploited by hackers.\n\nNetSupport Manager description\n\n\n-----\n\nOne of the files (client32.ini) is a configuration file specifying the address of the intermediary\ngateway through which the victim's PC connects with attackers:\n\nThe\n\nattacker's address in the form of a NetSupport Manager gateway\nThis option makes sense if the victim is behind a firewall and their internet access is\nrestricted by ports. At least two ports—80 (HTTP) and 443 (HTTPS)—must be accessible for\nthe internet to work properly. Thus, this technique increases the chance of a successful\nconnection.\n\nIn September 2019 we found several more, similar instances of ServHelper, albeit with\nsignificantly limited capabilities. For instance, take this case (MD5:\n5b79a0c06aec6126364ce1d5cbfedf66), in which a similar pattern of repeating bytes was\nfound among the encrypted data of an executable PE file:\n\n\n-----\n\nEncrypted data from ServHelper\nOnce again, we have a ZIP archive that has been XOR-encrypted using a single byte. It\ncontains the same NetSupport Manager components as in our previous example, albeit with\na different intermediary gateway: 179[.]43.146.90:443.\n\n## Conclusions\n\nThis article has examined how the TA505 group utilizes ServHelper to distribute and\nimplement backdoor malware. The main component of the malware is proceeded by\ninteresting features—UAC is bypassed and privileges are raised. However, even more\ninterestingly, the malware's main backdoor contains compelling variations. Its basic\nfunctionality (data theft, spying, and execution of commands) is supplemented with another\ntool that is embedded for remote management of the victim's PC—namely, NetSupport RAT.\nWhat is more, newer versions of ServHelper no longer contain all the key features of a fullfledged backdoor. Rather, they serve the restricted roll of an intermediary dropper with the\nsole aim of installing NetSupport RAT. It is likely that the attackers find this approach more\nefficient to develop and more difficult to detect. This is not the last of the group's tools and\ntechniques to provide fodder for our investigation. The next installment will be forthcoming.\n\n**Author: Alexey Vishnyakov, Positive Technologies**\n\n## IOCs\n\n\n-----\n\nhxxp://185.225.17.175/wrkn157.exe — link with which NSIS dropper was downloaded\nd2a062ca772fa3ace7c7edadbd95eaf7 — NSIS dropper\n0cacea3329f35e88a4f9619190e3746f — PowerShell dropper shipkat.ps1\nfb609b00e29689db74c853ca7d69f440 — CRYPTBASE.dll (x86)\n843288a35906aa90b2d1cc6179588a26 — CRYPTBASE.dll (x64)\n445cd6df302610bb640baf2d06438704 — hlp11.dat (x86)\n083f66cc0e0f626bbcc36c7f143561bd — hlp11.dat (x64)\n40bae264ea08b0fa115829c5d74bf3c1 — hlp12.dat (x86)\nac72ab230608f2dca1da1140e70c92ad — hlp12.dat (x64)\n07f1dc2a9af208e88cb8d5140b54e35e — hlp13.dat\n1690e3004f712c75a2c9ff6bcde49461 — rdpclip.exe\ndc39d23e4c0e681fad7a3e1342a2843c — rfxvmt.dll\nServHelper C2:\n179[.]43.156.32\n185[.]163.45.124\n185[.]163.45.175\n185[.]225.17.150\n185[.]225.17.169\n185[.]225.17.175\n185[.]225.17.98\n195[.]123.221.66\n195[.]123.246.192\n37[.]252.8.63\n94[.]158.245.123\n94[.]158.245.154\n94[.]158.245.232\nfdguyt5ggs[.]pw\nfoxlnklnk[.]xyz\ngidjshrvz[.]xyz\nletitbe[.]icu\npofasfafha[.]xyz\n0528104f496dd13438dd764e747d0778 — encrypted ZIP archive with NetSupport RAT\nNetSupport Manager components:\n953896600dfb86750506706f1599d415 — cksini.exe\n8d9709ff7d9c83bd376e01912c734f0a — client32.exe\n2d3b207c8a48148296156e5725426c7f — HTCTL32.DLL\n0e37fbfa79d349d672456923ec5fbbe3 — msvcr100.dll\n26e28c01461f7e65c402bdf09923d435 — nskbfltr.inf\n88b1dab8f4fd1ae879685995c90bd902 — NSM.ini\n7067af414215ee4c50bfcd3ea43c84f0 — NSM.LIC\ndcde2248d19c778a41aa165866dd52d0 — pcicapi.dll\na0b9388c5f18e27266a31f8c5765b263 — PCICHEK.DLL\n\n\n-----\n\n00587238d16012152c2e951a087f2cc9 — PCICL32.DLL\n2a77875b08d4d2bb7b654db33a88f16c — remcmdstub.exe\neab603d12705752e3d268d86dff74ed4 — TCCTL32.DLL\n185[.]225.17.66:443 — NetSupport RAT GatewayAddress\n5b79a0c06aec6126364ce1d5cbfedf66 — ServHelper with NetSupport RAT archive\n179[.]43.146.90:443 — NetSupport RAT GatewayAddress\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-22 - Operation TA505- investigating the ServHelper backdoor with NetSupport RAT. Part 2..pdf"
    ],
    "report_names": [
        "2020-05-22 - Operation TA505- investigating the ServHelper backdoor with NetSupport RAT. Part 2..pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535957,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1653707735,
    "ts_modification_date": 1653707735,
    "files": {
        "pdf": "https://archive.orkl.eu/33710389fc2662322b106426f5e693abc20be0b2.pdf",
        "text": "https://archive.orkl.eu/33710389fc2662322b106426f5e693abc20be0b2.txt",
        "img": "https://archive.orkl.eu/33710389fc2662322b106426f5e693abc20be0b2.jpg"
    }
}