{
    "id": "b8e1f7ad-81a6-4547-a05b-d5329509987e",
    "created_at": "2023-01-12T15:04:30.893547Z",
    "updated_at": "2025-03-27T02:06:02.419261Z",
    "deleted_at": null,
    "sha1_hash": "fd11ec78bf124ebdcff3a86c389b473f3bfb87ba",
    "title": "2020-08-05 - Part 2- Analysing MedusaLocker ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T04:10:34Z",
    "file_modification_date": "2022-05-28T04:10:34Z",
    "file_size": 645795,
    "plain_text": "# Part 2: Analysing MedusaLocker ransomware\n\n**[theta.co.nz/news-blogs/cyber-security-blog/part-2-analysing-medusalocker-ransomware/](https://www.theta.co.nz/news-blogs/cyber-security-blog/part-2-analysing-medusalocker-ransomware/)**\n\n05/08/2020\n\n(Part 2 of 3) In this 3-part post, we share the tradecraft from an RDP brute force linked\nransomware event (MedusaLocker) we responded to in June 2020. We cover the business\nramifications of the attack, technical analysis and some advice based on attacks such as\nthese.\n\n_[Continued from part 1...](https://www.theta.co.nz/news-blogs/cyber-security-blog/part-1-analysing-medusalocker-ransomware/)_\n\n**Persistence**\n\nNo specific persistence events were observed; it assessed that these intruders likely rely on\ntempo of operations and low-security posture of the victim to complete their objectives before\nbeing evicted.\n\nInterestingly the earliest reference to the SVHOST task that executed the ransomware was\nat 16/06/2020 4:58:11 pm; even though most of the adversary activity was conducted later at\n17/06/2020 3:00 to 4:00 am. This potentially represented a minimum viable (aka local)\n\n\n-----\n\nransomware deployment in case the actors were detected and lost access to the host. Given\nthe ~10hr time offset this may also represent a geographically distributed set of intrusion\noperators involved.\n\n**Privilege Escalation**\n\nThe admin account compromised already had Domain Administer rights (T1110), so no\nprivilege escalation was strictly necessary. Nonetheless, Theta observed the\nDomain\\Administrator (S-1-5-21domain-500) account utilised by the intruder for lateral\nmovement and reconnaissance. However, the exact mechanism these credentials were\nobtained with was not observed (other reporting suggests mimikatz staged in the\n`kamikadze` folder). Theta also observed the use of NT\\SYSTEM (with\nC:\\Windows\\syswow64\\config\\systemprofile storing some useful artefacts).\n\n**Defense Evasion**\n\nEvent logs and registry hives show artefacts related to the removal of ESET, the installed AV\nproduct on the server (T1089) before starting the encryption, some duplication of which may\nrepresent automated removal rather than by hand.\n\nThe previously mentioned arch.z$ sequence of files in the certutil log represents evidence of\nobfuscation of files or information (T1027), which is another technique to avoid detection.\n\n**Credential Access**\n\nGiven the limited telemetry available, no evidence of Credential Access TTPs was observed\n(such as accessing system hives, the ntdis.dit file, or the ever-ubiquitous and suspected\nmimikatz).\nWhile this was not necessary for the actors to carry out their objectives as referenced in the\n**_Privilege Escalation section, ultimately other accounts were obtained; however their_**\nmechanism for access remains unknown.\n\nRecovered registry hives show the\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest key was set to 1;\nalthough given the age of the machine in question it was possible that the legitimate system\nadministers never applied the fix to disable this. During the period the intruders were on the\nsystem there appeared to be a legitimate login from the Domain\\Administrator account (S-15-21domain-500), which would have given an additional opportunity for the intruders to hijack\nthese credentials, although this remains an open question.\n\n**Discovery**\n\nSeveral network discovery tools were used by the actor (T1018). Famatech’s Advanced Port\n_Scanner was deployed to the host, with evidence suggesting interaction and use. The_\naforementioned PSnmap.psd1 PowerShell datafile (likely an implementation of the well\n\n-----\n\nknown nmap) is another network discovery/reconnaissance tool, and 2sys.ps1 script (if the\nsame as referenced by Carbon Black) contains RDP scanning functionality.\n\nThe deployed binary NetworkShare_pre2.exe detected variously as NetTool has a diverse\nset of capabilities focused around network discovery. This was not removed from the staging\ndirectory unlike most of the other tooling across this intrusion.\n\nWinPCAP 4.1.3 (rpcapd.exe) was also installed as a service onto the host by the actor, but\nits exact purpose cannot be inferred as it may be a dependency of other tooling used.\n\n**Lateral Movement**\n\nThere is evidence from Security Event Logs of the Domain\\Administrator account logging\n[onto other hosts in the environment (via Event ID 4648). The connect-mstsc (Connect-](https://gallery.technet.microsoft.com/scriptcenter/Connect-Mstsc-Open-RDP-2064b10b)\n_Mstsc.ps1) likely provides RDP functionality in PowerShell._\n\nAll the other impacted hosts in the environment would not boot, so minimal forensic analysis\nwas conducted into them as to the actions on them before encrypting. Other reporting details\nMedusa Locker spreading via PSexec and SMB - although with Domain Admin access a raft\nof lateral movement techniques is available.\n\nUltimately, the actors were able to spread their payload to effectively every host in the\ndomain (bar a few off-site laptops).\n\n**Collection**\n\nThere was no firm evidence of collection observed by the actor. Circumstantial evidence\nshows interaction with a SQL database present on the system.\n\n**Command and Control**\n\nAs mentioned; the intruders logged in via RDP (External Remote Services - T1133)\nfrom 185.202.1[.]19, **213.7.208[.]69** **&** **5.2.224[.]56.**\nAdditional information, such as keyboard language or screen size was not available.\n\n**Exfiltration**\n\nThe ransom note referenced potential data exfiltration and release, however no direct\nevidence of this was found and no effort was made to reach out and engage with the actor.\nOf the limited telemetry observed, there was a spike of 200Gb+ uploaded which did not\nmatch the pattern of life around the incident. If it was carried out, it may have been via\nRDPclip (Exfiltration Over Command and Control Channel - T1041) which would have left\nlittle evidence.\n\n\n-----\n\nThe actor has not followed up by engaging with the client. Access to this environment with\nDomain Admin would have given them enough access to harvest emails, and contact details\nfor the business had they wished.\n\n**Impact**\nGiven the nature of this intrusion, Data Encrypted For Impact (T1486) was the end goal. This\nwas incredibly successful in this environment (see: Headline Stats).\n\nThe actor created a hidden scheduled task “svhost” (similarly named to the legitimate\nsvchost process used by windows) and stored the binary in the %AppData%\\Roaming\\ folder\nfor the compromised admin user. The binary itself was also named svhost.exe. The binaries\ncontain a unique key per-campaign, so to preserve the confidentially of the client, this file\nwon’t be made available in full.\n\nEvent logs show its execution every 15 minutes (this behaviour is consistent with other\nreported activity on Medusa Locker) as well as failure notices later on.\n\nThere remains some ambiguity around the exact timing of their operations. There’s evidence\nof the scheduled task running while the operators were still engaged on the host –\nunfortunately prefetch data was not available for analysis. Given the cryptographic overhead\ninvolved in sequentially encrypting each file on the file system, they may have been confident\nin the knowledge that the system would take some time to become fully degraded. Especially\nif the non-system drives were targeted first. There is some evidence (via event logs and\n[shellbags) of graphical interaction with the Windows task scheduler to manipulate the](https://lifars.com/wp-content/uploads/2020/04/LIFARS-WhitePaper-Windows-ShellBags-Forensics-Investigative-Value-of-Windows-ShellBags.pdf)\nscheduled task after it’s deployment – in what looks troubleshooting efforts.\nIt remains unclear if the operators intended to prevent the other hosts on the network from\nbooting at all via encrypting the master boot record or if this was unintended - however, the\nresult was that some of the machines were rendered inoperable - T1487 (Disk Structure\nWipe).\n\nA simple script named _backup.bat was used to delete Volume Shadow Copies – evidence\nof Inhibiting System Recovery (T1490) and this was executed on the system before\nencryption:\n\nOther examples of MedusaLocker have shown vssadmin.exe to be spawned to further\ncomplicate recovery attempts (T1490):\n\n\n-----\n\nThe ransom demand pointed to a TOR address with a unique string for this campaign. While\nwe did not interact with the attackers, others had, which in turn revealed a modestly\nsuccessful return, at least for this campaign and further indirect evidence of this adversary\nsuccessfully monetising their operation through Data Encrypted For Impact (T1486).\n\n[Read part 3](https://www.theta.co.nz/news-blogs/cyber-security-blog/part-3-analysing-medusalocker-ransomware/)\n\n**Lead author: Hamish Krebs, Lead Consultant**\n\nHamish has spent time across Australia and New Zealand responding to advanced threat\nactors; running large DFIR engagements in complex environments. He’s also designed and\ndeployed a variety of security solutions such as SIEMs and EDR suites across APAC.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-05 - Part 2- Analysing MedusaLocker ransomware.pdf"
    ],
    "report_names": [
        "2020-08-05 - Part 2- Analysing MedusaLocker ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535870,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1653711034,
    "ts_modification_date": 1653711034,
    "files": {
        "pdf": "https://archive.orkl.eu/fd11ec78bf124ebdcff3a86c389b473f3bfb87ba.pdf",
        "text": "https://archive.orkl.eu/fd11ec78bf124ebdcff3a86c389b473f3bfb87ba.txt",
        "img": "https://archive.orkl.eu/fd11ec78bf124ebdcff3a86c389b473f3bfb87ba.jpg"
    }
}