{
    "id": "3ce3cef1-7f16-411b-a2cb-1bf0d7fb0b07",
    "created_at": "2023-01-12T15:03:34.62683Z",
    "updated_at": "2025-03-27T02:06:13.968479Z",
    "deleted_at": null,
    "sha1_hash": "5258dd88e8fc9201d429f54600907fd76830907f",
    "title": "2019-05-02 - FormBook - Hiding in plain sight",
    "authors": "",
    "file_creation_date": "2022-05-27T21:07:10Z",
    "file_modification_date": "2022-05-27T21:07:10Z",
    "file_size": 106344,
    "plain_text": "# FormBook - Hiding in plain sight\n\n**usualsuspect.re/article/formbook-hiding-in-plain-sight**\n\n[Articles](https://usualsuspect.re/archives)\n[About](https://www.usualsuspect.re/page/about)\n[Legal Notice](https://www.usualsuspect.re/page/legal-notice)\n\n[<< back to Articles](https://usualsuspect.re/archives)\npublished 2019-05-02\n\n## Intro\n\nToday I came across the FormBook malware and had a quick look. As is tradition for\nmalware, it uses encrypted strings to make it harder to detect. The way FormBook stores its\nencrypted strings however is new to me.\n\nFormBook itself is not new and the decryption has been documented before and decryption\nscripts for its encrypted strings exist.\n\n[Arbor for example has an article here, and the decryption script which is basically a Python](https://www.netscout.com/blog/asert/formidable-formbook-form-grabber)\n[conversion of the code in FormBook itself can be found here.](https://github.com/tildedennis/malware/blob/master/formbook/formbook_decryption.py)\n\n### Under the hood\n\nSo what does it look like in the binary?\n\nWhat you see here is an encrypted string blob. The lower part starting with `push ebp is the`\nactual string, while the top part is used to fetch its address.\n\nAny string FormBook uses is stored in gibberish code blocks like above.\n\n\n-----\n\nI ve analyzed the function processing those code blocks but couldn t identify it at first. I\nexpected some decompression/decryption but it looked like nothing I've seen before and it\nalso seemed rather simple (just copying memory around basically). The existing script is also\njust a 1:1 translation of the malware's code into Python, so that doesn't solve the riddle\neither.\n\nThen I had an idea - could it be that the processing code is actually a small disassembly\nengine? Turns out the answer is yes!\n\nWhat FormBook actually is doing is disassembling these gibberish code blocks and extracts\noperands, which make up the \"hidden\" encrypted blob. So the weird transformation functions\nare part of the disassembly engine.\n\nTo confirm that, I ripped the above blob into a file and ran it through Arbor's script and printed\nthe data before it is being decrypted using RC4, and the output was:\n```\n1065ba6b366a83cf14f7aa2bcab6059271710738\n\n```\nThat is, these bytes are what are hidden in the code blob. And if you look closely, you can\nsee the bytes in the above disassembly as operands but reversed (little-endian of\nDWORDs):\n```\n1065ba6b -> 0x6BBA6510\n366a83cf -> 0xCF836A36\n14f7aa2b -> 0x2BAAF714\ncab60592 -> 0x9205B6CA\n71710738 -> 0x38077171\n\n```\nSo FormBook is literally hiding the encrypted strings in plain sight - as operands for\nnonsense code blobs and uses a small disassembly engine to retrieve them. Haven't seen\nthis one before, that's a rather creative approach.\n\n(I couldn't find anyone else noticing what's actually going on, so if I missed it, apologies, let\nme know)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-02 - FormBook - Hiding in plain sight.pdf"
    ],
    "report_names": [
        "2019-05-02 - FormBook - Hiding in plain sight.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535814,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653685630,
    "ts_modification_date": 1653685630,
    "files": {
        "pdf": "https://archive.orkl.eu/5258dd88e8fc9201d429f54600907fd76830907f.pdf",
        "text": "https://archive.orkl.eu/5258dd88e8fc9201d429f54600907fd76830907f.txt",
        "img": "https://archive.orkl.eu/5258dd88e8fc9201d429f54600907fd76830907f.jpg"
    }
}