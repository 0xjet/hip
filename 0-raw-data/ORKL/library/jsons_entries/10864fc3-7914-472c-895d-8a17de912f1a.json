{
    "id": "10864fc3-7914-472c-895d-8a17de912f1a",
    "created_at": "2023-01-12T15:01:58.464296Z",
    "updated_at": "2025-03-27T02:08:40.461598Z",
    "deleted_at": null,
    "sha1_hash": "f4e725b9f400cf547bafe0b9c73e51a766cc4b9c",
    "title": "2021-02-11 - Agent Tesla hidden in a historical anti-malware tool",
    "authors": "",
    "file_creation_date": "2022-05-28T04:03:32Z",
    "file_modification_date": "2022-05-28T04:03:32Z",
    "file_size": 662574,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/27088**\n\n## Agent Tesla hidden in a historical anti-malware tool\n\n**Published: 2021-02-11**\n\n**Last Updated: 2021-02-11 07:17:18 UTC**\n\n**by** [Jan Kopriva (Version: 1)](https://isc.sans.edu/handler_list.html#jan-kopriva)\n\n[1 comment(s)](https://isc.sans.edu/forums/diary/Agent+Tesla+hidden+in+a+historical+antimalware+tool/27088/#comments)\nWhile going through attachments of e-mails, which were caught in my e-mail quarantine\nsince the beginning of February, I found an ISO file with what turned out to be a sample of\nthe Agent Tesla infostealer. That, by itself, would not be that unusual, but the Agent Tesla\nsample turned out to be unconventional in more ways than one...\n\nThe e-mail carrying the ISO attachment was a run-of-the-mill-looking malspam, informing the\nrecipient about a new delivery from DHL. It had a spoofed sender address\n“dhlSender@dhl.com”, which – although looking at least somewhat believable – certainly\ndidn’t have the impact of making the message appear trustworthy, which is what the authors\nof the e-mail were most likely hoping for. On the contrary, it must have resulted in very few of\nthe messages actually making it past any security analysis on e-mail gateways. The reason\nis that DHL has a valid SPF record set up for dhl.com, so any SPF check (i.e. something that\nmost of the worlds e-mail servers perform automatically these days) would lead to a “soft fail”\nresult, which would consequently most likely lead to the message being quarantined (if not\ndeleted outright).\n\n\n-----\n\n-----\n\nThe attached file Download_Tracking_Reference.01.02.2021.xlsx.iso contained only one\nEXE with identical name (except for the second extension, of course).\n\nThe executable was written in VB.NET and its malicious payload was hidden in it in an\ninteresting way – the file had two bitmaps embedded in its Resources section, both of which\nwere in fact encoded/encrypted DLLs.\n\n[While the use of bitmaps for embedding DLLs is not new for Agent Tesla[1], it is certainly an](https://www.zscaler.com/blogs/security-research/linkedin-job-seeker-phishing-campaign-spreads-agent-tesla)\ninteresting way to hide malicious code and prevent its detection. In this case, it didn’t seem\n[to help the file too much, given its 41/71 VT score at the time of writing[2], but it is quite](https://www.virustotal.com/gui/file/101399675ec99fcca0b69a0d6c146431c3a28c10d322499c817b2197e86971b5/detection)\nimaginative technique nonetheless.\n\nAfter the file was executed, it would first decode and load a small (10kB) DLL named\n_BestFit.dll._\n\n\n-----\n\nUsing this first DLL, the malware would then decode, decrypt and load a much larger\n(430kB) DLL called PositiveSign.dll.\n\n\n-----\n\nSince the second DLL was heavily obfuscated and its authors used couple of anti-analysis\ntechniques in it, I didn’t have time to go through it in detail, but from the portions of the code I\nsaw, it did appear to contain the final stage of the payload.\n\nWhat turned out to be even more interesting than the use bitmaps to store\nencoded/encrypted DLLs, however, was the code of the original executable, in which the\n\"malicious bitmaps\" were hidden. The EXE, which was originally named HashHelpers.exe,\nhad its description and product name set to Virus Effect Remover. This was a name of a\nlegitimate anti-malware tool developed during the 2000s and first half of 2010s.\n\n\n-----\n\nThis, by itself, would not be that unusual, since malware authors sometimes like to name\ntheir creations in creative or provocative ways. Nevertheless, in this case, the name wasn’t\nthe only thing which authors of Agent Tesla borrowed from the anti-malware tool… They\nreused significant portions of its code as well.\n\n[When comparing the malicious file with the latest available release of the real tool[3], it can](https://sourceforge.net/projects/viruseffectremo/)\nbe clearly seen that large parts of both binaries are (nearly) identical.\n\n\n-----\n\nAlthough the original code in the malicious EXE is never executed, authors of the malware\nreused large parts of it when making their creation. Since Virus Effect Remover was also\nwritten in VB.NET, getting to the code and repurposing it, even if they were working from a\ncompiled executable, would of course be trivial for them.\n\n\n-----\n\nEven though use of trojanized security tools is not a novel concept by any means, I think\nthis was the first time I’ve seen it done in this way – i.e. by using code of an old anti-malware\nsolution without trying to pass the resulting executable to target users as the original tool.\n\nWhile we can only speculate on why creators of the malicious code chose to hide it in a code\nof a historical security tool, by far the most probable explanation seems to be that this was\ndone in an attempt to make the malware seem benign to anti-malware scanners. And since\nsome security tools use signature-based allow-listing mechanisms to avoid scanning of\nknown security tools, this might have actually worked in some instances...\n\n**Indicators of Compromise (IoCs)**\nDownload_Tracking_Reference.01.02.2021.xlsx.iso (806 kB)\nMD5 - 2ceb9c4347aed5dd387d261b40473f46\nSHA-1 - d4b93dd1bfb531b228353451977185f039407741\n\nDownload_Tracking_Reference.01.02.2021.xlsx.exe / HashHelpers.exe (745 kB)\nMD5 - 9417df6dc7d716b0b69e587c9d89981b\nSHA-1 - e905472faad91b87dbfc7afc838564fde3c87aa3\n\nBestFit.dll (10 kB)\nMD5 - a32a0b1cc226475671801360f6c53419\nSHA-1 - aa6d74a2db3c430175e79f581afc29240b17ae6c\n\nPositiveSign.dll (430 kB)\nMD5 - 8b1e495e40571a5912f672f38f47058d\nSHA-1 - c900af54932bdd4c8fd749cecb5689e7e2082037\n\n[1] https://www.zscaler.com/blogs/security-research/linkedin-job-seeker-phishing-campaignspreads-agent-tesla\n\n[2]\nhttps://www.virustotal.com/gui/file/101399675ec99fcca0b69a0d6c146431c3a28c10d322499c\n817b2197e86971b5/detection\n\n[3] [https://sourceforge.net/projects/viruseffectremo/](https://sourceforge.net/projects/viruseffectremo/)\n\n----------Jan Kopriva\n[@jk0pr](https://twitter.com/jk0pr)\n[Alef Nula](https://www.alef.com/en/)\n\n[Keywords: Agent Tesla](https://isc.sans.edu/tag.html?tag=Agent%20Tesla) [DLL](https://isc.sans.edu/tag.html?tag=DLL) [Malware](https://isc.sans.edu/tag.html?tag=Malware)\n[1 comment(s)](https://isc.sans.edu/forums/diary/Agent+Tesla+hidden+in+a+historical+antimalware+tool/27088/)\n\nJoin us at SANS! Attend [with Jan Kopriva in starting](https://isc.sans.edu/diary/27088)\n\n\n-----\n\nTop of page\n×\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-11 - Agent Tesla hidden in a historical anti-malware tool.pdf"
    ],
    "report_names": [
        "2021-02-11 - Agent Tesla hidden in a historical anti-malware tool.pdf"
    ],
    "threat_actors": [
        {
            "id": "62f2206e-d8c6-49bb-86fc-63118ac2bf40",
            "created_at": "2022-10-25T16:07:23.725942Z",
            "updated_at": "2025-03-27T02:02:09.947444Z",
            "deleted_at": null,
            "main_name": "IndigoZebra",
            "aliases": [],
            "source_name": "ETDA:IndigoZebra",
            "tools": [
                "Dropbox"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "abb4a645-181b-4237-825f-447ac9b0c16d",
            "created_at": "2022-10-25T15:50:23.764656Z",
            "updated_at": "2025-03-27T02:00:55.540834Z",
            "deleted_at": null,
            "main_name": "IndigoZebra",
            "aliases": [
                "IndigoZebra"
            ],
            "source_name": "MITRE:IndigoZebra",
            "tools": [
                "xCaon",
                "BoxCaon",
                "PoisonIvy"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535718,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653710612,
    "ts_modification_date": 1653710612,
    "files": {
        "pdf": "https://archive.orkl.eu/f4e725b9f400cf547bafe0b9c73e51a766cc4b9c.pdf",
        "text": "https://archive.orkl.eu/f4e725b9f400cf547bafe0b9c73e51a766cc4b9c.txt",
        "img": "https://archive.orkl.eu/f4e725b9f400cf547bafe0b9c73e51a766cc4b9c.jpg"
    }
}