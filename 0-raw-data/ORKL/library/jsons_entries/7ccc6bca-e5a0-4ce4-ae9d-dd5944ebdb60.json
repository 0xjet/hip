{
    "id": "7ccc6bca-e5a0-4ce4-ae9d-dd5944ebdb60",
    "created_at": "2023-01-12T15:06:23.217404Z",
    "updated_at": "2025-03-27T02:17:00.196081Z",
    "deleted_at": null,
    "sha1_hash": "200529a5632ec37d8028e6cee8b310b336a1b660",
    "title": "2021-06-16 - Matanbuchus- Malware-as-a-Service with Demonic Intentions",
    "authors": "",
    "file_creation_date": "2022-05-29T01:28:55Z",
    "file_modification_date": "2022-05-29T01:28:55Z",
    "file_size": 1363931,
    "plain_text": "# Matanbuchus: Malware-as-a-Service with Demonic Intentions\n\n**unit42.paloaltonetworks.com/matanbuchus-malware-as-a-service/**\n\nJeff White, Kyle Wilhoit June 16, 2021\n\nBy [Jeff White and](https://unit42.paloaltonetworks.com/author/jeff-white/) [Kyle Wilhoit](https://unit42.paloaltonetworks.com/author/kyle-wilhoit/)\n\nJune 16, 2021 at 7:32 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [BelialDemon,](https://unit42.paloaltonetworks.com/tag/belialdemon/) [malware-as-a-service,](https://unit42.paloaltonetworks.com/tag/malware-as-a-service/) [Matanbuchus](https://unit42.paloaltonetworks.com/tag/matanbuchus/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/matanbuchus-malware-as-a-service/)\n\n## Executive Summary\n\nUnit 42 researchers often spend time investigating what we call non-traditional sources. Non-traditional\nsources often include underground marketplaces and sites, spanning from forums on the Tor network to\nTelegram channels and other marketplaces. One such case that we investigated involves a threat actor\ncalled BelialDemon, who is a member of several underground forums and marketplaces.\n\nIn February 2021, BelialDemon advertised a new malware-as-a-service (MaaS) called Matanbuchus Loader\nand charged an initial rental price of $2,500. Malware loaders are malicious software that typically drop or\npull down second-stage malware from command and control (C2) infrastructures. Matanbuchus has the\nfollowing capabilities:\n\nThe ability to launch a .exe or .dll file in memory.\nThe ability to leverage schtasks.exe to add or modify task schedules.\nThe ability to launch custom PowerShell commands.\nThe ability to leverage a standalone executable to load the DLL if the attacker otherwise has no way of\ndoing so.\n\nWe discovered several organizations impacted by Matanbuchus including a large university and high school\nin the United States, as well as a high-tech organization in Belgium.\n\n\n-----\n\nAfter observing the user BelialDemon operating in well-established underground forums, we ve noticed they\nstick to a particular biblical theme: their name, Belial, along with the name of their new loader, Matanbuchus,\nstem from the [Ascension of Isaiah 2:4: \"And Manasseh turned aside his heart to serve Belial; for the angel of](http://www.earlychristianwritings.com/text/ascension.html)\nlawlessness, who is the ruler of this world, is Belial, whose name is Matanbuchus.” A fitting theme for their\noperations.\n\nThis blog sheds light on Matanbuchus, BelialDemon and the malware’s infrastructure.\n\n## BelialDemon Overview\n\nIf we look historically, BelialDemon has been involved in the development of malware loaders. BelialDemon\nis considered the primary developer of TriumphLoader, a loader previously posted about on several forums,\nand has experience with selling this type of malware.\n\n_Figure 1. Forum posting of BelialDemon showcasing a loader._\nLooking over posts such as these in Figure 1, we’ll attempt to locate the files through a litany of means to\nbetter understand the functionality of the malware and analyze its activity in the wild – allowing for better\nprotections and enriched intelligence. BelialDemon was specifically looking to recruit three people as part of\ntheir MaaS offering, charging an initial rental price of $2,500.\n\n\n-----\n\n_Figure 2. Forum posting for Matanbuchus sale._\nSince we have a name for the malware direct from the source, we subsequently went hunting for samples of\nMatanbuchus used in the wild. Hunting for a sample of Matanbuchus unearthed a file in the wild called\nddg.dll, which is actively being dropped via hxxp://idea-secure-login[.]com. Looking at some of the included\nstrings showed we were on the right track.\n\nFigure 3. Strings showing MatanbuchusDroper.dll.\n\nAs stated by the malware author, the loader has the following features:\n\nThe ability to launch a .exe or .dll file in memory.\nThe ability to leverage schtasks.exe to add or modify task schedules.\nThe ability to launch custom PowerShell commands.\nThe ability to leverage a standalone executable to load the DLL if the attacker otherwise has no way of\ndoing so.\n\nThe question then becomes what does it actually look like in the wild?\n\n## The Excel Dropper\n\n\n-----\n\nAfter identifying the Microsoft Excel document (SHA256:\n41727fc99b9d99abd7183f6eec9052f86de076c04056e224ac366762c361afda) as an initial vector of an\nattack that drops the Matanbuchus Loader DLL, we begin our analysis on this file. When opening the Excel\ndocument, you're met with the notification that you need to enable macros to view the actual content of the\ndocument.\n\n_Figure 4. Picture of fake Excel warning._\nThis file is using a technique more recently favored in attacks leveraging Microsoft Office documents.\nSpecifically, there has been a shift from Microsoft Word to Microsoft Excel when trying to launch malicious\npayloads on victims’ systems. This shift is because, using Excel's built-in functions, it is possible to store\ncode distributed throughout the spreadsheet cells, offering a native obfuscation that hampers analysis and\ndetection. This is colloquially referred to as Excel 4.0 Macros.\n\n_Figure 5. Hidden worksheet functions._\nThe cells with data will spread across a sea of blank ones which, when executed, will piece together the\ninformation. In the example above, note how some of the visible cells in the B column refer to columns and\nrows across the sheet.\n\n_Figure 6. Example of an Excel function._\n\n\n-----\n\nThis GOTO function tells Excel to select a specific cell hundreds of columns over and 1,595 rows down.\nThese types of actions are chained together, and in this document, perform a simple download and\nexecution of said file.\n\nBy removing the blank cells in the document and reviewing the resulting strings, there are many interesting\n[standouts that align with the observed behavior of this file in our WildFire malware analysis engine.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n\n_Figure 7. Excel V4 extracted macro_\n\nstrings.\nTaking these at face value, we can see a breakdown in functionality for downloading a file to a certain\nlocation and the execution of it. In this case, ddg.dll will be downloaded from idea-secure-login[.]com and\nsaved locally as hcRlCTg.dll. Then the export within the DLL called RunDLL32_Install_COM32 is executed.\n\nAs previously stated, this lines up with expected behavior that was observed in WildFire.\n\n_Figure 8. WildFire logged_\n\nactivity.\nThe DLL, in this case, is the Matanbuchus Loader DLL file.\n\n## Matanbuchus Overview\n\nIn this next section, we'll briefly cover the Matanbuchus malware before we take a look at the infrastructure\nused.\n\nOverall, Matanbuchus uses two DLLs during the malware’s run cycle. Both DLLs are packed, but it should\nbe noted that the first DLL has an internal name of MatanbuchusDroper.dll while the second DLL is named\nMatanbuchus.dll. It’s not the stealthiest approach, but helpful to us nonetheless. Additionally, both DLLs are\nbased at 0x10000000 and use hard coded addresses throughout execution.\n\nOnce Excel downloads the initial DLL, MatanbuchusDroper.dll (SHA256:\n7fbaf7420943d4aa327bb82a357cd31ca92c7c83277f73a195d45bd18365cfce), from the idea-securelogin[.]com site, the Excel macro will launch and call the export within the DLL labeled\nRunDLL32_Install_COM32.\n\n\n-----\n\nThe primary function of this first DLL is, as its name suggests, to drop the main Matanbuchus DLL. However,\nbefore that, it will make a number of API calls typically observed in anti-virtualization and anti-debugging\nchecks, such as GetCursorPos, IsProcessorFeaturePresent, cpuid, GetSystemTimeAsFileTime, and\nQueryPerformanceCounter. These can profile a system to provide indicators to the malware that allow it to\ndetermine if it is running in a controlled environment (i.e. a sandbox).\n\n_Figure 9. API Call for IsProcessorFeaturePresent._\n_Figure 10. API Call for cpuid._\nEventually, the DLL will move to the next phase and unpack the URL to download the primary Matanbuchus\nDLL, disguised as an XML file called AveBelial.xml. This downloaded file is then saved to\nUsers\\ADMINI~1\\AppData\\Local\\Temp\\Run_32DLL_COM32\\shell96.dll. The use of shell96 is an attempt to\nblend in with the native system files, suggesting shell32 -> shell64 -> shell96 as a logical progression in\nnaming if it were real.\n\nFigure 11. Matanbuchus DLL download.\n\n_Figure 11. Writing shell96.dll to disk._\nPersistence is established by creating a scheduled task to run the new DLL, along with the specific export to\ncall.\n\n_Figure 12._\n\nScheduled task for persistence.\nNote the attempt to blend the export name of the DLL with words typically found in popular DLLs:\nRunDLL32_Install_COM32 and Run_32DLL_COM32. This continues the trend noted above regarding\nshell96.\n\nThe sample, Matanbuchus.dll (SHA256:\naf356a39a298f6a48f8091afc2f2fc0639338b11813f4f4bd05aba4e65d2bbe3), is similar to the first DLL and\nuses multiple types of obfuscation and encoding to hide strings and executable code from static analysis.\nUnlike the first one, additional steps were taken after unpacking the code to further hide the DLLs it\nleverages functions from. In Figure 14, you can see that the sample is building a string, Shell32.dll.\n\n\n-----\n\n_Figure 13. Building_\n\n“Shell32.dll” string.\nIf you look at the DLLs it decodes strings for, there are no big surprises: IPHLPAPI.DLL, ws2_32.dll,\nwininet.dll and shlwapi.dll. These are common sights when doing malware analysis as they are frequently a\nprecursor to actions such as writing files or network-based communication.\n\nFinally, this DLL collects various pieces of information about the system, such as hostnames, OS details,\nnetwork adapters and so on, before transitioning into a more familiar routine exhibited by remote access\ntrojans (RAT). The malware begins to communicate with the same host the DLL was downloaded from –\neonsabode[.]at. It then sends an HTTP POST to kntwtopnbt/8r5kudwrc8/gate[.]php with no referrer, and a\nuser-agent field containing data instead of an actual user-agent, making it quite visible and easily detectable.\n\n_Figure 14. Network Traffic HTTP POST._\nThe requests are Base64 encoded JSON arrays of more encoded data, most likely containing the profiling\ninformation of the host.\n\n\n-----\n\n_Figure 15. Base64_\n\ndecoded C2 traffic.\n\n## Infrastructure Overview\n\nShifting focus to the domain where the final Matanbuchus DLL came from (eonsabode[.]at), we can see that\nit resolves to an IP address in a Google network and has had a number of IP addresses it resolved to since\nearly February 2021. This aligns with the time we observed BelialDemon advertising their new malware.\nAdditionally, the initial domain (idea-secure-login[.]com) that the Excel v4 macro reaches out to for the first\nMatanbuchus DLL is also hosted on these same IP addresses.\n\n\n-----\n\n_Figure 17. DNS resolutions for eonsabode[.]at.When looking at each of the individual IP addresses and their_\nprevious resolutions, a number of patterns begin to emerge in the domains that exist on each one, further\ngrouping the malicious activity together.\nFor example, consider the following three most recent IP addresses and a subset of their resolutions:\n\n_34.94.151[.]129_\n\n_34.106.243[.]174_\n\n\n-----\n\n_34.105.89[.]82_\n\nThe immediately observable patterns here include the usage of domains registered with the Austria ccTLD\n\"at,\" the usage of \"24\" within the domain names, and the use of the words \"login,” \"online,\" \"sso\" and\n\"secure.” These are in line with BelialDemon's previous attempts to hide in plain sight by using “good” words.\n\nGiven this, we pulled all of the passive DNS resolutions for each IP the original malicious domains resolved\nto since February 2021. Focusing specifically on domains with multiple connections, we're left with a graph\nthat neatly clusters potentially related domains.\n\n\n-----\n\n_Figure 18. Connection_\n\nmap of IP and Domains.\nWithin this subset of domains, there are numerous clusters based on various aspects of the domain names,\nand we've individually clustered them below.\n\nPattern: Theme of biznesplanet\n\nPattern: Usage of \"24\"\n\nPattern: Usage of Austria ccTLD\n\n\n-----\n\nPattern: Fake Adobe Flash updates\n\nPattern: Usage of “Idea”\n\nPattern: Theme of “Wallet,” possibly crypto-related\n\nThe domains and themes primarily appear focused on phishing, and while not all of these domains are\nrelated to the Matanbuchus malware, it appears they are all malicious and likely operated by the same\nentities. For example, the \"Fake Flash Updates\" were associated with malicious APK files, as noted by the\n[Malware Hunter Team on Twitter, adding further weight to this theory. Some of these domains may be](https://twitter.com/malwrhunterteam/status/1372286619567460356)\nstaged for future campaigns and may not have been utilized yet.\n\n## Conclusion\n\nThis blog highlights how threat intelligence can be generated from hunting for threats observed in the wild\nand how small pieces of seemingly disparate data can chain together to strengthen analysis, extract\nindicators and improve defenses for your organization before being impacted.\n\nPalo Alto Networks customers are protected from this threat by:\n\nWildFire: All known samples are identified as malware.\nCortex XDR with:\n\nIndicators for Matanbuchus.\nNext-Generation Firewalls: DNS Signatures detect the known command and control (C2) domains,\n[which are also categorized as malware in Advanced URL Filtering.](https://www.paloaltonetworks.com/network-security/advanced-url-filtering)\n\n\n-----\n\nAutoFocus: Tracking related activity using the Matanbuchus tag.\n\n### Indicators of Compromise\n\nNote Value\n\n\nExcel Dropper\nSHA256\n\nMatanbuchus\nLoader\nSHA256\n\nMatanbuchus\nMain SHA256\n\nMatanbuchus\nLoader\nDomain\n\nMatanbuchus\nLoader URL\n\nMatanbuchus\nMain Domain\n\nMatanbuchus\nMain URL\n\nMatanbuchus\nLoader\nFileName\n\nMatanbuchus\nLoader\nFileName\n\nMatanbuchus\nMain\nFileName\n\nMatanbuchus\nLoader Export\n\nMatanbuchus\nMain Export\n\nMatanbuchus\nLoader\nCommandLine\n\nMatanbuchus\nMain FilePath\n\nAdditional\nMalicious\nDomains\n\n\n41727fc99b9d99abd7183f6eec9052f86de076c04056e224ac366762c361afda\n\n7fbaf7420943d4aa327bb82a357cd31ca92c7c83277f73a195d45bd18365cfce\n\naf356a39a298f6a48f8091afc2f2fc0639338b11813f4f4bd05aba4e65d2bbe3\n\nidea-secure-login[.]com\n\nidea-secure-login[.]com/3/ddg.dll\n\neonsabode[.]at\n\neonsabode[.]at/kntwtopnbt/iqiw922vv5/AveBelial.xml\n\nddg.dll\n\nhcRlcTg.dll\n\nshell96.dll\n\nRunDLL32_Install_COM32\n\nRun_32DLL_COM32\n\nschtasks.exe /Create /SC MINUTE /MO 2 /TN Run_32DLL_COM32 /TR\n\"C:\\Windows\\System32\\rundll32.exe\nC:\\Users\\Admin\\AppData\\Local\\Temp\\Run_32DLL_COM32\\shell96.dll,Run_32DLL_COM32\"\n\nC:\\Users\\Admin\\AppData\\Local\\Temp\\Run_32DLL_COM32\\\n\nbiznesplanet-bnpparlba[.]com\nbiznesplanet-parlbabnp[.]com\n\nbiznesplanet-parlbas[.]com\n\nbiznesplanet.parlbabnp[.]com\n\n\n-----\n\nlogin biznesplanet[.]com\n\nbos24-logowan[.]com\n\nbos24-logowanie[.]com\n\nbos24-online[.]com\n\nibos-online24[.]com\n\nibos24-login[.]com\n\nibos24-online[.]com\n\nlogin-bos24[.]com\n\ncitationsherbe[.]at\n\nflowsrectifie[.]at\n\nodatingactualiz[.]at\n\nflash-player-update[.]digital\n\nflash-update[.]digital\n\nflashplayer-update[.]digital\n\nflashupdate[.]digital\n\nplayer-update[.]digital\n\nplayerupdate[.]digital\n\nupgrade-flash-player[.]digital\n\nsso-cloud-idea[.]com\n\ndostawapapajohns[.]online\n\nonlinepapajohns[.]online\n\npapa-johns-dostawa[.]digital\n\npapa-johns-dostawa[.]online\n\nlogin.wallet-secure[.]org\n\nwallet-secure[.]biz\n\nwallet-secure[.]me\n\nwallet-secure[.]org\n\nwallet-secure[.]site\n\nwallet-secure[.]xyz\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\n\n-----\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-16 - Matanbuchus- Malware-as-a-Service with Demonic Intentions.pdf"
    ],
    "report_names": [
        "2021-06-16 - Matanbuchus- Malware-as-a-Service with Demonic Intentions.pdf"
    ],
    "threat_actors": [
        {
            "id": "aacd5cbc-604b-4b6e-9e58-ef96c5d1a784",
            "created_at": "2023-01-06T13:46:38.953463Z",
            "updated_at": "2025-03-27T02:00:02.961301Z",
            "deleted_at": null,
            "main_name": "APT31",
            "aliases": [
                "JUDGMENT PANDA",
                "BRONZE VINEWOOD",
                "Red keres",
                "Violet Typhoon",
                "TA412"
            ],
            "source_name": "MISPGALAXY:APT31",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9e6186dd-9334-4aac-9957-98f022cd3871",
            "created_at": "2022-10-25T15:50:23.357398Z",
            "updated_at": "2025-03-27T02:00:55.452383Z",
            "deleted_at": null,
            "main_name": "ZIRCONIUM",
            "aliases": [
                "APT31",
                "Violet Typhoon"
            ],
            "source_name": "MITRE:ZIRCONIUM",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "774f15f7-832e-4cd4-a1fa-ec6a838f2a40",
            "created_at": "2022-10-25T16:47:55.641406Z",
            "updated_at": "2025-03-27T02:05:17.29791Z",
            "deleted_at": null,
            "main_name": "BRONZE VINEWOOD",
            "aliases": [
                "Judgment Panda ",
                "ZIRCONIUM ",
                "APT31 "
            ],
            "source_name": "Secureworks:BRONZE VINEWOOD",
            "tools": [
                " HanaLoader",
                " Metasploit",
                " Mimikatz",
                " Reverse ICMP shell",
                " Trochilus",
                "DropboxAES RAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d9b39228-0d9d-4c1e-8e39-2de986120060",
            "created_at": "2023-01-06T13:46:39.293127Z",
            "updated_at": "2025-03-27T02:00:03.042341Z",
            "deleted_at": null,
            "main_name": "BelialDemon",
            "aliases": [
                "Matanbuchus"
            ],
            "source_name": "MISPGALAXY:BelialDemon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535983,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1653787735,
    "ts_modification_date": 1653787735,
    "files": {
        "pdf": "https://archive.orkl.eu/200529a5632ec37d8028e6cee8b310b336a1b660.pdf",
        "text": "https://archive.orkl.eu/200529a5632ec37d8028e6cee8b310b336a1b660.txt",
        "img": "https://archive.orkl.eu/200529a5632ec37d8028e6cee8b310b336a1b660.jpg"
    }
}