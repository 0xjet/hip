{
    "id": "e71726b6-f876-49a5-9f3f-08a802b395ad",
    "created_at": "2023-01-12T15:10:44.055184Z",
    "updated_at": "2025-03-27T02:05:32.349593Z",
    "deleted_at": null,
    "sha1_hash": "aba74fa53f3dbf94e5230f68a499cf2cfaf1b6ec",
    "title": "2019-07-10 - The eCh0raix Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T22:00:02Z",
    "file_modification_date": "2022-05-28T22:00:02Z",
    "file_size": 1417034,
    "plain_text": "# The eCh0raix Ransomware\n\n**anomali.com/blog/the-ech0raix-ransomware**\n\n## Introduction\n\nAnomali researchers have observed a new ransomware family, dubbed eCh0raix, targeting\nQNAP Network Attached Storage (NAS) devices. QNAP devices are created by the\nTaiwanese company QNAP Systems, Inc., and contain device storage and media player\nfunctionality, amongst others. The devices appear to be compromised by brute forcing weak\ncredentials and exploiting known vulnerabilities in targeted attacks. The malicious payload\nencrypts the targeted file extensions on the NAS using AES encryption and appends\n.encrypt extension to the encrypted files. The ransom note created by the ransomware has\nthe form shown below.\n```\n All your data has been locked(crypted).\n How to unclock(decrypt) instruction located in this TOR website:\n http://sg3dwqfpnr4sl5hh.onion/order/[Bitcoin address]\n Use TOR browser for access .onion websites.\n https://duckduckgo.com/html?q=tor+browser+how+to\n Do NOT remove this file and NOT remove last line in this file!\n [base64 encoded encrypted data]\n\n```\nNote that there is a typo in the ransom note which may indicate that the actors behind this\ncampaign are not native-English speakers.\n\n\n-----\n\n## QNAP Technical Breakdown\n\nThe malware is written and compiled in the Go programming language. The ransomware is\nvery simple with its source code being fewer than 400 lines. A reconstruction of the source\ncode tree is shown below. The functionality is standard for a ransomware: check if already\nencrypted, walk the file system for files to encrypt, encrypt the files, and produce the\nransom note.\n```\nPackage main: /home/user/go/src/qnap_crypt_worker\nFile: main.go\n    getInfo Lines: 61 to 123 (62)\n    checkReadmeExists Lines: 123 to 132 (9)\n    (init)0 Lines: 132 to 161 (29)\n    main Lines: 161 to 213 (52)\n    (main)func1 Lines: 185 to 191 (6)\n    randSeq Lines: 213 to 222 (9)\n    in Lines: 222 to 231 (9)\n    writemessage Lines: 231 to 238 (7)\n    chDir Lines: 238 to 269 (31)\n    encrypt Lines: 269 to 349 (80)\n    makesecret Lines: 349 to 358 (9)  \n\n```\nUpon execution, the malware reaches out to the URL http://192.99.206[.]61/d.php?\ns=started and notifies the Command and Control (C2) that the encryption process has\nbegun, as shown in Figure 1.\n\n_Figure 1 - Checks if the instance is already running by reaching out to a C2 IP. If it is, exit_\n_process._\n\n## Establishing C2 connection\n\nThe malware communicates to the C2 sg3dwqfpnr4sl5hh[.]onion via a SOCKS5 Tor proxy\nat 192.99.206[.]61:65000, as seen in Figures 2 and 3. Based on the analysis it is clear that\nthe proxy has been set up by the malware author to provide Tor network access to the\nmalware without including Tor functionality in the malware.\n\n\n-----\n\n_Figure 2 - Port scan results on Proxy IP._\n\n_Figure 3 - Connects via SOCKS5 proxy_\n\nThe malware retrieves the RSA public key and the ‘readme’ text content from the C2 server.\nOne of the samples analyzed used the URL\n“http://sg3dwqfpnr4sl5hh[.]onion/api/GetAvailKeysByCampId/10”, that possibly suggests\nthis was the 10th campaign run by the threat actor. The data returned by the C2 server is\nencoded in JSON and the malware unserializes the data into the following Go data struct:\n```\ntype main.Info struct {\n    RsaPublicKey string\n    Readme string\n}\n\n## Encryption Module\n\n```\nThe module generates a 32 character random string from the array\n“abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+” to\ncreate an AES-256 key. By using this fixed set of characters, the effective key space is 192bit. As can be seen in Figure 4, the malware initializes the math random page with the seed\nof the current time. Since it is using the math’s package to generate the secret key, it is not\ncryptographically random and it is likely possible to write a decryptor.\n\n\n-----\n\n_Figure 4 - Set the math random seed with the current time._\n\nThe generated AES key is then encrypted with a public key which was either embedded in\nthe malware sample or retrieved from the C2 server, depending on the version of the\nmalware. The resulted string is then encoded with base64 and added to the\nREADME_FOR_DECRYPT.txt file.\n\nBefore the malware encrypts any files, it proceeds to kill the below list of processes. The\nprocesses are stopped on the infected NAS by issuing the commands “service stop %s” or\n“systemctl stop %s”.\n\napache2\nhttpd\nnginx\nmysqld\nmysql\nphp-fpm\n\n\n-----\n\nphp5-fpm\npostgresql\n\n## File Encryption\n\nThe files are encrypted with AES in Cipher Feedback Mode (CFB) with the secret key that\nwas generated. When selecting files to encrypt, the ransomware skips any files where the\nabsolute path for the file contain any of the strings listed below.\n\n/proc\n/boot/\n/sys/\n/run/\n/dev/\n/etc/\n/home/httpd\n/mnt/ext/opt\n.system/thumbnail\n.system/opt\n.config\n.qpkg\n\nIf the path does not contain any of the strings, it checks the file extension for the file. If the\nfile extension is one of the extensions shown below, the ransomware encrypts the file. The\nencrypted data is written to a new file with the original name and file extension but the file\nextensions “.encrypt” is appended to the end. Once the file has been written, the original file\nis removed.\n```\n.dat.db0.dba.dbf.dbm.dbx.dcr.der.dll.dml.dmp.dng.doc.dot.dwg.dwk.dwt.dxf.dxg.ece.eml.\n\n```\nOnce the entire encryption process is completed the malware reaches out to the URL\nhttp://192.99.206.61/d[.]php?s=done and sends the command “done” to notify the\ncompletion of encryption, Figure 5.\n\n_Figure 5 - Send “done” to C2_\n\n## C2 Analysis\n\nThe analyzed C2 URL (http://sg3dwqfpnr4sl5hh[.]onion) has partial directory listing enabled,\nand after browsing through the directories, Anomali researchers were able to find a sample\nnamed “linux crypter”. The sample was packed by UPX. Analysis of the unpacked sample\n\n\n-----\n\nconfirmed that it is written in Go and had some modifications to the previously analysed\nsample. The sample found on C2, checks the locale of the infected NAS for Belarus,\nUkraine, or Russia and exits without doing anything if a match is found. This technique is\ncommon amongst threat actors, particularly when they do not wish to infect users in their\nhome country.\n\n## Analysis\n\nThe eCh0raix ransomware, named after a string found in the malware, is a ransomware\nused in targeted attacks. It appears to not be designed for mass distribution. The samples\nwith a hardcoded public key appear to be compiled for the target with a unique key for each\ntarget. Otherwise the decryptor sold by the threat actor could be used for all victims. The\nsamples that fetch the public key and ransom note from the C2 server, also send a request\nwhen it starts and when it is done. This is probably used to provide the threat actor with live\nfeedback. The request does not include any identifiable information for the threat actor to\ndiscern multiple targets.\n\nThe threat actor targets QNAP NAS devices that are used for file storage and backups. It is\nnot common for these devices to run antivirus products and currently the samples are only\ndetected by 2-3 products on VirusTotal, Figure 6, which allows the ransomware to run\nuninhibited. It is not known how these devices are infected. According to a post on Bleeping\nComputer’s forum, some infected systems were not fully patched and others reported\ndetections of failed login attempts.\n\n_Figure 6 - Low detection rate on VirusTotal_\n\n_“During my research, the nas pops me severals time with the message \"HTTP Login_\n_Failed\", like every second.”_\n\n   - zerocool64\n\n\n-----\n\n_Seems all of us are using QNAP NAS, which version of QTS where you using at the_\n_time of the attack? Mine was 4.1.3”_\n\n   - eggxpert\n\n_“I've found a lot of .encrypt files on my RAID 6 in my QNAP TS-459 Pro II with 4.2.6_\n_firmware”_\n\n  - alew1s3\n\n_“I've activated system registry and suddenly there are a lot of attempts to login via_\n_HTTP in my myqnapcloud by strange usernames and IPs so i totally disabled it”_\n\n  - alew1s3\n\n_“Same as someone already explained: lot of login failed that day.”_\n\n   - lucagiroletti\n\n_Figure 7 - Content from BleepingComputer forum post_\n\n## Recommendations\n\nRestrict external access to the QNAP NAS device. Ensure it is up to date with security\npatches and that strong credentials are employed.\n\nAffected QTS versions according to BleepingComputer forum users:\n\n4.1.3\n4.2.6\nQNAP TS-459 Pro II with 4.2.6 firmware\nQNAP TS-251+ (4.3.1.0695 Build 20180830)\n\n### Yara rule\n\n\n-----\n\n```\nrule eCh0raix {\n  meta:\n    author = \"Anomali\"\n    tlp = \"GREEN\"\n    description = \"Rule to detect eCh0raix ransomware\"\n    version = \"1.0\"\n  strings:\n    $magic = \"eCh0raix\"\n    $s0 = \"go.buildid\"\n    $s1 = \"main.main\"\n    $s2 = \"makesecret\"\n    $s3 = \"chDir\"\n    $s4 = \"writemessage\"\n    $s5 = \"randSeq\"\n    $s6 = \"encrypt\"\n  condition:\n    uint16(0) == 0x457f and $magic and all of ($s*)\n}\n\n### Bitcoin addresses\n\n```\n18C28bVEctVtVbwNytt4Uy6k7wxpysdDLH\n\n1Fx7jev3dvHobdK8m3Jk6cA8SrfzjjLqvM\n\n### Samples\n\n154dea7cace3d58c0ceccb5a3b8d7e0347674a0e76daffa9fa53578c036d9357 (DE)\n\n3d7ebe73319a3435293838296fbb86c2e920fd0ccc9169285cc2c4d7fa3f120d (TW)\n\n95d8d99c935895b665d7da2f3409b88f ( linux_cryptor)\n\n### URLs\n\nhttp://sg3dwqfpnr4sl5hh[.]onion/api/GetAvailKeysByCampId/13\n\nhttp://sg3dwqfpnr4sl5hh[.]onion/order/1LWqmP4oTjWS3ShfHWm1UjnvaLxfMr2kjm\n\nhttp://sg3dwqfpnr4sl5hh[.]onion/static/\n\n### IP\n\n192.99.206.61:65000\n\n### MITRE ATT&CK TTPs:\n\n\n-----\n\nTopics: Research\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-10 - The eCh0raix Ransomware.pdf"
    ],
    "report_names": [
        "2019-07-10 - The eCh0raix Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536244,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653775202,
    "ts_modification_date": 1653775202,
    "files": {
        "pdf": "https://archive.orkl.eu/aba74fa53f3dbf94e5230f68a499cf2cfaf1b6ec.pdf",
        "text": "https://archive.orkl.eu/aba74fa53f3dbf94e5230f68a499cf2cfaf1b6ec.txt",
        "img": "https://archive.orkl.eu/aba74fa53f3dbf94e5230f68a499cf2cfaf1b6ec.jpg"
    }
}