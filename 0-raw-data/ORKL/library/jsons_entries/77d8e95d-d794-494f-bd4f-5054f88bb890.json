{
    "id": "77d8e95d-d794-494f-bd4f-5054f88bb890",
    "created_at": "2023-01-12T15:03:07.820607Z",
    "updated_at": "2025-03-27T02:05:31.207112Z",
    "deleted_at": null,
    "sha1_hash": "7041672290595cfe0a65932576b44c9d64ce2853",
    "title": "2020-12-17 - Sunburst Backdoor, Part II- DGA & The List of Victims",
    "authors": "",
    "file_creation_date": "2022-09-01T10:12:30Z",
    "file_modification_date": "2022-09-01T10:12:30Z",
    "file_size": 1167326,
    "plain_text": "# Prevasio\n\n**[prevasio.io/blog/sunburst-backdoor-part-ii-dga-the-list-of-victims](https://www.prevasio.io/blog/sunburst-backdoor-part-ii-dga-the-list-of-victims)**\n\nBy\n\nSergei Shevchenko\n\nDecember 17, 2020\n\n## Sunburst Backdoor, Part II: DGA & The List of Victims\n\n[Previous Part of the analysis is available here.](https://www.prevasio.io/blog/sunburst-backdoor-a-deeper-look-into-the-solarwinds-supply-chain-malware)\n\n[Next Part of the analysis is available here.](https://www.prevasio.io/blog/sunburst-backdoor-part-iii-dga-security-software)\n\n_Update from 19 December 2020:_\n\n_[‍Prevasio would like to thank Zetalytics for providing us with an updated (larger) list of passive (historic)](https://zetalytics.com/)_\nDNS queries for the domains generated by the malware.\n\n[As described in the first part of our analysis, the DGA (Domain Generation Algorithm) of the](https://blog.prevasio.com/2020/12/sunburst-backdoor-deeper-look-into.html)\nSunburst backdoor produces a domain name that may look like:\n\nfivu4vjamve5vfrtn2huov[.]appsync-api.us-west-2[.]avsvmcloud[.]com\n\nThe first part of the domain name (before the first dot) consists of a 16-character random\n[string, appended with an encoded computer's domain name. This is the domain in which the](https://docs.microsoft.com/en-us/dotnet/api/system.net.networkinformation.ipglobalproperties.domainname?redirectedfrom=MSDN&view=net-5.0#System_Net_NetworkInformation_IPGlobalProperties_DomainName)\nlocal computer is registered.\n\n\n-----\n\nFrom the example string above, we can conclude that the encoded computer s domain starts\nfrom the 17th character and up until the dot (highlighted in yellow):\n\n```\nfivu4vjamve5vfrtn2huov\n\n```\n\nIn order to encode a local computer's domain name, the malware uses one of 2 simple\nmethods:\n\n_Method 1: a substitution table, if the domain name consists of small letters, digits, or_\nspecial characters '-', '_', '.'\n_Method 2: base64 with a custom alphabet, in case of capital letters present in the_\ndomain name\n\n**Method 1**\n\nIn our example, the encoded domain name is \"n2huov\". As it does not have any capital\nletters, the malware encodes it with a substitution table\n**\"rq3gsalt6u1iyfzop572d49bnx8cvmkewhj\".**\n\nFor each character in the domain name, the encoder replaces it with a character located in\nthe substitution table four characters right from the original character.\n\nIn order to decode the name back, all we have to do is to replace each encoded character\nwith another character, located in the substitution table four characters left from the original\ncharacter.\n\nTo illustrate this method, imagine that the original substitution table is printed on a paper strip\nand then covered with a card with 6 perforated windows. Above each window, there is a\nsticker note with a number on it, to reflect the order of characters in the word \"n2huov\",\nwhere 'n' is #1, '2' is #2, 'h' is #3 and so on:\n\nOnce the paper strip is pulled by 4 characters right, the perforated windows will reveal a\ndifferent word underneath the card: \"domain\", where 'd' is #1, 'o' is #2, 'm' is #3, etc.:\n\n\n-----\n\nA special case is reserved for such characters as '0', '-', '_', '.'. These characters are\nencoded with '0', followed with a character from the substitution table. An index of that\ncharacter in the substitution table, divided by 4, provides an index within the string \"0_-.\".\n\nThe following snippet in C# illustrates how an encoded string can be decoded:\n```\nstatic string decode_domain(string s)\n\n{\n\n  string table = \"rq3gsalt6u1iyfzop572d49bnx8cvmkewhj\";\n\n  string result = \"\";\n\n  for (int i = 0; i < s.Length; i++)\n\n  {\n\n    if (s[i] != '0')\n\n    {\n\n      result += table[(table.IndexOf(s[i]) + table.Length - 4) % table.Length];\n\n    }\n\n    else\n\n    {\n\n      if (i < s.Length - 1)\n\n      {\n\n        if (table.Contains(s[i + 1]))\n\n        {\n\n          result += \"0_-.\"[table.IndexOf(s[i + 1]) % 4];\n\n        }\n\n        else\n\n        {\n\n          break;\n\n        }\n\n      }\n\n      i++;\n\n    }\n\n  }\n\n  return result;\n\n}\n\n\n```\n**Method 2**\n\n[This method is a standard base64 encoder with a custom alphabet](https://stackoverflow.com/questions/641361/base32-decoding)\n**\"ph2eifo3n5utg1j8d94qrvbmk0sal76c\".**\n\nHere is a snippet in C# that provides a decoder:\n\n\n-----\n\n```\npublic static string FromBase32String(string str)\n\n{\n\n  string table = \"ph2eifo3n5utg1j8d94qrvbmk0sal76c\";\n\n  int numBytes = str.Length * 5 / 8;\n\n  byte[] bytes = new Byte[numBytes];\n\n  int bit_buffer;\n\n  int currentCharIndex;\n\n  int bits_in_buffer;\n\n  if (str.Length < 3)\n\n  {\n\n    bytes[0] = (byte)(table.IndexOf(str[0]) | table.IndexOf(str[1]) << 5);\n\n    return System.Text.Encoding.UTF8.GetString(bytes);\n\n  }\n\n  bit_buffer = (table.IndexOf(str[0]) | table.IndexOf(str[1]) << 5);\n\n  bits_in_buffer = 10;\n\n  currentCharIndex = 2;\n\n  for (int i = 0; i < bytes.Length; i++)\n\n  {\n\n    bytes[i] = (byte)bit_buffer;\n\n    bit_buffer >>= 8;\n\n    bits_in_buffer -= 8;\n\n    while (bits_in_buffer < 8 && currentCharIndex < str.Length)\n\n    {\n\n      bit_buffer |= table.IndexOf(str[currentCharIndex++]) << bits_in_buffer;\n\n      bits_in_buffer += 5;\n\n    }\n\n  }\n\n  return System.Text.Encoding.UTF8.GetString(bytes);\n\n}\n\n```\nWhen the malware encodes a domain using Method 2, it prepends the encrypted string with\na double zero character: \"00\".\n\nFollowing that, extracting a domain part of an encoded domain name (long form) is as simple\nas:\n```\nstatic string get_domain_part(string s)\n\n{\n\n  int i = s.IndexOf(\".appsync-api\");\n\n  if (i > 0)\n\n  {\n\n    s = s.Substring(0, i);\n\n    if (s.Length > 16)\n\n    {\n\n      return s.Substring(16);\n\n    }\n\n  }\n\n  return \"\";\n\n}\n\n```\n\n-----\n\nOnce the domain part is extracted, the decoded domain name can be obtained by using\nMethod 1 or Method 2, as explained above:\n```\nif (domain.StartsWith(\"00\"))\n\n{\n\n  decoded = FromBase32String(domain.Substring(2));\n\n}\n\nelse\n\n{\n\n  decoded = decode_domain(domain);\n\n}\n\n\n```\n**Decrypting the Victims' Domain Names**\n\nTo see the decoder in action, let's select 2 lists:\n\n**List #1**\n\n[Bambenek Consulting has provided a list of observed hostnames for the DGA domain.](https://github.com/bambenek/research/blob/main/sunburst/uniq-hostnames.txt)\n\n**List #2**\n\n[The second list has surfaced in a Paste bin paste,](https://pastebin.com/6EDgCKxd) [allegedly sourced from](https://twitter.com/0xrb/status/1339199268146442241) Zetalytics /\nZonecruncher.\n\nNOTE: This list is fairly 'noisy', as it has non-decodable domain names.\n\nBy feeding both lists to our decoder, we can now obtain a list of decoded domains, that could\nhave been generated by the victims of the Sunburst backdoor.\n\n**DISCLAIMER: It is not clear if the provided lists contain valid domain names that indeed**\nbelong to the victims. It is quite possible that the encoded domain names were produced by\nthird-party tools, sandboxes, or by researchers that investigated and analysed the backdoor.\n\nThe decoded domain names are provided purely as a reverse engineering exercise. The\nresulting list was manually processed to eliminate noise, and to exclude duplicate entries.\nFollowing that, we have made an attempt to map the obtained domain names to the\ncompany names, using Google search. Reader's discretion is advised as such mappings\ncould be inaccurate.\n\n**Decoded Domain** **Mapping (Could Be Inaccurate)**\n\nhgvc.com Hilton Grand Vacations\n\nAmerisaf AMERISAFE, Inc.\n\nkcpl.com Kansas City Power and Light Company\n\n\n-----\n\nSFBALLET San Francisco Ballet\n\nscif.com State Compensation Insurance Fund\n\nLOGOSTEC Logostec Ventilação Industrial\n\nARYZTA.C ARYZTA Food Solutions\n\nbmrn.com BioMarin Pharmaceutical Inc.\n\nAHCCCS.S Arizona Health Care Cost Containment System\n\nnnge.org Next Generation Global Education\n\ncree.com Cree, Inc (semiconductor products)\n\ncalsb.org The State Bar of California\n\nrbe.sk.ca Regina Public Schools\n\ncisco.com Cisco Systems\n\npcsco.com Professional Computer Systems\n\nbarrie.ca City of Barrie\n\nripta.com Rhode Island Public Transit Authority\n\nuncity.dk UN City (Building in Denmark)\n\nbisco.int Boambee Industrial Supplies (Bisco)\n\nhaifa.edu University of Haifa\n\nsmsnet.pl SMSNET, Poland\n\nfcmat.org Fiscal Crisis and Management Assistance Team\n\nwiley.com Wiley (publishing)\n\nciena.com Ciena (networking systems)\n\nbelkin.com Belkin\n\nspsd.sk.ca Saskatoon Public Schools\n\npqcorp.com PQ Corporation\n\nftfcu.corp First Tech Federal Credit Union\n\nbop.com.pk The Bank of Punjab\n\n\n-----\n\nnvidia.com NVidia\n\ninsead.org INSEAD (non-profit, private university)\n\nusd373.org Newton Public Schools\n\nagloan.ads American AgCredit\n\npageaz.gov City of Page\n\njarvis.lab Erich Jarvis Lab\n\nch2news.tv Channel 2 (Israeli TV channel)\n\nbgeltd.com Bradford / Hammacher Remote Support Software\n\ndsh.ca.gov California Department of State Hospitals\n\ndotcomm.org Douglas Omaha Technology Commission\n\nsc.pima.gov Arizona Superior Court in Pima County\n\nitps.uk.net IT Professional Services, UK\n\nmoncton.loc City of Moncton\n\nacmedctr.ad Alameda Health System\n\ncsci-va.com Computer Systems Center Incorporated\n\nkeyano.local Keyano College\n\nuis.kent.edu Kent State University\n\nalm.brand.dk Sydbank Group (Banking, Denmark)\n\nironform.com Ironform (metal fabrication)\n\ncorp.ncr.com NCR Corporation\n\nap.serco.com Serco Asia Pacific\n\nint.sap.corp SAP\n\nmmhs-fla.org Cleveland Clinic Martin Health\n\nnswhealth.net NSW Health\n\nmixonhill.com Mixon Hill (intelligent transportation systems)\n\nbcofsa.com.ar Banco de Formosa\n\n\n-----\n\nci.dublin.ca. Dublin, City in California\n\nsiskiyous.edu College of the Siskiyous\n\nweioffice.com Walton Family Foundation\n\necobank.group Ecobank Group (Africa)\n\ncorp.sana.com Sana Biotechnology\n\nmed.ds.osd.mi US Gov Information System\n\nwz.hasbro.com Hasbro (Toy company)\n\nits.iastate.ed Iowa State University\n\namr.corp.intel Intel\n\ncds.capilanou. Capilano University\n\ne-idsolutions. IDSolutions (video conferencing)\n\nhelixwater.org Helix Water District\n\ndetmir-group.r Detsky Mir (Russian children's retailer)\n\nint.lukoil-int LUKOIL (Oil and gas company, Russia)\n\nad.azarthritis Arizona Arthritis and Rheumatology Associates\n\nnet.vestfor.dk Vestforbrænding\n\nallegronet.co. Allegronet (Cloud based services, Israel)\n\nus.deloitte.co Deloitte\n\ncentral.pima.g Pima County Government\n\ncity.kingston. City of Kingston\n\nstaff.technion Technion - Israel Institute of Technology\n\nairquality.org Sacramento Metropolitan Air Quality Management District\n\nphabahamas.org Public Hospitals Authority, Caribbean\n\nparametrix.com Parametrix (Engineering)\n\nad.checkpoint. Check Point\n\ncorp.riotinto. Rio Tinto (Mining company, Australia)\n\n\n-----\n\nintra.rakuten. Rakuten\n\nus.rwbaird.com Robert W. Baird & Co. (Financial services)\n\nville.terrebonn Ville de Terrebonne\n\nwoodruff-sawyer Woodruff-Sawyer & Co., Inc.\n\nfisherbartoninc Fisher Barton Group\n\nbanccentral.com BancCentral Financial Services Corp.\n\ntaylorfarms.com Taylor Fresh Foods\n\nneophotonics.co NeoPhotonics (optoelectronic devices)\n\ngloucesterva.ne Gloucester County\n\nmagnoliaisd.loc Magnolia Independent School District\n\nzippertubing.co Zippertubing (Manufacturing)\n\nmilledgeville.l Milledgeville (City in Georgia)\n\ndigitalreachinc Digital Reach, Inc.\n\ndeniz.denizbank DenizBank\n\nthoughtspot.int ThoughtSpot (Business intelligence)\n\nlufkintexas.net Lufkin (City in Texas)\n\ndigitalsense.co Digital Sense (Cloud Services)\n\nwrbaustralia.ad W. R. Berkley Insurance Australia\n\nchristieclinic. Christie Clinic Telehealth\n\nsignaturebank.l Signature Bank\n\ndufferincounty. Dufferin County\n\nmountsinai.hosp Mount Sinai Hospital\n\nsecurview.local Securview Victory (Video Interface technology)\n\nweber-kunststof Weber Kunststoftechniek\n\nparentpay.local ParentPay (Cashless Payments)\n\neuropapier.inte Europapier International AG\n\n\n-----\n\nmolsoncoors.com Molson Coors Beverage Company\n\nfujitsugeneral. Fujitsu General\n\ncityofsacramento City of Sacramento\n\nninewellshospita Ninewells Hospital\n\nfortsmithlibrary Fort Smith Public Library\n\ndokkenengineerin Dokken Engineering\n\nvantagedatacente Vantage Data Centers\n\nfriendshipstateb Friendship State Bank\n\nclinicasierravis Clinica Sierra Vista\n\nftsillapachecasi Apache Casino Hotel\n\nvoceracommunicat Vocera (clinical communications)\n\nmutualofomahaban Mutual of Omaha Bank\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-17 - Sunburst Backdoor, Part II- DGA & The List of Victims.pdf"
    ],
    "report_names": [
        "2020-12-17 - Sunburst Backdoor, Part II- DGA & The List of Victims.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535787,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1662027150,
    "ts_modification_date": 1662027150,
    "files": {
        "pdf": "https://archive.orkl.eu/7041672290595cfe0a65932576b44c9d64ce2853.pdf",
        "text": "https://archive.orkl.eu/7041672290595cfe0a65932576b44c9d64ce2853.txt",
        "img": "https://archive.orkl.eu/7041672290595cfe0a65932576b44c9d64ce2853.jpg"
    }
}