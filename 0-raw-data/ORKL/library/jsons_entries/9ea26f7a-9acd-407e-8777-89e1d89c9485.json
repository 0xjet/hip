{
    "id": "9ea26f7a-9acd-407e-8777-89e1d89c9485",
    "created_at": "2023-01-12T15:10:40.651978Z",
    "updated_at": "2025-03-27T02:15:59.340129Z",
    "deleted_at": null,
    "sha1_hash": "0cc4698f5964b2f21ffa5de6264e4b5823dbdcee",
    "title": "2021-05-20 - Response When Minutes Matter- When Good Tools Are Used for (R)Evil",
    "authors": "",
    "file_creation_date": "2022-05-28T01:19:34Z",
    "file_modification_date": "2022-05-28T01:19:34Z",
    "file_size": 3307254,
    "plain_text": "# How Falcon Complete Thwarted a REvil Ransomware Attack\n\n**[crowdstrike.com/blog/how-falcon-complete-thwarted-a-revil-ransomware-attack/](https://www.crowdstrike.com/blog/how-falcon-complete-thwarted-a-revil-ransomware-attack/)**\n\nJoshua Fraser May 20, 2021\n\n_This Falcon Complete incident response investigation recap was originally published by IT-_\n_daily.net on Apr. 13, 2021._\n\nIt was late on a Saturday afternoon, and the Southern Hemisphere CrowdStrike Falcon\nComplete™ team was getting ready to clock off and hand over to our Northern Hemisphere\ncolleagues; things were seemingly quiet and under control. After a long week, we were ready\nto kick back and enjoy the weekend. However, within seconds, thousands and thousands of\nhigh-severity detections started to roll in for one customer, filling the queues with a proverbial\nflood.\n\n## And So It Begins\n\nWith our Northern Hemisphere colleagues clocked on, it took just one minute to realize the\nseverity of the situation, and together the two teams jumped into action. The detections\nthemselves were not complicated, but it was unusual to see them on so many unique hosts\n\n\n-----\n\nin a single victim environment. We were able to quickly leverage the CrowdStrike Falcon® UI\nto determine the root of the problem, as the interface clearly displayed the process tree\nrelated to the malicious process to illustrate what was happening.\n\nThe detection that had appeared on all managed hosts was an attempt to execute a\ncommand via PowerShell. The process tree showed us that a trusted IT management tool\nwas running and had spawned cmd.exe and subsequently attempted to run an encoded\nPowerShell command. This malicious activity was successfully being prevented by the\nFalcon sensor.\n\n## Investigating the Threat\n\nAs the malicious activity was being blocked by the sensor, we had time to take a step back\nand ask two critical questions:\n\n1. How was this legitimate service deploying the malicious code?\n2. What PowerShell code was the adversary attempting to execute on the host?\n\nIn response to the first question, Falcon Complete analysts reviewed the process tree and\nidentified that within the command-line parameters for the execution of the IT management\ntool (which has software deployment capabilities), we could see the domain name of the\ncloud management platform for the tool, and this allowed us to confirm our suspicion that this\nwas in fact a trusted IT management tool.\n\n\n-----\n\nIt is common in these types of intrusions that the threat actor takes control of an\n[administrative account either through phishing or](https://www.crowdstrike.com/cybersecurity-101/phishing/) [brute force techniques. However, these](https://www.crowdstrike.com/cybersecurity-101/brute-force-attacks/)\ntechniques generally also rely on certain weaknesses on cloud platforms (in this case, a\ncloud-based IT management tool), including a lack of multifactor authentication (MFA) or\nfailure to implement IP address restrictions. This intrusion was no exception. With the\nadditional information gathered through our analysis, we concluded that the admin account\nfor the application had been compromised and was being used to push out malicious code.\nFalcon Complete analysts contacted the customer immediately to share the details\ndiscovered so far and advised them to disable the affected account and enable MFA for it\nbefore resetting the password and reenabling it.\n\n## Getting Clarity Quickly with Falcon\n\nFalcon Complete understands the importance of responding to detections in a timely\nmanner. To ensure that we can stay a step ahead of the adversary in protecting the victim\nenvironment, a team of analysts coordinates across a multitude of tasks to deliver a\nseamless managed response. In this case, one analyst was solely focused on\ncommunicating with the customer via the bridged phone call, providing clear and accurate\ninformation on the detection as details emerged, as well as providing timely\nrecommendations. Another analyst was working on understanding the malware samples\nidentified and ensuring Falcon would block it, and others had a more general focus of\ninvestigating the detections. Splitting the functions like this enables Falcon Complete to\nperform at high speed and with high accuracy. The Falcon UI proved to be an invaluable\nasset in the speed of this response, as a simple toggle in the UI enabled analysts to quickly\ndecode the encoded PowerShell, which saved a few extra seconds for each detect it\nhandled.\n\nThe toggle and its resulting decoded output can be seen in the image below:\n\n\n-----\n\nThe PowerShell code first checks which version of Windows is running on the hosts by\nreviewing the Processor Architecture variable to check whether 32-bit or 64-bit. This is\nbecause the payload didn’t support 64-bit execution, and therefore the script needed to use a\n32-bit version of PowerShell to execute the malicious payload. The more important\ncomponent of this script is its calls to a pastebin URL — this reveals the main malicious\nscript that is trying to be pulled down to the host.\n\n\n-----\n\nOn reviewing the script, copied from the pastebin URL, it was identified to be an InvokeReflectivePEInjection function from the well-known PowerSploit tool. Interestingly, though,\nthe Portable Executable (PE) file that was embedded in the script was identified as\nSodinokibi/REvil ransomware. This malware is commonly associated with the threat actor\n[PINCHY SPIDER and its affiliates operating under a ransomware-as-a-service (RaaS)](https://adversary.crowdstrike.com/adversary/pinchy-spider/)\nmodel. Read more about PINCHY SPIDER and other ransomware adversaries in this blog,\n[“Double Trouble: Ransomware with Data Leak Extortion, Part 1.”](https://www.crowdstrike.com/blog/double-trouble-ransomware-data-leak-extortion-part-1/)\n\n\n-----\n\n## Shifting Gears and Neutralizing the Threat\n\nAs we were communicating with the customer about this matter, thousands more detections\nstarted to come in, but the encoded commands had changed. This ransomware actor was\nnot going to give up on their payday — they were working on their weekend and didn’t want\nto miss out. Aware that their initial malicious script execution attempts had failed, and\nsuspecting that pastebin was blocked on the customer’s network, they shifted to hastebin.\n\nThese changes continued roughly every 30 minutes, when new tickets for detections would\nstart to roll in. Unfortunately, remediation of this intrusion was delayed as the customer was\nunable to regain control of the compromised account. We realized that the threat actor would\ncontinue to change their code until they successfully deployed ransomware to those hosts.\nWe pivoted and quickly developed a new solution to the problem by leveraging internal tools\nto temporarily kill the running application until the customer could regain control of that admin\naccount. With approval from the customer, we used a Custom IOA Rule Group to prevent the\nthreat actor from leveraging the IT management tool to deploy their malicious code. Once the\nrule was set up, the detections stopped — crisis averted.\n\n## Response Summary and Lessons Learned\n\nSpeed was a critical element to stopping this intrusion. The malicious activity was blocked by\nthe Falcon sensor, and within the first 15 minutes, we had investigated, started remediation\nand gained a deep understanding of the event: A remote management application was\ncompromised by a threat actor that was trying to deploy REvil ransomware Within 25\n\n\n-----\n\nminutes, we were able to establish a bridge call with the customer, clearly communicate the\nissue, and advise that the threat originated from compromised admin accounts for remote\ncontrol software. Within 40 minutes, we observed that the threat actor had shifted techniques\nand made a new attempt to deploy REvil. Approximately two hours into the response, we\nwere given approval to disable the IT management tool using Falcon.\n\nKey lessons learned from this intrusion include:\n\n1. IT administration tools continue to be used by threat actors to achieve their actions on\n\nobjectives, which in this example included attempted ransomware deployment. The\nmove to cloud-based services can significantly increase the risk of compromise, unless\nappropriate security controls are implemented. The Falcon Complete team sees this\nrecurring pattern, where trusted — but improperly hardened — applications are\nmisused by threat actors. As the example shows, once a threat actor gains control of\none of these cloud-based administration tools, they can easily deploy whatever\nsoftware they desire. The below picture shows one of these cloud-based management\ntools — it’s user-friendly and has a button that allows the user to easily run commands\nacross all managed devices. MFA is essential for protecting cloud services like this,\nand additional controls like IP restrictions and geolocation blocking would be ideal.\n\n\n-----\n\n1. Legitimate IT administration tools will often require exclusions and allowlisting from\n\nsecurity technologies. For example, network connections to trusted sites will often be\nexcluded from SSL inspection, and folder directories for execution will often be\nexcluded or allow listed in legacy endpoint security tools. Because the Falcon platform\ntakes a different and more holistic approach to protecting the endpoint, it does not\nsuffer from these same weaknesses. Without the right tooling, these attacks can easily\nbe missed until it’s too late.\n2. Sophisticated and motivated adversaries will always try to circumvent security\n\nprevention capabilities — that’s why you need a dedicated and elite 24/7/365 threat\nhunting and managed service team to continuously hunt for new intrusions on security\ndata streamed real-time into our cloud from Falcon agents. This allows us to stop the\nthreats for you, so you can focus on what is important to your business.\n\nThe Falcon Complete service provides a unique managed security service that really is an\nindustry leader. We monitor and respond to all detections 24/7, usually within minutes, and\nwe have the expert OverWatch team hunting 24/7 for undiscovered and previously unknown\nthreats. If you are worried about the threat of ransomware, reach out to us and we can chat\nabout how we can help.\n\n**Additional Resources**\n\n\n-----\n\n_Read more about ransomware adversaries tracked by CrowdStrike Intelligence in the_\n_[new CrowdStrike 2021 Global Threat Report.](https://www.crowdstrike.com/resources/reports/global-threat-report/)_\n_Visit the_ _[Falcon Complete webpage to learn more about endpoint protection delivered](https://www.crowdstrike.com/endpoint-security-products/falcon-complete/)_\n_as a service._\n_Learn more about the powerful, cloud-native CrowdStrike Falcon®platform by visiting_\n_the product webpage._\n_[Get a full-featured free trial of CrowdStrike Falcon Prevent™ and learn how true next-](https://go.crowdstrike.com/try-falcon-prevent.html)_\n_gen AV performs against today’s most sophisticated threats._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-20 - Response When Minutes Matter- When Good Tools Are Used for (R)Evil.pdf"
    ],
    "report_names": [
        "2021-05-20 - Response When Minutes Matter- When Good Tools Are Used for (R)Evil.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8610b0d9-a6af-4010-818f-28671efc5d5e",
            "created_at": "2023-01-06T13:46:38.897477Z",
            "updated_at": "2025-03-27T02:00:02.945669Z",
            "deleted_at": null,
            "main_name": "PINCHY SPIDER",
            "aliases": [],
            "source_name": "MISPGALAXY:PINCHY SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c84bbd2e-003d-4c43-8a46-d777455db2c7",
            "created_at": "2022-10-25T15:50:23.701006Z",
            "updated_at": "2025-03-27T02:00:55.527357Z",
            "deleted_at": null,
            "main_name": "GOLD SOUTHFIELD",
            "aliases": [
                "GOLD SOUTHFIELD",
                "Pinchy Spider"
            ],
            "source_name": "MITRE:GOLD SOUTHFIELD",
            "tools": [
                "ConnectWise",
                "REvil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9df68733-9bcd-43b1-88f1-24b110fa3d56",
            "created_at": "2022-10-25T16:07:24.051993Z",
            "updated_at": "2025-03-27T02:02:10.091553Z",
            "deleted_at": null,
            "main_name": "Pinchy Spider",
            "aliases": [
                "Gold Garden",
                "Gold Southfield",
                "Pinchy Spider"
            ],
            "source_name": "ETDA:Pinchy Spider",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "GandCrab",
                "GrandCrab",
                "REvil",
                "Sodin",
                "Sodinokibi",
                "VIDAR",
                "Vidar Stealer",
                "certutil",
                "certutil.exe",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536240,
    "ts_updated_at": 1743041759,
    "ts_creation_date": 1653700774,
    "ts_modification_date": 1653700774,
    "files": {
        "pdf": "https://archive.orkl.eu/0cc4698f5964b2f21ffa5de6264e4b5823dbdcee.pdf",
        "text": "https://archive.orkl.eu/0cc4698f5964b2f21ffa5de6264e4b5823dbdcee.txt",
        "img": "https://archive.orkl.eu/0cc4698f5964b2f21ffa5de6264e4b5823dbdcee.jpg"
    }
}