{
    "id": "27ae0e62-789e-4fd4-9637-fa68ccc27272",
    "created_at": "2023-01-12T15:07:29.608096Z",
    "updated_at": "2025-03-27T02:05:28.646797Z",
    "deleted_at": null,
    "sha1_hash": "2d2cac89f12d5a0713aacaa4c8f1198646c73bb8",
    "title": "2017-03-28 - Threat Spotlight- GhostAdmin Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T21:54:03Z",
    "file_modification_date": "2022-05-28T21:54:03Z",
    "file_size": 1597108,
    "plain_text": "# Threat Spotlight: GhostAdmin Malware\n\n**cylance.com/en_us/blog/threat-spotlight-ghostadmin.html**\n\nThe BlackBerry Cylance Threat Research Team\n\n## Introduction\n\nData breaches are constantly in the news these days, targeting everyone from local\nrestaurants to Fortune 500 companies. User accounts, names, credit card numbers, even\nyour social security number are stored (you hope securely) in databases across the globe by\nnumerous different companies. Your data is stored with your understanding that it will be\nprotected and kept private from those who might abuse it. Unfortunately, time and time\nagain, we discover that’s not always the case.\n\nWith all these breaches in the media, it’s easy to forget that big companies aren’t the only\ntarget. Malware is just as capable of stealing a database on an enterprise server as it is\nstealing a single user’s credentials and data from their personal laptop. You just don’t\ntypically hear about that kind of breach in the news. GhostAdmin 2.0 is a botnet found\nrecently by MalwareHunterTeam (also known as Ghost iBot). It is capable of anything from\nstealing files to gaining full remote access, and all this is done using standard Windows\nlibraries. Since its discovery in mid-January of 2017, new variants have been showing up on\nan almost weekly basis, and all with low conviction ratings by traditional antivirus (AV)\nproducts.\n\n## Code: Keylogging and Screen Capturing\n\nUpon gaining entry, GhostAdmin doesn’t waste any time, immediately starting a new thread\nfor its keystroke logging (Figure 1). In order to store these logs, GhostAdmin attempts to hide\nthem, pretending they are logs for the AV product Symantec Protection. It stores them in a\nfolder created under “C:\\Users\\[current user]\\AppData\\Roaming\\Symantec\\”.\n\n\n-----\n\n-----\n\n-----\n\n_Figure 1: GhostAdmin EntryPoint Getting Down to Business_\n\nThe log is stored in an easily readable HTML file, going as far as recording keystrokes\nspecific to the active window (Figure 2):\n\n\n-----\n\n-----\n\n_Figure 2: GhostAdmin s Usage of HTML for Keystroke Logs_\n\nEach time GhostAdmin runs, it downloads an update for its settings file. This settings file\ncontains all the necessary command and control (C2) information for the client to connect to\nthe newest server. This makes it easy for the server to be migrated regularly, making it easier\nto avoid detection-based AV on IP or URL blacklists. This settings file is base64-encoded\nand easily decodes into a standard format. The malware uses standard coding practices to\nread these settings from the file (Figure 3).\n\nHere is an example of the settings information:\n\n<quotebox>\nFTP Server: accounts-security-settings(dot)com\nFTP User: renard(at)accounts-security-settings.com\nFTP Password: gho$t(at)dmin\nIRC Server: irc.blafasel(dot)de\nIRC Port: 6667\nIRC Channel: #bobby7\nMail Sender: bucketshovel76(at)gmail.com\nMail Recipient: bucketshovel76(at)gmail.com\nMail Password: bigbobby12\nFTP Folder: renard\nScreen Image Timer: 300000000\nLog File Timer: 36000000\nGhostAdmin2.0\n</quotebox>\n\n\n-----\n\n-----\n\n_Figure 3: Straightforward Processing of the Downloaded Settings File_\n\nGhostAdmin then sets a timer for one hour. This triggers an upload of the most recent logs to\nthe FTP server. This transfer is straightforward, with a web client being created and used to\nupload the files (Figure 4). In this case, there is even an error handling step, throwing any\nerrors into the C2 channel:\n\n\n-----\n\n-----\n\n_Figure 4: Simple WebClient Code to Upload Keystroke Logs_\n\nCreating yet another directory, GhostAdmin uses the 'CopyFromScreen' function from\nDrawing.dll to take complete captures of the user’s screen. Each capture is indexed by user\nname and a timestamp and saved as a .jpg. Immediately after the screenshot is taken, the\nfile is uploaded to the FTP server and deleted from the local host. These captures are taken\non regular intervals as determined by the ScreenImageTimer variable in the settings.ini file\nonce it is downloaded. Again, the author outputs any errors to the C2.\n\n## Code: IRC\n\nThe final thread created is for GhostAdmin’s C2 channel and is used to establish an IRC\nchannel. This portion of GhostAdmin accounts for, by far, the largest portion of the code and\nfunctionality. The exact IRC channel and server are derived from the settings.ini file\ndownloaded by the second thread. Then a TcpClient instance connects and sends its logon\nmessages to the C2 and even emails the author with Machine Name, User, IP, and client\nversion (Figure 5).\n\n\n-----\n\n-----\n\n_Figure 5: Email Function to Notify Author That a GhostAdmin Bot is Online_\n\nAfter a quick ‘PING’ – ‘PONG’ to check for life on the IRC server, the client connects to the\nappropriate channel and starts listening for the bot master to send text starting with\n‘PRIVMSG,’ indicating the master is giving a command. This IRC client is kept alive,\nreconnecting every one minute if it fails.\n\nThe list of commands is quite large in GhostAdmin. A full list is at the end of this blog, but for\nnow, here is a high-level overview of the functions and their capabilities.\n\n## Host Information\n\n_GetIP, version, platform, checkfie, checkfolder, drives, tasklist, ipconfig, os, user, idletime._\n\nThese are functions designed to gather basic information about the host the client is running\non, from the IP to currently running processes.\n\n## Data & Audio Exfiltration\n\n_Logfile, readfile, getfiles, uploadfile, screenshot, audio_\nThese functions upload data to either the C2 or the FTP server.\n\n**The function AUDIO is worth noting, as it uses winmm.dll to access the machine’s**\n**default microphone and start recording for the specified amount of time (Figure 6).**\nThis could be troublesome for an enterprise if the machine is kept in a location where\nsensitive information is discussed, for instance, near a corporate boardroom or in an\nexecutive team member’s office. Typical of GhostAdmin, the audio file is immediately\nuploaded to the FTP server and then deleted from the local host.\n\n\n-----\n\n-----\n\n_Figure 6: AUDIO Command from GhostAdmin That Records From Default Microphone_\n\n## Interaction\n\n_Turn(on/off)monitor, visit, download, delete, run, taskkill, kill, copy, enableremoteDesktop,_\n_shutdownWindows, restartWindows, (enable/disable)inputDevices, deleteLogs,_\n_deleteBrowserData, SQL*, Update_\n\nFunctions capable of interacting with the infected host, these give the malicious actor several\noptions for access. This includes browsing or downloading from URLs, killing the client or\nany process (taskkill), and restarting or powering off the host. EnableremoteDesktop modifies\nthe registry value at\n'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server' to allow\nremote desktop connections to the infected host (Figure 7).\n\n\n-----\n\n-----\n\n_Figure 7: GhostAdmin Enables Remote Desktop via Registry Modification_\n\n_DisableInputDevices_\nThis uses the user32.dll function BlockInput to disable both mouse and keyboard interaction\non the local host, essentially removing all control from the User. It is worth noting that in this\nsituation hitting Ctrl+Alt+Delete will override this block. This is a security feature built into\nWindows, and throws a hard system error.\n\n_SQL*_\nThis group of functions allows the malicious actor to manipulate any SQL database that the\ninfected user has access to. It first searches for any databases through\nSystem.data.sqlClient. If found it attempts login with credentials supplied through the IRC\ncommand. Once logged in, the ability to run select, insert, delete, and update are available.\n\n_DeleteBrowserData_\nThis iterates through the 5 most common browsers, and deletes all session and user data\n(Figure 8). This is likely to force the user to log back into all their accounts, allowing\nGhostAdmin to capture as many of their credentials as possible.\n\n\n-----\n\n-----\n\n_Figure 8: GhostAdmin Can Delete Browser Data From Five Major Browsers_\n\n## GhostAdmin: Incomplete\n\nAs it turns out, this appears to not be the final version of GhostAdmin, as there are a few\nfunctions that are marked as “coming soon” (Figure 9).\n\n\n-----\n\n-----\n\n_Figure 9: Apparently, GhostAdmin Even Has a Roadmap For Features!_\n\n## Conclusion\n\n**GhostAdmin contains all the necessary functionality to gain complete control over a**\n**victim’s computer. It is just as capable of capturing credentials from a single web browser**\nform as it is modifying or downloading a large database.\n\nWith new variants being released with some frequency, and an incomplete codebase,\nGhostAdmin shows that it doesn’t take complex malware to be effective. While we have been\nunable to find a live C2 to analyze, MalwareHunterTeam indicates that even with its small\npresence, [hundreds of GBs of data have been stolen from both personal and corporate](https://twitter.com/malwrhunterteam/status/822525690108968961)\nmachines. We can assume that as this malware matures, variants will become both harder to\ndetect and sent in even bigger deployments.\n\n_[If you use our endpoint protection product, CylancePROTECT®, you were](https://www.cylance.com/en_us/products/our-products/protect.html)_ _[already protected](https://www.cylance.com/en_us/blog/cylance-vs-ghostadmin.html)_\n_from this attack. If you don't have CylancePROTECT,_ _[contact us to learn how our AI based](https://www.cylance.com/en_us/contact-us.html)_\n_solution can predict and prevent unknown and emerging threats._\n\n## List of IRC Commands\n\nComplete list of commands client is capable of. This list is an exact copy of the array defined\nin the GhostAdmin code.\n\n\n-----\n\n-----\n\n_Figure 10: Command List Helpfully Provided in the Decompiled Version of GhostAdmin_\n\n## Indicators of Compromise\n\n**Configuration/Setting Files:**\n\nde60046e23435edf47ddc1cf1dd0fcb64b706e066d289b64855a38551ab3c4fe\n\n**Decoded:**\n\nFTP Server: secured-apps(dot)com\n\nFTP User: ghostadmin(at)secured-apps.com\n\nFTP Password: Z0di(at)c876\n\nIRC Server: irc.synirc(dot)net\n\nIRC Port = 6667\n\nIRC Channel = #ghostadmin\n\nMail Sender: zodiacbot(at)gmail.com\n\nMail Recipient: zodiacbot(at)gmail.com\n\nMail Password: gho$t(at)dmin\n\nf32c4a1ef662475840dd234249741b761be8d5a4eaaedc5c6d677f6e53d3a047\n\n**Decoded:**\n\nFTP Server: accounts-security-settings(dot)com\n\nFTP User: renard(at)accounts-security-settings.com\n\nFTP Password: gho$t(at)dmin\n\nIRC Server: irc.blafasel(dot)de\n\nIRC Port: 6667\n\nIRC Channel: #bobby7\n\nMail Sender: bucketshovel76(at)gmail.com\n\nMail Recipient: bucketshovel76(at)gmail.com\n\nMail Password: bigbobby12\n\nFTP Folder: renard\n\nScreen Image Timer: 300000000\n\nLog File Timer: 36000000\n\nGhostAdmin2.0\n\n**SHA-256 Hashes:**\n\na50d3218f4a6b7c89d3e8df3463ac3a4704d92acee57cfe8d79200ad0c887aa9\n\n91374f78d11bdb0683f8145ef38645b4c1a5278d89fc07c5d8e94474c079b36f\n\ndbe19b22364e17002fa43626fa04ef5d1b4938db84eae1c71c1f6c296b0ef560\n\n5106d31eeb4e93e6c44d4637fee1a1e5c12c88ddacf668c58828184756bd78eb\n\n834861a92c0fce4ee5bfe0a3b7000dff41f13ae4dab4d4d19a71686f531d98bd\n\naf5725e808cc08c3b1b179fbc62c58c1d96ea6ceffa58cf2f498a32c56faa4a6\n\n286701f6a7451d40b40bd05da0ef4d2f209e5e518b5a4ba4c119ab4bb788736c\n\n3c9c2d1fe1b3fa6397c4440575086232cff61ed98b7cb82edf35773d4f253423\n\n\n-----\n\nb46b2e67b86ff7fcd393984dfad5a23cf5442632abff26bc98f63f814678e428\nbf0268523d3f0e50363eddde4ac593718e4ae893fc045afd2876253f5dc0b6e3\n99c260ab07f31eff33c4b87d69c0bfc969f771bb8186dcbb4ac04473f42cf492\ndb5fc23fbd00449d8dafdee61760ea100651569e405b39c41eb0ec61acfb917b\nfa6e3fcbb4d828a2de5375cdc706e6cf57f40f3aaa8c4a80d2ea19700bd63d37\n36e0537e0d59016434085c8559c78e028a4022ebaf1c537c375c4687f66b47af\nde60bfc9f1dcbaba111b87a707779fee4703ddfaa15ba4eb2e7df0520c403a46\nbce2b4f0c8b9cefd5016a716ae2c47602855d68f686164b19b7c7f70d9ec8649\n9af69d2d44640d568feaa3340acd84cd9baed19117e20d2f0a35f4f445086097\n89f8cfb7e4db39d055c4264639325064a1d50c11ef8738e085a55f30a5f6b7bf\n\nThe BlackBerry Cylance Threat Research Team\n\n## About The BlackBerry Cylance Threat Research Team\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware\nto better identify its abilities, function and attack vectors. Threat Research is on the frontline\nof information security and often deeply examines malicious software, which puts us in a\nunique position to discuss never-seen-before threats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-03-28 - Threat Spotlight- GhostAdmin Malware.pdf"
    ],
    "report_names": [
        "2017-03-28 - Threat Spotlight- GhostAdmin Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536049,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1653774843,
    "ts_modification_date": 1653774843,
    "files": {
        "pdf": "https://archive.orkl.eu/2d2cac89f12d5a0713aacaa4c8f1198646c73bb8.pdf",
        "text": "https://archive.orkl.eu/2d2cac89f12d5a0713aacaa4c8f1198646c73bb8.txt",
        "img": "https://archive.orkl.eu/2d2cac89f12d5a0713aacaa4c8f1198646c73bb8.jpg"
    }
}