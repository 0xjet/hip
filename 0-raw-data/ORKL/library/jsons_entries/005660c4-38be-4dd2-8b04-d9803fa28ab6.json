{
    "id": "005660c4-38be-4dd2-8b04-d9803fa28ab6",
    "created_at": "2023-01-12T15:03:03.093902Z",
    "updated_at": "2025-03-27T02:08:00.248631Z",
    "deleted_at": null,
    "sha1_hash": "9ca28093efaac9dcae711b33487b7205c9c011d7",
    "title": "2019-06-05 - Government Sector in Central Asia Targeted With New HAWKBALL Backdoor Delivered via Microsoft Office Vulnerabilities",
    "authors": "",
    "file_creation_date": "2022-05-28T17:30:09Z",
    "file_modification_date": "2022-05-28T17:30:09Z",
    "file_size": 1023424,
    "plain_text": "# Government Sector in Central Asia Targeted With New HAWKBALL Backdoor Delivered via Microsoft Office Vulnerabilities\n\n**[fireeye.com/blog/threat-research/2019/06/government-in-central-asia-targeted-with-hawkball-backdoor.html](https://www.fireeye.com/blog/threat-research/2019/06/government-in-central-asia-targeted-with-hawkball-backdoor.html)**\n\nFireEye Labs recently observed an attack against the government sector in Central Asia. The attack\ninvolved the new HAWKBALL backdoor being delivered via well-known Microsoft Office vulnerabilities CVE2017-11882 and CVE-2018-0802.\n\nHAWKBALL is a backdoor that attackers can use to collect information from the victim, as well as to deliver\npayloads. HAWKBALL is capable of surveying the host, creating a named pipe to execute native Windows\ncommands, terminating processes, creating, deleting and uploading files, searching for files, and\nenumerating drives.\n\nFigure 1 shows the decoy used in the attack.\n\n\n-----\n\nFigure 1: Decoy used in attack\n\nThe decoy file, doc.rtf (MD5: AC0EAC22CE12EAC9EE15CA03646ED70C), contains an OLE object that\nuses Equation Editor to drop the embedded shellcode in %TEMP% with the name 8.t. This shellcode is\ndecrypted in memory through EQENDT32.EXE. Figure 2 shows the decryption mechanism used in\nEQENDT32.EXE.\n\n\n-----\n\nFigure 2: Shellcode decryption routine\n\nThe decrypted shellcode is dropped as a Microsoft Word plugin WLL (MD5:\nD90E45FBF11B5BBDCA945B24D155A4B2) into\nC:\\Users\\ADMINI~1\\AppData\\Roaming\\Microsoft\\Word\\STARTUP (Figure 3).\n\nFigure 3: Payload dropped as Word plugin\n\n**Technical Details**\n\nDllMain of the dropped payload determines if the string WORD.EXE is present in the sample’s command\nline. If the string is not present, the malware exits. If the string is present, the malware executes the\ncommand RunDll32.exe <\nC:\\Users\\ADMINI~1\\AppData\\Roaming\\Microsoft\\Word\\STARTUP\\hh14980443.wll, DllEntry> using the\nWinExec() function.\n\nDllEntry is the payload’s only export function. The malware creates a log file in %TEMP% with the name\nc3E57B.tmp. The malware writes the current local time plus two hardcoded values every time in the\nfollowing format:\n\n<Month int>/<Date int> <Hours>:<Minutes>:<Seconds>\\t<Hardcoded Digit>\\t<Hardcoded Digit>\\n\n\n\n-----\n\nExample:\n\n05/22 07:29:17 4     0\n\nThis log file is written to every 15 seconds. The last two digits are hard coded and passed as parameters to\nthe function (Figure 4).\n\nFigure 4: String format for log file\n\nThe encrypted file contains a config file of 0x78 bytes. The data is decrypted with an 0xD9 XOR operation.\nThe decrypted data contains command and control (C2) information as well as a mutex string used during\nmalware initialization. Figure 5 shows the decryption routine and decrypted config file.\n\nFigure 5: Config decryption routine\n\nThe IP address from the config file is written to %TEMP%/3E57B.tmp with the current local time. For\nexample:\n\n05/22 07:49:48 149.28.182.78.\n\n**Mutex Creation**\n\n\n-----\n\nThe malware creates a mutex to prevent multiple instances of execution. Before naming the mutex, the\nmalware determines whether it is running as a system profile (Figure 6). To verify that the malware resolves\nthe environment variable for %APPDATA%, it checks for the string config/systemprofile.\n\nFigure 6: Verify whether malware is running as a system profile\n\nIf the malware is running as a system profile, the string d0c from the decrypted config file is used to create\nthe mutex. Otherwise, the string _cu is appended to d0c and the mutex is named d0c_cu (Figure 7).\n\nFigure 7: Mutex creation\n\nAfter the mutex is created, the malware writes another entry in the logfile in %TEMP% with the values 32\nand 0.\n\n**Network Communication**\n\nHAWKBALL is a backdoor that communicates to a single hard-coded C2 server using HTTP. The C2 server\nis obtained from the decrypted config file, as shown in Figure 5. The network request is formed with hardcoded values such as User-Agent. The malware also sets the other fields of request headers such as:\n\nContent-Length: <content_length>\nCache-Control: no-cache\nConnection: close\n\n\n-----\n\nThe malware sends an HTTP GET request to its C2 IP address using HTTP over port 443. Figure 8 shows\nthe GET request sent over the network.\n\nFigure 8: Network request\n\nThe network request is formed with four parameters in the format shown in Figure 9.\n\n**Format = \"?t=%d&&s=%d&&p=%s&&k=%d\"**\n\nFigure 9: GET request parameters formation\n\nTable 1 shows the GET request parameters.\n\n**Value** **Information**\n\nT Initially set to 0\n\nS Initially set to 0\n\nP String from decrypted config at 0x68\n\nk The result of GetTickCount()\n\n\n-----\n\nTable 1: GET request parameters\n\nIf the returned response is 200, then the malware sends another GET request (Figure 10) with the following\nparameters (Figure 11).\n\n**Format = \"?e=%d&&t=%d&&k=%d\"**\n\nFigure 10: Second GET request\n\nFigure 11: Second GET request parameters formation\n\nTable 2 shows information about the parameters.\n\n**Value** **Information**\n\nE Initially Set to 0\n\nT Initially set to 0\n\nK The result of GetTickCount()\n\nTable 2: Second GET request parameters\n\nIf the returned response is 200, the malware examines the Set-Cookie field. This field provides the\nCommand ID. As shown in Figure 10, the field Set-Cookie responds with ID=17.\n\nThis Command ID acts as the index into a function table created by the malware. Figure 12 shows the\ncreation of the virtual function table that will perform the backdoor’s command.\n\n\n-----\n\nFigure 12: Function table\n\nTable 3 shows the commands supported by HAWKBALL.\n\n**Command** **Operation Performed**\n\n0 Set URI query string to value\n\n16 Unknown\n\n17 Collect system information\n\n18 Execute a provided argument using CreateProcess\n\n19 Execute a provided argument using CreateProcess and upload output\n\n20 Create a cmd.exe reverse shell, execute a command, and upload output\n\n21 Shut down reverse shell\n\n22 Unknown\n\n23 Shut down reverse shell\n\n48 Download file\n\n64 Get drive geometry and free space for logical drives C-Z\n\n65 Retrieve information about provided directory\n\n\n-----\n\n66 Delete file\n\n67 Move file\n\nTable 3: HAWKBALL commands\n\n**Collect System Information**\n\nCommand ID 17 indexes to a function that collects the system information and sends it to the C2 server.\nThe system information includes:\n\nComputer Name\nUser Name\nIP Address\nActive Code Page\nOEM Page\nOS Version\nArchitecture Details (x32/x64)\nString at 0x68 offset from decrypted config file\n\nThis information is retrieved from the victim using the following WINAPI calls:\n\n**Format = \"%s;%s;%s;%d;%d;%s;%s %dbit\"**\n\nGetComputerNameA\nGetUserNameA\nGethostbyname and inet_ntoa\nGetACP\nGetOEMPC\nGetCurrentProcess and IsWow64Process\n\nFigure 13: System information\n\nThe collected system information is concatenated together with a semicolon separating each field:\n\nWIN732BIT-L-0;Administrator;10.128.62.115;1252;437;d0c;Windows 7 32bit\n\n\n-----\n\nThis information is encrypted using an XOR operation. The response from the second GET request is used\nas the encryption key. As shown in Figure 10, the second GET request responds with a 4-byte XOR key. In\nthis case the key is 0xE5044C18.\n\nOnce encrypted, the system information is sent in the body of an HTTP POST. Figure 14 shows data sent\nover the network with the POST request.\n\nFigure 14: POST request\n\nIn the request header, the field Cookie isset with the command ID of the command for which the response\nis sent. As shown in Figure 14, the Cookie field is set with ID=17, which is the response for the previous\ncommand. In the received response, the next command is returned in field Set-Cookie.\n\nTable 4 shows the parameters of this POST request.\n\n**Parameter** **Information**\n\nE Initially set to 0\n\nT Decimal form of the little-endian XOR key\n\nK The result of GetTickCount()\n\nTable 4: POST request parameters\n\nCreate Process\n\nThe malware creates a process with specified arguments. Figure 15 shows the operation.\n\n\n-----\n\nFigure 15: Command create process\n\nDelete File\n\nThe malware deletes the file specified as an argument. Figure 16 show the operation.\n\nFigure 16: Delete file operation\n\nGet Directory Information\n\nThe malware gets information for the provided directory address using the following WINAPI calls:\n\nFindFirstFileW\nFindNextFileW\nFileTimeToLocalFileTime\nFiletimeToSystemTime\n\nFigure 17 shows the API used for collecting information.\n\nFigure 17: Get directory information\n\n\n-----\n\nGet Disk Information\n\nThis command retrieves the drive information for drives C through Z along with available disk space for\neach drive.\n\nFigure 18: Retrieve drive information\n\nThe information is stored in the following format for each drive:\n\n**Format = \"%d+%d+%d+%d;\"**\n\nExample: \"8+512+6460870+16751103;\"\n\nThe information for all the available drives is combined and sent to the server using an operation similar to\nFigure 14.\n\n**Anti-Debugging Tricks**\n\nDebugger Detection With PEB\n\nThe malware queries the value for the flag BeingDebugged from PEB to check whether the process is\nbeing debugged.\n\nFigure 19: Retrieve value from PEB\n\nNtQueryInformationProcess\n\nThe malware uses the NtQueryInformationProcess API to detect if it is being debugged. The following flags\nare used:\n\nPassing value 0x7 to ProcessInformationClass:\n\n\n-----\n\nFigure 20: ProcessDebugPort verification\n\nPassing value 0x1E to ProcessInformationClass:\n\nFigure 21: ProcessDebugFlags verification\n\nPassing value 0x1F to ProcessInformationClass:\n\nFigure 22: ProcessDebugObject\n\n**Conclusion**\n\nHAWKBALL is a new backdoor that provides features attackers can use to collect information from a victim\nand deliver new payloads to the target. At the time of writing, the FireEye Multi-Vector Execution (MVX)\nengine is able to recognize and block this threat. We advise that all industries remain on alert, though,\nbecause the threat actors involved in this campaign may eventually broaden the scope of their current\ntargeting.\n\n**Indicators of Compromise (IOC)**\n\n**MD5** **Name**\n\nAC0EAC22CE12EAC9EE15CA03646ED70C Doc.rtf\n\n\n-----\n\nD90E45FBF11B5BBDCA945B24D155A4B2 hh14980443.wll\n\n**Network Indicators**\n\n149.28.182[.]78:443\n149.28.182[.]78:80\nhttp://149.28.182[.]78/?t=0&&s=0&&p=wGH^69&&k=<tick_count>\nhttp://149.28.182[.]78/?e=0&&t=0&&k=<tick_count>\nhttp://149.28.182[.]78/?e=0&&t=<int_xor_key>&&k=<tick_count>\nMozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET\nCLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.2)\n\n**FireEye Detections**\n\n**MD5** **Product** **Signature** **Action**\n\n\nAC0EAC22CE12EAC9EE15CA03646ED70C FireEye\nEmail\nSecurity\n\nFireEye\nNetwork\nSecurity\n\nFireEye\nEndpoint\nSecurity\n\nD90E45FBF11B5BBDCA945B24D155A4B2 FireEye\nEmail\nSecurity\n\nFireEye\nNetwork\nSecurity\n\nFireEye\nEndpoint\nSecurity\n\n**Acknowledgement**\n\n\nFE_Exploit_RTF_EQGEN_7\n\nExploit.Generic.MVX\n\nMalware.Binary.Dll\n\nFE_APT_Backdoor_Win32_HawkBall_1\n\nAPT.Backdoor.Win.HawkBall\n\n\nBlock\n\nBlock\n\n\nThank you to Matt Williams for providing reverse engineering support.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-06-05 - Government Sector in Central Asia Targeted With New HAWKBALL Backdoor Delivered via Microsoft Office Vulnerabilities.pdf"
    ],
    "report_names": [
        "2019-06-05 - Government Sector in Central Asia Targeted With New HAWKBALL Backdoor Delivered via Microsoft Office Vulnerabilities.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535783,
    "ts_updated_at": 1743041280,
    "ts_creation_date": 1653759009,
    "ts_modification_date": 1653759009,
    "files": {
        "pdf": "https://archive.orkl.eu/9ca28093efaac9dcae711b33487b7205c9c011d7.pdf",
        "text": "https://archive.orkl.eu/9ca28093efaac9dcae711b33487b7205c9c011d7.txt",
        "img": "https://archive.orkl.eu/9ca28093efaac9dcae711b33487b7205c9c011d7.jpg"
    }
}