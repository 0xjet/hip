{
    "id": "b2a30eb1-2adb-4bf4-b889-50a43849661a",
    "created_at": "2023-01-12T15:10:20.179947Z",
    "updated_at": "2025-03-27T02:10:07.698175Z",
    "deleted_at": null,
    "sha1_hash": "67a90fbb77af2f0d8ce61b873d562f779a3bf19e",
    "title": "2022-01-24 - DTPacker – a .NET Packer with a Curious Password",
    "authors": "",
    "file_creation_date": "2022-05-28T17:45:56Z",
    "file_modification_date": "2022-05-28T17:45:56Z",
    "file_size": 9330930,
    "plain_text": "# DTPacker – a .NET Packer with a Curious Password\n\n**[proofpoint.com/us/blog/threat-insight/dtpacker-net-packer-curious-password-1](https://www.proofpoint.com/us/blog/threat-insight/dtpacker-net-packer-curious-password-1)**\n\n\nJanuary 21, 2022\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nDTPacker – a .NET Packer with a Curious Password\n\n\n-----\n\nJanuary 24, 2022 Proofpoint Staff\n\n## Key Findings\n\nProofpoint identified a malware packer which researchers have dubbed DTPacker.\nThe payload decoding uses a fixed password containing former U.S. president Donald Trump’s name.\nFor several weeks the downloader variant used Liverpool Football Club themed download locations.\nThe malware is typically used to pack remote access trojans that can be used to steal information and load\nfollow-on payloads such as ransomware.\n\n## Overview\n\n[In a previous blog Commodity .NET Packers use Embedded Images to Hide Payloads, we described the \"CyaX\" and](https://www.proofpoint.com/us/blog/threat-insight/commodity-net-packers-use-embedded-images-hide-payloads)\n\"Hectobmp\" families of .NET packers.\n\nIn this blog, we describe a two-stage commodity .NET packer or downloader which although seeing considerable\nvariety in the first stage, uses a second stage with a fixed password as part of the decoding. The main difference\nbetween a packer and a downloader is the location of the payload data which is embedded in the former and\ndownloaded in the latter. DTPacker uses both forms. It is unusual for a piece of malware to be both a packer and\ndownloader.\n\nProofpoint has observed DTPacker distributing multiple remote access trojans (RATs) and information stealers\nincluding Agent Tesla, Ave Maria, AsyncRAT, and FormBook. The malware uses multiple obfuscation techniques to\nevade antivirus, sandboxing, and analysis. It is likely distributed on underground forums. Proofpoint has observed\nDTPacker associated with dozens of campaigns and multiple threat actors including TA2536 and TA2715 since 2020.\nProofpoint has observed DTPacker used by both advanced persistent threat (APT) and cybercrime threat actors.\nIdentified campaigns included thousands of messages and impacted hundreds of customers in multiple industries.\n\n## Attack Path Example\n\nIn many observed campaigns, email is used as an initial infection vector. The attachment is typically a malicious\ndocument or compressed executable that, when interacted with by a user, downloads the packer executable. The\nmalware decodes an embedded or downloaded resource to a DLL which contains the malware payload, and then\nexecutes the malware.\n\n\n-----\n\nFigure 1: DTPacker attack path example.\n\n## Custom XOR Decoding\n\nProofpoint observed multiple decoding methods and two Donald Trump-themed fixed keys, thus the name\n“DT”Packer. Many packers and loaders are built in two stages of functionality. Earlier versions of DTPacker used a\ncustom XOR routine to decode the malicious content in both stages. The first stage of DTPacker decodes an\nembedded or downloaded resource to an intermediate stage (usually a DLL), then the second stage extracts and\nexecutes the payload from that DLL.\n\nThe custom XOR routine, in addition to XORing with the key, subtracts the next data value and is implemented in this\nPython script (on Github) [decoder-xor-sub.py.](https://raw.githubusercontent.com/EmergingThreats/threatresearch/master/dtpacker/decoder-xor-sub.py)\n\nFor a Windows Portable Executable, there are significant sequences of null bytes, and consequently, XORing the\nciphertext with itself shifted by 1 byte reveals the key at locations corresponding to those null bytes.\n\nFor example, in this sample (SHA256\n\n512b2f1f4b659930900abcc8f51d175e88c81b0641b7450a6618b77848fa3b40):\n\nThe intermediate stage is stored in a .NET resource encoded with the custom XOR routine and key \"P\" (in ASCII not\nUnicode UTF-16 this time).\n\nThe .NET resource XORed with itself shifted by one byte reveals the password \"P\":\n\n\n-----\n\nDecoding with key \"P\" gives the second stage executable:\n\nThe second stage contains a .NET resource (named \"00112266\"):\n\nXORed with itself shifted by one byte gives:\n\nwhich gives a key of \"trump2020\" in Unicode UTF-16. The threat actors used this key consistently for a year and is\nthe reason for the packer’s name.\n\nDecoding with the “trump2020” key gives the final payload:\n\n\n-----\n\nIn this case, the payload was Agent Tesla, a common information stealer.\n\n## Varied First Stage Encoding\n\nIn this downloader sample (SHA256\n\n9d713d2254e529286ed3ac471e134169d2c7279b0eaf82eb9923cd46954d5d27) the Download URLs are stored as\nstrings obfuscated with junk Unicode characters\n\nIn this case, the decompiled code looks like:\n\nand removing the Unicode characters gives:\n\nThe downloads are glued together and contain base64-encoded strings:\n\nThese decode to:\n\n\n-----\n\nwhich after XORing with byte 0x02 gives:\n\nThis is a second stage executable containing a \"00112266\" resource encoded with the \"trump2020\" key as before,\nwhich then decodes to Agent Tesla.\n\n## Decimal Character Codes\n\nOne recurrent theme in this family of packers is the use of decimal character codes with digits substituted with other\ncharacters.\n\nFor example, this sample (SHA256\n\n285f4e79ae946ef179e45319caf11bf0c1cdaa376924b83bfbf82ed39361911b) is a packer with the second stage\nembedded in the .NET Strings table:\n\nwhich are comma-separated decimal ASCII character codes with digits 0-9 replaced by \"!@#$%[X]&*()\" where \"[X]\"\nrepresents Unicode character 0x8ac2; reversing this gives us:\n\nThis decodes to an intermediate PE containing the \"00112266\" resource with key \"trump2020\" which decodes to Ave\nMaria, also known as Warzone RAT.\n\nThis sample (SHA256\n\n1312912d725d45bcd1b63922ec9a84abca7a8c9c669c13efbd03472c764be056 is similar to the above, but with the\nsecond stage stored in the User Strings table:\n\n\n-----\n\nwith digits 0 9 replaced by zxcasdwqru (partially matching the first three letters on rows of a QWERTY keyboard).\nThis decodes to AsyncRAT.\n\nAnother sample (SHA256\n\nba0f9be7cf006404bcfab6b6adbad0cef7281c3792490903632a4010d8a74f42) is a loader with download string\nobfuscated in a similar way to Sample 1, which deobfuscates to (defanged):\n\nhxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=E2E813E9694BE43CAD964C0453632F91@@@hxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=63DC49E5D8F5F50F8838551347009928@@@hxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=D13B96F0619AC39B44A32D3E0A260C89@@@hxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=85530E49BB23CD9DBD8461A2FC5D18A2\n\nThe downloads are obfuscated in a similar in the above samples, with digits 0-9 replaced by the letters A-J:\n\nThe download decodes to the usual second stage which in turn decodes to Agent Tesla.\n\n## String Obfuscation using Large Character Code Offsets\n\nThis sample (SHA256 5d555eddfc23183dd821432fd2a4a04a543c8c1907b636440eb6e7d21829576c) is a loader\nwith strings obfuscated as Unicode strings followed by an integer to subtract from their character codes, e.g.\n\nwhich decodes to:\n\nThe downloads are again ASCII character codes with digits 0-9 replaced by the letters \"PxfnVCKsAi\".\n\nThis time, however, there is no intermediate step with the custom XOR routine and \"trump2020\" key, and the payload\nis Agent Tesla.\n\n## Soccer Club-Themed Payload Locations\n\n\n-----\n\nFrom March 2021, Proofpoint observed samples using websites for soccer clubs and their fans being used as\ndownload locations. These websites appear to have been decoys, with the actual payload locations embedded in the\nlist.\n\nFor example, in this sample (SHA256\nb53558a85b8bb10ce70cb0592a81e540683d459b9d8666b7927c105f1141a189), decompiled code looks like:\n\nwhich when deobfuscated is:\n\nThe payload was Snake Keylogger in this case.\n\nLater samples used Liverpool Football Club-themed download locations.\n\n\n-----\n\nIn this sample (SHA256\n\n9cc817f0205da4bde1d938e1817aa98fe4f4a5dcbcaffbe8b45041e24c105aa0), the download locations are\nobfuscated with junk Unicode sequences and string assembly:\n\nwhich after removing the non-ASCII characters is:\n\nleading to download locations (defanged):\n\nhxxp://liverpoolofcfanclub[.]com/liverpool-fc-news/features/steven-gerrard-liverpool-future-dalglish--goal1FE8F2E05D5035C0446552639B8336B8.html\n\nhxxp://liverpoolofcfanclub[.]com/liverpool-fc-news/features/steven-gerrard-liverpool-future-dalglish--goalEC7D4835EC6F56BD999A943FEDF8D489.html\n\nhxxp://liverpoolofcfanclub[.]com/liverpool-fc-news/features/steven-gerrard-liverpool-future-dalglish--goalDE7C2CE9F7D38544A851414C40C46A3F.html\n\nwhich amidst innocent-looking pages that appear to be taken from liverpool.com, includes the next stage as ASCIIcharacter codes with digits 0-9 replaced by \"GIucvPNTOs\":\n\nFinally, the usual \"00112266\" resource, encoded with the \"trump2020\" key, has the final payload, Agent Tesla.\n\nLater samples varied the domain name but kept very similar paths and the same innocent-looking page.\n\n\n-----\n\nFigure: DTPacker used Liverpool FC themed download locations for the final payload. The sites masqueraded as\nlegitimate Liverpool FC and fan-related websites.\n\n## String Obfuscation using Obfuscated Character Code Arrays\n\nThis sample (SHA256 281cdbf590c22cd684700dcde609d6be48ddf3e4d988d48e65d9c688ce76f7af) uses\nobfuscated .NET code to store important strings as arrays of ASCII character codes:\n\n[0] : qHWXhtvYuc\n\n[1] : Append\n\n[2] : hxxp://mmwrlridbhmibnr[.]ml/liverpool-fc-news/features/steven-gerrard-liverpool-future-dalglish--goal40505C0917C3E190B486745F4941F177.html\n\n[3] : <meta name=\"keywords\" content=\"([\\w\\d ]*)\">\n\n[4] : UserAgent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106\nSafari/537.36 OPR/38.0.2220.41\n\n[5] : GetType\n\n[6] : Assembly\n\n[7] : ToArray\n\n[8] : Load\n\n[9] : EntryPoint\n\n[10] : Invoke\n\n[11] : LoginForm\n\nFor the URL string we have (when decompiled in ILSpy):\n\n\n-----\n\nIn each block of four assignments, the first three are junk and overwritten by the next.\n\nThis appears to be done in the underlying MSIL (intermediate language) code:\n\n\n-----\n\nThe obfuscating instructions are not actually in the shortest form as would be expected from a normal compiler. E.g.\n\n(05) 2000000000 : ldc.i4 0x0\n\ncould have been achieved with\n\n(01) 16 : ldc.i4.0\n\nas it is in the instruction performing the final assignment.\n\nThe final payload in this case was Agent Tesla.\n\nThis Python script (on Github) [decoder-dup-array-strings.py will output deobfuscated strings from a .NET binary](https://raw.githubusercontent.com/EmergingThreats/threatresearch/master/dtpacker/decoder-dup-array-strings.py)\nusing this technique.\n\n## “Trump2026” Variant with Straight XOR\n\nBeginning in August 2021, Proofpoint observed samples where the second stage is no longer using the custom XOR\nroutine and fixed key \"trump2020\", but instead is using straight XOR with fixed ASCII key \"Trump2026\".\n\nIn this sample (SHA256 a564eb282800ed662b1c55ae65fbba86b6feca00a2e15ebb36a61fc53ac47c3a), the\nintermediate stage is stored as ASCII character codes in the \"Strings\" table:\n\nThe payload is stored from offset 0x250 in the intermediate stage:\n\n\n-----\n\nwhich, after XORing with key \"Trump2026\" gives:\n\nThis payload was Agent Tesla.\n\nThis sample (SHA256 affea9c276ded88eea1e39ac39fb19373c4b62d4251fb1d06f37a05e35dfa463), is a downloader\nwith the download URLs stored in the clear in User Strings (defanged):\n\nhxxps://cdn.discordapp[.]com/attachments/893177342426509335/897124528768032848/9722D04C.jpg\n\nhxxps://cdn.discordapp[.]com/attachments/893177342426509335/897124531213336656/F526E587.jpg\n\nThe downloads are ASCII character codes:\n\nwhich when glued together and decoded give the intermediate stage containing:\n\nWhen decoded with XOR key \"Trump2026,\" the final payload is FormBook.\n\n## CyaX Packer using Same Modified XOR Routine\n\n[From November 2021, Proofpoint observed CyaX-packer using a very similar second stage to that of DTPacker with](https://www.proofpoint.com/us/blog/threat-insight/commodity-net-packers-use-embedded-images-hide-payloads)\nthe \"trump2020\" key.\n\n\n-----\n\nThis time, however, the keys are randomly generated, ASCII, mixed case alphabetic, and 8 14 characters long,\nrather than UTF-16-encoded \"trump2020\".\n\nIn this sample (SHA2564053206d66d627d145d9da8d8e208d08c85755036a5393ccc6e8afd6117df864), the\nintermediate stage contains a .NET resource file \"18Ocjj4dc4\" starting:\n\njCcPzKq+9JLar8eO2ILnqfrkj8Wj64Lqo7XsiMaV85jStPyV/bTiu9+RwqTPheOrwqrjteyIxpXzmNK0/BV9NGItKqrrjTJvPFOC\n...\n\nwhich after base64-decoding gives:\n\nXORing this with itself shifted by one byte gives:\n\nand then using the modified XOR routine with key \"dNSfkJfHihIVY\" gives:\n\nwhich, after fixing the first byte, is Agent Tesla.\n\nThis would suggest a common source for the second stage of both the \"trump2020\" version of DTPacker and the\nlatest second stage of CyaX. It is possible there is a resource overlap between DTPacker and CyaX, such as both\nauthors paying for the same DLL encoder, but Proofpoint cannot confirm this.\n\n## Conclusion\n\n\n-----\n\nDTPacker s use as both a packer and downloader and its variation in delivery and obfuscation whilst keeping two\nsuch unique keys as part of its decoding is very unusual.\n\nIt is unknown why the malware author specifically referred to Donald Trump in the malware’s fixed passwords, as it is\nnot used to specifically target politicians or political organizations and would not be seen by the intended victims.\nProofpoint assesses this malware will continue to be used by multiple threat actors.\n\n## Network IDS Rules:\n\nProofpoint Emerging Threats includes multiple detections for this malware.\n\n2031127 - ET MALWARE DTLoader Binary Request\n\n2031128 - ET MALWARE DTLoader Encoded Binary - Server Response\n\n2031129 - ET MALWARE DTLoader Domain (ahgwqrq .xyz in TLS SNI)\n\n2033356 - ET MALWARE DTLoader Binary Request M2\n\n2844913 - ETPRO MALWARE Haskell Downloader/DTLoader CnC Activity\n\n2846706 - ETPRO MALWARE DTLoader Variant Activity\n\n2847389 - ETPRO MALWARE DTLoader CnC Activity\n\n2847503 - ETPRO MALWARE DTLoader Variant Activity\n\n2847916 - ETPRO MALWARE DTLoader Obfuscated HTML Payload Inbound\n\n2847940 - ETPRO MALWARE DTLoader Activity\n\n2850461 - ETPRO MALWARE DTLoader Retrieving Encoded Payload\n\n## Sample Indicators of Compromise\n\n**Indicator** **Description** **Associated**\n**Malware**\n\n\n9d713d2254e529286ed3ac471e134169d2c7279b0eaf82eb9923cd46954d5d27 DTPacker\nSHA256\n\n\nhxxps://hastebin[.]com/raw/azipitojuj\n\nhxxps://hastebin[.]com/raw/urafehisiv\n\n\nPayload\nDownload\nLocation\n\n\nAgent\nTesla\n\nAgent\nTesla\n\nAve Maria\nRAT\n\nAgent\nTesla\n\nAsyncRAT\n\n\n285f4e79ae946ef179e45319caf11bf0c1cdaa376924b83bfbf82ed39361911b DTPacker\nSHA256\n\n512b2f1f4b659930900abcc8f51d175e88c81b0641b7450a6618b77848fa3b40 DTPacker\nSHA256\n\n1312912d725d45bcd1b63922ec9a84abca7a8c9c669c13efbd03472c764be056 DTPacker\nSHA256\n\n\n-----\n\nba0f9be7cf006404bcfab6b6adbad0cef7281c3792490903632a4010d8a74f42 DTPacker\nSHA256\n\n\nhxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=E2E813E9694BE43CAD964C0453632F91\n\nhxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=63DC49E5D8F5F50F8838551347009928\n\nhxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=D13B96F0619AC39B44A32D3E0A260C89\n\nhxxps://ahgwqrq[.]xyz/getrandombase64.php?\nget=85530E49BB23CD9DBD8461A2FC5D18A2\n\n\nPayload\nDownload\nLocation\n\n\n5d555eddfc23183dd821432fd2a4a04a543c8c1907b636440eb6e7d21829576c DTPacker\nSHA256\n\nhxxp://193.239.147[.]103/base/264712C97B662289D6644F926525A252.html Payload\nDownload\nLocation\n\nb53558a85b8bb10ce70cb0592a81e540683d459b9d8666b7927c105f1141a189 DTPacker\nSHA256\n\n\nhxxp://osndjdjjjdjshgaggdkf[.]com/base/377A23697621555ED2123D80005200D7.html\n\nhxxp://osndjdjjjdjshgaggdkf[.]com/base/650D6251494D3B160CBC93685F2FA1E4.html\n\nhxxp://osndjdjjjdjshgaggdkf[.]com/base/2A812C716BD7EB40F36227E584D97524.html\n\n\nPayload\nDownload\nLocation\n\n\n9cc817f0205da4bde1d938e1817aa98fe4f4a5dcbcaffbe8b45041e24c105aa0 DTPacker\nSHA256\n\n\nhxxp://liverpoolofcfanclub[.]com/liverpool-fc-news/features/steven-gerrard-liverpoolfuture-dalglish--goal-1FE8F2E05D5035C0446552639B8336B8.htm\n\nhxxp://liverpoolofcfanclub[.]com/liverpool-fc-news/features/steven-gerrard-liverpoolfuture-dalglish--goal-EC7D4835EC6F56BD999A943FEDF8D489.html\n\nhxxp://liverpoolofcfanclub[.]com/liverpool-fc-news/features/steven-gerrard-liverpoolfuture-dalglish--goal-DE7C2CE9F7D38544A851414C40C46A3F.html\n\n\nPayload\nDownload\nLocation\n\n\n281cdbf590c22cd684700dcde609d6be48ddf3e4d988d48e65d9c688ce76f7af DTPacker\nSHA256\n\n\nhxxp://mmwrlridbhmibnr[.]ml/liverpool-fc-news/features/steven-gerrard-liverpool-futuredalglish--goal-40505C0917C3E190B486745F4941F177.html\n\n\nDTPacker\nDownload\nURL\n\n\nAgent\nTesla\n\nAgent\nTesla\n\nAgent\nTesla\n\nAgent\nTesla\n\nSnake\nKeylogger\n\nSnake\nKeylogger\n\nAgent\nTesla\n\nAgent\nTesla\n\nAgent\nTesla\n\nAgent\nTesla\n\nAgent\nTesla\n\nFormBook\n\n\na564eb282800ed662b1c55ae65fbba86b6feca00a2e15ebb36a61fc53ac47c3a DTPacker\nSHA256\n\naffea9c276ded88eea1e39ac39fb19373c4b62d4251fb1d06f37a05e35dfa463 DTPacker\nSHA256\n\n\n-----\n\nhxxps://cdn.discordapp[.]com/attachments/\n\n893177342426509335/897124528768032848/9722D04C.jpg\n\nhxxps://cdn.discordapp[.]com/attachments/\n\n893177342426509335/897124531213336656/F526E587.jpg\n\n\nDTPacker\nDownload\nURL\n\n\nFormBook\n\nAgent\nTesla\n\n\n4053206d66d627d145d9da8d8e208d08c85755036a5393ccc6e8afd6117df864 DTPacker\nSHA256\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-24 - DTPacker – a .NET Packer with a Curious Password.pdf"
    ],
    "report_names": [
        "2022-01-24 - DTPacker – a .NET Packer with a Curious Password.pdf"
    ],
    "threat_actors": [
        {
            "id": "d2dad33f-6218-477c-9388-3d5228d7562f",
            "created_at": "2023-02-15T02:01:49.573579Z",
            "updated_at": "2025-03-27T02:00:03.115957Z",
            "deleted_at": null,
            "main_name": "TA2536",
            "aliases": [],
            "source_name": "MISPGALAXY:TA2536",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536220,
    "ts_updated_at": 1743041407,
    "ts_creation_date": 1653759956,
    "ts_modification_date": 1653759956,
    "files": {
        "pdf": "https://archive.orkl.eu/67a90fbb77af2f0d8ce61b873d562f779a3bf19e.pdf",
        "text": "https://archive.orkl.eu/67a90fbb77af2f0d8ce61b873d562f779a3bf19e.txt",
        "img": "https://archive.orkl.eu/67a90fbb77af2f0d8ce61b873d562f779a3bf19e.jpg"
    }
}