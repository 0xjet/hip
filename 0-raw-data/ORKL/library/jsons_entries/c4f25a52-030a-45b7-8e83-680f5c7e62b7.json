{
    "id": "c4f25a52-030a-45b7-8e83-680f5c7e62b7",
    "created_at": "2023-01-12T14:59:16.271972Z",
    "updated_at": "2025-03-27T02:05:29.135444Z",
    "deleted_at": null,
    "sha1_hash": "ad216c6e6dd486eb51ab206631c414390f00940a",
    "title": "2017-06-28 - CrowdStrike Protects Against NotPetya Attack",
    "authors": "",
    "file_creation_date": "2022-05-28T21:54:34Z",
    "file_modification_date": "2022-05-28T21:54:34Z",
    "file_size": 1289353,
    "plain_text": "# What is the NotPetya Ransomware Attack? Get Protected Against it\n\n**[crowdstrike.com/blog/fast-spreading-petrwrap-ransomware-attack-combines-eternalblue-exploit-credential-stealing/](https://www.crowdstrike.com/blog/fast-spreading-petrwrap-ransomware-attack-combines-eternalblue-exploit-credential-stealing/)**\n\nJune 28, 2017\n\n## CrowdStrike Protects Against NotPetya Attack\n\nJune 28, 2017\n\n[Falcon Intelligence Team](https://www.crowdstrike.com/blog/author/falcon-intelligence-team/) [From The Front Lines](https://www.crowdstrike.com/blog/category/from-the-front-lines/) [Research & Threat Intel](https://www.crowdstrike.com/blog/category/threat-intel-research/)\n\n## Update:\n\nDue to naming convention consistency in the industry, CrowdStrike is now calling this\nvariant of Petya – NotPetya.\n\nOn June 27 at approximately 10:30 UTC, a new ransomware family began propagating\nacross multiple countries. The family, referred to as NotPetya, is noteworthy because it\n[combines traditional ransomware behavior with stealthy propagation techniques and a](https://www.crowdstrike.com/epp-101/what-is-ransomware/)\ndestructive attack element. CrowdStrike Falcon® Endpoint Protection customers are\nprotected against all currently identified variants of the threat. For more details, read:\n\n**NotPetya Technical Analysis — A Triple Threat: File Encryption, MFT Encryption,**\n**Credential Theft.**\n\n\n-----\n\nIn addition to encrypting files on infected systems, NotPetya moves laterally to encrypt other\nsystems in the organization by leveraging the same EternalBlue vulnerability that was\npopularized by WannaCry last month. It then uses another propagation technique that starts\nby stealing credentials, then uses those legitimate credentials to infect other systems on the\nnetwork via built-in Microsoft tools (WMI and PSEXEC). Finally, NotPetya employs a\ndestructive technique that prevents infected systems from booting by encrypting the master\nboot record (MBR).\n\nAttacks have been reported in countries including Ukraine, Russia, Poland, France,\nGermany, Spain, the United Kingdom, the Netherlands, India, Israel, Australia and the\nUnited States. Sectors impacted by this attack include government, energy, finance,\ndefense, telecom, media, maritime, aviation, and transportation.\n\n**NotPetya Summary**\n\nInitial infection in Ukraine accomplished by exploiting vulnerability in M.E.Doc software\nInfected systems then attempt to propagate the infection to other systems\n\nTo infect other systems inside the organization, the malware steals credentials\nand propagates with built-in Windows tools WMI and PSEXEC:\n\nPSEXEC code snippet: C:\\Windows\\dllhost.dat \\\\IP ADDRESS -accepteula -s -d\nC:\\Windows\\System32\\rundll32.exe “C:\\Windows\\perfc.dat”,#1 10\n“USERNAME:PASSWORD”\n\nWMI code snippet: C:\\Windows\\system32\\wbem\\wmic.exe /node:”IP ADDRESS”\n/user:”USERNAME” /password:”PASSWORD” process call create\n“C:\\Windows\\System32\\rundll32.exe \\”C:\\Windows\\perfc.dat\\” #1 XX\n\\”USERNAME:PASSWORD\\”\nTo infect additional systems outside the organization, the malware attempts to\nexploit the EternalBlue vulnerability\nThe malicious payload then begins encrypting data, which includes the Master File\nTable and MBR\n\nThe attack creates a scheduled task to reboot the system after a certain amount\nof time has passed (up to 60 minutes):\nCode snippet: schtasks /RU “SYSTEM” /Create /SC once /TN “” /TR\n“C:\\Windows\\system32\\shutdown.exe /r /f” /ST XX:XX (where XX:XX is the time)\nIt also attempts to cover its tracks by running commands to delete event logs and the\ndisk change journal:\n\nCode snippet 1: wevtutil cl Setup & wevtutil cl System & wevtutil cl Security &\nwevtutil cl Application\nCode snippet 2: fsutil usn deletejournal /D C:\n\n\n-----\n\nUpon reboot the end user cannot get back into Windows, and instead they see a\nransom note (screenshot below). This happens because NotPetya encrypted the\nMBR, thereby breaking the normal Windows boot process.\n\n**Initial Vector**\n\nAccording to multiple sources, infections of NotPetya were first identified on systems\n[running a legitimate updater for the document management software M.E.Doc. This](http://www.me-doc.com.ua/)\nsoftware is heavily used by Ukrainian companies, and companies operating in Ukraine, for\nmaintaining information on tax and payroll accounting. From these infected systems, the\nransomware can propagate to other systems using the techniques described above.\n\nBased on analysis of the M.E.Doc software, and forensic analysis of initially infected hosts,\nit is believed that the malware was first deployed as a software update. Further third-party\nreporting suggests that the M.E.Doc update process started distributing a new binary\ncontaining a malicious payload at approximately 10:30 UTC. The deployment of NotPetya\nhas also been reported by M.E.Doc users on the software company’s forum in\nenvironments in which only this software was present.\n\n**Payment Mechanism**\n\nThe ransomware operators demanded a ransom of $300 USD for each infected machine,\nand established Bitcoin payment workflow through an email address\n(wowsmith123456@posteo[.]net) provided by the third-party email service Posteo. Upon\nnotification of this incident by the security community, the email provider announced that\nservice to this address had been suspended as of 16:15 UTC (https://posteo.de/blog/infozur-ransomware-petrwrappetya-betroffenes-postfach-bereits-seit-mittag-gesperrt). As a\n\n\n-----\n\nresult, recovery of files upon payment of the ransom is no longer possible for impacted\nvictims, as no mechanism currently exists for the ransomware operators to provide victims\nwith decryption keys.\n\nOnce the malware is deployed on a victim machine, it creates a scheduled task to reboot\nthe host an hour after the infection, likely in order to allow it to spread further before\nlaunching its destructive payload. To achieve this, the malware drops and runs either an x86\nor an x64 version of a credential stealer executable from a resource that contains code\nsimilar to the well-known Mimikatz tool.\n\nThe ransomware payload uses a combination of 2048-bit RSA and 128-bit AES in Cipher\nBlock Chaining (CBC) mode to encrypt files with extensions matching entries from a hardcoded list. Public reporting mentions similarities with the Petya ransomware; however,\nCrowdStrike was not able to confirm any links, and assesses that the code structure of this\nnew family is different from Petya’s.\n\n**Protection Against NotPetya**\n\n[CrowdStrike Falcon Endpoint Protection can prevent both the initial NotPetya infection and](https://www.crowdstrike.com/products/)\nsubsequent propagation attempts. In the first example, Falcon is shown blocking the\nNotPetya malware from executing.\n\nThe second example shows a system on the same network as a system that is already\ninfected. Because that second system is protected by Falcon, the propagation attempt fails\nand the second system is protected.\n\n\n-----\n\nFalcon can also detect the threat based on its behavior. In the example below,\nRUNDLL32.EXE is exhibiting malicious behavior. It is attempting to execute a malicious\nDLL while simultaneously trying to steal credentials and write them to a temp file, as well as\ninvoking a command to set the task scheduler to reboot the system in the near future.\n\nThe critical part of the attack is the RUNDLL32.EXE step (in orange). Because Falcon\nrecognizes this collection of related behaviors as malicious, it prevents the execution of the\nprocess (as depicted below).\n\nFalcon Endpoint Protection protects against NotPetya with both machine learning and\nbehavioral protection. Falcon Prevent and Falcon Endpoint Protection customers can\nenable this protection by enabling “Moderate Prevention” settings on the machine learning\nengine sliders, including File Attribute, File Analysis, and On-Sensor Machine Learning\nunder Process Blocking, please ensure Prevent Suspicious Processes is enabled.\n\n\n-----\n\n_Falcon Endpoint Protection policy recommendation for blocking NotPetya_\n\n[CrowdStrike Intelligence is actively monitoring the development of this ransomware and has](https://www.crowdstrike.com/endpoint-security-products/falcon-x-threat-intelligence/)\n[published an in-depth technical analysis of NotPetya.](https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/)\n\n[Click for more information on subscribing to Falcon Intelligence or to learn more about how](https://www.crowdstrike.com/products/falcon-intelligence/intelligence-subscriptions-offerings/)\nFalcon prevents ransomware attacks.\n\nRelated Content\n\n\n-----\n\nCompromised Docker Honeypots Used for Pro-Ukrainian DoS Attack\n\n\n-----\n\nNavigating the Five Stages of Grief During a Breach\n\nLemonDuck Targets Docker for Cryptomining Operations\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-28 - CrowdStrike Protects Against NotPetya Attack.pdf"
    ],
    "report_names": [
        "2017-06-28 - CrowdStrike Protects Against NotPetya Attack.pdf"
    ],
    "threat_actors": [
        {
            "id": "4fe925e8-95e5-4a63-9f96-4d0f9bedac08",
            "created_at": "2022-10-25T15:50:23.469077Z",
            "updated_at": "2025-03-27T02:00:55.478056Z",
            "deleted_at": null,
            "main_name": "DarkHydrus",
            "aliases": [
                "DarkHydrus"
            ],
            "source_name": "MITRE:DarkHydrus",
            "tools": [
                "Mimikatz",
                "RogueRobin",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6efb28db-4d91-46cb-8ab7-fe9e8449ccfc",
            "created_at": "2023-01-06T13:46:38.772861Z",
            "updated_at": "2025-03-27T02:00:02.914846Z",
            "deleted_at": null,
            "main_name": "DarkHydrus",
            "aliases": [
                "Obscure Serpens",
                "LazyMeerkat",
                "G0079"
            ],
            "source_name": "MISPGALAXY:DarkHydrus",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5b04780e-7b64-4e62-b776-c6749ff7dec8",
            "created_at": "2022-10-25T16:07:23.531741Z",
            "updated_at": "2025-03-27T02:02:09.84903Z",
            "deleted_at": null,
            "main_name": "DarkHydrus",
            "aliases": [
                "ATK 77",
                "DarkHydrus",
                "LazyMeerkat",
                "Obscure Serpens"
            ],
            "source_name": "ETDA:DarkHydrus",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Mimikatz",
                "Phishery",
                "RogueRobin",
                "RogueRobinNET",
                "Trojan.Phisherly",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535556,
    "ts_updated_at": 1743041129,
    "ts_creation_date": 1653774874,
    "ts_modification_date": 1653774874,
    "files": {
        "pdf": "https://archive.orkl.eu/ad216c6e6dd486eb51ab206631c414390f00940a.pdf",
        "text": "https://archive.orkl.eu/ad216c6e6dd486eb51ab206631c414390f00940a.txt",
        "img": "https://archive.orkl.eu/ad216c6e6dd486eb51ab206631c414390f00940a.jpg"
    }
}