{
    "id": "3df01466-e9fc-453b-80e6-f00f0810d919",
    "created_at": "2023-01-12T15:09:31.859276Z",
    "updated_at": "2025-03-27T02:05:56.53888Z",
    "deleted_at": null,
    "sha1_hash": "7e4395b1d689aff0d7e48971d81bf4a9d0573a8e",
    "title": "2021-12-22 - The ‘STOP’ Ransomware Variant",
    "authors": "",
    "file_creation_date": "2022-05-28T23:36:23Z",
    "file_modification_date": "2022-05-28T23:36:23Z",
    "file_size": 3464526,
    "plain_text": "# The ‘STOP’ Ransomware Variant\n\n**[angle.ankura.com/post/102het9/the-stop-ransomware-variant](https://angle.ankura.com/post/102het9/the-stop-ransomware-variant)**\n\nVishal Thakur\n\nIn recent weeks, we have observed a spike in infections involving the STOP ransomware\nvariant. STOP is also known as DJVU by other vendors in the industry. In this article, we’ve\nlooked at the latest version circulating in the wild. We will look at some of the main\ncharacteristics of this malware variant, along with detections that can be used to prevent\ninfection and IOCs that we were able to extract during analysis.\n\nThe STOP ransomware has been around for some time, dating back to 2019. The latest\nversion has been found to be distributed broadly in the past few weeks. Like the ones in the\npast, this variant is a portable executable that uses a public key to encrypt data on the\nvictim’s machine and drops a ransom note in folder directories as it goes through the entire\nfile system encrypting files using the Salsa20 encryption algorithm. The threat actors behind\nSTOP have gone for a flat rate of USD $980 to provide the decryption keys to victims and\n\n\n-----\n\nhave also offered a discounted rate of USD $490 if the victims contact them within 72 hours\nof the attack occurring. This tactic is consistent with what has been observed in the past for\nthis ransomware group.\n\nBased on the tactics and techniques used by the malware, the threat actors behind the\nvariant are likely from the Russian region as the malware avoids encryption explicitly on\nsystems geo-located in or near Russia.\n\n_Figure 1: Quick Snapshot of STOP Ransomware_\n\n## Mitigation\n\nThis section provides information that can be used to prevent infection by the STOP\nransomware. We have included detections, IOC list, and YARA Rules that can be used to\ndefend against this threat.\n\n### YARA Rule\n\nThis YARA Rule can be used to detect STOP Ransomware. Download the entire ruleset\n[here.](https://github.com/vithakur/Yara-rules/blob/main/ransomware/win_ransomware_stop.yar)\n\n_Figure 2: YARA Ruleset for STOP Ransomware_\n\n\n-----\n\n### Detections\n\nThe following figure has the information that can be used to create detections for this\n[malware. Download the entire list here.](https://github.com/vithakur/detections/blob/main/STOP-ransomware-djvu/detections-memory)\n\nThe following strings are from the unpacked malware, and these can be found in memory\nduring and after the malware has been fully executed. This information can be used to create\ndetections for EDR tools that can access and read memory and take actions based on\ndetection rules applied.\n\n_Figure 3: Detections_\n\n### IOC List\n\n[Download the entire list here.](https://github.com/vithakur/detections/blob/main/STOP-ransomware-djvu/IOC-list)\n\n\n-----\n\n_Figure 4: IOC list_\n\n## Execution\n\nOnce the STOP ransomware executes, it attempts to make a few network connections over\nthe Internet for various purposes, such as; geo-checking, key retrieval, and further infection\nby downloading different malware. First, let’s look at the start of the execution of this\nmalware.\n\n_Figure 5: Malware Entry-point_\n\nUpon execution, the malware copies itself to the ‘C:\\Users\\[username]\\AppData\\Local\\\n\n[GUID]’ directory on disk and tries to execute with escalated privileges, as shown in the\nfigures below.\n\n_Figure 6: Malware copies itself to a different location_\n\n_Figure 7: Spawning new process with elevated privileges_\n\n\n-----\n\n[The malware then attempts to connect over the Internet to https://api.2ip.ua/geo.json to](https://api.2ip.ua/geo.json)\nverify the victim’s geolocation. This link leads to a Russian site (screenshot below) that\nprovides geolocation services based on public Internet IP addresses which the malware uses\nto ascertain the location of its victims. The malware has a hard-coded country codes list that\nis checked before it continues executing on the victim’s system and will avoid encrypting\nvictims within these countries.\n\n_Figure 8: Geo-location service used by the malware_\n\nThe site also offers an API-based service that the malware uses to determine the\ngeolocation of the victim machines.\n\n_Figure 9: The specific API-based service the malware uses_\n\nThe country code list can be seen in the figure below, showing the codes in memory during\nexecution.\n\n\n-----\n\n_Figure 10: Country codes of locations this malware avoids_\n\nNext, the malware tries to connect to a command and control URI to get the public key for\nencryption. As we can see in the figure below, it sends a request to this URI with a PID\ncreated for the victim.\n\n_Figure 11: URI loaded into the Stack for processing_\n\n_Figure 12: Connection to the C2 for public key_\n\nOnce the request is successful, the malware uses the public key with the ID to encrypt the\nvictim's data.\n\n_Figure 13: Public Key for encryption served by the C2_\n\nThe malware uses a standard encryption sequence, calling in the functions required to\nencrypt data from start to finish. The complete sequence can be seen in the figure below, in\nthe order of called functions.\n\n\n-----\n\n_Figure 14: Encryption Sequence of function calls_\n\n## CSP – Cryptography Service Provider\n\nThe malware queries the Registry on the victim machine to set the CSP and CSP type. Note\nthat type shown in the figure below is 'Type 001' which is the 'RSA Full' provider.\n\n_Figure 15: Malware query to Registry for the Type of CSP_\n\nThe malware uses the Registry to set the provider type and subsequently the actual provider,\nwhich in this case happens to be RSA Full.\n\n### RegOpenKey\n\n_Figure 16: Registry functions used to determine the CSP_\n\n### RegOpenKeyExA\n\nNext, the malware queries the Registry to determine the actual CSP as can be seen in the\nfigure below.\n\n_Figure 17: The absolute Registry path passing through the Registers_\n\n\n-----\n\n_Figure 18: The CSP highlighted in the Registry_\n\n_Figure 19: DLL image path to be called for the CSP_\n\nThe malware uses the public key obtained from the command and control server to start the\nprocess of encryption on the victim’s system.\n\n_Figure 20: Second function to be called in the Encryption Sequence_\n\n_Figure 21: Public key loaded_\n\nOnce the entire encryption sequence is completed for a directory, the final step is to write a\nransom note to the directory with instructions on how to pay the ransom.\n\n\n-----\n\n_Figure 22: Ransom note 'write' initiated_\n\nThe figure below shows the ransom note as strings being passed onto the Stack before it is\nwritten to the disk.\n\n_Figure 23: Ransom note loaded into the Stack_\n\nFinally, the ransom note is written as a ‘txt’ file to the disk. This process is repeated for all\ndirectories in which the malware encrypts data. The figure below shows the newly created\nransom note “_readme.txt”.\n\n\n-----\n\n-----\n\n_Figure 24: Ransom note file written to the current directory_\n\nThe ransom note has the instructions on how the victims can pay to get the decryption key\nand provides a unique ID that the victim needs to use to get the decryption key for their\nmachine. There is also a link to a demo video showing how the decryption tool works. The\nnote also provides a couple of email addresses for the victims to contact the ransomware\ngroup if needed.\n\n_Figure 25: Ransom note with instructions on next steps_\n\nThis version of the STOP ransomware variant encrypts the file and replaces the fileextensions to “.shgv”, as seen in the figure below.\n\n_Figure 26: Files successfully encrypted_\n\n\n-----\n\n## Downloader Module\n\nAside from performing common ransomware activities, this malware also tries to download\nand execute other malware:\n\n_Figure 27: Downloaded malware - Vidar Stealer_\n\n[This downloaded PE is a variant of the Vidar malware family.](https://malware.news/t/deep-analysis-of-vidar-stealer/49591)\n\nVidar Stealer is malware designed to steal information, mainly distributed as spam mail or\ncracked versions of commercial software and keygen programs. When installed, data such\nas infected device information, account, and history recorded in the browser is collected and\nsent to a command and control server.\n\nThe group behind the development or distribution (or both) of STOP ransomware may be\nworking with the group responsible for developing the Vidar malware.\n\n## Conclusion\n\nSTOP ransomware has been around for quite some time now. Early occurrences of\ninfections by this ransomware can be traced back to 2019.\n\nCompared to some other ransomware families, the execution standard is low and it’s clear\nthat this ransomware model is affiliation-leaning (working with other malware groups). We\nwere able to link this malware to a different malware, the Vidar Stealer, which has been the\ncase for quite some time.\n\nThe encryption is straightforward, with the threat actors not bothering to create their\nencryption algorithm or deploying any additional modules other than a downloader for a\nseparate malware. The malware uses the Salsa20 algorithm for encryption. It is capable of\nboth online and offline encryption.\n\nThis ransomware avoids infecting victims in and near Russia.\n\nThe ransomware seems to be targeted towards individuals or small businesses at best, as\nthe asking price for the decryption key is not that high. They even offer an ‘early bird’\ndiscount to top it all off.\n\n[Deep Analysis of Vidar Stealer - Sojun Ryu](https://medium.com/s2wblog/deep-analysis-of-vidar-stealer-ebfc3b557aed)\n\n[YAYA ruleset for STOP Ransomware - Vishal Thakur](https://github.com/vithakur/Yara-rules/blob/main/ransomware/win_ransomware_stop.yar)\n\n[Detections list for STOP Ransomware - Vishal Thakur](https://github.com/vithakur/detections/blob/main/STOP-ransomware-djvu/detections-memory)\n\n\n-----\n\n[IOC list of STOP Ransomware - Vishal Thakur](https://github.com/vithakur/detections/blob/main/STOP-ransomware-djvu/IOC-list)\n\n_© Copyright 2021. The views expressed herein are those of the author(s) and not_\n_necessarily the views of Ankura Consulting Group, LLC., its management, its subsidiaries, its_\n_affiliates, or its other professionals. Ankura is not a law firm and cannot provide legal advice._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-22 - The ‘STOP’ Ransomware Variant.pdf"
    ],
    "report_names": [
        "2021-12-22 - The ‘STOP’ Ransomware Variant.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536171,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1653780983,
    "ts_modification_date": 1653780983,
    "files": {
        "pdf": "https://archive.orkl.eu/7e4395b1d689aff0d7e48971d81bf4a9d0573a8e.pdf",
        "text": "https://archive.orkl.eu/7e4395b1d689aff0d7e48971d81bf4a9d0573a8e.txt",
        "img": "https://archive.orkl.eu/7e4395b1d689aff0d7e48971d81bf4a9d0573a8e.jpg"
    }
}