{
    "id": "c5138591-1c6c-40fa-a3b0-2d9d84403bbc",
    "created_at": "2022-10-25T16:48:17.96707Z",
    "updated_at": "2025-03-27T02:14:38.662982Z",
    "deleted_at": null,
    "sha1_hash": "8cde271eb5fe7b54b667ee88368518c7b2fdbacc",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-09-09T05:52:05Z",
    "file_modification_date": "2019-09-09T05:52:05Z",
    "file_size": 639651,
    "plain_text": "[About TrendLabs Security Intelligence Blog](https://blog.trendmicro.com/trendlabs-security-intelligence/about-us/)\n\n[Home  »  Exploits  »  Glupteba Campaign Hits Network Routers and Updates C&C Servers with Data from Bitcoin Transactions](https://blog.trendmicro.com/trendlabs-security-intelligence/)\n\n# Glupteba Campaign Hits Network Routers and Updates C&C Servers with Data from Bitcoin Transactions\n\n[Posted on:September 4, 2019 at 4:57 am](https://blog.trendmicro.com/trendlabs-security-intelligence/2019/09/)\n[Posted in:Exploits, Malware, Vulnerabilities](https://blog.trendmicro.com/trendlabs-security-intelligence/category/exploits/)\nAuthor:\n[Trend Micro](https://blog.trendmicro.com/trendlabs-security-intelligence/author/trend-micro/)\n\n0\n\n**_by Jaromir Horejsi and Joseph C. Chen_**\n\nWe recently caught a malvertising attack distributing the [malware Glupteba. This is an older malware that was previously connected to a campaign named](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/trojan.win32.glupteba.ta) Operation\nWindigo and distributed through exploit kits to Windows users. In 2018, a security company [reported that the Glupteba botnet may have been independent from](https://www.welivesecurity.com/2018/03/22/glupteba-no-longer-windigo/)\nOperation Windigo and had moved to a [pay-per-install adware service to distribute it in the wild. The activities of the actors behind Glupteba have been varied: they](https://blog.trendmicro.com/trendlabs-security-intelligence/pop-up-ads-and-over-a-hundred-sites-are-helping-distribute-botnets-cryptocurrency-miners-and-ransomware/)\nwere suspected of providing proxy services in the underground, and were [identified as using the EternalBlue exploit to move into local networks and run Monero](https://s.tencent.com/research/report/482.html)\n(XMR) cryptocurrency miners.\n\nAfter looking into the recent variant of the Glupteba dropper delivered from the malvertising attack, we found that the dropper downloaded two undocumented\ncomponents aside from the Glupteba malware:\n\nA browser stealer that can steal sensitive data, for example, browsing history, website cookies, and account names and passwords from browsers and send the\ninformation to a remote server.\nA router exploiter that attacks MikroTik routers in local network with the [CVE-2018-14847 vulnerability. It will schedule a task on the router for command and](https://blog.mikrotik.com/security/winbox-vulnerability.html)\ncontrol (C&C) and upload the stolen administrator credentials to a remote server. A compromised router will be configured as a SOCKS proxy to relay\nmalicious traffic, matching the original purpose of the Glupteba botnet on Windows.\n\nIn addition, an interesting feature we found inside the Glupteba dropper can retrieve the latest C&C domain from Bitcoin transactions. We explain this feature further\nin the next sections. It seems the operators are still improving their malware and may be trying to extend their proxy network to internet of things (IoT) devices.\n\n_Figure 1. Glupteba campaign attack flow_\n\n_Figure 2. Pop-up malvertising on file-sharing websites downloaded Glupteba dropper_\n\n**_Analysis of the Glupteba dropper_**\n\nThe downloaded dropper binary is packed with a custom packer, written in Go programming language, and compiled to executable. The dropper first initializes\n‘config information’ by acquiring current application information operating information hardware information as well as some information hardcoded in binary It\n\n\n-----\n\n_Figure 3. Registries created by the Glupteba dropper_\n\nThen, the function sendParentProcesses acquires machine_guid from the registry, as well as distributor id and campaign id from the file name, product identification\n(PID), and names of parent processes. It then embeds this information in a POST request, encrypts it with an AES cipher, and uploads to the C&C server:\n_hxxps://<server>/api/parent-processes._\n\nAfter that, the dropper checks if process is elevated and running as a SYSTEM user. If process is not elevated, it tries to exploit the [fodhelper method to get it](https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/)\nelevated. If it is elevated but not running as a SYSTEM user, it uses the “Run as Trusted Installer” method, likely inspired by [this code, which uses a stolen winlogon](https://github.com/nfedera/run-as-trustedinstaller/blob/master/run-as-trustedinstaller/main.cpp)\nprocess token to run process as SYSTEM.\n\nThe main dropper binary has embedded a few rootkit drivers used for hiding files and processes (WinMon32.sys, WinMon64.sys, WinMonFs32.sys,\nWinMonFs64.sys, WinMonprocessmonitor32.sys, WinMonProcessMonitor64.sys, WinmonSystemMonitor-10-64.sys, WinmonSystemMonitor-7-10-32.sys,\n[WinmonSystemMonitor-7-64.sys) and a few other tools taken from GitHub used to help installing the necessary drivers (dsefix.exe and](https://github.com/hfiref0x/DSEFix) [patch.exe.)](https://github.com/hfiref0x/UPGDSED)\n\nFunction executeTask processes these main commands:\n\nhide Hide task PID using embedded WinMon\nupdate Terminate and remove current version, replace with new version\ncleanup Uninstall\n\nFunction mainInstall checks for installed antivirus (AV) programs, adds firewall rules, and adds defender exclusions.\n\nFunction mainPoll regularly polls the C&C server for new commands. It sends a POST request to hxxps://<server>/api/poll. POST parameters look like the following\n(before encryption):\n\nchallenge=e94e354daf5f48ca&cloudnet_file=1&cloudnet_process=1&lcommand=0&mrt=1&pgdse=0&sb=1&sc=0&uuid=&version=145&wup_process=1&wup\n\nThe query is AES 256-encrypted.\n\nFinally, function handleCommand implements backdoor functions.\n\n**Function** **Task**\nupdate\nget_app_name\nis_admin\nprocess_is_running Queries “SELECT Name FROM Win32_Process WHERE Name =”\nexec\ndownload\nrun\nrun-v2\nexit\nupdate Download and execute file\nupdate-data POST internal config to /bots/update-data\n\nDownload file from hxxp://nxtfdata[.]xyz/cl.exe, replaces\nupdate-cloudnet\n_cloudnet.exe file, which is Glupteba_\nstop-wup Stop XMR mining\nstop-wupv Stop XMR mining\nstop-mrt\n\nEstablish heartbeat, notification to URL with a given time interval,\n\nnotify notifyHTTP, notifyH, notifyG, notifyS, notifyTCP, notifyTLS,\n\nnotifyUDP\nnotify-host Host for notification\nevent-exists if Global\\\\<event name> exists\ni if Gl b l\\\\ i\n\n\n-----\n\nregistry-get-startupVerify signatures of PE files from startup\nsignatures\n\nverify-processesEnumerate processes, verify signatures\nsignatures\n\nCalls VerifyProcessesSignatures and RegistryGetStartupSignatures,\nget-unverified-files\nreports unverified files\n\nQuery hxxp://localhost:3433/, GET cryptominer stats, wup.exe is the\nget-stats-wup\nopen-source miner for XMR\nupload-file File upload\nupdate-service Download and run service\nget-logfile-proxy Read file \\\\proxy\\\\t\ninstall Download and run file, sendInstallReport\nget-logfile-i2pd Read file \\\\i2pd\\\\i2pd.log\nsc Take screenshot\nupdate-cdn Update C2\ndiscover-electrum Use hardcoded Electrum wallet; read blockchain transaction data\ndiscover- Use hardcoded Bitcoin address, discover new C2 domain encrypted in\nblockchaincome bitcoin transaction data\n\n**_Notable C&C update capability_**\n\nThe backdoor mostly has standard capabilities, but one interesting feature stands out: This malware can update its C&C server address through the blockchain via the\nfunction discoverDomain.\n\nThe discoverDomain function can be run either by sending a backdoor command, or automatically by the dropper. DiscoverDomain first enumerates Electrum\n[Bitcoin wallet servers using a publicly available list, then tries to query the blockchain script hash history of the script with a hardcoded hash.](https://raw.githubusercontent.com/spesmilo/electrum/master/electrum/servers.json)\n\nThis command then reveals all the related transactions.\n\nThen each transaction is parsed, searching for the [OP_RETURN instruction.](https://en.bitcoin.it/wiki/OP_RETURN)\n\nThe pieces of data followed by OP_RETURN instruction are then used as parameters for AES decryption routine — the first 12 bytes are used as the AES GCM tag,\nand the following 32 bytes are the encrypted data. The 32-byte long AES key is hardcoded in binary file.\n\nTherefore, 0f8f7cd39e1a5231b49f986b877befce0c2f558f0c1a9844833ac702cb3eba6e gets decoded to venoxcontrol[.]com, which is the current C&C server at the\ntime of writing this publication.\n\nThis technique makes it more convenient for the threat actor to replace C&C servers. If they lose control of a C&C server for any reason, they simply need to add a\nnew Bitcoin script and the infected machines obtain a new C&C server by decrypting the script data and reconnecting.\n\n**_Browser stealer component_**\n\nOne observed component from the recent Glupteba variant is called “updateprofile”, which is a browser profile, cookies, and password extractor. The Chrome, Opera,\nand Yandex browsers are targeted — cookies, history, and other profile files are zipped and uploaded to the information collection server to path /api/log. Similar to\nthe main dropper, this component is also written in Go, compiled to be executable, and packed with a UPX packer.\n\nAnother version of the browser stealer is called “vc.exe”. Its goal is to extract browser passwords and cookies and post the extracted data to the information collection\nserver to path /bots/post-en-data?uuid=.\n\n**_Router exploiter component_**\n\nAnother component we found downloaded by the Glupteba dropper is a router exploiter, which is also developed with Go language. It looks into the default gateway\nof the victim’s network. The list of default IP gateways is obtained by calling WMI command “SELECT DefaultIPGateway FROM\nWin32_NetworkAdapterConfiguration WHERE IPEnabled = true”.\n\n\n-----\n\nadministrator s credentials from unpatched routers. The grabbed account names and passwords are stored in a JSON object, encrypted, and POSTed to /api/router\npath of the C&C server.\n\nOnce credentials are successfully obtained, a task is added to the scheduler of the router. There are three methods implemented to add a scheduler task: using WinBox\nprotocol, using SSH, or using API.\n\n_Figure 4. Example of scheduled task added by Glupteba campaign to compromised MikroTik routers_\n\nThe router exploiter component scheduled a task named “U6” on compromised routers for command and control. The task will regularly check a C&C URL every 10\nminutes and execute the content downloaded from it. The C&C URL is appended with a unique UUID, which is the same as the bot ID of Glupteba on the victim’s\nmachine. The URL usually returns an HTTP 404 error; but when the bot master sends a command, it returns an [RSC file, which is the format of the RouterOS](https://wiki.mikrotik.com/wiki/Manual:Configuration_Management)\nconfiguration.\n\nThe file is the command from the bot master to control the router. In the attack we analyzed, we saw the C&C server send multiple RSC files step by step to configure\nthe compromised router to be a SOCKS proxy. Here are the steps:\n\nThe first configuration changed the period of “U6” task schedule from 10 minutes to every 15 seconds.\n\nThe second configuration disabled services, including winbox, telnet, api, and api-ssl. This is most likely to prevent the router from being compromised by\nother attackers through the same vulnerability. Then it opened the SSH and SOCKS services, which are listening on randomly assigned ports, and created a\nfirewall rule to accept external connection to the SOCKS port.\n\nThe third configuration removed the existing SOCKS access list on the compromised router.\n\nThe fourth configuration added a new SOCKS access list to limit the service so that it only accepts connections from specified IP ranges. These ranges are\nprobably where the attackers’ servers are.\n\n**_Relayed traffic on compromised routers_**\n\nAfter the above-mentioned setups, the compromised router became a SOCKS proxy for the attackers to relay traffic. We monitored a compromised router to see what\nkind of traffic is transferred. The first remote connection routed through the SOCKS proxy is from a server, which likely belongs to the attackers. This server queries\n“http://ip-api[.]com/json”, which returns the IP address of the current SOCKS proxy server. This query is sent repeatedly, probably to monitor the SOCKS proxy\nservice.\n\nAfter the first check on the router status, we started seeing different servers with two types of traffic connected to the proxy. The first one is spam traffic. We saw a\nremote server establish [SMTP connections to different mail servers through the SOCKS proxy of compromised routers. If a mail server accepted the connection, that](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol)\n[remote server started to send spam mail. The spam mail delivered seems to be related to the notorious “Canadian Pharmacy” spam.](https://krebsonsecurity.com/2011/01/battling-the-zombie-web-site-armies/)\n\n\n-----\n\n_Figure 5. Example of spam traffic sent through a compromised router_\n\n_Figure 6. “Canada Pharmacy” website redirected from spam mail_\n\nBesides the spam traffic, we saw other traffic from a set of remote servers that were repeatedly connecting to Instagram. However, the traffic sent through was\nprotected by HTTPS encryption. We can’t decrypt it and don’t know what exactly these connections are for. One theory is that it is the password-reuse attack hitting\nInstagram. It was previously [reported to be one type of malicious traffic proxied through the Glupteba botnet.](https://www.welivesecurity.com/2018/03/22/glupteba-no-longer-windigo/)\n\n_Figure 7. Example of Instagram connection (HTTPS-encrypted) relayed by a compromised router_\n\nAs mentioned, Glupteba still seems to be evolving and adding capabilities. New techniques, such as updating C&C servers through data obtained from Bitcoin\ntransactions, show that the malicious actors behind this malware are adopting little-used techniques to try and keep their malware active. Since it is already proven to\nbe an information stealer and a proxy for malicious spam, users and enterprises should be wary of this threat.\n\n**_Security recommendations_**\n\nMalvertising is a widespread threat that can affect users and businesses alike. A multilayered approach to security is important — from the gateway, endpoints,\nnetworks, and servers. Trend Micro solutions powered by [XGen™ security, such as Trend Micro™ Security and](http://go.trendmicro.com/sem/sem/www.trendmicro.com/us/business/xgen/index.html) [Trend Micro Network Defense, can detect related](https://www.trendmicro.com/en_us/business/products/network.html?utm_campaign=VURL:www.trendmicro.com&utm_medium=VURL&utm_source=/us/business/cyber-security/index.html)\nmalicious files and URLs and protect users’ systems. [Trend Micro Smart Protection Suites and](https://www.trendmicro.com/us/business/complete-user-protection/index.html) [Trend Micro Worry-Free™ Business Security, which have](https://www.trendmicro.com/en_us/small-business/worry-free.html) behavior\nmonitoring capabilities, can additionally protect from these types of threats by detecting malicious files, as well as blocking all related malicious URLs.\n\nSecurity should be top of mind when setting up routers — most devices across homes and offices are connected to these devices and can be affected if a router is\ncompromised. Although manufacturers [play important roles in securing routers and other devices, users and businesses can adopt](https://blog.trendmicro.com/trendlabs-security-intelligence/internet-things-ecosystem-broken-fix/) [good security practices to defend](https://www.trendmicro.com/vinfo/us/security/news/internet-of-things/protect-home-network-securing-router)\nagainst threats. Also, deploying tools that provide [additional security to home networks and devices connected to them further strengthens defenses.](https://www.trendmicro.com/en_us/forHome/products/homenetworksecurity.html)\n\nFor a full list of the Indicators of Compromise for this malware, please see this [document.](https://documents.trendmicro.com/images/TEx/pdf/Appendix%20Glupteba%20Campaign%20Hits%20Network%20Routers%20and%20Updates%20C&C%20Servers%20with%20Data%20from%20Bitcoin%20Transactions.pdf)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.09.04.Glupteba_Campaign/Glupteba%20Campaign%20Hits%20Network%20Routers%20and%20Updates%20C%26C%20Servers%20with%20Data%20from%20Bitcoin%20Transactions.pdf"
    ],
    "report_names": [
        "Glupteba Campaign Hits Network Routers and Updates C&C Servers with Data from Bitcoin Transactions"
    ],
    "threat_actors": [
        {
            "id": "3844202f-b24a-4e16-b7b9-dfe8c0a44d5d",
            "created_at": "2022-10-25T16:07:24.526179Z",
            "updated_at": "2025-03-27T02:02:10.27234Z",
            "deleted_at": null,
            "main_name": "Operation Windigo",
            "aliases": [],
            "source_name": "ETDA:Operation Windigo",
            "tools": [
                "CDorked",
                "CDorked.A",
                "Calfbot",
                "Ebury"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1934b371-2525-4615-a90a-772182bc4184",
            "created_at": "2022-10-25T15:50:23.396576Z",
            "updated_at": "2025-03-27T02:00:55.460522Z",
            "deleted_at": null,
            "main_name": "Windigo",
            "aliases": [
                "Windigo"
            ],
            "source_name": "MITRE:Windigo",
            "tools": [
                "Ebury"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c39b0fe6-5642-4717-9a05-9e94265e3e3a",
            "created_at": "2022-10-25T16:07:24.332084Z",
            "updated_at": "2025-03-27T02:02:10.175452Z",
            "deleted_at": null,
            "main_name": "Tonto Team",
            "aliases": [
                "Bronze Huntley",
                "CactusPete",
                "Earth Akhlut",
                "HartBeat",
                "Karma Panda",
                "LoneRanger",
                "Operation Bitter Biscuit",
                "TAG-74",
                "Tonto Team"
            ],
            "source_name": "ETDA:Tonto Team",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Bioazih",
                "Bisonal",
                "CONIME",
                "Dexbia",
                "Korlia",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "POISONPLUG.SHADOW",
                "RoyalRoad",
                "ShadowPad Winnti",
                "XShellGhost"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041678,
    "ts_creation_date": 1568008325,
    "ts_modification_date": 1568008325,
    "files": {
        "pdf": "https://archive.orkl.eu/8cde271eb5fe7b54b667ee88368518c7b2fdbacc.pdf",
        "text": "https://archive.orkl.eu/8cde271eb5fe7b54b667ee88368518c7b2fdbacc.txt",
        "img": "https://archive.orkl.eu/8cde271eb5fe7b54b667ee88368518c7b2fdbacc.jpg"
    }
}