{
    "id": "c31cfe47-3edb-45f6-beb6-94a2baa36155",
    "created_at": "2023-01-12T15:08:06.141505Z",
    "updated_at": "2025-03-27T02:16:59.169792Z",
    "deleted_at": null,
    "sha1_hash": "692a073ffd78ce84e263d1c4c47477ffd34c2ca4",
    "title": "2019-06-13 - New Pervasive Worm Exploiting Linux Exim Server Vulnerability",
    "authors": "",
    "file_creation_date": "2022-05-28T19:24:46Z",
    "file_modification_date": "2022-05-28T19:24:46Z",
    "file_size": 3215670,
    "plain_text": "# New Pervasive Worm Exploiting Linux Exim Server Vulnerability\n\n**[cybereason.com/blog/new-pervasive-worm-exploiting-linux-exim-server-vulnerability](https://www.cybereason.com/blog/new-pervasive-worm-exploiting-linux-exim-server-vulnerability)**\n\nWritten By\nCybereason Nocturnus\n\nJune 13, 2019 | 6 minute read\n\n\n-----\n\n**RESEARCH BY: AMIT SERPER AND MARY ZHAO**\n\n## EXECUTIVE SUMMARY\n\nThere’s an active, ongoing campaign exploiting a widespread vulnerability in linux email\nservers. This attack leverages a week-old vulnerability to gain remote command execution\non the target machine, search the Internet for other machines to infect, and initiates a crypto\nminer.\n\nCurrently, more than 3.5 million servers are at risk worldwide.\nThe attack scours the Internet for a vulnerability discovered last week, CVE-201910149 using already infected servers to spread to as many as possible.\nThe target of this attack, exim servers, run almost 57% of the Internet's email servers.\nThe attack culminates in the downloading of a coin miner payload, which as we have\nseen previously with WannaMine can have a negative impact on any organization.\n\nThese kinds of attacks have big implications for organizations. The recovery process\nfrom this type of attack is costly and time consuming.\n\n[Want to read about a similar incident? Check out our breakdown on WannaMine.](https://www.cybereason.com/cs/c/?cta_guid=787845c3-5652-4e09-9a7c-2b85f7b2a522&placement_guid=47f852be-fe86-4e30-a390-df3155ba3b8c&portal_id=3354902&canon=https%3A%2F%2Fwww.cybereason.com%2Fblog%2Fnew-pervasive-worm-exploiting-linux-exim-server-vulnerability&redirect_url=APefjpGAW80WXTGKeRa9YuQHX3Pxo20WHtI1V5Gsp4phIiWamWWTM7fd_pOjsan65kzlwZJkwjuunHCckXg3ylaGuzAa25xm7FrieVgd2jkgg-UGU9eHTyItQ1GkPENhN74YyHuC_2MHLoLyGCYjihkXtiOgfpCf5mRuMH_GYLLR9wEiRLCizRD95mId7zufFo1CmfF_E7AgWaqWpZ_B9LUGKvBQaaR80LVD1k50nrqf1uOpVgMSsj3kG7mDPcyFauCbgadzHi1FnRsKk0A4Ep8Ln5Ccwe17jdNLr8wqVnmEG3AsJ7Easy9roAWRdXe-xDLx5S06mutF&click=49c464a8-bff4-4da9-8d8c-c390baf2f8c1&hsutk=9d72f8d6480aeb45b663ffd9c4ff7d21&utm_referrer=https%3A%2F%2Fwww.cybereason.com%2Fblog&pageId=10474693938&__hstc=85683782.9d72f8d6480aeb45b663ffd9c4ff7d21.1549915071781.1560882875936.1560895624098.275&__hssc=85683782.2.1560895624098&__hsfp=2749702422)\n\n## SECURITY RECOMMENDATIONS\n\nPatch every EXIM installation you have in your organization and make sure that it is\nupdated to the most recent version, 4.92 at the time of this writing.\nLook for any unfamiliar cronjobs in your crontab and remove them. Restore legitimate\ncron jobs from existing backups.\nDelete the authorized key used for SSH backdoor access.\nKill the coinminer process and delete the coinminer.\nCheck your firewall and access logs for the following hostnames:\n\nhttps://an7kmd2wp4xo7hpr.tor2web.su\nhttps://an7kmd2wp4xo7hpr.tor2web.io\nhttps://an7kmd2wp4xo7hpr.onion.sh\n\nRe-image any compromised servers.\n\n## INTRODUCTION\n\n\n-----\n\n[CVE-2019-10149, which was first discovered on June 5, is now being used as the](https://nvd.nist.gov/vuln/detail/CVE-2019-10149)\nvulnerability for a widespread campaign to attack exim servers and propagate across the\nInternet.\n\n[When first discovered by the Qualys research team, it was dubbed “The Return of the](https://blog.qualys.com/laws-of-vulnerabilities/2019/06/14/exim-mta-vulnerability-the-return-of-the-wizard-cve-2019-10149)\nWIZard”. Successfully exploiting this vulnerability enables both local and remote command\nexecution as root.\n\n[We are aware of an initial wave of attacks that use this vulnerability as described by Freddie](https://www.zdnet.com/google-amp/article/exim-email-servers-are-now-under-attack/?__twitter_impression=true)\nLeeman on June 9, 2019. The first hacker group began pushing exploits from a C2 server\nlocated on the clear web.\n\nA second round of attacks by a different attacker have been analyzed by the Nocturnus\nteam.\n\n**Note: This is a very long script that downloads additional scripts and changes or adds many**\nconfigurations on Linux servers. This blog has the highlights of what the script is doing to\nprovide a fast reference guide to this attack. Some of the things that the script is doing are\nnot documented in this blog post. The hash of the script is available at the end of this article.\nIt has also been uploaded to VirusTotal.\n\n## THE ATTACK\n\nThe Cybereason team has discovered Monero cryptocurrency miners installed on Linux\nservers running vulnerable versions of Exim: aka, cryptojacking. Cryptocurrency miners are\napplications that use system resources without the system owner’s knowledge or consent to\ngenerate profit in the form of virtual coins.\n\nThe infection chain begins with remote command execution to download a malicious script\nthat retrieves code from tor2web domains and uses worm capabilities to spread to other\nvulnerable systems.\n\nThe attackers use the victim machine to scan the Internet for other vulnerable Exim servers.\nOnce found, the attackers will exploit the server to get remote command execution on it and\n[downloaded a script from a tor hidden service through a tor2web service.](https://en.wikipedia.org/wiki/Tor2web)\n\n\n-----\n\n_Bash as a child process of Exim as seen in the Cybereason platform._\n\nThe script has defined three tor2web ‘translation’ services,\n\n_tor2web translation services._\n\n_Rhost is the hidden service address excluding the .onion tor domain._\n\n_TOR1, TOR2, and TOR3 are the ‘translation’ services that will be concatenated later on to_\ncreate a URL. They will use one of the ‘translation’ services in a round-robin sort of way.\n\n[The script looks for any running crypto miners like cryptonight, ddgs,](https://blog.netlab.360.com/ddg-a-mining-botnet-aiming-at-database-server-en/) [Kerberods, and](https://www.trendmicro.com/vinfo/dk/security/news/vulnerabilities-and-exploits/jenkins-vulnerability-exploited-to-drop-kerberods-malware-and-launch-monero-miner)\nnicehash. If it finds any, it terminates them.\n\n\n-----\n\n_Confirming the HUP signal cannot be sent to it._\n\nNext, the script ensures the HUP [signal cannot be sent to it. This ensures that even if the](https://en.wikipedia.org/wiki/SIGHUP)\nterminal is disconnected, the script will continue to run in the background.\n\n_The attack tree as shown by the Cybereason platform._\n\nThe script generates a random string for a file name and a file created in multiple paths.\n\n_The randomly generated string for a file name._\n\n\n-----\n\nOnce the file is created, a cron job is generated to continuously download an updated\nversion of this ‘installation’ script, save it to the randomly generated file name, and\nperpetually execute it.\n\n_Perpetually downloading, saving, and executing the ‘installation’ script._\n\nExisting cron jobs are subsequently deleted.\n\n_Deleting existing cron jobs._\n\n[The script downloads busybox’s](https://www.busybox.net/) [rm,](https://www.busybox.net/downloads/BusyBox.html#rm) [crond, and](https://www.busybox.net/downloads/BusyBox.html#crond) [crontab implementations.](https://www.busybox.net/downloads/BusyBox.html#crontab)\n\n\n-----\n\n_The script downloading rm, crond, and crontab._\n\nOnce the cron jobs are added, the script adds an RSA **[SSH authentication key into the](https://gist.github.com/aserper/e36d382668c6cf2c996c5143025097c0)**\nSSH server.\n\n_The SSH authentication key found in the public/private key authentication file._\n\nThe script configures the SSH server to accept root logins, RSA authentication, PAM and\npassword authentication.\n\n\n-----\n\n_Configuring the SSH server to accept root logins, RSA authentication, PAM and password_\n_authentication._\n\nAfter additional housekeeping operations like deleting temporary files, changing permissions,\netc., the script downloads another script from the same server entitled ‘main’.\n\n**Note: If SSH is not installed on your server, the script will determine which Linux distribution**\nis installed and install an openssh server using the appropriate package management\nsystem (pacman, yum, apt-get, etc).\n\n## The ‘main’ Script\n\n**Note: In its original form, main is Base64 encoded and must be decoded in order to analyze**\nit.\n\nTo start, main determines the Linux distribution on the target machine by executing uname -a\n[and storing it’s output in local variable $ARCH. It looks for the string “alpine” in the output,](https://www.alpinelinux.org/)\nand if it is present, it overwrites local variable $Pref.\n\n_Overwriting $Pref if “alpine” is in the output._\n\n_$Pref is used later on to determine which kind of coinminer payload to download._\n\n\n-----\n\nThe script looks for other coin miners running in the background, or orphaned processes\nrelated to a previous infection, and if any are found, they are terminated.\n\nThe script creates a watchdog with variable $wdog0 that checks if there are any processes\nrunning and, if none are running, it downloads the main script, decode it and execute it with a\nbash process.\n\n_The script creating the watchdog._\n\nThe script has a function e() which runs an inline python script that is Base64 encoded. Once\ndecoded and executed, the script downloads another Base64 blob that decoded into a\n[python script that is a port scanner and exploiter. This scanner-exploiter generates IP](https://gist.github.com/aserper/65fd264c5252557e4d855753c329529a)\naddresses while skipping the private IP prefixes. It connects to vulnerable redis hosts to\ndistribute it’s crypto miner through redis in a very similar fashion to this RedisWannaMine\ncampaign.\n\n## Downloading the Coinminer\n\nSo far, we have discussed the infrastructure work of the operation to establish the coinminer.\nThis next part revolves around downloading the coinminer.\n\nThe $Pref variable is used to determine which version of the coinminer the script should\ndownload.\n\nThe coinminer hidden using a nifty trick.\n\n\n-----\n\nIn the script, there are Windows icon (.ico) files.\n\n_The Windows icon files._\n\n1. ${Pref}64x75.ico - The 64-bit Payload\n\n2. ${Pref}32x75.ico - The 32-bit Payload\n\n_Identifying the value of the ${Pref} variable._\n\nThe value of ${Pref} can be a or r depending on the operating system version that’s detected\nby the script. The script uses this to determine the URL of the file to be downloaded and\ndownloads it manually.\n\n\n-----\n\n_Downloading the .ico file._\nThe downloaded file is a .ico file.\n\n_Identifying the file as a .ico file._\n\nThe file has the correct .ico file header of 00 00 01 00.\n\n_The hexdump of the .ico file._\n\n\n-----\n\nThe file has an actual icon of the GitHub logo.\n\n_The icon of the .ico file._\n\nThis explains why the .ico file is detected as an .ico file. In addition, there is another file\nheader hiding further down in the .ico file in offset 4028.\n\n_Identifying the file as a zip file._\n\nThe file has a pkzip header, which means that this file, while pretending to be an icon file, is\nactually a zip file. When unzipping the file, it asks for a password.\n\n_Trying to unzip the file and being asked for a password._\n\nThe password is in the script.\n\n\n-----\n\n_The password for the zip file is located in the script._\n\nConveniently, the password is “no-password”.\n\n_The contents of the zip file._\n\n_The file’s strings reveals that this is a UPX packed file._\n\n_Identifying the file as a UPX packed file._\n\n_The file’s headers show it is a UPX packed file._\n\n_Unpacking the UPX._\n\nIn unpacking the UPX, it becomes clear the file is a dynamically-linked x86-64 ELF\nexecutable that is stripped from symbols. The strings section reveals that this is an xmr\n(Monero) coin miner.\n\n\n-----\n\n_The strings section of the unpacked UPX._\n\nOnce installed on the infected system, the coin miner makes DNS queries for a newlyregistered domain that uses a TLD for the Soviet Union.\n\n_Domain for DNS queries._\n\n## Conclusion\n\nIt is clear that the attackers went to great lengths to try to hide the intentions of their newlycreated worm. They used hidden services on the TOR network to host their payloads and\ncreated deceiving windows icon files in an attempt to throw off researchers and even system\nadministrators who are looking at their logs.\n\n\n-----\n\nThe prevalence of vulnerable exim servers (3,683,029 across the globe according to\nShodan) allows attackers to compromise many servers in a relatively short period of time, as\nwell as generate a nice stream of cryptocurrency revenue. We highly recommend following\nthe security recommendations above to prevent any damage from taking place.\n\nWant to understand how to improve your defense?\n\n## IOCs\n\nCoinminer:\n\nmd5: b7d96358d06e3bb12055d2e48c4b9796,\n\nsha1: 0e0d47bf6d025b7936e1ed1308fff1b16ee70239\nLdm (script):\n\nMd5: b6bb1379b8cb85e14eb71ca8c5ba8a0d\n\nSha1: 2e89482a14591ade097d252a43d9c1804462ebe6\n\nMain (script):\n\nMd5: 4cec7074f456a0ba7ccc3e5991cce0e3\n\nSha1: d0a6f47669e07d938317ba8bf6ecb8d4fbdcfe7f\n\nDomain - c2 for coinminer\n\ntimesync[.]su\nDomains - tor2web domains for updater script:\n\nAn7kmd2wp4xo7hpr.tor2web.su\n\nAn7kmd2wp4xo7hpr.tor2web.io\n\nan7kmd2wp4xo7hpr.onion.sh\n\n\n-----\n\nAbout the Author\n\n**Cybereason Nocturnus**\n\nThe Cybereason Nocturnus Team has brought the world’s brightest minds from the military,\ngovernment intelligence, and enterprise security to uncover emerging threats across the\nglobe. They specialize in analyzing new attack methodologies, reverse-engineering malware,\nand exposing unknown system vulnerabilities. The Cybereason Nocturnus Team was the first\nto release a vaccination for the 2017 NotPetya and Bad Rabbit cyberattacks.\n\n[All Posts by Cybereason Nocturnus](https://www.cybereason.com/blog/authors/cybereason-nocturnus)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-06-13 - New Pervasive Worm Exploiting Linux Exim Server Vulnerability.pdf"
    ],
    "report_names": [
        "2019-06-13 - New Pervasive Worm Exploiting Linux Exim Server Vulnerability.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536086,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653765886,
    "ts_modification_date": 1653765886,
    "files": {
        "pdf": "https://archive.orkl.eu/692a073ffd78ce84e263d1c4c47477ffd34c2ca4.pdf",
        "text": "https://archive.orkl.eu/692a073ffd78ce84e263d1c4c47477ffd34c2ca4.txt",
        "img": "https://archive.orkl.eu/692a073ffd78ce84e263d1c4c47477ffd34c2ca4.jpg"
    }
}