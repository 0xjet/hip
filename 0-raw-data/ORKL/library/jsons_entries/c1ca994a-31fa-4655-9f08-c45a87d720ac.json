{
    "id": "c1ca994a-31fa-4655-9f08-c45a87d720ac",
    "created_at": "2022-10-25T16:48:20.667405Z",
    "updated_at": "2025-03-27T02:05:30.069152Z",
    "deleted_at": null,
    "sha1_hash": "eeba6bed9a01db3c222e37438c5ea519eee7d617",
    "title": "ChChes - Malware that Communicates with C&C Servers Using Cookie Headers",
    "authors": "JPCERT",
    "file_creation_date": "2017-02-24T13:09:32Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 373117,
    "plain_text": "# Cookie Headers\n\n**blog.jpcert.or.jp/2017/02/chches-malware--93d6.html**\n\nSince around October 2016, JPCERT/CC has been confirming emails that are sent to Japanese organisations with\na ZIP file attachment containing executable files. The targeted emails, which impersonate existing persons, are sent\nfrom free email address services available in Japan. Also, the executable files’ icons are disguised as Word\ndocuments. When the recipient executes the file, the machine is infected with malware called ChChes.\n\nThis blog article will introduce characteristics of ChChes, including its communication.\n\n## ZIP files attached to Targeted Emails\n\nWhile some ZIP files attached to the targeted emails in this campaign contain executable files only, in some cases\nthey also contain dummy Word documents. Below is the example of the latter case.\n\nFigure 1: Example of an attached ZIP file\n\nIn the above example, two files with similar names are listed: a dummy Word document and an executable file\nwhose icon is disguised as a Word document. By running this executable file, the machine will be infected with\nChChes. JPCERT/CC has confirmed the executable files that have signatures of a specific code signing certificate.\nTh d W d d t i h l d it t t i ti li ti l l t d t th fil “Wh\n\n\n-----\n\n## Communication of ChChes\n\nChChes is a type of malware that communicates with specific sites using HTTP to receive commands and modules.\nThere are only few functions that ChChes can execute by itself. This means it expands its functions by receiving\nmodules from C&C servers and loading them on the memory.\n\nThe following is an example of HTTP GET request that ChChes sends. Sometimes, HEAD method is used instead\nof GET.\n\nGET /X4iBJjp/MtD1xyoJMQ.htm HTTP/1.1\nCookie: uHa5=kXFGd3JqQHMfnMbi9mFZAJHCGja0ZLs%3D;KQ=yt%2Fe(omitted)\nAccept: */*\nAccept-Encoding: gzip, deflate\nUser-Agent: [user agent]\nHost: [host name]\nConnection: Keep-Alive\nCache-Control: no-cache\n\nAs you can see, the path for HTTP request takes /[random string].htm, however, the value for the Cookie field is not\nrandom but encrypted strings corresponding to actual data used in the communication with C&C servers. The value\ncan be decrypted using the below Python script.\n\ndata_list = cookie_data.split(';')\ndec = []\nfor i in range(len(data_list)):\ntmp = data_list[i]\npos = tmp.find(\"=\")\nkey = tmp[0:pos]\nval = tmp[pos:]\nmd5 = hashlib.md5()\nmd5.update(key)\nrc4key = md5.hexdigest()[8:24]\nrc4 = ARC4.new(rc4key)\ndec.append(rc4.decrypt(val.decode(\"base64\"))[len(key):])\nprint(\"[*] decoded: \" + \"\".join(dec))\n\nThe following is the flow of communication after the machine is infected.\n\n\n-----\n\n## The First Request\n\nThe value in the Cookie field of the HTTP request that ChChes first sends (Request 1) contains encrypted data\nstarting with ‘A’. The following is an example of data sent.\n\nFigure 3: Example of the first data sent\n\nAs indicated in Figure 3, the data which is sent contains information including computer name. The format of the\nencrypted data differs depending on ChChes’s version. The details are specified in Appendix B.\n\nAs a response to Request 1, ChChes receives strings of an ID identifying the infected machine from C&C servers\n\n\n-----\n\n## Request for Modules and Commands\n\nNext, ChChes sends an HTTP request to receive modules and commands (Request 2). At this point, the following\ndata starting with ‘B’ is encrypted and contained in the Cookie field.\n\nB[ID to identify the infected machine]\n\nAs a response to Request 2, encrypted modules and commands (Response 2) are sent from C&C servers. The\nfollowing shows an example of received modules and commands after decryption.\n\nFigure 5: Decrypted data of modules and commands received\n\nCommands are sent either together with modules as a single data (as above), or by itself. Afterwards, execution\nresults of the received command are sent to C&C servers, and it returns to the process to receive modules and\ncommands. This way, by repeatedly receiving commands from C&C servers, the infected machines will be\ncontrolled remotely.\n\nJPCERT/CC’s research has confirmed modules with the following functions, which are thought to be the bot function\nof ChChes.\n\nEncrypt communication using AES\n\nExecute shell commands\n\nU l d fil\n\n\n-----\n\nLoad and run DLLs\n\nView tasks of bot commands\n\nEspecially, it was confirmed that the module that encrypts the communication with AES is received in a relatively\nearly stage after the infection. With this feature, communication with C&C servers after this point will be encrypted in\nAES on top of the existing encryption method.\n\n## Summary\n\nChChes is a relatively new kind of malware which has been seen since around October 2016. As this may be\ncontinually used for targeted attacks, JPCERT/CC will keep an eye on ChChes and attack activities using the\nmalware.\n\nThe hash values of the samples demonstrated here are described in Appendix C. The malware’s destination hosts\nthat JPCERT/CC has confirmed are listed in Appendix D. We recommend that you check if your machines are\ncommunicating with such hosts.\n\nThanks for reading.\n\n- Yu Nakamura\n\n_(Translated by Yukako Uchida)_\n\n## Appendix A: Code signing certificate\n\nThe code signing certificate attached to some samples are the following:\n\n$ openssl x509 -inform der -text -in mal.cer\nCertificate:\nData:\nVersion: 3 (0x2)\nSerial Number:\n3f:fc:eb:a8:3f:e0:0f:ef:97:f6:3c:d9:2e:77:eb:b9\nSignature Algorithm: sha1WithRSAEncryption\nIssuer: C=US, O=VeriSign, Inc., OU=VeriSign Trust Network, OU=Terms of use\nat https://www.verisign.com/rpa (c)10, CN=VeriSign Class 3 Code Signing 2010 CA\nValidity\nNot Before: Aug 5 00:00:00 2011 GMT\nNot After : Aug 4 23:59:59 2012 GMT\nSubject: C=IT, ST=Italy, L=Milan, O=HT Srl, OU=Digital ID Class 3 Microsoft Software Validation v2, CN=HT Srl\nSubject Public Key Info:\n(Omitted)\n\n\n-----\n\n## Appendix B: ChChes version\n\nThe graph below shows the relation between the version numbers of the ChChes samples that JPCERT/CC has\nconfirmed and the compile times obtained from their PE headers.\n\n\n-----\n\nThe lists below describe encrypted data contained in the first HTTP request and explanation of the values for each\nChChes version.\n\nTable 1: Sending format of each\n\nversion\n\n**Version** **Format**\n\n1.0.0 A*?3618468394??*\n\n1.2.2 A*?3618468394??*\n\n1.3.0 A*?3618468394??*\n\n1.3.2 A*?3618468394??*\n\n1.4.0 A*?3618468394??*\n\n1.4.1 A*?3618468394?? ()*\n\n1.6.4 A**?3618468394?? ()*\n\nTable 2: Description of to\n\n**Letter** **Data** **Size** **Details**\n\nComputer name Variable Capital alphanumeric characters\n\nProcess ID Variable Capital alphanumeric characters\n\nPath of a temp folder Variable %TEMP% value\n\n\n-----\n\nMalware version Variable e.g. 1.4.1\n\nScreen resolution Variable e.g. 1024x768\n\nexplorer.exe version Variable e.g. 6.1.7601.17567\n\nkernel32.dll version Variable e.g. 6.1.7601.17514\n\nPart of MD5 value of SID 16 bytes e.g. 0345cb0454ab14d7\n\n## Appendix C: SHA-256 Hash value of the samples\n\nChChes\n\n5961861d2b9f50d05055814e6bfd1c6291b30719f8a4d02d4cf80c2e87753fa1\n\nae6b45a92384f6e43672e617c53a44225e2944d66c1ffb074694526386074145\n\n2c71eb5c781daa43047fa6e3d85d51a061aa1dfa41feb338e0d4139a6dfd6910\n\n19aa5019f3c00211182b2a80dd9675721dac7cfb31d174436d3b8ec9f97d898b\n\n316e89d866d5c710530c2103f183d86c31e9a90d55e2ebc2dda94f112f3bdb6d\n\nefa0b414a831cbf724d1c67808b7483dec22a981ae670947793d114048f88057\n\ne90064884190b14a6621c18d1f9719a37b9e5f98506e28ff0636438e3282098b\n\n9a6692690c03ec33c758cb5648be1ed886ff039e6b72f1c43b23fbd9c342ce8c\n\nbc2f07066c624663b0a6f71cb965009d4d9b480213de51809cdc454ca55f1a91\n\ne6ecb146f469d243945ad8a5451ba1129c5b190f7d50c64580dbad4b8246f88e\n\ne88f5bf4be37e0dc90ba1a06a2d47faaeea9047fec07c17c2a76f9f7ab98acf0\n\nd26dae0d8e5c23ec35e8b9cf126cded45b8096fc07560ad1c06585357921eeed\n\n2965c1b6ab9d1601752cb4aa26d64a444b0a535b1a190a70d5ce935be3f91699\n\n312dc69dd6ea16842d6e58cd7fd98ba4d28eefeb4fd4c4d198fac4eee76f93c3\n\n4ff6a97d06e2e843755be8697f3324be36e1ebeb280bb45724962ce4b6710297\n\n45d804f35266b26bf63e3d616715fc593931e33aa07feba5ad6875609692efa2\n\ncb0c8681a407a76f8c0fd2512197aafad8120aa62e5c871c29d1fd2a102bc628\n\n75ef6ea0265d2629c920a6a1c0d1dd91d3c0eda86445c7d67ebb9b30e35a2a9f\n\n471b7edbd3b344d3e9f18fe61535de6077ea9fd8aa694221529a2ff86b06e856\n\nae0dd5df608f581bbc075a88c48eedeb7ac566ff750e0a1baa7718379941db86\n\n646f837a9a5efbbdde474411bb48977bff37abfefaa4d04f9fb2a05a23c6d543\n\n3d5e3648653d74e2274bb531d1724a03c2c9941fdf14b8881143f0e34fe50f03\n\n9fbd69da93fbe0e8f57df3161db0b932d01b6593da86222fabef2be31899156d\n\n\n-----\n\n## Appendix D: List of communication destination\n\narea.wthelpdesk.com\n\ndick.ccfchrist.com\n\nkawasaki.cloud-maste.com\n\nkawasaki.unhamj.com\n\nsakai.unhamj.com\n\nscorpion.poulsenv.com\n\ntrout.belowto.com\n\nzebra.wthelpdesk.com\n\nhamiltion.catholicmmb.com\n\ngavin.ccfchrist.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/ud9z8kc33scu3fwbon1at9lcul9h9hw3"
    ],
    "report_names": [
        "JPCERT_ChChes-CampC-Cookie-Headers(02-17-2017)"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1487941772,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/eeba6bed9a01db3c222e37438c5ea519eee7d617.pdf",
        "text": "https://archive.orkl.eu/eeba6bed9a01db3c222e37438c5ea519eee7d617.txt",
        "img": "https://archive.orkl.eu/eeba6bed9a01db3c222e37438c5ea519eee7d617.jpg"
    }
}