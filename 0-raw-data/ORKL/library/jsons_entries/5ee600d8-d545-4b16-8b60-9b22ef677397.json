{
    "id": "5ee600d8-d545-4b16-8b60-9b22ef677397",
    "created_at": "2023-01-12T15:06:16.984413Z",
    "updated_at": "2025-03-27T02:16:59.269413Z",
    "deleted_at": null,
    "sha1_hash": "e043b2f8b353a4fa9205a1583d79873e956ca794",
    "title": "2021-12-16 - Threat Thursday- Warzone RAT Breeds a Litter of ScriptKiddies",
    "authors": "",
    "file_creation_date": "2022-05-28T23:19:01Z",
    "file_modification_date": "2022-05-28T23:19:01Z",
    "file_size": 1741867,
    "plain_text": "# Threat Thursday: Warzone RAT Breeds a Litter of ScriptKiddies\n\n**[blogs.blackberry.com/en/2021/12/threat-thursday-warzone-rat-breeds-a-litter-of-scriptkiddies](https://blogs.blackberry.com/en/2021/12/threat-thursday-warzone-rat-breeds-a-litter-of-scriptkiddies)**\n\nThe BlackBerry Research & Intelligence Team\n\n### Executive Summary\n\nWarzone aims to be the Remote Access Trojan (RAT) of choice for aspiring\nmiscreants on a budget. It is sold on a publicly available website as opposed to on the\ndark web, as a Malware-as-a-Service (MaaS) subscription-based platform. The initial\nsubscription to the malware’s basic RAT builder starts at only $22.95 per month, a\nprice-point which is more likely to attract novice threat actors (aka “script kiddies”).\n\nAdvanced features such as a rootkit, hidden process capability, premium dynamic\nDNS (DDNS), and customer support are available with the upgraded subscription.\nThis premium version is called “Poison,” and it’s sold at a higher fee of $879 for a\nthree-month subscription.\n\n\n-----\n\nThreat actors can also choose to purchase builders for document-based exploit\n[delivery, including a recently disclosed 2021 XLL Excel exploit that the malware author](https://www.fortinet.com/blog/threat-research/signed-sealed-and-delivered-signed-xll-file-delivers-buer-loader)\nclaims is fully undetected, for $2100 per month.\n\n### Operating System\n\n Risk & Impact\n\n Technical Analysis\n\nWarzone is marketed as a “C++ Native RAT” built for Windows®, as seen in the image\nbelow of a post by @Solmyr of Hack Forums, which boasts of continuous updates, support,\nand reliability. The RAT first appeared in 2018 and has received several updates since then.\n\n[This threat is often called “Ave Maria” due to a string it uses, but analysis by yoroi shows](https://team-cymru.com/blog/2019/07/25/unmasking-ave_maria/)\nthat the command-and-control (C2) was using Warzones’ DDNS at\n_anglekeys.warzonedns[.]com._\n\n_Figure 1 - Hack Forums posting_\n\n\n-----\n\nAs is common with malware building kits like this, there are multiple versions that have\nbeen cracked and disseminated. These cracks often have Trojans or backdoors added, in\nwhich case it is necessary to handle analysis even more carefully.\n\nThe latest major builder release is Warzone 2.7, which brought a Hidden Remote Desktop\nProtocol (HRDP) update and support for Windows® 10 Home. HRDP functionality allows\nthe attacker to access the system at the same time as the victim without alerting them. This\nversion has been cracked (as shown in Figure 2) and is easily found on VirusTotal.\n\n_Figure 2 - Cracked folder file listing_\n\nThis RAT is highly configurable. The malware operator can specify things like the IP\naddress and port for the C2 server, as well as payload name, startup options, Alternative\nData Stream (ADS) usage, and numerous other features as shown below.\n\n\n-----\n\n_Figure 3 - Configuration details pane_\n\nChanges that are made to the build options do not necessarily change the overall malicious\ncode, per se. Instead, changes are reflected in a set of configuration information options\nthat are stored in the build payload itself.\n\nDue to this approach, the most recent release (2.7) builder produces all payloads with the\nfollowing Import Hash: 51a1d638436da72d7fa5fb524e02d427\n\n\n-----\n\nThe configuration information is stored in the BSS section RC4-encrypted, with the first\ndword being the length of the key, followed by the key, then the data in Unicode.\n\nThe payload of the configuration information (as of 2.7) has been decoded as follows. All\nflags are 01 if set, 00 if unset.\n\n**Size** **Description**\n\n**dword** Length (i) of C2 string\n\n**i bytes** C2 string\n\n**dword** C2 port (default 5200)\n\n**dword** Unused? – always all 0s\n\n**byte** Install option flag\n\n**dword** Length (j) of install name\n\n**j bytes** Install name\n\n**byte** Startup option flag\n\n**dword** Length (k) of startup name\n\n**k bytes** Startup name\n\n**dword** Local port for reverse proxy (default 5000)\n\n**byte** Offline Log flag\n\n**byte** Persistence/Watchdog flag\n\n**byte** UAC bypass flag\n\n**byte** Defender bypass flag\n\n\n-----\n\n**byte** ADS install + startup flag\n\n**dword** Length (l) of random string\n\n**l bytes** Random string set by builder\n\n_Figure 4 - Password capture management_\n\nUpon connection, the malware searches known file paths, as shown in Figure 4, for stored\ncredentials that it can automatically harvest. This can allow an attacker to potentially score\nquick wins, such as escalating privileges or stealing financial information.\n\n_Figure 5 - Warzone keylogging_\n\nTo extend the password stealing capacity, a silent keylogger (as shown in Figure 5) includes\nfunctionality to track which files are opened, and which control keys have been typed.\n\n\n-----\n\nThe keylogger can be set up to continue collecting logs when the victim is not connected.\nThis is offered as an alternative to the automatic password stealer, allowing the malware\noperator to attempt to catch logins not stored in the system.\n\n_Figure 6 - Post exploit options menu_\n\nThe post exploitation options menu contains many robust choices for stealing\ninformation/lateral movement. As shown in Figure 6 above, these options include the\nfollowing:\n\nVNC connection\nReverse Shell\nFile explorer with option to download\nProcess manager\nRemote webcam to access the victim’s camera\nPassword manager, configurable to dump stored credentials when the client connects\nUninstall remote client\nReverse SOCKS proxy\nDownload and execute, to push further malware to the system\nRemote keylogger, configurable to continue storing keys when the client is offline\nHidden RDP\nPrivilege escalation options, in case the initial client was not configured to attempt\nthese\n\nIf the malware was not already run with elevated privileges, it will attempt to escalate its\n[privileges using an “sdclt” User Access Control (UAC) escalation. Sdclt is a file used in](http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass)\nWindows systems to allow the user to perform backup and restore operations.\n\n\n-----\n\nSdclt is used to automatically elevate privileges by calling another copy of itself as a\nprocess with High Integrity level, bypassing the UAC prompt. Most program calls come from\na context of Medium Integrity; with an sdclt process running in High Integrity, it is now less\nrestricted on file and process access, as though it had been run by an administrator. This\nelevated process then calls control.exe – the Windows Control Panel – which then attempts\nto open the following registry key: HKCU\\Software\\Classes\\Folder\\shell\\open\\command.\n\nHaving done this, the malware sets the path to itself in this key, and it will now be run by the\nsdclt process.\n\nWhen run as an already privileged user, the malware runs the command “powershell Add[MpPreference -ExclusionPath C:\\” to create Windows Defender exclusions for the entire C](https://docs.microsoft.com/en-us/powershell/module/defender/add-mppreference?view=windowsserver2019-ps)\ndrive. This exclusion ensures the malicious actor can move more malware on to the system\nwithout detection.\n\nPersistence can be achieved by copying the payload to “%APPDATA%\\\\Roaming” and\nwriting a registry key in the path\n“HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run.” This ensures that the RAT will\nbe run again each time the user logs in, such as during a system restart. Warzone allows\nfor customization of the install and startup names.\n\nThe malware also includes a configurable watchdog that will place a copy of itself in\n“%ProgramData%” that will run in the event of an unexpected termination.\n\nOn its own, the builder attempts no evasion, and generates payloads which are readily\ndetected as malicious. To prevent such easy detection, many authors opt to use “crypters,”\nwhich are programs that obfuscate the true nature of the malware until runtime. This author\nhas likewise written a crypter that is available for sale, which the author claims can bypass\nmost antivirus (AV) products.\n\n### XLL Exploit\n\n\n-----\n\n_Figure 7 - Advertising for XXL Excel exploit delivery_\n\nThe author of Warzone has also made an XLL exploit builder for sale, which could be used\nto embed a generated payload into an Excel file for delivery via phishing. While we were\nunable to obtain a copy of this builder, XLL files are typically add-in files that allow thirdparty code to add extra functionality to Excel. They are intended to be structured like DLL\nfiles and loaded in similar fashion.\n\n\n-----\n\nThe use of XLL files rather than traditional Excel XLS files for phishing is rare, so it s\npossible that malware authors may have taken notes from the Buer malware – which also\n[uses XLL files – and complicated analysis by signing their files.](https://www.fortinet.com/blog/threat-research/signed-sealed-and-delivered-signed-xll-file-delivers-buer-loader)\n\n### YARA Rule\n\nThe following YARA rule was authored by the BlackBerry Research & Intelligence Team to\ncatch the threat described in this document:\n\n\n-----\n\n**import \"pe\"**\n\n**rule Mal_backdoor_Win32_WarzoneRAT_payload_2021**\n\n**{**\n\n**meta:**\n\n**description = \"Detects WarzoneRAT payload for latest builder (v2.7)\"**\n\n**author = \"Blackberry Threat Research Team \"**\n\n**date = \"2021-12\"**\n\n**license = \"This Yara rule is provided under the Apache License 2.0**\n**[(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or](https://www.apache.org/licenses/LICENSE-2.0)**\n**organization, as long as you use it under this license and ensure originator credit**\n**in any derivative to The BlackBerry Research & Intelligence Team\"**\n\n**strings:**\n\n**$string0 = \"warzone160\"**\n\n**$string1 = \"PK11_Authenticate\"**\n\n**$string2 = \"dUser32.dll\" wide**\n\n**$string3 = \"\\\\logins.json\" wide**\n\n**$string4 = \"Account Name\" wide**\n\n**$string5 = \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\"**\n\n**$string6 = \"NSSBase64_DecodeBuffer\"**\n\n**$string7 = \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\\" wide**\n\n**$string8 = \"\\\\Slimjet\\\\User Data\\\\Default\\\\Login Data\" wide**\n\n**$string9 = \":start\" wide**\n\n**$string10 = \"sqlite3_column_bytes\"**\n\n**$string11 = \"tG;HtsB\"**\n\n**$string12 = \"profiles.ini\" wide**\n\n**$string13 = \"\\\\Chromium\\\\User Data\\\\Local State\" wide**\n\n**$string14 = \"NtProtectVirtualMemory\"**\n\n**$string15 = \"ExplorerIdentifier\" wide**\n\n**$string16 = \"RtlGetVersion\"**\n\n**condition:**\n\n**//Must be a PE File**\n\n**uint16(0) == 0x5a4d and**\n\n**//Must have specified imphash**\n\n**pe.imphash() == \"51a1d638436da72d7fa5fb524e02d427\" and**\n\n**//Must be greater then 95KB**\n\n**filesize > 95KB and**\n\n**//Must have the section name .bss**\n\n**pe.sections[pe.number_of_sections-1].name == \".bss\" and**\n\n**//All Strings**\n\n**all of them**\n\n**}**\n\n### Indicators of Compromise (IoCs)\n\n\n-----\n\n**Warzone_all_hashes file:**\n\n**String: warzone160**\n\n**CommandLine: powershell Add-MpPreference -ExclusionPath C:\\**\n\n**Registry: HKCU\\Software\\_rptls**\n\n**ImpHash: 51a1d638436da72d7fa5fb524e02d427**\n\n**SHAs: (sample of 1.5k in Warzone_all_hashes file)**\n\n2944c31732655f1d470e483ab539c81e4fa0ec80b0f8753b4a856b0c894476e6\n\nfcfd3248548efd7b521afddc86809165fd4b921f021130171335168247e7355b\n\nb5d3060af008a045b96ff6362131d8b2f05d56f480cd5c01d960c21c4609b34a\n\na0584917b318ebeab9938cedabb1f2d184a33c5f33c2e6992968c9804360857f\n\n9d56ad7e390d35d3fcf2bc03ac7b38e5efeee12e8bbc2917a375e6cf8c65d69f\n\n066c455fdfc44d36695e2e0a97c41c25e8d2d21a90576f649159b16af4ffd860\n\n5521c70600320df5bd5bbc6ef6ddc33f62e2078c7701452a60a58745adff1ffb\n\ne85769eee5f2539084a2da5bf79027849249130be251d1f2e8b3de0021d194ab\n\nb48c8a6fd76389cc51d279f896aa61d152212ce87b46a67b1171e3c40794eb4e\n\n0968aac5baa3ca0333c06de5803c08300465441092fba720f9efe88f68cde4a0\n\n5b6ac94ed2e8e2fda33d432f739588ad97db7a8865e51dc7ea2dc758eb1ed9cd\n\n### MITRE ATT&CK Matrix TTPs\n\nThe activities described in this report are mapped to the following MITRE ATT&CK® Matrix\ntactics, techniques, and procedures:\n\n**Lateral Movement:**\n\n[T1021 – Remote Services - Remote Desktop Protocol and VNC available](https://attack.mitre.org/techniques/T1021/)\n\n**Collection:**\n\n[T1125 – Video Capture](https://attack.mitre.org/techniques/T1125/)\n\n**Collection, Credential access:**\n\n[T1056.001 – Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001/)\n\n**Credential access:**\n\n\n-----\n\n[T1552.001 – Unsecured Credentials: Credentials in Files](https://attack.mitre.org/techniques/T1552/001/)\n\n**Execution:**\n\n[T1059.003 – Command and Scripting Interpreter: Windows Command Shell](https://attack.mitre.org/techniques/T1059/003/)\n\n**Persistence:**\n\n[T1137 – Office Application Startup](https://attack.mitre.org/techniques/T1137/)\n\n**Persistence, Privilege escalation:**\n\n[T1547.001 - Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001/)\n\n**Privilege escalation, Defense evasion:**\n\n[T1548.002 – Bypass User Account Control](https://attack.mitre.org/techniques/T1548/002/)\n\n**Exfiltration:**\n\n[T1041 – Exfiltration over C2 Channel](https://attack.mitre.org/techniques/T1041/)\n\n**Command-and-control:**\n\n[T1219 – Remote Access Software](https://attack.mitre.org/techniques/T1219/)\n\n**Discovery:**\n\n[T1083 – File and Directory Discovery](http://t1083/)\n\n[T1087 – Account Discovery](https://attack.mitre.org/techniques/T1087/)\n\n### BlackBerry Assistance\n\nIf you’re battling this malware or a similar threat, you’ve come to the right place, regardless\nof your existing BlackBerry relationship.\n\n[The BlackBerry Incident Response team is made up of world-class consultants dedicated to](https://www.blackberry.com/us/en/services/incident-response)\nhandling response and containment services for a wide range of incidents, including\nransomware and Advanced Persistent Threat (APT) cases.\n\nWe have a global consulting team standing by to assist you providing around-the-clock\nsupport, where required, as well as local assistance. Please contact us here:\nhttps://www.blackberry.com/us/en/forms/cylance/handraiser/emergency-incident-responsecontainment\n\n\n-----\n\n## About The BlackBerry Research & Intelligence Team\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats,\nproviding intelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-16 - Threat Thursday- Warzone RAT Breeds a Litter of ScriptKiddies.pdf"
    ],
    "report_names": [
        "2021-12-16 - Threat Thursday- Warzone RAT Breeds a Litter of ScriptKiddies.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535976,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653779941,
    "ts_modification_date": 1653779941,
    "files": {
        "pdf": "https://archive.orkl.eu/e043b2f8b353a4fa9205a1583d79873e956ca794.pdf",
        "text": "https://archive.orkl.eu/e043b2f8b353a4fa9205a1583d79873e956ca794.txt",
        "img": "https://archive.orkl.eu/e043b2f8b353a4fa9205a1583d79873e956ca794.jpg"
    }
}