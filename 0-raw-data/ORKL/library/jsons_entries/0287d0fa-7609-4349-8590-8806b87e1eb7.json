{
    "id": "0287d0fa-7609-4349-8590-8806b87e1eb7",
    "created_at": "2023-01-12T15:02:38.772509Z",
    "updated_at": "2025-03-27T02:12:44.214038Z",
    "deleted_at": null,
    "sha1_hash": "f893196b1caaeefc2ae11526fb08d6975f4da2b1",
    "title": "2020-08-14 - Alert (AA20-227A)- Phishing Emails Used to Deploy KONNI Malware",
    "authors": "",
    "file_creation_date": "2022-05-29T01:05:11Z",
    "file_modification_date": "2022-05-29T01:05:11Z",
    "file_size": 115160,
    "plain_text": "# Phishing Emails Used to Deploy KONNI Malware\n\n**us-cert.cisa.gov/ncas/alerts/aa20-227a**\n\n## Summary\n\n_This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge_\n_(ATT&CK®) framework. See the_ _[ATT&CK for Enterprise framework for all referenced threat](https://attack.mitre.org/versions/v7/matrices/enterprise/)_\n_actor techniques._\n\nThe Cybersecurity and Infrastructure Security Agency (CISA) has observed cyber actors\nusing emails containing a Microsoft Word document with a malicious Visual Basic Application\n(VBA) macro code to deploy KONNI malware. KONNI is a remote administration tool (RAT)\nused by malicious cyber actors to steal files, capture keystrokes, take screenshots, and\nexecute arbitrary code on infected hosts.\n\n## Technical Details\n\nKONNI malware is often delivered via phishing emails as a Microsoft Word document with a\nmalicious VBA macro code (Phishing: Spearphising Attachment [[T1566.001]). The malicious](https://attack.mitre.org/versions/v7/techniques/T1566/001/)\ncode can change the font color from light grey to black (to fool the user to enable content),\ncheck if the Windows operating system is a 32-bit or 64-bit version, and construct and\nexecute the command line to download additional files (Command and Scripting Interpreter:\n_Windows Command Shell_ [[T1059.003]).](https://attack.mitre.org/versions/v7/techniques/T1059/003/)\n\nOnce the VBA macro constructs the command line, it uses the certificate database tool\nCertUtil to download remote files from a given Uniform Resource Locator. It also incorporates\na built-in function to decode base64-encoded files. The Command Prompt silently copies\n```\ncertutil.exe into a temp directory and renames it to evade detection.\n\n```\nThe cyber actor then downloads a text file from a remote resource containing a base64encoded string that is decoded by CertUtil and saved as a batch (.BAT) file. Finally, the cyber\nactor deletes the text file from the temp directory and executes the .BAT file.\n\n## MITRE ATT&CK Techniques\n\nAccording to MITRE, [KONNI uses the ATT&CK techniques listed in table 1.](https://attack.mitre.org/versions/v7/software/S0356/)\n\n_Table 1: KONNI ATT&CK techniques_\n\n**Technique** **Use**\n\n\n-----\n\n**Technique** **Use**\n\n\n_System Network_\n_Configuration Discovery_\n\n[[T1016]](https://attack.mitre.org/versions/v7/techniques/T1016)\n\n_System Owner/User_\n_Discovery_ [[T1033]](https://attack.mitre.org/versions/v7/techniques/T1033)\n\n_Masquerading: Match_\n_Legitimate Name or_\n_[Location [T1036.005]](https://attack.mitre.org/versions/v7/techniques/T1036/005)_\n\n_Exfiltration Over_\n_Alternative Protocol:_\n_Exfiltration Over_\n_Unencrypted/Obfuscated_\n_Non-C2 Protocol_\n\n[[T1048.003]](https://attack.mitre.org/versions/v7/techniques/T1048/003)\n\n_Input Capture:_\n_[Keylogging [T1056.001]](https://attack.mitre.org/versions/v7/techniques/T1056/001)_\n\n_Process Discovery_\n\n[[T1057]](https://attack.mitre.org/versions/v7/techniques/T1057)\n\n_Command and Scripting_\n_Interpreter: PowerShell_\n\n[[T1059.001]](https://attack.mitre.org/versions/v7/techniques/T1059/001)\n\n_Command and Scripting_\n_Interpreter: Windows_\n_Command Shell_\n\n[[T1059.003]](https://attack.mitre.org/versions/v7/techniques/T1059/003)\n\n_Indicator Removal on_\n_Host: File Deletion_\n\n[[T1070.004]](https://attack.mitre.org/versions/v7/techniques/T1070/004)\n\n_Application Layer_\n_Protocol: Web Protocols_\n\n[[T1071.001]](https://attack.mitre.org/versions/v7/techniques/T1071/001)\n\n\nKONNI can collect the Internet Protocol address from the\nvictim’s machine.\n\nKONNI can collect the username from the victim’s machine.\n\nKONNI creates a shortcut called `Anti virus service.lnk`\nin an apparent attempt to masquerade as a legitimate file.\n\nKONNI has used File Transfer Protocol to exfiltrate\nreconnaissance data out.\n\nKONNI has the capability to perform keylogging.\n\nKONNI has used `tasklist.exe to get a snapshot of the`\ncurrent processes’ state of the target machine.\n\nKONNI used PowerShell to download and execute a specific\n64-bit version of the malware.\n\nKONNI has used `cmd.exe to execute arbitrary commands`\non the infected host across different stages of the infection\nchange.\n\nKONNI can delete files.\n\nKONNI has used Hypertext Transfer Protocol for command\nand control.\n\n\n-----\n\n**Technique** **Use**\n\n\n_System Information_\n_[Discovery [T1082]](https://attack.mitre.org/versions/v7/techniques/T1082)_\n\n_File and Directory_\n_Discovery_ [[T1083]](https://attack.mitre.org/versions/v7/techniques/T1083)\n\n_Ingress Tool Transfer_\n\n[[T1105]](https://attack.mitre.org/versions/v7/techniques/T1105)\n\n\nKONNI can gather the operating system version, architecture\ninformation, connected drives, hostname, and computer name\nfrom the victim’s machine and has used `systeminfo.exe to`\nget a snapshot of the current system state of the target\nmachine.\n\nA version of KONNI searches for filenames created with a\nprevious version of the malware, suggesting different versions\ntargeted the same victims and the versions may work\ntogether.\n\nKONNI can download files and execute them on the victim’s\nmachine.\n\n\n_[Modify Registry [T1112]](https://attack.mitre.org/versions/v7/techniques/T1112)_ KONNI has modified registry keys of ComSysApp service and\nSvchost on the machine to gain persistence.\n\n_[Screen Capture [T1113]](https://attack.mitre.org/versions/v7/techniques/T1113)_ KONNI can take screenshots of the victim’s machine.\n\n_[Clipboard Data [T1115]](https://attack.mitre.org/versions/v7/techniques/T1115)_ KONNI had a feature to steal data from the clipboard.\n\n\n_Data Encoding: Standard_\n_[Encoding [T1132.001]](https://attack.mitre.org/versions/v7/techniques/T1132/001)_\n\n_Access Token_\n_Manipulation: Create_\n_Process with Token_\n\n[[T1134.002]](https://attack.mitre.org/versions/v7/techniques/T1134/002)\n\n_Deobfuscate/Decode_\n_Files or Information_\n\n[[T1140]](https://attack.mitre.org/versions/v7/techniques/T1140)\n\n_Signed Binary Proxy_\n_Execution: Rundll32_\n\n[[T1218.011]](https://attack.mitre.org/versions/v7/techniques/T1218/011)\n\n\nKONNI has used a custom base64 key to encode stolen data\nbefore exfiltration.\n\nKONNI has duplicated the token of a high integrity process to\nspawn an instance of cmd.exe under an impersonated user.\n\nKONNI has used CertUtil to download and decode base64\nencoded strings.\n\nKONNI has used Rundll32 to execute its loader for privilege\nescalation purposes.\n\n\n-----\n\n**Technique** **Use**\n\n\n_Event Triggered_\n_Execution: Component_\n_Object Model Hijacking_\n\n[[T1546.015]](https://attack.mitre.org/versions/v7/techniques/T1546/015)\n\n_Boot or Logon Autostart_\n_Execution: Registry Run_\n_Keys / Startup Folder_\n\n[[T1547.001]](https://attack.mitre.org/versions/v7/techniques/T1547/001)\n\n_Boot or Logon Autostart_\n_Execution: Shortcut_\n_Modification_ [[T1547.009]](https://attack.mitre.org/versions/v7/techniques/T1547/009)\n\n_Abuse Elevation Control_\n_Mechanism: Bypass User_\n_Access Control_\n\n[[T1548.002]](https://attack.mitre.org/versions/v7/techniques/T1548/002)\n\n_Credentials from_\n_Password Stores:_\n_Credentials from Web_\n_[Browsers [T1555.003]](https://attack.mitre.org/versions/v7/techniques/T1555/003)_\n\n## Detection\n\n**Signatures**\n\n\nKONNI has modified ComSysApp service to load the\nmalicious DLL payload.\n\nA version of KONNI drops a Windows shortcut into the\nStartup folder to establish persistence.\n\nA version of KONNI drops a Windows shortcut on the victim’s\nmachine to establish persistence.\n\nKONNI bypassed User Account Control with the\n\"AlwaysNotify\" settings.\n\nKONNI can steal profiles (containing credential information)\nfrom Firefox, Chrome, and Opera.\n\n\nCISA developed the following Snort signatures for use in detecting KONNI malware exploits.\n```\nalert tcp any any -> any $HTTP_PORTS (msg:\"HTTP URI contains '/weget/*.php'\n(KONNI)\"; sid:1; rev:1; flow:established,to_server; content:\"/weget/\";\nhttp_uri; depth:7; offset:0; fast_pattern; content:\".php\"; http_uri;\ndistance:0; within:12; content:!\"Referrer|3a 20|\"; http_header;\nclasstype:http-uri; priority:2; metadata:service http;)\nalert tcp any any -> any $HTTP_PORTS (msg:\"KONNI:HTTP header contains\n'User-Agent|3a 20|HTTP|0d 0a|'\"; sid:1; rev:1; flow:established,to_server;\ncontent:\"User-Agent|3a 20|HTTP|0d 0a|\"; http_header; fast_pattern:only;\ncontent:\"POST\"; nocase; http_method; classtype:http-header; priority:2;\nmetadata:service http;)\n\n```\n\n-----\n\n```\nalert tcp any any -> any $HTTP_PORTS (msg: KONNI:HTTP URI contains\n'/weget/(upload|uploadtm|download)'\"; sid:1; rev:1;\nflow:established,to_server; content:\"/weget/\"; http_uri; fast_pattern:only;\npcre:\"/^\\/weget\\x2f(?:upload|uploadtm|download)\\.php/iU\"; content:\"POST\";\nhttp_method; classtype:http-uri; priority:2;\nreference:url,blog.talosintelligence.com/2017/07/konni-references-northkorean-missile-capabilities.html; metadata:service http;)\n\n## Mitigations\n\n```\nCISA recommends that users and administrators consider using the following best practices\nto strengthen the security posture of their organization's systems. Any configuration changes\nshould be reviewed by system owners and administrators prior to implementation to avoid\nunwanted impacts.\n\nMaintain up-to-date antivirus signatures and engines. See Protecting Against Malicious\nCode.\nKeep operating system patches up to date. See Understanding Patches and Software\nUpdates.\nDisable file and printer sharing services. If these services are required, use strong\npasswords or Active Directory authentication.\nRestrict users' ability (permissions) to install and run unwanted software applications.\nDo not add users to the local administrators’ group unless required.\nEnforce a strong password policy. See [Choosing and Protecting Passwords.](https://us-cert.cisa.gov/ncas/tips/ST04-002)\nExercise caution when opening email attachments, even if the attachment is expected\n[and the sender appears to be known. See Using Caution with Email Attachments.](https://us-cert.cisa.gov/ncas/tips/ST04-010)\nEnable a personal firewall on agency workstations, configured to deny unsolicited\nconnection requests.\nDisable unnecessary services on agency workstations and servers.\nScan for and remove suspicious email attachments; ensure the scanned attachment is\nits \"true file type\" (i.e., the extension matches the file header).\nMonitor users' web browsing habits; restrict access to sites with unfavorable content.\nExercise caution when using removable media (e.g., USB thumb drives, external\ndrives, CDs).\nScan all software downloaded from the internet prior to executing.\nMaintain situational awareness of the latest threats and implement appropriate access\ncontrol lists.\nVisit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional\nmitigation and detection strategies.\n\nFor additional information on malware incident prevention and handling, see the National\nInstitute of Standards and Technology Special Publication 800-83, \"Guide to Malware\nIncident Prevention and Handling for Desktops and Laptops.\"\n\n\n-----\n\n## Resources\n\n Revisions\n\nAugust 14, 2020: Initial Version\n\n[This product is provided subject to this Notification and this](https://us-cert.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/alerts/aa20-227a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-14 - Alert (AA20-227A)- Phishing Emails Used to Deploy KONNI Malware.pdf"
    ],
    "report_names": [
        "2020-08-14 - Alert (AA20-227A)- Phishing Emails Used to Deploy KONNI Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43c8747-c898-448a-88a9-76bff88e91b5",
            "created_at": "2024-02-02T02:00:04.058535Z",
            "updated_at": "2025-03-27T02:00:03.302832Z",
            "deleted_at": null,
            "main_name": "Opal Sleet",
            "aliases": [
                "OSMIUM",
                "Konni",
                "Vedalia"
            ],
            "source_name": "MISPGALAXY:Opal Sleet",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b9458777-d970-4e89-b2d2-e532140a390f",
            "created_at": "2024-05-01T02:03:08.140328Z",
            "updated_at": "2025-03-27T02:05:17.41728Z",
            "deleted_at": null,
            "main_name": "NICKEL JUNIPER",
            "aliases": [
                "OSMIUM ",
                "Opal Sleet ",
                "Konni"
            ],
            "source_name": "Secureworks:NICKEL JUNIPER",
            "tools": [
                "KONNI"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535758,
    "ts_updated_at": 1743041564,
    "ts_creation_date": 1653786311,
    "ts_modification_date": 1653786311,
    "files": {
        "pdf": "https://archive.orkl.eu/f893196b1caaeefc2ae11526fb08d6975f4da2b1.pdf",
        "text": "https://archive.orkl.eu/f893196b1caaeefc2ae11526fb08d6975f4da2b1.txt",
        "img": "https://archive.orkl.eu/f893196b1caaeefc2ae11526fb08d6975f4da2b1.jpg"
    }
}