{
    "id": "2f629176-99f1-4225-bb20-a82f9ef8a236",
    "created_at": "2022-10-25T16:48:19.852526Z",
    "updated_at": "2025-03-27T02:09:18.533017Z",
    "deleted_at": null,
    "sha1_hash": "6d03626f3e8541ce48c209e8bac608583c600cbf",
    "title": "Egregor Ransomware, Used in a String of High-Profile Attacks, Shows Connections to QakBot",
    "authors": "",
    "file_creation_date": "2020-12-02T17:33:42Z",
    "file_modification_date": "2020-12-02T17:34:36Z",
    "file_size": 1795216,
    "plain_text": "## CYBER THREAT ANALYSIS By Insikt Group®\n\n##### CTA-2020-1203\n\n# EGREGOR RANSOMWARE, USED IN A STRING OF HIGH- PROFILE ATTACKS, SHOWS\n\n\n-----\n\n_This report provides an overview of the ransomware variant Egregor as well as_\n_suggested mitigations and detections. Recorded Future used the Recorded Future®_\n_Platform, PolySwarm, open source intelligence (OSINT) sources, and malware analysis_\n_to derive these detections. The target audience of this research includes day-to-day_\n_security practitioners as well executive decision-makers concerned about targeting_\n_by ransomware threat actors._\n\n#### Executive Summary\n\nEgregor ransomware is a complex piece of malware that appears\n\nto be associated with the operators of QakBot. The ransomware has\n\nbeen used against organizations across many industries since its debut\n\nin September 2020 and is likely to continue to present a threat to\n\norganizations in the future. Unlike most ransomware variants, Egregor’s\n\npayload cannot be executed or decrypted fully without the correct\n\ncryptographic key provided to the malware at runtime, rendering static\n\nor dynamic analysis impossible. Because very little is known about the\n\ndeployment of the ransomware in open sources and how the threat actors\n\ntarget victims, Recorded Future recommends employing mitigations for\n\ntechnical threats used by other “big game hunting” threat actors to\n\nmitigate the threat prior to ransom, using the provided hunting package\n\nto threat hunt Egregor and ensuring that internet-facing systems are\n\nappropriately configured to provide only the minimum needed access.\n\n\n#### Key Judgments\n\n   - The Egregor ransomware is a complex piece of malware,\n\nemploying obfuscation and anti-analysis techniques. In order to\n\nfully decrypt and deploy the payload, the password associated\n\nwith the sample must be provided at runtime.\n\n   - Egregor ransomware is connected to the QakBot operators.\n\n   - The targets of the Egregor ransomware are organizations,\n\nwhich Egregor both ransoms and uses the “name and shame”\n\ndouble extortion technique to further victimize the companies.\n\n#### Background\n\nEgregor ransomware is part of the Sekhmet ransomware family\n\nand has been active since mid-September 2020. The name of the new\n\nransomware strain, Egregor, is derived from Western occult traditions\n\n[and is defined as the collective energy of a group of people, especially](https://occult-world.com/egregor/)\n\nwhen aligned to a common goal.\n\nLike many current ransomware variants, Egregor uses the “double\nextortion” model of both encrypting files and naming and shaming\n\nvictims and releasing stolen data on an extortion website to increase\n\npressure on a victim to pay the ransom. Egregor News is an extortion\n\nwebsite operated by the threat actors behind Egregor ransomware and\n\nis used to post the names and domains, along with data sets of Egregor\n\nvictims. If the victim refuses to pay within three days, the threat actors\n\nwill continue to leak additional data in increments ranging from 1 percent\n\nto 100 percent of the total stolen data. The most high-profile Egregor\n\nvictim to date is the bookseller Barnes & Noble, with the ransomware\n\noperators claiming they stole unencrypted data prior to encrypting files\n\non October 10, 2020.\n\n\n-----\n\n_Figure 2: Ransomware victims chart, by ransomware variant (Source: Recorded Future)_\n\nAccording to the information available on Egregor News, they claimed 133\n\nvictims and are responsible for 13 percent of all currently known ransomware\n\nextortion cases, which is a large number for just two months of operations. We\n\nbelieve that ransomware operators and their affiliates are opportunistic by nature\n\nand do not focus on specific industries or geographic regions, but rather select\n\nand pursue corporations based on accessibility, opportunity, and company’s\n\nrevenue. These threat actors will very likely continue to consistently target larger\n\norganizations. This assessment is predicated on the understanding that the wide\n\nattack surface inherent to large corporations gives threat actors more chances to\n\ngain access. Furthermore, these businesses maintain an abundance of resources,\n\nand generally have strong cyber insurance policies, making it more likely that they\n\nwill pay a large ransom demand.\n\n[According to a Bankinfosecurity article, QakBot operators have abandoned](https://www.bankinfosecurity.com/qbot-banking-trojan-now-deploying-egregor-ransomware-a-15430)\n\nProLock for Egregor ransomware. The TTPs used by the threat actors in Egregor\n\nattacks are almost identical to the ones used by the ProLock operators. Group-IB\n\n[experts consider it very likely that QakBot operators have switched from ProLock](https://www.group-ib.com/media/egregor/)\n\nto Egregor ransomware because the threat actors always employ Microsoft Excel\n\ndocuments impersonating DocuSign-encrypted spreadsheets to deliver Qakbot\n\nas an initial access vector. Also, Egregor operators have been using Rclone for\n\ndata exfiltration, and the same tools and naming convention have been used as\n\nwell — for example, md.exe, rdp.bat, and svchost.exe.\n\n#### Technical Analysis\n\nRecorded Future’s Insikt Group identified several copies of packed Egregor\n\nransomware and performed analysis on these samples. The ransomware has\n\nthree main “stages”: the top-level packer that decrypts the next stage using the\n\nSalsa20 stream cipher with compiled-in keys, a subsequent stage that uses a\n\ncryptographic key passed in at runtime to decrypt the payload, and finally the\n\nEgregor payload. Without the correct key passed to the ransomware when it\n\nis run, the payload is unable to be decrypted and analyzed either statically or\n\ndynamically. We identified one sample and cryptographic key pair that enabled\n\nanalysis of the Egregor payload. To detonate the malware, the command that is\n\nrun is:\n\nrundll32.exe <dllname>.dll,DllRegisterServer -p<cryptographic key>\n\n<payload arguments>\n\n\n#### Initial Access\n\nCurrently, Recorded Future has not observed any open source information\n\nregarding the initial access vectors used by the threat actors behind Egregor.\n\n[Several other researchers have tied Egregor to the Maze ransomware variant at](https://www.bleepingcomputer.com/news/security/maze-ransomware-is-shutting-down-its-cybercrime-operation/)\n\nthe technical level, suggesting that similar initial access techniques could be used\n\nby the Egregor threat actors as those used by the Maze operators. Historically, the\n\noperators of Maze ransomware employed a wide array of techniques to gain initial\n\n[access to organizations, most recently using RDP and remote services as initial](https://twitter.com/VK_Intel/status/1251388507219726338)\n\n[access vectors to victim systems, but also exploiting CVE-2018-15982 and CVE-](https://unit42.paloaltonetworks.com/threat-brief-maze-ransomware-activities/)\n\n2018-4878 in Flash Player, CVE-2019-11510 in Pulse VPN, and CVE-2018-8174 in\n\nInternet Explorer. While past behavior does not guarantee future behavior, Maze’s\n\noperators have used a wide variety of initial access vectors, suggesting that the\n\nthreat actors behind Egregor may also do so.\n\n#### Reconnaissance and Lateral Movement\n\nRecorded Future has not observed any open source information regarding\n\nreconnaissance or lateral movement tools. Many threat actors are using Cobalt\n\nStrike Beacon and QakBot to enable reconnaissance and lateral movement, as well\n\n[as deploying a variety of commodity tools such as Mimikatz, PowerShell Empire,](https://github.com/gentilkiwi/mimikatz)\n\n[and Metasploit prior to dropping and executing the ransomware payload.](https://www.metasploit.com/)\n\n#### Stage One Packer\n\nThe files identified by Insikt Group as containing the initial packer stage\n\nused by Egregor were highly similar in form and function, differing primarily\n\nin the compiled-in Salsa20 cryptographic keys, the file path it looks for upon\n\ninitialization, and a command line parameter it checks for (but does not appear to\n\nhave any real utility to the execution of the code). In addition, while some of the\n\nfiles did not employ obfuscation to the code, several did to complicate the static\n\nand dynamic reverse engineering process. This could suggest that the different\n\ncopies originate from different affiliates, some who employ an obfuscator tool and\n\nsome who do not. It is likely that this obfuscation is introduced by a tool, since\n\nboth obfuscated and unobfuscated versions were observed in the wild, but Insikt\n\nGroup is not sure whether the tool is homegrown by the actors or a commodity\n\nitem purchased or downloaded from the internet\n\n\n-----\n\nTo decrypt the second stage of the packed payload, which is contained in the\n\n.data section, the malware first does an XOR of the data with either 3 or 4, then\n\ndoes a base64-decode of the data, and finally the Salsa20 decryption. This code,\n\nfrom a sample that did not employ any anti-RE obfuscation, can be seen in Figure 3.\n\n_Figure 3: Top-level packer for Egregor_\n\n#### Stage Two Packer\n\nThe second stage of the packer was nearly identical in every sample of\n\nthe malware analyzed by Insikt Group. This stage was unobfuscated, even when\n\nextracted from samples that had an obfuscated stage one packer. The primary\n\nfunctionality of this stage is to create a thread that will read the cryptographic key\n\npassed in after the “-p” in the aforementioned malware execution command, and\n\nuse that to decrypt the Egregor payload. The decryption scheme appears custom,\n\nwith elements of SHA256 hashing and the lesser-known [Rabbit cryptographic](https://www.ietf.org/rfc/rfc4503.txt?number=4503)\n\ncipher combined to decrypt the payload. If it successfully decrypts this stage, it\n\nwill run the decrypted payload. Typically, Insikt Group has not observed Rabbit\n\ncryptography employed in other ransomware variants.\n\n#### Egregor Payload\n\nThe Egregor payload, if successfully decrypted, will cause the victim system\n\nto be encrypted. The ransomware contains obfuscation, both for the code and for\n\nsome of the data contained within it. It also encrypts the ransom note contents,\n\nservices, and processes to stop, and almost all of the strings that would help\n\nan analyst determine what the code was doing. A technical analysis of the\n\nransomware payload revealed the following:\n\n   - A simple rolling XOR-based obfuscation technique is used to hide some\n\nof the strings in the malware. We have not observed this specific cipher\n\nin use by other ransomware variants.\n\n   - The malware contains an encrypted chunk of data, prefaced with “.PNG”,\n\nincluding the contents of the ransom note, a list of processes and\n\nservices to stop, and a public RSA key. These pieces of data are used\n\nthroughout the execution of the ransomware.\n\n   - Egregor’s payload can accept several command line arguments, including:\n\n       - --fast: The parameter requires a number as an argument, the file\n\nsize in megabytes, and is used to limit file size for encryption.\n\n       - --full: perform encryption of the full victim system (including local\n\nand network drives).\n\n       - --multiproc: if set, does not create mutex Global\\\\<system data\n\nand CRC32 hash>. This value is presumably created to ensure\n\nonly one copy runs at a time. This same string of characters is\n\nplaced in the ransom note to identify the victim.\n\n\n\n    - --nomimikatz: Insikt Group was unable to determine the\n\n[functionality of this parameter. Mimikatz is an open source toolkit](https://github.com/gentilkiwi/mimikatz)\n\nthat allows the extraction of plaintext passwords, Kerberos\n\ntickets, PINs, and hashes from memory, so this parameter may be\n\nrelated to collecting user authentication information.\n\n    - --nonet: does not encrypt network drives.\n\n    - --path: specific folder to encrypt.\n\n    - --target: target extension for encryption.\n\n    - --append: file extension to append to encrypted files. Otherwise,\n\na random series of five to six characters (in our analysis) is\n\nappended to the filenames.\n\n    - --norename: does not rename the files it encrypts.\n\n    - --greetings: prepends the name to the ransom note, presumably\n\nto directly address a victim.\n\n    - --samba: Insikt Group was unable to determine the functionality\n\nof this parameter. TrendMicro [indicates that the parameter is](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/Ransom.Win32.EGREGOR.A/)\n\nused to set the DELETE_ON_CLOSE attribute for created .lnk files.\n\n    - --killrdp: the malware also looks for TeamViewer and TermService\n\n(Remote Desktop Service) by name and shuts the services down.\n\n- The malware checks the “Default Language ID” of the victim system and\n\nuser account. If the language is any of the following, it exits and does\n\nnot execute: Uzbek, Romanian, Azerbaijani, Turkmen, Georgian, Kyrgz,\n\nUkrainian, Kazakh, Tatar, Russian, Tajik, Armenian, Belarusian, Romanian.\n\n- Collects victim system information, including username, computer name,\n\ngeneral system information, domain name, workgroup, and installed AV\n\nprograms (such as Windows Defender).\n\n- Deletes shadow copies using WMI.\n\n- The malware creates the following files:\n\n    - LNK file: <8 characters>.lnk file in each encrypted directory. The\n\n.lnk filename appears to be the CRC32 hash of a subset of victim\n\ninformation, so will be the same for every run of the malware,\n\nthough different per victim system. This .lnk file is deleted after\n\nthe encryption completes.\n\n    - Ransom note: the ransom note (RECOVER-FILES.txt) in each\n\nencrypted directory.\n\n    - %ProgramData%\\\\dtb.dat: this file name was also used in Sekhmet\n\n[ransomware.](https://blog.minerva-labs.com/minervalabs-vs-sekhmet)\n\n- To prevent recovery measures or backup features an organization might\n\nenact when the encryption begins, Egregor looks for a list of processes\n\nto shut down, including outlook.exe, thunderbird.exe, procmon.exe, and\n\nsqlservr.exe. The full list can be found in Appendix A. It also looks to\n\nterminate services containing “sql” or “database.”\n\n- The ransomware will exclude a specific list of files and directories from\n\nencryption:\n\n    - The extension list from our sample included: “lnk”, “exe”, “sys”, and\n\n“dll”. Encrypting these files would likely render the victim’s system\n\nunable to operate correctly, which would negatively impact the\n\nability to pay the ransom.\n\n    - Folders that the malware excludes: Windows, Program Files, Tor\n\nBrowser, ProgramData, \\\\cache2\\\\entries (Firefox cache), \\\\Low\\\\\n\nContent.IE5\\\\ (temporary IE internet files), \\\\User Data\\\\Default\\\\\n\nCache, and All Users.\n\n    - Files containing the following strings: dtb.dat (dropped by\n\nthe ransomware), autorun.inf, boot.ini, desktop.ini, ntuser.dat,\n\niconcache.db, bootsect.bak, ntuser.dat.log, thumbs.db, Bootfont.\n\nbin, and RECOVER-FILES.txt (created by the ransomware).\n\n\n-----\n\n_Figure 4: Egregor’s ransom note_\n\n   - The ransomware appears to have the capability to create an internet\n\nconnection, specifically a POST request to http://<url>/update.\n\nphp?id=<id> but Insikt Group was unable to cause this connection to\n\n[occur. In the Sekhmet ransomware, this POST is used to send gathered](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/ransom.win32.sekhmet.c/)\n\nvictim data back to the threat actor, suggesting that this functionality\n\nmay remain in the code, but is currently unused by Egregor.\n\n   - The ransom note dropped by the payload can be seen in Figure 4, below.\n\nThe Tor chat link contains the victim identifier used with the created\n\nmutex:\n\nRecently, in an [attack on a retail organization, the threat actor not only](https://www.tripwire.com/state-of-security/featured/egregor-ransomware-attack-hijacks-printers-spit-out-ransom-notes/)\n\nencrypted the systems on the network, but printed out copies of the ransom note\n\non printers attached to the systems, further underscoring the sophistication of\n\nthe threat actors.\n\n#### Mitigations\n\nWhile currently there is very little known in open sources regarding how\n\nEgregor is being deployed to victim systems, Recorded Future has identified the\n\nfollowing recommendations:\n\n   - It is most effective to detect a ransomware threat prior to the deployment\n\nof the ransomware. While Insikt Group has not observed any evidence of\n\nhow the threat actor gains initial access to victim systems, sophisticated\n\nthreat actors often deploy commodity tools such as Cobalt Strike and\n\nQakBot to perform reconnaissance and lateral movement prior to the\n\ndeployment of a ransomware payload. Organizations should monitor\n\nfor use of these and other lateral movement/reconnaissance tools on\n\ncorporate systems in addition to the ransomware payload.\n\n   - Because ransomware threat actors often use exploits as a means of initial\n\naccess to victimized systems, it is critical that organizations ensure that\n\nany internet-facing systems are appropriately configured to provide the\n\nappropriate needed access. These systems should be patched to help\n\nmitigate the threat of vulnerabilities that are often exploited by these\n\ntypes of threat actors.\n\n   - Organizations should also be aware of the risk of phishing attacks, the\n\nuse of fake download websites, the targeting of unpatched publicly\n\naccessible systems and the exploitation of misconfigurations in publicly\n\n\n#### Outlook\n\nThe team behind Egregor has targeted several high-profile organizations to\n\ndate, and is very likely to continue doing so. The group behind Egregor will likely\n\nremain active and continue to employ techniques associated with sophisticated\n\nthreat actors and “big-game hunting.”\n\n\n-----\n\n#### Appendix A : Technical Details\n\n###### Processes to Kill\n\n\n-----\n\n###### About Recorded Future\n\nRecorded Future arms security teams with the only complete security intelligence\n\nsolution powered by patented machine learning to lower risk. Our technology\n\nautomatically collects and analyzes information from an unrivaled breadth of sources\n\nand provides invaluable context in real time and packaged for human analysis or\n\nintegration with security technologies.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://go.recordedfuture.com/hubfs/reports/cta-2020-1203.pdf"
    ],
    "report_names": [
        "cta-2020-1203.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1606930422,
    "ts_modification_date": 1606930476,
    "files": {
        "pdf": "https://archive.orkl.eu/6d03626f3e8541ce48c209e8bac608583c600cbf.pdf",
        "text": "https://archive.orkl.eu/6d03626f3e8541ce48c209e8bac608583c600cbf.txt",
        "img": "https://archive.orkl.eu/6d03626f3e8541ce48c209e8bac608583c600cbf.jpg"
    }
}