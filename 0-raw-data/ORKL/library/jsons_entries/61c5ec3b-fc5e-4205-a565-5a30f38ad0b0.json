{
    "id": "61c5ec3b-fc5e-4205-a565-5a30f38ad0b0",
    "created_at": "2023-01-12T15:08:20.417597Z",
    "updated_at": "2025-03-27T02:09:34.45986Z",
    "deleted_at": null,
    "sha1_hash": "6774718b5be15f8b57cc3e62ca8817b8717d14e7",
    "title": "2021-11-30 - Is -KAX17- performing de-anonymization Attacks against Tor Users-",
    "authors": "",
    "file_creation_date": "2022-05-28T17:03:16Z",
    "file_modification_date": "2022-05-28T17:03:16Z",
    "file_size": 89228,
    "plain_text": "# Is “KAX17” performing de-anonymization Attacks against Tor Users?\n\n**[nusenu.medium.com/is-kax17-performing-de-anonymization-attacks-against-tor-users-42e566defce8](https://nusenu.medium.com/is-kax17-performing-de-anonymization-attacks-against-tor-users-42e566defce8)**\n\nnusenu December 1, 2021\n\nnus\nenu\n\n\n[nusenu](https://nusenu.medium.com/?source=post_page-----42e566defce8--------------------------------)\n\nNov 29, 2021\n\n\n10 min read\n\nHashtag: #KAX17\n\nTwo years ago in December 2019, I first wrote about a particular and unusual malicious actor\non the tor network. This blog post is about how that actor expanded their visibility into the tor\nnetwork during the last two years after their removal by the tor directory authorities in October\n2019 and why this particular actor is more concerning than the usual malicious tor relay group.\n\nThe threat landscape on the tor network motivates the second part, in which we will outline a\ndesign and proof of concept implementation to help tor users defend themselves and\nsignificantly reduce their risk of using malicious tor relays without requiring the identification of\nmalicious relays — a problem that has become impractical to tackle.\n\n## Major Tor Network Threat Actors\n\nTo give you a clearer picture which actor we will be focusing on in this blog post, here is a short\noverview of the two main actors we have reported about in the past. Let’s also give them code\nnames so it easier to refer to them.\n\n## Actor “BTCMITM20” Profile\n\nactive since at least 2020\nsophistication: amateur level but persistent and large scale\noperated relay types: exit relays\n(known) concurrently running relays peak: >350 relays\n(known) advertised bandwidth capacity peak: 40 Gbit/s\n(known) exit probability peak: 27%\nprimary motivation: financial profit (by replacing bitcoin addresses in tor exit traffic)\n\n\n-----\n\ndefenses: easy; HSTS preloading for website operators; on tor clients: ensure HTTPS is\nused properly.\n\npast blog posts about this actor:\n\n## Actor “KAX17” Profile\n\nactive since at least 2017\nsophistication: non-amateur level and persistent\nuses large amounts of servers across many (>50) autonomous systems (including noncheap cloud hosters like Microsoft)\noperated relay types: mainly non-exits relays (entry guards and middle relays) and to a\nlesser extend tor exit relays\n(known) concurrently running relays peak: >900 relays\n(known) advertised bandwidth capacity peak: 155 Gbit/s\n(known) probability to use KAX17 as first hop (guard) peak: 16%\n(known) probability to use KAX17 as second hop (middle) peak: 35%\nmotivation: unknown; plausible: ; collection of tor client and/or onion service IP addresses;\ndeanonymization of tor users and/or onion services\n\npast blog post about KAX17:\n\nWe consider it less likely that KAX17 and BTCMITM20 are the same actor, but due to some\nminor overlap we did not rule out the possibility that there is some limited form of collaboration\nbetween these actors yet. The remainder of this blog post is about KAX17 only.\n\n## What visibility into the tor network did KAX17 have during the past 3 years?\n\nThe following graph shows (known) KAX17' network fraction in % of the entire tor network for\neach position (first, second and last hop of a tor circuit) over the past 3 years.\n\n\n-----\n\nFigure 1: Guard, middle and exit probability by KAX17's relays between 2019–01–01 and the\nremoval event on . Graph by (raw data source: )\nAfter I reported the exit relays (at the time I did not know they are part of KAX17) they got\nremoved in October 2020, but I do not believe that halted their exit operations completely.\nCoincidentally a new large no-name exit relay group was born the day after their removal. That\nnew group is not included in figure 1 because it can not be attributed to KAX17 using the same\nstrong indicator.\n\nTo provide a worst-case snapshot, on 2020–09–08 KAX17's overall tor network visibility would\nallow them to de-anonymize tor users with the following probabilities:\n\nfirst hop probability (guard) : 10.34%\n\n\n-----\n\nsecond hop probability (middle): 24.33%\nlast hop probability (exit): 4.6%\n\nAs middle and exit relays are frequently changed the likelihood to use KAX17's relays increases\nwith tor usage over time. We have no evidence, that they are actually performing deanonymization attacks, but they are in a position to do so and the fact that someone runs such\na large network fraction of relays “doing things” that ordinary relays can not do (intentionally\nvague), is enough to ring all kinds of alarm bells.\n\nIn the course of 2020 large amounts of suspicious non-exit relays joined the network and were\nreported to the Tor Project, but since they no longer got removed, I sent them to the public tor[talk mailing list as their capacity continued to increase (2020–08–20,](https://lists.torproject.org/pipermail/tor-talk/2020-August/045638.html) [2020–09–22).](https://lists.torproject.org/pipermail/tor-talk/2020-September/045643.html)\n\n## The unexpected hint towards a better understanding of the mystery\n\nAt the time (2020) I had no strong linkability indicators for these large sets of non-exit relays to\nthe KAX17 actor - that changed a few weeks ago (fall 2021), when a reader of this blog,\nreached out to share their notes about a suspicious group of relays. We independently verified\nand reproduced their observations on a technical level. When put into the broader context, their\nhint helped to understand the bigger picture by providing strong indicators that all those relays:\n\nare in fact operated by a single entity and\nall of them are actually part of KAX17.\n\n## What is special about KAX17?\n\nKAX17 is more worrisome than the usual malicious tor exit relay group, because they appear to\nbe rather keen on having a large visibility into non-exit positions of the network (entry guard and\nmiddle relay). These positions are useless for the usual malicious actor manipulating and\nsniffing tor exit traffic, because in these positions no plaintext traffic is available. Actors\nperforming attacks in these non-exit positions are considered more advanced adversaries\nbecause these attacks require a higher sophistication level and are less trivial to pull off.\n[Some parts of this story reminded me of the so called “relay early” traffic confirmation attack](https://blog.torproject.org/tor-security-advisory-relay-early-traffic-confirmation-attack/)\nfrom back in [2014 that combined running malicious relays with active tor protocol level](https://www.washingtonpost.com/news/the-switch/wp/2014/07/24/why-was-the-black-hat-talk-on-tor-de-anonymization-mysteriously-canceled/)\nexploitation to de-anonymize onion services (at the time called “hidden services”) and their\nusers, because that was one of these rare cases where you also got to see attacks involving\nnon-exit relays. Other than that there is nothing pointing in that direction.\n\n## KAX17's involvement in tor-relays policy discussions\n\nWhen looking over KAX17 relays’ metadata I repeatedly came across a particular email\naddress. Some of KAX17's relays initially had used that email address in their ContactInfo but\nsoon after these relays were setup the email address got removed from their configuration. I\n[also came across this email address on the tor-relays mailing list. Interestingly it became almost](https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-relays)\nexclusively involved on the mailing list when policy proposals with regards to malicious relays\n\n\n-----\n\nwere discussed or when large malicious relay groups got removed. They apparently disliked the\nproposals to make their activities less effective :)\nSince everyone can use your email address in their relay’s ContactInfo, that information is not\nnecessarily authentic, but since the email address has been used on KAX17 relays long before\n[it first appeared on the tor-relays mailing list I guess that was just poor OPSEC on their part.](https://en.wikipedia.org/wiki/Operations_security)\n\n## Self-defense: Helping tor users help themselves\n\nIt is apparent that tor users have powerful adversaries with a lot of resources at their hands. It is\na particularly uncomfortable situation to be in, knowing some actor has been running large\nfractions of the tor network for years and will continue to do so. It is also clear that we can not\ndetect— let alone get removed — even such large scale relay groups in a timely manner.\nKAX17’s operations likely got severely degraded when the tor directory authorities took actions\n[against them in November 2021, but they already started to restore their foothold, like they did](https://lists.torproject.org/pipermail/tor-relays/2021-November/019980.html)\nafter their first removal in October 2019, so we will need some more sustainable solutions when\ndealing with malicious relays.\n\nIn the past I have always been reluctant to make tor client configuration changes that affect\npath selection because it makes a tor client theoretically stand out, but in the light of the tor\nnetwork’s threat landscape I consider it a reasonable (for some threat model even a necessary)\nact of self-defense to stop using untrusted relays for certain path positions to reduce the risk of\nde-anonymization and other types of attacks — even if that is a non-default configuration.\n\nTo achieve that goal tor clients would need to:\n\n(1) configure trusted operators or learn about them via so called trust anchors\n\n(2) automatically enumerate all relays of trusted operators\n\n(3) automatically configure the tor client to use only trusted relays for certain positions like entry\nguard and/or exit relay\n\nThe design allows tor users to assigns trust at the operator level and inherits that trust to all the\nrelays an operator manages. This should ensure scalability and be less fragile to changes like\nwhen new relays get added or replaced.\n\n## Non-spoofable operator identifiers\n\nHow do we tackle (2)? The tor network has no identifiers for relay operators. There is a relay’s\nContactInfo string, but using that without any verification scheme is not safe and has been\nexploited by malicious operators in the past. So we need some operator identifiers that can not\nbe spoofed arbitrarily by an adversary. Luckily we are not unprepared for that. In 2020 I wrote a\n[specification (CIISS) that allows tor relay operators to link their relays to their domain/hostname](https://nusenu.github.io/ContactInfo-Information-Sharing-Specification/)\nin a verifiable way. That is accomplished using a simple 2-way link from the relay to a domain\nand from the domain back to a relay. In practice an operator has to perform two simple steps to\n[link her relay to her domain in a non-spoofable way according to the specification:](https://nusenu.github.io/ContactInfo-Information-Sharing-Specification/#url)\n\n\n-----\n\n1. add url:example.com proof:uri-rsa ciissversion:2 to her relay s ContactInfo\n2. the relay’s fingerprint at the IANA URI: (or create a ).\n\nIn the past few months the proven domain has already been widely implemented by most large\nexit operators of the tor relay community and currently over 50% of the tor network’s exit\ncapacity is covered (more is better):\n\nFigure 2: >50% of the tor network’s exit capacity has proven their domain according to the .\nSource: (an interactive version of the graph can be found at )\nThis provides tor users with non-spoofable automatically verifiable operator identifiers they can\nassign trust to. It is important to stress the point that proven domains are not implicitly trusted,\nmalicious groups can also proof their domain. It is only the first step, an identifier that users can\n\n\n-----\n\nchoose to trust. The adoption of the proven operator domain for guard relays is significantly\nlower (~10% guard probability), until that fraction increases users could configure a trusted\nrelay as a bridge to reduce their chance of using malicious guards.\n\n## Trusting operator domains\n\nTrust in this context means that a relay operators is believed to operate relays without malicious\nintent. The details of publishing and consuming trust information are laid out in this specification\ndraft: [A Simple Web of Trust for Tor Relay Operator IDs. It allows the (optional) dynamic](https://nusenu.github.io/tor-relay-operator-ids-trust-information/)\ndiscovery of trusted operators starting from a trust anchor, but it also supports stricter manual\nonly trust assignments (without recursive discovery)— it is up to the user to decide.\n\n## Proof of concept implementation\n\nWe’ve implemented a quick and dirty proof of concept of the steps outlined above and are\npublishing it with this blog post. It is not meant for general use by end-users.\n\n[https://github.com/nusenu/trustor-poc](https://github.com/nusenu/trustor-poc)\n\nIt is implemented as a python script that talks to the local tor client via its control port/socket,\nreads the local file with a list of trusted operator domains, verifies relay/domain proofs (via tor)\nand configures the tor client to use exit relays run by trusted operators only. The list of trusted\noperators is defined by the user.\n\nWe would like to implement an actual serious implementation and we might have an update on\nthat within the next months.\n\n## Summary\n\nA mysterious actor which we gave the code-name KAX17 has been running large\nfractions of the tor network since 2017, despite multiple attempts to remove them from the\nnetwork during the past years.\nKAX17 has been running relays in all positions of a tor circuit (guard, middle and exit)\nacross many autonomous systems putting them in a position to de-anonymize some tor\nusers.\nTheir actions and motives are not well understood.\nWe found strong indicators that a KAX17 linked email address got involved in tor-relays\nmailing list discussions related to fighting malicious relays.\nDetecting and removing malicious tor relays from the network has become an impractical\nproblem to solve.\nWe presented a design and proof of concept implementation towards better self-defense\noptions for tor clients to reduce their risk from malicious relays without requiring their\ndetection.\nMost of the tor network’s exit capacity (>50%) supports that design already. More guard\nrelays adopting the proven domain are needed (currently at around 10%).\n\n\n-----\n\n## Acknowledgements\n\nI’d like to thank the person who provided crucial input towards a better understanding KAX17's\nrelays. The person asked to remain anonymous.\n\n## Appendix\n\nThe following graph shows KAX17's network capacity (at least the one we know about). The\ndetection method has certainly false-negatives (there are relays we did not attribute to them).\n\nFigure 3: Running KAX17 relays and their advertised bandwidth since 2019–01–01. Graph by\n\n\n-----\n\nFigure 4: Running KAX17 middle-only relays show a . Starting on the first day of each month.\nGraph by\n\n\n-----\n\nFigure 5: Running KAX17 guard relays do not show the same monthly pattern (also because\nthe guard flag has some requirements that relays regularly disappearing do not meet). Graph\nby\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-30 - Is -KAX17- performing de-anonymization Attacks against Tor Users-.pdf"
    ],
    "report_names": [
        "2021-11-30 - Is -KAX17- performing de-anonymization Attacks against Tor Users-.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "0ca8aa42-5713-4277-b265-456f1601eef4",
            "created_at": "2023-11-17T02:00:07.585347Z",
            "updated_at": "2025-03-27T02:00:03.227103Z",
            "deleted_at": null,
            "main_name": "KAX17",
            "aliases": [],
            "source_name": "MISPGALAXY:KAX17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536100,
    "ts_updated_at": 1743041374,
    "ts_creation_date": 1653757396,
    "ts_modification_date": 1653757396,
    "files": {
        "pdf": "https://archive.orkl.eu/6774718b5be15f8b57cc3e62ca8817b8717d14e7.pdf",
        "text": "https://archive.orkl.eu/6774718b5be15f8b57cc3e62ca8817b8717d14e7.txt",
        "img": "https://archive.orkl.eu/6774718b5be15f8b57cc3e62ca8817b8717d14e7.jpg"
    }
}