{
    "id": "a96ef12a-3621-4e1a-ae6e-8fabb1f1fc4d",
    "created_at": "2023-01-12T15:03:03.854317Z",
    "updated_at": "2025-03-27T02:05:44.226384Z",
    "deleted_at": null,
    "sha1_hash": "d2a3d22be1f7db65ad2c39969059760d5cfcb25f",
    "title": "2021-10-05 - Regarding the Threats Posed by Encrypted Office Files",
    "authors": "",
    "file_creation_date": "2022-05-27T21:39:06Z",
    "file_modification_date": "2022-05-27T21:39:06Z",
    "file_size": 281167,
    "plain_text": "# Regarding the Threats Posed by Encrypted Office Files\n\n**[expmon.blogspot.com/2021/10/regarding-threats-posed-by-encrypted.html](https://expmon.blogspot.com/2021/10/regarding-threats-posed-by-encrypted.html)**\n\nSince the EXPMON's launch in late August, especially after the big discovery of the Microsoft\nCVE-2021-40444 zero-day attack (which impressively proved the effectiveness of our\n\"environment-binding approach\" for advanced exploit detection), we've been working on\nsome automation processes where we collect various samples from different sources and\nput them into our EXPMON system for advanced exploit detection.\n\nRecently, our system has detected quite a lot of malicious encrypted Office files. We believe\n[most of them are already discussed in this pretty good blog post from the VMware Threat](https://blogs.vmware.com/networkvirtualization/2020/11/velvetsweatshop-when-default-passwords-can-still-make-a-difference.html/)\nAnalysis Unit, we highly recommend read it first for some background knowledge.\n\nBasically, the process is that, when Microsoft Office tries to open an encrypted Office file, it\ntries the \"secret\" password \"VelvetSweatshop\" to decrypt the file in the memory and then\nopen it automatically. Since the encrypted file has a completely different structure comparing\nto the original malicious file, and almost all the bytes are encrypted, such a trick would allow\nthe malicious actors to not only bypass the detection of security products (especially for\nstatic engines such as AV engines), but also keep the user interaction minimal because\nMicrosoft Office would decrypt and open the decrypted exploit automatically. This is a really\ngood trick for malicious actors to pack their Office exploits.\n\nFor EXPMON system, if the user provides the original in-the-wild filename (extension name)\nof the sample when submitting the sample, our system will detect them without problem.\nEven, since our latest update v20211005, if the user does not provide the extension name,\nour system will try to decrypt the file using the default \"VelvetSweatshop\" password on the fly\nand put the decrypted objects back into our system for analysis, this is done in our powerful\n\"object exploring\" module.\n\nWe observed that,\n\nAlmost all the Office encrypted samples are Excel samples and embedded with CVE2017-11882 exploits.\nThe AV engines on VirusTotal are doing a great job on detecting these samples so far\n(perhaps because there were good improvements after the VMWare blog post\nreleased).\n\nJust listing a few examples,\n\n\n-----\n\n02f0eb68584489c25d6875906b0484c7\n\n14fdf843f1c9990d688f8cfa9a205d13\n\n758b8e7eff032a609fbfc34ea6fd54df\n\n87b64dec6a53c93bde6a4e984e0d51c0\n\na455c811a6ea1402fb63e8294462c0e8\n\nd2fb6c006fe4b81fae29c2b55435db93\n\nf3b656e3b788ea97cc6cb577ac4ca14a\n\n166e88aa51cd18fb2e6359c9ec67dfce\n\nf0c31a6e46910b1f561b8e62cea1625b\n\nHowever, we have also seen few (so far) samples making some \"progress\" on avoiding\ndetection - instead of using the default \"VelvetSweatshop\" password, they use their own\npasswords, but put the password in the filename and trying to lure the user to open it with\nthat password in the filename.\n\nLet's see this sample,\n\nhttps://www.virustotal.com/gui/file/8afa5b1c24916936c79ad6fdb6197c578326a795de0a214d\n1be05f9cfb8d5914/detection\n\nSo far, as of writing, not a single AV engine on VT is able to detect it.\n\n\n-----\n\nThe decrypted (decrypting with the password xxvzddmzrefqbahk provided in filename) is\nactually a malicious .xlsx with malicious Office macros embedded.\n\nPlease note that we don't blame anyone for not detecting the samples - this is\nunderstandable, even if the engine has the capacity to decrypt encrypted Office files, what\ncould it do when it doesn't know the password? Someone may say hey how about we try all\nthe strings in the filename? Well, what if the attacker uses some more sophisticated way like\n\"password is the result of 1+1\"? This sounds like an endless game.\n\n\n-----\n\nAt EXPMON, we mitigated this by providing an \"informative\" message to the users, when we\nfind out the sample is encrypted but we're not able to decrypt using the default\n\"VelvetSweatshop''password, we try to warn the users not be lured to input the password\nmanually - if they users don't manually provide the password when opening the file, there's\nno risk, as the malicious content is not opened by Office. At this time, the samples would be\ndetected like this.\n\nWe hope this quick blog post help rise the awareness of the threats posed by encrypted\nOffice files and help the security industry on better detecting them. Our EXPMON system will\ncontinue to monitor the threats posed by encrypted Office files. Happy hunting!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-05 - Regarding the Threats Posed by Encrypted Office Files.pdf"
    ],
    "report_names": [
        "2021-10-05 - Regarding the Threats Posed by Encrypted Office Files.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535783,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653687546,
    "ts_modification_date": 1653687546,
    "files": {
        "pdf": "https://archive.orkl.eu/d2a3d22be1f7db65ad2c39969059760d5cfcb25f.pdf",
        "text": "https://archive.orkl.eu/d2a3d22be1f7db65ad2c39969059760d5cfcb25f.txt",
        "img": "https://archive.orkl.eu/d2a3d22be1f7db65ad2c39969059760d5cfcb25f.jpg"
    }
}