{
    "id": "3f76a46e-1d48-4abf-8e62-c08babd15fdd",
    "created_at": "2023-01-12T15:01:21.191636Z",
    "updated_at": "2025-03-27T02:06:04.588128Z",
    "deleted_at": null,
    "sha1_hash": "0b04ecc463706f8a3bf337bca33bf6437a87458a",
    "title": "2022-04-28 - Peeking into PrivateLoader",
    "authors": "",
    "file_creation_date": "2022-05-28T19:12:01Z",
    "file_modification_date": "2022-05-28T19:12:01Z",
    "file_size": 652406,
    "plain_text": "# Peeking into PrivateLoader\n\n**zscaler.com/blogs/security-research/peeking-privateloader**\n\n**Key Points**\n\nPrivateLoader is a downloader malware family that was first identified in early 2021\nThe loader’s primary purpose is to download and execute additional malware as part of a pay-per-install (PPI)\nmalware distribution service\nPrivateLoader is used by multiple threat actors to distribute ransomware, information stealers, banking trojans,\ndownloaders, and other commodity malware\n\n_PrivateLoader is a downloader malware family whose primary purpose is to download and execute additional malware._\n[Intel 471 and](https://intel471.com/blog/privateloader-malware) [Walmart reported on PrivateLoader’s pay-per-install (PPI) service that distributes malware on behalf of](https://medium.com/walmartglobaltech/privateloader-to-anubis-loader-55d066a2653e)\nother threat actors. The malware payloads can be selectively delivered to victims based on certain criteria (e.g. location,\ncryptocurrency or financial activity, on a corporate network, specific software installed, etc.) As previously reported,\nsome of the payloads being distributed include Redline Stealer, Vidar Stealer, SmokeLoader, Stop ransomware, and\nother commodity malware.\n\nThe PrivateLoader malware is written in the C++ programming language, and based on the existence of multiple\nversions it seems to be in active development. The name “PrivateLoader” comes from debugging strings that can be\nfound in some versions of the malware, for example:\n\n_C:\\Users\\Young Hefner\\Desktop\\PrivateLoader\\PL_Client\\PL_Client\\json.h_\n\nPrivateLoader is modularized into a loader component and a main component.\n\n**Anti-Analysis Techniques**\n\nBoth the loader and main components of PrivateLoader make use of similar anti-analysis techniques. These antianalysis techniques include obfuscating integer constants with various mathematical operations as shown in Figure 1.\n\n_Figure 1: Example of a PrivateLoader obfuscated integer constant_\n\n\n-----\n\nMost of the malware s important strings are stored as encrypted stack strings where each string is decoded with its own\nXOR key as shown in Figure 2. A listing of PrivateLoader’s decrypted strings for the loader component can be found\n[here and the main component’s decrypted strings can be found here.](https://pastebin.com/BY8CnYzN)\n\n_Figure 2: Example of a PrivateLoader encrypted stack string._\n\nMost of the important Windows DLL and API names used by PrivateLoader are also stored as encrypted stack strings.\nAfter decryption, PrivateLoader dynamically resolves the API functions at runtime. Finally, PrivateLoader adds junk\ncode to obfuscate the program’s logic and control flow.\n\n**Loader Component**\n\nThe PrivateLoader loader component contains three dead drop resolver URLs hardcoded in the malware that\ncommunicate via an HTTP GET request. An example of PrivateLoader’s dead drop resolvers is the following:\n\nhxxp://45.144.225[.]57/server.txt\nhxxps://pastebin[.]com/raw/A7dSG1te\nhxxp://wfsdragon[.]ru/api/setStats.php\n\nThe purpose of these resolvers is to retrieve PrivateLoader’s command and control (C2) address. The first two dead\ndrop resolver URLs return a plaintext response, while the third dead drop resolver returns a response that is XOR\nencrypted with a one-byte key (e.g., 0x6d). PrivateLoader expects the (decrypted) response to be in the format HOST:\n**<IP_Address>. An example dead drop resolver response is the following:**\n\n_HOST:212.193.30[.]21_\n\nIf PrivateLoader is unable to retrieve the primary C2 address via the dead drop resolvers, there is a secondary C2\naddress (2.56.59[.]42) stored in the malware. The C2 address obtained from the dead drop resolver (or the hardcoded\nC2 address) is combined with the path /base/api/statistics.php. PrivateLoader sends an HTTP GET request to this URL,\nwhich in turn fetches another URL that is XOR encrypted with a one-byte key (0x1d). Similar to the previous request,\nPrivateLoader expects the decrypted response from the C2 to be in the format URL:\n**<PrivateLoader_Main_Component_URL>. An example of a decrypted response from the PrivateLoader C2 is shown**\nbelow:\n\n_URL:hxxps://cdn.discordapp[.]com/attachments/934006169125679147/963471252436172840/PL_Client.bmp_\n\nPrivateLoader retrieves the content from this URL via an HTTP GET request. The response contains an unknown\nDWORD followed by encrypted data. To decrypt the data, first some of the bytes are replaced as shown in Table 1.\n\n**Byte to Replace** **Replacement Byte**\n\n0x00 0x80\n\n0x80 0x0a\n\n0x0a 0x01\n\n\n-----\n\n0x01 0x05\n\n0x05 0xde\n\n0xde 0xfd\n\n0xfd 0xff\n\n0xff 0x55\n\n0x55 0x00\n\n_Table 1: Replacement bytes used in PrivateLoader’s decryption algorithm._\n\nAfter the replacement, the data is XOR decrypted with a one-byte key (0x9d). The decrypted data contains the main\ncomponent, which is a DLL that is injected into the loader process and then executed. The loader passes a structure to\nthe main component containing:\n\nThe C2 IP address\nA hard coded integer used in some of the main component’s C2 communications\nA hard coded integer used to represent the campaign that the malware sample is associated with\n\n**Main Component**\n\nThe campaign ID passed in from the loader component is mapped to one of 33 campaign names as shown below in\nTable 2.\n\nEU USA_1 USA_2 WW_1 WW_2 WW_3 WW_4\n\nWW_5 WW_6 WW_7 WW_OPERA WW_8 WW_9 WW_10\n\nWW_11 WW_12 WW_13 WW_14 WW_15 WW_P_1 WW_16\n\nWW_17 WW_P_2 WW_P_3 WW_P_4 WW_P_5 WW_P_6 WW_P_7\n\nWW_P_8 WW_18 WW_19 WW_20 WW_21\n\n_Table 2: Listing of PrivateLoader campaign names._\n\nThe sample analyzed for this blog post was configured with campaign ID 27 which maps to WW_P_7. The campaign a\nparticular sample is associated with determines what payloads are downloaded and executed. For some campaigns,\nthe payload URLs are hardcoded into the main component (see the decrypted strings listing), while for others the\npayload URLs are retrieved from the C2.\n\nSome campaigns are also interested in a victim's cryptocurrency and banking activity. PrivateLoader performs this\naction by searching a large number of file paths, registry keys, browser extensions, and saved browser logins for the\nfollowing broad groups (see the decrypted strings listing for details):\n\ncryptoWallets browser\ncryptoWallets cold\ncryptoWallets_part1\ncryptoWallets part2\n\n\n-----\n\ncryptoGames\nbankWallets\ncuBankWallets\nbankAUWallets\npaypal\nbankCAWallets\nbankWallets_part1\nbankWallets_part2\nbankMXWallets\nbankPKWallets\nbankESWallets\nshops\namazon_eu\nwebhosts\nVBMT (travel related sites)\n\nThe wallet and/or saved login data themselves aren’t exfiltrated, rather PrivateLoader just checks for the existence of\nthem. This data is likely used to help determine follow-on payloads such as stealer or banking malware that can make\nbetter use of the credentials.\n\nThe PrivateLoader main component creates a URL by combining the C2 address passed in from the loader with the\npath /base/api/getData.php. The malware then sends HTTP POST requests containing a command and various data.\nAn example PrivateLoader main component’s request and response is similar to Figure 3.\n\n_Figure 3: Example C2 request and response by the PrivateLoader main component._\n\nThe POST data contents in the data field and corresponding response data can be decrypted as follows:\n\nReplace the characters \"_\" with \"/\" and \"-\" with \"+\"\nBase64 decode the data\nGenerate a 32-byte AES key and a 32-byte HMAC secret with PBKDF2\n\nThe password Snowman+under_a_sn0wdrift_forgot_the_Snow_Maiden is stored as an encrypted stack\nstring\nThe salt is stored as the first 16-bytes of the Base64 decoded data\nThe iteration count is hardcoded to 20,000\nThe HMAC hashing algorithm is SHA512\nAn IV is stored as the second 16-bytes of the Base64 decoded data\nAn HMAC hash is stored as the last 32-bytes of the Base64 decoded data\nBetween the IV and the HMAC hash is AES encrypted data\nThe HMAC hash is validated\n\nOnce decrypted, an example C2 beacon looks similar to the following:\n\n\n-----\n\n_AddLoggerStat|WW_P_7|{ extensions :[], links :[{ id : 1916 },{ id : 468 },{ id : 1920 },{ id : 1750 },{ id : 1927 },_\n_{\"id\":\"1929\"},{\"id\":\"1946\"},{\"id\":\"1985\"}],\"net_country_code\":\"US\",\"os_country_code\":\"US\"}_\n\nEach field is pipe delimited and contains the following parameters:\n\nCommand\nCampaign name\nJSON object\n\nIn this example the JSON object contains:\n\nIDs of browser extension payloads that have been downloaded and executed\nIDs of hardcoded or retrieved payloads that have been downloaded and executed\nLocation of victim based on GeoIP\nLocation of victim based on system data\n\nThe response data depends on the command and can contain a simple status message (e.g. “success”) or a JSON\nobject.\n\nC2 commands may include the following values:\n\n**GetLinks - get payload URLs**\n**GetExtensions - get browser extension payload URLs**\n**AddExtensionStat - used to update C2 panel statistics**\n**GetIP - used to obtain the victim's external IP address**\n**AddLoggerStat - used to update C2 panel statistics**\n**SetIncrement|not_elevated - indicates if the malware's process token is not elevated**\n**SetIncrement|ww_starts**\n**GetCryptoSleeping**\n**IsUseDominationProject**\n**SetLoaderAnalyze**\n\nAs an example of the GetLinks command, a listing of payload URLs returned for the analyzed sample’s campaign on\n[04/14/2022 is available here. Some of the payload URLs are encrypted similarly to how the main component was](https://pastebin.com/amiYQYu7)\nencrypted, while others are unencrypted PE executable files.\n\n**Conclusion**\n\nPrivateLoader is a typical downloader malware family that provides a PPI service that has gained traction as a viable\nmalware distribution method for multiple threat actors. PrivateLoader is currently used to distribute ransomware, stealer,\nbanker, and other commodity malware. The loader will likely continue to be updated with new features and functionality\nto evade detection and effectively deliver second-stage malware payloads.\n\n**Cloud Sandbox Detection**\n\n\n-----\n\nIn addition to sandbox detections, Zscaler’s multilayered cloud security platform detects indicators related to the\ncampaign at various levels with the following threat names:\n\n[Win32.Trojan.PrivateLoader](https://threatlibrary.zscaler.com/threats/45f34992-d01a-405b-9a6d-b0d75e0431b4)\n\n**Indicators of Compromise**\n\n**IOC** **Notes**\n\naa2c0a9e34f9fa4cbf1780d757cc84f32a8bd005142012e91a6888167f80f4d5 SHA256 hash\nof analyzed\nPrivateLoader\nloader\ncomponent\n\n077225467638a420cf29fb9b3f0241416dcb9ed5d4ba32fdcf2bf28f095740bb SHA256 hash\nof analyzed\nPrivateLoader\nmain\ncomponent\n\nhxxp://45.144.225[.]57/server.txt Loader\ncomponent\ndead drop\nresolver\n\n\n-----\n\nhxxps://pastebin[.]com/raw/A7dSG1te Loader\ncomponent\ndead drop\nresolver\n\nhxxp://wfsdragon[.]ru/api/setStats.php Loader\ncomponent\ndead drop\nresolver\n\n212.193.30[.]21 Primary C2\naddress\n\n2.56.59[.]42 Secondary\nC2 address\n\n/base/api/statistics.php Loader\ncomponent\nURI\n\nhxxps://cdn.discordapp[.]com/attachments/934006169125679147/963471252436172840/PL_Client.bmp Encrypted\nmain\ncomponent\n\n/base/api/getData.php Main\ncomponent\nURI\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-28 - Peeking into PrivateLoader.pdf"
    ],
    "report_names": [
        "2022-04-28 - Peeking into PrivateLoader.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535681,
    "ts_updated_at": 1743041164,
    "ts_creation_date": 1653765121,
    "ts_modification_date": 1653765121,
    "files": {
        "pdf": "https://archive.orkl.eu/0b04ecc463706f8a3bf337bca33bf6437a87458a.pdf",
        "text": "https://archive.orkl.eu/0b04ecc463706f8a3bf337bca33bf6437a87458a.txt",
        "img": "https://archive.orkl.eu/0b04ecc463706f8a3bf337bca33bf6437a87458a.jpg"
    }
}