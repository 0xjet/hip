{
    "id": "adeb8571-cfdd-4fd7-aff8-71dd4b31a56a",
    "created_at": "2023-01-12T15:06:52.391217Z",
    "updated_at": "2025-03-27T02:16:26.567953Z",
    "deleted_at": null,
    "sha1_hash": "6e00ab02cc8820a8f4603ccb809091375a5d8a74",
    "title": "2017-08-08 - WTF is Mughthesec!-",
    "authors": "",
    "file_creation_date": "2022-05-29T01:22:19Z",
    "file_modification_date": "2022-05-29T01:22:19Z",
    "file_size": 3701649,
    "plain_text": "# Objective-See\n\n**objective-see.com/blog/blog_0x20.html**\n\nWTF is Mughthesec!?\n\n› poking on a piece of undetected adware\n\n8/08/2017\n\n[love these blog posts? support my tools & writing on patreon! Mahalo :)](https://www.patreon.com/objective_see)\n\n[Want to play along? I've shared the adware, which can be downloaded here (password:](https://objective-see.com/downloads/malware/Mughthesec.zip)\ninfect3d).\n\nBackground\n\n[Yesterday Gavriel State (@gavrielstate) posted an interesting tweet:](https://twitter.com/gavrielstate)\n\n\n-----\n\nInterestingly, googling \"Mughthesec\" only returned one relevant hit; a post on Apple's online's\nforums tilted [\"Safari does not render Gmail correctly\". Posted on August 2nd, user 'giveen'](https://discussions.apple.com/thread/8029380?start=0&tstart=0)\nstated that, \"Only in Safari, when this specific user logins, it does not render Gmail correctly.\n[Only Gmail. Only in Safari.\" Following another user's suggestion, 'giveen ' ran EtreCheck](https://etrecheck.com/)\nwhich noted several \"unknown files:\"\n\n~/Library/LaunchAgents/com.Mughthesec.plist\n\n~/Library/Application Support/com.Mughthesec/Mughthesec\n\nGavriel was kind enough to share a sample ('Mughthesec') with me, and that, coupled with\nthe assistance from another security researcher, led to recovery of what appeared to be the\n\n\n-----\n\noriginal installer (sha256:\nf5d76324cb8fcae7f00b6825e4c110ddfd6b32db452f1eca0f4cff958316869c)\n\nAs neither the sample, Mughthesec, nor the (signed!) installer were detected by any AV\nengines on Virus Total I decided to take a closer look.\n\nAnalysis\nLet's start with the installer disk image. Uploaded to VirusTotal on August 4th as Player.dmg,\nit currently remains undetected:\n\nUsing [WhatsYourSign, we can examine the signing info:](https://objective-see.com/products/whatsyoursign.html)\n\nUsing spctl, we can confirm the disk image's certificate is still valid (i.e. not rejected):\n\n$ spctl -a -t install -vv ~/Downloads/Mughthesec/Player.dmg\n\n~/Downloads/Mughthesec/player.dmg: accepted\n\nsource=Developer ID\n\norigin=Developer ID Application: Quoc Thinh (9G2J3967H9)\n\nDouble-clicking the disk image, Player.dmg mounts it, revealing a single file Installer.app:\n\n\n-----\n\nBesides it's icon and name, the Installer.app's' Info.plist file, shows it masquerading as Flash\ninstaller:\n\ncat Installer.app/Contents/Info.plist\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n\n<plist version=\"1.0\">\n\n<dict>\n\n...\n\n<key>CFBundleIdentifier</key>\n\n<string>com.FlashPlayer</string>\n\n<key>CFBundleName</key>\n\n<string>FlashPlayerInstaller</string>\n\nThis application, is also signed with the same Apple Developer ID:\n\n\n-----\n\nExamining its application bundle, we can see its executable is a binary name 'mac' ... how\ncreative!\n\nThis binary is also (currently) undetected by any AV engine on Virus Total:\n\nTaking a quick peak at the installer binary shows what appears to be anti-anti-virus logic:\n\n\n-----\n\nWe can also run strings to search for embedded URLs:\n\n$ strings -a ~/Downloads/Mughthesec/Installer.app/Contents/MacOS/mac | grep http\n\nhttp://api.simplyeapps.com/p\n\nhttp://cdn.simplyeapps.com/screens/precheck/DmFybQ==\n\nhttp://cdn.simplyeapps.com/screens/progress/DmFybQ==\n\nhttp://cdn.simplyeapps.com/screens/complete/DmFybQ==\n\nhttp://api.simplyeapps.com/l\n\nNow, before we run this in a VM - let's change the MAC address of the virtual machine. This\nis required step, because it turns out that the installer actually doesn't do anything malicious,\n(besides actually installing a legit copy of Flash), if it detects it running in VM. Thomas Reed\n[(@thomasareed) correctly guessed that this 'VM detection' is done by examining the MAC](https://twitter.com/thomasareed)\naddress (VMWare VMs have 'recognizable' MAC address). Apparently this is common trick\nused in macOS adware!\n\nTo change the VM's mac address, shut it down, then change it via the VM's Network\nAdapter's settings (click 'Advanced Options' to modify the MAC address).\n\n\n-----\n\nAlright, let's run the damn Installer.app already! First thing, LuLu (my soon-to-be-released\nmacOS firewall!) detects an outgoing network connection:\n\n\n-----\n\nOnce the outgoing connection is allowed, the Installer application kindly asks the user to\ninstall some 'adware' and potentially unwanted programs:\n\n1. Advanced Mac Cleaner\n2. Safe Finder\n3. Booking.com\n\n\n-----\n\nSince we're playing along, we click 'Next' to install it all!\n\n[Not too unexpectedly, the Advanced Mac Cleaner triggers a few BlockBlock warnings as it](https://objective-see.com/products/blockblock.html)\nattempts to install a persistent launch agent and login item:\n\n\n-----\n\nIt also kindly informs us of several 'critical' issues. How thoughtful :P\n\n\n-----\n\n[Moving on to 'Safe Finder', BlockBlock as alerts us of a process named 'i' persisting](https://objective-see.com/products/blockblock.html)\nsomething named 'Mughthesec as a launch agent.\n\n[An open-source process monitoring utility I wrote (based on the Proc Info library) shows](https://github.com/objective-see/ProcInfoExample/)\nMughthesec being started by the Installer application (FlashPlayerInstaller, pid: 490):\n\n# procMonitor\n\n\n-----\n\nprocess start:\npid: 532\npath: /private/tmp/F3A53281-D3FA-4F32-B996-3EE0FCF522D5/62/Mughthesec\nuser: 501\nargs: (\n\"/tmp/F3A53281-D3FA-4F32-B996-3EE0FCF522D5/62/Mughthesec\",\n2,\nna,\nna,\n\"F3A53281-D3FA-4F32-B996-3EE0FCF522D5\"\n)\nancestors: (\n490,\n1\n)\nbinary:\nname: Mughthesec\npath: /private/tmp/F3A53281-D3FA-4F32-B996-3EE0FCF522D5/62/Mughthesec\nsigning info: {\nsignatureStatus = \"-67062\";\n} (isApple: 0 / isAppStore: 0)\n\nThe process monitor also shows this process (Mughthesec, pid: 532), spawning executing\nthe 'i' process out of /tmp:\n\n# procMonitor\n\nprocess start:\npid: 568\npath: /private/tmp/5E0BE2D2-7AD7-4005-8B1C-A635675BB4FD/15261EBB-ED0B-46DA8C3B-AE8C02E802B3/i\nuser: 501\nargs: (\n\"/tmp/5E0BE2D2-7AD7-4005-8B1C-A635675BB4FD/15261EBB-ED0B-46DA-8C3BAE8C02E802B3/i\",\n\"5E0BE2D2-7AD7-4005-8B1C-A635675BB4FD\",\n\"S+wIS+tmwyirlkak8AAF36JIq8TSRdg...==\",\n10\n)\nancestors: (\n532,\n\n\n-----\n\n490,\n1\n)\nbinary:\nname: i\npath: /private/tmp/5E0BE2D2-7AD7-4005-8B1C-A635675BB4FD/15261EBB-ED0B-46DA8C3B-AE8C02E802B3/i\nsigning info: {\nsignatureStatus = \"-67062\";\n} (isApple: 0 / isAppStore: 0)\n\nThis 'i' process is what persists and starts 'launch agent' instance of Mughthesec. We can\nsee this, again, via the process monitor which shows process 'i' (pid: 568) invoking launchctl\nwith the 'load' command line option and the path to the launch agent plist:\n\n# procMonitor\n\nprocess start:\npid: 576\npath: /bin/launchctl\nuser: 501\nargs: (\n**\"/bin/launchctl\",**\n**load,**\n**\"/Users/user/Library/LaunchAgents/com.Mughthesec.plist\"**\n)\nancestors: (\n568,\n532,\n490,\n1\n)\nbinary: name: launchctl\npath: /bin/launchctl\nsigning info: {\nsignatureStatus = 0;\nsignedByApple = 1;\nsigningAuthorities = (\n\"Software Signing\",\n\"Apple Code Signing Certification Authority\",\n\n\n-----\n\nApple Root CA\n);\n} (isApple: 1 / isAppStore: 0)\n\nOk, so let's take a closer look at the Mughthesec launch agent and binary. The Mughthesec\nlaunch agent plist is located at ~/Library/LaunchAgents/com.Mughthesec.plist:\n\n$ cat ~/Library/LaunchAgents/com.Mughthesec.plist\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n<key>Label</key>\n<string>com.Mughthesec</string>\n<key>ProgramArguments</key>\n<array>\n<string>/Users/user/Library/Application\n**Support/com.Mughthesec/Mughthesec</string>**\n<string>r</string>\n</array>\n<key>RunAtLoad</key>\n<true />\n<key>StartInterval</key>\n<integer>14400</integer>\n</dict>\n</plist>\n\nFrom this plist we can see that the launch agent will:\n\n1. execute a binary: ~/Library/Application Support/com.Mughthesec/Mughthesec\n2. pass in a parameter: 'r'\n3. be automatically started whenever the user logs in, as 'RunAtLoad' is set to true\n\nThe 'Mughthesec' binary, ~/Library/Application Support/com.Mughthesec/Mughthesec, is\nunsigned:\n\n$ codesign -dvvv \"~/Library/Application Support/com.Mughthesec/Mughthesec\"\n\n\n-----\n\n~/Library/Application Support/com.Mughthesec/Mughthesec: code object is not signed at\n**all**\n\nIt is also (currently) undetected by any AV engines on VirusTotal:\n\nRunning strings shows some embedded URLs:\n\n$ strings -a ~/Library/Application Support/com.Mughthesec/Mughthesec | grep http\n\nhttp://api.mughthesec.com/ai\n\nhttp://api.mughthesec.com/l\n\nAttempting to access those URLs in a browser, appears to result in an error:\n\nHowever, the host mughthesec.com does appear to be online, resolving to 192.64.119.107:\n\n$ nslookup mughthesec.com\n\nNon-authoritative answer:\nName: mughthesec.com\nAddress: 192.64.119.107\n\nThis IP address, 192.64.119.107, appears to be rather malicious:\n\n\n-----\n\nSo what does the Mughthesec binary actually do? Lets take a peek! However, I want to point\nout that I've learned (the hard way) that spending a large amount of time reversing adware\ncan quickly drive one somewhat mad...so here, we'll only perform a cursory look.\n\nA common tactic of adware is to hijack the victims browser (homepage, inject ads, etc) for\nfinancial gain. Mughthesec (which is installed when the user \"agrees\" to install \"Safe Finder\")\nappears to conform to goal. Specifically we can see that Safari's home page has been set to\nhttp://default27061330-a.akamaihd.net/s?q=@@@&_pg=564D4420-C090-470B-9C136760B31264E7\n\n\n-----\n\nIf we open Safari; indeed the home page has been hijacked - though in a seemingly\ninnocuous way. It simply displays a rather 'clean' search page - though looking at the source,\nwe can the inclusion of several scripts 'Safe Finder' scripts:\n\n\n-----\n\nAlso, examining the installed extensions we can see that an \"Any Search\" browser extension\nwas installed:\n\n\n-----\n\nSearches are funneled thru various affiliates, before ending up being serviced by Yahoo\nSearch. However, 'Safe Finder' logic (such as an icon, and likely other scripts) are injected\ninto all search results:\n\nAt this point, I'm calling it a night! It appears that Mughthesec is simply some 'run-of-the-mill'\nmacOS malware. But is it new? Not likely. According to the mac adware analysis guru,\nThomas Reed; this \"looks like a new variant of something we call OperatorMac\":\n\n\n-----\n\nMoreover, [@noarfromspace pointed me towards several samples from earlier this year](https://twitter.com/@noarfromspace)\n(spring?) that appear to be related:\n\nConclusion\n\nIn the blog post, we sought to answer the question, \"What is Mughthesec?\" The answer;\nlikely a new variant of the 'SafeFinder/OperatorMac' adware. Yes it's rather unsophisticated\nmacOS malware, but it's installer is signed (to 'bypass' Gatekeeper) and at the time of this\nanalysis no anti-virus engines were detected it....and mac users are being infected :|\n\nSpeaking of infection, due to the fact that the installer is masquerading as Flash Player\ninstaller, it's likely that this adware is relying on common infection techniques to gain new\nvictims. If I had to guess its infection vector is likely one (or all?) of the following:\n\nfake popups on 'shady' websites\n\nmalicious ads, perhaps on legit websites\n\nEither way, user-interaction is likely required.\n\n[In terms of detection, we showed how BlockBlock will alert when the adware goes to persist.](https://objective-see.com/products/blockblock.html)\nNeat!\n\n[KnockKnock can also be used to (after the fact), to reveal infections. For example, it can](https://objective-see.com/products/knockknock.html)\nreveal the presence of the unsigned launch agent:\n\n\n-----\n\nAnd what about the malicious browser extension? Yup, [KnockKnock can show that too:](https://objective-see.com/products/knockknock.html)\n\nHooray! Objective-See FTW ❤\n\nTo manually disinfect Mughthesec:\n\n\n-----\n\nunload the launch agent via: launchctl unload\n~/Library/LaunchAgents/com.Mughthesec.plist\n\ndelete ~/Library/Application Support/com.Mughthesec/Mughthesec\n\ndelete ~/Library/LaunchAgents/com.Mughthesec.plist\n\ndelete the 'Any Search' browser extension\n\nHowever, as we saw, the Installer application could install other 'adware' - so it's probably\n[best to just reinstall macOS. Instructions here.](https://support.apple.com/en-us/HT204904%20)\n\n[love these blog posts & tools? you can support them via patreon! Mahalo :)](https://www.patreon.com/objective_see)\n\n© 2017 objective-see llc\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-08 - WTF is Mughthesec!-.pdf"
    ],
    "report_names": [
        "2017-08-08 - WTF is Mughthesec!-.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536012,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653787339,
    "ts_modification_date": 1653787339,
    "files": {
        "pdf": "https://archive.orkl.eu/6e00ab02cc8820a8f4603ccb809091375a5d8a74.pdf",
        "text": "https://archive.orkl.eu/6e00ab02cc8820a8f4603ccb809091375a5d8a74.txt",
        "img": "https://archive.orkl.eu/6e00ab02cc8820a8f4603ccb809091375a5d8a74.jpg"
    }
}