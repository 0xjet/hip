{
    "id": "1acbb980-380a-4392-8607-1482b00537e7",
    "created_at": "2022-10-27T08:36:20.022937Z",
    "updated_at": "2025-03-27T02:05:25.303405Z",
    "deleted_at": null,
    "sha1_hash": "5b66171cdf87f2761f341c4c6708d0be1cc4d27c",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-01-26T10:26:51Z",
    "file_modification_date": "2020-05-27T09:15:58Z",
    "file_size": 1637981,
    "plain_text": "## January 2020\n\n\n###### White Paper By: Ofer Shaked, Co-Founder & Chief T h l Offi\n\n\n# Anatomy Of A Targeted Ransomware Attack A True Story Of A Recent Incident Response To An Industrial Ransomware Cyber Attack\n\n###### White Paper By: Ofer Shaked, Co-Founder & Chief\n\n\n-----\n\n###### Overview  01\n\n The Ransom Note 02\n\n Incident Response Team Is Called On-Site 03\n\n Gathering the Evidence 04\n\n Here is Where the Team Started Looking 05\n\n The Evidence Analysis 06\n\n The Initial Findings 07\n\n Caught Red Handed 08\n\n Closing the Loop 09\n\n Additional Attack Methods Used by the Cyber Attackers 10\n\n Further Analysis 11\n\n Conclusions and Next Steps 12\n\n Don’t Be Scared, Be Prepared 14\n\n Message from the Author 15\n\n\n### Table of Content\n\n\n-----\n\n# Overview\n\n\n#### SCADAfence’s Incident Response team assists companies in industrial\n\n cyber security emergencies. In this whitepaper, we will review a recent\n\n incident response activity in which we took part.\n\n This whitepaper has been published with the goal of assisting organizations\n\n to plan for such events and reduce the impact of cyber-criminals on their\n\n networks.\n\n The company that was attacked didn’t have the SCADAfence Platform\n\n deployed at the time of the attack. The SCADAfence Platform was\n\n installed upon the arrival of our Incident Response team as part of the\n\n investigation, and helped them to contain the threat.\n\n The SCADAfence Incident Response team was assisted by the SCADAfence\n\n Reverse Engineering team and by the SCADAfence Research teams, in\n\n order to gain knowledge on the cyber attackers and to contain the attack.\n\n\n-----\n\nLate at night on November\n24th, critical services suddenly\nstopped working at the largest\nmanufacturing facility of Umbrella,\nInc.*, an international pharmaceutical\ncompany. An investigation was\nimmediately launched. While\ninvestigating the issue, the local\nIT team found ransom notes on a\nnumber of devices in the network,\nrequesting the company to contact a\ncertain email address and to make a\npayment in Bitcoin.\n\n\n# The Ransom Note\n\n\nThe IT team immediately called\nMr. Birkin*, the Group IT Leader\nwho was sleeping soundly. He\nimmediately woke up and rushed\nto the plant, while more and\nmore devices started showing the\nransom note.\n\nDuring the 7 hours of the attack,\naround 200 critical servers\nwere encrypted, and the entire\nproduction network was down as\na result.\n\n\nThe company evaluated the\nsituation and came to the\nconclusion that they would\npay the ransom in Bitcoin. But\nthen the attackers decided to\nchange their price, which made\nthe company completely lose\ntheir trust in the cyber criminals,\nand they decided not to pay the\nransom to the cyber criminals.\n\n\n-----\n\nSCADAfence’s Incident Response (IR) team was then urgently called to the site, which is located in a relatively\nremote industrial area. On the way to the site, the SCADAfence IR team was briefed on the situation, and then\nprovided initial containment instructions to the on-site security team.\n\n#### Initial Response Incident Response Instructions Goals\n\n**The goals of the initial instructions, before** **The SCADAfence IR team arrived at the site**\n**the SCADAfence IR team arrived on-site,** **and received the following objectives from**\n**were as follows:** **Mr. Birkin:**\n\n1.  Contain the threat to a specific area of the 1.  Identify the initial attack vector (how the\nnetwork and prevent infection of additional attackers got into the network in the\nnetworks. first place).\n\n2.  Eliminate or minimize downtime of 2.  Understand the propagation methods.\nunaffected systems, without exposing\n\n3.  Identify all of the machines that are infected.\n\nthem to additional risks.\n\n4.  Monitor for any additional suspicious\n\n3.  Keep evidence in an uncontaminated activity to make sure there are no\nstate. Contaminated evidence hampers an backdoors through which the cyber\ninvestigation. attackers could gain re-entry.\n\nThe IR team was then briefed by the site’s engineers and managers about the situation, and they decided\ntogether on the next steps to achieve those goals.\n\n\n# Incident Response Team Is Called On-Site\n\nSCADAfence’s Incident Response (IR) team was then urgently called to the site, which is located in a relatively\n\n\n-----\n\nAfter the IR team understood the entire situation,\nthe first step they took was to gather the evidence\n\nas soon as possible. The evidence included images\nof the systems, the log files, the configuration files,\nand basically anything that might contain information\nwhich could be important for the investigation.\n\nThe reason for the urgency is because many\nsources of evidence are cyclical, meaning they are\n\n\nautomatically deleted after a while by fresh new data.\nSome evidence is saved without historical data (such\n\nas file timestamps), and can become contaminated\nwith new information if the team waits for too long.\nThe attackers can attempt to delete evidence (such\nas exploits, malware files), and sometimes people\nwho are trying to be helpful but aren’t experienced\nin cyber security can also contaminate or delete\nevidence accidentally.\n\n\n# Gathering the Evidence\n\nAfter the IR team understood the entire situation, automatically deleted after a while by fresh new data.\nthe first step they took was to gather the evidence Some evidence is saved without historical data (such\n\n\n_File modification dates are easily contaminated with fresh data, if not investigated immediately_\n\n\n_File modification dates are easily contaminated with fresh data, if not investigated immediately_\n\n\nIf not investigated immediately, file modification\ndates can easily be contaminated with fresh data.\nThe SCADAfence IR team found out that,\nunfortunately, due to a lack of synchronization\nbetween the company’s IT team prior to their\narrival on the site some of the evidence had been\ncontaminated or lost. For example, some machines\n\n\n# Gathering the Evidence\n\nAfter the IR team understood the entire situation,\nthe first step they took was to gather the evidence\n\nas soon as possible. The evidence included images\nof the systems, the log files, the configuration files,\nand basically anything that might contain information\n\n\nhad been restored from backups without prior\nimaging and some logs had been lost because\nthey weren’t saved in time (prior to the automated\ndeletion cycle).\nIdeally, the IR team should run forensics on all the\nmachines; but in order to save time, the team needed\nto make educated guesses on where to start.\n\n\n-----\n\n### 1 Machines that showed signs of infection before others. 2 [Machines that were central in many attacks, such as domain controllers.]\n\n\n# Here is Where the Team Started Looking:\n\n\n### 3 [Machines that showed signs of malicious activity in addition to the ransomware operation – for ]\n**example machines that have other attack tools on them. Such information can be gathered from**\n**alerts in the already-installed security mechanisms.**\n\n\n### 4 [Other machines that are suspicious for other reasons.]\n\n\nWhile on the way, the IR team requested that the\ncompany’s IT team should create images of all the\ninfected machines, and if impossible (such as in\nthe case of embedded devices like PLCs/switches,\netc), they should at least gather all of the logs from\nthe devices. This process should be performed by\nsomeone who is familiar with the type of evidence\nthat each type of device can offer and who is able to\nfind the logs that are relevant from a cyber-security\n\n\npoint of view.\nOn-site, the SCADAfence Platform was installed\non the backbone switch in order to later assist in\ndetecting and documenting any suspicious activity\ngoing forward. The SCADAfence IR team knew that\nthe attackers would still have access to the network\nand the team wanted to see what the attackers were\ndoing in the network, and also to recognize any more\ninfected machines and/or possible access vectors.\n\n\nSIEM/SOC IT Network ERP Remote Access\n\nFirewall\n\nBackbone Switch\n\nManufacturing\nExecution\nSystem (MES)\n\nSwitch\n\nHistorian Engineering HMIs\nServers Workstations\n\nSwitch\n\nPLC PLC PLC\n\n_The SCADAfence Platform installed on the backbone switch_\n\n\n-----\n\n# The Evidence Analysis\n\n\nThe images have been analyzed by the SCADAfence\nforensics team. The SCADAfence forensics team\ninspected the configuration of the machines,\nthe suspicious executables, the log files, the file\ntimestamps, the event logs, the suspicious files and\neverything else that could be relevant. All of the\nsuspicious executables and binary files were sent to\nthe SCADAfence Reverse Engineering (RE) team for\nfurther analysis.\nThe SCADAfence RE team is capable of quickly\nunderstanding any type of attack method and\ntools, and has the ability to find IOCs (Indicators\nof Compromise) in binaries and executables, such\nas C&C (Command & Control) server addresses,\npasswords, and other similar valuable information.\n\n\nThe images have been analyzed by the SCADAfence\nforensics team. The SCADAfence forensics team\n\n\n##### The SCADAfence Reverse Engineering team is capable of quickly understanding any attack method and attack tools. They also have the abilities to find Indicators of Compromise in binaries and executables.\n\n\n-----\n\nSeveral minutes after sending the executable files to\nthe SCADAfence Reverse Engineering team, it was\ndiscovered that the attackers used a unique malware\n\nsample without any shared IOCs with other malware,\nwhich had prevented it from being detected by\nsignature-based methods.\n\nThe team also found the IP addresses of the new\nC&C (Command & Control) servers, together with\nthe multiple connection methods they support.\n\n\nThis allowed the SCADAfence IR team to go to the\norganizational firewall, filter for those IP addresses\nand ports, and get a list of all the infected machines.\n\nThe full list included infected machines that the IT\nteam had not been aware were infected. As a result\nof this effort, they started reinstalling or restoring\nthose machines from backup immediately. Infected\nmachines can reinfect other machines, so it is critical\nto work on them as soon as possible.\n\n\n-----\n\nA few hours after investigation started, the newly\ninstalled SCADAfence Platform reported a network\nscanning activity from one of the machines which\nwas not on its list of infected machines. This machine\nwas a server, central to the operation of the network\nand had multiple network interfaces (NICs) plus\nspecial firewall rules that allowed it to communicate\nwith other network segments. The SCADAfence\nPlatform reported that this server was scanning\nsegments that were not infected, over ports 445\nTCP (SMB) and 3389 TCP (RDP). The scanning activity\nwas not visible in the firewall logs because some of\nthe networks had been bridged using NICs installed\non the machine rather than by being routed through\nthe firewall.\n\n\n# Caught Red Handed\n\n\nThe customer was unaware of such configurations,\nand assumed that all cross-segment traffic was\nrouted through the firewall.\n\n\nAs a result of the scanning event, the SCADAfence\nIR team understood that the attackers were looking\nfor additional segments to infect, and they decided\nto shut down all machines that have multiple\nNICs, as at least one NIC had been shared with the\ninfected segment. This was a high price for the\ncustomer to pay, but it was the SCADAfence IR team’s\nrecommendation because it was the only way to limit\nthe attack surface. On this newly infected machine,\nadditional attack tools were discovered, such as the\nnetwork scanner that was used by the attackers.\n\n\n-----\n\nThis machine was managed by an external contractor for the purpose of maintenance and support. It had\nan external IP address, which prevented the IR team from finding it in the firewall logs (these were filtered\non connections from inside to the outside). It had internet connectivity open to only one IP – the IP of a\n\nmachine that was managed by the external contractor. The machine’s event log showed an RDP connection\nfrom the external machine approximately 1 hour before the attack had begun.\nWith the guidance of the vendor, the SCADAfence IR team connected to the external machine and\nreviewed its logs:\n\n**Here is what they discovered:**\n\n### 1 It had an RDP port open to the internet. 2 [It was unpatched.]\n\n\n# Closing the Loop\n\nThis machine was managed by an external contractor for the purpose of maintenance and support. It had\n\n\n### 3 [It had no endpoint protection software.]\n\n\n### 4 [Windows Defender was disabled.]\n\n\n### 5 [It had a “twin” log event of connecting to the internal machine at the same time.]\n\n\n##### These pieces of evidence confirmed that the origin of the attack was the external server, which had been left unpatched and was exposed to the internet and maintained by a vendor with little awareness of cyber security. The entire investigation took the SCADAfence IR team about 10 hours.\n\n\n-----\n\n# Additional Attack Methods Used by the Cyber Attackers\n\nIn addition to the main attack methods, which were an RDP vulnerability, a C&C server and a ransomware\nexecutable, the cyber attackers also used additional attack methods that were discovered in the SCADAfence\nPlatform such as:\n\n1. Patching the hosts file to prevent access to the VirusTotal malware analysis service.\n\n\n2. Disabling Windows updates.\n\n3. Hiding executables in legitimate folders.\n\n4. Locking any input devices during the encryption process.\n\n5. Disabling the endpoint protection software.\n\n6. Using Mimikatz to successfully extract and use Domain Admin Kerberos tickets.\n\n\n-----\n\nThe attackers may have generated additional backdoors into the network, so continuing monitoring with the\nSCADAfence Platform is crucial to ensure that the whole network does not become reinfected.\n\n**In addition to that, the SCADAfence Platform has:**\n\n\n# Further Analysis\n\nThe attackers may have generated additional backdoors into the network, so continuing monitoring with the\n\n\n### 1 Detected multiple, high-risk policy violations, after configuring the company’s security policy in the\n**SCADAfence Governance portal.**\n\n\n### 2 [Mapped all external to internal and internal to external access points.]\n\n\n**Mapped the connectivity between network segments, including legacy and hidden**\n### 3 connections that were unknown to the customer.\n\n\n### 4 [Detected additional wormable vulnerabilities in both the industrial and IT equipment, that should ]\n**be patched or contained.**\n\n\n### 5 [Detected additional security events over the course of the weeks following the attack.]\n\n\nThese findings allowed\nthe IT team to prevent\nsimilar future attacks\nfrom happening again,\nthereby reducing risk\nexposure.\n\n\n-----\n\nThe SCADAfence Research team has compiled a list\nof steps that could have prevented the cyber-attack\nor could have seriously limited the attack’s impact:\n\n1 A network monitoring system with a firewall\nintegration, like the SCADAfence Platform,\ncould have prevented the attack. When cyber\nattackers are scanning the network, the network\nmonitoring system could have automatically\nisolated the device, disconnecting it from the\ninternet and sending it to the IT team for further\nreview. This would have ended the incident\nbefore the machine started infecting any other\nmachines.\n\n2. A proactive approach would have been much\nmore cost-effective to execute, as opposed to\nbeing attacked and handling the cyber-attack\nincident later on. The proactive approach allows\nsecurity teams to know in advance if they have\nany policy violations, or if they have any network\nor device vulnerabilities, and they can perform\n\n\nprioritization. A machine that is open to the\ninternet, and is also a part of a large subnet with\ncritical servers, is easy to detect and would have\n\nbeen prioritized as a critical finding by a network\nmonitoring platform such as the SCADAfence\nPlatform.\n\n3. Have off-site backups of important systems and\ntest restoration procedures from time to time.\nHave at least 1-2 older backup points, for example\nfrom 90 and 180 days ago (if your storage allows\nit). Otherwise, the IT teams might be restoring a\nbackup from last week that’s still infected with\nmalware. Restoring from an infected backup can\nseverely prolong the restoration time.\n\n4. The SCADAfence IR team reviewed all of\nthe Domain Admin accounts along with the\ncustomer and helped them change all of their\npasswords. The IR team also reviewed all\nKerberos related configurations and reset the\nKRBTGT password.\n\n\n##### A network monitoring system with a firewall integration, like the SCADAfence Platform, could have prevented the attack\n\n\n##### A network monitoring system with a firewall integration, like the SCADAfence Platform, could have prevented the attack\n\n\n-----\n\n5. Kerberos tickets must timeout as recommended\nby Microsoft – 600 minutes or less.\n\n6. All externally facing services should be micro\nsegmented. Access to, and from them should be\nrestricted.\n\n7. A secure remote connectivity solution must be\nput in place, such a solution is available by using\nSCADAfence and CyberArk.\n\n8. All remote connections should include 2-factor\nauthentication.\n\n9. Network segments must be put in place in a way\nthat traffic between them is limited to specific\nservices only, and not “any -> any” rules. They\nshould be defined in a way in which an infection of\n\n\nan entire segment won’t halt the operation of the\nentire network. Therefore, it’s not recommended\nto use one segment for all of the critical servers.\n\nSome servers, such as Domain Controllers, should\nhave their own segment.\n\n10. All machines that require internet connectivity\nshould be configured to use a central server in the\nDMZ instead of talking directly to IP addresses.\n\n11. Machines that are required to browse the\ninternet (host->any rule), should not be able to\ndirectly communicate with industrial devices or\nvulnerable devices.\n\n12. Start a software vulnerability management\nprocess (if you don’t already have one).\n\n\n5. Kerberos tickets must timeout as recommended an entire segment won’t halt the operation of the\n\n\n##### A proactive approach would have been much more cost-effective to execute, as opposed to getting attacked and later handling the cyber-attack\n\n\n-----\n\n# Don’t Be Scared, Be Prepared\n\n\nThis organization did not wait for a cyber-attack\nto start their cyber security program. They were in\n\ntouch with other security companies prior to the\nattack. However, they weren’t fast enough and the\nvulnerabilities were critical enough for attackers to\ngain access into the network and to cause damage.\n\n**A well-prepared network is:**\n\n**1. Very difficult to attack.**\n\n**2. Slows down the attackers, and allows the**\n**defenders to take action.**\n\n**3. Still attacked occasionally, but the damage**\n**caused is minimal.**\n\nFor example, in this specific network there were\naround 5,000 devices, but only 200 servers\nwere attacked. The reason for this is a network\nsegmentation solution that they had in place.\nOtherwise, they would now be recovering from a\n5,000 devices ransomware attack.\n\n\n-----\n\n#### Message from the author:\n\nIf you find value in the findings in this report and would like a 1-hour security review of your\nindustrial network, I would be happy to help.\n\nIt will be a free consultation, with me, and with no strings attached - all under NDA.\n\nI will give you my recommendations based on your specific security needs – after seeing\nhundreds of industrial networks and I will help you remediate any security issues that you might\nhave in your network.\n\nYours truly,\nOfer Shaked\n\n[CTO & Co-Founder of SCADAfence](https://www.linkedin.com/in/oshaked/)\n[Over a Decade in OT Security](https://www.scadafence.com/leadership/)\n[Security Architect in the OT Cyber Security Alliance (OTCSA)](https://otcsalliance.org/wp-content/uploads/2019/10/Introduction-to-the-OTCSA.pdf)\n[On the ManuSec Advisory Board](https://europe.manusecevent.com/steering-committee/)\n[Keynote Speaker at SANS events](https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1562060310.pdf)\n\nDates, names and other minor details have been changed or deleted in order to anonymize the report.\n\n\n-----\n\n#### About SCADAfence\n\nSCADAfence is the global technology leader in OT cyber security. The solution enables organizations with large-\nscale OT networks to embrace the benefits of industrial IoT by reducing cyber risks and mitigating operational\nthreats. The non-intrusive platform provides full coverage of large-scale networks, offering best-in-class\ndetection accuracy, asset discovery and user experience. The SCADAfence solution seamlessly integrates OT\nsecurity within existing security operations, bridging the IT/OT convergence gap. SCADAfence delivers security\nand visibility to some of the world's most complex OT networks, including the largest manufacturing facility in\nEurope. SCADAfence enables organizations in manufacturing, building management and in critical infrastructure\nindustries to operate securely, reliably and efficiently as they go through the digital transformation journey. To\nlearn more go to **www.scadafence.com**\n\n**Our offices**\nHeadquarters: Tel Aviv Contact us: info@scadafence.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://cdn.logic-control.com/docs/scadafence/Anatomy-Of-A-Targeted-Ransomware-Attack-WP.pdf"
    ],
    "report_names": [
        "Anatomy-Of-A-Targeted-Ransomware-Attack-WP.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666859780,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1580034411,
    "ts_modification_date": 1590570958,
    "files": {
        "pdf": "https://archive.orkl.eu/5b66171cdf87f2761f341c4c6708d0be1cc4d27c.pdf",
        "text": "https://archive.orkl.eu/5b66171cdf87f2761f341c4c6708d0be1cc4d27c.txt",
        "img": "https://archive.orkl.eu/5b66171cdf87f2761f341c4c6708d0be1cc4d27c.jpg"
    }
}