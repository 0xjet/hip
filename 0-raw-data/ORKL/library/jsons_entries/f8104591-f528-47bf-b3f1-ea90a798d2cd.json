{
    "id": "f8104591-f528-47bf-b3f1-ea90a798d2cd",
    "created_at": "2023-01-12T15:05:12.450585Z",
    "updated_at": "2025-03-27T02:06:01.986253Z",
    "deleted_at": null,
    "sha1_hash": "7c4026ff47270c3033d44994322ff5c8d06854bb",
    "title": "2019-08-26 - The DAA File Format",
    "authors": "",
    "file_creation_date": "2022-05-28T19:53:25Z",
    "file_modification_date": "2022-05-28T19:53:25Z",
    "file_size": 112685,
    "plain_text": "# SANS ISC: The DAA File Format - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**isc.sans.edu/forums/diary/The+DAA+File+Format/25246**\n\nThe DAA File Format\n\n\n[In diary entry \"Malicious .DAA Attachments\", we extracted a malicious](https://isc.sans.edu/forums/diary/Malicious+DAA+Attachments/25230/)\nexecutable from a Direct Access Archive file.\n\nLet's take a closer look at this file format. Here is an hex/ascii dump of the\nbeginning of the file:\n\n[With the source code of DAA2ISO, I was able to make some sense of this](https://aluigi.altervista.org/mytoolz.htm)\ndata. I highlighted important parts:\n\nFirst we have the magic sequence: DAA...\nSecond, we have an offset (0x0000004C) to the list of compressed\nchunk lengths\nThird, we have the file format version: 0x00000100\nFourth, we have an offset (0x0000005E) to the first compressed\nchunk\n\n\nDidierStevens\n\n640 Posts\n\nISC Handler\nAug 16th\n2019\n\n\n-----\n\nAnd then we have the list of chunk lengths (position 0x0000004C)\nAnd the chunks themselves (position 0x0000005E)\n\nThe list of compressed chunk lengths is a bit special: each lenght value is\nencoded with 3 bytes, using neither big-endian nor little-endian format.\n\nThe number format is the following: hex value 697 is encoded as 00 97\n06. So first you have the most significant byte, then the least significant\nbyte, and then the remaining, middle byte.\n\nTogether with the pointer to the first compressed chunk (position\n0x0000005E), we can use this length list to calculate the offsets of the\nother compressed chunks.\n\nExample: the second chunk is located at 0x5E + 0x697 = 0x06F3. DAA\nversion 0x100 uses zlib compression (DEFLATE), and the compressed\n[data is stored without header.](https://isc.sans.edu/forums/diary/Recognizing+ZLIB+Compression/25182/)\n\nArmed with this information, I could write a Python script to extract and\ndecompress the chunks stored inside a DAA file.\n\nHowever, I wrote a different program. For quite some time, I was playing\nwith the idea to write a program that can detect compressed data inside a\nbinary stream. Since a DAA file is essentially a concatenation of zlib\ncompressed chunks, such a program should also be able to extract and\ndecompress the ISO file inside a DAA file.\n\nHere is the result of my beta program running on the DAA sample:\n\nEach line represents compressed data found by the tool. The columns\nare:\n\n1. start position of compressed data (hexadecimal)\n2. size of the compressed data (decimal)\n3. size of the decompressed data (decimal)\n4. size of the remaining data (decimal)\n\nThis generic method will also generate false positives: data that\ndecompresses but is not actual compressed data. Like the first line: it's\nvery small (4 bytes compressed, 2 bytes decompressed) and is actually\ninside the DAA header. So this is clearly a false positive.\n\nOption -n can be used to impose a minimum length on the compressed\ndata. This can be used to filter out some false positives:\n\n\n-----\n\nRemark that the first byte sequence of compressed data is found at\nposition 0x5E, the same position as mentioned in the header.\n\nAnd the second byte sequence of compressed data is found at position\n0x6F5, that's the position that we calculated with the length of the first\nchunk.\n\nAll decompressed chunks have a size of 65536, except the last chunk:\nthat's how the DAA format stores the embedded ISO file. It's chopped-up\nin chunks of 65536 each, that are then compressed.\n\nFinally, I can use option -d to decompress and concatenate all\ncompressed chunks:\n\nA similar file format is also used for other CD/DVD image formats, like the\ngBurner format, compressed ISO format, ...\n\nDidier Stevens\n\nSenior handler\n\nMicrosoft MVP\n\n[blog.DidierStevens.com](http://blog.didierstevens.com/) [DidierStevensLabs.com](http://didierstevenslabs.com/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-26 - The DAA File Format.pdf"
    ],
    "report_names": [
        "2019-08-26 - The DAA File Format.pdf"
    ],
    "threat_actors": [
        {
            "id": "b23e717c-0b27-47e0-b3c8-4defe6dd857f",
            "created_at": "2023-01-06T13:46:38.367369Z",
            "updated_at": "2025-03-27T02:00:02.815758Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "ATK35",
                "Peach Sandstorm",
                "TA451",
                "APT 33",
                "Elfin",
                "Refined Kitten",
                "MAGNALLIUM",
                "HOLMIUM",
                "COBALT TRINITY",
                "G0064"
            ],
            "source_name": "MISPGALAXY:APT33",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e5ff825b-0456-4013-b90a-971b93def74a",
            "created_at": "2022-10-25T15:50:23.824058Z",
            "updated_at": "2025-03-27T02:00:55.553346Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "APT33",
                "HOLMIUM",
                "Elfin",
                "Peach Sandstorm"
            ],
            "source_name": "MITRE:APT33",
            "tools": [
                "PowerSploit",
                "AutoIt backdoor",
                "PoshC2",
                "Mimikatz",
                "NanoCore",
                "DEADWOOD",
                "StoneDrill",
                "POWERTON",
                "LaZagne",
                "TURNEDUP",
                "NETWIRE",
                "Pupy",
                "ftp",
                "Shamoon"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535912,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653767605,
    "ts_modification_date": 1653767605,
    "files": {
        "pdf": "https://archive.orkl.eu/7c4026ff47270c3033d44994322ff5c8d06854bb.pdf",
        "text": "https://archive.orkl.eu/7c4026ff47270c3033d44994322ff5c8d06854bb.txt",
        "img": "https://archive.orkl.eu/7c4026ff47270c3033d44994322ff5c8d06854bb.jpg"
    }
}