{
    "id": "bfe2e54b-e92f-41b6-9fc9-7abe52abcdd5",
    "created_at": "2023-01-12T15:01:50.017883Z",
    "updated_at": "2025-03-27T02:06:01.27489Z",
    "deleted_at": null,
    "sha1_hash": "1bdd22158f744c4195a7e79ed5d8397d19ae3159",
    "title": "2018-02-22 - Let's Learn- Deeper Dive into Ramnit Banker -VNC IFSB- Remote Control Module",
    "authors": "",
    "file_creation_date": "2022-05-28T04:12:34Z",
    "file_modification_date": "2022-05-28T04:12:34Z",
    "file_size": 194172,
    "plain_text": "# Let's Learn: Deeper Dive into Ramnit Banker \"VNC IFSB\" Remote Control Module\n\n**[vkremez.com/2018/02/deeper-dive-into-ramnit-banker-vnc-ifsb.html](http://www.vkremez.com/2018/02/deeper-dive-into-ramnit-banker-vnc-ifsb.html)**\n\n**Goal: Analyze Ramnit's hidden Virtual Network Computing (hVNC) remote control module**\nfocusing on its hidden desktop creation.\n\n**Source:**\n\nRamnit main loader (5ae2ad8f0be144ce732badf7dec0a16e)\nhVNC module (5AE2AD8F0BE144CE732BADF7DEC0A16E)\nRig Exploit Kit landing (AS9123 TIMEWEB-AS 176[.]57[.]217[.]89)\n\n**Background:**\n\nWhile following the Rig Exploit Kitâ€™s distribution of the Ramnit (demetra) banking malware via\nthe Seamless gate, I decided to dive deeper into its â€œVNC ISFBâ€ module that is most notable\nrunning as a thread inside â€œTRACERT.EXE,â€ a child process of Ramnitâ€™s svchost.exe\n\n[2-13-2018: #Seamless gate ->](https://twitter.com/hashtag/Seamless?src=hash&ref_src=twsrc%5Etfw) [#RigEK landing](https://twitter.com/hashtag/RigEK?src=hash&ref_src=twsrc%5Etfw)\n\n[176.57.217[.]89 -> AS9123 TIMEWEB-AS ->#Ramnit banker #malware -> just](https://twitter.com/hashtag/Ramnit?src=hash&ref_src=twsrc%5Etfw)\n[copy/pasted code from #ISFB gang's hidden VNC module w/ hooks & \"IsfbInitClient\"](https://twitter.com/hashtag/ISFB?src=hash&ref_src=twsrc%5Etfw)\nðŸ˜‚\n\n[Hash: 5ae2ad8f0be144ce732badf7dec0a16e pic.twitter.com/NjfPBSsIXz](https://t.co/NjfPBSsIXz)\n[â€” Vitali Kremez (@VK_Intel) February 13, 2018](https://twitter.com/VK_Intel/status/963323392169512960?ref_src=twsrc%5Etfw)\n\nBy and large, Ramnit, which is also known as â€œdemetraâ€ in the underground, leverages the\nfollowing modules:\n\nAntivirus Trusted Module v2.0 (AVG, Avast, Nod32, Norton, Bitdefender)\nXX'S\nCookieGrabber\nCookie Grabber v0.2 (no mask)\nFFCH\nFF&Chrome reinstall x64-x86 [silent]\nHooker\nIE & Chrome & FF injector\nVNC IFSB\nVNC IFSB x64-x86\n\nHVNC allows criminals to bypass many anti-fraud measures by allowing compromised\naccounts to be accessed directly from the victim's machine. By using a VNC program, which\nallows for remote access to and control of a machine, Ramnit actors do not have to spoof or\ntry to replicate a victim machine's data to avoid the account being flagged. HVNC allows\n\n\n-----\n\nactors to carry out these activities concurrent with regular user activity without being detected\nby operating in a hidden desktop.\nThe DLL module contains the following three export ordinals:\n\n**Ordinal** **Export Function**\n\n00000000 PluginRegisterCallbacks\n\n00000002 VncStartServer\n\n00000003 VncStopServer\n\nHere is one of the most interesting sequences of hidden desktop calls with injection:\n**Start -> init_modules** **function -> session_control_thread function -> VNC** **session**\n**communication function -> send VNC encode function -> VNC draw** **BitBlt function ->**\n**hidden Desktop initiation -> creation of hidden explorer exe -> create process inject**\n\n\n-----\n\n**function -> AcInjectDll function (check x86/x64) hooking CreateProcess -> map**\n**memory into the process and inject it with RunPE injection**\n**Analysis:**\nRamnitâ€™s VNC module leverages a set of programs using the Remote Frame Buffer (RFB)\n[protocol hooking multiple API calls and leveraging ISFB AcDLL injection module. Not only](https://github.com/gbrindisi/malware/tree/master/windows/gozi-isfb/AcDll)\nthe whole Ramnit module was pulled directly from the ISFB gang, the module itself has\n[strong source code similarities to the leaked Carberp one.](https://github.com/hzeroo/Carberp/tree/6d449afaa5fd0d0935255d2fac7c7f6689e8486b/source%20-%20absource/pro/all%20source/RemoteCtl/hvnc/libs/hvnc/hvnc)\n\nThe following pseudocoded C++ function demonstrates the location of the \"explorer.exe\" with\nthe subsequent create process injection.\n```\n  signed int __stdcall explorer_exe(int a1)\n  {\n   int v1; \n   int v2; \n   signed int result; \n   CHAR *v4;\n   CHAR *v5;\n   int v6;\n   char v7;\n   int v8;\n   DWORD v9;\n   v1 = a1;\n   v9 = 0;\n   v6 = 0;\n   memset(&v7, 0, 0x40u);\n   v2 = GetSystemWindowsDirectoryA(0, 0);\n   if ( v2 )\n   {\n\n```\n\n-----\n\n```\n  v4 HeapAlloc(hHeap, 0, v2 15);\n  v5 = v4;\n  if ( v4 )\n  {\n   GetSystemWindowsDirectoryA(v4, v2);\n   v5[v2] = 0;\n   lstrcatA(v5, \"\\\\explorer.exe\");\n   v8 = v1 + 1488;\n   v6 = 68;\n   if ( create_process_inject(v5, &v6, v1 + 12) ) // AcDLL\ninjection\n   {\n    CloseHandle(*(v1 + 16));\n    CloseHandle(*(v1 + 12));\n   }\n   else\n   {\n    v9 = GetLastError();\n   }\n  }\n  else\n  {\n   v9 = 8;\n  }\n  result = v9;\n }\n else\n {\n  result = -1;\n }\n return result;\n}\n\n```\n\n-----\n\n-----\n\n**YARA RULE**\nrule crime_win32_ramnit_vnc_module_in_memory {\nmeta:\ndescription = \"Detects Ramnit banking malware VNC module\"\nauthor = \"@VK_Intel\"\nreference = \"Detects Ramnit VNC\"\ndate = \"2018-02-18\"\nhash = \"888b2c614567fb5b4474ddeeb453f8cd9f44d72efb325f7e3652fd0f748c08f1\"\nstrings:\n$s0 = \"Failed mapping a section to the target process, status 0x%x\" fullword ascii\n$s1 = \"Unable to map the section into the target process, error %u\" fullword ascii\n$s2 = \"Unable to resolve target process import, error %u\" fullword ascii\n$s3 = \"No module found for the target process (%u) architecture\" fullword ascii\n$s4 = \"A section of %u bytes mapped to the target process at 0x%p\" fullword ascii\n$s5 = \"CreateProcessAsUserA %s->%s failed\" fullword ascii\n$s6 = \"Dep PsSupGetProcessModules, ModCount = %d \" fullword ascii\n$s7 = \"ActiveDll: PatchProcessMemory failed, error: %u\" fullword ascii\n$s8 = \"CreateProcessAsUserW %S->%S failed\" fullword ascii\n$s9 = \"AcInjectDll: GetOEP failed, error: %u\" fullword ascii\n$s10 = \"Shared section mapped at 0x%p. Starting within VNC session process.\" fullword\nascii\n$s11 = \"CreateToolhelp32Snapshot (of processes) failed err=%lu\" fullword ascii\ncondition:\n11 of ($s*)\n}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-02-22 - Let's Learn- Deeper Dive into Ramnit Banker -VNC IFSB- Remote Control Module.pdf"
    ],
    "report_names": [
        "2018-02-22 - Let's Learn- Deeper Dive into Ramnit Banker -VNC IFSB- Remote Control Module.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535710,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653711154,
    "ts_modification_date": 1653711154,
    "files": {
        "pdf": "https://archive.orkl.eu/1bdd22158f744c4195a7e79ed5d8397d19ae3159.pdf",
        "text": "https://archive.orkl.eu/1bdd22158f744c4195a7e79ed5d8397d19ae3159.txt",
        "img": "https://archive.orkl.eu/1bdd22158f744c4195a7e79ed5d8397d19ae3159.jpg"
    }
}