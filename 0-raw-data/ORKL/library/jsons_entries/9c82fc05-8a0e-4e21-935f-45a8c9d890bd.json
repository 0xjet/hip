{
    "id": "9c82fc05-8a0e-4e21-935f-45a8c9d890bd",
    "created_at": "2024-01-05T02:07:56.249375Z",
    "updated_at": "2025-03-27T02:08:41.266907Z",
    "deleted_at": null,
    "sha1_hash": "9dc10a08df2833941a79f04ee5dd9d48e354cb8f",
    "title": "Revenge RAT Targeting Users in South America",
    "authors": "Uptycs",
    "file_creation_date": "2024-01-04T04:22:09Z",
    "file_modification_date": "2024-01-04T04:22:09Z",
    "file_size": 1390320,
    "plain_text": "# Revenge RAT Targeting Users in South America\n\n**[uptycs.com/blog/revenge-rat-targeting-users-in-south-america](https://www.uptycs.com/blog/revenge-rat-targeting-users-in-south-america)**\n\nAbhijit Mohanta\n\nThe Uptycs [threat research team recently came across multiple document samples that](https://www.uptycs.com/products/use-cases/threat-hunting)\ndownload Revenge RAT. The campaign currently seems to be active in Brazil. All of the\nmalware samples we received have the same properties. One of the samples we received\nhas the name “Rooming List Reservas para 3 Familias.docx” (SHA-256:\n91611ac2268d9bf7b7cb2e71976c630f6b4bfdbb68774420bf01fd1493ed28c7). The\ndocument has only a few detections in VirusTotal.\n\n_Figure 1: VirusTotal detections for the document. (Image via VirusTotal.)_\n\nUpon opening the document, a series of events happen that lead to the download of\nRevenge RAT malware hosted on a Brazilian website (hxxp://azulviagens[.]online). Azul\nViagens is a legitimate hotel chain in Brazil and the official website of the hotel can be found\n[here.](https://www.azulviagens.com.br/)\n\nAttackers registered the fake domain name and used a room reservation document file to\ninfect the end user. The attack is multi-stage with the components used in the attack spread\nacross multiple files on the attacker’s server. The WHOIS records for\nhxxp://azulviagens[.]online seems to have been registered on December 10, 2020 with the\n[email ID mmpereiramm30@gmail.com.](mailto:mmpereiramm30@gmail.com.)\n\n## The Attack Flow\n\nThe components of the attack span multiple stages. Figure 2 (below) shows the steps\ninvolved in the attack.\n\n\n-----\n\n_Figure 2: The attack flow._\n\n**Step 1: The DOCX file (“Rooming List Reservas para 3 Familias.docx”) used in the**\nattack vector downloads the “1.docx” (template) from the CnC server\n**Steps 2 and 3: The embedded “Microsoft_Excel_Macro-Enabled_Worsksheet1.xlsm”**\nfile in \"1.docx\" (template) downloads the PowerShell code “A.txt” from the CnC server\nand executes it in memory.\n**Step 4: The PowerShell code in “A.txt” downloads “index.mp3” from the CnC server**\nand saves it as “index.vbs.”\n**Step 5: Upon execution, “index.vbs” creates “opera.vbs,” which contains code to**\nexecute “opera.ps1” created in the next step.\n**Step 6: “index.vbs” downloads “1.txt” and saves it as “opera.ps1,” which has**\nobfuscated Revenge RAT in it.\n**Step 7: “opera.vbs” executes “opera.ps1.”**\n\nA detailed analysis of files used during various stages of the attack is provided below.\n\n## The Initial Document\n\nThe initial document, “Rooming List Reservas para 3 Familias.docx,” used as the attack\nvector is a DOCX file. The document uses a technique known as Dynamic Office Template\nInjection to bypass security products. This allows the attacker to store the malicious file on a\nremote server. This technique can evade anti-malware solutions that rely on static detection.\n\n\n-----\n\nThe document has the structure shown in Figure 3 (below). The structure contains a file\nnamed “footer.xml.rels.” The “target” fields in the file point to the templates hosted on the\nCnC server. There are several URLs in the “target” fields that point to files “1.docx” all the\nway to “9.docx” hosted on the CnC server. Each of the files has the same content (the same\nSHA-256: 338b2d8d76f4028bfbd177127371b2509971606553d606c534316dc40cfa8fb9).\n\n_Figure 3: Structure of the DOCX and footer.xml.res pointing to the malicious template. (Click_\n_to see larger version.)_\n\nWhen the victim opens the document, one of the templates is downloaded and executed.\n\n## The Template File\n\nThe template file(\"1.docx\" ... \"9x.docx\") follows the structure shown in Figure 4 (below). The\nsettings.xml in the structure have the “target” fields that point to XLSM files, which are\npresent in the “embeddings'' directory in the structure of the DOCX file.\n\nThe XLSM files “Microsoft_Excel_Macro-Enabled_Worksheet.xlsm” to\n“Microsoft_Excel_Macro-Enabled_Worksheet9.xlsm” have the same contents (same SHA256: 32f1a502126b1932e1def04b98d8be235c8d25ef7268f8cb35d460cd073a88b2). When\nthe template file (\"1.docx\" ... \"9x.docx\") is executed by Microsoft Word, it executes one of the\nXLSM files (“Microsoft_Excel_Macro-Enabled_Worksheet.xlsm” to “Microsoft_Excel_MacroEnabled_Worksheet9.xlsm”).\n\n\n-----\n\n_[Figure 4: XLSM files inside the 1.docx template. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure4-crop.png)_\n\n## The XLSM File\n\nThe XLSM file follows the structure shown in Figure 5 (below). The structure contains\nmacros in the “VBAProject.bin” file. The following screenshot shows the stream containing\nthe macros.\n\n\n-----\n\n_Figure 5: Macros in XLSM._\n\nThere are two important macros present in the BIN file: “Macro 1” kills the Microsoft Word\nprocess “winword.exe” and “Macro 2” downloads and executes the PowerShell code present\nat the URL\n\n“hxxp://azulviagens[.]online/A.txt” in memory.\n\nFigure 6 (below) shows the contents of “A.txt.”\n\n\n-----\n\n_Figure 6: PowerShell script in hxxp://azulviagens[.]online/A.txt._\n\nWhen the PowerShell code in “A.txt” is executed, it downloads the contents of “index.mp3”\nand saves it to file the “index.vbs” and executes it.\n\n## Index.vbs\n\nFigure 7 (below) shows the code in “index.vbs.” When “index.vbs” is executed it creates\nanother two files, “opera.vbs” and “opera.ps1” in the “C:\\Users\\Public\\” directory. “Index.vbs”\ndownloads the contents of hxxp://azulviagens[.]online/1.txt and saves it to “opera.ps1.” The\n“index.vbs” file places the following command in “opera.vbs”:\n```\nl.exe -nologo -ExecutionPolicy Unrestricted -File C:\\Users\\Public\\Opera.ps1\n\n```\nThe command is then executed. When executed, “opera.vbs” executes the file “opera.ps1.\"\n\n_[Figure 7: Code in index.mp3 (index.vbs). (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure7-lg.png)_\n\n## Opera.ps1\n\n“Opera.ps1” is a highly obfuscated PowerShell script (see Figure 8, below). One thing that\ncatches our eye is the string “4D 5A,” which indicates the magic header of a Windows\nexecutable.\n\n\n-----\n\n_Figure 8: 4D5A in opera.ps1._\n\nAfter de-obfuscating the PowerShell code, we were able to retrieve the Windows executable,\nwhich is the Revenge RAT. Below is the description of the Revenge RAT we extracted.\n\nSimilar PowerShell code was also found hosted on x-root.net, which has also been\nregistered in recent months. Uptycs’ EDR capabilities can decode the obfuscated\nPowerShell code, as shown in the screenshot below (Figure 9).\n\n_[Figure 9: Deobfuscated PowerShell code. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure9.png)_\n\n## The Revenge RAT\n\nRevenge RAT was first seen mid-2016. The RAT has been coded in .NET. The Revenge\nRAT we extracted is not a packed binary and code is clearly visible. Below is a description of\nthe various classes and methods present in the decompiled code.\n\n### Program\n\nThe “Program” class shown in Figure 10 (below) contains the main function of the program.\nThe main() function creates a mutex and then executes the rest of the code.\n\n\n-----\n\n_[Figure 10: Program class. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure10.png)_\n\n### RAT Configuration\n\nFigure 11 (below) contains the configuration for the RAT, which is used during execution.\n\n_Figure 11: RAT configuration._\n\nBelow are some members of the config class and their functionality:\n```\n   host: CnC server\n   port: CnC port\n   id: Unique identity of the installed RAT on the victim machine\n\n```\n\n-----\n\n```\n   currentMutex: Mutex placed by the RAT on the system\n   stopwatch(): This is a member function that can be use to reset the stopwatch\n\n### IdGenerator\n\n```\nThe class IdGenerator shown in Figure 12 (below) is used for creating a unique ID for the\nvictim machine, which the RAT is going to send to the CnC server. A unique string ID is\ngenerated by retrieving various system attributes using the methods in the class. Below are\nsome of the methods:\n```\n   GetActiveWindow: Get active window or window of the application used by the user\n   GetAV: Get the antiviruses installed on the system\n   GetCamera: Get information about the camera\n   GetCpu: Get CPU information\n   GetHardDiskSerialNumber: Get hard disk serial number\n   GetIp: Get IP address\n   GetSystem: Get processor information\n   SendInfo: Concatenate information collected by previous methods into a string “id”\n\n```\n\n-----\n\n_[Figure 12: Components of the IdGenerator class. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure12-lg.png)_\n\n### Client\n\nThe client class implements the network client of the RAT. It has the following methods:\n```\n   Ping: Pings the CnC server\n   TCPReceive: Received data to the server\n   TCPSend: Send data to the server\n\n### Handler\n\n```\nThe Handler class shown in Figure 13 (below) is used to process the CnC command\nreceived from the attacker.\n\n_[Figure 13: CnC commands. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure13-lg.png)_\n\nBelow is the list of commands:\n```\n   PNC: Reset the stopwatch\n   P: Send the active windows to the CnC\n   IE: Check for installed plugins\n   LP: Invoke plugin\n   UNV: ninstall, restart the RAT\n\n```\n\n-----\n\nVariants of Revenge RAT are known to have many other capabilities as listed below:\n\nScreen capture\nKeylogging\nVideo capture\nCredential dumping\nAudio capture\n\n## Uptycs EDR Detections\n\nThe following images show Uptycs EDR detection for the threat.\n\n_[Figure 14: Uptycs EDR detections. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure14.png)_\n\n\n-----\n\n_[Figure 15: Process graph in Uptycs EDR. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure15.png)_\n\n_[Figure 16: Process graph continued. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure16.png)_\n\n## Indicators of Compromise\n\nBelow is the list of IOCs seen in the Revenge RAT attack.\n\n### Hashes\n\n\n-----\n\n**Initial attack document**\n91611ac2268d9bf7b7cb2e71976c630f6b4bfdbb68774420bf01fd1493ed28c7\n\n**Initial attack document**\n\n77d6651de47bff4c24fc26fa018ea648b0e14e276e8240fae6b1724b8638c46a\n\n**1.docx(template)**\n\n338b2d8d76f4028bfbd177127371b2509971606553d606c534316dc40cfa8fb9\n\n**Microsoft_Excel_Macro-Enabled_Worksheet.xlsm**\n\n32f1a502126b1932e1def04b98d8be235c8d25ef7268f8cb35d460cd073a88b2\n\n**A.txt**\n\n4b65e5785692950f8100b22f2827d65ba93e99dd717eb444af035e96fcd84763\n\n**opera.ps1**\n\n03f5ff9b6a6b24f76799cc15fe3f1fbf1ca9d6dda30a4154125ed5dd5834290c\n\n**Revenge RAT**\n\n73f113a6146224c4a1f92f89055922a28322787c108e30000a0a420fa46ed9e2\n\n### URLs\n\nhxxp://azulviagens[.]online\n\nCdtpitbull[.]hopto[.]org\n\n## YARA Rule\n```\nrule upt_Revenge_RAT {\n\n     meta:\n\n          description=\"Revenge-RAT\"\n\nsha256=\"73f113a6146224c4a1f92f89055922a28322787c108e30000a0a420fa46ed9e2\"\n\n          author = \"abhijit mohanta\"\n\n          date = \"20 Dec 2020\"\n\n     strings:\n\n          $upt_Revenge_RAT0 = \"Revenge-RAT\" ascii wide nocase\n\n          $upt_Revenge_RAT1 = \"mscoree.dll\" ascii wide nocase\n\n          $upt_Revenge_RAT2 = \"REVEGERRRRR.exe\" ascii wide nocase\n\n          $upt_Revenge_RAT3 = \"keepAlivePing!\" ascii wide nocase\n\n          $upt_Revenge_RAT4 = \"AntiVirusProduct\" ascii wide nocase\n\n          $upt_Revenge_RAT5 = \"FirewallProduct\" ascii wide nocase\n\n     condition:\n\n          all of ($upt_Revenge_RAT*)\n\n}\n\n```\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/ysik1zbkccxzk2cveh1yeez8w7yv0v9m"
    ],
    "report_names": [
        "Uptycs_RevengeRAT-Targeting-Users-SouthAmerica(12-29-2020)"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1704420476,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1704342129,
    "ts_modification_date": 1704342129,
    "files": {
        "pdf": "https://archive.orkl.eu/9dc10a08df2833941a79f04ee5dd9d48e354cb8f.pdf",
        "text": "https://archive.orkl.eu/9dc10a08df2833941a79f04ee5dd9d48e354cb8f.txt",
        "img": "https://archive.orkl.eu/9dc10a08df2833941a79f04ee5dd9d48e354cb8f.jpg"
    }
}