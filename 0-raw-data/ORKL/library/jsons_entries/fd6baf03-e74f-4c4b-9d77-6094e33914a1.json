{
    "id": "fd6baf03-e74f-4c4b-9d77-6094e33914a1",
    "created_at": "2022-10-25T16:48:23.088643Z",
    "updated_at": "2025-03-27T02:05:39.96117Z",
    "deleted_at": null,
    "sha1_hash": "cf3a60c4b7a817982df30581b15c7e9fea8eec3f",
    "title": "Babuk Ransomware",
    "authors": "",
    "file_creation_date": "2021-10-26T18:54:29Z",
    "file_modification_date": "2021-10-26T18:54:29Z",
    "file_size": 1517208,
    "plain_text": "### 1.\n\n# BabuK\n\n## A malware report\n\n\n-----\n\n### Contents \n\n1. Introduction _________________________________________________________________ 2\n\n2. Initial Access _________________________________________________________________ 3\n\n3. Malware features _____________________________________________________________ 3\n\n4. Babuk ______________________________________________________________________ 5\n\n4.1. Preparation ___________________________________________________________________ 6\n\n4.2. Check services, processes and erase ShadowCopies ___________________________________ 7\n\n4.3. Thread creation and path checks _________________________________________________ 12\n\n4.4. Encryption and exclusion list _____________________________________________________ 16\n\n4.5. Txt rescue file ________________________________________________________________ 22\n\n5. Excluded Processes, services and folders/files _____________________________________ 25\n\n6. IOC _______________________________________________________________________ 26\n\n#### 1\n\n\n-----\n\n### 1. Introduction\n\nOne of the biggest current threats in terms of cybersecurity and the one that most concerns\ncompanies today is the Ransomware attack, its power be on encrypting as much as posible,\nregarding some exclusions and try to expand into a company to do as much damage as\npossible and request a ransom based on extortion. Babuk a ransomware with a short lifespan,\nis the first one in 2021.\n\nDistinguished by a little perfected behaviour, it has already appeared in some companies,\nrequesting for ransoms, like all the previous Ransomwares.\n\nAn example of this is the attack to Serco and PhoneHouse, in which, after cypher computers,\nthey requested near 100.000$ through Bitcoin, the extorsión tryies to publicy sensitive and\nprivacy content about clients, something that would cause any company to lose customers.\n\nAs well other Malwares of this family, it belongs to RaaS (Ransomware as a service) group,\nwhich is characterized by continuously being updated for sale, so it Will be easy to find\ndifferent types of Babuk, and also be more difficult to be stopped because of its constant\nevolution.\n\n#### 2\n\n\n-----\n\n### 2. Initial Access\n\nThe ways in which the babuk ransomware appears is diverse, we can found from phishing\nattacks, through other files that launch a _.bat_ or Powershell that downloads the Malware.\nLike al lof these families, its objective will be to affect the largest number of computers, so it\nis common to be launched after gaining access to any computer in a company, making lateral\nmovements to gain acces to a domain controler (DC), Babuk has the ability to move through\nthe network drives and spreads easily through it.\n\n### 3. Malware features\n\nThis Babuk Ransomware is not launched by any loader, moreover, as mentioned above, it\nis a very poorly maintained malware with serious performance problems, such as slowness\nin its execution. This time, it does not exploit any 0-day and is characterized by the use of\nseveral threads to perform the encryption, something that we can see in previous\nRansomwares.\n\nThe general features of this Babuk are as follows:\n\n**Babuk Information**\n**MD5** A73D9DC904349B9C967DC6A724806B2D\n**FileType** PE, 32B\n**Size** 75 KB\n**Compiler** MS Visual C++\n**Packer** None\n\n#### 3\n\n|Babuk Information|Col2|\n|---|---|\n|MD5|A73D9DC904349B9C967DC6A724806B2D|\n|FileType|PE, 32B|\n|Size|75 KB|\n|Compiler|MS Visual C++|\n|Packer|None|\n\n\n-----\n\nThis sample can be found since 12/03/2021 in VirusTotal (VT) with a large number of\ndetections by the engines, in most cases marked as Ransomware, but due to its short lifetime,\nfew detect it as Babuk.\n\n#### 4\n\n\n-----\n\n### 4. Babuk\n\nThe Ransomware, is divided into different parts and the report will be built, respecting the\norder in which it is executed, so a summary of the general characteristics of how the Babuk\nworks, is as follows:\n\n  - It will start by obtaining the key context, checking if a Mutex exists or creating one if it\n\ndoes not, and will increase the process completion time of the computer shutdown\nprocess.\n\n  - Later, Will check services and processes comprobará Servicios y procesos (And\n\nterminate those on its exclusion list) and deleting ShadowCopies.\n\n  - After that, it will create several Threads (which it will use to traverse and encrypt later)\n\nit will check shared folders, network and disks to know what it can and cannot encrypt\n(managing exclusion lists too)\n\n  - Finally, it will encrypt everything it wants and/or can access and will create the ransom\n\nfile in each of the encrypted folders.\n\n#### 5\n\n\n-----\n\n### 4.1. Preparation\n\nFirst it obtains the handle of a key referenced to a CSP, this is very common when using\nencryption keys since the CSP contains the characteristics, as we can see, it checks if it\nhas it\n\nLater, we get the commandline and open a Mutex \"DoYouWantToHaveSexWithCuongDong\"\nthat will serve as IOC, it uses it for the most common use of the Mutex, to avoid reinfection,\nso if we have any mutant with that name it will come out, otherwise it will create it.\n\n#### 6\n\n\n-----\n\nIn our case, we can see that we don't have any Mutex with that name, so it will create it.\n\nAfter that, we can see how it will call SetProcessShutdownParameters in order to stay as\nlong as possible running in the process.\n\n### 4.2. Check services, processes and erase ShadowCopies\n\nSubsequently, we arrive at three interesting functions, in which it checks services, processes\nand deletes Shadows and backups (usual in Ransomwares).\n\nAt the first one, __CheckServices, we see that it will try to access the service manager_\n(OpenSCManagerA) and if the service matches an internal list it has, it will close it.\n\n#### 7\n\n\n-----\n\nWe can see, as he goes through his list, listing each of them and constantly consulting,\namong them we have interesting services such as backups, anyone who has any service\nrelated to Sophos or Broadcom's _DefWatch, so this can serve from preventing copies are_\nlaunched to be blocked\n\n#### 8\n\n\n-----\n\nAt the following function, we found something usual on Ransomwares, search of processes,\nusually it seeks to inject the Malware or perform some malicious action with a process, but\nin this case the logic is the same as with the services, control the running processes to shut\nthem down if they match with its internal list\n\nAs we can see, it will make a snapshot (CreateToolHelp32Snapshot) and will go through the\nprocesses with _Process32First and_ _Process32Next, if it matches its blacklist, it will close_\nthem.\n\nWhat it will do is to see which process is running, this type of Malwares always try to avoid\naffecting the operation of processes such, for example, smss.exe or csrss.exe, but, in this\ncase, we can see how it checks the entire blacklist of processes in each of the processes\nthat are running, so it checks each of the parent and child processes to try to shut down any\nthat match any of its internal list.\n\n#### 9\n\n\n-----\n\nFirst of all, it takes a process and and then it goes through all its internal list to see if it\nmatches with any, when it has finished with the first process it will do the Process32Next and\ngo to the next process and so on, this is not strange, as it will try to avoid certain processes,\nas we can see it will compare it to another list.\n\nThis list system can be seen in other Ransomwares with an Rsrc that contains a file as a\njson with all the information or directly check in memory as in this case.\n\nThe following function takes care of one of the most common tasks of this type of malware,\nwhich is the deletion of ShadowCopies and backup copies in general.\n\nAt _DeleteShadows, we first found techniques to detect which type of system we are using\n(32B or 64B) by using the _IsWow64Process when taking a_ _Handle from a process and_\nchecking in a Boolean way if it returns a 0 or 1 to determine the type of O.S.\n\n#### 10\n\n\n-----\n\nAlso use _Wow64DisableWow64FsRedirection in_ _GetProcAddress to avoid the usual_\nredirection to syswow64 and get access to system32.\n\nIt will remove the shadows, a common technique used by Ransomwares using ShellExecute,\nwhich will prevent us from recovering previous versions of the O.S, and will make it\nimpossible to recover our files that will later be encrypted.\n\n#### 11\n\n\n-----\n\nOnce the shadowcopies have been deleted, it creates semaphore, which will manage the\nthreads and deletes all content of the recycle bin.\n\n### 4.3. Thread creation and path checks\n\nAfter that, it creates threads in our process, in which one of the parameters will be the\nfunction in which it encrypts and creates the TXT, so it will use the threads to encrypt, it\nmakes a loop of threads and creates up to 8 threads more in our case, but it will be different\ndepending on the CPU we are using.\n\n#### 12\n\n\n-----\n\nAfterwards, it checks that we have shared folders, in case we do not have any, it will jump\nseveral functions related to network paths encryption.\n\nIn these functions, it focuses on enumerating the units that exist, traversing them and\nencrypting them by performing the same routine that will be used later in the other functions.\n\n#### 13\n\n\n-----\n\nAs I mentioned before, since we do not have shared folders, we go directly to paths, where,\nas we can see, it checks if it can encrypt something in network, so in order, it checks Shared\nFolders, Network and then disks, the routines to manage that it can encrypt in shared folders\nor network, are the same\n\n#### 14\n\n\n-----\n\nThen, we can see how it will try to look for each of the volumes that we may have in our\ncomputer, it checks one by one if they are there (GetDriveTypeW), when it finishes it will look\nfor drives\n\n#### 15\n\n\n-----\n\nIn these volumes, which in my case I have 3, the name of each one of them associated to\nits ID will be taken out, associating them to other letters or paths in case they are not, in my\ncase the first volume is not associated to any letter and it associates it to M:\n\nAt this point it will be clear which disks or network drives can be encrypted or not and you\nwill only have to check if you can encrypt the file and do it.\n\n### 4.4. Encryption and exclusion list\n\nLater, we access at disk encryption routine, in which, it will take each of the units that have\nalready been collected in the previous point and go encrypting them, in our case with .babyk.\n\n#### 16\n\n\n-----\n\nThe encryption starts, and where we will see more movements Will be in C:\\, in my case,\nsince i have nothing else outside the main disk.\n\nMainly, searches for certain folders by comparing with an internal list of applications/paths at\nC:\\ like Appdata, Boot, Windows.old, and so on. To be used as an exclusion list\n\n#### 17\n\n\n-----\n\nOnce it finds the path it wants, for example, iDefense, it exits the loop and goes to the routine\nin which it will go into each of the folders, but before, it does in each of the paths the previous\ncheck, avoiding touching any file within each of the paths, so it does it quite slow, to speed\nup, using other threads (Using Semaphores) It focus on running, writte txt rescue file and\nencrypt every checked path, ussually used by Ransomwares, first of all, is engaged in\naccessing to every folder and subfolder starting from C:\\ and with another threads doing\n_ReleaseSemaphore,_ dropps the txt rescue file, writes, and encrypts files, but this will be\ndiscussed in the next section.\n\n#### 18\n\n\n-----\n\nAs mentioned, the encryption is done by another thread, in which we find the routine that is\ndedicated to both, encrypt and create the Txt, which we had already seen when creating the\nthreads in point 4.3.\n\nAfter that, we will have the routine that will create and write the rescue txt that we will discuss\nin the following point\n\n#### 19\n\n\n-----\n\nAfter modifying FileAttributes of the file to encrypt, we see how it modifies strings to change\nthe extension to .babyk using a MoveFileExW, is the first thing it does, in fact we can get the\nfile with changed extension without having done the encryption yet at this point, in the case\nthat the path complies with its internal list, and is going to encrypt it, it will make the extension\nchange.\n\n#### 20\n\n\n-----\n\nA relevant information, is that it checks the size of the file, depending if it is bigger or smaller\nit encrypts it in one way or another, first, it prioritizes the small files, so it goes through all the\npaths that contain the main path and when it has those files encrypted and the txt files\nlaunched, it starts with the biggest ones.\n\nSubsequently, manages the public/private keys by protecting them with CryptGenRandom,\nwhich is common to prevent the analyst from knowing the encryption keys to be used for the\nencryption algorithm.\n\nAnd then it will encrypt it using a variant of Salsa20 which is called ChaCha algorithm, an\nexample of the algorithm and the comparison with our Ransomware is as follows:\n\n#### 21\n\n\n-----\n\nOnce our disks have been encrypted, it does not make any connection with C2 as usual to\nsend the victim's data, moreover, the encryption is very slow due to the large number of\nchecks it performs from the beginning, both at the network level and at the level of disks and\nindividual files.\n\n### 4.5. Txt rescue file\n\nWhen our files has been encrypted, they explain us with the txt named \"How To Restore Your\n_Files.txt\" and that we can find in each of the paths that do not exist in their blacklist, that we_\ncould recover our files by performing the steps they describe, they also threaten us that they\nhave taken data from our network and that they will also be published, something very typical\nto force the victims to pay.\n\nAccording to the path in which it is, based on its list of exclusions, it will create the rescue\nfile, in which, as in all the other steps, it will take the information from memory and will dump\nit in the .txt file.\n\n#### 22\n\n\n-----\n\nFirst, it will perform a CreateFile with the name of the file\n\nAfterwards, writes in it all the content that we then obtain in the .txt file, which will explain the\nsteps to follow if we want to recover our files, which previously, as we had seen in the\nprevious point, had been encrypted.\n\n#### 23\n\n\n-----\n\nAs usual, we are required to use Tor Browser, enter our identifier and, of course, pay a\nransom to use the decryptor.\n\n#### 24\n\n\n-----\n\n### 5. Excluded Processes, services and folders/files\n\n**Processes** **Services** **Folders/Files**\n\n\nAppData\nbot\nWindows\nWindows.old\nTor Browser\nInternet Explorer\nGoogle\nOpera\nOpera Software\nMozilla\nMozilla Firefox\n$RecycleBin\nProgramData\nAll Users\nAutorun.inf\nboot.ini\nbootfont.bin\nbootsect.bak\nbootmgr\nbootmgr.efi\nbootmgfw.efi\ndesktop.ini\niconcache.db\nntldr\nntuser.dat\nntuserdat.log\nntuser.ini\nthumbs.db\nProgram Files\nProgram Files (x86)\n#recycle\n\n\nsql.exe\noracle.exe\nocssd.exe\ndbsnmp.exe\nsynctime.exe\nagntsvc.exe\nisqlplussvc.exe\nxfssvccon.exe\nmydesktopservice.exe\nocautoupds.exe\nencsvc.exe\nfirefox.exe\ntbirdconfig.exe\nmydesktopqos.exe\nocomm.exe\ndbeng50.exe\nsqbcoreservice.exe\nexcel.exe\ninfopath.exe\nmsaccess.exe\nmspub.exe\nonenote.exe\noutlook.exe\npowerpnt.exe\nsteam.exe\nthebat.exe\nthunderbird.exe\nvisio.exe\nwinword.exe\nwordpad.exe\nnotepad.exe\n\n\nvss\nsql\nsvc$\nmemtas\nmepocs\nsophos\nveeam\nbackup\nGxVss\nGxBlr\nGxFWD\nGxCVD\nGxCIMgr\nDefWatch\nccEvtMgr\nccSetMgr\nSavRoam\nRTVscan\nQBFCService\nQBIDPService\nIntuit.QuickBooks.FCS\nQBCFMonitorService\nYooBackup\nYooIT\nzhudongfangyu\nsophos\nstc_raw_agent\nVSNAPVSS\nVeeamTransportSvc\nVeeamDeploymentService\nVeeamNFSSvc\nveeam\nPDVFSService\nBackupExecVSSProvider\nBackupExecAgentAccelerator\nBackupExecAgentBrowser\nBackupExecDiveciMediaService\nBackupExecJobEngine\nBackupExecManagementService\nBackupExecRPCService\nAcrSch2Svc\nAcronisAgent\nCASAD2DWebSvc\nCAARCUpdateSvc\n\n\n#### 25\n\n\n-----\n\n### 6. IOC\n\n**MD5:**\n\n64f7ac45f930fe0ae05f6a6102ddb511\n8b9a0b44b738c7884e6a14f4cb18afff\n9478050023c7f8668df4fc39b0ddd79c\n50fecec126570e4b8fcd531d6711879a\n\n**Rescue File:**\n\n  - How to Restore Your Files.txt\n\n**Encrypted File:**\n\n  - <File_Name>.<original_extension >.babyk\n\n**Example: Shell_ext.exe.babyk**\n\n**Mutex:**\n\n  - DoYouWantToHaveSexWithCuongDong\n\n#### 26\n\n\n-----\n\n### References\n\n[https://www.computerweekly.com/news/252496839/Babuk-ransomware-unsophisticated-](https://www.computerweekly.com/news/252496839/Babuk-ransomware-unsophisticated-but-highly-dangerous)\n[but-highly-dangerous](https://www.computerweekly.com/news/252496839/Babuk-ransomware-unsophisticated-but-highly-dangerous)\n\n[https://news.sky.com/story/covid-19-nhs-test-and-trace-unaffected-by-cyber-attack-at-](https://news.sky.com/story/covid-19-nhs-test-and-trace-unaffected-by-cyber-attack-at-serco-firm-says-12204747)\n[serco-firm-says-12204747](https://news.sky.com/story/covid-19-nhs-test-and-trace-unaffected-by-cyber-attack-at-serco-firm-says-12204747)\n\n[https://www.mcafee.com/blogs/other-blogs/mcafee-labs/babuk-ransomware/](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/babuk-ransomware/)\n\n#### 27\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://raw.githubusercontent.com/vc0RExor/Malware-Threat-Reports/main/Ransomware/Babuk/Babuk_Ransomware_EN_2021_05.pdf"
    ],
    "report_names": [
        "Babuk_Ransomware_EN_2021_05.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1635274469,
    "ts_modification_date": 1635274469,
    "files": {
        "pdf": "https://archive.orkl.eu/cf3a60c4b7a817982df30581b15c7e9fea8eec3f.pdf",
        "text": "https://archive.orkl.eu/cf3a60c4b7a817982df30581b15c7e9fea8eec3f.txt",
        "img": "https://archive.orkl.eu/cf3a60c4b7a817982df30581b15c7e9fea8eec3f.jpg"
    }
}