{
    "id": "dbeb56ad-e367-485d-ad53-c33b7885ebb3",
    "created_at": "2023-01-12T15:00:32.406945Z",
    "updated_at": "2025-03-27T02:05:47.993841Z",
    "deleted_at": null,
    "sha1_hash": "ceb702ed3c46378330221fe569db55654e0db5a3",
    "title": "2019-02-07 - DanaBot updated with new C&C communication",
    "authors": "",
    "file_creation_date": "2022-05-28T18:06:47Z",
    "file_modification_date": "2022-05-28T18:06:47Z",
    "file_size": 1131391,
    "plain_text": "# DanaBot updated with new C&C communication\n\n**[welivesecurity.com/2019/02/07/danabot-updated-new-cc-communication/](https://www.welivesecurity.com/2019/02/07/danabot-updated-new-cc-communication/)**\n\nFebruary 7, 2019\n\nESET researchers have discovered new versions of the DanaBot Trojan, updated with a more\ncomplicated protocol for C&C communication and slight modifications to architecture and campaign IDs\n\n[ESET Research](https://www.welivesecurity.com/author/esetresearch/)\n7 Feb 2019 - 12:00PM\n\nESET researchers have discovered new versions of the DanaBot Trojan, updated with a more\ncomplicated protocol for C&C communication and slight modifications to architecture and campaign IDs\n\nThe fast-evolving, modular Trojan [DanaBot has undergone further changes, with the latest version](https://www.welivesecurity.com/?s=danabot)\nfeaturing an entirely new communication protocol. The protocol, introduced to DanaBot at the end of\nJanuary 2019, adds several layers of encryption to DanaBot’s [C&C communication.](https://www.virusradar.com/en/glossary/command-and-control-server)\n\nBesides the changes in communication, DanaBot’s architecture and campaign IDs have also been\nmodified.\n\n\n-----\n\n## The evolution of DanaBot\n\n[After being discovered in May 2018 as part of Australia-targeted spam campaigns, DanaBot has had an](https://www.proofpoint.com/us/threat-insight/post/danabot-new-banking-trojan-surfaces-down-under-0)\n[eventful time since, appearing in malspam campaigns in Poland, Italy, Germany, Austria and Ukraine, as](https://www.welivesecurity.com/2018/09/21/danabot-targeting-europe-adds-new-features/)\n[well as in the United States. The European campaigns have seen the Trojan expanding its capabilities](https://www.proofpoint.com/us/threat-insight/post/danabot-gains-popularity-and-targets-us-organizations-large-campaigns)\n[with new plugins and spam-sending features.](https://www.welivesecurity.com/2018/12/06/DanaBot-evolves-beyond-banking-trojan-new-spam/)\n\nIn ESET telemetry on January 25, 2019, we noticed unusual DanaBot-related executables. Upon further\ninspection, these binaries were, indeed, revealed to be DanaBot variants, but using a different\ncommunication protocol to communicate with the C&C server. Starting January 26, 2019, DanaBot\noperators stopped building binaries with the old protocol.\n\nAt the time of writing, the new version is being distributed under two scenarios:\n\nAs “updates” delivered to existing DanaBot victims\nVia malspam in Poland\n\n## The new communication protocol\n\nIn the communication protocol used before January 25, packets were not encrypted in any way, as seen\nin Figure 1.\n\nFigure 1 – Packet capture showing the old protocol with data in plaintext\n\nFollowing the latest changes, DanaBot uses the AES and RSA encryption algorithms in its C&C\ncommunication. The new communication protocol is complicated, with several encryption layers being\nused, as seen in Figure 2.\n\n\n-----\n\nFigure 2 – A diagram of DanaBot’s new communication protocol\n\nThese changes break existing network-based signatures and make it more difficult to write new rules for\nIntrusion Detection and Prevention Systems. Also, without access to the corresponding RSA keys, it is\nimpossible to decode sent or received packets; thus PCAP files from cloud-based analysis systems\n(such as [ANY.RUN) become unusable for researchers.](https://any.run/)\n\n\n-----\n\nFigure 3 – Packet capture with the new communication protocol in place\n\nEach packet sent by the client has a 24 (0x18)-byte header:\n\n**Offset** **Size (bytes)** **Meaning**\n\n0x0 0x8 Size of the data after this header\n\n0x8 0x8 Random value\n\n0x10 0x8 Sum of first two fields\n\nFor each packet, the header is followed by AES-encrypted packet data, then a 4-byte value indicating\nAES padding size, and finally the RSA-encrypted AES key. Each packet is encrypted with a different\nAES key.\n\nServer responses use the same format. Unlike in previous versions, packet data in server responses\ndoes not follow any specific layout (with some exceptions).\n\n### Packet data layout\n\n[Former packet data layout was detailed by Proofpoint in October 2018. In the latest version of DanaBot,](https://www.proofpoint.com/us/threat-insight/post/danabot-gains-popularity-and-targets-us-organizations-large-campaigns)\nthe layout is slightly modified, as seen in Figure 4.\n\n\n-----\n\nFigure 4 – Comparison of packet data layout in DanaBot’s previous and latest version\n\n## Changes in DanaBot architecture\n\nBesides the changed communication protocol, DanaBot has also undergone some changes in\narchitecture. The previous versions of DanaBot included a component that downloaded and executed\nthe main module. The main module then downloaded and executed plugins and configurations.\n\nThe latest version shifts both these responsibilities to a new loader component, which is used to\ndownload all plugins along with the main module. Persistence is achieved by registering the loader\ncomponent as a service.\n\nFigure 5 Comparison of architecture in DanaBot’s previous and latest version\n\n\n-----\n\n## Commands\n\nAccording to our analysis, the loader component uses the following commands:\n\n0x12C – Hello. First command sent by client to server\n0x12D – Download 32/64-bit launcher component\n0x12E – Request list of plugins and configuration files\n0x12F – Download plugin/configuration files\n\nDownloaded plugins and configuration files are encrypted using an AES key derived from the Client ID.\nIn addition to that, plugins are compressed in ZIP format using LZMA compression, whereas\nconfiguration files are compressed using zlib.\n\nCommands with ID numbers 0x130 – 0x134 are sent by the main module:\n\n0x130 – Upload collected information to C&C server (e.g., screenshot of a victim’s computer;\nsystem information)\n0x131 – Upload collected information to C&C server (e.g., list of files on the victim’s hard disk)\n0x132 – Ask C&C server for further commands; there are around 30 available commands typical\nof backdoors, including launching plugins, gathering detailed system information and modifying\nfiles on client system\n0x133 – Update C&C server list via Tor proxy\n0x134 – Exact purpose unknown; most likely used for communication between plugins and C&C\n\n## Changes in campaign IDs\n\nPrevious research has suggested that DanaBot is distributed under various “affiliate” or “campaign” IDs.\n\n[In the previous version of DanaBot, almost 20 different campaign IDs were used. In the latest version,](https://asert.arbornetworks.com/danabots-travels-a-global-perspective/)\ncampaign IDs have changed slightly. As of February 5, 2019, we are seeing the following IDs in the wild:\n\n**ID=2 appears to be a test version, serving a limited number of configuration files and no**\nwebinjects\n**ID=3 is being actively spread, targeting users in both Poland and Italy, serving all configuration**\nfiles and webinjects for both Polish and Italian targets\n**ID=5 serves configuration files for Australian targets**\n**ID=7 is being spread only in Poland, serving webinjects for Polish targets**\n**ID=9 appears to be another test version, with limited spread and no specific targeting, serving a**\nlimited number of configuration files and no webinjects\n\n## Conclusion\n\n[In 2018, we observed DanaBot expanding in both distribution and](https://www.welivesecurity.com/2018/09/21/danabot-targeting-europe-adds-new-features/) [functionality. The beginning of 2019](https://www.welivesecurity.com/2018/12/06/danabot-evolves-beyond-banking-trojan-new-spam/)\nhas seen the Trojan undergo “internal” changes, indicating active development by its authors. The latest\nupdates suggest the authors are making an effort to evade detection at the network level, and possibly\npaying attention to published research and making changes to stay ahead of defenders.\n\nESET systems detect and block all DanaBot components and plugins under detection names listed in\nthe IoCs section.\n\n**_This research was carried out by Kaspars Osis Tomáš Procházka and Michal Kolář_**\n\n\n-----\n\n## Indicators of Compromise (IoCs)\n\n### C&C servers used by the new version of DanaBot\n\n84.54.37[.]102\n89.144.25[.]243\n89.144.25[.]104\n178.209.51[.]211\n185.92.222[.]238\n192.71.249[.]51\n\n### Webinject and redirect servers\n\n47.74.249[.]106\n95.179.227[.]160\n185.158.249[.]144\n\n### Example hashes\n\nNote that since new builds of DanaBot’s components are released regularly, we provide just a sampling\nof hashes.\n\n**Component** **SHA-1** **ESET detection name**\n\nDropper 98C70361EA611BA33EE3A79816A88B2500ED7844 Win32/TrojanDropper.Danabot.O\n\n\nLoader\n(x86),\ncampaign\nID=3\n\nLoader\n(x64),\ncampaign\nID=3\n\nLoader\n(x86),\ncampaign\nID=9\n\nLoader\n(x64),\ncampaign\nID=9\n\nMain\nmodule\n(x86)\n\nMain\nmodule\n(x64)\n\n**Plugins**\n\n\n0DF17562844B7A0A0170C9830921C3442D59C73C Win32/Spy.Danabot.L\n\nB816E90E9B71C85539EA3BB897E4F234A0422F85 Win64/Spy.Danabot.G\n\n5F085B19657D2511A89F3172B7887CE29FC70792 Win32/Spy.Danabot.I\n\n4075375A08273E65C223116ECD2CEF903BA97B1E Win64/Spy.Danabot.F\n\n28139782562B0E4CAB7F7885ECA75DFCA5E1D570 Win32/Spy.Danabot.K\n\nB1FF7285B49F36FE8D65E7B896FCCDB1618EAA4B Win64/Spy.Danabot.C\n\n\n-----\n\n**Plugin** **SHA-1** **ESET detection name**\n\nRDPWrap 890B5473B419057F89802E0B6DA011B315F3EF94 Win32/Spy.Danabot.H\n\nStealer (x86) E50A03D12DDAC6EA626718286650B9BB858B2E69 Win32/Spy.Danabot.C\n\nStealer (x64) 9B0EC454401023DF6D3D4903735301BA669AADD1 Win64/Spy.Danabot.E\n\nSniffer DBFD8553C66275694FC4B32F9DF16ADEA74145E6 Win32/Spy.Danabot.B\n\nVNC E0880DCFCB1724790DFEB7DFE01A5D54B33D80B6 Win32/Spy.Danabot.D\n\nTOR 73A5B0BEE8C9FB4703A206608ED277A06AA1E384 Win32/Spy.Danabot.G\n\n7 Feb 2019 - 12:00PM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-02-07 - DanaBot updated with new C&C communication.pdf"
    ],
    "report_names": [
        "2019-02-07 - DanaBot updated with new C&C communication.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535632,
    "ts_updated_at": 1743041147,
    "ts_creation_date": 1653761207,
    "ts_modification_date": 1653761207,
    "files": {
        "pdf": "https://archive.orkl.eu/ceb702ed3c46378330221fe569db55654e0db5a3.pdf",
        "text": "https://archive.orkl.eu/ceb702ed3c46378330221fe569db55654e0db5a3.txt",
        "img": "https://archive.orkl.eu/ceb702ed3c46378330221fe569db55654e0db5a3.jpg"
    }
}