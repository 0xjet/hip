{
    "id": "3beaf56b-292b-4811-a359-ad33351a5c03",
    "created_at": "2023-01-12T15:07:44.912491Z",
    "updated_at": "2025-03-27T02:06:10.474153Z",
    "deleted_at": null,
    "sha1_hash": "691cb2e00f1c348d33d7c079c82004e2ed2c4cef",
    "title": "2022-01-09 - Unpacking Vmprotect packer",
    "authors": "",
    "file_creation_date": "2022-05-27T18:58:10Z",
    "file_modification_date": "2022-05-27T18:58:10Z",
    "file_size": 1470049,
    "plain_text": "# Unpacking Vmprotect packer\n\n**muha2xmad.github.io/unpacking/Vmprotect/**\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n2 minute read\n\n**As-salamu Alaykum**\n\n## Introduction\n\nUnpacking a file which is packed using commercial Vmprotect packer.\n\n[Download the sample: Here](https://app.any.run/tasks/5a588bb4-d9e7-4af0-8d5b-7dd2d9caba56?_ga=2.172762083.1741414019.1641756286-730337089.1636301499/)\n\nMD5: A39B4F74B5108A2B9F1A33B2FEB22CC5\n\n## Static\n\n DIE\n\n\nJanuary 9, 2022\n\n\nThis sample is written in `Delphi language and is packed through a commercial packer`\ncalled `VmProtect . And its` `Entropy is very high in section` `Vmp1`\n\n\n-----\n\nFigure(1):\n\n## IDA\n\nOpen it in IDA. We will notice that there is so many jumps and calls which the packer uses to\nobfuscate the code. So if you notice that if you press on any jump in the funtion you still in\nthe same function. But the last jump or call will go to another function. So to short efforts and\ntime, we will go to the last call or jump of the function and keep doing that till we get to this\none.\n\nFigure(2):\n\nWe will reache to a function which has a loop if we press on the last jump of that function it\nwill bring us to the same funtion. And after checking all the calls and jumps. this call is our\nway.\n\nFigure(3):\n\n\n-----\n\nTill we find an interesting function. because its `retn 48 it will return the last instruction`\nwhich is `push [esp+14h+arg_2C] and we need its address` `03CBF12E beacause it will`\nhelp us in debugging.\n\nFigure(4):\n\n## Unpacking process\n\nWe set breakpoints on `03CBF12E,` `VirtualAlloc,and` `VirtualProtect . Then we hit`\n```\nrun to see us in 03CBF12E and we Follow in disassembler of its value . We did\n\n```\nthat we might see a call to a register in this section. But we won’t find any then we unset this\nbreakpoint `03CBF12E . And see` `Strings references you will see a few strings. Then press`\n```\nrun to hit VirtualProtect breakpoint and keep pressing run . Till we see this address\n\n```\n\n-----\n\nFigure(5):\n\nWhy that address? Because we need to find the `OEP which is` `push ebp which we will find`\nit after this address `01287000 which will be later` `0128C074 . After that we keep pressing`\n```\nrun to hit VirtualAlloc breakpoint.\n\n```\nFigure(6):\n\nThe last part is the what you need to focus on. As we said we will find the `OEP above this`\naddress `01287000 which we will be searching for this instruction` `push ebp . Then press`\n```\nexecute till return after that press run to user code while doing that keep you\n\n```\neyes on the `Memory address because the` `OEP is in the range of` `01287000 . After trying`\nthe previous and hitting `VirtualAlloc 4 times, we found the` `push ebp our` `OEP .`\n\n\n-----\n\nFigure(6):\n\n## Unmaping\n\nA friend told me to short effort and time do it automatically using `scylla . After that the`\nunpacked file is big `56.7MB`\n\nFigure(7):\n\n## Article quote\n\nﺎ ﯾُﺮى أو ﻗﻤﺮ اﻟﻈﻼم ﻟﻤﺎ ﻛﻨﺖ ﻧﺠﻤَ[َ] وﻟﻮ ﻟﻢ ﯾﺤﺎﺻﺮك ﺟﯿﺶ[ُ]\n\n## REF\n\n1- [https://www.youtube.com/watch?v=aoa89Khfgr0&ab_channel=GuidedHacking](https://www.youtube.com/watch?v=aoa89Khfgr0&ab_channel=GuidedHacking)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-09 - Unpacking Vmprotect packer.pdf"
    ],
    "report_names": [
        "2022-01-09 - Unpacking Vmprotect packer.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536064,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653677890,
    "ts_modification_date": 1653677890,
    "files": {
        "pdf": "https://archive.orkl.eu/691cb2e00f1c348d33d7c079c82004e2ed2c4cef.pdf",
        "text": "https://archive.orkl.eu/691cb2e00f1c348d33d7c079c82004e2ed2c4cef.txt",
        "img": "https://archive.orkl.eu/691cb2e00f1c348d33d7c079c82004e2ed2c4cef.jpg"
    }
}