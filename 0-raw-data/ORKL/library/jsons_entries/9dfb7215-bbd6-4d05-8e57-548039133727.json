{
    "id": "9dfb7215-bbd6-4d05-8e57-548039133727",
    "created_at": "2023-01-12T15:08:18.032643Z",
    "updated_at": "2025-03-27T02:15:26.519801Z",
    "deleted_at": null,
    "sha1_hash": "94f29e1c1c2146cff2b1ce730d5b12b83496a2f6",
    "title": "2022-12-07 - A Closer Look At BlackMagic Ransomware",
    "authors": "",
    "file_creation_date": "2022-12-29T00:26:35Z",
    "file_modification_date": "2022-12-29T00:26:35Z",
    "file_size": 1761491,
    "plain_text": "# A Closer look at BlackMagic ransomware\n\n**[blog.cyble.com/2022/12/07/a-closer-look-at-blackmagic-ransomware/](https://blog.cyble.com/2022/12/07/a-closer-look-at-blackmagic-ransomware/)**\n\nDecember 7, 2022\n\n## New Ransomware disrupting Transportation and Logistics Industry in Israel\n\nDuring a routine threat-hunting exercise, Cyble Research and Intelligence Labs (CRIL) came across a\nnew ransomware group named “BlackMagic” ransomware. This ransomware group uses a double\nextortion technique to target its victims, in which it first exfiltrates the victim’s data, followed by\nencryption. This group has disclosed details of over ten victims to date, and all of them are from Israel,\nindicating the possibility that it is conducting targeted attacks. This group is suspected to be originated\nfrom Iran.\n\nDuring our analysis, we found that the ransom note used by this gang does not have any crypto\naddress or contact details for ransom payments. Instead, it contains links to social media channels used\nfor advertising the victim’s data, as shown in Figure 1. This indicates that the ransomware group is\ninterested in selling the exfiltrated data rather than demanding money from its victims.\n\n\n-----\n\nFigure 1 – BlackMagic Ransom Note\n\nThe Threat Actors (TA)s behind this group are using multiple cybercrime forums to sell the data\nobtained from these attacks. TA claims to have 50GB of data from Israeli transportation companies.\nThey also claimed that these attacks include sensitive data of over 65% of Israeli citizens. The figure\nbelow shows the post made by TA on a cybercrime forum.\n\nFigure 2 – BlackMagic’s TA Selling Data\nBlackMagic ransomware has targeted many companies from Israel’s Transportation and Logistics\nindustry. The group claims to have hampered the logistics operation by destroying companies’\ndatabases and changing the lading bills. The figure below shows the claims made by the ransomware\ngroup.\n\n\n-----\n\nFigure 3 – Targetting\n\nTransportation and Logistics Industry\nWe have also observed a few instances where this group defaced the victim’s website. The figure\nbelow shows the web defacement done by the BlackMagic group.\n\n\n-----\n\nFigure 4 – Website Defacement\nThe ransomware payload comes from hxxp[:]//5.230.70[.]49/dll/microsoftupdatedefender[.]rar and the\nmicrosoftupdatedefender[.]rar file contains two files named “MicrosoftUpdate.dll” and “back.bmp”. The\nransomware DLL file is further dropped in the location\n\nC:\\Users\\Public\\Documents\\” and executed using rundll32.exe. We suspect this ransomware DLL could\nhave been dropped and executed either manually or using other malware.\n\n## Technical Analysis\n\nThis ransomware group uses a 64-bit DLL file as its payload. File hash (SHA256:\n_8f855ed4c2f17487bac5d5079437acd728ccd68d93b49ab2f5b6d6d2430da133)._\n\nThis DLL file has only one exported function called Black. This function is responsible for executing the\nmain functionalities of BlackMagic ransomware.\n\nFigure 5 – DLL Export\n\nUpon execution, the ransomware calls the Sleep() function several times to evade sandbox detection.\nFor smooth encryption in the victim’s system, this ransomware kills specific processes using the\ncommand “taskkill /f /im <process name>*”. The ransomware has the following hardcoded process\nnames in its binary for terminating them.\n\n\n-----\n\n_teamview, anydesk, tnslsnr, vmware, nginx, httpd, docker, bak, site, db, postfix, imap, pop, clamav,_\n_qemu, cpanel, note, powerpnt, winword, excel, exchange, sql, tomcat, apache, java, python, vee, post,_\n_mys, vmwp, virtualbox, vbox, sqlserver, mysqld, omtstreco, oracle, mongodb, invoice, inetpub_\n\nThe figure below shows the part of the code responsible for killing processes.\n\nFigure 6 – Killing Processes\n\nAfter this, the ransomware executes the reg add command to disable the task manager by adding a\nkey, “hkcu\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\policies\\\\system /v disabletaskmgr /t\nreg_dword /d 1 /f”. The figure below shows the registry key added by the ransomware to disable the\ntask manager.\n\nFigure 7 – Disabling Task Manager\nNext, the ransomware fetches the victim’s local IP address using the ipconfig command and forms the\nURL “hxxp[:]//5.230.70[.]49/api/public/api/test?ip=<Victim’s local IP>\n_&status=0&cnt=100&type=server&num=11111170” and sends GET request to its remote server. The_\nbelow image shows the code snippet used by the ransomware for forming the URL to send a GET\nrequest.\n\n\n-----\n\nFigure 8 – Using ipconfig\nThe ransomware now calls the GetLogicalDriveStringsA() API to findthe attached drives in the victim’s\nsystem and enumerate files in the identified drive for encryption. Before processing files for encryption,\nit drops a ransom note named “HackedByBlackMagic.txt” in all the folders. BlackMagic ransomware\nuses the Rijndael algorithm for performing encryption. The figure below shows the implementation of\nthe Rijndael encryption algorithm in the ransomware binary.\n\nFigure 9 – Using Rijndael Encryption Algorithm\nAfter encrypting the victim’s files, it renames them by appending “.BlackMagic” as an extension. This\nransomware encrypts nearly all the files and excludes executable and DLL files in certain windows\ncritical folders. The figure below shows the encrypted files.\n\n\n-----\n\nFigure 10 – Appending “.BlackMagic” as an extension\n\nFinally, the ransomware creates a .bat file named “next.bat” in “C:\\Users\\Public\\Documents”, writes a\nsequence of commands to it, and then executes it. The ransomware creates and executes “next.bat” to\ndelete its traces after encrypting the files in the victim’s machine and changing the desktop background.\nThe following table shows the .bat file commands along with their description.\n\n**Command** **Description**\n\nping -n 4 127.0.0.1 Send 4 echo request to local\nhost\n\n\nreg add \\hkey_current_user\\\\control panel\\\\desktop\\ /v wallpaper /t\nreg_sz /d C:\\\\Users\\\\Public\\\\Documents\\\\back.bmp /f\n\n\nAdds registry key for changing\ndesktop background\n\n\nping -n 3 127.0.0.1 Send 3 echo request to local\nhost\n\ntaskkill /f /im rundll* Kill all the processes beginning\nwith rundll\n\nping -n 5 127.0.0.1 Send 5 echo request to local\nhost\n\ndel /F \\c:\\\\users\\\\public\\\\Documents\\\\MicrosoftUpdate.dll\\ Delete MicrosoftUpdate.dll\n\n\ndel /F\n\\c:\\\\users\\\\public\\\\Documents\\\\MicrosoftUpdate.dll.BlackMagic\\\n\n\nDelete\nMicrosoftUpdate.dll.BlackMagic\n\n\ndel /F \\c:\\\\users\\\\public\\\\Documents\\\\back.bmp\\ Delete back.bmp\n\nshutdown /r Restart system\n\ndel %0 Deletes Itself (the next.bat file)\n\nThe desktop wallpaper might not change for every victim as the ransomware deletes the back.bmp file\nusing .bat commands. The figure below shows the final state of the infected system with a changed\nbackground.\n\n\n-----\n\nFigure 11 – Changing the victim’s wallpaper\n\n## Conclusion\n\nBased on the activities of the BlackMagic ransomware group, we suspect them to be politically\nmotivated, but it is currently unclear to predict how they will evolve in the future.\n\nIn 2021, Moses Staff hacking team surfaced, targeting Israel-based organizations. They were deploying\nransomware but were not demanding ransom payments and leaking victims’ data. BlackMagic also\nappears to have similar techniques, but they appear to be financially motivated, as we witnessed them\nselling victims’ data.\n\nWe did not encounter any ransom demands made by this group to date, and the ransomware payload\nwas encrypting .exe and .dll files which are atypical for ransomware to encrypt, indicating that TAs\nmight be deploying ransomware to disrupt operations.\n\n## Our Recommendations\n\nThe following essential cybersecurity best practices create the first line of control against attackers. We\nrecommend that our readers follow best practices as given below:\n\nMonitor incoming emails from suspicious and potentially malicious domains.\nBack up data on different locations and implement Business Continuity Planning (BCP). Keep the\nBackup Servers isolated from the infrastructure, which helps fast data recovery.\nFrequent Audits, Vulnerability Assessments, and Penetration Testing of\norganizational assets, including network and software.\nEnforcement of VPN to safeguard endpoints.\nConduct frequent training on security awareness for the company’s employees to inform them\nabout emerging threats.\nImplementation of technology to understand the behavior of the ransomware-malware families\nand variants to block malicious payloads and counter potential attacks.\n\n## MITRE ATT&CK® Techniques\n\n\n-----\n\n**Tactic** **Technique**\n**ID**\n\n\n**Technique Name**\n\n\nExecution [T1059.003](https://attack.mitre.org/techniques/T1059/003/) Command and Scripting Interpreter: Windows Command\nShell\n\nDefensive Evasion [T1218.011](https://attack.mitre.org/techniques/T1218/011/) System Binary Proxy Execution: Rundll32\n\nDiscovery [T1016](https://attack.mitre.org/techniques/T1016/) System Network Configuration Discovery\n\n\nCommand and\nControl\n\n\n[T1071](https://attack.mitre.org/techniques/T1071/) Application Layer Protocol\n\n\nImpact [T1486](https://attack.mitre.org/versions/v11/techniques/T1486/)\n\n[T1489](https://attack.mitre.org/techniques/T1489/)\n\n[T1529](https://attack.mitre.org/techniques/T1529/)\n\n[T1491](https://attack.mitre.org/techniques/T1491/)\n\n## Indicators of compromise\n\n\nData Encrypted for Impact\n\nService Stop\n\nSystem Shutdown/Reboot\n\nDefacement\n\n\n**Indicators** **Indicator**\n**type**\n\n\n**Description**\n\nBlackMagic\nDLL\n\nBlackMagic\nDLL\n\n\nbf647a66de004ae56ece7f18a8dfa0ed\n\naeadbc1254da9c1ec70ddf18cd8b5cda78d8daf6\n\naf80b807c797d4d5e8141f7d43f08e91181fb94029c84fd41786a883d09dc902\n\n7b1fd05e9db5369c5b7ef82080fd0ca8\n\naea92bb857367e29183fe5c335a4c0cbda44eabf\n\n8f855ed4c2f17487bac5d5079437acd728ccd68d93b49ab2f5b6d6d2430da133\n\n\nMD5\n\nSHA-1\n\nSHA256\n\nMD5\n\nSHA-1\n\nSHA256\n\n\n5[.]230.70[.]49 IP Malicious IP\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-12-07 - A Closer Look At BlackMagic Ransomware.pdf"
    ],
    "report_names": [
        "2022-12-07 - A Closer Look At BlackMagic Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "527e04ee-7f5f-49aa-8653-f893b43730bd",
            "created_at": "2022-10-25T16:07:24.512541Z",
            "updated_at": "2025-03-27T02:02:10.266333Z",
            "deleted_at": null,
            "main_name": "Moses Staff",
            "aliases": [
                "Abraham's Ax",
                "Cobalt Sapling",
                "DEV-0500",
                "Marigold Sandstorm",
                "Vengeful Kitten",
                "White Dev 95"
            ],
            "source_name": "ETDA:Moses Staff",
            "tools": [
                "DCSrv",
                "DCrSrv",
                "PyDCrypt",
                "StrifeWater",
                "StrifeWater RAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ba5bc606-8b26-416a-881d-76cdefc6c75c",
            "created_at": "2024-06-04T02:03:07.777739Z",
            "updated_at": "2025-03-27T02:05:17.322164Z",
            "deleted_at": null,
            "main_name": "COBALT SAPLING",
            "aliases": [
                "Moses Staff",
                "Abraham's Ax"
            ],
            "source_name": "Secureworks:COBALT SAPLING",
            "tools": [
                " PyDcrypt",
                " StrifeWater RAT",
                "DCSrv"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bef06c82-0f51-44ba-8451-049cd4ad8a52",
            "created_at": "2023-01-06T13:46:39.325635Z",
            "updated_at": "2025-03-27T02:00:03.05159Z",
            "deleted_at": null,
            "main_name": "MosesStaff",
            "aliases": [
                "Moses Staff",
                "Marigold Sandstorm",
                "DEV-0500"
            ],
            "source_name": "MISPGALAXY:MosesStaff",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c4d0e4e1-5ad3-4455-8291-ce72a1e09e46",
            "created_at": "2022-10-27T08:27:13.055675Z",
            "updated_at": "2025-03-27T02:00:55.458634Z",
            "deleted_at": null,
            "main_name": "Moses Staff",
            "aliases": [
                "Moses Staff",
                "DEV-0500",
                "Marigold Sandstorm"
            ],
            "source_name": "MITRE:Moses Staff",
            "tools": [
                "PyDCrypt",
                "PsExec",
                "DCSrv",
                "StrifeWater"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536098,
    "ts_updated_at": 1743041726,
    "ts_creation_date": 1672273595,
    "ts_modification_date": 1672273595,
    "files": {
        "pdf": "https://archive.orkl.eu/94f29e1c1c2146cff2b1ce730d5b12b83496a2f6.pdf",
        "text": "https://archive.orkl.eu/94f29e1c1c2146cff2b1ce730d5b12b83496a2f6.txt",
        "img": "https://archive.orkl.eu/94f29e1c1c2146cff2b1ce730d5b12b83496a2f6.jpg"
    }
}