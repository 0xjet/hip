{
    "id": "692b0516-2a2a-4ddf-a24f-c61f68911ee5",
    "created_at": "2023-01-12T15:06:17.999101Z",
    "updated_at": "2025-03-27T02:08:41.506682Z",
    "deleted_at": null,
    "sha1_hash": "7b23a31185b85ed05e84ad5d161369e10bb82279",
    "title": "2020-12-20 - Tracking Jupyter Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T15:26:57Z",
    "file_modification_date": "2022-05-28T15:26:57Z",
    "file_size": 1258070,
    "plain_text": "# Tracking Jupyter Malware\n\n**[security5magics.blogspot.com/2020/12/tracking-jupyter-malware.html](https://security5magics.blogspot.com/2020/12/tracking-jupyter-malware.html)**\n\nLuke Acha\n\n*Updated March 10, 2022 (Detection rules for new variant observed March 2022.)\n\nI have had the opportunity to track the .NET Backdoor, dubbed by Morphisec as Jupyter\nInfostealer A.K.A Solarmarker\n\nI was excited to see this writeup since this was a malware family that myself and other\n[researchers on twitter were discussing for a couple weeks prior to the Morphisec article,](https://twitter.com/killamjr/status/1316556766017183747)\nbefore there was an attributed name to the malware. This was in October, and we were all\nsharing some bits of information we had on this, since that time I have also been using\ncustom YARA signatures to perform live hunts and retro-hunts in VirusTotal to continue to\nkeep up on this malware.\n\n[Recently I had seen Red Canary wrote up about this, dubbing it Yellow Cockatoo. Again, I](https://redcanary.com/blog/yellow-cockatoo/)\nwas very excited to see some more attention being paid to this malware, I enjoyed both the\nwriteups. Red Canary and Morphisec provided excellent information!\n\nSince I've been tracking this for sometime, and commenting on all new samples I see\nuploaded to VirusTotal, I figured I would provide some perspective that I have on this\nmalware as well.\n\nFirst, the initial access. Red Canary does correctly point out that there is redirecting of\nsearch engine queries, to dig a bit deeper, it appears that this is being done by abusing legit\nsites such as sites.google.com and cdn.shopify.com.\n\nThe following image is a recent (as of this writing) sample uploaded to VirusTotal. Take note\nof 3 things. The first being the file name, the second being the file size, and finally the 3rd\nitem being the Icon which appears to mimic a Word Document.\n\n\n-----\n\nIn the next screenshot we can see potentially where a users search criteria may lead to this\nmalware.\n\nNote: I have seen this also on various sites.google.com pages as well with earlier samples.\nSo, what happens when we go to this link which may potentially lead to the malware?\n\n\n-----\n\nNow this is interesting right! OK, so when I click on the PDF download, I watched the\nAddress Bar redirect several times until I was able to get the final malware. Look at the\nfollowing screenshots!\n\n\n-----\n\n-----\n\n-----\n\nWhat is really interesting is how quickly this 100MB+ file actually downloads! Why is this you\nask? It's because the file appears to be heavily padded (older samples were padded with\nNULL Bytes, this latest one is padded with repeating garbage bytes 99 21 C1 FA A3 71 38\n9B). Even more interesting is that the malware seems to perform a filesize check, so that if\nan analyst attempts to alter the size the malware errors out. If I remove even 1 byte, it errors,\nif I add even 1 byte, it errors.... but... if I just flip a bunch of the NULL Bytes and the file size\nremains the same, it works fine. Below are acouple interesting screenshots of the padding\nand the import of GetFileSize which might be used to see if the file was altered (ie. padding\nremoved). NOTE: The April 2021 variant appears to have dropped much of the padding,\n**file sizes are now 16-17MB**\n\n\n-----\n\nAt this point, I feel we have a good sense of the initial vector for this. We know a lot based on\nthe Red Canary and Morphisec write-ups, we know that the malware drops and launches a\nlegit program as a red herring in this case Soda PDF, we also know that it drops 2 .txt files in\nappdata\\local\\temp, which are really powershell files. The first one decodes the second one,\nthen they delete themselves.\nThis is because they create persistence in the form of a .cmd file (which launches\npowershell) it also drops a larger file which is a heavily encoded file that is decoded from the\n.cmd file.\n\n\n-----\n\nTwo other interesting things happen during all of this.... 1, the powershell process connects\nto the C2 per the loaded DLL and even more interesting is that is modifies existing desktop\nLNK files (shortcuts), keeping the original launch string and then adds an operator to also\nlaunch the .CMD file!\n\n\n-----\n\nThat's Right! My PEStudio still launches.... along with the malware!\n\nOK, so for a little bit of fun, I'll quickly go over how you can easily decode this malware and\nextract the malicious DLL.\n\nFirst, we modify the .CMD file a bit, comment out or remove the [system.reflection.......] line,\nand remove everything before (and including) the bracket {. Save the file as .ps1 for ease.\n\nNext, we put in a line \"Write-Output(Variable being loaded from system.reflection) | Out-File\n\"c:\\.....\"\n\n\n-----\n\nAt this point, this is simple encoding. I've been using CyberChef \"From CharCode\", Delimiter\n\"Line Feed\" \"Base 10\" to quickly get the DLL at this point.\n\n\n-----\n\nHopefully this helps provide some additional details on this malware, below are the IOCs for\nthis specific example. Happy Hunting!\n\nIOCs From initial writing:\nInitial Executable: da2eb36e763ecf1a47532e9f8efeacb7\nMalicious DLL: 147666fdb5f64f46a0a0add2cc428ec8\nC2: 91.241.19[.]110\nObserved Redirect Domains:\ndyrepopo[.]gq\nfeedsterbomiditsign[.]tk\nlistlypdilaho[.]tk\ncallnogrenisso[.]tk\nselldunlop[.]site\nspherdoorgfinversbrookin[.]tk\ntioblutrockbarneyprec[.]tk\nthiecorbeluno[.]tk\n\n**VT Enterprise Hunting Tactics**\nIcon Hash searching:\nPDF page that holds embeeded links to series of redirects:\n**main_icon_dhash:94148c3333001100**\nPDF page that holds embeeded links to series of redirects:\n**main_icon_dhash:94228c3333001100**\nPDF page that holds embeeded links to series of redirects:\n**main_icon_dhash:0f0f0307332f3f19**\nFake Word Document Icon Hash for dropper file: main_icon_dhash:64dcd4d2c4c4d0d4\nFake PDF Document Icon Hash for dropper file: main_icon_dhash:b2b29696969ef66a\n\n\n-----\n\n**size:100MB+**\nFake PDF Document Icon Hash for dropper April 2021:\n**main_icon_dhash:b2b29696969ef66a**\nFake PDF Document Icon Hash for dropper September 2021:\n**main_icon_dhash:64e4d4d4e8f4dcd4**\nMarch 2022 VirusTotal search for Dropper:entity:file tag:signed type:peexe size:250MB+\n**size:270MB- packer:\".NET executable\"**\n\n**YARA Rules:**\n[SolarMarker March 2022 Malicious DLL Detection](https://github.com/securitymagic/yara/blob/main/Jupyter%20Malware/solarmarker_0322.yar)\n[SolarMarker 2021 DLL Detection](https://github.com/securitymagic/yara/tree/main/Jupyter%20Malware)\n[Suspicious_Powershell_Strings](https://github.com/securitymagic/yara/blob/main/Jupyter%20Malware/JupyterPS.yar)\n**OpenIOC Rules:**\n[Solarmarker.dat File Creation (OpenIOC)](https://github.com/securitymagic/openioc/blob/main/File_Actions/Jupyter_File_Created)\n[Suspicious_Porcesses_Writing_to_Startup (OpenIOC)](https://github.com/securitymagic/openioc/blob/main/File_Actions/Suspicious_Startup_Written.ioc)\n\n**SIGMA Rules:**\n[Solarmarker.dat File Creation (SIGMA)](https://github.com/securitymagic/sigma/blob/main/Jupyter_File_Drop.yml)\n[Suspicious_Porcesses_Writing_to_Startup (SIGMA)](https://github.com/securitymagic/sigma/blob/main/suspicious_startup_creation.yml)\n\n**Updates:**\n\n**07/29/2021:** **https://squiblydoo.blog/2021/06/20/mars-deimos-from-jupiter-to-mars-and-**\n**back-again-part-two/**\n**Fantastic analysis of the malware by author Squiblydoo**\n**12/22/2020:** http://security5magics.blogspot.com/2020/12/december-22-2020-jupytermalware.html\nObservers an update in the Icon switching from Word to PDF. Also, Expert PDF being used\nas Red Herring installer.\n\n**01/06/2020: https://security5magics.blogspot.com/2021/01/jupyter-infostealer-update-**\n**january-2021.html**\n**Observes additional lures.**\nPulled one of the initial files that gets deleted after running, along with the powershell script\nthat decodes and runs it:\n\n[https://app.any.run/tasks/fcd6eeb7-91bb-4e1d-b02d-983bae3786ec#](https://app.any.run/tasks/fcd6eeb7-91bb-4e1d-b02d-983bae3786ec#)\n\n[March 2022 App.Any.Run sandbox run/](https://app.any.run/tasks/068fc802-1264-4925-9b72-e6fc91ae82ac/)\n\n**Example Observed Lures from google searches:**\n\nsite:byzcath[.]org \"free template\"\nhttp://byzcath[.]org/nfl-playoff-bracket-excel-spreadsheet\n\n\n-----\n\nsite:www.braveheartmarine[.]com free template\nhttps://www.braveheartmarine[.]com/free-invoice-template-for-handyman\n\nsite:prismic-io.s3.amazonaws[.]com \"free template\"\nhttps://prismic-io.s3.amazonaws[.]com/whatsimdb/0fe19bd3-88a8-4ab5-b451d78f1be51ef2_free-bbq-tickets-template-word.pdf\n\nsite:cdn.shopify[.]com \"free template\"\n\nsite:healingwithclarity.com \"free template\"\nhttps://healingwithclarity[.]com/platte-county-warrant-list.pdf\n\nsite:strikinglycdn.com \"free template\"\nhttps://uploads.strikinglycdn[.]com/files/18aa0685-0e17-4ea4-b308-1a717e293267/freetemplate-for-waiver-of-liability.pdf\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-20 - Tracking Jupyter Malware.pdf"
    ],
    "report_names": [
        "2020-12-20 - Tracking Jupyter Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535977,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653751617,
    "ts_modification_date": 1653751617,
    "files": {
        "pdf": "https://archive.orkl.eu/7b23a31185b85ed05e84ad5d161369e10bb82279.pdf",
        "text": "https://archive.orkl.eu/7b23a31185b85ed05e84ad5d161369e10bb82279.txt",
        "img": "https://archive.orkl.eu/7b23a31185b85ed05e84ad5d161369e10bb82279.jpg"
    }
}