{
    "id": "c1821bd6-8cbf-40ca-b1fa-057f32e4e936",
    "created_at": "2022-10-25T16:48:24.670382Z",
    "updated_at": "2025-03-27T02:05:44.347816Z",
    "deleted_at": null,
    "sha1_hash": "f6b48254bf81462009a584a052101dfb6df596ce",
    "title": "",
    "authors": "",
    "file_creation_date": "2016-09-17T18:22:45Z",
    "file_modification_date": "2016-09-17T18:22:45Z",
    "file_size": 298723,
    "plain_text": "# The Ghost Dragon\n\nIntroduction\n\nCylance SPEAR™ has identified an APT group which deploys multiple customized malware implants,\n\ntargeting mainly Chinese and Russian users. Cylance determined that the ‘Ghost Dragon’ group utilized\n\n[specifically tailored variants of Gh0st RAT, which the group modified from the 3.6 version of the source code](https://en.wikipedia.org/wiki/Gh0st_RAT)\n\nreleased in 2008. Newly implemented security mechanisms in the altered malware makes identification of\n\nGh0st RAT Command and Control network traffic more difficult for both security products and researchers.\n\nThis write­up provides initial disclosure of a portion of the malware and infrastructure used by the Ghost\n\nDragon group and covers the new security mechanisms in detail, as well as revealing how researchers were\n\nable to communicate with the custom implant by rebuilding and compiling a customized Gh0st RAT\n\ncontroller.\n\nThe Standard Gh0st RAT Protocol\n\nThe standard network protocol for Gh0st RAT 3.6 employs zlib compression, which utilizes ‘Gh0st’ as a static\n\nfive­byte packet flag that must be included in the first five bytes of initial transmission from the victim (as\n\nseen in Figure 1). During the initial login request, the 3.6 version of Gh0st RAT enumerates system\n\ninformation and transmits that information to the controller. The proceeding eight bytes of the packet contain\n\nboth compressed and uncompressed size information followed by the zlib compressed data, starting with\n\nbytes 78 9C at offset 14 (shown in Figures 1 and 2, below).\n\n**Figure 1: Standard Gh0st RAT 3.6 packet login**\n\n**request | Victim to controller**\n\nAfter a successful login, the controller returns an acknowledgment to the victim with the correct header using\n\nthe packet flag which it is programmed to verify, as seen in Figure 2. The connection will be established only\n\nif the packet flags match.\n\n_Figure 2: Standard Gh0st RAT 3.6 packet response | Controller to victim – 22 bytes_\n\nFollowing the first five bytes, the packet then shows the full packet size and the uncompressed data size.\n\nThe Gh0st packet header for version 3 6 uses the 13 byte format shown in Figure 3:\n\n\n-----\n\n_Figure 3: Gh0st RAT 3.6 header format_\n\nAfter the packet flag, packet length and unzip length have been verified, a working connection is created\n\nbetween the victim and the controller. Subsequent keep­alive transmissions ensure a continuous\n\nconnection.\n\nOnce Gh0st RAT is connected, the attacker has full remote administration tool (RAT) functionality via the\n\ncontroller. Available remote functionality includes:\n\n**• Fully functional remote desktop display, including the ability to remotely block user input**\n\n**• Fully functional file manager that lists local and network drives**\n\n**• Ability to interact with running processes**\n\n**• Ability to interact via the command console**\n\n**• Key logging**\n\n**• Audio capture**\n\n**• Webcam capture**\n\n**• Ability to send ‘Windows style’ alerts to the victim, which can display any text the attacker**\n\n**enters into the controller**\n\nThese features ensure complete remote control of the computer.\n\nChanges to the Gh0st RAT Protocol\n\nIn an older version of the customized Gh0st RAT malware, the protocol packet flag is no longer represented\n\nby the string ‘Gh0st’. The Ghost Dragon group modified the source code and changed the packet flag to\n\n‘XYTvn’, as seen in Figure 4. The packet structure still implements the same 13­byte header format,\n\nincluding the starting zlib compression bytes of ‘78 9C’:\n\n_Figure 4: XYTvn static packet flag | Victim to controller login request_\n\n**Sample: f9a669d22866cd041e2d520c5eb093188962bea8864fdfd0c0abb2b254e9f197**\n\nIn a more recent version of the modified Gh0st RAT malware, Ghost Dragon implemented dynamic packet\n\nflags which change the first five bytes of the header in every login request with the controller. This\n\ncomplicates identifying its network traffic, as the header bytes in the zlib compressed data section no longer\n\nstart with ‘78 9C’, as shown in Figure 5.\n\n\n-----\n\nzlib header. SPEAR has observed numerous different XOR keys utilized by the group. No changes to the\n\ncompression have been found; however, it is trivial to implement a modified compression protocol.\n\n_Figure 5: Dynamic packet flag | Victim to controller login request_\n\n**Sample: 1be9c68b31247357328596a388010c9cfffadcb6e9841fb22de8b0dc2d161c42**\n\n(Note: At the time of this report, the C2 for the sample was active and the malware could still establish an\n\nactive connection to the Ghost Dragon controller at bbs.winupdate[dot]net. Currently, the domain\n\nbbs.winupdate[dot]net resolves to 122.10.18[dot]166).\n\nThe reply from the active command and control server can be seen in Figure 6:\n\nFigure 6: Dynamic packet flag | Controller to victim login reply\n\n**Sample: 1be9c68b31247357328596a388010c9cfffadcb6e9841fb22de8b0dc2d161c42**\n\nConnecting to the Ghost Dragon Malware\n\nAfter successful identification of the malware as Gh0st RAT and confirmation of the modified command and\n\ncontrol protocol, the final step toward verification was to connect with the malware to ensure that it would\n\nparse the normal Gh0st RAT commands.\n\nI was able to compile a custom controller from the source code for the purposes of testing the Ghost Dragon\n\nmalware. I bypassed the header checks looking for the ‘Gh0st’ packet flag, and reprogrammed the standard\n\nGh0st RAT controller to reply with the packet flag sent from the victim.\n\nI used sample 6c7f8ba75889e0021c4616fcbee86ac06cd7f5e1e355e0cbfbbb5110c08bb6df for testing,\n\nwhich was executed by f9a669d22866cd041e2d520c5eb093188962bea8864fdfd0c0abb2b254e9f197\n\nduring analysis on Windows XP. This sample transmitted the static five byte packet flag ‘XYTvn’.\n\nI ran the victim malware and changed the host’s file to point the domain to a host­only IP address. I received\n\na connection attempt from the victim and a response from the controller returned the correct packet flag.\n\nAfterward, the keep­alive packets between the victim and controller maintained the connection, which\n\nallowed me to test the functionality of\n\n**6c7f8ba75889e0021c4616fcbee86ac06cd7f5e1e355e0cbfbbb5110c08bb6df with the custom Gh0st RAT**\n\n\n-----\n\n**_Figure 7: Main connection view | Connected to_**\n\n**_6c7f8ba75889e0021c4616fcbee86ac06cd7f5e1e355e0cbfbbb5110c08bb6df_**\n\nThe HOSTNAME field shown in Figure 7 was programmed in my custom controller to display ‘Gh0st variant’,\n\njust in case the incoming structure parsed from the victim did not match the format of the default\n\n‘LOGININFO’ structure from Gh0st RAT 3.6.\n\nI attained full functionality using the Gh0st 3.6 protocol in the controller, despite the fact that the incoming\n\nstructure was not exactly what my customized controller expected. As shown in Figure 8, I successfully\n\nadded an administrative user while remotely connected via my custom Gh0st RAT console within the\n\nmalware dropped from sample\n\nf9a669d22866cd041e2d520c5eb093188962bea8864fdfd0c0abb2b254e9f197.\n\nFigure 8 demonstrates that some of the characters in the window are not in English and are not displayed\n\nproperly on the form. This is due to the fact that the characters were written in Mandarin in the original\n\nGh0st RAT 3.6 source. I changed phrases in the main connection window (Figure 7) for demonstration\n\npurposes only.\n\n_Figure 8: Remote shell | Adding admin user | Connected to_\n\n_6c7f8ba75889e0021c4616fcbee86ac06cd7f5e1e355e0cbfbbb5110c08bb6df_\n\nThe remaining features of the Gh0st RAT protocol were tested successfully with the custom Gh0st RAT\n\ncontroller while connected to\n\n**6c7f8ba75889e0021c4616fcbee86ac06cd7f5e1e355e0cbfbbb5110c08bb6df.**\n\n\n-----\n\nNetwork IOCs and Infrastructure Overlap\n\n**A48f881f254dc8452561a8f13e2fb81933473ff22e549787f0ca67f19ba7fe67**\n\n**File name: Air China 2015 April TIMETABLE .xls**\n\n**Malware type: Initial Infection Vector/ XLS file**\n\n**Network Activity Summary: Drops the downloader**\n\n71a52058f6b5cef66302c19169f67cf304507b4454cca83e2c36151da8da1d97\n\n**71a52058f6b5cef66302c19169f67cf304507b4454cca83e2c36151da8da1d97**\n\n**File name: AdobeWpkReg.tmp**\n\n**Malware type: Downloader**\n\n**Network Activity Summary: Uses HEAD method (instead of GET) | Calls out to**\n\ninfo.winupdate[dot]net/robots.txt | User­Agent: Mozilla/5.0 (compatible; MSIE 10.0; NULL[5(1)]Windows NT\n\n6.1; Trident/6.0)\n\n**Note: User Agent is variable depending on the version info of the host**\n\n**1be9c68b31247357328596a388010c9cfffadcb6e9841fb22de8b0dc2d161c42**\n\n**File name: iconfig.exe**\n\n**Malware type: Gh0st RAT variant**\n\n**Network Activity Summary: bbs.winupdate[dot]net | Port 8080**\n\n**Packet flag: Dynamic**\n\n**f9a669d22866cd041e2d520c5eb093188962bea8864fdfd0c0abb2b254e9f197**\n\n**File name: install.exe**\n\n**Malware type: Gh0st RAT variant**\n\n**Network Activity Summary: ooxxxoo.gicp[dot]net | Port 8080 | Also connects to www.winupdate[dot]net on**\n\nport 8080\n\n**Packet flag: Static: XYTvn**\n\n**Note: On Windows XP, may drop a replacement DLL for the AppMgmt service using ClimateVMain export**\n\nSVC_sha256: 6c7f8ba75889e0021c4616fcbee86ac06cd7f5e1e355e0cbfbbb5110c08bb6df. The hash of the\n\ndropped file may change on different versions of Microsoft Windows\n\n**99ee5b764a5db1cb6b8a4f62605b5536487d9c35a28a23de8f9174659f65bcb2**\n\n**File name: install.exe**\n\n**Malware type: Gh0st RAT variant**\n\n**Network Activity Summary: www.searchhappynews[dot]com | Port 80**\n\n**Packet flag: Static | XYTvn**\n\n**b803381535ac24ce7c8fdcf6155566d208dfca63fd66ec71bbc6754233e251f5**\n\n**File name: ExtensionManager.exe**\n\n**Malware type: Gh0st RAT variant**\n\n**Network Activity Summary: www.fhtd[dot]info | Port 1081**\n\n**Packet flag: Dynamic**\n\n**Infrastructure Overlap**\n\n\n-----\n\nbbs.winupdate[dot]net     | 122.10.18.166\n\nwww.fhtd[dot]info         | 122.10.18.166\n\n**info.winupdate[dot]net     | 122.10.36.94**\n\nDuring investigation into the infrastructure used by Ghost Dragon, an anonymous FTP server was\n\ndiscovered on one of the IP addresses listed above, which hosted ‘info.winupdate[dot]net | 122.10.36.94’.\n\nUpon obtaining the files on the FTP server, an older Gh0st RAT variant was obtained with the file name\n\n‘operas.exe’. This variant sends the system info to the controller in clear text for the login request.\n\n**fb5a7cb34040b1e98b077edaf91cb59a446d8ff07263afe875cf6bd85bfb359d**\n\n**File name: operas.exe**\n\n**Malware type: Gh0st RAT variant**\n\n**Network Activity Summary: www.swgabeg[dot]com | Port 1080 | Clear text login request sent to controller**\n\n**Packet flag: Dynamic**\n\nAppendix A – IP and Domain ListingIP addresses:\n\n101.55.33.39\n\n103.232.215.144\n\n103.246.245.147\n\n111.68.8.130\n\n112.125.17.103\n\n113.10.148.161\n\n113.10.148.205\n\n122.10.18.166\n\n122.10.36.94\n\n122.10.41.85\n\n122.10.83.75\n\n122.10.85.35\n\n122.9.247.128\n\n122.9.247.134\n\n122.9.247.216\n\n122.9.247.56\n\n123.254.111.87\n\n142.4.103.90\n\n174.128.255.228\n\n175.45.192.234\n\n202.172.32.172\n\n202.174.130.116\n\n203.232.28.10\n\n209.85.84.165\n\n209.85.84.167\n\n31.170.179.179\n\n58.64.187.22\n\n\n-----\n\n64.111.220.218\n\n**Domains:**\n\ninfo.winupdate[dot]net\n\nbbs.winupdate[dot]net\n\nooxxxoo.gicp[dot]net\n\nwww.winupdate[dot]net\n\nwww.searchhappynews[dot]com\n\nwww.fhtd[dot]info\n\nwww.swgabeg[dot]com\n\n\nBlog_Hdr_GhostDragon_Thu\n\nmb\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.04.22.the-ghost-dragon/The.Ghost.Dragon.-.Cylance.pdf"
    ],
    "report_names": [
        "The.Ghost.Dragon.-.Cylance"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1474136565,
    "ts_modification_date": 1474136565,
    "files": {
        "pdf": "https://archive.orkl.eu/f6b48254bf81462009a584a052101dfb6df596ce.pdf",
        "text": "https://archive.orkl.eu/f6b48254bf81462009a584a052101dfb6df596ce.txt",
        "img": "https://archive.orkl.eu/f6b48254bf81462009a584a052101dfb6df596ce.jpg"
    }
}