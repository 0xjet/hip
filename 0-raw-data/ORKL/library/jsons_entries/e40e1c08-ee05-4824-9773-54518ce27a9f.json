{
    "id": "e40e1c08-ee05-4824-9773-54518ce27a9f",
    "created_at": "2023-01-12T15:05:25.437087Z",
    "updated_at": "2025-03-27T02:05:33.685634Z",
    "deleted_at": null,
    "sha1_hash": "b1a41600c85defca53d1f12ad912cf4f2f933285",
    "title": "2021-03-03 - Fbot is now riding the traffic and transportation smart devices",
    "authors": "",
    "file_creation_date": "2022-05-29T01:38:19Z",
    "file_modification_date": "2022-05-29T01:38:19Z",
    "file_size": 948238,
    "plain_text": "# Fbot is now riding the traffic and transportation smart devices\n\n**[blog.netlab.360.com/fbot-is-now-riding-the-traffic-and-transportation-smart-devices-en/](https://blog.netlab.360.com/fbot-is-now-riding-the-traffic-and-transportation-smart-devices-en/)**\n\nGenshen Ye March 3, 2021\n\n3 March 2021 / [Botnet](https://blog.netlab.360.com/tag/botnet/)\n\n## Background\n\nFbot, a botnet based on Mirai, has been very active ever sine we first blogged about it\n[here[1][2], we have seen this botnet using multiple 0 days before(some of them we have not](https://blog.netlab.360.com/threat-alert-a-new-worm-fbot-cleaning-adbminer-is-using-a-blockchain-based-dns-en/)\ndisclosed yet) and it has been targeting various IoT devices, now, it is aiming a new\ncategory, traffic and transportation smart devices.\n\nOn February 20, 2021, the 360Netlab Threat Detection System captured attackers were\n[using a remote command execution vulnerability (CVE-2020-9020)[3][4] in the Vantage](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2020-9023)\nVelocity product from Iteris to spread Fbot botnet samples.\n\n[According to Wikipedia[5], Iteris, Inc. provides intelligent mobile infrastructure management](https://en.wikipedia.org/wiki/Iteris)\nservices and produces sensors and other devices that record and predict traffic conditions.\n\nBased on the AIrLink GX450 Mobile Gateway production information found on the affected\ndevices, we speculate that the affected devices are roadside monitoring device.\n\n## CVE-2020-9020 Vulnerability Analysis\n\nThrough the 360 FirmwareTotal system, we verified and analyzed the CVE-2020-9020\nvulnerability, here is the brief.\n\n1. Vantage Velocity product synchronizes With NTP Server, where user can set the\n\nspecified ntp server address.\n\n2. The `timeconfig.py script does not filter the` `htmlNtpServer variable after`\n\naccepting a user Web request, i.e., it is spliced into the shell variable format\n```\n   \"ntpserver=\" + form[\"htmlNtpServer\"].value.strip() and written to the\n   /root/timeparam file.\n\n```\n3. The command execution vulnerability is triggered when the `timeconfig.py script`\n\ncalls the shell script `/root/ntpconfig, which reads the` `/root/timeparam file to`\ninitialize the variable ntpserver.\n\n## Vulnerability impact scope\n\n\n-----\n\nThe 360 Quake cyberspace mapping system found the specific distribution of Vantage\nVelocity devices by mapping assets across the network as shown in the figure below.\n\n## Fbot botnet\n\nFbot is a botnet based on Mirai, with 2 main changes\n\nEncryption algorithm\nRegistration packets, heartbeat packets\n\nThe basic information of this sample is shown below:\n\nMD5:deaee7ada44bf1c6af826d2d170c8698\n\nELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, stripped\n\nPacker:None\n\nIt has no added features in itself, the main function is\n\nDDoS attack\nTelnet scanning\n\nThe following section will briefly analyze around the above functions.\n\n## DDoS attack\n\nFirst Fbot establishes a connection with the hardcoded C2 (198.23.238.203:5684) via the\nfollowing code snippet.\n\n\n-----\n\nThen it sends a 78-byte long registration message to C2\n\nThe network traffic generated in practice is shown below.\n\nThe information in the registration packet is used to verify the legal identity of the BOT, and\nthe format of the registration packet is parsed as shown below.\n```\nMain field parsing，others can be 0\n——————————————————————————————————————————\n02  --->type，register package\n00 42 00 33 00 63 01 c8 02 fc 00 49  --->hardcoded，authentication\n00 07  --->length of group string\n75 6e 6b 6e 6f 77 6e ---->group string，\"unknown\"\n——————————————————————————————————————————\n\n```\nAfter sending the registration packet the Bot starts to wait for C2 to issue commands, the first\nbyte of the command packet specifies the command type.\n\n**0x00， heartbeat command code**\n\n\n-----\n\nTake the following heartbeat as an example\n\nThe format of the heartbeat packet is parsed as follows\n```\nMain field parsing，others can be 0\n——————————————————————————————————————————\n00 --->type，heartbeat package\n1b 37 03 f3 25 e3 19 40 1e 68 1a d2  --->hardcoded\n——————————————————————————————————————————\n\n```\n**0x01，DDoS attack command code**\n\nTake the following attack instruction as an example\n\nThe format of the attack packet is parsed as follows\n```\nMain field parsing，others can be 0\n——————————————————————————————————————————\n01  --->type，attack package \n01 --->attack type\n00 3c  --->time (sec)\n01 --->number of target\n67 5f dd bc 00 20 --->target/mask,103.95.221.188/32\n02 --->number of flag\n     02 --->flag type, attack\npackage length\n     00 04 --->flag length\n     31 34 36 30 --->flag data，1460\n     01 --->flag type, port\n     00 02 --->flag length\n     35 33 --->flag data，53\n——————————————————————————————————————————\n\n```\n**0x03，exit**\n\n\n-----\n\n## Telnet scan & propagation\n\nFbot uses the technique of SYN port detection in the propagation process to improve the\nefficiency of propagation.\n\nFrom the above code snippet, it can be seen that its scanning traffic has 2 characteristics\n\n1. The number of scanned 23 ports is about twice as many as 26 ports\n2. The sequence number in the tcp header is equal to the target address in the ip header\n\nWhen a port is detected as open, login is attempted using a hard-coded credential list. Once\nsuccessful, the IP, port, account, password, etc. are sent back to Reporter\n(198.23.238.203:774) via the following code snippet.\n\nThe actual network traffic generated is shown in the following figure.\n\nFinally, the Fbot sample is implanted to the device either with network download(see below)\nor ECHO, and the successful implantation information is sent back to Reporter.\n\n**1：Network download**\n\n\n-----\n\nIf the device has wget or tftp, the Fbot sample of the corresponding CPU architecture on the\ndevice will be downloaded.\n\n**2：ECHO**\n\nIf the device does not have a network download tool, the Fbot downloader of the\ncorresponding CPU architecture is uploaded to the device via ECHO to download the Fbot\nsamples.\n\nThe information of the Fbot downloader built into the sample is shown as follows.\n\nIn the above figure, the downloader with file offset 0x1D794 is used as an example.\n\n\n-----\n\nMD5:9b49507d1876c3a550f7b7a6e4ec696d\n\nELF 32-bit LSB executable, ARM, version 1 (ARM), statically linked, stripped\n\nPacker:None\n\nIts function is to request the Fbot sample from the download server (198.23.238.203:80) and\nexecute it.\n\n## Suggestions\n\nWe recommend Vantage Velocity users to check and update the firmware system in a timely\nmanner.\n\nWe recommend that Vantage Velocity users set complex login passwords for management\ninterfaces such as Web and SSH.\n\nWe recommend that readers monitor and block relevant IPs and URLs mentioned in this\nblog.\n\n## Contact us\n\n[Readers are always welcomed to reach us on twitter, or email to netlab at 360](https://twitter.com/360Netlab)\n\ndot cn.\n\n## IoC\n\nIP:\n```\n198.23.238.203    United States     ASN36352       ASCOLOCROSSING\n\n```\n\n-----\n\nC2:\n```\n198.23.238.203:5684\n\n```\nURL:\n```\nhttp://198.23.238.203/arm7\n\n```\nMD5:\n```\ndeaee7ada44bf1c6af826d2d170c8698\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-03 - Fbot is now riding the traffic and transportation smart devices.pdf"
    ],
    "report_names": [
        "2021-03-03 - Fbot is now riding the traffic and transportation smart devices.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535925,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653788299,
    "ts_modification_date": 1653788299,
    "files": {
        "pdf": "https://archive.orkl.eu/b1a41600c85defca53d1f12ad912cf4f2f933285.pdf",
        "text": "https://archive.orkl.eu/b1a41600c85defca53d1f12ad912cf4f2f933285.txt",
        "img": "https://archive.orkl.eu/b1a41600c85defca53d1f12ad912cf4f2f933285.jpg"
    }
}