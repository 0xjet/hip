{
    "id": "f646ba32-271e-410d-9451-29ba7c5fdb1e",
    "created_at": "2023-01-12T15:03:53.838999Z",
    "updated_at": "2025-03-27T02:06:08.345035Z",
    "deleted_at": null,
    "sha1_hash": "b1d5a8c5c6b4b2e2c4bce007d59db4d9c5a74f8e",
    "title": "2021-06-24 - Yet Another Archive Format Smuggling Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:32Z",
    "file_modification_date": "2022-05-28T15:19:32Z",
    "file_size": 1030254,
    "plain_text": "# Yet Another Archive Format Smuggling Malware\n\n**[trustwave.com/en-us/resources/blogs/spiderlabs-blog/another-archive-format-smuggling-malware/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/another-archive-format-smuggling-malware/)**\n\nThe use of novel disk image files to encapsulate malware distributed via spam has been a\ntheme that we have highlighted over the past couple of years. As anticipated, we have seen\nmore disk image file formats being used, in addition to .ISO, .IMG, and .DAA which we\n[blogged about.](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/leveraging-disk-imaging-tools-to-deliver-rats/)\n\nWe recently spotted another file format being used. These spams, spoofing courier\ncompanies, contain a malicious WIM (Windows Imaging Format) file disguised as an\ninvoice or consignment note. WIM is a file-based disk image format developed by Microsoft.\nThe file format serves to deploy Windows software components and updates ever since\nWindows Vista. This format uses a \".wim\" extension and its content can be extracted using\narchiving tools like 7Zip, PowerISO, and PeaZip. Below are some samples from this\ncampaign.\n\n\n-----\n\n**Figure 1: A DHL spam containing a fake invoice attachment**\n\n\n-----\n\n**_Figure 2: A DHL spam containing multiple malicious attachments disguised as consignment_**\n_documents_\n\n\n-----\n\n**_Figure 3: A spam spoofing AlphaTrans containing a fake invoice attachment_**\n\nThe attachments, although they have a ‘.wim.001’ file extension which denotes that they are\nthe first part of a larger WIM file, have the complete file structure of a WIM file. Using the\nImageX tool, we verified that all the WIM attachments we collected are not compressed and\nhave one file only.\n\n\n-----\n\n**_Figure 4: The information about the WIM attached in Fig. 1 using the tool ImageX_**\n\nOpening the WIM files in a hex editor, its immediately noticeable that an executable file is\nhiding in them. Using the archiving tool 7Zip as displayed in Fig. 3, the EXE file bearing the\nsame name as its WIM container can be extracted.\n\n**_Figure 5: The WIM attachment shown in Fig. 1 viewed using the tool Hiew_**\n\nAll the WIM files we gathered from our samples contain Agent Tesla malware. This threat is\na Remote Access Trojan (RAT) written in .Net which can take full control over a\ncompromised system and can exfiltrate data via HTTP, SMTP, FTP, and Telegram. [In 2020,](https://www.trustwave.com/en-us/resources/blogs/trustwave-blog/trustwave-2021-email-threat-report-highlights-critical-trends-in-email-security-in-the-age-of-advanced-threats/)\nAgent Tesla was one of the predominant RATs and early this year, we [reported that this](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/the-many-roads-leading-to-agent-tesla/)\nmalware is still actively getting distributed in spam emails.\n\n\n-----\n\n**_Figure 6: The SMTP process of the Agent Tesla malware contained in Fig. 5 using DNSpy_**\n\n**_Figure 7: The Agent Tesla malware extracted from the spam seen in this blog_**\n\n## Summary\n\nEncapsulating malware in an unusual archive file format is one of the common ways to\nbypass gateways and scanners. However, this strategy also poses a hurdle – the target\nsystem must recognize the file type or at least have a tool which can unpack and process\nthe file. In contrast to the more popular .IMG and .ISO disk image files, WIM files are not\nsupported by Windows built-in ability to mount disk image files. Moreover, the other popular\narchive utilities WinRAR and WinZip do not recognize the WIM disk image. WIM files can\nbe processed with the widely used 7Zip.\n\nIn terms of suspiciousness, an inbound email containing a WIM file is not usual and should\nraise a few flags. Administrators could look to block these outright. Trustwave MailMarshal\ndetects these threats bundled inside unusual disk imaging containers using a combination\n\n\n-----\n\nof its unpacking engine and its multi-layered threat detection technology.\n\n## IOC\n\nWIM Files:\n\nDHL Airway 3426983794.wim.001 (782102 bytes)  SHA1:\n91E3FE9AF48482484A4AAC9573D1FB13CB428738\n\nInvoice_for_part_shipped(Feb 19,2021).wim.001 (634678 bytes)  SHA1:\nD37C13A36A92114A927860B7021EB0C71BE73FBF\n\nMonthly Statement.wim.001 (747278 bytes)  SHA1:\n2498342105E1C196C73960654E751D441925ED5C\n\nAgent Tesla:\n\nDHL Airway 3426983793.exe (780800 bytes)  SHA1:\n62FC617343B3D823362C8D9EA89AA676F79CE972\n\nDHL Airway 3426983794.exe (780800 bytes)  SHA1:\n62FC617343B3D823362C8D9EA89AA676F79CE972\n\nInvoice_for_part_shipped(Feb 19,2021).exe (633344 bytes)  SHA1:\nF02FAFB08125D877584F73D5077DFCA95D66318C\n\nMonthly Statement.exe (745984 bytes)   SHA1:\n236D1F71EB2EFA0C24E7EBA4390FEFE3691F1C68\n\nOther:\n\nDHL Airway 3426983793.tar.001 (782336 bytes)  SHA1:\nE31107CCE2AA0DCF8B8C064EFEACAD5508C69D29\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-24 - Yet Another Archive Format Smuggling Malware.pdf"
    ],
    "report_names": [
        "2021-06-24 - Yet Another Archive Format Smuggling Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535833,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1653751172,
    "ts_modification_date": 1653751172,
    "files": {
        "pdf": "https://archive.orkl.eu/b1d5a8c5c6b4b2e2c4bce007d59db4d9c5a74f8e.pdf",
        "text": "https://archive.orkl.eu/b1d5a8c5c6b4b2e2c4bce007d59db4d9c5a74f8e.txt",
        "img": "https://archive.orkl.eu/b1d5a8c5c6b4b2e2c4bce007d59db4d9c5a74f8e.jpg"
    }
}