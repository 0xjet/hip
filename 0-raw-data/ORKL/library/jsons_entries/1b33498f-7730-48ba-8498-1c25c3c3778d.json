{
    "id": "1b33498f-7730-48ba-8498-1c25c3c3778d",
    "created_at": "2023-01-12T15:08:56.728711Z",
    "updated_at": "2025-03-27T02:05:39.379712Z",
    "deleted_at": null,
    "sha1_hash": "fa68eb54c4e1c485b6a457bec56d9f3a0007de65",
    "title": "2021-02-05 - CinaRAT Resurfaces with New Evasive Tactics and Techniques",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:39Z",
    "file_modification_date": "2022-05-28T15:19:39Z",
    "file_size": 1647450,
    "plain_text": "# CinaRAT Resurfaces With New Evasive Tactics and Techniques\n\n**[blog.morphisec.com/cinarat-resurfaces-with-new-evasive-tactics-and-techniques](https://blog.morphisec.com/cinarat-resurfaces-with-new-evasive-tactics-and-techniques)**\n\nPosted by [Nadav Lorber on February 5, 2021](https://blog.morphisec.com/author/nadav-lorber)\nFind me on:\n[Twitter](https://twitter.com/LNadav)\n\n[Tweet](https://twitter.com/share)\n\n## Introduction\n\nIn this post, we will be covering CinaRAT loader`s evasive TTPs (tactics, techniques, and procedures) as have been\nidentified and prevented by Morphisec’s zero-trust endpoint security solution, powered by moving target defense\ntechnology.\n\nWe will be reviewing different versions of multi-staged loaders that attempt to inject and execute CinaRAT within the\nvictim’s host memory. CinaRAT code is available on GitHub for download; generally it's just a rebranded QuasarRAT.\n\n\n-----\n\nWe will focus on the evasive components that allowed the attackers to sustain zero detection for such a long period of\ntime (VirusTotal)\n\n## 1st stage - ISO/VBS script\n\nOur investigation begins with a Visual Basic script that has been identified in a customer environment. We observed its\ndelivery through an ISO archive file.\n\nThe script implements reflective loading, persistence, and evasion functionality.\n\nThe first step is a reflective loading of a remote .NET DLL executable, usually from a GitHub user account represented by\nan image download.\n\n**Figure 1:The image download**\n\nAs soon as the image is downloaded and loaded into memory, it is written into a startup folder using an advanced method:\n\nIn order to copy itself into the autoruns, the script calls “NameSpace(7).Self.Path” that retrieves the autoruns path. This is\na unique technique which isn’t often used for malware delivery.\n\n**Figure 2: NameSpace(7) usage**\n\nThe obfuscation method for each version is different, and within each version the attacker changes the comment line in\neach code line so they can avoid hash detection.\n\n**Figure 3: Comment as a dynamic artifact**\n\nAn interesting note is that the string technique utilized in the “GMR” variable evades VirusTotal when it is parsed.\n\n**Figure 4: VirusTotal content parsing**\n\n**These are the main changes between Visual Basic script versions**\n\nObfuscation, mainly splitting strings\n\n**Figure 5: Part of a split string**\n\n“If” condition within the Powershell in order to validate that the payload was successfully downloaded\nDifferent payloads with different URLs\n\n\n-----\n\nThe following table lists a few examples that correlate between the URL download domain to the file path saved within the\nvictim host along with our internal version numbering.\n\n\n**Internal**\n**version**\n\n\n**Download URL** **Local file path**\n\n\nV1 hxxps://raw.githubusercontent[.]com/githubaccountz/z/main/a.png C:\\Users\\Public\\Music\\a.jpg\n\nV1.1 hxxps://raw.githubusercontent[.]com/githubuser2x/x/master/New.jpg C:\\Users\\Public\\Music\\xt.jpg\n\n\nV1.1 +\nV2\n\n\nhxxps://raw.githubusercontent[.]com/githubuser2x/aws/main/Img.jpg\n\n\nV3 https://raw.githubusercontent[.]com/githubuser2x/x/blob/master/One.html C:\\Users\\Public\\Documents\\One.html\n\n## 2nd stage - .NET loader\n\nAs was described in a previous stage, the Visual Basic script delivers a second .NET file.\n\nThe purpose of this .NET file is to decode the final stage .NET CinaRAT payload and inject it into a legitimate Windows\nprocess utilizing process hollowing. This is done with several evasion techniques in order to avoid detection and AI.\n\nThe RAT payload resides in a base64 encoded string that, during the execution, is decoded and XORed with string as the\nkey. Once the .NET DLL decodes the RAT, it will hollow legitimate images in memory and inject it.\n\nbyte[] array = bxx.fhghjhhfgddg(Convert.FromBase64String(bxx.xxxz), \"!@#$%^&*\n(gfgghgj)_)*gjgj^$#GJgjgjgjNHGH%^*(&^$#$$%&\");\n\n**Figure 6: The XOR decoding routine in V2**\n\nWe have observed four different versions along with four subversions between December 8, 2020, and February 2, 2021\nIt's noticeable that the attacker updated the evasion techniques from version to version in order to avoid detection.\n\nThe following table lists the different internal versions along the with first seen date either from the attacker’s GitHub or\nVirusTotal submission\n\n**Loader Internal version** **Github date** **VirusTotal date**\n\nV1 December 8, 2020\n\nV1.1 December 18, 2020 December 20, 2020\n\nV2 December 24, 2020\n\n\n-----\n\nV2.1 December 24, 2020 December 31, 2020\n\nV2.2 January 16, 2021 Was not submitted\n\nV3 January 23, 2021 January 27, 2021\n\nV4 January 22, 2021 January 25, 2021\n\nV4.1 February 1, 2021 February 3, 2021\n\n## Code pattern:\n\nIn each version the code pattern is different but eventually, the execution flow stays the same except for minor changes.\nHere are a few examples:\n\nThe called method convention is the same in all of the versions (axx.bxx.cxx()) except V4 ([WorkArea.Work]::Exe()).\nIn V1 and V2, the encoded base64 string is loaded from a variable while in V3 and V4 it’s loaded from a bunch of\nfunctions that are joined together to form the string.\nThe XOR key is the same in all of the versions except in V4.\n\nVersion Key\n\nV1 - V3 !@#$%^&*(gfgghgj)_)*gjgj^$#GJgjgjgjNHGH%^*(&^$#$$%&\n\nV4 !@#$%%&*(*))_D!@#DasHF\n\n**Figure 7: Encoded payload chunk from V4.1**\n\n\n-----\n\n## Code obfuscator:\n\nThe attacker obfuscated the code using an unregistered version of Eziriz .NET Reactor, although in V2 and V3 it seems\nthat either they switched to a registered version or discarded the remnant code as the following script was not there\nanymore. In V4 the attacker did not implement any obfuscator, but in V4.1 the obfuscation was implemented again with\nthe “unregistered” remnant code.\n\n**Figure 8: Fingerprint string**\n\n## Code Masquerading:\n\nFrom V1.1, the attacker added legitimate namespaces from popular .NET libraries to the loader. This evasion technique\ntries to disguise the loader as a legitimate .DLL in order to avoid analysis. It's also possible that this technique can bypass\nAV solutions that implement whitelist rules on chunks from those .NET libraries. The following table lists a few examples\nof libraries that were used.\n\n**Version** **Libraries**\n\nV1 None\n\nV1.1 Newtonsoft json.NET\n\nV2.1 RestSharp + DiscUtils\n\nFigure 9: Some of the namespaces in V2\n\nAnalyzing the submission dates and the first detection dates on all of the loaders in VirusTotal suggests that the code\nmasquerading technique succeeds with bypassing AV solutions.\n\n## 3rd stage - RAT Payload\n\nWe have observed four different versions of RAT payloads. The first one that was used was QuasarRAT 1.4, while later\non CinaRAT 1.0.1.1 was used instead with some modifications. For the C2 domain, the attacker mostly used a dynamic\nDNS service from myq-see[.]com\n\nThe following table correlates the observed RAT version with the C2 domain and Loader version.\n\n**RAT Version** **Loader internal version** **C2 Domain**\n\nQuasarRAT 1.4 V1\nserver.homesbill[.]com\n\n\n-----\n\nCinaRAT 1.0.1.1 variant A V1.1\n\nV1.1 + V2 aptzebi.myq-see[.]com\n\nV2.1 aptzebi0.myq-see[.]com\n\nV2.1 + V2.2\nmahost.myq-see[.]com\n\nV3\n\nCinaRAT 1.0.1.1 variant B\n\nV4 aptzebi3.myq-see[.]com\n\nCinaRAT 1.0.1.1 variant C V4.1 zebi4.myq-see[.]com\n\n**example from V4.1**\n\n## Conclusion\n\n\n**Figure 10: RAT configuration**\n\n\nThe Morphisec platform prevents attacks from CinaRAT with a zero-trust default-deny approach to endpoint security,\npowered by moving target defense. Customers of Morphisec are thus protected from CinaRAT, regardless of what evasive\ntechniques the attacker deploys to bypass AV and NGAV solutions.\n\n## IOCs\n\n**VB Scripts (Stage 1)**\n\n**SHA256** **Internal version**\n\n6dd24a396feba685ed77ee73e20388a571ffee2a857e5269406043aa5a03fb50 V1\n\n8c07a453e85d6ce766a5cb60dd5d2311f3570f2b818b6050c70bb91cfcecefe4\n\n\n-----\n\nc1112384f112be4ca371297019f4ca8d93d7b76e105014d1b9d54b18aced9124 V1.1\n\nd14a38bf604ba56945f3e16732103dbb47067977e14de567cacf1c09ba20b7f7\nV1.2\n\nf1afcbbd219edc56641787aee26420e55a8ab7f088dc900a146361733698c6da\n\n44a69db5be76bfd200aaa79510e2f8a240f07f9d0840df95e55a0fec0944afdb V2\n\naddd44ee803082c4667bae68284e316f1a799b72ecbdaae38097ba2c4ccb9d16 V3\n\n**.NET Loader (Stage 2)**\n\n**SHA256** **Internal version**\n\nf5fd82f7f599b1ed477a6f66388cbe0f2beec9fc28e83d35105cd3222a85d5ab V1\n\nc6e20052ab38341af626b0a07654c763af77fe830d5e216f03ed3b99d944de65\n\ncc18946e23d3fd289375912cb1d997be0ae3e71d2b4bcf1a14583f9f3ab4f919 V1.1\n\nceb9cf440fc521f09a503e90889acb7f51b4c39ce8a8c4d37dd8304fca2db4ce\n\n714cdcd6e144b482d1c98661e894900244862c7135a895f2edfcd7fdac6d84fc V2\n\n47684fe237efc9dd608bac491db984f7b67b91b9fbf890da788123af8cadbe30\n\ne1594447ff87f29d61735f5ce39a8150fae79349b389c8e5dab2c2de30e62966 V2.1\n\nd4235a670e2f7c5232cc9961b843db239e43d0cf3f619c6104b162944b3ee39d\n\n32a9caba473f6f19103526c605e65c421adc50421cab6e0a7de9d745b8829778 V2.2\n\n96fe6bfe32a8cc77adff891b39c45c638c456b48915798e69012ea1e4333560f V3\n\n4ba57a45bfd29555d3e269abdb6efa391befc164e90813fb0ff2d486b52792ca V4\n\n230a74b0f306464dcb6e16b9d3c62d364e13c2d69e3c654dce303e1efd3fc6b2 V4.1\n\n\n-----\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-05 - CinaRAT Resurfaces with New Evasive Tactics and Techniques.pdf"
    ],
    "report_names": [
        "2021-02-05 - CinaRAT Resurfaces with New Evasive Tactics and Techniques.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536136,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653751179,
    "ts_modification_date": 1653751179,
    "files": {
        "pdf": "https://archive.orkl.eu/fa68eb54c4e1c485b6a457bec56d9f3a0007de65.pdf",
        "text": "https://archive.orkl.eu/fa68eb54c4e1c485b6a457bec56d9f3a0007de65.txt",
        "img": "https://archive.orkl.eu/fa68eb54c4e1c485b6a457bec56d9f3a0007de65.jpg"
    }
}