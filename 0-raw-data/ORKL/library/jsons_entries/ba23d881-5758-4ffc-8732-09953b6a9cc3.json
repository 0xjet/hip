{
    "id": "ba23d881-5758-4ffc-8732-09953b6a9cc3",
    "created_at": "2023-01-12T15:05:10.814095Z",
    "updated_at": "2025-03-27T02:16:37.209142Z",
    "deleted_at": null,
    "sha1_hash": "4dcee185397fb16272dc1c38a2ed969c02f8692f",
    "title": "2016-06-17 - Operation Daybreak",
    "authors": "",
    "file_creation_date": "2022-05-28T17:52:25Z",
    "file_modification_date": "2022-05-28T17:52:25Z",
    "file_size": 738646,
    "plain_text": "# Operation Daybreak\n\n**securelist.com/operation-daybreak/75100/**\n\n[APT reports](https://securelist.com/category/apt-reports/)\n\n[APT reports](https://securelist.com/category/apt-reports/)\n\n17 Jun 2016\n\nminute read\n\n\n-----\n\nAuthors\n\n[Costin Raiu](https://securelist.com/author/costin/)\n\nAnton Ivanov\n\n## Flash zero-day exploit deployed by the ScarCruft APT Group\n\nEarlier this year, we deployed new technologies in Kaspersky Lab products to identify and\nblock zero-day attacks. This technology already proved its effectiveness earlier this year,\n[when it caught an Adobe Flash zero day exploit (CVE-2016-1010). Earlier this month, our](https://securelist.com/the-mysterious-case-of-cve-2016-0034-the-hunt-for-a-microsoft-silverlight-0-day/73255/)\ntechnology caught another zero-day Adobe Flash Player exploit deployed in targeted\nattacks. We believe the attacks are launched by an APT Group we track under the\ncodename “ScarCruft”.\n\nScarCruft is a relatively new APT group; victims have been observed in Russia, Nepal, South\nKorea, China, India, Kuwait and Romania. The group has several ongoing operations,\nutilizing multiple exploits — two for Adobe Flash and one for Microsoft Internet Explorer.\n\nOperation Daybreak appears to have been launched by ScarCruft in March 2016 and\nemploys a previously unknown (0-day) Adobe Flash Player exploit. It is also possible that the\ngroup deployed another zero day exploit, CVE-2016-0147, which was patched in April.\n\nThis exploit caught by our technologies highlights a few very interesting evasion methods,\nsome of which we haven’t seen before. We describe them below.\n\n\n-----\n\n## Operation Daybreak general information\n\nOperation Daybreak appears to have been launched by unknown attackers to infect high\nprofile targets through spear-phishing e-mails. To date, we have observed more than two\ndozen victims for these attacks.\n\nAlthough the exact attack vector remains unknown, the targets appear to receive a malicious\nlink which points to a hacked website where the exploitation kit is hosted. The hacked web\nserver hosting the exploit kit is associated with the ScarCruft APT and used in another line of\nattacks. Certain details, such as using the same infrastructure and targeting, make us\nbelieve that Operation Daybreak is being done by the ScarCruft APT group.\n\nThe ScarCruft APT group is a relatively new player and managed to stay under the radar for\nsome time. In general, their work is very professional and focused. Their tools and\ntechniques are well above the average. Prior to the discovery of Operation Daybreak, we\nobserved the ScarCruft APT launching a series of attacks in Operation Erebus. Operation\nErebus leverages another Flash Player exploit (CVE-2016-4117) through the use of watering\nhole attacks.\n\nIn the case of Operation Daybreak, the hacked website hosting the exploit kit performs a\ncouple of browser checks before redirecting the visitor to a server controlled by the attackers\nhosted in Poland.\n\nThe main exploit page script contains a BASE64 decoder, as well as rc4 decryption\nimplemented in JS.\n\nThe parameters sent to the “ap.php” script are randomly generated on each hit, so the\nsecond stage payload gets encrypted differently each time. This prevents easy detection by\nMD5 or signatures of the second stage payload.\n\nThe exploitation process consists of three Flash objects. The Flash object that triggers the\nvulnerability in Adobe Flash Player is located in second SWF delivered to the victim.\n\nAt the end of the exploitation chain, the server sends a legitimate PDF file to user –\n“china.pdf”. The “china.pdf” file shown to the victims in the last stage of the attack seems to\nbe written in Korean:\n\n\n-----\n\n_Decoy document shown to victims_\n\nThe document text talks about disagreements between China and “The North” over nuclear\nprograms and demilitarization.\n\n## Vulnerability technical details\n\nThe vulnerability (CVE-2016-4171) is located in the code which parses the ExecPolicy\nmetadata information.\n\nThis is what the structure looks like:\n\nThis structure also contains an array of item_info structures:\n\nThe documentation says the following about these structures:\n\n\n-----\n\n_The item_info entry consists of item_count elements that are interpreted as key/value pairs_\n_of indices into the string table of the constant pool. If the value of key is zero, this is a keyless_\n_entry and only carries a value.”_\n\nIn the exploit used by the ScarCruft group, we have the following item_info structures:\n\n_Item_info array in exploit object_\n\nThe code that triggers the vulnerability parses this structure and, for every key and value\nmembers, tries to get the respective string object from string constant pool. The problem\nrelies on the fact that the “.key” and “.value” members are used as indexes without any kind\nof boundary checks. It is easy to understand that if key or value members are larger than\nstring constant pool array, a memory corruption problem appears. It is also important to\nmention that this member’s (value, key) are directly read from SWF object, so an attacker\ncan easily use them to implement arbitrary read/write operations.\n\n\n-----\n\n_Getting object by index from constant pool without any checks_\n\nUsing this vulnerability, the exploit implements a series of writes at specified addresses to\nachieve full remote code execution.\n\n## Bypassing security solutions through DDE\n\nThe Operation Daybreak attack employs multiple stages, which are all outstanding in some\nway. One of them attracted our attention because it implements a bypass for security\nsolutions we have never seen before.\n\nIn the first stage of the attack, the decrypted shellcode executed by the exploit downloads\nand executes a special DLL file. This is internally called “yay_release.dll”:\n\n_Second stage DLL internal name and export_\n\n\n-----\n\nThe code of this module is loaded directly into the exploited application and has several\nmethods of payload execution. One of method uses a very interesting technique of payload\nexecution which is designed mostly to bypass modern anti-malware products. This uses an\ninteresting bug in the Windows DDE component. It is not a secret that anti-malware systems\ntrigger on special system functions that are called in the context of potential vulnerable\napplications to make a deeper analysis of API calls such as CreateProcess, WinExec or\nShellExecute.\n\nFor instance, such defense technologies trigger if a potentially vulnerable application such as\nAdobe Flash starts other untrusted applications, scripts interpreters or even the command\nconsole.\n\nTo make execution of payload invisible for these defense systems, the threat actors used the\nWindows DDE interface in a very clever way. First, they register a special window for it:\n\nIn the window procedure, they post WM_DDE_EXECUTE messages with commands:\n\n_Sending WM_DDE_EXECUTE message to window_\n\nThe attackers used the following commands:\n\n\n-----\n\nThe main idea here is that if you create a LNK to an executable or command, then use the\nShowGroup method, the program will be executed. This is an undocumented behavior in\nMicrosoft Windows.\n\nIn our case, a malicious VBS was executed, which installs a next stage payload stored in\nCAB file:\n\n_Malicious VBS used in the attack_\n\nWe have reported this “creative” abuse of DDE to Microsoft’s security team.\n\nThe final payload of the attack is a CAB file with the following MD5:\n\n8844a537e7f533192ca8e81886e70fbc\n\n\n-----\n\nThe MS CAB file (md5: 8844a537e7f533192ca8e81886e70fbc) contains 4 malicious DLL\nfiles:\n\nMD5 Filename\n\na6f14b547d9a7190a1f9f1c06f906063 cfgifut.dll\n\ne51ce28c2e2d226365bc5315d3e5f83e cldbct.dll\n\n067681b79756156ba26c12bc36bf835c cryptbase.dll\n\nf8a2d4ddf9dc2de750c8b4b7ee45ba3f msfte.dll\n\nThe file cldbct.dll (e51ce28c2e2d226365bc5315d3e5f83e) connects to the following C2:\n\nhXXp://webconncheck.myfw[.]us:8080/8xrss.php\n\nThe modules are signed by an invalid digital certificates listed as “Tencent Technology\n(Shenzhen) Company Limited” with serial numbers, copied from real Tencent certificates:\n\n5d 06 88 f9 04 0a d5 22 87 fc 32 ad ec eb 85 b0\n71 70 bd 93 cf 3f 18 9a e6 45 2b 51 4c 49 34 0e\n\n_Invalid digital signature on malware samples_\n\nThe malware deployed in this attack is extremely rare and apparently reserved only for high\nprofile victims. Our products detect it as well as other malware from ScarCruft as\n**HEUR:Trojan.Win32.ScarCruft.gen.**\n\n## Victims:\n\n\n-----\n\nAlthough our visibility is rather limited, some of the victims of these attacks include:\n\nA law enforcement agency in an Asian country\nOne of the largest trading companies in Asia and in the world\nA mobile advertising and app monetization company in the USA\nIndividuals related to the International Association of Athletics Federations\nA restaurant located in one of the top malls in Dubai\n\nSome of these were compromised over the last few days, indicating the attackers are still\nvery active.\n\n## Conclusions:\n\nNowadays, in-the-wild Flash Player exploits are becoming rare. This is because in most\ncases they need to be coupled with a Sandbox bypass exploit, which makes them rather\ntricky.\n\nAdditionally, Adobe has been doing a great job at implementing new mitigations to make\nexploitation of Flash Player more and more difficult.\n\nNevertheless, resourceful threat actors such as ScarCruft will probably continue to deploy\nzero-day exploits against their high profile targets.\n\nAs usual, the best defense against targeted attacks is a multi-layered approach. Windows\nusers should combine traditional anti-malware technologies with patch management, host\nintrusion detection and, ideally, allowlisting and default-deny strategies. According to a study\nby the Australian DSD, 85% of the targeted attacks analysed could have been stopped by\nfour simple defense strategies. While it’s impossible to achieve 100% protection, in practice\nand most cases all you have to do is increase your defenses to the point where it becomes\ntoo expensive for the attacker – who will just give up and move on to other targets.\n\nKaspersky products detect flash exploit as HEUR:Exploit.SWF.Agent.gen also our AEP\n(Automatic Exploit Prevention) component can successfully detect this attack. Payloads are\ndetected with HEUR:Trojan.Win32.ScarCruft.gen verdict.\n\n_* More information about the ScarCruft APT group is available to customers of Kaspersky_\n_Intelligent Services._\n\n## Indicators of compromise:\n\n### Malicious IPs and hostnames:\n\n212.7.217[.]10\nreg.flnet[.]org\nwebconncheck myfw[ ]us\n\n\n-----\n\n### MD5s:\n\n3e5ac6bbf108feec97e1cc36560ab0b6\n\na6f14b547d9a7190a1f9f1c06f906063\n\ne51ce28c2e2d226365bc5315d3e5f83e\n\n067681b79756156ba26c12bc36bf835c\n\nf8a2d4ddf9dc2de750c8b4b7ee45ba3f\n\n8844a537e7f533192ca8e81886e70fbc\n\n[Adobe Flash](https://securelist.com/tag/adobe-flash/)\n[APT](https://securelist.com/tag/apt/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n[Zero-day vulnerabilities](https://securelist.com/tag/zero-day-vulnerabilities/)\n\nAuthors\n\n[Costin Raiu](https://securelist.com/author/costin/)\n\nAnton Ivanov\n\nOperation Daybreak\n\nYour email address will not be published. Required fields are marked *\n\nTable of Contents\n\nGReAT webinars\n\nSubscribe to our weekly e-mails\n\nThe hottest research right in your inbox\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-06-17 - Operation Daybreak.pdf"
    ],
    "report_names": [
        "2016-06-17 - Operation Daybreak.pdf"
    ],
    "threat_actors": [
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535910,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1653760345,
    "ts_modification_date": 1653760345,
    "files": {
        "pdf": "https://archive.orkl.eu/4dcee185397fb16272dc1c38a2ed969c02f8692f.pdf",
        "text": "https://archive.orkl.eu/4dcee185397fb16272dc1c38a2ed969c02f8692f.txt",
        "img": "https://archive.orkl.eu/4dcee185397fb16272dc1c38a2ed969c02f8692f.jpg"
    }
}