{
    "id": "9d4486ad-8f82-400d-8083-d46473b7a90b",
    "created_at": "2023-01-12T15:04:21.400758Z",
    "updated_at": "2025-03-27T02:15:11.002361Z",
    "deleted_at": null,
    "sha1_hash": "12ef334bd4fc277c1712391c8d14387afababaf1",
    "title": "2022-03-16 - New Ransomware Family Identified- LokiLocker RaaS Targets Windows Systems",
    "authors": "",
    "file_creation_date": "2022-05-28T23:23:23Z",
    "file_modification_date": "2022-05-28T23:23:23Z",
    "file_size": 4337477,
    "plain_text": "# New Ransomware Family Identified: LokiLocker RaaS Targets Windows Systems\n\n**[blogs.blackberry.com/en/2022/03/lokilocker-ransomware](https://blogs.blackberry.com/en/2022/03/lokilocker-ransomware)**\n\nThe BlackBerry Research & Intelligence Team\n\n**_Update 05.27.22: An unknown APT group is targeting Russian government entities with at_**\n_least four separate spear-phishing campaigns since the beginning of the conflict in Ukraine._\n_Source:_ _[Security Affairs.](https://securityaffairs.co/wordpress/131658/apt/unknown-apt-group-target-russia.html)_\n\n### Overview\n\nBlackBerry Threat Intelligence has identified a new Ransomware-as-a-Service (Raas)\nfamily, and tracked its lineage to its probable beta stage release. Like so many other strains\nof ransomware, LokiLocker encrypts your files and will render your machine unusable if you\ndon't pay up in time. However, like its namesake god Loki, this threat seems to have a few\nsubtle tricks up its sleeve - not least being a potential “false flag” tactic that points the finger\nat Iranian threat actors.\n\n\n-----\n\nIn Norse mythology, [Loki was the consummate trickster who had the ability to shapeshift at](https://www.britannica.com/topic/Loki)\nwill. One of the many hot-headed fire gods, Loki was an enemy to the other gods\nthemselves, often entering their banquets uninvited and demanding their food and drink.\nLokiLocker is similarly insistent on acquiring that to which it has no legitimate claim.\n\nLokiLocker is a relatively new ransomware family targeting English-speaking victims and\nWindows® PCs; the threat was first seen in the wild in mid-August 2021. It shouldn’t be\n[confused with an older ransomware family called Locky, which was notorious in 2016, or](https://blogs.blackberry.com/en/2017/11/threat-spotlight-locky-ransomware)\n[LokiBot, which is an infostealer. It shares some similarities with the LockBit ransomware](https://blogs.blackberry.com/en/2018/07/mysterybot-do-you-do-your-banking-on-your-phone)\n(registry values, ransom note filename), but it doesn't seem to be its direct descendant.\nLike the god it is named after, LokiLocker enters the victim’s life uninvited and starts looking\nfor property to purloin. The threat then encrypts their files, and demands they pay a\nmonetary ransom to restore access. The malware is written in .NET and protected with\nNETGuard (modified ConfuserEX) using an additional virtualization plugin called KoiVM.\nKoiVM used to be [a licensed commercial protector for .NET applications, but around 2018,](https://ki-host.appspot.com/KoiVM)\nits code was open-sourced (or possibly leaked), and it’s now publicly available on GitHub.\nAlthough Koi seems to be popular with hacking tools and cracks, we haven’t seen a lot of\nother malware using it to date.\n\n### Loki the Destroyer\n\nLokiLocker encrypts victim’s files on local drives and network shares with a standard\ncombination of AES for file encryption and RSA for key protection. It then asks the victim to\nemail the attackers to obtain instructions on how to pay the ransom.\n\nLokiLocker also boasts an optional wiper functionality – if the victim doesn’t pay up in the\ntimeframe specified by the attacker, all non-system files will be deleted and the MBR\noverwritten, wiping all the victim’s files and rendering the system unusable. With a single\nstroke, everyone loses.\n\nLokiLocker works as a limited-access Ransomware-as-a-Service scheme that appears to\nbe sold to a relatively small number of carefully vetted affiliates behind closed doors. Each\naffiliate is identified by a chosen username and is assigned a unique chat-ID number. There\nare currently about 30 different “VIP” affiliates across the LokiLocker samples that\nBlackBerry researchers have found in the wild.\n\nOne of the earliest samples of this ransomware was initially distributed inside Trojanized\nbrute-checker hacking tools such as:\n\nPayPal BruteChecker\nSpotify BruteChecker\nPiaVPN Brute Checker By ACTEAM\nFPSN Checker by Angeal (Cracked by MR_Liosion)\n\n\n-----\n\nBrute-checkers are tools used to automate validation of stolen accounts, and gain access to\n[other accounts, via a technique called credential stuffing. It’s possible that the LokiLocker](https://en.wikipedia.org/wiki/Credential_stuffing)\nversion distributed with these hacking tools constituted some kind of beta testing phase\nbefore the malware was offered to a wider range of affiliates.\n\nThe victims we’ve observed seem to be scattered around the world (which is not\nunexpected, given that different affiliates might have different targeting patterns), with the\nmain concentration in Eastern Europe and Asia.\n\nAlthough we’ve been unable to reliably assess exactly where the LokiLocker RaaS\noriginates, it is worth mentioning that all the embedded debugging strings are in English,\nand – unlike the majority of malware originating from Russia and China – the language is\nlargely free of mistakes and misspellings.\n\nAlso, perhaps more interestingly, some of the cracking tools used to distribute the very first\nsamples of LokiLocker seem to be developed by an Iranian cracking team called\nAccountCrack. Moreover, at least three of the known LokiLocker affiliates use unique\nusernames that can be found on Iranian hacking channels. It’s not entirely clear whether\nthis means they truly originate from Iran or that the real threat actors are trying to cast the\nblame on Iranian attackers.\n\n### Diving into LokiLocker\n\nTo inspect the C# code, we must first open the binary in DNSpy to decompile it. We can see\nthe original filename of \"svchost.exe,” and a reference to NETGuard/KoiVM v0.2.0-custom,\nas seen in Figure 1.\n\n_Figure 1 - KoiVM obfuscator version_\n\nWhen we inspect the namespace, we are immediately confronted with two labelled classes,\n“Koi” and “NETGuard,” as well as numerous classes with obfuscated function names. These\nfunction names are all prefixed with multiples of the letter “Z,” as seen in Figure 2. This\nholds true for the other namespaces as well.\n\n\n-----\n\n_Figure 2 - Koi, NETGuard and obfuscated class names_\n\nKoiVM, as the name suggests, is a virtual machine (VM) designed to work on ConfuserEx, a\nC# obfuscator. The virtualization works as a more challenging form of obfuscation. As\ndescribed in the documentation for KoiVM, this is done by \"turning the .NET opcodes into\nnew ones that only are understood by our machine.\"\n\nTypically, vanilla implementations of KoiVM can be devirtualized using a tool named\nOldRod, which was developed specifically to defeat KoiVM virtualization and make the\ndecompiled code more understandable to the human eye. However, it’s trivial to modify\nKoiVM so that OldRod cannot find specific signatures or required data. And unless you\nmodify the tool itself to handle these modifications, it can result in an unsuccessful attempt\nat devirtualization.\n\nWith the sample analyzed by BlackBerry researchers, OldRod fails, as there is no #Koi\nstream listed within the COR20 MetaData Tables Header, which brings us back to square\none.\n\nIt’s important to note the presence of several namespaces of interest, particularly those\nbeginning with “Loki,” such as those pictured in Figure 3. If we inspect the code contained\nwithin the classes, we can see that there’s a problem (for now!): They’re either empty, or\nDNSpy threw an error when decompiling them.\n\n\n-----\n\n_Figure 3 - Loki functions – Empty or unable to be decompiled_\n\n_Loki.Pinvoke contains the class ZZZZX (as seen in Figure 4), which itself contains wrappers_\nto various Windows APIs. Calling one of these wrappers will import the DLL and the\nspecified function. This has the added benefit of removing any direct calls to the Windows\nAPI. For example, any call to the Kernel32.dll’s FindNextFile need only call the C# function\nZZZZZf.\n\n_Figure 4 - WinAPI wrappers_\n\nAlso of note is the “affiliate config,” which contains several configuration options that we’ll\nexplore in greater detail further on.\n\n\n-----\n\n_Figure 5 - Loki config_\n\nNow that we’ve looked at some key features of the binary, it’s time to get our hands dirty\nand dig deeper into this ransomware.\n\n### Unpacking\n\nWhile OldRod couldn’t devirtualize the binary for us, all is not yet lost. With a bit of oldfashioned elbow grease and debugging magic, we can still work our way through the binary\nthe old-fashioned way. We found that DNSpy fails to put a breakpoint on the entry point or\nprocess creation, and that by navigating to the first namespaces constructor (.cctor) we\ncould breakpoint the initial call to the Koi() function and step in, leading us to Figure 6\nbelow.\n\n\n-----\n\n_Figure 6 – KoiVM virtualized functions_\n\nThere are 324 calls to functions within the Koi() class. However, many are repeated and are\npresumably setting up the VM environment. Of the calls we’re interested in, only three are\nimportant – the first, penultimate, and last.\n\n### First Unpacking Function\n\nThe first function fetches the module base address and proceeds to decode a section of\nitself in-memory, through a series of convoluted XORs and variable assignments. Once this\nis done, VirtualProtect is called with PAGE_EXECUTE_READWRITE permissions.\n\nA final loop then decodes more data into the same location that had its permissions\nchanged. The overall purpose of this first function appears to be to decode some additional\ndecoding functions for later use.\n\n### Second (Last) Unpacking Function\n\nInitially, a large byte array is defined within a global variable, as seen in Figure 7, where\neach byte is XOR’d against its position in the byte array. Once this operation has completed,\nthe resulting data is decompressed using GZIP.\n\n\n-----\n\n_Figure 7 - ByteArray definition, XOR decoding, GZip decompression_\n\nThis data is then used to populate the functions that were previously empty or unable to be\ndecompiled, which we saw initially within the “Loki.*” classes shown in Figure 3.\n\n### This Isn’t Even My Final Form Function!\n\nWhile the important functions have now been decoded and resolved, there’s one final step\nto be taken before execution is passed into Loki’s core. This function destroys the\nexecutable, to evade scanning solutions through a few distinct means.\n\nSimilar to the first function, the handle to the module in-memory is retrieved. From there,\nseveral operations take place, such as the overwriting of two strings into the Import\nDescriptor Table for CoreExeMain and Mscoree.dll, with NtContinue and Ntdll.dll\nrespectively. Once this has been completed, the file changes the permissions of the PE\nSection Table Header and the COR20 MetaData Table Headers. It does this so it can\noverwrite these headers with null bytes. Figure 8 below shows a snippet of this function for\nreference.\n\n\n-----\n\n_Figure 8 – IDT manipulation & overwriting of headers_\n\nOnce this function completes, the binary then jumps to the beginning of the main function of\nthe LokiLocker core, as shown in Figure 9, below.\n\nNow that we’ve finished unpacking the sample, let’s look at the core functionality of\nLokiLocker.\n\n### Functionality\n\n**Debug Logging**\n\n\n-----\n\nLokiLocker can be executed with a --log parameter, which will save a detailed, verbose log\nof the infection in “<malware_execution_path>\\logs.txt.”\n\n_Figure 9 - Relabelled \"main” function with \"--log\" execution parameter_\n\nWhile the core sample is still obfuscated to a certain extent, the presence of these highly\ndescriptive debugging strings makes this laborious analysis a little bit easier.\n\n### Persistence\n\nUpon execution, the malware copies itself to “%ProgramData%/winlogon.exe,” sets its\nattributes to hidden and system, and creates a mutex called “LokiLocker.”\n\nIt achieves persistence in several ways:\n\nBy creating a scheduled task to execute the malware binary on each logon:\n\nschtasks /CREATE /SC ONLOGON /TN Loki /TR %ProgramData%\\winlogon.exe /RU\nSYSTEM /RL HIGHEST /F\n\nBy adding the following value to the Software\\Microsoft\\CurrentVersion\\Run under\nboth HKCU and HKLM keys:\n\n“Michael Gillespie” = %ProgramData%\\winlogon.exe\n\nBy copying the malware executable to the Common Startup folder\n\n\n-----\n\nMichael Gillespie, cited in the example above, is the name of a well-known anti-ransomware\nresearcher, who is very active on Twitter and the Bleeping Computers forum. It’s not the first\ntime malware writers have given a “shout-out” to security researchers like this, but it’s a rare\nevent. Another similar example was Maze ransomware, which used the name of another\nwell-known anti-ransomware researcher as its “killswitch” file name.\n\n### Preparation\n\nBefore the encryption process starts, the malware performs the following actions:\n\nReads its configuration; default config options are hard-coded in the binary’s Config\nclass, but they can be supressed by values read from the config file\nIf config file called loki.txt file exists, it copies it to %ProgramData%\\config.Loki and\nreads the config values from there\nDisplays a fake Windows Update screen, if configured to do so\nKills specified processes\nStops specified services\nDisables Windows Task Manager, if configured to do so, and drops wvtymcow.bat file\nwith the following contents to the Startup folder:\n\nREG add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v\nDisableTaskMgr /t REG_DWORD /d 1 /fac\n\nDeletes system backup and shadow copies\nDisables Windows Error Recovery\nDisables integrated firewall\nRemoves system restore points\nEmpties Recycle.bin\nDisables Windows Defender\nChanges User Login Note (as seen in Figures 10 and 11)\n\n_Figure 10 - Code to change user login_\n\n\n-----\n\n_Figure 11 - LokiLocker’s user login note_\n\nChanges original equipment manufacturer (OEM) info in the registry\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\OEMInformation (as seen in Figure\n12)\n\n_Figure 12 – Code that changes OEM information_\n\n### Network Communication\n\nThe malware sends a beacon containing the following information in a POST request to the\nindex.php script hosted on the command-and-control (C2) server, as seen in Figure 13. The\nC2’s URL is hard-coded in the binary’s config and is set to loki-locker[.]one. The “user”\nand “chat-id” fields are hard-coded, while the other information is generated based on the\nvictim’s system properties:\n\n\n-----\n\nunique-id=<volume_serial_number>\ndisk-size=<size_of_main_drive>\nuser=<hardcoded_affiliate_username>\ncpu-name=<cpu>\nram-size=<physical_memory>\nos-name=<name_of_operating_system>\nchat-id=<hardcoded_number>\n\n_Figure 13 – Part of network communication code (POST to index.php)_\n\nThe URL resolves to 91[.]223[.]82[.]6. The user-agent used in all communication is Loki/1.0.\n\nAs a response from C2, the malware expects an obfuscated public key in the form of a\nJSON object. The response buffer can have maximum size of 0x100000 (1048576 bytes).\n\n{\n“public” : ”[ base64(xor(attackers_public_key, 0x0652)) ]”,\n\n“message_id” : [int]\n\n}\n\n\n-----\n\nThe malware also communicates with the tg.php script on the same server, as seen in\nFigure 15, which appears to be the API endpoint for status updates from the bot. It’s mainly\nused to inform the C2 about the progression of the encryption process. The following\nparameters can be passed to the script:\n\nunique_id\naction\nmsg-id\nchat-id\nstatus\nelapsed-time\n\nThe resulting request looks like this:\n\n_Figure 14 – LokiLocker’s POST request_\n\n_Figure 15 – Part of network communication code (POST to tg.php)_\n\n### Encryption\n\nThe malware creates an RSA-2048 key pair for the victim, encrypts it with the attacker’s\npublic RSA key, and then saves it to the registry.\n\n\n-----\n\nThe malware creates the key HKCU\\Software\\Loki and the following values:\n\n**Public – contains the victim’s public RSA key in the XML format, which is then**\nobfuscated with XOR 0x11.\n\n<RSAKeyValue><Modulus>modulus</Modulus><Exponent>exponent</Exponent>\n</RSAKeyValue>\n\n**Full – contains the victim’s full key pair, encrypted with attacker’s public key. A**\nbase64-encoded copy is also saved to the file “cpriv.Loki” in each drive’s root directory\nand in the user’s special directories.\n\n<RSAKeyValue><Modulus>modulus</Modulus>\n<Exponent>public_exponent</Exponent><P>prime_1</P><Q>prime_2</Q>\n<DP>exponent_1</DP><DQ>exponent_2</DQ><InverseQ>coefficient</InverseQ>\n<D>private_exponent</D></RSAKeyValue>\n\n**Timer – a date-time value, which is the ransom expiration date in the format of**\nyyyyy,MM,dd,HH,mm,ss, encoded with XOR 0x54. This is the exact time after which\nthe malware will wipe the drives by deleting all non-system files and overwriting the\nMBR. The default date is 30 days after the initial malware execution date, but this can\nbe changed via config file.\n\n[Similar registry entries are used by versions of LockBit ransomware.](https://blogs.blackberry.com/en/2021/08/threat-spotlight-lockbit-2-0-ransomware-takes-on-top-consulting-firm)\n\nThere are five different RSA public keys stored in the malware binary, though the attackers\ncan also supply another public key via the C2. Since the C2 server is the same for all\naffiliates, this suggests that the RaaS owners left themselves the option to send in their own\npublic key to secure the victim’s private key, meaning they would be able to decrypt files\nfrom all their affiliates’ victims.\n\nIf configured to do so, the malware will scan the network for any available network shares. It\nwill then begin the encryption process, starting with the following special folders in the local\nuser’s directory:\n\nFavorites\nRecent\nDesktop\nPersonal\nMyPictures\nMyVideos\nMyMusic\n\n\n-----\n\nLokiLocker then proceeds to create a separate thread for encrypting each of the local drives\nand/or network shares, depending on its configuration.\n\nEach file is encrypted with AES-256 in GCM mode, using a randomly generated key; the\nkey is then encrypted using the victim’s public RSA key.\n\nThe encryption thread also performs the following actions:\n\nChanges labels of all encrypted volumes to \"Locked by Loki\"\nDrops ransom notes to each encrypted folder\nDrops an HTA file called “info.Loki”\nDrops and executes a launcher for the HTA file using a random name in the\n%ProgramData% directory\nChanges the desktop wallpaper as shown inFigure 16\nCreates a thread that will instantly kill cmd.exe, taskmgr.exe and regedit.exe\nprocesses, if launched\nIf configured to do so, shuts down the system after encryption\n\n_Figure 16 – LokiLocker desktop wallpaper_\n\n### Wiper Functionality\n\nIf configured to do so, the malware will attempt to wipe the system if the ransom isn’t paid\nwithin the specified time frame. As shown in Figure 18, it will delete files on all of the victim’s\ndrives, except for the system files, and it will also try to overwrite the Master Boot Record\n(MBR) of the system drive to render the system unusable. It will then display the following\nmessage from the attackers after a reboot:\n\n\n-----\n\n_Figure 17 – LokiLocker’s message shown after rebooting the wiped system_\n\nAfter overwriting the MBR, LokiLocker will try to crash the system by forcing a Blue Screen\nof Death (BSOD).\n\n_Figure 18 – LokiLocker’s wiper code_\n\n### Config\n\nLokiLocker features multiple configurable sections. Most of the configurable information is\nhard-coded into the client binary during the building process, while some settings can be\nchanged on runtime using a simple text file.\n\nBesides the affiliate-related information and execution options, other fields that might be\nconfigurable during the building process are a list of commands to be executed through\ncmd.exe, and a list of processes and services the malware will attempt to kill. Across the\nsamples we’ve seen, these fields have been consistent so far.\n\n### Affiliate Config\n\nThe main “affiliate” config section contains information such as the name of affiliate, email\naddresses, C2 URL, readme file name and content, and the extension to be added to the\nencrypted files. It also has a chat ID number – presumably used to identify the victim when\nthey reach out to the attackers – and a timeout value (in days) after which the malware will\nattempt to wipe the system.\n\nThe affiliate config is stored in the Loki.Config class and presumably embedded by the\nransomware builder during the generation of a client binary.\n\n\n-----\n\n**Config Key** **Config Value**\n\n**Email 1** “d4rkw4ve[at]tutanota[.]com”\n\n**Email 2** “dark4wave[at]yandex[.]com”\n\n**Campaign or Affiliate name** “darkwave”\n\n**Chat ID** _<redacted>_\n\n**Extension** “. Loki”\n\n**Readme file name** “Restore-My-Files.txt”\n\n**Ransom note** _See Figure 21_\n\n**Wiper timeout** 30\n\n**C2 URL** \"loki-locker.one\"\n\n### Execution Options\n\nThe Config class also stores the default values for additional execution options. These\noptions can be modified through a simple text file that has to be placed in the same folder\nas the ransomware binary.\n\n**Config Option** **Description** **Default setting**\n\n**update** Display fake Windows update screen false\n\n**nostartup** Don’t copy ransomware executable to startup true\n\n**nons** Don’t scan for / encrypt network shares false\n\n**nocdrive** Don’t encrypt the C Drive true\n\n\n-----\n\n**justns** Scan for / encrypt only network shares false\n\n**nofuck** Don’t wipe the system and the MBR true\n\n**disabletask** Disable the Task Manager false\n\n**clast** Encrypt the C Drive Last false\n\n**full** Full encryption false\n\n**norun** Exit the process false\n\n**shutdown** Shutdown the system after displaying ransom note false\n\nCustom config file name “loki.txt”\n\nDestination of config file “config.Loki”\n\n### Executed Commands\n\nnetsh firewall set opmode mode=disable\n\nnetsh advfirewall set currentprofile state off\n\nbcdedit /set {default} bootstatuspolicy ignoreallfailures\n\nbcdedit /set {default} recoveryenabled no\n\nwbadmin DELETE SYSTEMSTATEBACKUP\n\nwbadmin delete catalog -quiet\n\nvssadmin delete shadows /all /quiet\n\nwmic shadowcopy delete\n\nschtasks /CREATE /SC ONLOGON /TN Loki /TR %APPDATA%\\winlogon.exe /RU\nSYSTEM /RL HIGHEST /F\n\n\n-----\n\n### Processes and Services to Kill\n\n**Processes and Services to Kill**\n\n\ndefwatch\n\nccevtmgr\n\nccsetmgr\n\nsavroam\n\nsqlserv\n\nsqlagent\n\nsqladhlp\n\nculserver\n\nrtvscan\n\nsqlbrowser\n\nsqladhlp\n\nqbidpservice\n\nquickboooks.fcs\n\nqbcfmonitorservice\n\nsqlwriter\n\nmsmdsrv\n\ntomcat6\n\nzhundongfangyu\n\nvmware-usbarbitator64\n\nvmware-converter\n\ndbsrv12\n\ndbeng8\n\nwrapper\n\nmssqlserver\n\n\nwxserver\n\nwxserverview\n\nsqlservr\n\nragui\n\nsupervise\n\nculture\n\nrtvscan\n\ndefwatch\n\nwinword\n\nqbw32\n\nqbdbmgr\n\nqbupdate\n\nqbcfmonitorservice\n\naxlbridge\n\nqbidpservice\n\nhttpd\n\nfdlauncher\n\nmsdtsrvr\n\ntomcat6\n\nzhudongfangyu\n\nvmware-usbarbitator64\n\nvmware-converter\n\ndbsrv12\n\nmsftesql\n\n\nmydesktopqos\n\nisqlplussvc\n\nxfssvccon\n\nmydesktopservice\n\nocautoupds\n\nagntsvc\n\nagntsvc\n\nagntsvc\n\nencsvc\n\nfirefoxconfig\n\ntbirdconfig\n\nocomm\n\nmysqld\n\nmysqld-nt\n\nmysqld-opt\n\ndbeng50\n\nsqbcoreservice\n\nexcel\n\ninfopath\n\nmsaccess\n\nmspub\n\nonenote\n\noutlook\n\npowerpnt\n\n\n-----\n\nsqlagent\n\nsqlbrowser\n\nsqlwriter\n\noracle\n\nocssd\n\ndbsnmp\n\nsynctime\n\nagntsvc\n\n### List of Countries (to Skip?)\n\n\nsteam\n\nthebat\n\nthebat64\n\nthunderbird\n\nvisio\n\nwinword\n\nwordpad\n\n\nmssql\n\ncontoso1\n\nmsdtc\n\nsqlserveragent\n\nvds\n\n\nThe malware defines an array of strings, which presumably contains a list of countries to\nexclude from encryption. In all the samples we’ve seen so far, this list contains only one\nentry – “Iran” – as seen in Figure 19. It seems that this functionality is not yet implemented,\nas there are no references to this array in the code. However, like the references to Iranian\nattackers and hacking tools, it could just as well be a false flag meant to misdirect our\nattention.\n\n_Figure 19 – “Iran” string_\n\n### Dropped Files\n\n**HTA file**\n\nBesides the plain text readme file, the malware also drops an HTA file like the one pictured\nin Figure 20, which displays an HTML formatted ransom note on victim’s desktop.\n\n\n-----\n\n_Figure 20 – Message displayed by the HTA file_\n\n\n-----\n\nAll your files have been encrypted by Loki locker!\n\nAll your files have been encrypted due to a security problem with your PC.\n\nIf you want to restore them, please send an email {EMAIL_1}\n\nYou have to pay for decryption in Bitcoin. The price depends on how fast you contact us.\n\nAfter payment we will send you the decryption tool.\n\nYou have to 48 hours(2 Days) To contact or paying us After that, you have to Pay Double.\n\nIn case of no answer in 24 hours (1 Day) write to this email {EMAIL_2}\n\nYour unique ID is : {UNIQUE_ID}\n\nYou only have LIMITED time to get back your files!\n\nIf timer runs out and you dont pay us, all of files will be DELETED and you hard disk will\nbe seriously DAMAGED.\n\nYou will lose some of your data on day 2 in the timer.\n\nYou can buy more time for pay. Just email us.\n\nTHIS IS NOT A JOKE! you can wait for the timer to run out,and watch deletion of your\nfiles :)\n\nWhat is our decryption guarantee?\n\nBefore paying you can send us up to 3 test files for free decryption. The total size of files\nmust be less than 2Mb (non archived), and files should not contain valuable information.\n(databases,backups, large excel sheets, etc.)\n\nAttention!\n\nDO NOT pay any money before decrypting the test files.\n\nDO NOT trust any intermediary. they wont help you and you may be victim of scam. just\nemail us, we help you in any steps.\n\nDO NOT reply to other emails. ONLY this two emails can help you.\n\nDo not rename encrypted files.\n\nDo not try to decrypt your data using third party software, it may cause permanent data\nloss.\n\nDecryption of your files with the help of third parties may cause increased price (they add\ntheir fee to our) or you can become a victim of a scam.\n\n\n-----\n\n_Figure 21: Ransom text_\n\nThe HTA code also displays a fake Windows Update box as shown in Figure 22, then\nexecutes a new ransomware process from “C:\\ProgramData\\winlogon.exe,” and tries to\naccess https[:]//picc[.]io/X8GRzsw.gif. The URL resolves to 3[.]64[.]163[.]50, but the content\nwas no longer available at the time of writing.\n\n_Figure 22 – Part of HTA code_\n\nThe HTA code creates a Google Tag Manager (gtag) data layer, as shown in Figure 23, to\nstore some metadata:\n\n_Figure 23 – Use of gtag by the HTA code_\n\n### HTA Launcher\n\nLokiLocker drops a small binary that is used to display the message included in Figure 24,\nand to launch the “info.Loki” HTA file with the use of mshta.exe. The binary is compiled on\nthe fly from an embedded C# code using a C# compiler.\n\n\n-----\n\n_Figure 24 – HTA launcher code_\n\nThis file and all other files in your computer are encrypted by Loki locker.\n\nIf you want to restore this file and rest of your files, Please send us message to this e-mail\n: <attackers_email>\n\nWrite this ID in the title of your message : <victim_id>\n\nWe will help you, in any steps.\n\nIn case of no answer in 24 hours, write us to this e-mail : <attackers_email_2>\n\n_Figure 25: MessageBox text_\n\n### Network Scanner\n\nWe noted two forms of network scanning used in conjunction with LokiLocker. The first was\nan inbuilt network scanner, which could identify network shares in order to mount and\nencrypt them.\n\nThe threat actors distributing LokiLocker have also been observed using a network scanner\nutility called “NS” that they dropped into the victim’s environment. The tool is a simple\ncommand line scanner that lists mounted and unmounted local drives and network shares,\nas shown inFigure 26.\n\n_Figure 26: NS.exe tool_\n\n\n-----\n\nNS.exe has been on VirusTotal since 2018, and it has been seen across several different\n[ransomware campaigns: Dharma,](https://blogs.blackberry.com/en/2021/09/threat-thursday-phobos-ransomware) [Phobos,](https://blogs.blackberry.com/en/2021/09/threat-thursday-phobos-ransomware) [LockBit,](https://blogs.blackberry.com/en/2021/08/blackberry-ai-powered-security-solutions-stop-lockbit-2-0-ransomware-attacks) [Revil – to name just a few. There’s not](https://blogs.blackberry.com/en/2021/05/threat-thursday-dr-revil-ransomware-strikes-again-employs-double-extortion-tactics)\nmuch intel around this tool, but it seems to be distributed on the dark net as part of or\nalongside many RaaS-based threats.\n\n### Conclusions\n\nLokiLocker ransomware is adept at causing mayhem on the user’s endpoints, and, like its\nnamesake Norse god, can prove to be vengeful and destructive if not appeased with a\n(financial) offering. LokiLocker’s use of KoiVM as a virtualizing protector for .NET\napplications is an unusual method of complicating analysis. We haven’t seen a lot of other\nthreat actors using it yet, so this may be the start of a new trend.\n\nThe inclusion of the “Iran\" code is also intriguing, as it’s not entirely clear if or how that\nsnippet was intended to be used. Normally, country lists are meant to exclude “friendly\nterritories” from potential harm. But as this code does not seem to be used, it could be a\nruse, included in hopes that researchers will pin the blame for LokiLocker’s creation on Iran.\nThere is also the fact that some of the earliest known LokiLocker affiliates go under\nusernames that can be found exclusively on Iranian hacking channels. Moreover, Iranian\ncracking tools have been used to distribute the initial samples of this ransomware. These\ndetails further muddy the waters. With tricksters and threat actors, it can be difficult to tell\nthe difference between a meaningful clue and a false flag - and one can never be sure just\nhow far down the rabbit hole the deception goes.\n\nTo protect against infections by LokiLocker and similar RaaS offerings, the best rule is to\nalways have a backup copy of your data (or your company’s data). This should be stored\noffline and unplugged, preferably, in case your backup drives get hit by LokiLocker and\nencrypted, too.\n\nWhen downloading files, including new programs and software, take care to only download\nfrom trusted, official sites, rather than third-party or peer-to-peer (pirate) sites, which often\nharbor malicious files inside seemingly innocuous or “cracked” software. The same goes for\nemail attachments – even attachments from trusted contacts should be treated with a\nhealthy dose of caution (and preferably, scanned with an up-to-date antivirus program\nbefore opening).\n\nAt the time of writing this, there is no free tool to decrypt files encrypted by LokiLocker. If\nyou are already infected with LokiLocker ransomware, the recommendation by most official\n[security authorities – such as the FBI – is not to pay the ransom. Quite apart from the fact](https://www.fbi.gov/scams-and-safety/common-scams-and-crimes/ransomware)\nthat every victim who pays the ransom perpetuates the global growth of ransomware,\nremember that you’re dealing with criminals here, and there is no guarantee that you’ll\nregain access to your data, even if you pay up. Finally, even if you’re data is restored, there\n\n\n-----\n\nis no way to know whether the threat actor planted a backdoor somewhere on your\nmachine, for easy future access. After all, people who pay one ransom can often be\npersuaded to pay another.\n\nWhen it comes to ransomware of all types, often the best thing we can do as defenders is to\nmake every effort to stay one step ahead of the threat actors, even when the journey proves\ncomplex and arduous.\n\nIf you are a victim of ransomware:\n\n[Contact your local FBI field office to request assistance, or submit a tip online.](https://www.fbi.gov/contact-us/field-offices)\nFile a report with the FBI’s [Internet Crime Complaint Center (IC3).](https://www.ic3.gov/)\nFor additional assistance, you can reach BlackBerry’s 24-hour incident response\nteam.\n\n### Appendix\n\n IOCs\n\n0684437b17ae4c28129fbb2cfe75b83cc8424ba119b9ca716ad001a284d62ead SHA256\n\n15d7342be36d20ce615647fac9c2277f46b6d19aa54f3cf3d99e49d6ce0486d0 SHA256\n\n1a4a3bfb72f3a80e4b499ecebe99f53a2b7785eace7f612b3e219409d1e1ffc7 SHA256\n\n2a7f01d924a4fc38c9fad586634eccbc28de07d97531c4a02eb6085359093a45 SHA256\n\n37702b94f9fc14a406312a2a392ad9553cf05c4b6870d94b5cf4781c02c29414 SHA256\n\n4215b5ce91deb97011cba2dd94d5bac1a745d6d55f6938b86e209eaaf8e655df SHA256\n\n52c045b57e24585467be13454c5db551987fd23bfa931a7f6ab41e6f11b8a7ec SHA256\n\n55da12a82c8e0b9fda5dbba6612627c0ee5d13d55e3bcc1df2ca9785c97caf64 SHA256\n\n5ccee068daf8a672d0e63e334e00985aa7fe56aa26b6c036d562728fdf968237 SHA256\n\n6205056cd92c75579f56bd0ce7159fae9f360d4c183beb10743330952bf22056 SHA256\n\n\n-----\n\n630e24cc1c4c95321965ad967e77e1888c48c4b1f653d800c7df08e879814787 SHA256\n\n75a5d27c77cf8515cff84d789f0e8f849b37e15b9b5f1c0801bab414061048a6 SHA256\n\n78a530f35d1cc89fc757b7661cbd57b2e9e46aeed53e2e66247db66c214a2ba0 SHA256\n\n7f23ea1e5ab087ba2c4e0ea251d680ef5190d49181efcc222702075b276d5990 SHA256\n\n8630df622ee773c3d9c934fe9d925c019b43232e8f2810ee651dcf5f3ec79893 SHA256\n\n88acae18f2cf7de7bb76784d45d9612561c8890872ea3629f0608577928745a5 SHA256\n\n8de5b9332556da8f401c5cbf3cea1dbc1e1ba277c0efa85dce8cd36310c2936c SHA256\n\n8f78555f0f62b4f280a77109dbaa4aeb5c347d1ea38b521f98c57a7acea8087e SHA256\n\n8f8cf6b8cd0c789d3f67f6291bb7c0c5416e27320631c852152a63513185941e SHA256\n\na1e30ea263ba21d656717f7f7824ecb2dc90896f55eae134afaf7691209979fd SHA256\n\nac1b326f23e17726a2b90ce8a9d29c6e44a2cb37b431e2b94734bdd17618ae26 SHA256\n\nadacbc5402326f87c76cc7737ad924ce5bd7394400ef86a48fa754af9d22da66 SHA256\n\nb01a96892f3efdaa6682078339b23d8954d571c27ee15a4ce9ef8ad6c415f06d SHA256\n\nb8996e435ba229837d13f9837f6c0451f50a5767b0d1f1bb715670c802a1d564 SHA256\n\nc3fe7ee5451108c16d7730d0bf589f70b841f3846908c1761d827a70f3462ef0 SHA256\n\nc80513aaff11a2a2914d3a674737f63fbc04c6d5de7fda6f8b6e07df580664cf SHA256\n\nc8e8599e8d86ff7daf02ea9c01d31f4cdcf829314c76b84d1b1b8a982d1299c5 SHA256\n\ncb17673f3cde6e542db3ff5facee2a01fdec462be275e9274c512038470009d1 SHA256\n\n\n-----\n\nda0a82d322502cd6d156649dee1e0a45348df0dce272b6ae2dd81af25f774c62 SHA256\n\ndf24b04f6ff0ac50fbf1c01ee02f809c1c3f9fbe9d14eefc3306b1b586bf943e SHA256\n\ne28b0a93649010788bbeda883a08254fefe3710700fc2c5a8dea94ec39402ec3 SHA256\n\nf2da3d1410c5058720a4307acf5fec7fc2b54285be9dd89eae108cce368dcde7 SHA256\n\nfe930861d5eec95a3ea1239e7a8f4182a2cf5b094ac3a48c4cb2f0ef39facd05 SHA256\n\nfffcf4be17e732aa3a5387e747290236d0f75ff3a24cb43eca793668d7772ddd SHA256\n\n4e6471c4574152d0eb2d2c608e540e505f3db41b50997d1f06c47e587a355d80 SHA256\n\n7c890018d49fe085cd8b78efd1f921cc01936c190284a50e3c2a0b36917c9e10 SHA256\n\n9ab1694c978f11521c6bca73d40256e4b433f3279792db8ae1fecc5e0ad174c9 SHA256\n\nebc955f12b0a2b588efca6de0af144dd00e33ead80185a887bf7c97329b28ec6 SHA256\n\n1e6ecdb54224eea50476be03d5a48083deae15301f26ba3519e0c0a5eb77b1f4 SHA256\n\n268c2924d45c0c7be9b67b85f03ddf5df97f2bc8963faefe1bec244e0cb95225 SHA256\n\n36b5fe49cd81393f8c60c70c941a1e6aaf181775b0614f1c4a142f38c7af1a81 SHA256\n\n42088f0e3e9c70b7d1d238f7e3b03a3ca177748ba2568adba9104bbed2827734 SHA256\n\n6d1ecc48069eae14a831af05d29d2d25c0fa9f7c62f1f51c44d0d70fb014a590 SHA256\n\n84d9ef8cb92d57b178cce655f3f7808c6f5cf42f15c468f741b253f37ffc39fc SHA256\n\nbb382bbc0756832748b33f0d7f7ec218d570afa031937259e69237df4945d074 SHA256\n\nca478cb334360bef31d394438cba1449dfe0b8d751cc8eb679f09e12e5068d1a SHA256\n\n\n-----\n\ne9e80fd3fe71d133609f5bc75081b13123e4f9a5ed1920050727955185f3ce52 SHA256\n\nfe40e5c6244c7e0a256689b6ea0881998fef897cece79a2add3ba8f7a23f4f2b SHA256\n\n8cb1e9c99ad716a2541697a6d4ada32433b56e11dfe6aa1cb7c4fbc72b4bad2e SHA256\n\nc1e8c720da2297aa4432364441b341ec85e6f7f571cf6348ffdc51f4ae96418a SHA256\n\nloki-locker[.]one C2 domain\n\n194.226.139[.]3 C2 IP\n\n91.223.82[.]6 C2 IP\n\nSoftware\\Loki\\public Reg value\n\nSoftware\\Loki\\full Reg value\n\nSoftware\\Loki\\timer Reg value\n\nSoftware\\Microsoft\\CurrentVersion\\Run\\Michael Gillespie Reg value\n\n%ProgramData%\\winlogon.exe Executable\n\n%ProgramData%\\config.Loki Config file\n\n<malware_path>\\loki.txt Config file\n\n<malware_path>\\logs.txt Log file\n\nRestore-My-Files.txt Readme\nfile\n\nInfo.Loki HTA file\n\nCpriv.Loki Data file\n\n\n-----\n\nLoki/1.0 User\nAgent\n\n.Loki File\nextension\n\n.Adair File\nextension\n\n.Boresh File\nextension\n\n.Rainman File\nextension\n\n.Spyro File\nextension\n\n### Known Affiliate Names\n\nAbolSpyro\n\nAdairFile\n\nAhmad_C4\n\nDarwin\n\nFardinyps\n\nFuck3r_life\n\nHelpmezeus\n\nJohn\n\nKingbo\n\nLokiBlack\n\nMindnear\n\nMiracle\n\n\n-----\n\nMiveh_sabzikosher\n\nRoxlock\n\nShadow\n\nShreAzm0\n\nSirer\n\ndarkages\n\ndarkkiller\n\narkwave\n\nghost\n\nh33shmat\n\nhijack\n\njhnvjfygbjdhf\n\nmjid4MB\n\nmr_noobx\n\nnumbervpss\n\noptimus982\n\npf9922\n\nqazw\n\nsidewinder\n\n### Known Email Addresses\n\nBlackSpyro[at]mailfence[.]com\n\nBlackSpyro[at]tutanota[.]com\n\nDecNow[at]MsgSafe[.]io\n\nDecNow[at]TutaMail[.]Com\n\n\n-----\n\nDecoder[at]firemail[.]cc\n\nDecryptfiles[at]goat[.]si\n\nFilemanager[at]mailfence[.]com\n\nHelpingdecode[at]tutanota[.]com\n\nMiiracle11[at]yandex[.]com\n\nMiracle11[at]keemail[.]me\n\nPayForDecrypting[at]gmail[.]com\n\nPayForDecrypting[at]outlook[.]com\n\nRdpmanager[at]airmail[.]cc\n\nRoxLock[at]keemail[.]me\n\nRoxLock[at]mailfence[.]com\n\nShadow0[at]mailfence[.]com\n\nShadow11[at]mailfence[.]com\n\nSkydancerf5[at]cock[.]li\n\nSapphire01[at]keemail[.]me\n\nSapphire02[at]mailfence[.]com\n\nUnlockpls.dr01[at]protonmail[.]com\n\nUnlockpls.dr01[at]yahoo[.]com\n\nadairfile[at]mailfence[.]com\n\nadairfile[at]tutanota[.]com\n\nadmindec[at]rape[.]lol\n\nanoniran[at]protonmail[.]com\n\nbadlamadec[at]msgsafe[.]io\n\nd4rkw4ve[at]tutanota[.]com\n\ndark4wave[at]yandex[.]com\n\n\n-----\n\ndark.killer[at]mailfence[.]com\n\ndarkkiller[at]cock[.]li\n\ndecryptyourfiles[at]firemail[.]cc\n\ndecsup[at]tuta[.]io\n\nfalcon9[at]cyberfear[.]com\n\nfilemanager[at]cock[.]li\n\njesushelp01[at]techmail[.]info\n\njesushelp02[at]mailfence[.]com\n\nkingbo[at]tutanota[.]com\n\nkingboo[at]mailfence[.]com\n\nkingvps1[at]mailfence[.]com\n\nkingvps[at]mailfence[.]com\n\nlockirswsuppurt[at]mailfence[.]com\n\nlockteam[at]cock[.]li\n\nlockteam[at]keemail[.]me\n\nloki.black[at]mailfence[.]com\n\nloki.black[at]msgsafe[.]io\n\nloki.help[at]bingzone[.]net\n\nloki.help[at]mailfence[.]com\n\nloki.support01[at]techmail[.]info\n\nloki.support02[at]mailfence[.]com\n\nloki01[at]keemail[.]me\n\nloki02[at]mailfence[.]com\n\nlordpdx[at]tutanota[.]com\n\nmrcrypt2[at]mailfence[.]com\n\n\n-----\n\nmrcrypt[at]msgsafe[.]io\n\nmrrobot13[at]cock[.]li\n\npf2536[at]protonmail[.]com\n\npf2536[at]tutanota[.]com\n\npuffcrypt[at]gmail[.]com\n\nrain.man13[at]mailfence[.]com\n\nrain_man13[at]keemail[.]me\n\nskydancerf5[at]tutanota[.]com\n\ntran9ino00[at]protonmail[.]com\n\nwannayourdata[at]gmail[.]com\n\nxmagic22[at]tutanota[.]com\n\nxmaster22[at]tutanota[.]com\n\n## About The BlackBerry Research & Intelligence Team\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats,\nproviding intelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-16 - New Ransomware Family Identified- LokiLocker RaaS Targets Windows Systems.pdf"
    ],
    "report_names": [
        "2022-03-16 - New Ransomware Family Identified- LokiLocker RaaS Targets Windows Systems.pdf"
    ],
    "threat_actors": [
        {
            "id": "6b9fc913-06c6-4432-8c58-86a3ac614564",
            "created_at": "2022-10-25T16:07:24.185236Z",
            "updated_at": "2025-03-27T02:02:10.135195Z",
            "deleted_at": null,
            "main_name": "SideWinder",
            "aliases": [
                "APT-C-17",
                "APT-Q-39",
                "BabyElephant",
                "GroupA21",
                "HN2",
                "Hardcore Nationalist",
                "Rattlesnake",
                "Razor Tiger",
                "SideWinder",
                "T-APT-04"
            ],
            "source_name": "ETDA:SideWinder",
            "tools": [
                "BroStealer",
                "Capriccio RAT",
                "callCam"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "173f1641-36e3-4bce-9834-c5372468b4f7",
            "created_at": "2022-10-25T15:50:23.349637Z",
            "updated_at": "2025-03-27T02:00:55.450857Z",
            "deleted_at": null,
            "main_name": "Sidewinder",
            "aliases": [
                "Sidewinder",
                "T-APT-04"
            ],
            "source_name": "MITRE:Sidewinder",
            "tools": [
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d0c0a5ea-3066-42a5-846c-b13527f64a3e",
            "created_at": "2023-01-06T13:46:39.080551Z",
            "updated_at": "2025-03-27T02:00:02.992026Z",
            "deleted_at": null,
            "main_name": "RAZOR TIGER",
            "aliases": [
                "SideWinder",
                "APT-C-17",
                "T-APT-04"
            ],
            "source_name": "MISPGALAXY:RAZOR TIGER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535861,
    "ts_updated_at": 1743041711,
    "ts_creation_date": 1653780203,
    "ts_modification_date": 1653780203,
    "files": {
        "pdf": "https://archive.orkl.eu/12ef334bd4fc277c1712391c8d14387afababaf1.pdf",
        "text": "https://archive.orkl.eu/12ef334bd4fc277c1712391c8d14387afababaf1.txt",
        "img": "https://archive.orkl.eu/12ef334bd4fc277c1712391c8d14387afababaf1.jpg"
    }
}