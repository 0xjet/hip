{
    "id": "2c7421d5-c979-42f1-8f9e-c20bb759dfd6",
    "created_at": "2023-01-12T14:59:17.887324Z",
    "updated_at": "2025-03-27T02:16:55.627345Z",
    "deleted_at": null,
    "sha1_hash": "2c0373a3e9f626d12348299feb0b677643502739",
    "title": "2021-08-23 - Kimsuky Espionage Campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T15:53:41Z",
    "file_modification_date": "2022-05-28T15:53:41Z",
    "file_size": 1551370,
    "plain_text": "# Kimsuky Espionage Campaign\n\n**inquest.net/blog/2021/08/23/kimsuky-espionage-campaign**\n\nA few days ago, we found an exciting Javascript file masquerading as a PDF that, upon activation, will drop and display a PDF (to maintain the\nruse) as well as drop an executable. The document is a lure for the Korean Foreign Ministry document and its newsletter. The same attack was\n[reported earlier by Malwarebytes in June.](https://blog.malwarebytes.com/threat-intelligence/2021/06/kimsuky-apt-continues-to-target-south-korean-government-using-appleseed-backdoor/)\n\nApparently, the threat actor behind this campaign is still using this infrastructure and infection technique.\n\nFile Type Javascript\n\nSha 256 [20eff877aeff0afaa8a5d29fe272bdd61e49779b9e308c4a202ad868a901a5cd](https://www.virustotal.com/gui/file/20eff877aeff0afaa8a5d29fe272bdd61e49779b9e308c4a202ad868a901a5cd/detection)\n\nSize 27.31 MB (28634023 bytes)\n\nImage 1: Document images when opened\n\n\n-----\n\nImage 2: Virustotal\n\nThe document shows shallow detection on the VT service. At the beginning of the check, the detection showed 3/58.\n\nWe found this very interesting, so we decided to delve deeper into the study of its technical composition.\n\nImage\n\n3:\nOpening the document in a Hex editor, we see that it is filled with data that is encoded in Base64. In order to continue our study, it is necessary\nto extract this data to see what it contains. Also, in the tail of the file we find the executable code, which will run when opened.\n\n\n-----\n\nImage 4: Embedded PowerShell code\n\nTo ease research efforts, we present the previously mentioned executable code in a more human-readable format.\n\nImage\n\n5: PowerShell Script\nIn Image 5, you can see that the program will launch Adobe Reader, decode the Base64 payload, and run it in stealth mode. But to understand\nwhat it launches, we need to extract the payload from the script.\n\nAs a reminder, the file size is 27.31 MB, which is quite large, not a small effort for manual data retrieval. Therefore, the easiest way is to write a\nsimple Python script to find Base64 encoded blocks and decode them.\n\n\n-----\n\nencoded data blocks\n\n7: Base64 data\n\n\nImage 6: Base64\n\nImage\n\n\n-----\n\n```\ndef openfile (s):\n  sys.stderr.write(s + \"\\n\")\nsys.stderr.write(\"Usage: %s<infile><outfile>\\n\" % sys.argv[0])\nsys.exit(1)\ndef base64Dec(dump,result):\n  result = base64.b64decode(dump)\n  return(result)\nif __name__ == '__main__':\nif len(sys.argv) != 3:\n  openfile(\"invalid argument count\")\noutfile = sys.argv.pop()\ninfile = sys.argv.pop()\nfile = open(infile,\"rb\")\ndump = bytearray(file.read())\nresult = bytearray(len(dump))\nopendata = base64Dec(dump,result)\nnew = open(outfile,\"wb\")\nnew.write(opendata)\nnew.close()\nfile.close()\n\n```\nWe can extract the data and decode it with a small Python script; as a result, we were able to retrieve two files from the encoded string.\n\nSha 256 [3251c02ff0fc90dccd79b94fb2064fb3d7f870c69192ac1f10ad136a43c1ccea](https://www.virustotal.com/gui/file/3251c02ff0fc90dccd79b94fb2064fb3d7f870c69192ac1f10ad136a43c1ccea/detection)\n\nFile Type PDF\n\nSize 20.23 MB (21214792 bytes)\n\nFile 1\nIf we take a close look at the first file (3251c02ff0fc90dccd79b94fb2064fb3d7f870c69192ac1f10ad136a43c1ccea), it is clear that it is\nlegitimate and does not represent any malware load. It was uploaded to VirusTotal on May 27 of this year. Obviously, it is used here as a lure\nto hide malicious actions at runtime.\n\nThe second file we received is also data encoded behind two layers of Base64.\n\nImage\n\n8: The second data block is Base64 encoded twice\n\nSha 256 [0a4f2cff4d4613c08b39c9f18253af0fd356697368eecddf7c0fa560386377e6](https://www.virustotal.com/gui/file/0a4f2cff4d4613c08b39c9f18253af0fd356697368eecddf7c0fa560386377e6/detection)\n\nFile Type DLL x64\n\nSize 190.00 KB (194560 bytes)\n\nFile 2\nExecutable library packed with UPX. But unpacking this sample is not very difficult. And so we got the payload.\n\nSha 256 [ae50cf4339ff2f2b3a50cf8e8027b818b18a0582e143e842bf41fdb00e0bfba5](https://www.virustotal.com/gui/file/ae50cf4339ff2f2b3a50cf8e8027b818b18a0582e143e842bf41fdb00e0bfba5/detection)\n\nFile Type DLL x64\n\nSize 474.50 KB (485888 bytes)\n\n\n-----\n\ne u pac ed\nThe executable is a Kimsuky espionage tool.\n\nImage 8: Extensions for\n\ndocument search\nThe malicious document looks for documents(.hwp, .pdf, .doc, .xls, .ppt, .txt) in all directories, including USB drives, with the aim of stealing\nthem.\n\n\\REGISTRY\\USER\\1077083310-4456979867-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n\\REGISTRY\\USER\\1077083310-4456979867-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n\\REGISTRY\\USER\\S-1-5-21-2455352368-1077083310-28791684831000\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\ESTsoftAutoUpdate = \"regsvr32.exe /s\n\\\"C:\\\\ProgramData\\\\Software\\\\ESTsoft\\\\Common\\\\ESTCommon.dll\\\"\"\n\nThe program creates the following registry keys. Thus, after each start of the system, the library will be restarted.\n\nImage\n\n9: Keylogger Artifacts\nWe see the unique strings that the keylogger uses to record the data entered by the user. We find a lot of encrypted strings in the executable\nfile.\n\nImage 10: Encrypted\n\nstrings\nWe managed to decipher all these lines. Here are some of the most interesting ones.\n\n'Win%d.%d.%dx64'\n\n'temp'\n\n'.bat'\n\n'\\ \\ t\\ \\ d l \"% \"\\ \\ if i t \"% \" t t\\ \\ d l \"%% f0\"'\n\n\n-----\n\n%d %0 d %0 d_%0 d %0 d %0 d %03d\n\n'kernel32.dll'\n\n'SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System'\n\n'ConsentPromptBehaviorAdmin'\n\n'PromptOnSecureDesktop'\n\n'SeDebugPrivilege'\n'\"'\n\n'\\r1'\n\n'regsvr32.exe'\n\n'.zip'\n\n'.enc'\n\n'.tmp'\n\n'list.fdb'\n\n'KeyboardMonitor'\n\n'ScreenMonitor'\n\n'FolderMonitor'\n\n'UsbMonitor'\n\n'0602000000A4000052534131000400000100010005DA37C671C00B2A04759D5A143C015F4D0B38F0F83D6E4E19B309D570ADB6EEA7CACB\n\n1B76A0C361E7D7798E6248722DC0349400857F68C5B21474138F0D3EE0929AB1EBEA9EBB057E88D0CACB41D4A6029F459AD7B8A8D180\n\n7DAD7B50F44B43DA8F1326E64C53DAA51807A02751E2'\n\n'0702000000A400005253413200040000010001006D4582142BA47753E19FF39DBF232B7BAEE5141CC59AB328CA25EC21BEF955FE091F90\n\n'%PDF-1.7..4 0 obj'\n\n'User32.dll'\n\n'SetProcessDPIAware'\n\n'2.0'\n\nb'%s/?m=a&p1=%s&p2=%s-%s-v%s.%d'\n\n'cache'\n\n'list.ldb'\n\n'GetProcAddress'\n\n'Downloads'\n\n'Documents'\n\n'AppData\\\\Local\\\\Microsoft\\\\Windows\\\\INetCache\\\\IE'\n\n'flags'\n\n'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'\n\n\"Powershell.exe start-process regsvr32.exe -argumentlist \\'\n\nAppData\\\\Local\\\\Microsoft\\\\Windows\n\nLoadLibraryA\n\nLoadLibraryW\n\n\n-----\n\nC eate ocess\n\nGetTempFileNameW\n\n'GetTempPathW'\n\n'CopyFileW'\n\n'MoveFileExW'\n\n'CreateFileW'\n\n'DeleteFileW'\n\n'Process32FirstW'\n\n'Process32NextW'\n\n'CreateMutexW'\n\n'GetModuleHandleW'\n\n'GetStartupInfoW'\n\n'OpenMutexW'\n\n'FindFirstFileW'\n\n'FindNextFileW'\n\n'GetWindowsDirectoryW'\n\n'GetVolumeInformationW'\n\n'GetModuleFileNameA'\n\n'CreateProcessA'\n\n'GetTempFileNameA'\n\n'GetTempPathA'\n\n'CopyFileA'\n\n'URLDownloadToFileA'\n\n'URLDownloadToFileW'\n\n'urlmon.dll'\n\n'InternetWriteFile'\n\n'InternetCloseHandle'\n\n'InternetReadFile'\n\n'InternetSetOptionExA'\n\n'HttpSendRequestA'\n\n'AdjustTokenPrivileges'\n\n'texts.letterpaper.press'\n\n'/'\n\n'Software\\\\ESTsoft\\\\Common'\n\n'S_Regsvr32'\n\n'SpyRegsvr32-20210505162735'\n\n\"powershell.exe start-process regsvr32.exe -argumentlist \\'/s %s\\' -verb runas\"\n\n\n-----\n\nS Co o d\n\n'Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce'\n\n'ESTsoftAutoUpdate'\n\n**Debug lines:**\n\nminkernel\\\\crts\\\\ucrt\\\\inc\\\\corecrt_internal_strtox.h\n\n**IoCs**\n\nhxxp://texts.letterpaper[.]press\n\n**Javascript files**\n\n20eff877aeff0afaa8a5d29fe272bdd61e49779b9e308c4a202ad868a901a5cd\ne5bd835a7f26ca450770fd61effe22a88f05f12bd61238481b42b6b8d2e8cc3b\na30afeea0bb774b975c0f80273200272e0bc34e3d93caed70dc7356fc156ffc3\n0a4f2cff4d4613c08b39c9f18253af0fd356697368eecddf7c0fa560386377e6\nfa4d05e42778581d931f07bb213389f8e885f3c779b9b465ce177dd8750065e2\n\n**Unpacked library. Kimsuky Spy.**\n\n0A4f2cff4d4613c08b39c9f18253af0fd356697368eecddf7c0fa560386377e6\nfa4d05e42778581d931f07bb213389f8e885f3c779b9b465ce177dd8750065e2\n\n**Unpacked library. Kimsuky Spy.**\n\nae50cf4339ff2f2b3a50cf8e8027b818b18a0582e143e842bf41fdb00e0bfba5\n\nTags\n\n[malware-analysis threat-hunting](https://inquest.net/taxonomy/term/4)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-23 - Kimsuky Espionage Campaign.pdf"
    ],
    "report_names": [
        "2021-08-23 - Kimsuky Espionage Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "527e04ee-7f5f-49aa-8653-f893b43730bd",
            "created_at": "2022-10-25T16:07:24.512541Z",
            "updated_at": "2025-03-27T02:02:10.266333Z",
            "deleted_at": null,
            "main_name": "Moses Staff",
            "aliases": [
                "Abraham's Ax",
                "Cobalt Sapling",
                "DEV-0500",
                "Marigold Sandstorm",
                "Vengeful Kitten",
                "White Dev 95"
            ],
            "source_name": "ETDA:Moses Staff",
            "tools": [
                "DCSrv",
                "DCrSrv",
                "PyDCrypt",
                "StrifeWater",
                "StrifeWater RAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "dc78f675-b309-431d-8160-b8dcff037d4f",
            "created_at": "2024-05-01T02:03:08.142224Z",
            "updated_at": "2025-03-27T02:05:17.417972Z",
            "deleted_at": null,
            "main_name": "NICKEL KIMBALL",
            "aliases": [
                "Black Banshee ",
                "Crooked Pisces ",
                "Emerald Sleet ",
                "Kimsuky ",
                "Opal Sleet ",
                "SharpTongue ",
                "TA427 ",
                "THALLIUM ",
                "Velvet Chollima ",
                "APT43 "
            ],
            "source_name": "Secureworks:NICKEL KIMBALL",
            "tools": [
                " KONNI",
                " KimJongRAT",
                " Kimsuky",
                "BabyShark"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "760f2827-1718-4eed-8234-4027c1346145",
            "created_at": "2023-01-06T13:46:38.670947Z",
            "updated_at": "2025-03-27T02:00:02.888195Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Thallium",
                "G0086",
                "APT43",
                "Springtail",
                "Sparkling Pisces",
                "Velvet Chollima",
                "Black Banshee",
                "Operation Stolen Pencil",
                "Emerald Sleet",
                "THALLIUM"
            ],
            "source_name": "MISPGALAXY:Kimsuky",
            "tools": [
                "RevClient",
                "xrat",
                "QUASARRAT",
                "RDP Wrapper",
                "TightVNC",
                "BabyShark"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bef06c82-0f51-44ba-8451-049cd4ad8a52",
            "created_at": "2023-01-06T13:46:39.325635Z",
            "updated_at": "2025-03-27T02:00:03.05159Z",
            "deleted_at": null,
            "main_name": "MosesStaff",
            "aliases": [
                "Moses Staff",
                "Marigold Sandstorm",
                "DEV-0500"
            ],
            "source_name": "MISPGALAXY:MosesStaff",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c4d0e4e1-5ad3-4455-8291-ce72a1e09e46",
            "created_at": "2022-10-27T08:27:13.055675Z",
            "updated_at": "2025-03-27T02:00:55.458634Z",
            "deleted_at": null,
            "main_name": "Moses Staff",
            "aliases": [
                "Moses Staff",
                "DEV-0500",
                "Marigold Sandstorm"
            ],
            "source_name": "MITRE:Moses Staff",
            "tools": [
                "PyDCrypt",
                "PsExec",
                "DCSrv",
                "StrifeWater"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "71a1e16c-3ba6-4193-be62-be53527817bc",
            "created_at": "2022-10-25T16:07:23.753455Z",
            "updated_at": "2025-03-27T02:02:09.963016Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "APT 43",
                "Black Banshee",
                "Emerald Sleet",
                "ITG16",
                "KTA082",
                "Kimsuky",
                "Larva-24005",
                "Operation Baby Coin",
                "Operation Covert Stalker",
                "Operation DEEP#DRIVE",
                "Operation DEEP#GOSU",
                "Operation Kabar Cobra",
                "Operation Mystery Baby",
                "Operation Red Salt",
                "Operation Smoke Screen",
                "Operation Stealth Power",
                "Operation Stolen Pencil",
                "SharpTongue",
                "Sparkling Pisces",
                "Springtail",
                "TA406",
                "TA427",
                "Thallium",
                "UAT-5394",
                "Velvet Chollima"
            ],
            "source_name": "ETDA:Kimsuky",
            "tools": [
                "AngryRebel",
                "AppleSeed",
                "BITTERSWEET",
                "BabyShark",
                "BoBoStealer",
                "CSPY Downloader",
                "Farfli",
                "FlowerPower",
                "Gh0st RAT",
                "Ghost RAT",
                "Gold Dragon",
                "GoldDragon",
                "GoldStamp",
                "JamBog",
                "KGH Spyware Suite",
                "KGH_SPY",
                "KPortScan",
                "KimJongRAT",
                "Kimsuky",
                "LATEOP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Lovexxx",
                "MailPassView",
                "Mechanical",
                "Mimikatz",
                "MoonPeak",
                "Moudour",
                "MyDogs",
                "Mydoor",
                "Network Password Recovery",
                "PCRat",
                "ProcDump",
                "PsExec",
                "ReconShark",
                "Remote Desktop PassView",
                "SHARPEXT",
                "SWEETDROP",
                "SmallTiger",
                "SniffPass",
                "TODDLERSHARK",
                "TRANSLATEXT",
                "Troll Stealer",
                "TrollAgent",
                "VENOMBITE",
                "WebBrowserPassView",
                "xRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535557,
    "ts_updated_at": 1743041815,
    "ts_creation_date": 1653753221,
    "ts_modification_date": 1653753221,
    "files": {
        "pdf": "https://archive.orkl.eu/2c0373a3e9f626d12348299feb0b677643502739.pdf",
        "text": "https://archive.orkl.eu/2c0373a3e9f626d12348299feb0b677643502739.txt",
        "img": "https://archive.orkl.eu/2c0373a3e9f626d12348299feb0b677643502739.jpg"
    }
}