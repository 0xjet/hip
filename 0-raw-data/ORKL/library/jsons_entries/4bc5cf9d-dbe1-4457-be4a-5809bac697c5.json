{
    "id": "4bc5cf9d-dbe1-4457-be4a-5809bac697c5",
    "created_at": "2023-01-12T15:02:50.406321Z",
    "updated_at": "2025-03-27T02:05:33.084849Z",
    "deleted_at": null,
    "sha1_hash": "e94cf4fcfbeac8384583028ead28e80938b90f6a",
    "title": "2019-04-05 - Spammed PNG file hides LokiBot",
    "authors": "",
    "file_creation_date": "2022-08-18T04:01:40Z",
    "file_modification_date": "2022-08-18T04:01:40Z",
    "file_size": 896016,
    "plain_text": "# Spammed PNG file hides LokiBot\n\n**[trustwave.com/en-us/resources/blogs/spiderlabs-blog/spammed-png-file-hides-lokibot/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/spammed-png-file-hides-lokibot/)**\n\n_Contributing authors: Phil Hay, Rodel Mendrez_\n\nRecently we came across a spam message from our traps that looked truly odd when\nviewed from our Secure Email Gateway console, as below:\n\n\n-----\n\nNeedless to say, there are several suspicious elements here:\n\nThe attachment has a .zipx extension\nThe gateway identified the message as a PNG image\nThe image itself resembles a ‘JPG’ icon.\nThe subject line is typical of those we see associated with malware.\n\nSo what’s going on here? Let’s examine the file.\n\nThe header of the file indicates that it truly is a PNG.\n\nThe image file can be opened with an image viewer:\n\n\n-----\n\nHowever, the .zipx extension suggests something else is going on here. Let’s look further\ninto the file.\n\nIn a PNG file, IEND is supposed to mark the end of the image and is supposed to appear\nlast. But in this file there is a bunch of data after IEND. If you look at the snippet below, you\ncan see a PK header marker indicating some kind of zip archive, and a filename called RFQ\n-5600005870.exe. The PNG format specification appears to allow for such extraneous\ndata, it is up to the application to decide to try and interpret or ignore such data.\n\nSo, let’s try unzipping it. WinZip and 7-Zip gave errors upon trying to unzip the file, but\nWinRAR had no such problem, happily extracting the file RFQ -5600005870.exe.\nInterestingly, if you alter the extension to anything other than zip or zipx, 7-Zip will also\nhappily extract the .exe file. It seems that some decompression utilities will traverse the\nwhole file looking for suitable stuff to unpack.\n\nHere’s how the message could have appeared to a user who had WinRAR - clicking the\nattachment would open up WinRAR for extracting the payload.\n\n\n-----\n\nAnalyzing the extracted .exe file indicates that it consists of multiple stages, with the first\nstage executable compiled with Visual Basic.\n\nThis first stage function is to decrypt the main payload into the memory and execute it using\na common technique called Process Hollowing, where a new process is created in a\nsuspended state, its memory is unmapped and the malicious code replaces it.\n\nDumping the decrypted new process from memory, we end up with the main payload, as\nbelow.\n\n\n-----\n\nSome interesting strings in the malware body start to give a hint of what this malware does.\n\nFurther analysis of the sample indicates that it is the well-known LokiBot information\nstealing Trojan. LokiBot is a multi-purpose modular trojan that attempts to steal passwords\nand other information from browsers, mail, FTP clients and other applications, as well as a\nraft of other functions. LokiBot is freely available in the underground markets where it can\nbe bought quite cheaply - $300 can get you some password stealing capability.\n\n\n-----\n\nLokiBot’s availability means it is widely used, and over the past year we have been seeing\nmany spam messages with attached LokiBots, but never before one where the payload is\nhidden inside a PNG file.\n\nThe attacker likely used the PNG format to hide the executable from inspection by the email\nscanning gateway. The giveaway is the .zipx extension. If a user happened to have\nWinRAR installed, and received such a message, then clicking on the attachment would fire\nup WinRAR for the payload exe to be extracted by the user. The upshot is we may all want\nto inspect those PNG files a little closer.\n\n**IOCs:**\n\n.zipx attachment\n\nSHA256: 3654011653e7289620041cb831bf93e6c480815feede72320cde94f20ce7f185\n\nExtracted executable\nSHA256: c9ddcf7d0cd026cdeac9586515b4d591c1ca63ee9c009cd00b198178e5e84f03\n\nCnC of LokiBot\nhxxp://slimcase[.]ml/evans/fre.php\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-04-05 - Spammed PNG file hides LokiBot.pdf"
    ],
    "report_names": [
        "2019-04-05 - Spammed PNG file hides LokiBot.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535770,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1660795300,
    "ts_modification_date": 1660795300,
    "files": {
        "pdf": "https://archive.orkl.eu/e94cf4fcfbeac8384583028ead28e80938b90f6a.pdf",
        "text": "https://archive.orkl.eu/e94cf4fcfbeac8384583028ead28e80938b90f6a.txt",
        "img": "https://archive.orkl.eu/e94cf4fcfbeac8384583028ead28e80938b90f6a.jpg"
    }
}