{
    "id": "5a1c2669-b261-4955-8a0f-8bdb99580b7b",
    "created_at": "2022-10-25T16:48:23.7942Z",
    "updated_at": "2025-03-27T02:08:40.816295Z",
    "deleted_at": null,
    "sha1_hash": "1397cd7b11ebd6527ce6b71e5d37716717fdf4cd",
    "title": "",
    "authors": "",
    "file_creation_date": "2022-03-02T02:20:35Z",
    "file_modification_date": "2022-03-02T02:20:35Z",
    "file_size": 1009239,
    "plain_text": "# Websites Hosting Cracks Spread Malware, Adware\n\n**[trendmicro.com/en_us/research/21/c/websites-hosting-cracks-spread-malware-adware.html](https://www.trendmicro.com/en_us/research/21/c/websites-hosting-cracks-spread-malware-adware.html)**\n\nMarch 23, 2021\n\nMalware\n\nWe investigated pay-per-install (PPI) websites spreading multiple malware and adware,\nincluding CopperStealer and LNKR.\n\nBy: Jaromir Horejsi, Joseph C Chen\nMarch 23, 2021\nRead time: 18 min (4969 words)\n\n_Updated on 4/12/2021 2:45PM PHT: Additional detections in indicators of_\n_compromise (IoCs) list._\n\n_Updated on 3/24/2021 2:00PM PHT: Additional detections in indicators of_\n_compromise (IoCs) list._\n\nWe investigated a number of websites with cracks and pirated software that start an\n[infection chain to multiple pieces of malware and adware, including CopperStealer and](https://otx.alienvault.com/pulse/5e615fc5ffd9165d535e9637/)\nLNKR adware. The malicious samples are usually distributed via pay-per-install (PPI)\nnetworks. Our analysis showed that the samples of CopperStealer that we found are\ncapable of scanning infected systems for specific browser credentials and cookies. They\nalso terminate the entire routine if the systems’ settings are in Chinese, run in the\nsandbox, or are analyzed in a debugger. In addition, they are also capable of installing\nmalicious browser extensions and stealing stored Facebook and Google credentials for\nmalicious advertising.\n\nInfection vector\n\n\n-----\n\nFigure 1. Infection vector\n\nThese infections — the use of which is a common technique among cybercriminals —\n[were unknowingly initiated by the victims when they visited warez (also known as](https://www.pcmag.com/encyclopedia/term/warez)\ncrackz, toolz, appz, and gamez) websites, which often redirect users to another site with\nmalware distribution. Some of these websites contain links to the requested files, but\nusually they use a very small font. As a result, these are often overlooked by website\nvisitors. Additionally, there are misleading “Download” buttons or other similar prompts\nfor action. Upon selecting any of these buttons, a user unknowingly starts a redirection\nchain that leads to the download of malware.\n\n\n-----\n\nFigure 2. A warez website with a misleading layout\n\nFor each tool, a visitor will see the description, screenshots, and buttons in red and blue,\nincluding a link in green. This link opens another page with more misleading buttons\nthat initiate the malicious redirection chain. If a user wants to download the application,\ntool, or crack, they have to choose one of the “Server” links in the middle of the webpage.\nNot all of the sites that we examined contained useful content at the time of writing.\nHowever, we did note the ironic mention of cybersecurity vendors as a ploy to add\ncredibility to the app.\n\nFigure 3. A link redirecting users to\nanother webpage which may unwittingly\n\nlead to downloading malware\n\n\n-----\n\nFigure 4. A user is prompted to choose a server for the\n\ndownload to start.\n\nFigure 5. Redirecting users to malicious pages\n\nRedirections and PPI schemes\n\nAfter a user selects the “Download” button, one of several possible redirection chains\nstarts. The redirection chain that begins after a user selects “Download” then leads to the\narchive download. Most of the redirection chain top-level domains (TLDs) use .xyz. The\nredirection scripts are usually implemented in PHP and have several parameters like\nuser identification (id) or webpage title (q). This redirection chain seems to belong to\none of two PPI networks, boostads and installusd.\n\nFigure 6. A sample analysis of the first redirection\n\nThe downloaded compressed archive contains a password-protected ZIP archive and a\ntext file with applicable passwords. The archive contains the executable payload.\n\nThe redirection chain is not constant. We\nobserved that the domain names vary based on\nthe platform used and the hard-coded user ID\nparameter. The downloaded payloads that we Figure 7. Downloading the compressed\n[have observed as of writing are CopperStealer,](https://otx.alienvault.com/pulse/6024581f505c1a86cc48e22b) file shows the archive and a list of\n[DanaBot (detected by Trend Micro as](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/cybercrime-and-digital-threats/danabot-banking-trojan-found-targeting-european-countries) passwords.\n[TROJ_BANLOAD.THFOAAH), and Glupteba](https://www.trendmicro.com/en_us/research/20/i/cross-platform-modular-glupteba-malware-uses-managex.html)\n(detected by Trend Micro as Trojan.Win32.GLUPTEBA.WLDR). In the following\n\n\n-----\n\nsections, we discuss our findings on CopperStealer, its modules and the browser plug-ins\nthat it installs. It is important to note that one of the installed browser plug-ins is called\nLNKR, which is an adware injection platform.\n\nCopperStealer and LNKR\n\n[CopperStealer was seen at large stealing browser cookies and credentials from victims at](https://www.proofpoint.com/us/daily-ruleset-update-summary-20191114)\nthe end of 2019. We found that CopperStealer had many similarities with a spyware\n[campaign in April 2019, while a recent report attributes this malware to another](https://labs.bitdefender.com/2019/04/inside-scranos-a-cross-platform-rootkit-enabled-spyware-operation/)\ncampaign targeting social media platforms. However, we believe that these are different\ncampaigns that use similar tools to steal victims’ credentials.\n\nAfter dissecting the samples of CopperStealer that we found, our analysis showed that\ninfected systems had malicious browser extensions (we identify these in their respective\n[sections and quick descriptions). One of the malicious extensions is LNKR](https://github.com/Zenexer/lnkr)\n[(CRX/book_helper), which has been identified in connection with a phishing kit. This is](https://twitter.com/malwrhunterteam/status/1253662725219254275)\nthe first time that we have seen both malware distributed at large. In this section, we\nshare the analysis of CopperStealer and LNKR. Notably, both of them have sophisticated\ninfection approaches and tactics that they use to profit from their victims. We also show\nhow these malware have been distributed with the PPI networks.\n\n**First Stage**\n\nThe .exe file that was unpacked from the compressed file appears to be a partially\noverwritten legitimate executable. The entry point is overwritten by a custom shellcode\nand an encrypted payload (second stage) is appended to the overlay at the end of the file.\nIn the following case, it is a Nullsoft Scriptable Install System (NSIS) installer, though\nany other regular executable could be partially overwritten in a similar way. In the case\nof opening the overwritten NSIS file (for example in 7-Zip), the executable shows the\ncontent of the installer. This happens because the “NullsoftInst” keyword and the\noriginal installation files are still intact.\n\nHowever, instead of the original\nNSIS installer stub, the custom\nshellcode is executed. It then\ndecrypts and executes the\nembedded payload. The shellcode\n\nFigure 8. The overwritten NSIS installer, however, tools\n\nreads a DWORD value\n\nlike 7Zip are still showing the content of the original\n\n(0x160FF3) from a DOS stub at\n\ninstaller.\n\naddress 0x04 (0x44 from the\nbeginning of EXE file) and uses this value (0x160FF3) as an offset of the encrypted\npayload within the EXE file. The decimal value of the offset “0x160FF3 = 1445875” will\nbe used as an XOR key for decrypting the second stage.\n\n\n-----\n\nFigure 9. An encrypted executable file, which is the second stage\n\nFigure 10. A modified DOS stub. The address 0005 contains offset and decryption key\n\n(f30f16).\n\n**Second stage**\n\nThe second stage begins with the drop of the clean installer gdiview.msi\n(DBD9F2128F0B92B21EF99A1D7A0F93F14EBE475DBA436D8B1562677821B918A1),\nwhich is a decoy installer. The decoy starts its installation process to cover for the\nmalware’s installation. It uses a domain generation algorithm to generate the commandand-control (C&C) server name. The algorithm uses “changenewsys” string followed by\nthe current date, then MD5 hash is computed and, finally, the middle 16 characters of\nthe MD5 (changenewsys%04d%02d%02d) hash are the C&C name, after which it\nappends .xyz to form the C&C domain. For example:\n\ndate = 20210202\n\nchangenewsys%04d%02d%02d = changenewsys20210202\n\nMD5(changenewsys20210202) = 65cac0f17c89afb3a5873a7acdcd76df\n\nmiddle part of MD5 = 7c89afb3a5873a7a.xyz\n\nIt then proceeds to report the installation progress to the C&C server to\n<C&C>/fine/send. It also reports some information, such as the seller’s ID, infected\nmachine’s GUID, and the malware version installed, among others.\n\nFigure 11. The installation’s progress is reported to the C&C server; information in the\n\nreport includes file type, malware version, seller’s ID, and price.\n\n\n-----\n\nAfter sending, it performs several anti-debugging, anti-virtual machine (VM), antianalysis, and system locale (Chinese locale 2052) checks. If the checks fail, it deletes\nitself and stops installation. Otherwise, it reports the installation progress again to the\nC&C server - <C&C>/info_old/w. Debugged messages are encrypted with data\nencryption standard (DES) ciphers key=’rundll32’, IV=’explorer’, and mode=’CBC’, then\nURL-safe Base64 encoded. It proceeds to extract the DLL file (which is the third stage)\nfrom the embedded .7Zip compressed blob and runs its exports named Hello001 and\nHello002.\n\n**Third stage**\n\nThis is the main module that implements three export functions. Two of these export\nfunctions are called by the installer in the second stage. The third export function was\nunused during the time of our research.\n\n**_Export function Hello001_**\n\nThis exported function steals Facebook cookies and saved logins from major web\nbrowsers that are installed in the infected system, namely Google Chrome, Firefox,\nOpera, Microsoft Edge, Internet Explorer, Baidu, and Yandex\n\nIn the case of Firefox, it runs a new Firefox process and injects a custom DLL file to\nsteal the stored data.\n[For Edge, it decrypts and runs the embedded EdgeCookiesView tool from Nirsoft.](https://www.nirsoft.net/utils/edge_cookies_view.html)\nEdgeCookies View is a legitimate tool for Windows that displays the cookies stored\nin newer versions of Edge and IE11.\n\nWhen cookies are available and a user is logged into a social media account, the stealer\nthen posts various requests to Graph API to obtain additional information, namely the\nfollowing:\n\nFacebook user ID cookie\nInstagram user ID cookie\nNumber of Instagram fans\nNumber of Facebook friends\nFacebook payment information\nCredit cards\nLinked PayPal accounts\nOwned business advertising accounts\nFacebook pages where the user could be an administrator\nFacebook Messenger cookie\nDetails when the Facebook page was created, among others.\n\nStolen data is then uploaded to <C&C>/info_old/i for Instagram and\n<C&C>/info_old/e for Facebook.\n\n\n-----\n\nThe exported function is also capable of stealing Google cookies, especially Google Ads\ncookies, Google payment information, and saved autofill credentials. It uploads stolen\ndata from these sources to <C&C>/info_old/g. To acquire such information, this\nexported function needs to steal cookies and cross-site request forgery (XSRF) tokens\nfirst, after which it will send requests to Google Accounts and ID Administration (GAIA,\nvia GaiaInfoService.Get). It then proceeds to acquire the details of the current user\n(UserByGaiaService.Get) along with a list of services that the user has access to\n(UserCustomerAccessService.List).\n\nStealing social media and Google account information allows the cybercriminals to take\nover these accounts and abuse them to conduct false advertising campaigns, as\n[described here and here.](https://www.ijinshan.com/info/202102231719.shtml)\n\nThe stealer also queries <C&C>/info_old/r to find out if there are other cookies that it\ncan steal. The response is encrypted with the same DES and Base64 algorithm with\ncharacters /=+ replaced with _~- . An example of a response might be\nAYYYLksPHjUDgRYoYmagnA~~, which decrypts to [\"amazon.\"] and is then uploaded\nto <C&C>/info_old/a.\n\nAfter stealing all the possible browser information, the stealer installs file-system filter\nFsFilter32 or FsFilter64 rootkit to block access to browser-related files (cookie.db,\ncookies.sqlite, Login Data, Cookies, WebCacheV01) and processes (explorer.exe,\nfirefox.exe, chrome.exe, opera.exe, Yandex.exe, baidu.exe, MicrosoftEdge.exe,\nMicrosoftEdgeCP.exe, rundll32.exe).\n\n[Afterward, it drops the embedded MiniThunderPlatform and loads a xldl.dll file that](https://github.com/cryzlasm/ThunderOpenSDK)\nruns MiniThunderPlatform.exe with command-line parameters StartTP XL_CreateTask.\nSimultaneously, it reads and decrypts <C&C>/info_old/ddd, which is a JavaScript\nObject Notation (JSON) that contains the link with another file to load and execute.\nAfter execution, a report is sent to <C&C>/info_old/du. Further analysis showed that\n[the downloaded file is an Inno installer that contains the Smokeloader/Dofoil malware](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/cybercrime-and-digital-threats/smokeloader-malware-spreading-via-fake-meltdown-spectre-patches)\nloader.\n\nFigure 12. A decrypted /info_old/odd file with instructions to\n\ndownload SmokeLoader/Dofoil\n\n**_Export function Hello002_**\n\n\n-----\n\nThis exported function is a browser extension installer. Particularly, it installs CRX\nextensions on Chrome and Opera (resource CRX), and XPI extension on Firefox\n(resource FF). All these extensions are stored in the executable’s resources. Resource\nFRIENDS — used for scanning the browser if the user is logged into Facebook — is\n[present but not used. Resource FF is a legitimate Greasemonkey 4.9 extension for](https://www.greasespot.net/)\ncustomizing webpages, while resource CRX is an advertisement injector.\n\nThe installation of these malicious extensions is done by first killing\nthe browser process (if it is running) and then extracting the\nextension into the default profile:\n\n\n%USERPROFILE%\\AppData\\Local\\Google\\Chrome\\User\nData\\Default\\Extensions\\ for Chrome and\n\n\nFigure 13.\n\nBrowser\nextensions that\nare available for\n\ninstallation by\nthe third stage\n\n\n%USERPROFILE%\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\xxxx.defaultxxxx\\extensions for Firefox.\n\nIt then modifies the “Secure Preferences” / “extensions.json” settings file:\n\n%USERPROFILE%\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Secure\nPreferences for Chrome and\n%USERPROFILE%\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\xxxx.default-xxxx\\ for\nFirefox.\n\n_CRX extension_\n\nAs of writing, the Chrome extension was disabled as shown by default. To enable such an\nextension, it must be allow-listed in the\nHKLM\\SOFTWARE\\Policies\\Google\\Chrome\\ExtensionInstallWhitelist registry key.\nThis extension is responsible for injecting advertisements into websites and is analyzed\nin more detail in its own section.\n\nFigure 14. The malicious CRX extension for Chrome\n\n_FF extension_\n\nSimilarly, in the case of Firefox, the GreaseMonkey extension is not compatible with the\ncurrent Firefox version at the time of writing. Moreover, the pefs.js configuration files\n\n\n-----\n\n[contain references to Firefox China edition add-ons. We are unsure what the purpose of](https://addons.firefox.com.cn/chinaedition/addons/updates.json)\nthis is.\n\nFigure 15. The malicious FF extension for Firefox\n\n_Facebook FRIENDS extension_\n\nWe found a malicious browser extension FRIENDS/helper, a Facebook spammer that\nposts on victims’ walls, though we did not observe it as being used during our analysis.\nThis extension checks if a user is logged in to Facebook through the browser. If the\nc_user (the user who is currently logged in) cookie is present, then the extension parses\n[the ads’ manager account settings or management page from where it extracts the access](https://www.facebook.com/ads/manager/account_settings)\ntoken.\n\nThis token is then used to get information about the\n[user’s friends using Facebook graph API. Afterward, the](https://graph.facebook.com/me/friends?access_token=)\nextension queries the C&C about the tasks that it should\nperform. The tasks consist of uploading and publishing\na single photo (info.url), the number of friends who will Figure 16. Searching access\nbe tagged on that photo (info.limit), and the description tokens in Facebook Ads\nthat will be attached to the photo (info.message). It Management page\nproceeds to report to the C&C about the number of\ntagged friends and the total number of friends that the victim has. This occurs\ncontinuously until every friend is tagged in the photos (info.photo_num).\n\n\n**_Export function Hello003_**\n\nThis exported function runs a YouTube module (DLL\nfile) for liking and subscribing to videos. First,\nrundll32.exe process is created in suspended mode. This\nis followed by the extraction of a 32-bit or 64-bit module\nfrom the main module (from the third stage), which is\ninjected into the newly created suspended process.\n\n\nFigure 17. The Facebook\nspammer’s parameters as\n\nreceived from C&C\n\n\nThis function then proceeds to kill the Chrome browser and copies the default profile\ndirectory (User Data) into %APPDATA%\\Local\\Temp. Afterward, it installs a custom\nCRX plug-in (malicious browser extension: CRX/Youtube video) into the directory with\na copied profile. It then starts a new Chrome process with the command line specified as\n“User Data” directory with the window positioned out of the screen. It then opens a URL\nwith a video in that window. The Chrome extension provides the locations of the “Like”\nand “Subscribe” buttons, and the YouTube DLL module clicks them. Finally, the Chrome\nprocess is killed and the process with the injected YouTube DLL module shuts down.\n\n\n-----\n\nFigure 18. The malicious browser extension named “Youtube\n\nvideo”\n\nFigure 19. Opening a URL with a video\n\nAt the time when we were studying this, the given URL was no longer active. However,\nfurther analysis showed that the executable code and Chrome plug-in worked with the\nYouTube webpage.\n\nThe YouTube DLL module reads the title of the Chrome window and parses the x,y,w,h\ncoordinates from it. If these values are found, then the module moves the cursor to the\ncenter of the box that is defined by the coordinates and selects that.\n\nFigure 20. The YouTube module parsing for coordinates in the Chrome\n\nwindow title\n\nThe Chrome window title is set by the Chrome browser plug-in. The plug-in first queries\nthe document to get three selectors: one for choosing the playing video box, another for\nchoosing the “Subscribe” button, and a last to select the “Like” button. The following is a\nsample of what it looks like if we run the selector for the “Subscribe” button in a browser\nconsole.\n\n\n-----\n\nFigure 21. The module moves the cursor to select the\n\ncoordinates identified.\n\nFigure 22. Querying the selector for the button in a browser’s console\n\nThe extension then extracts the position of all three objects, stores them in a JSON\nobject, and adds a “do” attribute to specify if a click should be made in the middle of the\nobject. This JSON object is then assigned to the window’s title.\n\nFigure 23. A Chrome window title containing positions of a video box and the\n\n“Subscribe” and “Like” buttons\n\nBrowser advertisement injection plug-ins\n\nWe analyzed the ad injection browser extension that implement a simple script. We\nfound that the activity loads the main advertisement injection script (named\n<uniqueID>.js) from the script domain C&C server and appends it to the end of the\ndocument body node. Further analysis revealed that the main advertisement script\n[appeared to be a new version of LNKR ad injector.](https://www.netskope.com/blog/ad-injector-dulls-chromes-luster)\n\nFigure 24. A new version of LNKR\n\n\n-----\n\n**Ad injector configuration**\nWe found that the behavior of the ad injection script is configured in\nmonetizationsConfig. It starts as an empty object and later. various “configuration\nblocks” are loaded into it. Each configuration block has a five-character hexadecimal\nname (key) with the following attributes:\n\n\n02aed is the configuration block ID, while\ntype=platform means that there is an additional script\nhosted on the C&C that gets downloaded and executed\nonly if the particular configuration block ID is present\nin the configuration file. The user ID is made up of\nrandom numbers from one to 100. The attribute\n“coverage” found toward the middle of the\nconfiguration block identifies which user IDs the\nconfiguration block should be applied to. The URL is a\nlink where the additional JavaScript will be injected,\n[while “limit” is the time value (unixtimestamp) in the](https://www.unixtimestamp.com/)\nfuture that identifies until when the configuration block\nis applied.\n\n\nFigure 25. Configuration block\n\nattributes\n\n\nFurther down the block, type can be external wherein a script will be loaded to the\nwebsite from the external URL. The platform pertains to a script module loaded from\nthe C&C (script domain), or a plug-in wherein a script loaded to the website is already\nembedded in the main ad injection script.\n\n**C&C communication**\n\nWe found a number of communication activities between the browser extension and the\nscript domain C&C server, especially for reading and setting the subsequent\nconfigurations and reporting various metrics and statistics.\n\nThe configuration requests include:\n\n|Request|Description|\n|---|---|\n|/optout/set/limit|Updates the time limit until the configuration block is applied|\n|/optout/set/strtm|Sets start time when the victim started with the script injections|\n|/optout/set/lat|Updates last action time, or the last time of the response from /optout/get|\n|/optout/set/lt|Sets life time, wherein the value is obtained from /optout/get|\n\n\n-----\n\n|/optout/set/userid|Randomly generates and sets user ID from one to 100|\n|---|---|\n|/optout/get|Opts out filtering, wherein it reads JSON object from the script domain C&C|\n\n\nTable 1. Some of the configuration requests between the C&C and extension\n\nThe request to /optout/get returns a JSON object with the following parameters:\n\nSome parameters are already defined in Table 1. Newly\nmentioned parameters are defined in Table 2.\n\ntargeting Targets user (0=no or 1=yes)\n\nlcFlag Owns monetization click flag (seen as\n“true” or “false” to determine the keys to\nbe loaded)\n\noptout Lists configuration block names (keys) Figure 26. Parameters received\nthat should be ignored (not loaded)\n\nby /optout/get request\n\nTable 2. Some of the parameters returned by\n\n/optout/get request\n\nWe found that the preceding parameters decide, in real time, which configuration blocks\nshould be skipped (or opted out), depending on the configuration block name (key) and\nthe parameters obtained in /optout/get request. For example, if lcFlag (internally named\nas ownMonetizationsClickFlag) is set to “true,” then only one of several hard-coded\nconfiguration names (keys) are loaded. Meanwhile, the configuration keys that are not\nmentioned in the part of the main script responsible for processing lcFlag are skipped\n(opted out).\n\nAfter processing all the platform blocks, the parameters that are not opted out will be\nloaded from /ext/<uniqueID>.js?sid=<source ID>&title=<title>&&blocks[]=<platform\nblock keys>. The purpose of platform blocks is to enable additional functionalities based\non /optout/get results and the domain currently loaded in the browser window. This\nfunctionality is provided by additional scripts hosted directly on the script domain C&C.\n\nIn the scenario that we observed during our research, /ext/<uniqueID>.js request\n[returns another script. This script loads an obfuscated BetterJsPop library with](https://github.com/nicolauns/BetterJsPop/blob/master/BetterJsPop.html)\ncapabilities of creating pop-under, pop-up, and tab-under ads. The configuration here\n[shows that an ad URL will appear under in a new tab.](https://www.marketingterms.com/dictionary/pop_under_ad/)\n\n|targeting|Targets user (0=no or 1=yes)|\n|---|---|\n|lcFlag|Owns monetization click flag (seen as “true” or “false” to determine the keys to be loaded)|\n|optout|Lists configuration block names (keys) that should be ignored (not loaded)|\n\n\n-----\n\nFigure 27. An ad URL that opens in a new tab\n\nIn the next request, the /ext/ scripts queries the ad link where the user should be\nredirected to from from /ext/__utm.gif?a=…&ajax. The following request is embedded\nin parameter “a” of the GET request and encrypted with XOR with a decimal key of 77. If\nthe response for the request is “true”, it returns a JSON object with a “url” key\ncontaining the first URL of the redirection chain.\n\n/trgt/ is a request for targeting,\nspecifically whether a plug-in should be\ninjected into the webpage or not. In our\ncase, a response from the request to\n/trgt/ lists plug-ins to be loaded in the\n“rows” key.\n\n**Metrics**\n\nMetrics and statistics are reported after\neach action, whether an action is Figure 28. A request for the ad link where the user\nsuccessful or not. Metric requests use an is redirected\ninvisible tracking image element with\nzero dimension, while the URL address\ncontains various metric parameters. The report\nID can contain one of many IDs, including\nAmazon purchases and search parameters\n(AMZN_SEARCH, AMZN_ADD_CART,\nAMZN_BUY_NOW). It can also filter search\nengines (CB_MNTZ_FILTER_SERCHNGN),\nloaded advertisements (BANNER_LOAD),\nmonetization of adult sites\n(CB_APS_ERR_STORAGE, CB_APS_OPEN),\nand Google commercial unit blocks\n\nFigure 29. A request for targeting\n\n(GGL_COM_BLOCK), just to name a few.\n\nFigure 30. An invisible tracking image element with zero dimension\n\n\n-----\n\nExternal ad injection scripts\nAs mentioned in the previous section, the configuration blocks can be one of three types:\nexternal, platform, or plug-in. In this section, we discuss our findings on a few external\nad injection scripts.\n\n**Script 1: Pre-rendering links**\n\nThis script pre-renders selected links on the webpage. If a user selects any of these preselected links, the script performs a “click” on the affiliated URL, then performs a “click”\non the original link after a while.\n\nPre-rendering a website consists of the following:\n\n1. Attaching a click handler (addEventListener) to handle a user’s clicks on links;\n[2. If the user selects anchor element A (link) or AREA element and if special keys like](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a)\n\nCTRL, SHIFT, or ALT are not selected, then\n\na) It further considers if the link is writable (that is, if it is not an image, not an excluded\ndomain, or not an inner link within the same domain)\n\nb) If the special link attributes are not set (for example, lnkr_redirecting, data-ad-flag),\n\nthen the act of tapping or selecting a link will be processed\n\nSelecting the link means the following:\n\n1. A request is made for an additional script to be downloaded and executed. The\n\nformat of the requested URL’s additional parameters are stub=<random number>,\nout=< encoded original URL link>.\n2. The server returns the script associated with the original URL link.\n3. The downloaded script is inserted before the HEAD tag, wherein this script is\n\nloaded to the document as soon as it is downloaded.\n4. After three seconds, a redirection is performed, wherein\n\na) lnkr_redirecting attribute is set and for about one second removed to and from the\nlink that a victim originally selected.\n\nb) The original link is selected.\n\n**Script 2: Frame link injector**\n\nThis creates an empty (about:blank) iframe that is located out of the screen (-999px,\n-999px). The script injector then creates a link within the newly created iframe and then\nselects this.\n\n\n-----\n\nFigure 31. The creation of an empty iframe located out of the\n\nscreen (top) and the creation of a link (bottom)\n\n**Script 3: Loader of another Yontoo-based ad injection framework**\n\nThis is an additional ad injection framework consisting of two stages of loaders,\nconfiguration files, and many additional scripts (items/platforms).\n\n[Based on previous documentation, this seems to be an ad injection framework that is](https://stackoverflow.com/questions/9197918/why-is-cloudfront-loading-scripts-in-my-web-app-i-dont-use-it)\nlikely based on a previous version of a Yontoo ad injector. The execution starts with the\nfirst-stage loader (l.js?pid=<partner ID>&ext=) based on a four-digit partner ID value. It\nthen loads the second-stage loader from /loaders/<partner ID>/l.js?pid=<partner\nID>&ext=&zoneid=<zoneid>. Advertising zones are places in webpage layouts where ad\n[content is displayed.](https://documentation.revive-adserver.com/display/DOCS/Creating+a+Zone)\n\nThe second-stage loader, which might vary for different partner IDs, embeds two JSON\nobjects with various configuration item (or platform) values. The first object lists country\ncodes (or ALL for all countries, with two letters for identifying a specific country) and the\ncorresponding configuration items (platforms). The second object is a subset of\nconfiguration items from the first object where additional scripts (named <item ID>.js)\nare downloaded and injected into websites.\n\nThe subset of item IDs could include either a JavaScript code (see\nthe following ybeb1 case) or an empty string, which instructs the\nsecond-stage loader to download additional injection scripts from\n/i/items/<item ID>/js/<item ID>.js.\n\nMeanwhile, the second stage loader also loads a “permission file”\nfrom /loaders/icp and domain-specific rules for the currently\nloaded domain from /js/<reverse(hex(domainName))>/r.js.\n\n**Array/Item/Key** **Description**\n\nFigure 32. A JSON\n\nt Lists the permission types object with\n\nconfiguration item\n\nvalues applicable\n\na Permission activate list\n\nfor ALL countries\n\n|Array/Item/Key|Description|\n|---|---|\n|t|Lists the permission types|\n|a|Permission activate list|\n\n\n-----\n\nFigure 33. A JSON object with\n\npermission in b deactivates an item (platform).\n\nconfiguration item IDs;\nadditional injection scripts\n\nd List of item (platform) IDs and their assignedwith these IDs will be later\nC&C domains downloaded from C&C.\n\ndau Not an item ID, but means “daily pinging.”\nSecond-stage loader pings either hourly or\ndaily to this C&C server.\n\ns Subdomain\n\nTable 3. Keys used in permission file or domain-specific rules\n\nFigure 34. Downloaded “permission file”\n\nDomain-specific rules once again contain an array of permission types (key t) and a list\nof possible subdomains (key s) with indices to the array of permission types t. Based on\neach domain permission types, item (platform) IDs are either activated or not, which\ncould lead to downloading and injecting additional JS scripts\n\n|w|Lists indices from array t of the activated permissions. At least one present permission in w activates the item (platform).|\n|---|---|\n|b|Permission blocklist. At least one present Figure permission in b deactivates an item (platform). con additi|\n|d|List of item (platform) IDs and their assignedwith t C&C domains dow|\n|dau|Not an item ID, but means “daily pinging.” Second-stage loader pings either hourly or daily to this C&C server.|\n|s|Subdomain|\n\n\n-----\n\nFigure 35. Downloaded domain-specific rules\n\nSome of the permissions are listed here. Although this list is not complete and we did not\ndecode the meaning of all the permissions included, we can at least guess the relation of\nsome of them to various advertisement networks.\n\n“thrive_rvz1\", \"thrive_rvz2\", \"adult\", \"adult_block\", \"bank\", \"internal\", \"legal\",\n\"pops_only\", \"provider\", \"technical\", \"toolbar\", \"google\", \"kinner\", \"yhs_search\",\n\"block_pops\", \"aim_video\", \"apn_whitelist\", \"thrive_video_whitelist\", \"thrive_whitelist\",\n\"ref\", \"thrive_video_blacklist\", \"ye174\", \"amzgpv\", \"block_display\", \"video_footer\",\n\"w0206\", “adnative_whitelist”\n\n**Permission** **Likely advertisement network**\n\nthrive thriveadvertisingco.com\n\naim aimadvertising.com\n\nrvz revizer.com\n\napn aws.amazon.com/partners/apn-marketing-central/\n\nadnative adnativeagency.com\n\namzgpv Amazon Prime member\n\nTable 4. Permission codes and their likely advertisement networks\n\nObserved behaviors\n\nHere we list some of the behaviors that can result from what the ad injection frameworks\ncan do, just to name a few:\n\nSubscribe to Facebook groups\nExfiltrate various search engines’ search field inputs\nRedirect these searches to the custom search engines\nDisplay their own monetized search results\n\n|Permission|Likely advertisement network|\n|---|---|\n|thrive|thriveadvertisingco.com|\n|aim|aimadvertising.com|\n|rvz|revizer.com|\n|apn|aws.amazon.com/partners/apn-marketing-central/|\n|adnative|adnativeagency.com|\n|amzgpv|Amazon Prime member|\n\n\n-----\n\nInject iframes with advertisement banners\nPerform a chain of redirections before reaching the originally entered user’s URL\n\nReplacing ad exchange IDs means that the revenue for displaying the ads do not go to\nthe original publisher (website creator) but to the adware operator. The following code\nshows the youradexchange.com parameter replacing and appending Yandex Market\nPartner ID (&clid=<value>) to monetize Yandex searches.\n\nFigure 36. An ad parameter replacing (top) and appending an ID for search monetization (bottom)\n\nHere is a sample of Amazon searches that are exfiltrated every time a victim enters\nsomething in the search box. The keywords are exflitrated inside “custom” variables.\n\nFigure 37. Exfiltrating keywords from the search box\n\nHere we found a redirection before booking.com and its typosquatting domain names.\n\nFigure 38. Redirection before loading booking.com and its typosquating domains\n\nHere we show a custom search engine that is used for hijacking searches from Yahoo,\ngo.mail.ru, and rambler searches to a custom search engine.\n\n\n-----\n\nFigure 39. Custom search engine used for search hijacking\n\nWe also found a transparent element capturing the act of tapping or selecting while\noverlaying on the entire screen. This example shows the Google homepage with a\ntransparent element over the whole window area. Hovering over the overlaying object\nusing the browser’s console highlights the transparent element (seen in blue).\n\nFigure 40. A transparent element overlay on the whole window\n\nConclusionFrom a cybercriminal’s perspective, the distribution of pirated software and\ncracks is a viable way of spreading malicious software. The stealer presents interesting\ncapabilities, considering the main goal of acquiring various cookies and taking control of\nadvertisement accounts. This grants the threat actor the ability to spread advertisements\nthat bring their malware and adware to more potential victims. It also promotes\ncybercriminals’ other “products” from which they can also profit. Of course, stolen\ncookies from browsers give them sensitive personal information that they can further\nmonetize illegally, especially in the underground.\n\n\n-----\n\nHeavy use of browser plug-ins allows threat actors to inject ads and modify websites\nbehaviors. As they replace legitimate advertiser IDs with theirs, the returns for clicks, ad\nviews, searches, and downloads redirect the supposed profits of the legitimate parties,\nthereby resulting to bigger losses for them. This also adds another channel of\nmonetization to this campaign. As of writing, we are unsure if the PPI websites and\nnetworks are aware of these cybercriminal campaigns involving their sites.\n\nHere are some best practices to prevent these kinds of threats:\n\nAvoid searching for or downloading applications and pirated software using\ndubious third-party websites. Look for legitimate tools and programs from official\napp stores, especially those stores with a lot of user-created reviews.\nIf possible, avoid storing sensitive information such as banking or access\ncredentials in browsers or platforms for auto-filling forms. Whenever possible,\nregularly delete the browser cache of machines that you often use.\n\n[Some of the findings here were similarly previously published.](https://www.proofpoint.com/us/blog/threat-insight/now-you-see-it-now-you-dont-copperstealer-performs-widespread-theft)\n\nTrend Micro solutions\n\nUsers can protect their systems from these kinds of threats with a multilayered\nprotection system to block and detect known and unknown threats. Since dubious\nwebsites and fraudsters attempt to deceive users by making seemingly harmless,\ngenuine-looking apps, mitigate risks by choosing to download applications and software\nfrom official websites and legitimate marketplaces.\n\nIndicators of Compromise (IOCs)\n\n[To see the list of IoCs for this report, please follow this link. Due to the number of](https://documents.trendmicro.com/assets/pdf/appendix-IoCs-websites-hosting-cracks-spread-malware-adware.pdf)\nsamples for analysis and related indicators, we will be continuously updating this list.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.03.23.CopperStealer/Websites%20Hosting%20Cracks%20Spread%20Malware%2C%20Adware.pdf"
    ],
    "report_names": [
        "Websites Hosting Cracks Spread Malware, Adware"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1646187635,
    "ts_modification_date": 1646187635,
    "files": {
        "pdf": "https://archive.orkl.eu/1397cd7b11ebd6527ce6b71e5d37716717fdf4cd.pdf",
        "text": "https://archive.orkl.eu/1397cd7b11ebd6527ce6b71e5d37716717fdf4cd.txt",
        "img": "https://archive.orkl.eu/1397cd7b11ebd6527ce6b71e5d37716717fdf4cd.jpg"
    }
}