{
    "id": "01e779d6-0e16-4aec-849a-2f881423c662",
    "created_at": "2024-10-25T02:06:17.988773Z",
    "updated_at": "2025-03-27T02:15:35.666769Z",
    "deleted_at": null,
    "sha1_hash": "d3f9c773389f17b868a23739bed521300cea3bae",
    "title": "",
    "authors": "",
    "file_creation_date": "2024-09-30T14:58:38Z",
    "file_modification_date": "2024-09-30T15:00:17Z",
    "file_size": 2385779,
    "plain_text": "##### ESET Research white papers\n\n# Cyberespionage  the Gamaredon way:\n\n## Analysis of toolset used to spy on Ukraine in 2022 and 2023\n\n##### 26 September, 2024 \n\n\n-----\n\n### TABLE OF CONTENTS\n\nEXECUTIVE SUMMARY ................................................................................................................................................ 1\n\nOVERVIEW ..................................................................................................................................................................... 2\n\nVictimology ......................................................................................................................................................................... 4\n\nAttribution .......................................................................................................................................................................... 4\n\nTECHNICAL ANALYSIS ................................................................................................................................................. 4\n\nInitial access ....................................................................................................................................................................... 4\n\nToolset ................................................................................................................................................................................. 7\n\nObfuscation ...................................................................................................................................................................... 34\n\nNETWORK INFRASTRUCTURE ................................................................................................................................. 38\n\nBypassing domain-based blocking............................................................................................................................. 38\n\nCONCLUSION .............................................................................................................................................................. 38\n\nIOCS ............................................................................................................................................................................... 39\n\nFiles ..................................................................................................................................................................................... 39\n\nNetwork ............................................................................................................................................................................. 43\n\nMITRE ATT&CK TECHNIQUES .................................................................................................................................. 47\n\nAuthor:\n\nZoltán Rusnák\n\n\n-----\n\n### EXECUTIVE SUMMARY\n\nIn this white paper, we provide a comprehensive technical analysis of the toolset used by the\n\nGamaredon advanced persistent threat (APT) group to conduct its cyberespionage activities in 2022\n[and 2023, or since the war in Ukraine escalated in February 2022. This Russia-aligned group](https://www.welivesecurity.com/2020/06/11/gamaredon-group-grows-its-game/) has been\n\nactive since at least 2013 and is currently the most active threat actor in Ukraine, focusing mainly on\n[the country’s governmental institutions, as evidenced over time by ESET telemetry, in several reports](https://www.rnbo.gov.ua/en/Diialnist/4823.html)\n\nfrom CERT-UA, and from other official Ukrainian bodies.\n\n[Gamaredon has been attributed by the Security Service of Ukraine (SSU)](https://ssu.gov.ua/en/novyny/sbu-vstanovyla-khakeriv-fsb-yaki-zdiisnyly-ponad-5-tys-kiberatak-na-derzhavni-orhany-ukrainy) to the 18[th] Center of Information\n[Security of the FSB, operating out of occupied Crimea. We believe this group to be collaborating with](https://www.welivesecurity.com/2020/06/18/digging-up-invisimole-hidden-arsenal/)\n\nanother threat actor that we discovered and named InvisiMole.\n\nWe analyzed thousands of samples and share details about Gamaredon’s ever-changing obfuscation\n\ntricks and numerous techniques used for bypassing domain-based blocking. These tactics pose a\nsignificant challenge to tracking efforts, as they make it harder for systems to automatically detect and\n\nblock the group’s tools. Nevertheless, during our research, we managed to identify and understand\nthese tactics, and keep track of Gamaredon’s activities.\n\nKey findings:\n\n- The majority of Gamaredon’s attacks are directed against Ukrainian governmental institutions,\n\nbut we also saw a few attempts to compromise targets in several NATO countries, namely\nBulgaria, Latvia, Lithuania, and Poland.\n\n- To compromise new victims, Gamaredon conducts spearphishing campaigns and uses its custom\nmalware to weaponize the victim’s Word documents and USB drives that are expected to be\n\nshared among potential new victims.\n\n- Gamaredon’s toolset mainly includes custom-made malware written in PowerShell, VBScript, and\n\nC, but also a few open-source tools.\n\n- We analyzed thousands of samples and provide a description of the most actively used tools\n\nincluding their evolution, and a few examples of typical obfuscation applied to them.\n\n- We share our observations about Gamaredon’s network infrastructure and its methods of\n\nbypassing domain-based blocking.\n\n### OVERVIEW\n\nSince July 2021, we have been periodically documenting the most relevant Gamaredon activities in\n\n[public ESET APT Activity Reports, and in private ESET Threat Intelligence Reports available to selected](https://www.eset.com/int/business/services/threat-intelligence/)\ncustomers. In this white paper, we provide an in-depth analysis of the tools that are the most\n\nprevalent, or interesting in some other way, in order to shed more light on the relationships that exist\namong the tools and to help create a bigger picture of the tools’ ecosystem.\n\nFor many years, since its first appearance around 2013, Gamaredon focused all its resources exclusively\n\non compromising targets in Ukraine. To our surprise, in April 2022 and February 2023, we observed two\nspearphishing campaigns in which the group targeted governmental institutions in several NATO\n\ncountries. To our knowledge, no successful breaches occurred, and Gamaredon has since returned its\nfocus solely to Ukraine.\n\nAccording to our long-term observations, Gamaredon, unlike most APT groups, does not try to be\nstealthy and remain hidden as long as possible by using novel techniques when conducting\n\ncyberespionage operations, but rather the operators are reckless and do not mind being discovered by\ndefenders during their operations. Even though they do not care so much about being noisy, they\n\napparently put in a lot of effort to avoid being blocked by security products and try very hard to\nmaintain access to compromised systems. Typically, Gamaredon attempts to preserve its access by\n\n\n-----\n\ndeploying multiple simple downloaders or backdoors simultaneously. The lack of sophistication of\n\nGamaredon tools is compensated by frequent updates and use of regularly changing obfuscation.\n\nIn the past, Gamaredon used numerous downloaders and various tools to move laterally within\n\ninfiltrated systems. Its ultimate payload was a file stealer, whose main goal was to look for files with\nspecific file extensions and exfiltrate them to the command and control (C&C) server. These tools were\n\nwritten mostly in C, VBScript, and .NET, and many of them were deployed packed in self-extracting\n(SFX) archives.\n\nIn 2022, the trend slowly started to shift towards the use of VBScript and PowerShell in tandem, and\n\nGamaredon almost completely ditched the use of SFX archives. During 2023, Gamaredon notably\nimproved its cyberespionage capabilities and developed several new tools in PowerShell, with a focus\n\non stealing valuable data, for example from web applications running inside internet browsers, email\nclients, and instant messaging applications such as Signal and Telegram. The timeline of new tools\n\ndeployed in 2022 and 2023 is shown in Figure 1. Except for PteroScreen, all of the tools shown in that\nfigure were discovered by ESET Research.\n\nFigure 1. Timeline of new tools added to Gamaredon’s arsenal\n\n\n-----\n\nIn May 2022, we noticed that Gamaredon started investing lots of time into testing and applying a\n\nvariety of techniques to thwart domain-based blocking. More specifically, Gamaredon stopped relying\nsolely on registering dozens of new C&C domains and started leveraging services provided by third\n\nparties like Telegram and Cloudflare.\n\n#### Victimology\n\nGamaredon mainly focuses on compromising various governmental institutions in Ukraine. However,\n\nwe have seen two spearphishing campaigns, one in April 2022 and the other in February 2023, targeting\nseveral NATO countries, namely Bulgaria, Latvia, Lithuania, and Poland.\n\nBetween November 1[st], 2022 and December 31[st], 2023, we observed more than a thousand unique\n\nmachines in Ukraine that were attacked by Gamaredon. The seven-day moving average of daily\nadditions is visualized in Figure 2.\n\nFigure 2. Seven-day moving average of unique machines attacked in Ukraine\n\n#### Attribution\n\nWe attribute with high confidence all activities mentioned in this white paper to Gamaredon, based on\n\nour ongoing tracking of its actions and our file and network-based detections. Unique obfuscation\ntypes used in Gamaredon’s tools, which we have partially documented in the Obfuscation section, and\n\nits consistent targeting further support our attribution. Moreover, most of our findings align with\n_reports published independently by CERT-UA._\n\n### TECHNICAL ANALYSIS\n\n#### Initial access\n\nTo compromise new targets, Gamaredon relies on three distinct methods of initial access:\n\nspearphishing emails, weaponized Word documents, and weaponized USB drives. The group directly\nconducts spearphishing, while the other methods are more automated and driven by the tools it\n\ndeploys on previously compromised systems, to move laterally within or outside of a compromised\n\n\n-----\n\norganization. These two methods are described rather briefly in this section, because they are examined\n\nin detail in the respective sections covering the tools involved.\n\nSpearphishing campaigns\n\nA typical Gamaredon spearphishing campaign employs a spearphishing email with a malicious\nattachment that contains either a LNK or an HTA file that is served to a potential victim. The files from\n\nemail attachments download the next stage, which is usually a VBScript downloader. No exploits are\nused, so targets must open the LNK or HTA files to get compromised.\n\nThroughout 2022 and early 2023, we saw Gamaredon using various types of archives (RAR, ZIP, 7z,\n\nTAR), each delivered as an attachment that contained a directory with a single LNK file. When opened,\nthese LNK files launched the mshta.exe process with a URL as an argument. As shown in Figure 3, the\n\nURL points to a remote HTA file. We were not able to obtain these remote HTA files; therefore, we can\nonly speculate that they contained a VBScript downloader as in other cases that we observed\n\nsubsequently.\n\nFigure 3. An example of the target of a LNK file from a Gamaredon spearphishing campaign\n\nIn early 2023, Gamaredon started using a new tactic in some of its spearphishing campaigns, replacing\nLNK files with HTA files in attached archives. As shown in Figure 4, this HTA file contained a short\n\nVBScript that launched mshta.exe with a URL as an argument to download another HTA file. This\nsecond HTA file contained a VBScript downloader – PteroSand – that could deliver additional payloads.\n\n\n-----\n\nFigure 4. An example HTA file from a Gamaredon spearphishing campaign\n\nLater, around April 2023, the tactics, techniques, and procedures (TTPs) of Gamaredon’s spearphishing\n\n[campaigns changed once again, using HTML smuggling](https://attack.mitre.org/techniques/T1027/006/) to deliver a malicious HTA file via an HTML email\nattachment. Upon opening, the HTML document displays a dialog for downloading the archive, but the\n\narchive is in fact base64 encoded and embedded in the JavaScript code contained in the HTML attachment,\nso no download is necessary. Figure 5 shows an example of such JavaScript code with an embedded archive.\n\nThe HTA file from the embedded archive launches mshta.exe, which in turn downloads and executes\nanother HTA file that contains PteroSand. Interestingly, Gamaredon again did not switch instantly to this\n\nnew tactic, but rather used it simultaneously with the previous one for a short time.\n\nFigure 5. An example of the JavaScript code with an embedded base64-encoded archive marked in red\n\n\n-----\n\nWeaponized Word documents\n\nGamaredon also compromises new targets using the victim’s Word documents, weaponized by either\n_PteroDoc or PteroTemplate. These documents then download a malicious remote template that delivers_\n\n_PteroDash, which can download additional payloads to a newly compromised system._\n\nPteroDoc, when deployed to an already compromised system, weaponizes all Word documents on a\nsystem by adding a malicious remote template reference, anticipating these documents may be shared\n\nwith other potential victims within or even outside of a compromised organization.\n\nPteroTemplate weaponizes the default Word template (Normal.dotm) on a compromised system by\ninjecting a malicious VBA macro. This action weaponizes all new and existing documents based on the\n\ndefault template. The injected macro, activated when documents are closed, attaches a reference to a\nmalicious remote template. Then, whenever the weaponized documents are opened, the malicious\n\nremote template will be downloaded. Interestingly enough, the act of attaching a new template alters\nthe document. Therefore, despite saving such a document immediately before closing it, for example by\n\npressing Ctrl + S, the Save dialog window will pop up every time and the document needs to be saved\nagain by the victim.\n\nWeaponized USB drives\n\nThe last method used by Gamaredon involves USB drives, weaponizing all drives connected to a\n\ncompromised system with VBScript or PowerShell versions of PteroLNK. Both tools, when deployed on\na system, repeatedly attempt to detect connected USB drives, in order to drop LNK files and in some\n\ncases also a copy of PteroLNK onto them. LNK files are created with conspicuous filenames in English\nand Ukrainian (e.g., pornography, Login_Password, мoбілізaція (translation: mobilization),\n\nзаписи_розмов (translation: conversation_records)), probably to entice potential victims into opening\nthem. Clicking on a LNK file can, depending on the particular PteroLNK version that created it, either\n\ndirectly retrieve the next stage from a C&C server, or execute a PteroLNK copy to download additional\npayloads.\n\nAs in the case of weaponized documents, the goal is to facilitate lateral movement within or outside of\n\na compromised organization through victims sharing these weaponized USB drives.\n\n#### Toolset\n\nGamaredon uses numerous tools, which we have broken down into the following categories:\ndownloaders, droppers, weaponizers, stealers, backdoors, and ad hoc tools. In Table 1, we summarize all\n\ntools contained in this section and provide basic information for each of them. Note that we\ndeliberately omitted all dedicated downloaders, since we did not assign particular names to them, and\n\nthey are used by Gamaredon only for deploying specific tools already present in the table.\n\nTable 1. Summary of tools used by Gamaredon\n\nTool Category Written in Description\n\nPteroPSLoad Downloader PowerShell Downloads various payloads.\n\nPteroX Downloader VBScript Downloads various payloads.\n\nPteroSand Downloader VBScript Downloads various payloads.\n\n\n-----\n\nTool Category Written in Description\n\nPteroDash Downloader VBScript Downloads various payloads.\n\nPteroRisk Downloader VBScript Downloads various payloads.\n\nPteroCDrop Dropper C Drops various VBScript payloads.\n\nVBScript\n\n\nPteroLNK Weaponizer\n\n\nWeaponizes connected USB drives.\n\n\nPowerShell\n\nPteroDoc Weaponizer VBScript Weaponizes Word documents.\n\nPteroTemplate Weaponizer VBScript Weaponizes Word templates.\n\nPteroDig Weaponizer PowerShell Weaponizes LNK files.\n\nPteroPSDoor Stealer PowerShell Exfiltrates specific files from the file system.\n\nPteroVDoor Stealer VBScript Exfiltrates specific files from the file system.\n\nPteroScreen Stealer PowerShell Captures and exfiltrates screenshots.\n\nPteroSteal Stealer PowerShell Exfiltrates credentials stored by browsers.\n\nPteroCookie Stealer PowerShell Exfiltrates cookies stored by browsers.\n\nPteroSig Stealer PowerShell Exfiltrates data stored by the Signal application.\n\nPteroGram Stealer PowerShell Exfiltrates data stored by the Telegram application.\n\nPteroBleed Stealer PowerShell Exfiltrates data stored by specific web applications.\n\nPteroScout Stealer PowerShell Exfiltrates various system information.\n\nPteroPShell Backdoor PowerShell Serves as a remote shell.\n\nPteroSocks Ad hoc PowerShell Serves as a reverse SOCKS proxy.\n\nPteroClone Ad hoc PowerShell Delivers payloads using the rclone utility.\n\nPteroPowder Ad hoc C Downloads additional payloads.\n\nReVBShell Ad hoc VBScript Serves as a remote shell.\n\n\n-----\n\nDownloaders\n\nBased on our observations, Gamaredon’s downloaders fall into two categories: general-purpose and\ndedicated. Typically, a general-purpose downloader fetches a dedicated downloader, which then\n\ndelivers the final payload.\n\nHowever, exceptions exist where a general-purpose downloader delivers another general-purpose\ndownloader or deploys a final payload directly. Although the procedure can vary over time, the\n\nsimplified scheme illustrated in Figure 6 is accurate in most cases.\n\nFigure 6. A simplified download scheme\n\n\n-----\n\n_General-purpose downloaders_\n\nWe recognize eight types of general-purpose downloaders: five standalone and three built-in.\nStandalone downloaders primarily deliver payloads, whereas built-in downloaders have other primary\n\ncapabilities but can also deliver payloads.\n\nPteroPSLoad\n\nPteroPSLoad is a downloader written in PowerShell that we discovered in October 2021. After it is\n\ndeployed, it remains persistent on compromised systems and can deliver various payloads. We’ve\nidentified 11 versions, distinguished by their unique URI for fetching payloads from their C&C servers.\n\nThe main goal of all versions is just to deploy other payloads and, in some cases, set up its own\npersistence, which at the same time serves as its update procedure. The versions of PteroPSLoad differ\n\nin persistence mechanisms they leverage and in the ways of obtaining IP addresses of the C&C servers,\nbut there is one thing they all have in common – the way that they handle responses from their C&C\n\nservers. Each can receive and parse at least two out of three payload types: a URL to an encrypted PE\nfile, a PowerShell command, and an encrypted VBScript file. The downloader decides how to process\n\nthe payload based on the contents of a response retrieved from the C&C server.\n\nPayload parsing has evolved over time, so it may vary slightly for particular versions but it typically\nfollows this pattern:\n\n- If the response starts with http, PteroPSLoad fetches and decrypts an encrypted PE file from the\nURL, dropping it to %TEMP% with a random filename and .exe extension, and launches it.\n\n- If the response body starts with the ! character, a PowerShell command follows this character,\nwhich PteroPSLoad executes via Invoke-Expression.\n\n- If neither clue is present, the payload is treated as a custom-encrypted VBScript, decrypted by\nPteroPSLoad and executed within a PowerShell process using an instance of the\n```\n  MSScriptControl.ScriptControl.1 COM object.\n\n```\nBoth the PE file and the VBScript are encrypted with an XOR cipher, with the system drive’s volume\nserial number as the XOR key. This number is uploaded to the C&C server in the HTTP POST request\n\nissued in order to receive the payload. Table 2 summarizes the payload each PteroPSLoad version can\ndownload, including the built-in general-purpose downloaders described later in the Built-in\n\n_downloaders section, because they handle downloaded payloads identically to PteroPSLoad._\n\nTable 2. Types of payloads that various versions of PteroPSLoad and built-in downloaders can receive\n\n\nURL leading to\na PE file\n\n\nPowerShell\ncommand\n\n\nEncrypted\nVBScript\n\n\nPteroPSLoad ps.php\n```\n224B18E531E511CEA2849D9A3B9CF5AD502AFECC\n\n```\nPteroPSLoad pst.php\n```\n6D694B73A2C497F16EB9B5CCA883658397FFBEDF\n\n```\nPteroPSLoad put.php\n```\nB08305C557692619B9D0EAF5B58A8B91858CF4D5\n\n```\nPteroPSLoad past.php\n```\n28F4F0367C2BB0574C8A7D1B9C3E71E6AC678300\n\n```\n\n✓ ✓\n\n✓ ✓\n\n✓ ✓\n\n✓ ✓\n\n\n-----\n\nURL leading to\na PE file\n\n\nPowerShell\ncommand\n\n\nEncrypted\nVBScript\n\n\nPteroPSLoad time.php\n```\n13BA279D8602FEE7CEDE152B6A9148CD9D2F6662\n\n```\nPteroPSLoad slot.php\n```\nB99D4724077B0A2CBEEE38332C05F3D4171C9DCC\n\n```\nPteroPSLoad index.php\n```\n025E3D88C53FC12D5A4AAB726E696F2815BAC84D\n\n```\nPteroPSLoad new.php\n```\nD5576E578518E474A5DFF654C44AB3EC4A6E4ECF\n\n```\nPteroPSLoad post.php\n```\nE0BD8855159CB708789C4DE183E107C5C117FBA1\n\n```\nPteroPSLoad account.php\n```\n4F915541291120AA100123C1C93FA7DE78F46A3F\n\n```\nPteroPSLoad power.php\n```\n9E30DFFDB88DD3ADFAB4CD5C67A98336C4BF9504\n\n```\nPteroDig\n```\n1AEAE7A567C71200BA804801C4CEC227D2B64414\n\n```\nPteroScreen\n```\nBA2366ED4E83FFC6DEC489C9011FE181CE169A47\n\n```\nPteroLNK\n```\n49CF239AB2EBD04CAFDCEC07FBB0C1C1A43E8C02\n\n```\n\n✓ ✓\n\n✓ ✓ ✓\n\n✓ ✓ ✓\n\n✓ ✓ ✓\n\n✓ ✓ ✓\n\n✓ ✓ ✓\n\n✓ ✓\n\n✓ ✓\n\n✓ ✓\n\n✓ ✓\n\n\nThe following sections, named after the URIs used in the individual versions, focus on relevant changes\n\nmade in particular versions of PteroPSLoad, primarily highlighting the evolution of the persistence\nmechanism and the communication protocol. The sections, except for the last one, are ordered\n\nchronologically, with the oldest known version first. The last section is dedicated to a version of\nPteroPSLoad that is somewhat special, because in the past it was used for a slightly different purpose\n\nthan the rest.\n\nThe first seven versions (ps.php, pst.php, put.php, past.php, time.php, slot.php, and index.php)\n\nexhibit similar behavior with some differences and changes in each version. These versions resolve the\nC&C IP address, ensure the persistence of the downloaded update, and periodically poll the C&C server\n\nfor payloads. Changes in these versions mostly pertain to the persistence mechanism, the way of\nobtaining the C&C IP address, and the frequency of connections to the C&C server. The subsequent\n\nthree versions (new.php, post.php, and account.php) and the special version (power.php) contain\nmajor changes and their behavior is fully described in their respective sections.\n\nNote that in some sections, we briefly describe modifications of the communication protocol, but we\n\nprovide more details on this matter in one place, in the Network infrastructure section.\n\n\n-----\n\nFirstly, PteroPSLoad resolves the C&C server’s IP address from the hardcoded domain by querying the\n\ndefault system DNS. Secondly, it uses that IP address to send an HTTP GET request with the /get.php\nURI to its C&C server to fetch its updated version. Thirdly, it ensures the persistence of the downloaded\n\nupdate by creating an HKCU Run value that will execute it upon every system start, serving as both an\nupdate and persistence mechanism. Finally, PteroPSLoad enters an infinite loop, in which it regularly –\n\napproximately every five minutes – polls its C&C server to see whether there is a new payload to\nreceive, parse, and execute. Each HTTP POST request includes the compromised system’s computer\n\nname and volume serial number for improved victim identification.\n\n##### new.php\n\nThe PteroPSLoad persistence mechanism was significantly reworked in this version. To be stealthier,\n\nPteroPSLoad attempts to hide itself in the registry. First, it stores the orchestrator – a short PowerShell\nscript that loads other parts of PteroPSLoad – in the environment variable Include. Second, it stores\n\nthe relevant parts of the downloader script in the registry values: ip, update, Decoder, serialNumber,\n```\nsave, http, responces [sic], Collection, and execute; under HKCU\\Printers. Finally, to achieve\n\n```\npersistence, it adds an UpdateService entry under\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run, which contains a short PowerShell\n\n```\ncommand that reads the environment variable Include and executes its contents via Invoke```\nExpression. Upon execution, the orchestrator reads the parts of the PteroPSLoad script from the\n\n```\naforementioned registry values and executes them. Strangely, PteroPSLoad only installs itself, but does\nnot start running immediately; previous versions do so. In fact, this action was moved to its dedicated\n\ndownloader, which, after the installation, reads the orchestrator from the Include environment\nvariable and executes it via Invoke-Expression.\n\nWe saw these combinations for obtaining the C&C IP address:\n\n- A Telegram channel as a primary option and a hardcoded domain as a fallback.\n\n- A post published on the Telegram publishing platform telegra.ph as a primary option, a Telegram\nchannel as a secondary option, and a hardcoded domain as a fallback.\n\n- A post published on telegra.ph as a primary option and a Telegram channel as a fallback.\n\nIn this version, an added feature stores the IP address in a file in %TEMP% once successfully obtained,\n\nused as the primary communication method with the C&C server. This may maintain system access if\nall IP address-obtaining methods are blocked on restart. For instance, when the system is restarted and\n\nsimultaneously all methods of obtaining the C&C IP address have been blocked, PteroPSLoad is still able\nto communicate with its C&C server and update itself.\n\nUnlike the previous two versions of PteroPSLoad, this one does not include the full path to the current\n\nworking directory in the data exfiltrated to its C&C server, but uploads the contents of the\n```\nPROCESSOR_IDENTIFIER environment variable along with the computer name and volume serial\n\n```\nnumber.\n\nThis version can receive all three payload types: a URL leading to an encrypted PE file, a PowerShell\ncommand, or an encrypted VBScript file.\n\n##### post.php\n\nIn all previous versions before this one, which we first saw on August 4[th], 2023, almost all variables were\nnot obfuscated and had genuine names; now all the names of variables present in the script are\n\nrandomly generated for each instance of PteroPSLoad.\n\nThe persistence mechanism is similar to the previous version, with two changes: the orchestrator is\nnow stored in the registry value under the HKCU Run key, and other relevant parts of the downloader\n\nscript remain under HKCU\\Printers, but their names are randomly generated.\n\n\n-----\n\nSurprisingly, the update mechanism was completely removed from this version of PteroPSLoad.\n\nRegarding the communication protocol, two significant changes were made. The first one is that a new\nmethod of obtaining the IP address of the C&C server was added. PteroPSLoad now leverages a DNS\nover-HTTPS (DoH) service provided by Cloudflare. To get the IP address, it sends an HTTP GET request\nto https://cloudflare-dns.com/dns-query?name=<domain> with the Accept HTTP header set to\n```\napplication/dns-json, where <domain> is the C&C domain that is hardcoded in the sample.\n\n```\nSo, this version of PteroPSLoad sequentially attempts to obtain its C&C IP address via three separate\nthird-party services:\n\n- a Telegram channel,\n\n- the Telegram publishing platform telegra.ph, and\n\n- the Cloudflare DoH service.\n\nIf all of these attempts fail, as a fallback, it resolves the IP address from the hardcoded C&C domain by\nquerying the default system DNS.\n\nThe other significant change in network communication is that on systems where the major OS version\n\nis greater than 8 – currently Windows 10 and 11 – PteroPSLoad leverages the built-in and well-known\n[utility curl](https://curl.se/) for sending HTTP requests when attempting to obtain the C&C IP address via the\n\naforementioned three services. Making outbound connections from curl.exe may appear less\nsuspicious than making them directly from PowerShell.\n\nUpon successful IP address retrieval, it’s stored in a randomly named file in %LOCALAPPDATA%\\Logic\\,\n\nnot %TEMP%.\n\nLike the previous version, it exfiltrates the computer name, volume serial number, and the contents of\n\nthe PROCESSOR_IDENTIFIER environment variable, accepting all three payload types: a URL leading to\nan encrypted PE file, a PowerShell command, or an encrypted VBScript file.\n\nWhile this version was being used actively, we discovered a few instances that downloaded the latest\n\n[release of Cloudflare Tunnel client from a GitHub repository and stored it as](https://github.com/cloudflare/cloudflared)\n```\n%LOCALAPPDATA%\\Logic\\cloudflared.exe. It is a legitimate command line application used for\n\n```\nproxying network traffic via the Cloudflare network from the internet to an arbitrary destination. The\nintended use is to run this utility in a private network to expose a server (without a publicly routable IP\n\naddress) to the Internet. However, Gamaredon uses it to create a tunnel to its C&C server from the\nsame computer as the instance of PteroPSLoad itself is running.\n\nTo create the tunnel, PteroPSLoad runs the tool with the command line option --url\n```\nhttp://<ip_address>:80. PteroPSLoad attempts to obtain <ip_address> from Telegram or to resolve\n\n```\nit via Cloudflare’s DoH – for Windows versions prior to v.10, this is done directly via HTTP requests\n\noriginating from powershell.exe; for Windows 10 and 11, curl.exe is used instead. If that fails, an\nattempt is made to resolve the IP address from the hardcoded domain. Then cloudflared.exe\n\nestablishes a connection to the Cloudflare network and generates a domain in the format\n```\n<subdomain>.trycloudflare.com, where <subdomain> is randomly generated. This domain is used by\n\n```\nPteroPSLoad to reach its C&C server. When PteroPSLoad connects to this domain, cloudflared.exe is\nnotified by the Cloudflare network to relay the request to the target server from the previous command\n\nline argument and, upon receiving the response, cloudflared.exe sends it back to the Cloudflare\nnetwork, which subsequently forwards it to PteroPSLoad. Notably, Gamaredon only uses the free tier of\n\nthis service.\n\nAs a result of using the tunnel, the network connection to the C&C server is not conducted directly by\n```\npowershell.exe and the HTTP request sent by cloudflared.exe to the C&C server does not contain\n\n```\nthe destination IP address in the Host HTTP header. Therefore, by using this technique, Gamaredon\n\nmight be able to evade some detection/blocking mechanisms.\n\n\n-----\n\nThis whole functionality was later removed from PteroPSLoad.\n\n##### account.php\n\nThis version, in comparison to the previous one, contains two notable changes. The first in the\npersistence mechanism used, and the second in the way that it communicates with its C&C server.\n\nPersistence is ensured by dropping a small PowerShell loader with a randomly generated filename to\n```\n%ALLUSERSPROFILE% and scheduling it to run every three minutes. The relevant parts of the downloader\n\n```\nscript are randomly named registry values under HKCU\\Printers. Upon execution, the loader reads and\n\nexecutes the function from one of the registry values, which in turn reads and executes other code\nparts from the corresponding registry values.\n\nIn this version – unlike a few previous samples where Gamaredon tested the Cloudflare Tunnel client –\n\n[PteroPSLoad attempts to reach its C&C server via the ngrok tunnel, established by the ngrok utility on a](https://ngrok.com/product/secure-tunnels)\nGamaredon-controlled computer. As in the Cloudflare case, Gamaredon uses just the free tier of the\n\nservice provided by ngrok.\n\nFirst, PteroPSLoad tries to obtain the ngrok utility-generated domain posted on telegra.ph using\n```\ncurl.exe on Windows 10 and 11. If this attempt is unsuccessful, it tries to utilize nslookup.exe to query\n\n```\nGoogle’s 8.8.8.8 DNS server for a DNS TXT record of the hardcoded C&C domain, which contains the\n\nngrok-generated domain. If PteroPSLoad succeeds in getting the ngrok domain, it uses this domain to\ncommunicate with the C&C server via the ngrok tunnel. As a fallback, if the two previous attempts fail,\n\nit resolves the IP address from the hardcoded C&C domain by querying the default system DNS for an A\nrecord and uses the IP address to communicate directly with the C&C server.\n\nThe obtained C&C IP address is stored in a randomly named file in\n```\n%LOCALAPPDATA%\\Microsoft\\Windows\\Caches\\.\n\n```\nLike the previous version, it exfiltrates the computer name, volume serial number, and the\n```\nPROCESSOR_IDENTIFIER environment variable contents, and can accept all three payload types: a URL\n\n```\nleading to an encrypted PE file, a PowerShell command, or an encrypted VBScript file.\n\n##### power.php\n\nThis PteroPSLoad version, unique for being downloaded and deployed only by the first known\n\nPowerShell version of PteroLNK, is simplified and doesn’t use any persistence or update mechanism due\nto PteroLNK’s ability to fetch and deploy a fresh PteroPSLoad instance when needed. Because PteroLNK\n\nlacked integrated download functionality, it relied on a standalone downloader to deliver payloads.\n\nNotably, it doesn’t contain a C&C server; the C&C IP address is provided by PteroLNK before execution\nby replacing a placeholder with the IP address from which PteroPSLoad was downloaded. It exfiltrates\n\nthe computer name, volume serial number, and %OS% environment variable contents, accepting two\npayload types: a PowerShell command, or an encrypted VBScript file.\n\nPteroX\n\nPteroX (SHA-1: DF1C0A70E7A02B839AB3AAC3FC410E61EEFB58EB) is written in VBScript and consists of\n\ntwo components that are wrapped in the original VBScript sample – a scheduler and a downloader. The\nscheduler executes first, base64 decodes the downloader, and drops it into %USERPROFILE% or a new\n\ndirectory within it. It then schedules the downloader to run every few minutes, and finally runs the\ndropped downloader script.\n\nThe downloader sends an HTTP POST request with the volume serial number of the system drive and\n\nthe computer name to the C&C server, receiving an encrypted payload saved as a .txt file in the\n```\n%APPDATA% or %PUBLIC% directory.\n\n```\n\n-----\n\nThe payload, a PE file XOR encrypted with a system-specific key (the volume serial number previously\n\nsent to the C&C server), is decrypted and dropped into the same directory with a .exe extension. The\npayload is not executed right after it has been downloaded, but by the downloader on its next run\n\nbefore attempting to download another payload. The payload is not made persistent; it is just executed\nonce and then deleted by the downloader. Basically, the downloader executes a previously downloaded\n\nPE file and fetches a new one from its C&C server.\n\nThe persistence of PteroX is ensured by its scheduler component, which creates a scheduled task that\n\nexecutes the dropped downloader component every ten minutes.\n\nPteroX itself can be deployed by other general-purpose or built-in downloaders as a VBScript payload.\nIt usually downloads PteroCDrop or some VBScript tools packed in SFX archives – most of the time it is\n\n_PteroRisk._\n\nPteroSand\n\nPteroSand (SHA-1: 2B9B0AD0B65BB6101704684CD339E946FAE2DCFA) is written in VBScript and is one of\n\nthe general-purpose downloaders that are deployed first after an initial compromise. Its code is quite\nshort and not very complex. Upon execution, it sends an HTTP request to its C&C server using the\n```\nmsxml2.xmlhttp COM object, with the computer name and system drive volume serial number in the\nUser-Agent HTTP header. As a response, it receives a base64-encoded blob with random && (double\n\n```\nampersand) tokens, which it discards, and decodes the blob to get a VBScript payload. This payload is\nexecuted in memory without being stored on the compromised system. Interestingly, some samples\n\ndownload and execute only one payload before terminating, while others continue in an infinite loop,\npotentially delivering an unlimited number of payloads.\n\nPteroSand can be used by two distinct initial access vectors or deployed by other general-purpose or\nbuilt-in downloaders on already compromised systems. When used by initial access vectors, it is the\n\nfirst general-purpose downloader that is deployed onto newly compromised systems. The VBScript\nversion of PteroLNK uses it as a downloader component and it is also downloaded by LNK or HTA files\n\nfrom spearphishing emails.\n\nPersistence behavior in PteroSand varies among samples. While most samples use some persistence\nmechanism, a few don’t. The type of persistence depends on PteroSand’s delivery method. Samples\n\ndropped by the VBScript version of PteroLNK are persisted by the scheduler component, which adds an\nentry to the HKCU Run key and creates a scheduled task with a five-minute interval. Samples\n\ndownloaded by LNK and HTA files from spearphishing emails are persisted by adding an entry to the\nHKCU Run key. Samples deployed by other general-purpose or built-in downloaders are persisted by\n\nadding an entry to the HKCU Run key or by adding a command line to\n```\nHKCU\\Environment\\UserInitMprLogonScript.\n\n```\nPteroDash\n\nPteroDash (SHA-1: FEA57A486EB4BDAC5E7D59C9958C42293A5ABE12) is written in VBScript and is very\nsimilar to PteroSand. Upon execution, it issues an HTTP request to its C&C server using an instance of\n\nthe msxml2.xmlhttp COM object, including the computer name and system drive volume serial number\nin the User-Agent header. As a response, it receives a base64-encoded blob with random -- (double\n\nhyphen) tokens, which it discards, decodes the blob for a VBScript payload, and executes it in memory\nwithout storing it on the compromised system. All samples we observed downloaded and executed only\n\none payload per run.\n\nPteroDash is usually deployed as an initial general-purpose downloader. It is dropped by the VBA\n```\ndocument_close event procedure, which can be embedded in:\n\n```\n- a remote template that has been downloaded by a Word document weaponized by PteroDoc,\n\n\n-----\n\n- a remote template that has been downloaded by a Word document weaponized by\n\nPteroTemplate, and\n\n- a default Word template (Normal.dotm) weaponized by PteroTemplate.\n\nThe process of weaponizing Word documents and templates is described in detail in the respective\nsections of the PteroDoc and PteroTemplate sections. Note that the downloader is only dropped when\n\nthe documents are closed, which triggers the document_close event procedure.\n\nPteroDash is not made persistent when dropped and can only be downloaded or dropped again by the\nweaponized objects.\n\nPteroRisk\n\nPteroRisk (SHA-1: A93503BBB613F084ADD338B9FA2EEE466BF3A2D6) is written in VBScript and is very\nsimilar to both PteroSand and PteroDash. Upon execution, it issues an HTTP request to its C&C server\n\nusing an instance of the WinHttp.WinHttpRequest.5.1 COM object, with the computer name and\nsystem drive volume serial number in the User-Agent HTTP header. As a response, it receives a base64\nencoded blob with random ** (double asterisk) tokens, which it discards, decodes the blob for a\nVBScript payload, and executes it in memory without storing it on the compromised system. All\n\nsamples we observed could download and execute an unlimited number of payloads per run.\n\nPteroRisk, unlike PteroSand or PteroDash, is not an initial general-purpose downloader. It lacks\n\npersistence mechanisms, requiring re-download upon system reboot or process termination. It’s usually\ndeployed on systems already compromised, either as a VBScript payload delivered by other\n\ndownloaders, or downloaded by PteroX in an SFX archive. The SFX archive drops and executes PteroRisk\nas a VBScript, then uses the SelfDelete feature to remove itself from the system.\n\nBuilt-in downloaders\n\nThere are three tools that belong to other categories, because their primary functionality is something\nother than delivering payloads, but they contain functionality that basically acts as a general-purpose\n\ndownloader and can fetch various payloads in the form of a VBScript. The names of these tools are:\n_PteroDig, PteroScreen, and PteroLNK PowerShell version. All of them are described in detail later in this_\n\nreport. Payloads they obtain are encrypted with an XOR cipher using the volume serial number of the\nsystem drive as the key. Upon decryption, they execute the payload using an instance of the\n```\nMSScriptControl.ScriptControl.1 COM object with the Language property set to VBScript.\n\n```\nMoreover, built-in downloaders of PteroScreen and the PowerShell version of PteroLNK can also receive\na PowerShell command preceded by the ! character. This leading character is removed and the rest of\n\nthe response is executed via Invoke-Expression.\n\nThe summary of possible payloads receivable by built-in downloaders was shown in Table 2, above.\n\n_Dedicated downloaders_\n\nGamaredon’s dedicated downloaders, which can be VBScripts or PowerShell scripts in VBScript\n\nwrappers, are simple scripts primarily focused on deploying the same payload, which is transferred in\ncleartext. While they sometimes establish persistence for the downloaded payload, they usually lack\n\npersistence mechanisms themselves. Each downloader is tied to one or more URIs for payload\ndownload. Despite their similarities, these downloaders can be differentiated by their associated URL\n\npatterns, which we list in Table 3.\n\n\n-----\n\nTable 3. URL patterns associated with dedicated downloaders\n\nAssociated URL patterns\n```\n           http://<IP>/cmd\n\n```\n\nDownloader of PteroPShell\n\n```\nhttp://<IP>/scripts/cmd.txt\nhttp://<IP>/test/cmd.txt\n\n```\n```\n                      http://<IP>/scripts/web.txt\n\n```\nDownloader of PteroBleed\n```\n                      http://<IP>/test/web.txt\n\n```\nDownloader of PteroClone `http://<IP>/test/copy.txt`\n```\n                      http://<IP>/cookies\n\n```\n\nDownloader of PteroCookie\n\n```\nhttp://<IP>/scripts/cookies.txt\nhttp://<IP>/admin/cookies.txt\nhttp://<IP>/test/cookies.txt\n\n```\n```\n                      http://<IP>/drive.php\n\n```\nDownloader of PteroDig\n```\n                      http://<IP>/admin/drive.php\n                      http://<IP>/scripts/tlg.txt\n\n```\n\nDownloader of PteroGram\n\nDownloader of the VBScript version of\nPteroLNK\n\nDownloader of the PowerShell version of\nPteroLNK\n\nDownloader of PteroPSLoad\n\n```\nhttp://<IP>/admin/tlg.txt\nhttp://<IP>/test/tlg.txt\nhttp://<IP>/<randomWord>.html\nhttp://<IP>/<randomWord1>/<randomWord2>/index.html\nhttp://<IP>/lnk.php\nhttp://<IP>/auth.php\nhttps://<IP>/admin/auth.php\nhttp://<IP>/get.php\nhttps://<IP>/login.php\nhttps://<IP>/admin/login.php\n\n```\n\nDownloader of PteroScout `https://<IP>/getinfo.php`\n```\n                      http://<IP>/index.php\n\n```\n\nDownloader of PteroScreen\n\n```\nhttp://<IP>/init.php\nhttp://<IP>/last.php\n\n```\n```\n                      http://<IP>/scripts/sgn.txt\n\n```\nDownloader of PteroSig\n```\n                      http://<IP>/test/sgn.txt\n\n```\nDownloader of PteroSocks `http://<IP>/scripts/proxy.txt`\n\n\n-----\n\nDownloader of PteroSteal\n\nDownloader of PteroPSDoor variant 1\n\n\nAssociated URL patterns\n```\nhttp://<IP>/pass\nhttp://<IP>/password\nhttp://<IP>/scripts/password.txt\nhttp://<IP>/admin/password.txt\nhttp://<IP>/test/password.txt\nhttp://<IP>/log/password.txt\nhttp://<IP>/index/password.txt\nhttp://<IP>/files/password.txt\nhttp://<IP>/local/password.txt\nhttp://<IP>/js/password.txt\nhttp://<IP>/phpmyadmin/password.txt\nhttp://<IP>/core/password.txt\nhttp://<IP>/fun/password.txt\n\n```\n\nWe identified four versions of the downloader. The first two, differing only in the URIs they use (/ua\n\nand /cisco/lab, respectively) to download PteroPSDoor variant 1, are simple VBScript wrappers that\nexecute a short PowerShell command line that just downloads PteroPSDoor variant 1 from the\n\nhardcoded C&C IP address, then executes it via Invoke-Expression.\n\nThe third version uses the /info URI, also using a VBScript wrapper, but with a more complex\nPowerShell command. This command downloads a payload from the hardcoded C&C IP address, splits it\n\nby the # character, and stores the parts under HKCU\\Software\\FedFox in values named FedFox<n>\nwhere <n> is a counter initialized to 0 and increased by one for each part. It then creates a PowerShell\n\nloader wrapped in VBScript, drops it to %APPDATA%\\Dir with a random filename, and executes it. This\nloader reads and concatenates all parts of the payload, then executes it via Invoke-Expression. A\n\nregistry value, BoxerProtocol, is added under\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run to execute the loader after each system\n\n```\nreboot. Finally, it executes the downloaded payload via Invoke-Expression.\n\nThe fourth version (SHA-1: 0FA9303ED739A3C6A76CEF4517B9ADB60C73CA80) uses the URI /contact and\n\ndiffers in its persistence mechanism for the downloaded payload. After downloading and splitting the\npayload by the # character, it stores its parts to files <filename><n>.txt in %APPDATA%\\<directory>\n\nwhere <n> is a counter that starts at 0 and is increased by one for each part, as in the previous version;\n```\n<filename> can be one of the names BakerStreet, BobsCave, MIUIlauncher, or Dock; and <directory>\n\n```\ncan be one of the names Modem, hotel, XiaomiOS, or Sonoma. Persistence is achieved by creating a\nPowerShell loader wrapped in VBScript in the Startup directory with a randomly generated .vbs\n\nfilename, rather than using the HKCU Run key.\n\nThe initial instances of the fourth version resembled the previous one – a complex PowerShell\ncommand line embedded as cleartext in a VBScript wrapper. Subsequent instances saw the PowerShell\n\ncommand base64 encoded but still wrapped in VBScript. Gamaredon later revamped the command line\ninto a proper script with defined functions and added obfuscation, replacing all function and variable\n\nnames with random ones, adding random characters in string variables, and randomizing function\norder. This obfuscated, base64-encoded PowerShell script remained wrapped in VBScript. As of October\n\n2023, this fourth version of the downloader was still being used for delivering PteroPSDoor variant 1\nwith the version number 7208.\n\n\n-----\n\nDownloader of PteroPSDoor variant 2\n\nWe know about two versions of the downloader that deploys PteroPSDoor variant 2. Their functionality\nis similar, but the older one is a VBScript with an embedded PowerShell command line, while the newer\n\none is a PowerShell script encapsulated in a VBScript.\n\nThe older version uses the URI /new and comprises two parts. The first part executes a brief PowerShell\ncommand that downloads and immediately runs PteroPSDoor variant 2 from the hardcoded C&C IP\n\naddress via an HTTP POST request. The second part establishes a persistence mechanism. Firstly, it\nsends a GET request to the same IP address to download a payload. Secondly, it splits this payload into\n\nchunks by the # character, and stores them in registry values named part<n> under\n```\nHKCU\\Software\\EnterpriseMode, where <n> is a counter that starts at 0 and is increased by one for\n\n```\neach part. Thirdly, it drops a brief VBScript to %TMP%\\runner.tmp, which runs a PowerShell command\nthat reads, combines, and executes the payload parts from the part<n> registry values. Finally, it adds a\n\nregistry value runner under HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run to run\n```\nrunner.tmp after each system restart.\n\n```\nThe second version (SHA-1: A3C21F9A493A05F9428E8F5FE5AF7F0C2BF67F95) uses the URI /update, and\n\ndespite similar functionality to the previous version, it’s written entirely in PowerShell within a simple\nVBScript wrapper. Firstly, it downloads PteroPSDoor variant 2 from the hardcoded C&C IP address via\n\nan HTTP POST request. Secondly, it splits the payload into chunks, delimited by the # character, and\nstores them under HKCU\\Software\\NetwrixKey as NetwrixParam<n>, where <n> is a counter that starts\n\nfrom 0 and is increased by one for each chunk. Thirdly, it drops a short VBScript wrapper to\n```\n%APPDATA%\\Nitro\\<randomFilename>, which executes a PowerShell command reading, concatenating,\n\n```\nand executing payload parts via Invoke-Expression from NetwrixParam registry values. Fourthly, it\nadds a registry value Windows Sort Updater under\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run to execute the dropped VBScript wrapper\n\n```\npost-reboot. Lastly, after ensuring persistence, it executes the downloaded PteroPSDoor.\n\nDownloader of PteroVDoor\n\nPteroVDoor used to be deployed by a three-stage download chain, with the first two stages being\n\ndownloaders and the third stage being PteroVDoor itself, all written in VBScript.\n\nThe first stage (SHA-1: 9B6EF236D9DC758336F1D89268822F8611C8B973) downloads the next stage from\nthe hardcoded C&C IP address while using the /drop URI. It stores the next stage in %TEMP% with a\n\nfilename hardcoded in the first stage. In fact, the filename is a slightly obfuscated C&C domain for the\nsecond stage. Subsequently, the first stage executes the second stage and also creates the entry named\n```\nexample under HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run to execute the downloaded\n\n```\nscript after each system reboot. Interestingly, the entire functionality of the first-stage downloader was\n\nlater integrated into PteroVDoor.\n\nThe second stage, when it is executed, parses the C&C domain from its own filename by removing all\nunderscore characters and by replacing the file extension with .ru. Then it prepends www., resolves the\n\nIP address for the constructed domain, and downloads the third stage – PteroVDoor, which it executes\nin memory.\n\nThere are two versions of this second stage. The older version (SHA-1:\n```\n04F1ED3050D6B2527D6196DFF5845B10510D0C2F) uses the URI /visual and has mild obfuscation with\n\n```\nextra unused code. The newer version (SHA-1: CB9712BED15723973171192DA17946BF6778D98D) uses the\nURI /info and is fully obfuscated, with randomly named functions and variables, obfuscated string\n\nvariables with additional random characters removed before use, and randomly ordered functions.\n\nIn September 2023, when PteroVDoor version 6005 was first deployed, Gamaredon stopped using these\ntwo stages for delivering this version of PteroVDoor. Instead, it introduced a simple dedicated\n\n\n-----\n\ndownloader using the URI /info, which downloads and executes PteroVDoor in memory. However, this\n\nwas short-lived, seen only in a few instances and likely discontinued within days. Subsequently,\nGamaredon began deploying PteroVDoor version 6005 directly via general-purpose downloaders,\n\neliminating the need for a dedicated downloader.\n\nDroppers\n\n_PteroCDrop_\n\nPteroCDrop (SHA-1: 82123C17117EF235F3B57D0C5572C861E3ED7173) has been in use since at least\nFebruary 2021. It is a dropper, written in C, that can deliver various VBScript payloads. PteroCDrop has\n\nan overlay carrying a starter script template, a VBScript payload, and other data to complete variable\nparts of the template. The overlay is encrypted with a basic cipher, where each byte is XORed with the\n\nprevious one. An example of the decrypted overlay is shown in Figure 7. Individual parts of the overlay\nare enclosed in the colored frames:\n\n- red frame – the template of the starter script,\n\n- green frame – the variable parts of the template (command line, environment variable, filenames),\nand\n\n- yellow frame – the VBScript payload, namely the VBScript version of PteroLNK.\n\nFigure 7. An example of the decrypted overlay\n\nPteroCDrop operates straightforwardly. It first creates the starter script from the embedded template\nby inserting appropriate paths. It then drops the starter script and VBScript payload to the disk and\n\nexecutes the starter script using the Windows API CreateProcess. The script launches the VBScript\n\n\n-----\n\npayload, pauses for a few seconds, and deletes all three files: the dropper, itself, and the VBScript\n\npayload. Throughout PteroCDrop’s lifetime, Gamaredon has used various compilers to build it and in\nsome of the samples this PDB path was left:\n```\nE:\\Projects\\sfx\\Extractor10\\281021\\Debug\\090721.pdb\n\n```\nOverall, the most prevalent payload delivered by PteroCDrop is a VBScript version of PteroLNK. During\n2023, we only saw one other payload, PteroX.\n\nWeaponizers\n\nThe tools that belong to this category can either alter properties of existing files on a file system or\ncreate new files on connected USB drives in order to achieve:\n\n- lateral movement within or outside a compromised organization (PteroLNK, PteroDoc,\n\nPteroTemplate), or\n\n- persistence on a compromised system (PteroTemplate, PteroDig).\n\n_PteroLNK VBScript version_\n\nPteroLNK, in use since at least November 2020, weaponizes connected USB drives by placing LNK files\nonto them, primarily for lateral movement. There are two variants of this VBScript tool.\n\nThe first variant, active from November 2020 to October 2021, scans a compromised system for\n\navailable USB drives and drops LNK files on them. Clicking on a dropped LNK file launches the\n```\nmshta.exe process, which downloads and runs an HTA payload.\n\n```\nThe second variant of PteroLNK (SHA-1: 7793282401B134077E70217B55B0C4B45850D119), which we\ndiscovered in October 2021, weaponizes all connected USB drives by replicating itself as a hidden file to\n\nall root subdirectories, and creates LNK files, which execute a copy of PteroLNK when clicked on.\nPteroLNK includes three embedded VBScript components: a scheduler, a LNK dropper, and a\n\ndownloader. The scheduler is a code block embedded as a string variable in the original PteroLNK script,\nwith several characters replaced with random sequences. Upon deobfuscation, it runs within the\n\noriginal PteroLNK script. The LNK dropper and the downloader are two separate base64-encoded blobs,\ndropped to disk in decoded form by the scheduler.\n\nThe scheduler component copies the original PteroLNK script to %USERPROFILE% with a frequently\n\nchanging, hardcoded filename, recently seen as ~.ini. It drops the downloader script and the LNK\ndropper to a directory in %USERPROFILE%, also with a frequently changing, hardcoded location. It then\n\nexecutes both scripts, schedules them to run every five minutes, and adds two entries under the HKCU\n```\nRun key for persistence. No persistence mechanism is set for the original PteroLNK script; it’s copied to\n\n```\na specific location for use by the LNK dropper in weaponizing USB drives, as discussed in the following\nparagraph.\n\nThe LNK dropper component weaponizes all connected USB drives by copying the original PteroLNK\n\nscript to all directories in the drive’s root and creating LNK files that trigger the script upon clicking. To\ntempt potential victims into clicking on the LNK files, they have so-called double extensions (.docx.lnk\n\nor .rtf.lnk), and very conspicuous filenames in English or Ukrainian, like pornography or мoбілізaція\n(translation: mobilization). To find all connected USB drives it uses the WMI query select * from\n```\nwin32_logicaldisk where mediatype=null. The LNK dropper runs repeatedly via a scheduled task to\n\n```\nweaponize new USB drives on compromised systems.\n\nAs a downloader, PteroLNK utilizes PteroSand, discussed in the downloaders section. Once PteroLNK\ncompromises a system, the downloader is repeatedly executed via a scheduled task to deliver extra\n\npayloads.\n\n\n-----\n\nPteroLNK is obfuscated in multiple layers, detailed in the Obfuscation section. The obfuscation applied to\n\nthe scheduler component, where selected characters are replaced with random sequences, is also used\non code blocks embedded as base64-encoded blobs. Nearly all string variables and small code blocks\n\nare divided into smaller parts and then concatenated before use or execution. Additionally, function and\nvariable names are randomized in all PteroLNK components and in the original PteroLNK script.\n\n_PteroLNK PowerShell version_\n\nThe PowerShell version of PteroLNK, which we discovered in May 2022, weaponizes connected USB\ndrives by dropping LNK files onto them for lateral movement. There are four easily distinguishable\n\nvariants of this tool, identified by the URI used to construct the URL for contacting their C&C servers.\nThe URIs of the four variants we have observed, listed in chronological order, are:\n\n- `/sleep.php (SHA-1: E537DEAF3A77C5C0F0B9F8A12FF5995DD24CD259),`\n\n- `/log.php (SHA-1: 801A9B08987977692223B7105DEC8B21B9D9749E),`\n\n- `/search.php (SHA-1: 44C720AE508F448263A83CAC26775D6709DFBBDD), and`\n\n- `/link.php (SHA-1: 49CF239AB2EBD04CAFDCEC07FBB0C1C1A43E8C02),`\n\nThese are referred to as v1–v4, respectively, in the following paragraphs.\n\nEach PteroLNK variant shares the common behavior of running in an infinite loop, weaponizing\n\nconnected USB drives by copying itself as a hidden file to all root subdirectories, and creating LNK files\nthat execute the copy when clicked. Oddly, if a drive’s used space exceeds 50 kB, PteroLNK also creates\n\na LNK file in the root directory, otherwise only in subdirectories.\n\nThe newly created LNK files have noticeable filenames, similar to the PteroLNK VBScript version. For\n[each LNK file, PteroLNK randomly selects an icon ID from the following list: 3, 4, 116, 126, 127, 205, 266,](https://superuser.com/questions/1406594/is-there-a-reference-for-the-full-list-of-windows-10-shell-icon-numbers)\n```\n325, 314, and 313; using it as a reference to an icon located in shell32.dll. PteroLNK doesn’t check\n\n```\nwhether a USB drive is already weaponized, allowing it to repeatedly weaponize a drive by dropping\n\nmultiple LNK files.\n\nFor persistence, a short PowerShell script is added under the HKCU Run key that, upon its own\n\nexecution after a system reboot, executes a copy of PteroLNK that can be stored in:\n\n- a file under %USERPROFILE% (v1), or\n\n- the registry values ip, knoc, prepare, run, save, search, SetLnk, executer, result_code, or\n```\n  update under HKCU\\System, split into parts (v2–v4).\n\n```\nThe changes in persistence of v2–v4 slightly affect how USB drives are weaponized, as PteroLNK cannot\nsimply copy itself as a file to discovered USB drives. As a solution, PteroLNK uses a script template filled\n\nwith code parts from registry values and adds it to all root subdirectories of a drive.\n\nFor payload delivery, v1 downloads and immediately executes PteroPSLoad (the version with the URI\n```\n/power.php) as an intermediate stage, which can receive either a PowerShell command or a VBScript\n\n```\npayload. Other variants have this download functionality integrated and can directly receive these two\n\ntypes of payloads.\n\n_PteroDoc_\n\nPteroDoc (SHA-1: B2B58CEF19546B2D2284B2EB5F22B6D8FDB94D4E), in use since at least February 2021, is\na VBScript tool that weaponizes Microsoft Word documents by inserting a reference to a malicious\n\nremote template. Once a Word document is weaponized, it remains so even when it is transferred to\nother computers; hence, PteroDoc is used by Gamaredon with the intention of spreading it to other\n\nsystems. The tactic of weaponizing all Word documents increases the chances of spreading, as these\ndocuments might be shared within or outside a compromised organization.\n\n\n-----\n\nFirst, PteroDoc enables programmatic access to VBA projects and enables all Word macros by setting\n\nthe following registry values to 1:\n\n- `HKCU\\Software\\Microsoft\\Office\\<WordVersion>\\Word\\Security\\AccessVBOM`\n\n- `HKCU\\Software\\Microsoft\\Office\\<WordVersion>\\Word\\Security\\VBAWarnings`\n\nThe <WordVersion> is variable and dynamically resolved from the Word.Application VBScript object by\nPteroDoc during its runtime. Second, it deletes all subkeys under\n```\nHKCU\\Software\\Microsoft\\Office\\<WordVersion>\\Common\\Internet\\Server Cache. Third, it\n\n```\nsearches for.doc and .docx Word documents on Removable, Network, or Fixed drives, to weaponize\n\nthem by inserting a reference to a malicious remote template hosted on a C&C server. The reference is\n[added by setting the AttachedTemplate property of the document. Finally, PteroDoc once again deletes](https://learn.microsoft.com/en-us/office/vba/api/word.document.attachedtemplate)\n\nall subkeys under the aforementioned registry key.\n\nWhen the weaponized documents are opened, the attached remote templates, containing a malicious\nVBA document_close event procedure, are fetched. This procedure drops a VBScript downloader to\n```\n%TEMP% and executes it to deliver additional payloads. So far, we have only seen PteroDash being used\n\n```\nas a downloader component of PteroDoc.\n\n_PteroTemplate_\n\nPteroTemplate, in use since at least November 2020, is a VBScript tool that weaponizes default\nMicrosoft Word document templates (Normal.dotm) by inserting a malicious VBA macro. During 2022\n\nand 2023 we observed two variants of this tool.\n\nThe process of weaponizing Normal.dotm, which we describe below, is common to both variants. First,\nPteroTemplate forcibly terminates all Microsoft Word processes by executing the command taskkill\n```\n/f /im WINWORD.EXE. Second, it enables programmatic access to VBA projects and enables all Word\n\n```\nmacros by setting the following registry values to 1:\n\n- `HKCU\\Software\\Microsoft\\Office\\<WordVersion>\\Word\\Security\\AccessVBOM`\n\n- `HKCU\\Software\\Microsoft\\Office\\<WordVersion>\\Word\\Security\\VBAWarnings`\n\nwhere <WordVersion> is variable and dynamically resolved by PteroTemplate during its runtime. Third,\nit deletes the existing Normal.dotm, creates a new one, and inserts a malicious VBA macro. As with\n\n_PteroDoc, this template has a malicious document_close event procedure, which Word automatically_\ncalls upon document closure. Finally, PteroTemplate deletes all subkeys under\n```\nHKCU\\Software\\Microsoft\\Office\\<WordVersion>\\Common\\Internet\\Server Cache.\n\n```\nThe two PteroTemplate variants primarily differ in the actions of the inserted VBA macros. In both\ncases, the macro is triggered upon closing documents based on the Normal.dotm template. The macros’\n\ndiffering actions allow one variant to persistently weaponize Word documents, while the other only\ndrops and executes a VBScript downloader.\n\nThe first variant of PteroTemplate (SHA-1: 16FD6CBA3F13CC5B195CD6C0DD33BBF08CD0FE39) inserts a\nmacro that tries to download a remote template and attach it to an open document. If successful, the\n\ndocument becomes persistently weaponized. When the weaponized document is reopened, even on\nanother machine, the remote template with a different VBA macro is downloaded. This template’s\n```\ndocument_close event procedure doesn’t attach a remote template but drops a VBScript downloader,\n\n```\nembedded in the VBA macro, to %TEMP% and executes it. This process is shown in Figure 8.\n\n\n-----\n\nFigure 8. Permanently weaponizing Word documents using the first variant of PteroTemplate\n\nThe second variant of PteroTemplate (SHA-1: 9A6B36E6CAD9156EA6E09DE740D3F1CCB6816F87), which\n\nwe first observed in May 2023, inserts a document_close event procedure that drops a VBScript\ndownloader to %TEMP% and executes it, similar to the event procedure in the first variant’s downloaded\n\nremote template. Basically, this variant skips the step of attaching a remote template to documents\nand directly deploys a VBScript downloader upon closing a document based on the Normal.dotm\n\ntemplate. As a result, this variant does not have the ability to persistently weaponize Word documents\nand the weaponized template just serves as a persistence method that drops a downloader each time a\n\nnewly created or existing document, which is based on the weaponized template, is closed. The\nprocedure for this variant is shown in Figure 9.\n\nFigure 9. Persistence mechanism resulting from weaponizing Normal.dotm by the second variant of PteroTemplate\n\n\n-----\n\nFor both variants, we have only seen PteroDash being used as a downloader component of\n\nPteroTemplate.\n\n_PteroDig_\n\nPteroDig (SHA-1: 1AEAE7A567C71200BA804801C4CEC227D2B64414), which we discovered in November\n\n2022, is a PowerShell tool that weaponizes selected Desktop LNK files. It drops a basic skeleton of a\ndownloader to %USERPROFILE% and stores relevant parts of the downloader script in the registry values\n```\nip, update, key, vol, wc, xor, decod, and run under HKCU\\Network. The aforementioned skeleton script\n\n```\njust reads and executes these registry values. Then it searches non-recursively for LNK files located in\n\nthe Desktop directory that point to a file with a .exe file extension and do not pass any command line\narguments. It replaces them with new LNK files with the file path\n```\nC:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe as their target and a newly added\n\n```\nargument that instructs PowerShell to launch first the original executable file and then also the\n\ndropped downloader.\n\nWhen PteroDig is deployed on compromised systems, it just installs itself, weaponizes LNK files, and\nterminates. It doesn’t use any persistence mechanism for automatic start-up, instead relying solely on\n\nuser interaction to trigger its download functionality.\n\nUnlike other tools in its category, PteroDig’s primary goal isn’t spreading, but adding a persistence layer\n\non compromised machines. While weaponizing objects might seem like spreading behavior, PteroDig\ncan’t spread because it’s improbable for LNK files from one system’s Desktop directory to be copied to\n\nother systems, and even if it happens, the weaponized LNK files won’t work as intended without the\ndownloader skeleton script and registry values.\n\nStealers\n\n_PteroPSDoor variant 1_\n\nThis PteroPSDoor variant is a file stealer written in PowerShell that has been in use since May 2022. Its\nversion number at that time was 7051 (SHA-1: 821362A484908E93F8BA748B600665AE6444303D). The\n\nversion we analyzed for the purposes of this white paper is from November 2023 and has version\nnumber 7208 (SHA-1: BA5F7E2FA9BE1CB3FC7AE113F41C36E4F2C464B6), but not all numbers between\n\nthese two were used. During these months, its code was modified many times, but the core\nfunctionality has remained the same. PteroPSDoor runs in an infinite loop, where it searches for specific\n\ntypes of files to exfiltrate to the C&C server via HTTP POST requests.\n\nFirst, it continually searches for specific file types on connected USB drives to exfiltrate to the C&C\n\nserver via HTTP POST requests. These files, with extensions such as .rar, .zip, .7z, .jpg, .odt, .docx,\n```\n.doc, .xlsx, .rtf, .xls, .txt, .jpeg, .pdf, .ps1, and .mdb, are copied to a staging directory – for\n\n```\nexample, at %LOCALAPPDATA%\\vector – for later exfiltration. However, the name and the location of\nthe staging directory were changed many times throughout the existence of PteroPSDoor.\n\nSecond, it searches for files with the same extensions on all mapped drives, excluding those mapped to\n\nletters A, B, and Q. Any located files are immediately exfiltrated to the C&C server.\n\nWhile searching for files, it ignores directories that contain the following substrings in their names:\n```\nprog, log, windows, appdata, local, roaming. To prevent double exfiltration, PteroPSDoor computes an\n\n```\nMD5 hash from a file path, file size, and last write timestamp for each exfiltrated file and stores it in a\n“custom database”. It is essentially a text file with one MD5 hash per line, but it is referred to as a\n\ncustom database in Gamaredon’s tools. Before exfiltration or staging, files are checked against this\ndatabase to ensure that no duplication occurs. Same as for the staging directory, the database’s name\n\nand location change frequently; in version 7208 it is located in %APPDATA% and its name is randomly\ngenerated by PteroPSDoor.\n\n\n-----\n\nIn addition to file stealing, PteroPSDoor has a feature where every file uploaded to the C&C server can\n\ntrigger a payload response. This payload, either a PE file or VBScript, is parsed, dropped to %TEMP% with\na random filename, and executed. To regularly receive payloads, PteroPSDoor creates a file with\n\nrandom content in a dedicated directory before exfiltrating staged files. This ensures it always uploads\nat least one file, giving the C&C a chance to respond with a payload.\n\nFor persistence, PteroPSDoor establishes a scheduled task that runs a brief PowerShell script,\ndownloading a new PteroPSDoor script from a hardcoded IP address. From version 7205 onwards, the\n\npersistence setup code was shifted from PteroPSDoor to its dedicated downloader.\n\nSamples that we classify as PteroPSDoor variant 1 have been deployed in an obfuscated form since its\nfirst appearance. Initially, all names of functions and variables in the script were replaced by randomly\n\ngenerated names, while all string variables remained unobfuscated. Later versions added more\nobfuscation, randomizing function order, applying new obfuscation to all string variables, which were\n\nonly deobfuscated at runtime. None of these aforementioned obfuscations were applied to\nPteroPSDoor variant 2, which appeared approximately seven months later.\n\n_PteroPSDoor variant 2_\n\nWe observed this variant for the first time in December 2022, with the initial sample bearing version\nnumber 7070. Overall, variant 2 has basically the same functionality as variant 1, except for two notable\n\ndifferences:\n\n- The first two versions of variant 2 that we found lack the ability to parse a payload from a server’s\nresponse and execute it.\n\n- In all versions of variant 2, the code responsible for setting up persistence is absent and\npersistence is handled by its dedicated downloader.\n\nMoreover, variant 2 has a notable difference that doesn’t impact functionality – all function and\n\nvariable names are unobfuscated. It is not entirely clear to us why PteroPSDoor variant 2 was even\ndeveloped and why it was being used simultaneously with variant 1. It’s possible that two distinct teams\n\nwithin the group had access to the same codebase and developed it separately.\n\nInterestingly enough, in September 2023, we discovered a PteroPSDoor sample with version number\n```\n7112; given the latest known version of variant 2 was 7111 at that time (SHA-1:\n742E34BA21650ECB0B7EF33F786641F0BE823BE8), we expected the new sample to be variant 2.\n\n```\nHowever, it had the same obfuscation applied as variant 1 and at the same time the code for setting up\nthe persistence was absent. That left us puzzled. Days later, we found a similar sample with version\n\nnumber 7113. No further samples with version number 7113 or close to it have been found since,\nsuggesting that variant 2’s development ceased and it was merged with variant 1.\n\n_PteroVDoor_\n\nPteroVDoor, a VBScript file stealer we first detected in November 2022, has functionality similar to\n\nPteroPSDoor with some differences. PteroVDoor samples are split into two strains. The first strain\nincludes all versions from its inception until around mid-September 2023, when version 6005 was\n\ndeployed. The second strain starts from version 6005, which saw major changes and a functionality\nmore aligned with PteroPSDoor. The first strain is described in the following paragraphs, followed by\n\nthe changes made in the second strain.\n\nThe code of PteroVDoor is unobfuscated; all names of functions and variables seem to be genuine (see\n\nFigure 10). PteroVDoor searches for files with the following extensions: .rar, .zip, .7z, .jpg, .odt,\n```\n.docx, .doc, .xlsx, .rtf, .xls, .txt, .jpeg, .pdf, .ps1, and .mdb. It looks on all mapped drives, except\n\n```\nthe drive mapped to letter A, and immediately exfiltrates matching files to the C&C server via HTTP\nPOST requests. Surprisingly, unlike both PteroPSDoor variants, PteroVDoor lacks a dedicated function\n\nfor searching USB drives for exfiltration. When it uploads a file to the C&C server, it can only receive a\n\n\n-----\n\nVBScript payload, not a PE file. Even if there’s nothing to exfiltrate, it regularly uploads a test file\n\ncontaining the string This is a test. to receive a payload response.\n\nEarly versions of PteroVDoor lacked their own persistence mechanism, instead relying on a two-stage\n\ndownloader. The first stage downloaded the second-stage downloader and added an entry to execute\nit in the HKCU Run key. The second stage then downloaded and executed PteroVDoor. Eventually, the\n\nfirst-stage downloader’s functionality was integrated into PteroVDoor, eliminating the need for the first\nstage and leaving only the second stage.\n\nIn version 6005 (SHA-1: 0FD02B12517221F71A4A3774630C05643EE59988), many changes were\n\nintroduced. String variables were obfuscated and all function and variable names were replaced with\nrandom names, similar to PteroPSDoor. A dedicated function for searching files on USB drives was\n\nadded. It adopted the same trick as PteroPSDoor – dropping a file to a specific directory for at least one\nC&C server contact, even if no new files were ready for exfiltration. Unexpectedly, the persistence\n\nmechanism was entirely removed from PteroVDoor, now requiring a general-purpose downloader for\ndelivery.\n\nFigure 10. Comparison of code snippets from PteroVDoor v. 6004 and v. 6005\n\nIn October 2023, Gamaredon simultaneously used at that time the latest versions from both the first\n\nand the second strain, 6004 and 6005, respectively. It is important to mention that during our tracking,\nwe observed that notable changes weren’t always present in all new samples. Also, the versioning of\n\nPteroVDoor has been very strange since the beginning. Sometimes a lower version number was more\nrecent than the higher one. While this could be a deliberate attempt to confuse researchers, it’s more\n\nlikely that at least two independent teams within the group access the same codebase but develop\ntools separately, supporting our earlier hypothesis.\n\n\n-----\n\n_PteroScreen_\n\nFirst seen by ESET Research in July 2022, PteroScreen (SHA-1:\n```\nBA2366ED4E83FFC6DEC489C9011FE181CE169A47) is a PowerShell screen-capturing tool that takes\n\n```\nscreenshots of all screens and temporarily stores the image in %TEMP%\\<randomNumber>.png. The\nscreenshot is then base64 encoded and uploaded to the C&C server along with the system drive’s\n\nvolume serial number via an HTTP POST request. A response from the server is parsed by PteroScreen.\nIf the content starts with the ! character, it’s treated as a PowerShell command and executed via\n```\nInvoke-Expression. Otherwise, the content is treated as an encrypted VBScript payload and it is first\n\n```\ndecrypted using an XOR operation with the volume serial number of the system drive as the key, and\n\nsubsequently executed via start-job using the COM object MSScriptControl.ScriptControl.1.\nPteroScreen only uploads one screenshot and continues running, contacting its C&C server every three\n\nminutes to receive a payload.\n\n_PteroSteal_\n\nFirst seen by ESET telemetry in July 2022, PteroSteal (SHA-1:\n```\n8A2261D8C8111D2D99276575120B9EA65D0AEAEA) is a PowerShell infostealer that steals credentials\n\n```\nstored by Opera, Microsoft Edge, Google Chrome, and Mozilla Firefox. During our tracking, we\nencountered samples of variants that also steal data stored by two email clients: Microsoft Outlook and\n\nThe Bat!. Stolen credentials are base64 encoded and, along with the computer name, sent to the\nhardcoded C&C server via HTTP POST requests.\n\nThe Chromium-based browsers Opera, Edge, and Chrome store credentials in the same manner; for\neach of these browsers, PteroSteal exfiltrates encrypted credentials from the file named Login Data\n\nand the corresponding encryption key from the file Local State. The encryption key is decrypted on a\ncompromised machine prior to exfiltration by using the method\n```\n[System.Security.Cryptography.ProtectedData]::Unprotect. For each browser, both files are\n\n```\nlocated in the respective directories:\n\n- `%APPDATA%\\Opera Software\\Opera Stable\\`\n\n- `%LOCALAPPDATA%\\Microsoft\\Edge\\User Data\\Default\\`\n\n- `%LOCALAPPDATA%\\Google(x86)\\Chrome\\User Data\\Default\\`\n\n- `%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\`\n\nFirefox stores data for each profile in a separate directory in %APPDATA%\\Mozilla\\Firefox\\Profiles\\;\n\nPteroSteal exfiltrates the following files from all profile directories:\n\n- `key3.db`\n\n- `key4.db`\n\n- `logins.json`\n\n- `cert9.db`\n\nThe Bat! stores credentials for accounts in subdirectories named by email addresses in %APPDATA%\\The\n```\nBat!\\, PteroSteal exfiltrates all files that are named Account.CFN and are in a subdirectory that\n\n```\ncontains the @ character in its name.\n\nOutlook stores profile data in the registry under HKCU\\SOFTWARE\\Microsoft\\Office; the specific\nregistry path depends on the version of Microsoft Office and it also contains some other variable parts.\n\nTherefore, PteroSteal enumerates all entries under HKCU\\SOFTWARE\\Microsoft\\Office and looks for a\nregistry value named IMAP Password to find the correct path.\n\n\n-----\n\nIf it finds any profile with a saved password, it exfiltrates the data from the following registry values of\n\nthis key:\n\n- `Account Name`\n\n- `Email`\n\n- `IMAP Server`\n\n- `IMAP Port`\n\n- `IMAP User`\n\n- `SMTP Port`\n\n- `SMTP Server`\n\nIt also exfiltrates the IMAP Password from the registry, but this data is first decrypted before exfiltration\nby using [System.Security.Cryptography.ProtectedData]::Unprotect.\n\n_PteroCookie_\n\nDiscovered by ESET Research in May 2023, PteroCookie (SHA-1:\n```\nF05874C1B908FDEF4B9AF2B084E3D813595A12C9) is a PowerShell infostealer that steals cookie files\n\n```\nstored by Opera, Mozilla Firefox, Google Chrome, and Microsoft Edge. The stolen cookies are base64\n\nencoded and, coupled with the computer name, sent to the hardcoded C&C server via HTTP POST\nrequests.\n\nThe Chromium-based browsers Opera, Edge, and Chrome store cookies in the same manner; for each\nof these browsers, PteroCookie exfiltrates encrypted cookies from the file named Cookies and the\n\ncorresponding encryption key from the file Local State. The encryption key is decrypted on the\ncompromised machine prior to exfiltration by using the method\n```\n[System.Security.Cryptography.ProtectedData]::Unprotect. For each browser, both files are\n\n```\nlocated in the corresponding directories:\n\n- `%APPDATA%\\Opera Software\\Opera Stable\\Network\\`\n\n- `%LOCALAPPDATA%\\Microsoft\\Edge\\User Data\\Default\\Network\\`\n\n- `%LOCALAPPDATA%\\Google(x86)\\Chrome\\User Data\\Default\\Network\\`\n\n- `%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Network\\`\n\nFirefox stores data for each profile in a separate subdirectory in\n```\n%APPDATA%\\Mozilla\\Firefox\\Profiles\\; PteroCookie exfiltrates an SQLite database named\ncookies.sqlite from all profile subdirectories.\n\n```\nIt is worth mentioning that the code segment for parsing the encryption key from the Local State file\nwas sourced from a GitHub code snippet.\n\n_PteroSig_\n\nDiscovered by ESET Research in June 2023, PteroSig (SHA-1:\n```\n2CDB1DA4DF1A33E379C2F24DD6A05709F4848CB6) is a PowerShell infostealer designed to extract\n\n```\ninformation from the Signal desktop application. The Signal application’s SQLite database, stored in\n```\n%APPDATA%\\Signal\\sql\\db.sqlite, contains sensitive information like sent and received messages. The\n\n```\ndatabase is encrypted, but the key is stored close by, in %APPDATA%\\Signal\\config.json, allowing\n\nanyone with access to these files to read the database’s content, as described in this article.\n\nFirst, PteroSig, checks whether the file %APPDATA%\\Signal\\sql\\db.sqlite is present on the\n\ncompromised machine. If it is, PteroSig attempts to terminate any running instances of the Signal\napplication and copies the file holding the encryption key as well as the entire directory containing the\n\ndatabase to a newly created directory %TEMP%\\sgn. Finally, it exfiltrates, one by one, all files from\n```\n%TEMP%\\sgn to its C&C server via HTTP POST requests but does not delete the local copies.\n\n```\n\n-----\n\n_PteroGram_\n\nDiscovered by ESET Research in June 2023, PteroGram (SHA-1:\n```\nAC17FD08A3987CC91DFD6649BA3DABE8A9671305) is a PowerShell infostealer targeting the Telegram\n\n```\nDesktop application. Telegram Desktop stores its data in %APPDATA%\\Telegram Desktop\\tdata, which\ncontains encrypted session data. The encryption key is derived from a passcode and salt, but if no\n\npasscode is set, an empty string is used instead of it in the derivation procedure. Therefore, if an\nadversary obtains such encrypted files that have had no passcode set and inputs them into another\n\nTelegram Desktop instance, they gain full access to the active session, including chat history.\n\nFirst, PteroGram checks if %APPDATA%\\Telegram Desktop exists on a compromised machine to\ndetermine whether Telegram Desktop is installed. If so, it searches for all directories located in\n```\n%APPDATA%\\Telegram Desktop\\tdata with names that are 16 characters long and exfiltrates all files\n\n```\nfrom such subdirectories via HTTP POST requests to its C&C server. It also exfiltrates all files directly in\n```\n%APPDATA%\\Telegram Desktop\\tdata, then terminates the Telegram process and deletes the entire\n%APPDATA%\\Telegram Desktop\\tdata directory, perhaps to keep the stolen session unique.\n\n```\n_PteroBleed_\n\nIn August 2023 we discovered a PowerShell infostealer (SHA-1:\n```\nB50F10BBDB49BE6D868B09F3E1DD6C78D58D8E89) that we named PteroBleed; its goal is to exfiltrate\n\n```\n_[IndexedDB data, which is persistently stored by web versions of various applications (e.g., Telegram) that](https://web.dev/articles/indexeddb#what)_\nare running in the browsers Opera, Chrome, or Edge. For exfiltration it uses HTTP POST requests.\n\nWeb applications that use IndexedDB may store any kind of data, potentially including sensitive\n\ninformation like images or files transferred via web versions of messenger applications. As described\nnext, PteroBleed exfiltrates two sets of files, excluding .log or .old extensions. The first is all files\n\nlocated in the following directories:\n\n- `%APPDATA%\\Opera Software\\Opera Stable\\Local Storage\\leveldb\\`\n\n- `%LOCALAPPDATA%\\Microsoft\\Edge\\User Data\\Default\\Local Storage\\leveldb\\`\n\n- `%LOCALAPPDATA%\\Google(x86)\\Chrome\\User Data\\Default\\Local Storage\\leveldb\\`\n\n- `%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Local Storage\\leveldb\\`\n\nThe second set is files located in specific subdirectories in the following paths:\n\n- `%APPDATA%\\Opera Software\\Opera Stable\\IndexedDB\\`\n\n- `%LOCALAPPDATA%\\Microsoft\\Edge\\User Data\\Default\\IndexedDB\\`\n\n- `%LOCALAPPDATA%\\Google(x86)\\Chrome\\User Data\\Default\\IndexedDB\\`\n\n- `%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\IndexedDB\\`\n\nThe only subdirectories considered for exfiltration are those with names containing strings referencing\nTelegram and WhatsApp, a Ukrainian military system, and a webmail service used by a Ukrainian\n\ngovernmental institution.\n\n_PteroScout_\n\nDiscovered by ESET Research in August 2023, PteroScout (SHA-1:\n```\n2416DFC031CF0D05054D5BEB9739CBA6470FE585) is a PowerShell infostealer; its main goal is\n\n```\nreconnaissance. It collects various data about the compromised system and exfiltrates it to the\nhardcoded C&C server via an HTTP POST request. Exfiltrated data is composed of:\n\n- a captured screenshot,\n\n- installed security products retrieved by the query SELECT * FROM AntiVirusProduct,\n\n- selected information about the system, retrieved by the systeminfo command:\n\n° OS name,\n\n\n-----\n\n° OS version,\n\n° original install date,\n\n° system boot time,\n\n° system type,\n\n° system directory,\n\n° logon server,\n\n° domain,\n\n° total physical memory, and\n\n° available physical memory.\n\n- used and free space of all connected drives,\n\n- a list of running processes,\n\n- a list of installed applications enumerated from two registry keys:\n\n° `HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\, and`\n\n° `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\.`\n\n- a list of files located in the Desktop directory, and\n\n- a computer name and a volume serial number of a system disk.\n\nBackdoors\n\n_PteroPShell_\n\nDiscovered by ESET Research in October 2022, PteroPShell (SHA-1:\n```\nE2FEEE0B92819AC7FCA85CFE3DC37750834F0990) is a very simple reverse shell written in PowerShell. It\n\n```\nconnects to a predefined IP address and port using TCP, receives a command, and executes it using the\n```\nInvoke-Expression cmdlet. The command’s output is then sent back to the C&C server. Initially and\n\n```\nthen after every executed command, it displays a typical PowerShell prompt in the format PS\n```\n<current_directory>> to the operator. All observed PteroPShell samples were configured to connect\n\n```\nto TCP port 9511, except one, which used port 1010.\n\nAd hoc tools\n\n_PteroSocks_\n\nDiscovered in May 2023, PteroSocks (SHA-1: D58BFB39969F28698F90BF2E8782057E2F83C2DF) is a\n\nPowerShell tool providing partial SOCKS proxy functionality. It consists of two parts that were taken\nfrom unrelated open-source projects on GitHub. The first part, identical to code from the Amsi-Bypass\n[Powershell repository, tries to bypass AMSI on a compromised machine by patching the](https://learn.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal)\n```\nDllGetClassObject function in the Windows Defender DLL MpOav.dll and by calling the\nAmsiUtils.Uninitialize method.\n\n```\n[The second part of PteroSocks, taken from the Invoke-SocksProxy](https://github.com/p3nt4/Invoke-SocksProxy/blob/master/Invoke-SocksProxy.psm1) repository, is a partial SOCKS proxy\nimplementation. After the tool attempts to disable AMSI, it operates as a reverse proxy, establishing an\n\nencrypted TCP tunnel to the hardcoded IP address 80.90.181[.]107 and a randomly chosen port from\n4000 to 4100. This gives operators access to the local network and the ability to pivot to other systems\n\nvia the compromised machine.\n\nCuriously, Gamaredon used an optional certificate-pinning functionality in the Invoke-SocksProxy\nscript to verify the server certificate’s MD5 hash against the hardcoded value\n```\n565A4CD6E4F74E17A37D34E6EF93AB6DED71B3AA. We have seen just two occurrences of PteroSocks thus\n\n```\nfar, indicating its use in special cases.\n\n\n-----\n\n_PteroClone_\n\nDiscovered by ESET Research in July 2023, PteroClone (SHA-1:\n```\n5720FFDF9D9CD649445CBC12844E2B587622643A) is a unique PowerShell tool that uses a legitimate\n\n```\n[command line program – rclone](https://rclone.org/) – for managing files on cloud storage to download the next stage. It\nfirst downloads the rclone binary and configuration file to %APPDATA%\\Defrag, naming them\n```\nDefrag.exe and rclone.conf, respectively. It then creates the ScheduledDefrag task, set to trigger\n\n```\nwhen the system has been idle for ten minutes. This scheduled task launches the rclone binary with the\n\nfollowing command line arguments:\n```\nsync mega:<pc_name> %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup --no-console\n\n```\nThese arguments instruct rclone to download the content of the directory named as the computer\n[name from the well-known MEGA cloud storage](https://mega.io/) to the local Startup directory. This MEGA directory,\n\ncreated when files are uploaded by another rclone instance, must exist when the task first starts, as\nexplained in the next paragraph. The credentials needed to access the cloud storage are automatically\n\nparsed from the configuration file. All files added to the Startup directory are executed during every\nsystem start. Finally, PteroClone launches two instances of rclone with the following arguments:\n\n- `sync %APPDATA%\\Microsoft\\Windows\\SendTo mega:<pc_name>-d --no-console`\n\n- `sync %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup mega:<pc_name> --no-`\n```\n  console.\n\n```\nThese sync directories from the local machine to corresponding directories on the MEGA cloud storage.\n\nThe first set of command line arguments is used to upload all files and subdirectories from the SendTo\ndirectory to the cloud storage. This directory usually contains shortcuts to various directories, devices,\n\nor installed software that appear in the Send to context menu after right-clicking on a file. We believe\nthat Gamaredon operators might be able to leverage some of these files to make a better decision\n\nabout whether to deploy the next stage on victims’ machines. The second instance uploads the content\nof the Startup directory to cloud storage so that all the files already present in that directory are\n\npreserved when the rclone instance launched by the scheduled task synchronizes that directory with\nthe one stored on MEGA. Otherwise, these files would be deleted. This instance also creates the\n```\n<pc_name> directory on the cloud storage.\n\n```\nIn our telemetry, we have observed five distinct rclone configuration files so far. However, the intended\npayload of PteroClone remains unknown, as we haven’t been able to obtain it.\n\n_PteroPowder_\n\nDiscovered by ESET Research in June 2023, PteroPowder (SHA-1:\n```\n47A03EBB9798A8DF7EC8212134D418E937B449E9) is a simple downloader written in C++. It fetches a\n\n```\nPowerShell script from a hardcoded IP address using an HTTP GET request with the URI /cmd. Then it\nmerely uses the Windows API function ShellExecuteA to launch powershell.exe with two values –\n\nthe first being -ExecutionPolicy Bypass and the second being the content of the downloaded script.\nInterestingly enough, the following PDB path was left in the sample:\n```\nE:\\Projects\\RESEARCH\\TOOLS\\c++\\Reverse\\Release\\Reverse.pdb\n\n```\nWe do not know what payload was intended to be delivered by PteroPowder, as we have not been able\n\nto obtain it. However, the URI and the word Reverse in the PDB path suggest that PteroPowder might\ndeliver PteroPShell, a simple reverse shell, as it was delivered by other downloaders using the same URI\n\nin the past.\n\n\n-----\n\n_ReVBShell_\n\n_[ReVBShell](https://github.com/bitsadmin/revbshell)_ (SHA-1: 5BEFC01A3771E61151224E18F926226FF7FD4A40) an open-source reverse shell written\nin VBScript, was deployed by Gamaredon twice, both times in June 2023. One instance that we saw\n\neven contained a commented-out header with license, author, and GitHub repository details, which\nwas removed in the second sample. All commands provided by this open-source reverse shell are\n\nshown in Figure 11. The C&C server is set to 5.181.156[.]109:7070 in both samples. Besides\nadjustments made in the tool’s C&C configuration, operators slightly altered the SHELL command.\n\nRather than sending command outputs directly to the C&C server, it now also logs each output to a\nseparate file and sends the filename back to the C&C server, allowing operators to retrieve the outputs\n\nlater if necessary.\n\nFigure 11. Commands provided by ReVBShell\n\n\n-----\n\n#### Obfuscation\n\nTo avoid detection and to make it more difficult for researchers to dissect its malware, Gamaredon\n\noften applies obfuscation to its tools. Most of Gamaredon’s currently used tools are scripts written in\nPowerShell or VBScript, and many are obfuscated. The following paragraphs showcase and describe the\n\nmost common types of obfuscation used in Gamaredon’s tools. Note that there are myriad types of\nobfuscation used in various Gamaredon tools and the following examples are not an exhaustive list of\n\nthem.\n\nPteroPSDoor variant 1 serves as a good example of how the obfuscation evolved over the course of\ntime. In the initial version (7051) from May 2022, all function and variable names were replaced with\n\nrandom names, though string variables were left unobfuscated, and functions maintain their order.\n\nIn the subsequent version (7052), deployed a few days later, obfuscation was extended to some string\nvariables by splitting them into parts and dynamically concatenating them when used.\n\nFast-forward to version 7208, which we discovered 18 months after version 7051. The string variables\nare obfuscated even more, by inserting abundant random characters between real ones, the order of\n\nfunctions in the script is randomized for each instance, and some parts of the script are defined as\n(obfuscated) string variables and evaluated via Invoke-Expression.\n\nCode snippets of all three aforementioned versions are shown in Figure 12.\n\nFigure 12. Comparison of PteroPSDoor variant 1 v. 7051, 7052, and 7208\n\n\n-----\n\nAn example of a different kind of obfuscation, mainly used in PowerShell scripts, is a PteroPSLoad\n\nsample. As depicted in Figure 13, the main functionality code of PteroPSLoad is base64 encoded and\nembedded in a wrapper. The wrapper contains some cleartext code and large portions of irrelevant\n\ncode, particularly within several try/catch blocks. However, relevant sections, highlighted with red\nframes, decode the blob and execute it.\n\nFigure 13. An example of obfuscation used in a PteroPSLoad sample\n\n\n-----\n\nThe last example is a sample of the VBScript version of PteroLNK (SHA1:\n```\n7793282401B134077E70217B55B0C4B45850D119) that is quite large and heavily obfuscated. Various\n\n```\ntypes of obfuscation applied to it are characteristic of many Gamaredon’s VBScript tools.\n\nLooking at Figure 14, which contains a zoomed-out code listing of PteroLNK, there are three visually\ndistinct blobs in the script, highlighted in pink. These blobs represent the individual components of\n\nPteroLNK: a downloader, a LNK dropper, and a scheduler.\n\nFigure 14. An example of obfuscation used in a PteroLNK sample – highlighted parts are code obfuscated as data\n\n\n-----\n\nAs shown in Figure 15, the first two blobs are base64 encoded, while the last one resembles valid\n\nVBScript code. In this last blob, which contains the scheduler’s code, various characters have been\nreplaced with random character sequences (e.g., u with %L90#, n with #E7H2, o with }Q@45). The\n\nwrapper deobfuscates the code in the blob during runtime, just before evaluation.\n\nFigure 15. Snippets of the three blobs from PteroLNK\n\nThese two obfuscation types can be layered. After decoding, the base64-encoded blobs also contain\nblobs with replaced characters. Figure 16 shows an example of the contents of a base64-encoded blob\n\npost-decoding.\n\nFigure 16. The second layer of obfuscation applied to the downloader component\n\nMoreover, as well as in other tools, the names of functions and variables in PteroLNK are randomly generated.\n\n\n-----\n\n### NETWORK INFRASTRUCTURE\n\n[Gamaredon uses a technique known as fast flux DNS for its network infrastructure – frequently](https://attack.mitre.org/techniques/T1568/001/)\n\nchanging its C&C servers’ IP addresses, usually several times per day, to avoid IP-based blocking. It also\nfrequently registers and updates many new C&C domains to avoid domain-based blocking, mainly\n\nusing.ru as the top-level domain (TLD). Very rarely, we also saw these TLDs being used: .shop, .org,\n```\n.site, .online, .fun, and .xyz. The most prevalent registrar used by Gamaredon for registering new\n\n```\nC&C domains is REGRU-RU.\n\nFrom 2022, Gamaredon shifted from using hardcoded C&C domains to hardcoded C&C IP addresses in\nits tools. By mid-2023, many tools contained a hardcoded C&C domain and a hardcoded C&C IP address,\n\nwith some only having a hardcoded C&C IP address.\n\nNote that even if a tool contains a hardcoded C&C domain, it resolves this domain to an IP address by\n\nitself, for example by using WMI queries to ping C&C domains, and subsequently uses the IP address for\ncontacting the C&C server. In April 2023, Gamaredon changed the DNS records for its domains to\n\nprevent IP addresses from being resolved without using subdomains.\n\n#### Bypassing domain-based blocking\n\nGamaredon puts considerable effort into finding new techniques for bypassing domain-based blocking\nand for protecting the IP addresses of its C&C servers. Besides manually resolving C&C domains to IP\n\naddresses, which is typical behavior of Gamaredon tools, in 2022 and 2023 the group has added several\nadditional techniques to bypass domain-based blocking.\n\nThese include using legitimate public third-party websites to resolve domains to IP addresses, obtaining\n\nIP addresses from hardcoded URLs leading to a Telegram channel maintained by the operators or the\n[Telegram publishing platform telegra.ph, and using Cloudflare’s or Google’s](https://developers.cloudflare.com/1.1.1.1/encryption/dns-over-https/make-api-requests/) DoH service. It can also use\n\n[the legitimate Cloudflare Tunnel client to proxy traffic, or the ngrok utility to communicate with a C&C](https://ngrok.com/product/secure-tunnels)\nserver. Lastly, it can obtain a C&C IP address from a DNS TXT record of a hardcoded C&C domain by\n\nquerying Google’s DNS server.\n\n### CONCLUSION\n\nGamaredon significantly extended its cyberespionage capabilities by introducing multiple new tools to\n\nits arsenal throughout 2022 and 2023. These new tools are developed mainly in PowerShell, which has\ndefinitely become the language of choice for the group. Despite these numerous additions, the\n\ntechnical sophistication of the tools has hardly increased and the tools remain rather simple and\nstraightforward with the focus on getting things done.\n\nRather than innovating new stealth methods, Gamaredon continues to rely on heavy obfuscation,\n\nfrequent updates, and pre-deployment testing against security products. Given the high volume of\nunique samples produced daily, all three aforementioned aspects are probably automated to some\n\nextent.\n\nThe group demonstrated resourcefulness by employing various techniques to evade network-based\n\ndetections, leveraging third-party services such as Telegram, Cloudflare, and ngrok. Despite occasional\nattempts to compromise other countries, Gamaredon’s primary focus remains Ukraine, and we\n\nanticipate this trend will continue without significant shifts in targeting.\n\n\n-----\n\n### IOCS\n\n#### Files\n\nIn this section, we only provide one example for each tool or variant. All IoCs were already provided in\nthe MISP events published with private ESET Threat Intelligence reports throughout 2022 and 2023.\n\nSHA-1 Filename Detection Description\n\n`DF1C0A70E7A02B839AB3` PteroX – a VBScript general-purpose\nVBS/Pterodo.AEV\n`AAC3FC410E61EEFB58EB` [N/A ] downloader.\n\n`B50F10BBDB49BE6D868B` PteroBleed – steals the IndexedDB\nPowerShell/Pterodo.FR\n`09F3E1DD6C78D58D8E89` [N/A ] database from various browsers.\n```\n 0879644944178645498E\n\n```\nPowerShell/Pterodo.GA Downloader of PteroBleed.\n`20EB4F59F2A8F128255D` [N/A ]\n\n`82123C17117EF235F3B5` PteroCDrop – dropper with various C\nWin32/Pterodo.CEZ\n`7D0C5572C861E3ED7173` [N/A ] or VBScript payloads.\n\n`5720FFDF9D9CD649445C` PteroClone – uses rclone to download\nPowerShell/Pterodo.GC\n`BC12844E2B587622643A` [N/A ] the next stage.\n```\n 55CD3FB7D1FDE8694411\n\n```\nPowerShell/Pterodo.GA Downloader of PteroClone.\n`54573C9C62D93E0570E0` [N/A ]\n```\n F05874C1B908FDEF4B9A\n\n```\nPowerShell/Pterodo.FY PteroCookie – cookie stealer.\n`F2B084E3D813595A12C9` [N/A ]\n```\n CEA83C1AF6736484A172\n\n```\nPowerShell/Pterodo.GA Downloader of PteroCookie.\n`F7A3B876427CDF276473` [N/A ]\n\n`FEA57A486EB4BDAC5E7D` PteroDash – a VBScript generalVBS/Pterodo.AFA\n`59C9958C42293A5ABE12` [N/A ] purpose downloader.\n```\n 1AEAE7A567C71200BA80\n\n```\nPowerShell/Pterodo.FF PteroDig – LNK weaponizer.\n`4801C4CEC227D2B64414` [N/A ]\n```\n A3260C3314DF25DBF336\n\n```\nPowerShell/Pterodo.GK Downloader of PteroDig.\n`9B7C516BD9D4C1B4B1E4` [N/A ]\n\n`B2B58CEF19546B2D2284` PteroDoc – Word document\nVBS/Pterodo.VE\n`B2EB5F22B6D8FDB94D4E` [N/A ] weaponizer.\n\n`AC17FD08A3987CC91DFD` PteroGram – steals data that belongs\nPowerShell/Pterodo.FT\n`6649BA3DABE8A9671305` [N/A ] to the Telegram Desktop application.\n\n\n-----\n\nSHA-1 Filename Detection Description\n\n`945A50678E6E9AA29370` PowerShell/TrojanDownlo\nDownloader of PteroGram.\n`7E4F41E9BC81B9098BC5` [N/A ] ader.Agent.GBK\n\n`AB7C5C7CD6F75B1D0A7A` Downloader of PowerShell version of\nVBS/Pterodo.SC\n`D29176A254055BE5356E` [N/A ] PteroLNK.\n\n`866E874CFF4EAD298899` Downloader of the VBScript version of\nVBS/Pterodo.SL\n`24AA02630E68AE252B55` [N/A ] PteroLNK.\n\n`49CF239AB2EBD04CAFDC` PowerShell version of PteroLNK – USB\nPowerShell/Pterodo.FC\n`EC07FBB0C1C1A43E8C02` [N/A ] drive weaponizer.\n\n`801A9B08987977692223` PowerShell version of PteroLNK – USB\nPowerShell/Pterodo.GN\n`B7105DEC8B21B9D9749E` [N/A ] drive weaponizer.\n\n`44C720AE508F448263A8` PowerShell version of PteroLNK – USB\nPowerShell/Pterodo.GN\n`3CAC26775D6709DFBBDD` [N/A ] drive weaponizer.\n\n`E537DEAF3A77C5C0F0B9` PowerShell version of PteroLNK – USB\nPowerShell/Pterodo.GN\n`F8A12FF5995DD24CD259` [N/A ] drive weaponizer.\n\n`7793282401B134077E70` VBScript version of PteroLNK – USB\nVBS/Pterodo.PS\n`217B55B0C4B45850D119` [N/A ] drive weaponizer.\n```\n0FA9303ED739A3C6A76C\n\n```\nPowerShell/Pterodo.JJ Downloader of PteroPSDoor variant 1.\n`EF4517B9ADB60C73CA80` [N/A ]\n```\nA3C21F9A493A05F9428E\n\n```\nPowerShell/Pterodo.GA Downloader of PteroPSDoor variant 2.\n`8F5FE5AF7F0C2BF67F95` [N/A ]\n```\n821362A484908E93F8BA\n\n```\nWin32/Pterodo.BUD PteroPSDoor variant 1 version 7051.\n`748B600665AE6444303D` [N/A ]\n```\n66049304E03AB624167B\n\n```\nWin32/Pterodo.BUD PteroPSDoor variant 1 version 7052.\n`68501202A254E9ADD060` [N/A ]\n```\nBA5F7E2FA9BE1CB3FC7A\n\n```\nPowerShell/Pterodo.GS PteroPSDoor variant 1 version 7208.\n`E113F41C36E4F2C464B6` [N/A ]\n```\n742E34BA21650ECB0B7E\n\n```\nPowerShell/Pterodo.BY PteroPSDoor variant 2 version 7111.\n`F33F786641F0BE823BE8` [N/A ]\n\n`4F915541291120AA1001` PteroPSLoad – PowerShell\nPowerShell/Agent.BGU\n`23C1C93FA7DE78F46A3F` [N/A ] downloader.\n\n\n-----\n\nSHA-1 Filename Detection Description\n\n`025E3D88C53FC12D5A4A` PteroPSLoad – PowerShell\nVBS/Pterodo.TX\n`AB726E696F2815BAC84D` [N/A ] downloader.\n\n`D5576E578518E474A5DF` PteroPSLoad – PowerShell\nPowerShell/Pterodo.FD\n`F654C44AB3EC4A6E4ECF` [N/A ] downloader.\n\n`28F4F0367C2BB0574C8A` PteroPSLoad – PowerShell\nPowerShell/Pterodo.AV\n`7D1B9C3E71E6AC678300` [N/A ] downloader.\n\n`E0BD8855159CB708789C` PteroPSLoad – PowerShell\nPowerShell/Pterodo.GE\n`4DE183E107C5C117FBA1` [N/A ] downloader.\n\n`9E30DFFDB88DD3ADFAB4` PteroPSLoad – PowerShell\nPowerShell/Pterodo.DX\n`CD5C67A98336C4BF9504` [N/A ] downloader.\n\n\n`224B18E531E511CEA284` PowerShell/TrojanDownlo\n`9D9A3B9CF5AD502AFECC` [N/A ] ader.Agent.EMF\n\n\nPteroPSLoad – PowerShell\ndownloader.\n\n\n`6D694B73A2C497F16EB9` PteroPSLoad – PowerShell\nPowerShell/Agent.GT\n`B5CCA883658397FFBEDF` [N/A ] downloader.\n\n`B08305C557692619B9D0` PteroPSLoad – PowerShell\nWin32/Pterodo.BTM\n`EAF5B58A8B91858CF4D5` [N/A ] downloader.\n\n`B99D4724077B0A2CBEEE` PteroPSLoad – PowerShell\nPowerShell/Pterodo.AV\n`38332C05F3D4171C9DCC` [N/A ] downloader.\n\n`13BA279D8602FEE7CEDE` PteroPSLoad – PowerShell\nPowerShell/Pterodo.AV\n`152B6A9148CD9D2F6662` [N/A ] downloader.\n```\n8C9BFF48805537B41717\n\n```\nVBS/Pterodo.TT Downloader of PteroPSLoad.\n`BE78B1BE2A72DFC2A5D1` [N/A ]\n\n`E2FEEE0B92819AC7FCA8` PteroPShell – PowerShell reverse\nPowerShell/Pterodo.GH\n`5CFE3DC37750834F0990` [N/A ] shell.\n```\nBED97E0CFEDA1588FF12\n\n```\nPowerShell/Pterodo.GA Downloader of PteroPShell.\n`B392E0B5502DB50DE768` [N/A ]\n\n\n`47A03EBB9798A8DF7EC8` Win32/TrojanDownloader.\n`212134D418E937B449E9` [N/A ] Pterodo.A\n\n\nPteroPowder – downloads and\n\nexecutes a PowerShell payload.\n\n\n`A93503BBB613F084ADD3` PteroRisk – a VBScript generalVBS/Pterodo.OD\n`38B9FA2EEE466BF3A2D6` [N/A ] purpose downloader.\n\n\n-----\n\nSHA-1 Filename Detection Description\n\n`2B9B0AD0B65BB6101704` PteroSand – a VBScript generalVBS/Pterodo.ABV\n`684CD339E946FAE2DCFA` [N/A ] purpose downloader.\n\n```\n2416DFC031CF0D05054D\n\n```\nPowerShell/Pterodo.GO\n`5BEB9739CBA6470FE585` [N/A ]\n\n\nPteroScout – gathers and exfiltrates\nvarious information about the\n\ncompromised system.\n\n```\n8C79BB8EB97E774FFCEC\n\n```\nPowerShell/Pterodo.GL Downloader of PteroScout.\n`66C64F5CC8A11ED6C693` [N/A ]\n```\nBA2366ED4E83FFC6DEC4\n\n```\nPowerShell/Pterodo.BQ PteroScreen – screen capturing tool.\n`89C9011FE181CE169A47` [N/A ]\n\n`C42FE320A800F7C4AE97` PowerShell/TrojanDownlo\nDownloader of PteroScreen.\n`D0FDC6A1BBD91D57E75D` [N/A ] ader.Agent.HOI\n\n`2CDB1DA4DF1A33E379C2` PteroSig – steals database that\nPowerShell/Pterodo.FR\n`F24DD6A05709F4848CB6` [N/A ] belongs to the Signal application.\n```\nD37C80782FBEEE2035FB\n\n```\nPowerShell/Pterodo.GA Downloader of PteroSig.\n`B196D6A6443B4BE05B4C` [N/A ]\n```\nD58BFB39969F28698F90\n\n```\nPowerShell/KillAV.AH PteroSocks – SOCKS proxy.\n`BF2E8782057E2F83C2DF` [N/A ]\n```\n7CA1ADF40BA850D12B95\n\n```\nPowerShell/Pterodo.GA Downloader of PteroSocks.\n`259CBD2626562E17670C` [N/A ]\n```\n8A2261D8C8111D2D9927\n\n```\nPowerShell/Pterodo.EG PteroSteal – credential stealer.\n`6575120B9EA65D0AEAEA` [N/A ]\n```\n5E34D44D6B39ED1F9772\n\n```\nPowerShell/Pterodo.GK Downloader of PteroSteal.\n`9184101185D368F2B6CE` [N/A ]\n\n`16FD6CBA3F13CC5B195C` PteroTemplate – Word template\nVBS/Pterodo.NM\n`D6C0DD33BBF08CD0FE39` [N/A ] weaponizer.\n\n`9A6B36E6CAD9156EA6E0` PteroTemplate – Word template\nVBS/Pterodo.XX\n`9DE740D3F1CCB6816F87` [N/A ] weaponizer.\n```\n9E40CC45CBC9625EC190\n\n```\nVBS/Pterodo.OC PteroVDoor version 6004.\n`711D2790359A6198DB37` [N/A ]\n```\n0FD02B12517221F71A4A\n\n```\nVBS/Pterodo.ACF PteroVDoor version 6005.\n`3774630C05643EE59988` [N/A ]\n\n\n-----\n\nSHA-1 Filename Detection Description\n\n`596613AF85EE703858DB` VBS/TrojanDownloader.Ag\nDownloader of PteroVDoor.\n`96C570C6C0283EAA19C6` [N/A ] ent.ZEK\n\n`9B6EF236D9DC758336F1` Stage 1 of PteroVDoor download\nVBS/Pterodo.FE\n`D89268822F8611C8B973` [N/A ] chain.\n\n`CB9712BED15723973171` Stage 2 of PteroVDoor download\nVBS/Pterodo.XR\n`192DA17946BF6778D98D` [N/A ] chain.\n\n`04F1ED3050D6B2527D61` Stage 2 of PteroVDoor download\nVBS/Pterodo.LS\n`96DFF5845B10510D0C2F` [N/A ] chain.\n```\n5BEFC01A3771E6115122\n\n```\nVBS/Pterodo.OC ReVBShell – VBScript reverse shell.\n`4E18F926226FF7FD4A40` [N/A ]\n\n\n`0B5402397306F702D006` Remote template downloaded by\nWin32/Pterodo.CBG\n`BC18A473DAC5CD33540B` [N/A ] PteroDoc.\n\n`F2D8F72F8FAA81AF02D3` Remote template downloaded by\nVBA/Pterodo.BS\n`1C5A93DFEA71E33DE0D9` [N/A ] PteroTemplate.\n\n#### Network\n\nThe network IoCs provided here are only C&C servers extracted from selected samples, provided as\nexamples and not an exhaustive list of all C&C servers that we have encountered over the past years.\n\nThe complete lists of network IoCs are provided in MISP events of private ESET Threat intelligence\nreports that we publish periodically.\n\nNote that IP addresses could not be automatically resolved from the domains for two possible reasons:\n\nthe domains had already expired or they have been resolved without a subdomain, which cannot be\ndone anymore as explained in the Network infrastructure section.\n\nIP Domain Hosting provider First seen Details\n\nGamaredon C&C\nN/A `corolain[.]ru` N/A 2021-11-11\nserver.\n\nGamaredon C&C\nN/A `goloser[.]ru` N/A 2022-01-20\nserver.\n\nGamaredon C&C\nN/A `retarus[.]ru` N/A 2022-01-20\nserver.\n\nGamaredon C&C\nN/A `hulortad[.]ru` N/A 2022-05-06\nserver.\n\n\n-----\n\nIP Domain Hosting provider First seen Details\n\nGamaredon C&C\nN/A `login.kifales[.]ru` N/A 2022-12-02\nserver.\n\nGamaredon C&C\nN/A `hakold[.]ru` N/A 2022-12-15\nserver.\n\nGamaredon C&C\nN/A `amasiyagi[.]ru` N/A 2023-02-07\nserver.\n\nGamaredon C&C\n`67.205.160[.]237` N/A DigitalOcean, LLC 2023-04-11\nserver.\n\nGamaredon C&C\nN/A `absorbeni[.]ru` N/A 2023-05-09\nserver.\n\nGamaredon C&C\n`80.90.181[.]107` N/A TimeWeb Ltd. 2023-05-22\nserver.\n\nGamaredon C&C\n`185.163.45[.]5` N/A MivoCloud SRL 2023-06-12\nserver.\n\nGamaredon C&C\nN/A `rieturc[.]ru` N/A 2023-06-20\nserver.\n\nGamaredon C&C\n`5.181.156[.]109` N/A MivoCloud SRL 2023-06-21\nserver.\n\nGamaredon C&C\n`188.166.247[.]34` N/A DigitalOcean, LLC 2023-06-21\nserver.\n\n\n`194.180.191[.]30` N/A\n\n\nMivoCloud\nAdministrator,\n\nORG-MS569-RIPE\n\n\nGamaredon C&C\n2023-06-30\nserver.\n\n\nGamaredon C&C\nN/A `opela[.]ru` N/A 2023-07-10\n\nserver.\n\nGamaredon C&C\n`159.223.152[.]63` N/A DigitalOcean, LLC 2023-07-10\n\nserver.\n\n\nGamaredon C&C\nN/A `marginisbi[.]ru` N/A 2023-07-11\n\nserver.\n\nGamaredon C&C\nN/A `tolofa[.]ru` N/A 2023-08-04\n\nserver.\n\n\n-----\n\nIP Domain Hosting provider First seen Details\n\n\n`212.18.104[.]56` N/A\n\n`89.23.107[.]188` N/A\n\n\nGLOBAL\nINTERNET\n\nSOLUTIONS LLC\n\nGLOBAL\n\nINTERNET\nSOLUTIONS LLC\n\n\nGamaredon C&C\n2023-08-04\nserver.\n\nGamaredon C&C\n2023-08-11\n\nserver.\n\n\nGamaredon C&C\n`5.252.178[.]140` N/A MivoCloud SRL 2023-08-16\nserver.\n\n\n`141.98.233[.]17` N/A\n\n`185.225.19[.]16` N/A\n\n\nGLOBAL\nINTERNET\n\nSOLUTIONS LLC\n\nMivoCloud\n\nAdministrator,\nORG-MS569-RIPE\n\n\nGamaredon C&C\n2023-08-17\nserver.\n\nGamaredon C&C\n2023-08-18\n\nserver.\n\n\nGamaredon C&C\n`209.97.165[.]187` N/A DigitalOcean, LLC 2023-08-18\nserver.\n\nGamaredon C&C\n`91.200.148[.]232` N/A TimeWeb Ltd. 2023-08-24\nserver.\n\nGamaredon C&C\nN/A `havxcq[.]ru` N/A 2023-08-30\nserver.\n\nGamaredon C&C\n`164.92.115[.]188` N/A DigitalOcean, LLC 2023-08-30\nserver.\n\n\nGamaredon C&C\nserver.\n\n\n`89.185.84[.]204` N/A\n\n\nGLOBAL\nINTERNET\n\nSOLUTIONS LLC\n\n\n2023-0906\n\n\nGamaredon C&C\n`159.203.14[.]8` N/A DigitalOcean, LLC 2023-09-07\n\nserver.\n\n\n`46.29.234[.]46` N/A\n\n\nGLOBAL\n\nINTERNET\nSOLUTIONS LLC\n\n\nGamaredon C&C\n2023-09-18\n\nserver.\n\n\nGamaredon C&C\n`161.35.106[.]28` N/A DigitalOcean, LLC 2023-09-18\nserver.\n\n\n-----\n\nIP Domain Hosting provider First seen Details\n\nGamaredon C&C\n`144.126.218[.]218` N/A DigitalOcean, LLC 2023-09-20\nserver.\n\nGamaredon C&C\nN/A `statuesque[.]ru` N/A 2023-09-25\nserver.\n\n\n`195.133.88[.]128` N/A\n\n\nGLOBAL\nINTERNET\n\nSOLUTIONS LLC\n\n\nGamaredon C&C\n2023-09-29\nserver.\n\n\nGamaredon C&C\nN/A `fritopa[.]ru` N/A 2023-09-30\n\nserver.\n\nGamaredon C&C\n`165.227.208[.]207` N/A DigitalOcean, LLC 2023-09-30\n\nserver.\n\n\nGamaredon C&C\n`89.19.209[.]154` N/A TimeWeb Ltd. 2023-10-02\n\nserver.\n\nGamaredon C&C\nN/A `lokalut[.]ru` N/A 2023-10-09\n\nserver.\n\n\nGamaredon C&C\n`143.198.160[.]45` N/A DigitalOcean, LLC 2023-10-16\n\nserver.\n\nGamaredon C&C\nN/A `consentesto[.]ru` N/A 2023-10-23\n\nserver.\n\n\n`167.172.139[.]39` N/A\n\n\nRIPE-NCC\nLEGACY-MNT,\nORG-NCC1-RIPE\n\n\nGamaredon C&C\n2023-10-23\n\nserver.\n\n\nGamaredon C&C\n`185.163.47[.]177` N/A MivoCloud SRL 2023-11-01\nserver.\n\nGamaredon C&C\n`89.185.84[.]141` `www.toorisugita[.]ru` N/A 2023-11-02\nserver.\n\nGamaredon C&C\n`68.183.2[.]92` N/A DigitalOcean, LLC 2023-11-02\nserver.\n\nGamaredon C&C\nN/A `dfgqdsd[.]ru` N/A 2023-11-09\nserver.\n\nGamaredon C&C\nN/A `youdad[.]ru` N/A 2023-11-27\nserver.\n\n\n-----\n\nIP Domain Hosting provider First seen Details\n\nGamaredon C&C\nN/A `loturam[.]ru` N/A 2023-12-04\nserver.\n\nGamaredon C&C\nN/A `nikortal[.]ru` N/A 2023-12-06\nserver.\n\nGamaredon C&C\nN/A `nododru[.]ru` N/A 2023-12-20\nserver.\n\n\n`62.133.62[.]73` N/A\n\n\nGLOBAL\nINTERNET\n\nSOLUTIONS LLC\n\n\nGamaredon C&C\n2023-12-20\nserver.\n\n\n### MITRE ATT&CK TECHNIQUES\n\nThis table was built using version 15 of the MITRE ATT&CK framework.\n\nTactic ID Name Description\n\n\nGamaredon registers domains for its C&C\nservers.\n\nGamaredon rents servers for its C&C\ninfrastructure.\n\nGamaredon develops its own custom\nmalware.\n\nGamaredon uses various open-source\ntools like ReVBShell and Cloudflare Tunnel\n\nclient.\n\nGamaredon sends spearphishing emails\nwith malicious attachments.\n\nPteroLNK weaponizes USB drives to move\nlaterally.\n\nGamaredon uses PowerShell to execute\n\npayloads.\n\n\nResource\nDevelopment\n\nInitial Access\n\n\nAcquire Infrastructure:\n_[T1583.001](https://attack.mitre.org/versions/v15/techniques/T1583/001)_\nDomains\n\nAcquire Infrastructure:\n_[T1583.003](https://attack.mitre.org/versions/v15/techniques/T1583/003)_\nVirtual Private Server\n\nDevelop Capabilities:\n_[T1587.001](https://attack.mitre.org/versions/v15/techniques/T1587/001)_\nMalware\n\nObtain Capabilities:\n_[T1588.002](https://attack.mitre.org/versions/v15/techniques/T1588/002)_\n\nTool\n\nPhishing:\n\n\n_[T1566.001](https://attack.mitre.org/versions/v15/techniques/T1566/001)_\n\n\nSpearphishing\nAttachment\n\n\nReplication Through\n_[T1091](https://attack.mitre.org/versions/v15/techniques/T1091)_\nRemovable Media\n\n\nExecution _[T1059.001](https://attack.mitre.org/versions/v15/techniques/T1059/001)_\n\n\nCommand and\nScripting Interpreter:\n\nPowerShell\n\n\n-----\n\nTactic ID Name Description\n\n\n_[T1059.005](https://attack.mitre.org/versions/v15/techniques/T1059/005)_\n\n_[T1559.001](https://attack.mitre.org/versions/v15/techniques/T1559/001)_\n\n\nCommand and\nScripting Interpreter:\n\nVisual Basic\n\nInter-Process\n\nCommunication:\nComponent Object\n\nModel\n\n\n_[T1106](https://attack.mitre.org/versions/v15/techniques/T1106)_ Native API\n\nScheduled Task/Job:\n_[T1053.005](https://attack.mitre.org/versions/v15/techniques/T1053/005)_\nScheduled Task\n\nUser Execution:\n_[T1204.001](https://attack.mitre.org/versions/v15/techniques/T1204/001)_\n\nMalicious Link\n\n\nUser Execution:\n_[T1204.002](https://attack.mitre.org/versions/v15/techniques/T1204/002)_\n\nMalicious File\n\nWindows Management\n_[T1047](https://attack.mitre.org/versions/v15/techniques/T1047)_\n\nInstrumentation\n\nBoot or Logon\n\n\nGamaredon uses VBScript to execute\npayloads.\n\nPteroPSLoad uses the COM object\n```\nMSScriptControl.ScriptControl.1 to\n\n```\nexecute VBScript payloads.\n\nPteroCDrop uses the WinAPI\n```\nCreateProcess to execute VBScript\n\n```\npayloads.\n\nPteroClone creates a scheduled task to\nexecute the rclone utility when certain\n\nconditions are met.\n\nGamaredon uses LNK files in its\n\nspearphishing campaigns.\n\nGamaredon uses HTA files in its\n\nspearphishing campaigns.\n\nPteroLNK uses WMI to discover connected\n\nUSB drives.\n\nDownloader of PteroPSDoor variant 1 uses\nthe Startup directory for persistence.\n\nPteroSand achieves persistence by setting\nthe UserInitMprLogonScript registry key.\n\nPteroTemplate inserts a VBA macro into\n\nthe Normal.dotm template to achieve\npersistence.\n\nPteroPSLoad creates a scheduled task for\npersistence.\n\nPteroSand uses base64 to decode\ndownloaded payloads.\n\n\nAutostart Execution:\nRegistry Run Keys /\n\nStartup Folder\n\nBoot or Logon\n\nInitialization Scripts:\nLogon Script\n\n(Windows)\n\nOffice Application\n\nStartup: Office\nTemplate Macros\n\n\nPersistence\n\n\n_[T1547.001](https://attack.mitre.org/versions/v15/techniques/T1547/001)_\n\n_[T1037.001](https://attack.mitre.org/versions/v15/techniques/T1037/001)_\n\n_[T1137.001](https://attack.mitre.org/versions/v15/techniques/T1137/001)_\n\n\nScheduled Task/Job:\n_[T1053.005](https://attack.mitre.org/versions/v15/techniques/T1053/005)_\nScheduled Task\n\nDeobfuscate/Decode\nDefense Evasion _[T1140](https://attack.mitre.org/versions/v15/techniques/T1140)_\nFiles or Information\n\n\n-----\n\nTactic ID Name Description\n\nHide Artifacts: Hidden\n_[T1564.001](https://attack.mitre.org/versions/v15/techniques/T1564/001)_ PteroLNK creates hidden files.\nFiles and Directories\n\n\nImpair Defenses:\n_[T1562.001](https://attack.mitre.org/versions/v15/techniques/T1562/001)_\nDisable or Modify Tools\n\nIndicator Removal: File\n_[T1070.004](https://attack.mitre.org/versions/v15/techniques/T1070/004)_\nDeletion\n\n\nPteroSocks disables AMSI by calling the\nmethod AmsiUtils.Uninitialize.\n\nPteroPSDoor deletes staged files after\nsuccessful exfiltration.\n\nGamaredon creates registry keys with\nbenign-looking names.\n\nPteroLNK creates files with so-called\n\ndouble extensions .docx.lnk and\n```\n.rtf.lnk.\n\n```\n\n_[T1036.004](https://attack.mitre.org/versions/v15/techniques/T1036/004)_\n\n\nMasquerading:\nMasquerade Task or\n\nService\n\n\nMasquerading: Double\n_[T1036.007](https://attack.mitre.org/versions/v15/techniques/T1036/007)_\n\nFile Extension\n\n\nPteroDoc modifies the registry to disable\n_[T1112](https://attack.mitre.org/versions/v15/techniques/T1112)_ Modify Registry\nWord macro security.\n\n\nGamaredon uses HTML smuggling in its\nspearphishing campaigns.\n\nPteroCDrop drops an embedded payload.\n\nGamaredon uses base64 to encode\nPowerShell commands.\n\nPteroDig installs itself into the Registry.\n\nGamaredon obfuscates strings in payloads.\n\nGamaredon uses mshta.exe to execute\nHTA files.\n\n\n_[T1027.006](https://attack.mitre.org/versions/v15/techniques/T1027/006)_\n\n_[T1027.009](https://attack.mitre.org/versions/v15/techniques/T1027/009)_\n\n_[T1027.010](https://attack.mitre.org/versions/v15/techniques/T1027/010)_\n\n_[T1027.011](https://attack.mitre.org/versions/v15/techniques/T1027/011)_\n\n_[T1027.013](https://attack.mitre.org/versions/v15/techniques/T1027/013)_\n\n\nObfuscated Files or\nInformation: HTML\n\nSmuggling\n\nObfuscated Files or\n\nInformation:\nEmbedded Payloads\n\nObfuscated Files or\nInformation:\n\nCommand Obfuscation\n\nObfuscated Files or\n\nInformation: Fileless\nStorage\n\nObfuscated Files or\nInformation:\n\nEncrypted/Encoded\nFile\n\n\nSystem Binary Proxy\n_[T1218.005](https://attack.mitre.org/versions/v15/techniques/T1218/005)_\nExecution: Mshta\n\n\nPteroDoc inserts references to malicious\n_[T1221](https://attack.mitre.org/versions/v15/techniques/T1221)_ Template Injection\nremote templates into Word documents.\n\n\n-----\n\nTactic ID Name Description\n\n\nExecution Guardrails:\n_[T1480.001](https://attack.mitre.org/versions/v15/techniques/T1480/001)_\nEnvironmental Keying\n\nCredentials from\n\n\n_[T1555.003](https://attack.mitre.org/versions/v15/techniques/T1555/003)_\n\n\nPassword Stores:\nCredentials from Web\n\nBrowsers\n\n\nCredential\nAccess\n\nDiscovery\n\n\n_[T1518.001](https://attack.mitre.org/versions/v15/techniques/T1518/001)_\n\n\nSteal Web Session\n_[T1539](https://attack.mitre.org/versions/v15/techniques/T1539)_\n\nCookie\n\nUnsecured Credentials:\n_[T1552.002](https://attack.mitre.org/versions/v15/techniques/T1552/002)_\n\nCredentials in Registry\n\n\nPteroX uses the volume serial number\nfrom a compromised system as an XOR\n\nkey for payloads.\n\nPteroSteal gathers and exfiltrates\ncredentials stored by various browsers.\n\nPteroCookie gathers and exfiltrates\n\ncookies stored by various browsers.\n\nPteroSteal gathers and exfiltrates Outlook\n\ncredentials stored in the registry.\n\nPteroPSDoor searches for files with\n\nspecific file extensions.\n\nPteroScout enumerates installed software.\n\nPteroScout exfiltrates the output of the\n```\nsysteminfo command.\n\n```\nPteroLNK can move laterally via\nweaponized USB drives.\n\nPteroPSDoor exfiltrates files with specific\nfile extensions from a compromised\n\nsystem.\n\nPteroPSDoor exfiltrates files with specific\n\nfile extensions from mapped network\ndrives.\n\nPteroPSDoor exfiltrates files with specific\nfile extensions from connected USB drives.\n\nPteroPSDoor stages files prior to\nexfiltration.\n\n\nFile and Directory\n_[T1083](https://attack.mitre.org/versions/v15/techniques/T1083)_\n\nDiscovery\n\n\nSoftware Discovery:\n\nSecurity Software\nDiscovery\n\n\nSystem Information\n_[T1082](https://attack.mitre.org/versions/v15/techniques/T1082)_\nDiscovery\n\nLateral Replication Through\n_[T1091](https://attack.mitre.org/versions/v15/techniques/T1091)_\nMovement Removable Media\n\nData from Local\n_[T1005](https://attack.mitre.org/versions/v15/techniques/T1005)_\nSystem\n\n\nCollection\n\n\nData from Network\n_[T1039](https://attack.mitre.org/versions/v15/techniques/T1039)_\n\nShared Drive\n\nData from Removable\n_[T1025](https://attack.mitre.org/versions/v15/techniques/T1025)_\nMedia\n\nData Staged: Local\n_[T1074.001](https://attack.mitre.org/versions/v15/techniques/T1074/001)_\nData Staging\n\n\nPteroScreen captures and exfiltrates\n_[T1113](https://attack.mitre.org/versions/v15/techniques/T1113)_ Screen Capture\nscreenshots.\n\n\n-----\n\nTactic ID Name Description\n\n\n_[T1071.001](https://attack.mitre.org/versions/v15/techniques/T1071/001)_\n\n\nApplication Layer\nProtocol: Web\n\nProtocols\n\n\nData Encoding:\n_[T1132.001](https://attack.mitre.org/versions/v15/techniques/T1132/001)_\n\nStandard Encoding\n\nDynamic Resolution:\n_[T1568.001](https://attack.mitre.org/versions/v15/techniques/T1568/001)_\n\nFast Flux DNS\n\n\nGamaredon uses HTTP and HTTPS\nprotocols for C&C communication.\n\nPteroCookie uses base64 to encode data\n\nprior to exfiltration.\n\nGamaredon uses fast flux DNS for its C&C\n\ninfrastructure.\n\n\nCommand and\nControl\n\nExfiltration\n\n\nPteroPSLoad obtains the C&C IP address\n_[T1008](https://attack.mitre.org/versions/v15/techniques/T1008)_ Fallback Channels\n\nfrom a Telegram channel.\n\n\n_[T1105](https://attack.mitre.org/versions/v15/techniques/T1105)_ Ingress Tool Transfer\n\nNon-Application Layer\n_[T1095](https://attack.mitre.org/versions/v15/techniques/T1095)_\nProtocol\n\n\nPteroClone uses the rclone utility to\n\ndownload payloads from MEGA cloud\nstorage.\n\nPteroPShell uses the TCP protocol for C&C\ncommunication.\n\n\nPteroSocks serves as a reverse SOCKS\n_[T1090](https://attack.mitre.org/versions/v15/techniques/T1090)_ Proxy\nproxy server.\n\n\nWeb Service: Dead\n_[T1102.001](https://attack.mitre.org/versions/v15/techniques/T1102/001)_\nDrop Resolver\n\nExfiltration Over C2\n_[T1041](https://attack.mitre.org/versions/v15/techniques/T1041)_\nChannel\n\n\nPteroPSLoad obtains its C&C IP address\nfrom the telegra.ph service.\n\nPteroPSDoor exfiltrates files over the C&C\nchannel.\n\nPteroClone exfiltrates data to the MEGA\ncloud storage.\n\n\n_[T1567.002](https://attack.mitre.org/versions/v15/techniques/T1567/002)_\n\n\nExfiltration Over Web\nService: Exfiltration to\n\nCloud Storage\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://web-assets.esetstatic.com/wls/en/papers/white-papers/cyberespionage-gamaredon-way.pdf"
    ],
    "report_names": [
        "cyberespionage-gamaredon-way.pdf"
    ],
    "threat_actors": [
        {
            "id": "81bd7107-6b2d-45c9-9eea-1843d4b9b308",
            "created_at": "2022-10-25T15:50:23.320841Z",
            "updated_at": "2025-03-27T02:00:55.441723Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Gamaredon Group",
                "IRON TILDEN",
                "Primitive Bear",
                "ACTINIUM",
                "Armageddon",
                "Shuckworm",
                "DEV-0157",
                "Aqua Blizzard"
            ],
            "source_name": "MITRE:Gamaredon Group",
            "tools": [
                "QuietSieve",
                "Pteranodon",
                "PowerPunch"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "11f52079-26d3-4e06-8665-6a0b3efdc41c",
            "created_at": "2022-10-25T16:07:23.736987Z",
            "updated_at": "2025-03-27T02:02:09.954078Z",
            "deleted_at": null,
            "main_name": "InvisiMole",
            "aliases": [
                "UAC-0035"
            ],
            "source_name": "ETDA:InvisiMole",
            "tools": [
                "InvisiMole"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d5156b55-5d7d-4fb2-836f-861d2e868147",
            "created_at": "2023-01-06T13:46:38.557326Z",
            "updated_at": "2025-03-27T02:00:02.861124Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Aqua Blizzard",
                "Actinium",
                "DEV-0157",
                "Blue Otso",
                "G0047",
                "PRIMITIVE BEAR",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder",
                "ACTINIUM",
                "BlueAlpha",
                "IRON TILDEN"
            ],
            "source_name": "MISPGALAXY:Gamaredon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "12b5d602-4017-4a6f-a2a3-387a6e07a27b",
            "created_at": "2023-01-06T13:46:39.095233Z",
            "updated_at": "2025-03-27T02:00:02.995336Z",
            "deleted_at": null,
            "main_name": "InvisiMole",
            "aliases": [],
            "source_name": "MISPGALAXY:InvisiMole",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9041c438-4bc0-4863-b89c-a32bba33903c",
            "created_at": "2023-01-06T13:46:38.232751Z",
            "updated_at": "2025-03-27T02:00:02.778714Z",
            "deleted_at": null,
            "main_name": "Nitro",
            "aliases": [
                "Covert Grove"
            ],
            "source_name": "MISPGALAXY:Nitro",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a2b44a04-a080-4465-973d-976ce53777de",
            "created_at": "2022-10-25T16:07:23.911791Z",
            "updated_at": "2025-03-27T02:02:10.025108Z",
            "deleted_at": null,
            "main_name": "Nitro",
            "aliases": [
                "Covert Grove",
                "Nitro"
            ],
            "source_name": "ETDA:Nitro",
            "tools": [
                "AngryRebel",
                "Backdoor.Apocalipto",
                "Chymine",
                "Darkmoon",
                "Farfli",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "Moudour",
                "Mydoor",
                "PCClient",
                "PCRat",
                "Poison Ivy",
                "SPIVY",
                "Spindest",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "61940e18-8f90-4ecc-bc06-416c54bc60f9",
            "created_at": "2022-10-25T16:07:23.659529Z",
            "updated_at": "2025-03-27T02:02:09.912404Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Actinium",
                "Aqua Blizzard",
                "Armageddon",
                "Blue Otso",
                "BlueAlpha",
                "Callisto",
                "DEV-0157",
                "Iron Tilden",
                "Operation STEADY#URSA",
                "Primitive Bear",
                "SectorC08",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder"
            ],
            "source_name": "ETDA:Gamaredon Group",
            "tools": [
                "Aversome infector",
                "BoneSpy",
                "DessertDown",
                "DilongTrash",
                "DinoTrain",
                "EvilGnome",
                "FRAUDROP",
                "Gamaredon",
                "GammaDrop",
                "GammaLoad",
                "GammaSteel",
                "Gussdoor",
                "ObfuBerry",
                "ObfuMerry",
                "PlainGnome",
                "PowerPunch",
                "Pteranodon",
                "Pterodo",
                "QuietSieve",
                "Remote Manipulator System",
                "Resetter",
                "RuRAT",
                "SUBTLE-PAWS",
                "UltraVNC"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "236a8303-bf12-4787-b6d0-549b44271a19",
            "created_at": "2024-06-04T02:03:07.966137Z",
            "updated_at": "2025-03-27T02:05:17.410356Z",
            "deleted_at": null,
            "main_name": "IRON TILDEN",
            "aliases": [
                "Aqua Blizzard ",
                "Armageddon",
                "Blue Otso ",
                "BlueAlpha ",
                "Dancing Salome ",
                "Gamaredon",
                "Gamaredon Group",
                "Hive0051 ",
                "Primitive Bear ",
                "Shuckworm ",
                "Trident Ursa ",
                "UAC-0010 ",
                "UNC530 ",
                "WinterFlounder ",
                "ACTINIUM "
            ],
            "source_name": "Secureworks:IRON TILDEN",
            "tools": [
                "Pterodo"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1729821977,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1727708318,
    "ts_modification_date": 1727708417,
    "files": {
        "pdf": "https://archive.orkl.eu/d3f9c773389f17b868a23739bed521300cea3bae.pdf",
        "text": "https://archive.orkl.eu/d3f9c773389f17b868a23739bed521300cea3bae.txt",
        "img": "https://archive.orkl.eu/d3f9c773389f17b868a23739bed521300cea3bae.jpg"
    }
}