{
    "id": "bbb16ce2-fa9b-453f-9877-3dab31c1bbbd",
    "created_at": "2023-01-12T15:04:49.588737Z",
    "updated_at": "2025-03-27T02:06:13.904076Z",
    "deleted_at": null,
    "sha1_hash": "68ea98c7f7baabafa6177d2e3c43931c4e42635f",
    "title": "2022-01-12 - Unpacking Ramnit malware",
    "authors": "",
    "file_creation_date": "2022-05-27T18:58:14Z",
    "file_modification_date": "2022-05-27T18:58:14Z",
    "file_size": 1534053,
    "plain_text": "# Unpacking Ramnit malware\n\n**muha2xmad.github.io/unpacking/ramnit/**\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n3 minute read\n\n**As-salamu Alaykum**\n\n## Introducton\n\n\nJanuary 12, 2022\n\n\nThe Ramnit Trojan is a type of malware able to exfiltrate sensitive data. This kind of data can\ninclude anything ranging from banking credentials, FTP passwords, session cookies, and\npersonal data. Leaking this information can easily destroy user trust in a business, and in the\n[process lose customers and ruin reputations. 1](https://www.cybereason.com/blog/banking-trojan-delivered-by-lolbins-ramnit-trojan)\n\nMD5: 6B71498D63E05F83648E6D9A9CEDBF0A\n\n## Static\n\nOpen the sample in `DiE we see that it’s high` `Entropy and it’s packed.`\n\n## Unpacking process\n\n\n-----\n\nDrag the sample into `x32dbg and set BPs at` `VirtualAlloc,` `VirtualProtect,`\n```\nCreateProcessInternalW, IsDebuggerPresent, WriteProcessMemory, and\nNtResumeThread . Then press F9 we to hit the first BP. As we know that Ramnit\n\n```\nmalware is a dropper, we see that it’s dropping a file in the same directory where the sample\nis being debugged.\n\nFigure(1):\n\nFigure(2):\n\nThen press `F9 now we hit` `NtResumeThread BP now we know that it’s injecting unpacking`\ncode. If we open `Process Hacker we see under the` `ramnit process there’s a`\n```\nramnitmgr.exe child process which is suspended. The parent process is ramnit.bin\n\n```\nand the child process is `ramnitmgr.exe .`\n\nFigure(3):\n\n\n-----\n\nNow Don’t close the debugger. Open a new `x32dbg window the press` `file in the`\nmenu then `attach the child process. Now we have two` `x32dbg windows are opened.`\nNow if we try to set BPs in the debugger of the `child process it says it’s` `invalid add`\nbecause the process still suspended. To activate go to the debugger of the `parent process`\nand `run to user code . Now go to the` `child debugger and set the first 5 BPs as we did`\nabove.\n\nFigure(4):\n\nReturn to `Parent debugger, press` `F9 to hit` `IsDebuggerPresent BP, beacause the`\ndebugger is present so `EAX is set to` `1 if we continue the debugger will exit and pops up`\n```\nthis is a compiled autoit script . So we need to change it to 0 . Now Execute\ntill return and double click on EAX and change it to 0 . After that run F9 again\n\n```\nand `IsDebuggerPresent BP hits do the same and change it to` `0 and then run` `F9 .`\n\nFigure(5):\n\n\n-----\n\nNow we go back to the `child process debugger to get the unpacked file. Then run` `F9`\nhits `VirtualProtect BP then` `Execute till return we see the 2nd parameter points`\nto a location `400000 and change the permission to` `RWC which an indicator of unpacking.`\nThen we dump it we see `MZ magic byte. Run F9 again we see the same location but`\nchanges the permission to `R which an indicator to finish unpacking. We go and` `Follow in`\n```\nMemory map and save it. Analyze it then come back it’s not our goal.\n\n```\nFigure(6):\n\nNow we are back and press `F9 hits` `VirtualAlloc BP and` `Execute till return we`\nsee it’s allocating memory then dump `EAX in` `dump 2 then press` `F9 we see it’s`\nunpacking some strange strings in the `dump 2 . Then` `Execute till return and dump`\n```\nEAX in dump 3 then press F9 we see dump 3 is empty. Then Execute till return\n\n```\nand dump `EAX to` `dump 4 . Then run` `F9 and chech` `dump 4 we see our unpacked file.`\n\nFigure(7):\n\nNow we open `Process Hacker to save our unpacked file which is packed with` `UPX . The`\nOEP might be different to yours. Then unpack `UPX using` `CFF Explorer tool.`\n\n\n-----\n\nFigure(8):\n\n## Article quote\n\nﯾﺤﯿﺎ اﻟﺤﺰنُ ﻓﻲ ﻋﯿﻨﯿﻚ[َ] ﻟﻦ ﯾﺪومَ اﻟﻬﻢﱡ ﯾﺎ ﺣﻠﻮَ اﻟﻤُﺤﯿّﺎ، ﻟﻦ ﯾﻈﻞ[ّ]\n\n## REF\n\n1- [https://www.cybereason.com/blog/banking-trojan-delivered-by-lolbins-ramnit-trojan](https://www.cybereason.com/blog/banking-trojan-delivered-by-lolbins-ramnit-trojan)\n\n2- [https://www.youtube.com/watch?v=l6ZunH6YG0A&ab_channel=GuidedHacking](https://www.youtube.com/watch?v=l6ZunH6YG0A&ab_channel=GuidedHacking)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-12 - Unpacking Ramnit malware.pdf"
    ],
    "report_names": [
        "2022-01-12 - Unpacking Ramnit malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535889,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653677894,
    "ts_modification_date": 1653677894,
    "files": {
        "pdf": "https://archive.orkl.eu/68ea98c7f7baabafa6177d2e3c43931c4e42635f.pdf",
        "text": "https://archive.orkl.eu/68ea98c7f7baabafa6177d2e3c43931c4e42635f.txt",
        "img": "https://archive.orkl.eu/68ea98c7f7baabafa6177d2e3c43931c4e42635f.jpg"
    }
}