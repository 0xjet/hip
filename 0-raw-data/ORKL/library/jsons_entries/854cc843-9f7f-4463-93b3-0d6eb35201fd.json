{
    "id": "854cc843-9f7f-4463-93b3-0d6eb35201fd",
    "created_at": "2022-10-25T16:48:21.926996Z",
    "updated_at": "2025-03-27T02:16:49.081638Z",
    "deleted_at": null,
    "sha1_hash": "e0fce95ccdb9c400f2dd3859ebe268f5bc7877ce",
    "title": "Global Energy Cyberattacks: Night Dragon",
    "authors": "McAfee",
    "file_creation_date": "2011-02-11T15:30:50Z",
    "file_modification_date": "2011-02-11T15:31:21Z",
    "file_size": 2576720,
    "plain_text": "# Global Energy Cyberattacks: “Night Dragon”\n\n### By McAfee[®] Foundstone[®] Professional Services and McAfee Labs[™]\n\n February 10, 2011\n\n\n-----\n\n## Table of Contents\n\nExecutive Summary 3\n\nAnatomy of a Hack 3\n\nDetails of the Attack 4\n\nUse of remote administration tools 7\n\nDetection 7\n\nHost Files and Registry Keys 8\n\nAnti-virus Alerts 9\n\nNetwork Communications 9\n\nAdditional Detection Techniques 11\n\nMcAfee Early Detection 11\n\nMcAfee Detection 12\n\nMcAfee Prevention 12\n\nConclusion 13\n\nCredits and Acknowledgements 13\n\nAppendix A: zwShell — the RAT 13\n\nAppendix B: Attribution 18\n\nVersion 1 4 | Feb 11 2011 03:30 PM\n\n\n-----\n\nExecutive Summary\nIn 2010, we entered a new decade in the world of cybersecurity. The prior decade was stained with\nimmaturity, reactive technical solutions, and a lack of security sophistication that promoted critical\noutbreaks, such as Code Red, Nimda, Blaster, Sasser, SQL Slammer, Conficker, and myDoom—to name a\nfew. The security community has evolved and grown smarter about security, safe computing, and system\nhardening but so have our adversaries. This decade is setting up to be the exponential jumping off point.\nThe adversaries are rapidly leveraging productized malware toolkits that let them develop more malware\n\nthan in all prior years combined, and they have matured from the prior decade to release the most\ninsidious and persistent cyberthreats ever known.\n\n[The Google hacks (“Operation Aurora”), named by McAfee and announced in January 2010, and the](http://www.mcafee.com/us/threat-center/operation-aurora.aspx)\n\n[WikiLeaks document disclosures of 2010 have highlighted the fact that external and internal threats](http://blogs.mcafee.com/corporate/cto/got-wikileaks-call-a-mcafee-dlplumberÉ)\nare nearly impossible to prevent. Miscreants continue to infiltrate networks and exfiltrate sensitive and\nproprietary data upon which the world’s economies depend every day. When a new attack emerges,\nsecurity vendors cannot stand by idly and watch. We are obligated to share our findings to protect those\n[not yet impacted and to repair those who have been. As such, McAfee Foundstone Professional Services](http://www.foundstone.com/)\n[and McAfee Labs decided to release the following discovery.](http://www.mcafee.com/us/mcafee-labs.aspx)\n\nStarting in November 2009, coordinated covert and targeted cyberattacks have been conducted against\nglobal oil, energy, and petrochemical companies. These attacks have involved social engineering, spearphishing attacks, exploitation of Microsoft Windows operating systems vulnerabilities, Microsoft Active\nDirectory compromises, and the use of remote administration tools (RATs) in targeting and harvesting\nsensitive competitive proprietary operations and project-financing information with regard to oil and gas\nfield bids and operations. We have identified the tools, techniques, and network activities used in these\ncontinuing attacks — which we have dubbed Night Dragon — as originating primarily in China. Through\ncoordinated analysis of the related events and tools used, McAfee has determined identifying features\nto assist companies with detection and investigation. While we believe many actors have participated\nin these attacks, we have been able to identify one individual who has provided the crucial C&C\ninfrastructure to the attackers. (See Appendix B for more detail on attribution.)\n\nAnatomy of a Hack\n\n**1** **2** **3** **4** **5**\n\n### NIGHT DRAGON\n\nGained access Enabled direct\n\nAccessed Exfiltrated email\n\nExtranet web to sensitive communication\n\nadditional archives and\n\nservers internal from infected\n\nusernames and other sensitive\n\ncompromised desktops and machines to the\n\npasswords documents\n\nservers Internet\n\nGlobal Energy\nCyberattacks\n\nRemote Hacker tools Further access Disabled IE Executives’\ncommand uploaded to to sensitive proxy settings computers\nexecution servers documents compromised\n\nFigure 1. Anatomy of a hack.\n\n|1 Extranet web servers compromised Remote command execution|2 Gained access to sensitive internal desktops and servers Hacker tools uploaded to servers|3 Accessed additional usernames and passwords Further access to sensitive documents|4 Enabled direct communication from infected machines to the Internet Disabled IE proxy settings|\n|---|---|---|---|\n\n\n-----\n\nThe Night Dragon attacks work by methodical and progressive intrusions into the targeted infrastructure.\nThe following basic activities were performed by the Night Dragon operation:\n\n- Company extranet web servers compromised through SQL-injection techniques, allowing remote\n\ncommand execution\n\n- Commonly available hacker tools are uploaded on compromised web servers, allowing attackers to\n\npivot into the company’s intranet and giving them access to sensitive desktops and servers internally\n\n- Using password cracking and pass-the-hash tools, attackers gain additional usernames and passwords,\n\nallowing them to obtain further authenticated access to sensitive internal desktops and servers\n\n- Initially using the company’s compromised web servers as command and control (C&C) servers, the\n\nattackers discovered that they needed only to disable Microsoft Internet Explorer (IE) proxy settings\nto allow direct communication from infected machines to the Internet\n\n- Using the RAT malware, they proceeded to connect to other machines (targeting executives)\n\nand exfiltrating email archives and other sensitive documents\n\nDetails of the Attack\nAttackers using several locations in China have leveraged C&C servers on purchased hosted services in\n\nthe United States and compromised servers in the Netherlands to wage attacks against global oil, gas,\nand petrochemical companies, as well as individuals and executives in Kazakhstan, Taiwan, Greece, and\nthe United States to acquire proprietary and highly confidential information. The primary operational\ntechnique used by the attackers comprised a variety of hacker tools, including privately developed and\ncustomized RAT tools that provided complete remote administration capabilities to the attacker. RATs\nprovide functions similar to Citrix or Microsoft Windows Terminal Services, allowing a remote individual\nto completely control the affected system.\n\nTo deploy these tools, attackers first compromised perimeter security controls, through SQL-injection\n\nexploits of extranet web servers, as well as targeted spear-phishing attacks of mobile worker laptops,\nand compromising corporate VPN accounts to penetrate the targeted company’s defensive architectures\n(DMZs and firewalls) and conduct reconnaissance of targeted companies’ networked computers.\n\n**SQL Injection Attacks**\n\n(1) Attacker crafts a HTTP GET (2) Malware is placed on server and\nrequest to inject commands to SQL used to harvest the local and Active\nserver to gain system-level access Directory account credentials\n\nWeb\n\nSQL\n\nInternet\n\nAD\n\n(4) Attacker uses RAT malware to (3) Active Directory accounts are\nconduct additional reconnaissance C&C used to access network computers\nand systems compromises and to and plant RAT malware that connects\nharvest confidential data with remote C&C addresses.\n\nFigure 2. SQL-injection attacks.\n\n\n**SQL Injection Attacks**\n\n(1) Attacker crafts a HTTP GET (2) Malware is placed on server and\nrequest to inject commands to SQL used to harvest the local and Active\nserver to gain system-level access Directory account credentials\n\nWeb\n\nSQL\n\nInternet\n\nAD\n\n(4) Attacker uses RAT malware to (3) Active Directory accounts are\nconduct additional reconnaissance C&C used to access network computers\nand systems compromises and to and plant RAT malware that connects\nharvest confidential data with remote C&C addresses.\n\n\n-----\n\n**Spear-Phishing Attacks**\n\n(2) User opens infected email and\nthe compromised website is\naccessed; a RAT is downloaded\n\n(1) Attacker sends a spear-phishing\nemail containing a link to a\ncompromised web server Web\n\nEmail\n\nInternet\n\n(4) Attacker uses RAT malware to (3) User account information and\nconduct additional reconnaissance C&C host configuration information is\nand systems compromises and to sent to a C&C server\nharvest confidential data\n\n\nFigure 3. Spear-phishing attacks.\n\nMany Chinese hacker websites offer these tools for download, including links to reduh, WebShell,\nASPXSpy, and many others, plus exploits and zero-day malware.\n\nFigure 4. Rootkin.net.cn offers access to an endless list of hacker tools and exploits.\n\n\n-----\n\nFigure 5. WebShell and ASPXSpy tools allow an attacker to bypass many firewall\nrules to funnel all control through a company’s web server.\n\n\n-----\n\nOnce the initial system was compromised, the attackers compromised local administrator accounts and\nActive Directory administrator (and administrative users) accounts. The attackers often used common\nWindows utilities, such as SysInternals tools (acquired by Microsoft in 2006) — and other publicly available\nsoftware, including hacking tools developed in China and widely available on Chinese underground\nhacker websites — to establish “backdoors” through reverse proxies and planted Trojans that allowed the\nattackers to bypass network and host security policies and settings. Desktop anti-virus and anti-spyware\ntools were also disabled in some instances — a common technique of targeted attacks.\n\nUse of remote administration tools\nRemote administration tools (RATs) are commonly used administrative tools that allow hackers (and\nadministrators) to manage victims’ computers (or managed systems) and completely control their use\nand function. A commonly used RAT in the hacker community is Gh0st and its many variants. RAT\nfeatures often include screen and webcam spying, keystroke logging, mouse control, file/registry,\nand process management, and, of course, remote command shell capability.\n\nMcAfee has identified several RATs that have been used to establish a persistent infiltration channel into\ncompromised companies. One of the most prevalent RATs is zwShell, which McAfee has seen in the wild\nsince the spring of 2010 (compiled on 2010-03-17 08:47:00). Written in the Delphi language, zwShell\nwas used by attackers to both build custom variants of the Trojan that they deployed on dozens of\nmachines within each victim company, as well as to control compromised machines that would initiate\nbeacon connections to it on a custom protocol.\n\nAttackers used zwShell extensively to generate dozens of unique Trojan variants and to control the\n\ninfected machines and exfiltrate sensitive data directly from them. (See Appendix A for a breakdown\nof the zwShell.)\n\nOnce the attackers had complete control of the targeted internal system, they dumped account hashes\nwith gsecdump and used the Cain & Abel tool to crack the hashes to leverage them in targeting ever\nmore sensitive infrastructures.\n\nFiles of interest focused on operational oil and gas field production systems and financial documents\nrelated to field exploration and bidding that were later copied from the compromised hosts or via\nextranet servers. In some cases, the files were copied to and downloaded from company web servers\nby the attackers. In certain cases, the attackers collected data from SCADA systems.\n\nDetection\nThe methods and tools used in these attacks are relatively unsophisticated, as they simply appear to\n\nbe standard host administration techniques, using standard administrative credentials. This is largely\nwhy they are able to evade detection by standard security software and network policies. Since the\ninitial compromises, however, many individual unique signatures have been identified for the Trojan\nand associated tools by security vendors, including McAfee; yet only through recent analysis and\nthe discovery of common artifacts and evidence correlation have we been able to determine that a\ndedicated effort has been ongoing for at least two years, and likely as many as four. We can now\nassociate the various signatures to these events.\n\nThe following artifacts can help to determine whether a company has been compromised:\n\n- Host files and/or registry keys\n\n- Anti-virus alerts\n\n- Network communications\n\n\n-----\n\nHost Files and Registry Keys\n\nUtility Description\n\n**Command &** zwShell.exe 093640a69c8eafbc60343bf9cd1d3ad3\n**control application**\n\nzwShell.exe 85df6b3e2c1a4c6ce20fc8080e0b53e9\n\n**Trojan dropper** A packaged executable customized to each victim that includes the DLL file and configuration settings\nfor installing the backdoor on the remote system.\n\nThe dropper can be run from any directory and is usually executed with PSEXEC or an RDP session.\nThus, related Windows Security Event logs provide useful information concerning compromised Active\n\nDirectory accounts. These logs can be reviewed with Windows Event Log Manager or programs, such\nas “Event Log Explorer” or EnCase, which support search capabilities.\n\nWhen executed, the dropper creates a temporary file that is reflected in Windows update logs\n(KB*.log files in c:\\Windows folder).\n\nThis is because the Windows Registry is modified by the dropper to create a “netsvcs” key. Accordingly,\n\nthe date of the backdoor installation can be determined from a search of the KB log files. This temporary\nfile is also identified in the backdoor DLL itself. The temporary file is usually some alphanumeric\ncombination that includes “gzg” (for example, xgt0gzg); however, it has been seen with generic file\nnames (for example, server.exe) as well.\n\nThe dropper is deleted when the backdoor is installed, and the temporary file is removed when the\ncomputer is restarted. If a backdoor has already been configured on the system, the dropper installation\nwill fail unless it uses a different configuration.\n\n**Trojan backdoor** Dynamic link libraries (DLLs), also appearing under many other names.\n\nThese files have a correlated Windows Registry key that is determined by the dropper when the backdoor\n\nis installed. The dropper iterates through the Windows netsvcs registry keys and uses the first available\nkey, indicating the path and filename of the backdoor in a ServiceDLL register. The backdoor operates as\na service through a “svchost.exe netsvcs –k” registry setting. The service key can be found under:\n\nHKLM\\system\\<controlset>\\services\\\n\nThe DLL is a system or hidden file, 19 KB to 23 KB in size and includes an XOR-encoded data section that\n\nis defined by the C&C application when the dropper is created. It includes the network service identifier,\nregistry service key, service description, mutex name, C&C server address, port, and dropper temporary\nfile name. The backdoor may operate from any configured TCP port.\n\nThis DLL is specified in the ServiceDLL key in the related Windows netsvcs registry entry. The DLL is usually\n\nfound in the %System%\\System32 or %System%\\SysWow64 directory.\n\n**Trojan backdoor 2*** startup.dll A6CBA73405C77FEDEAF4722AD7D35D60\n\nInitially configured with the following:\n\nconnect.dll 6E31CCA77255F9CDE228A2DB9E2A3855\n\nConnect.dll creates the temporary file “HostID.DAT,” which is sent to the C&C server, then downloads\nand configures related DLLs including:\n\n                  - PluginFile.dll\n\n                  - PluginScreen.dll\n\n                  - PluginCmd.dll\n\n                  - PluginKeyboard.dll\n\n                  - PluginProcess.dll\n\n                  - PluginService.dll\n\n                  - PluginRegedit.dll\n\nThereafter “Startup.dll” operates the service under a Windows Registry key. All communications seen\nso far with this version have been on ports 25 and 80 over TCP but can operate on any determined port.\nThe service key is identified in the DLL (which does not include any encrypted data) as:\n\nHKLM\\Software\\RAT\n\nThis DLL is usually found in the %System%\\System32 directory; however, it has also been found in other\n\nlocations. The path to the backdoor DLL is indicated in the Windows Registry ServiceDLL key.\n\n- This DLL uses a different C&C application that may be an earlier version\n\nof zwShell analysis continues\n\n|Utility|Description|\n|---|---|\n|Command & control application|zwShell.exe 093640a69c8eafbc60343bf9cd1d3ad3 zwShell.exe 85df6b3e2c1a4c6ce20fc8080e0b53e9|\n|Trojan dropper|A packaged executable customized to each victim that includes the DLL file and configuration settings for installing the backdoor on the remote system. The dropper can be run from any directory and is usually executed with PSEXEC or an RDP session. Thus, related Windows Security Event logs provide useful information concerning compromised Active Directory accounts. These logs can be reviewed with Windows Event Log Manager or programs, such as “Event Log Explorer” or EnCase, which support search capabilities. When executed, the dropper creates a temporary file that is reflected in Windows update logs (KB*.log files in c:\\Windows folder). This is because the Windows Registry is modified by the dropper to create a “netsvcs” key. Accordingly, the date of the backdoor installation can be determined from a search of the KB log files. This temporary file is also identified in the backdoor DLL itself. The temporary file is usually some alphanumeric combination that includes “gzg” (for example, xgt0gzg); however, it has been seen with generic file names (for example, server.exe) as well. The dropper is deleted when the backdoor is installed, and the temporary file is removed when the computer is restarted. If a backdoor has already been configured on the system, the dropper installation will fail unless it uses a different configuration.|\n|Trojan backdoor|Dynamic link libraries (DLLs), also appearing under many other names. These files have a correlated Windows Registry key that is determined by the dropper when the backdoor is installed. The dropper iterates through the Windows netsvcs registry keys and uses the first available key, indicating the path and filename of the backdoor in a ServiceDLL register. The backdoor operates as a service through a “svchost.exe netsvcs –k” registry setting. The service key can be found under: HKLM\\system\\<controlset>\\services\\ The DLL is a system or hidden file, 19 KB to 23 KB in size and includes an XOR-encoded data section that is defnied by the C&C application when the dropper is created. It includes the network service identifeir, registry service key, service description, mutex name, C&C server address, port, and dropper temporary file name. The backdoor may operate from any configured TCP port. This DLL is specifeid in the ServiceDLL key in the related Windows netsvcs registry entry. The DLL is usually found in the %System%\\System32 or %System%\\SysWow64 directory.|\n|Trojan backdoor 2*|startup.dll A6CBA73405C77FEDEAF4722AD7D35D60 Initially configured with the following: connect.dll 6E31CCA77255F9CDE228A2DB9E2A3855 Connect.dll creates the temporary file “HostID.DAT,” which is sent to the C&C server, then downloads and configures related DLLs including: • PluginFile.dll • PluginScreen.dll • PluginCmd.dll • PluginKeyboard.dll • PluginProcess.dll • PluginService.dll • PluginRegedit.dll Thereafter “Startup.dll” operates the service under a Windows Registry key. All communications seen so far with this version have been on ports 25 and 80 over TCP but can operate on any determined port. The service key is identified in the DLL (which does not include any encrypted data) as: HKLM\\Software\\RAT This DLL is usually found in the %System%\\System32 directory; however, it has also been found in other locations. The path to the backdoor DLL is indicated in the Windows Registry ServiceDLL key.|\n\n\n-----\n\nThe Trojan components are manually copied or delivered through administrative utilities to remote systems.\nThey do not include any worm or self-replicating features, nor can the Trojan “infect” other computers.\n\nRemoving the Trojan components is simply a matter of deleting the related files and registry settings.\n\nThe Trojan backdoor communicates with the C&C server at the address hard-coded in each DLL. The C&C\n\nserver cannot modify the backdoor once it is installed; related systems must have the Trojan file removed\nbefore a new backdoor DLL can be installed on the system. Thus, if the C&C server address is changed,\nthose servers that have the DLL with previous addresses must be remotely administered by the attacker.\n\nAnti-virus Alerts\nAnti-virus patterns are defined according to samples submitted by clients or analysts as they are\ndiscovered. Some Trojans exhibit characteristics of other types of malware, such as worms or viruses,\nthat have the ability to infect other systems. RATs do not typically include such features, and, because\nthey are defined with unique configurations for custom purposes, they commonly change faster than\nunique samples can be identified.\n\nOnly when an entire RAT toolkit is found can we define an anti-virus pattern that is generic enough\nto detect the RAT regardless of configuration changes. The package necessarily includes the C&C\napplication server, the generator utility for creating droppers, related droppers, and backdoors —\nand a sufficient number of each to correlate the toolkit.\n\nAs mentioned previously, there have been several unique patterns developed from samples submitted\n\nto McAfee (as well as to other anti-virus vendors).\n\n\nMcAfee recommends that companies review McAfee ePolicy Orchestrator[®]\n(McAfee ePO[™]) software and anti-virus logs for “NightDragon” signature\ndetections to identify related alerts since 2007 and then recover and resubmit\nthese samples for analysis to investigate the related incidents. McAfee can\nassist with the analysis or provide instructions and tools for internal review.\n\n\nNetwork Communications\nNetwork communications are relatively easy to detect because the malware uses a unique host beacon\nand server response protocol. Each communication packet between the compromised host and the C&C\nserver is signed with a plain text signature of “hW$.” (or “\\x68\\x57\\x24\\x13”) at the byte offset 0x42\nwithin the TCP packet.\n\nThe backdoor begins its beacon at approximately five-second intervals with an initial packet that may\n\nbe detected with the pattern: “\\x01\\x50[\\x00-\\xff]+\\x68\\x57\\x24\\x13.”\n\n\n-----\n\nThe server acknowledges the beacon with an initial response of “\\x01\\x60[\\x00-\\xff]+\\x68\\x57\\x24\\x13.”\n\nThe backdoor sends the password to the server in clear text after the server acknowledges the connection.\n\nWhile the backdoor and the server have an active connection, the backdoor will send “keep-alive”\nmessages that can be detected with: “\\x03\\x50[\\x00-\\xff]+\\x68\\x57\\x24\\x13.”\n\n\n-----\n\nThe attackers use “dynamic DNS” Internet name services accounts to relay C&C communications or\n\ntemporarily associate DNS addresses with remote servers. Primary domains that have been used for C&C\ntraffic include (all of these have been used frequently by other malware):\n\n- [xxxx].is-a-chef.com\n\n- [xxxx].thruhere.net\n\n- [xxxx].office-on-the.net\n\n- [xxxx].selfip.com\n\nNote: The above hostnames (is-a-chef.com<http://is-a-chef.com>, thruhere.net<http://thruhere.net>, officeon-the.net<http://office-on-the.net>, selfip.com<http://selfip.com>) by themselves do not indicate malicious\nactivity and there are plenty of legitimate subdomains that may use those hostnames. Communication to\nthose hostnames should be carefully scrutinized but not necessarily raise alarm on its own\n\nCompany extranet servers have also been used as either unique or secondary/redundant C&C servers.\nIn some instances, the attackers have (probably mistakenly) used droppers configured to compromise\none company’s computers — in another company’s computers.\n\n\nMcAfee recommends that companies configure intrusion detection system\n(IDS) rules to detect the noted signatures (or employ the user-defined signature\n\n[UDS] “BACKDOOR: NightDragon Communication Detected” in McAfee\nNetwork Security Platform) and monitor DNS for outbound communications to\ndynamic DNS addresses resolving to or pathed back as suballocated to servers\nin China, where the company’s name or common abbreviation forms the first\npart of the address. This may be difficult. However, if samples of the backdoor\nDLLs are found, DNS monitoring can help to identify other compromised hosts\nin the company network. McAfee also recommends that companies review\nweb or IDS logs for file transfers to addresses registered in China. McAfee can\nassist with the analysis or provide instructions and tools for internal review.\n\n\nAdditional Detection Techniques\nThe backdoor beacons with its corresponding C&C server as long as the related address is active. If the\naddress is abandoned or unreachable, the backdoor stops beaconing after some undetermined interval.\nWhen a compromised computer is restarted, however, the beaconing begins again because it is registered\nas a service in the Windows Registry. Anti-virus may or may not detect the Trojan unless it is beaconing or\na full file system scan is performed.\n\nMcAfee Early Detection\nCustomers can deploy a number of McAfee products to help protect information systems from the Night\nDragon attack:\n\n- _McAfee Vulnerability Manager: Using agentless discovery and vulnerability checking to assess systems_\n\non your network, McAfee Vulnerability Manager is an enterprise-class vulnerability management\nsystem that will detect infected Night Dragon systems as well as the security weaknesses in systems\nthat have been compromised. The “wham-apt-nightdragon-detected-v7.fasl3” script will detect this\nthreat remotely on systems.\n\n\n-----\n\n- _McAfee Policy Auditor: Using agent-based configuration audit checks to determine the most secure_\n\nconfiguration of a system, McAfee Policy Auditor software detects the security weaknesses in the\nsystems that have been compromised\n\n- _McAfee Risk Advisory (MRA): Properly deployed, McAfee Risk Advisor would have allowed administrators_\n\nto see the misconfigurations and gap in security coverage that facilitated Night Dragon’s exploitation\n\nMcAfee Detection\nNight Dragon also displays a pattern of correlated activities with an assortment of other software tools\nthat McAfee can assist companies to identify.\n\n- _McAfee VirusScan Enterprise: Update your anti-virus .DATs to at least version 6232 and ensure that_\n\non-demand scans are working properly and perform a full file system virus scan. Review McAfee ePO\nsoftware or anti-virus alerts and network logs for “NightDragon” signature detections to identify\n[compromised systems. Please submit any related samples to virus_research@mcafee.com or submit](mailto:virus_research%40mcafee.com?subject=)\n[on the web at https://www.webimmune.net/default.asp.](https://www.webimmune.net/default.asp)\n\n- _McAfee Network Threat Response: McAfee Network Threat Response technology would have detected_\n\nthe malicious C&C traffic and would have alerted administrators to the attack early, giving them time\nto react and prevent future damage\n\nAdministrators can also download the following free tools from McAfee:\n\n- [McAfee “Night Dragon Vulnerability Scanner” based on McAfee Vulnerability Manager technology to](http://www.mcafee.com/us/downloads/free-tools/index.aspx)\n\nscan their networks for the presence of malware\n\n- [McAfee Labs Stinger](http://www.mcafee.com/us/downloads/free-tools/how-to-use-stinger.aspx)\n\nMcAfee Prevention\nFor complete prevention of this and most other attacks involving advanced persistent threats (APTs),\ncustomers can deploy application whitelisting and change/configuration control software on their critical\nservers. These technologies completely prevent the unauthorized running of DLLs/EXEs as well as the\nmodification of registry keys, services, and more involved in all of today’s APT and zero-day attacks.\n\n- _McAfee Application Control: McAfee Application Control software stops Night Dragon by not allowing_\n\nthe dropper files from executing (even as administrator on Windows), thereby preventing downloads of\nadditional malware and the setup of C&C channels that allowing RAT control and theft of sensitive files\n\n- _McAfee Configuration Control: McAfee Configuration Control software allows you to disallow_\n\nany configuration changes to your systems, protecting them from being modified without explicit\npermission (even with administrative access)\n\n- _McAfee Database Activity Monitoring: delivers complete database protection including 0-day attacks_\n\nand web born attacks such as those seen with SQL injection in Night Dragon.\n\n- _McAfee Network Security Platform: blocks malicious network activity such as APT command and_\n\ncontrol traffic.\n\n- _McAfee Enterprise Firewall: Properly installed and configured at the border and inside your organization,_\n\nMcAfee Firewall would have prevented the Night Dragon operation from penetrating so deeply into\nthe affected organizations and would have blocked C&C communication from the RAT\n\n- _McAfee Web Gateway: Properly installed and configured, McAfee Web Gateway would have prevented_\n\nthe Night Dragon operation from using their RATs, requiring them to proxy-enable their RATs or use\nalternative proxy-enabled RATs\n\n- _McAfee Endpoint Encryption: Properly installed and configured, McAfee Endpoint Encryption software_\n\nreduces the impact of the Night Dragon attack by restricting access to the core targeted assets\n\n\n-----\n\n- _McAfee Data Loss Protection: Properly installed and configured, McAfee Network DLP and/or McAfee_\n\nHost DLP solutions allow you to prevent and detect the extraction of sensitive information from outside\nthe company\n\n- _McAfee Host Intrusion Prevention 8.0: McAfee Host Intrusion Prevention 8.0 software has introduced_\n\na new “TrustedSource” APT detection feature that allows enterprises to correlate endpoint executable\nactivity with the network C&C communication to detect and prevent RAT communications and data\nexfiltration activity\n\n- _McAfee VirusScan[®] Enterprise: In addition to detecting associated malware and RATs on the endpoint,_\n\ncustomers can also leverage access protection features in McAfee VirusScan Enterprise to prevent\n(and alert on) the creation of Night Dragon-related files and folder structures. Other built-in features\nsuch infection tracing and McAfee Global Threat Intelligence[™] can assist with the identification and\nquarantining or removal of new and unknown associated malware and RATs.\n\nIf you have discovered the presence of Night Dragon in your environment and would like incident-response\nor forensics assistance to respond and repair, please contact Foundstone Professional Services on\n[incidentresponse@foundstone.com or submit any related samples to Virus_Research@avertlabs.com](mailto:incidentresponse%40foundstone.com?subject=)\n[or on the web at McAfee Labs WebImmune.](https://www.webimmune.net/default.asp)\n\nConclusion\nWell-coordinated, targeted attacks such as Night Dragon, orchestrated by a growing group of malicious\nattackers committed to their targets, are rapidly on the rise. These targets have now moved beyond the\ndefense industrial base, government, and military computers to include global corporate and commercial\ntargets. While Night Dragon attacks focused specifically on the energy sector, the tools and techniques\nof this kind can be highly successful when targeting any industry. Our experience has shown that many\nother industries are currently vulnerable and are under continuous and persistent cyberespionage\nattacks of this type. More and more, these attacks focus not on using and abusing machines within the\norganizations being compromised, but rather on the theft of specific data and intellectual property. It is\nvital that organizations work proactively toward protecting the heart of their value: intellectual property.\nEnterprises need to take action to discover these assets in their environments, assess their configurations\nfor vulnerabilities, and protect them from misuse and attack.\n\nFor additional research and information, review Hacking Exposed: Network Secret and Solutions — 6th\n_[Edition (Osborne McGraw-Hill). You can also visit http://www.hackingexposed.com for information on](http://www.hackingexposed.com)_\nadvanced hacker techniques and to sign up for “Hacking Exposed” monthly webinars.\n\nCredits and Acknowledgements\nThe preceding white paper was a collaborative effort among numerous people and entities including\n\nMcAfee Foundstone Professional Services consultants, McAfee Labs, McAfee employees, executives, and\nresearchers, HBGary and National Cyber-Forensics & Training Alliance (NCFTA). Significant contributors\ninclude Shane Shook, Dmitri Alperovitch, Stuart McClure, Georg Wicherski, Greg Hoglund, Shawn Bracken,\nRyan Permeh, Vitaly Zaytsev, Mark Gilbert, Mike Spohn, George Kurtz, and Adam Meyers.\n\n\n-----\n\nAppendix A: zwShell — the RAT\n\nBelow is a walk-through of the capabilities of zwShell and a demonstration of how the attackers used\nzwShell as a command and control server to exfiltrate data from within the targeted companies.\n\n1. When zwShell is launched, it presents a fake crash error to the user and contains a hidden text entry\n\nfield below the “Write of address 00000000. Process stopped” line. By entering the password in\nthe hidden dialog box above the “ok” button to launch the application requires typing a special\npassword, “zw.china.” Without that password, the tool will not start. This obfuscation method is\nlikely used to confuse investigators about the true purpose of this executable.\n\n2. Once the error is bypassed, and zwShell is launched, it allows the attacker to create a custom Trojan by\n\nselecting the Server menu or to launch the C&C server by clicking Start and entering the port to listen for\ntraffic with the password used by the backdoor DLLs. Once started, the application will begin listening\nfor incoming compromised client connections and display them inside the grid. The attacker can launch\nas many instances of the zwShell application as required — as long as each listens to a different port or\npassword. In this manner, multiple “networks” of compromised computers can be monitored.\n\n3. The attacker can also click on the Options menu to configure the C&C server settings. Those settings\n\ninclude selection of the listening port, the password that will encrypt the C&C traffic (which must\nmatch the password selected at the time of the Trojan generation), the ability to specify custom sound\nnotifications for when infected machines connect and disconnect from the C&C server, and the ability\nto increase the color depth used for remote access to the machine, as well as an optional capability\nto allow resumes of interrupted file transfers from the client machine. The attacker can stop the\nlistener and start with new options to monitor or connect with other compromised computers.\n\n\n-----\n\n4. The attacker can specify the password (which must match the password set up for the server in Step 3),\n\nthe name and path to the RAT DLL that will be injected into the svchost.exe Windows services process,\nthe service and mutex names, and service displayed name and description. The attacker can also specify\nup to two C&C hostnames or IP address, port address, and dropper EXE process icon. Once the\nCreate button is clicked, zwShell will generate a custom EXE dropper process which, when executed,\nwill delete itself and extract a RAT DLL that will be launched as a persistent Windows service. The\nRAT will then immediately send a beacon on the configured port to the designated C&C server and\nwait for instructions.\n\n5. The dropper will be copied over network shares to the compromised computer and remotely execute\n\nwith psexec or via Windows Terminal Services (RDP). In some cases, an “AT.job” or “SchTasks” entry\nwill be used to execute the dropper over the network on the compromised computer. When\nexecuted, the dropper will create a temporary file and extract a RAT DLL that will be launched as a\npersistent Windows service. The RAT will then immediately send a beacon on the configured port to\nthe designated C&C server and wait for instructions. The dropper will automatically delete itself after\nthe backdoor service is created, and the temporary file will be deleted when the system is rebooted.\nAn entry will be created in the Windows Update logs (KB****.log) in the C:\\Windows directory with\n\nthe date and time and path+name of the temporary file.\n\n\n-----\n\n6. When a client is executed, it connects to the attacker’s zwShell interface, along with its IP address,\n\nPC name, name of the logged-in user, and information about the operating system (OS) version of\nthe machine, including the major patch levels.\n\n7. The attacker in charge of the C&C server can establish full remote control of the connected machine\n\nand can browse the file system, launch command-line shells, manipulate the registry, view the remote\ndesktop, and uninstall the Trojan from the client.\n\n8. Browsing the client file system is a fully interactive process and has a familiar user interface similar\n\nto Windows Explorer. Individual files and folders can be deleted, renamed, copied, downloaded,\nand uploaded to the remote machine.\n\n\n-----\n\n9. A remote command-line shell can be launched to execute commands directly on the remote machine.\n\nWhen the attacker uses this function, a copy of CMD.EXE is copied to the compromised system in a\nWindows %Temp% directory with the filename svchost.exe. This copy is an unmodified version of\nthe Microsoft Windows command shell executable.\n\n10. The Registry can also be viewed and edited in a user interface similar to the Windows Registry editor.\n\n\n-----\n\nAppendix B: Attribution\n\nIMPORTANT: McAfee has no direct evidence to name the originators of these attacks but rather has\nprovided circumstantial evidence.\n\nWhile we believe many actors have participated in these attacks, we have been able to identify one\nindividual who has provided the crucial C&C infrastructure to the attackers — this individual is based in\nHeze City, Shandong Province, China. Although we don’t believe this individual is the mastermind behind\nthese attacks, it is likely this person is aware or has information that can help identify at least some\nof the individuals, groups, or organizations responsible for these intrusions.\n\nFigure 6. Shandong Province, China\n\nThe individual runs a company that, according to the company’s advertisements, provides ”Hosted\nServers in the U.S. with no records kept” for as little as 68 RMB (US$10) per year for 100 MB of space.\nThe company’s U.S.-based leased servers have been used to host the zwShell C&C application that\n\ncontrolled machines across the victim companies.\n\nBeyond the connection to the hosting services reseller operation, there is other evidence indicating\nthat the attackers were of Chinese origin. Beyond the curious use of the “zw.china” password that\nunlocks the operation of the zwShell C&C Trojan, McAfee has determined that all of the identified data\nexfiltration activity occurred from Beijing-based IP addresses and operated inside the victim companies\nweekdays from 9:00 a.m. to 5:00 p.m. Beijing time, which also suggests that the involved individuals\nwere “company men” working on a regular job, rather than freelance or unprofessional hackers. In\naddition, the attackers employed hacking tools of Chinese origin and that are prevalent on Chinese\nunderground hacking forums. These included Hookmsgina and WinlogonHack, tools that intercept\nWindows logon requests and hijack usernames and passwords.\n\n\n-----\n\nFigure 7. Instructions on the use of WinlogonHack tool by its Chinese developers.\n\nOn the compromised web server, they also deployed ASPXSpy, a web-based remote administration tool,\nalso of Chinese origin.\n\nFigure 8. Parts of the ASPXSpy code with attribution to the Chinese developer.\n\nThere is nothing to suggest that the developers of these tools had any direct connection to these\n\nintrusions, as the tools are widely available on the Chinese web forums and tend to be used extensively\nby Chinese hacker groups. Although it is possible that all of these indicators are an elaborate red-herring\noperation designed to pin the blame for the attacks on Chinese hackers, we believe this to be highly\nunlikely. Further, it is unclear who would have the motivation to go to these extraordinary lengths\nto place the blame for these attacks on someone else. We have strong evidence suggesting that the\nattackers were based in China.\n\nThe information in this document is provided only for educational purposes and for the convenience of McAfee customers. The information\ncontained herein is subject to change without notice, and is provided “as is,” without guarantee or warranty as to the accuracy or applicability\n\nMcAfee, Inc. of the information to any specific situation or circumstance.\n2821 Mission College Boulevard McAfee the McAfee logo McAfee Labs McAfee Foundstone McAfee ePolicy Orchestrator McAfee ePO McAfee Global Threat Intelligence\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://scadahacker.com/library/Documents/Cyber_Events/McAfee%20-%20Night%20Dragon%20-%20Global%20Energy%20Cyberattacks.pdf",
        "https://app.box.com/s/o2tc88oihh4c67a0s8ygok9fwd66zp71",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2011/2011.02.10.Night_Dragon/wp-global-energy-cyberattacks-night-dragon.pdf",
        "https://papers.vx-underground.org/papers/ICS SCADA/Other/Night Dragon - Global Energy Cyberattacks.pdf"
    ],
    "report_names": [
        "McAfee%20-%20Night%20Dragon%20-%20Global%20Energy%20Cyberattacks.pdf",
        "wp-global-energy-cyberattacks-night-dragon",
        "Night Dragon - Global Energy Cyberattacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "ea844ee6-eb12-42c0-8426-11395fe81e6f",
            "created_at": "2022-10-25T15:50:23.300796Z",
            "updated_at": "2025-03-27T02:00:55.434471Z",
            "deleted_at": null,
            "main_name": "Night Dragon",
            "aliases": [
                "Night Dragon"
            ],
            "source_name": "MITRE:Night Dragon",
            "tools": [
                "at",
                "gsecdump",
                "zwShell",
                "PsExec",
                "ASPXSpy",
                "gh0st RAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "09a8f8fe-e907-47b4-8709-a97717dde3cc",
            "created_at": "2022-10-25T16:07:23.90252Z",
            "updated_at": "2025-03-27T02:02:10.020919Z",
            "deleted_at": null,
            "main_name": "Night Dragon",
            "aliases": [],
            "source_name": "ETDA:Night Dragon",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Cain & Abel",
                "gsecdump",
                "zwShell"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "020794ec-7315-47de-818c-2032c362fd15",
            "created_at": "2023-01-06T13:46:38.306576Z",
            "updated_at": "2025-03-27T02:00:02.800515Z",
            "deleted_at": null,
            "main_name": "Night Dragon",
            "aliases": [
                "G0014"
            ],
            "source_name": "MISPGALAXY:Night Dragon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "86fd71d3-06dc-4b73-b038-cedea7b83bac",
            "created_at": "2022-10-25T16:07:23.330793Z",
            "updated_at": "2025-03-27T02:02:09.740703Z",
            "deleted_at": null,
            "main_name": "APT 17",
            "aliases": [
                "APT 17",
                "ATK 2",
                "Beijing Group",
                "Bronze Keystone",
                "Deputy Dog",
                "Elderwood",
                "Elderwood Gang",
                "Operation Aurora",
                "Operation DeputyDog",
                "Operation Ephemeral Hydra",
                "Operation RAT Cook",
                "SIG22",
                "Sneaky Panda",
                "TEMP.Avengers",
                "TG-8153",
                "Tailgater Team"
            ],
            "source_name": "ETDA:APT 17",
            "tools": [
                "9002 RAT",
                "AGENT.ABQMR",
                "AGENT.AQUP.DROPPER",
                "AGENT.BMZA",
                "AGENT.GUNZ",
                "Agent.dhwf",
                "AngryRebel",
                "BlackCoffee",
                "Briba",
                "Chymine",
                "Comfoo",
                "Comfoo RAT",
                "Darkmoon",
                "DeputyDog",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "Fexel",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "Gresim",
                "HOMEUNIX",
                "HiKit",
                "HidraQ",
                "Homux",
                "Hydraq",
                "Jumpall",
                "Kaba",
                "Korplug",
                "Linfo",
                "MCRAT.A",
                "McRAT",
                "MdmBot",
                "Mdmbot.E",
                "Moudour",
                "Mydoor",
                "Naid",
                "Nerex",
                "PCRat",
                "PNGRAT",
                "Pasam",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trojan.Naid",
                "Vasport",
                "Wiarp",
                "Xamtrav",
                "Zox",
                "ZoxPNG",
                "ZoxRPC",
                "gresim",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041809,
    "ts_creation_date": 1297438250,
    "ts_modification_date": 1297438281,
    "files": {
        "pdf": "https://archive.orkl.eu/e0fce95ccdb9c400f2dd3859ebe268f5bc7877ce.pdf",
        "text": "https://archive.orkl.eu/e0fce95ccdb9c400f2dd3859ebe268f5bc7877ce.txt",
        "img": "https://archive.orkl.eu/e0fce95ccdb9c400f2dd3859ebe268f5bc7877ce.jpg"
    }
}