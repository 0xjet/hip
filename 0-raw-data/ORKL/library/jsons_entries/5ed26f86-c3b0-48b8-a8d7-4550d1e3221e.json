{
    "id": "5ed26f86-c3b0-48b8-a8d7-4550d1e3221e",
    "created_at": "2023-01-12T15:10:02.316374Z",
    "updated_at": "2025-03-27T02:09:07.869988Z",
    "deleted_at": null,
    "sha1_hash": "00ed8ff824930cc09fa3ce64165c8f25d476c290",
    "title": "2016-05-22 - Cron has fallen",
    "authors": "",
    "file_creation_date": "2011-10-25T09:58:32Z",
    "file_modification_date": "2011-10-25T09:58:32Z",
    "file_size": 1130509,
    "plain_text": "# Duqu Threat Research and Analysis\n\n#### McAfee Labs\n\n##### Peter Szor Sr. Director of Research\n\n\n-----\n\n### • Stuxnet Overvieew\n • Duqu Review-Current Intelligence, comparisons with Stuxnet, \n • Best Practice recommendations\n • Q&A\n\n\n-----\n\n## High Level Overview\n\n### • The executables share injection code with the Stuxnet worm and they\n were compiled after the last Stuxnet sample was recovered. \n • The structure of Duqu is very similar to Stuxnet (uses of PE resources)\n • There is no ICS specific attack code in Duqu.\n • The primary infection vector for Duqu deployment has not yet been\n discovered/recovered (Duqu does not self-replicate or spread on its own) \n • The infected organizations appear to be limited \n • No known targeting of energy sector companies.\n • The malware employed a valid digital certificate (revoked as of 14\n OCT 2011) \n • The malware is designed to self-delete after 36 days \n • The known Command and Control server was hosted in India.\n\n\n-----\n\n-----\n\n## Attacks\n\n### • DOS/Boot viruses change BIOS password\n settings, battery needs to be removed\n • CIH virus overwrites flash-ROM, motherboard\n needs replacement\n • Worms got faster than update and patch\n deployment, targeting vulnerabilities, often zero-Days\n • Worms caused major DoS attacks   (… Nuclear Power plants’ safety monitoring\n system was disabled by Slammer)\n • Blaster worm is a contributor to a major\n blackout\n • Stuxnet combines 4 zero-day vulnerabilities\n with ICS knowledge to target an industrial process\n • US Predator Drone Center gets infected with\n malware\n\n\n-----\n\n#### Exploits “Zero Days” vulnerabilities - MS10-046 (LNK Vulnerability – Used by Zlob in 2008) - MS08-067 (Server Service) - MS10-061 (Print Spooler – Hackin9 magazine 2009) - MS10-073 (Kbd Privilege Escalation) - WinCC DBMS Password (hardcoded) + Stolen certificates (Realtek, JMicron) + ROP techniques in Exploits\n Infection - USB, Local Network, Siemens Step7/MC7 - Network Infection - C&C operation (Weak! Mypremierfutbol.com, todaysfutbol.com) - Anti Behavioral Blocking, avoids anti-virus detection - Rootkit: \n - User mode hooks to hide files from Explorer – Total\\Windows Commander(!) - User mode DLL replacement for Step7 (PLC Rootkit)\n - s7otbxdl.dll forwards to s7otbxsx.dll (except for 16 functions related to\n\n\n-----\n\n#### Deactivates/Reactivates Total Commander (and “Windows Commander”)\n\n\n-----\n\n#### Deactivates/Reactivates Total Commander (and “Windows Commander”)\n\n\n-----\n\n#### 1,210Hz.\n\n Cascaded Centrifuges\n\n  PLC\n\n\n-----\n\n#### • Targeted attacks have been observed in Iran, England and US\n • Other reports: Austria, Hungary, Indonesia\n • C&C Server in India\n\n\n-----\n\n|Feature|Duqu|Stuxnet|\n|---|---|---|\n|Composed of multiple modules|Yes|Yes|\n|Rootkit to hide its activities|Yes|Yes|\n|System driver is digitally signed|Yes (C-Media)|Yes (Realtek, JMicron)|\n|System driver decrypts secondary modules in PNF files|Yes|Yes|\n|Decrypted DLLs are directly injected into system processes instead of dropped to disk|Yes|Yes|\n|Date sensitive: functionality is controlled via complex, encrypted configuration file|Yes (36 days)|Yes|\n|Use XOR based encryption for strings|Yes (key: 0xAE1979DD)|Yes (key: 0xAE1979DD)|\n|Referencing 05.09.1979 in configuration file (http://en.wikipedia.org/wiki/Habib_Elghanian)|Yes (0xAE790509)|Yes (0xAE790509)|\n\n\n## Duqu and Stuxnet\n\n### • Several similarities have been observed at the code level which led us\n to believe Duqu was based on the same source code as Stuxnet\n\n#### Feature Duqu Stuxnet\n\n###### Composed of multiple modules Yes Yes\n\n Rootkit to hide its activities Yes Yes\n\n System driver is digitally signed Yes (C-Media) Yes (Realtek,\n JMicron)\n\n System driver decrypts secondary modules in PNF files Yes Yes\n\n Decrypted DLLs are directly injected into system Yes Yes processes instead of dropped to disk\n\n Date sensitive: functionality is controlled via complex, Yes Yes encrypted configuration file (36 days)\n\n Use XOR based encryption for strings Yes (key: Yes (key: 0xAE1979DD) 0xAE1979DD)\n\n Referencing 05.09.1979 in configuration file Yes Yes (http://en.wikipedia.org/wiki/Habib_Elghanian) (0xAE790509) (0xAE790509)\n\n New update modules via C&C Yes (keylogger) Yes\n\n\n-----\n\n## Duqu and Stuxnet (Code Graph Comparison)\n\n### • DLL Injection code\n\n\n-----\n\n## Duqu and Stuxnet: Code Comparison\n\n### • DLL Injection code\n\n\n-----\n\n#### Unknown vector of exploitation, Installer  C&C Server\n\n###### CMI4432.SYS JMINET7.SYS Keylogger.exe\n\nDecrypt Decrypt Decrypt\n\n###### CMI4432.PNF NETP191.PNF Resource 302\n\nInject into     Services.exe Inject into     Services.exe\n\n###### CMI4432.DLL NETP191.DLL\n\nDecrypt      Resource 302 Decrypt      Resource 302 Decrypt       .zdata section\n\n###### Resource 302 Resource 302\n\nDecrypt       .zdata section Decrypt       .zdata section\n\n###### SortXXXX.NLS SortXXXX.NLS SortXXXX.NLS\n\nInject main modules into System Processes\n\n\n-----\n\n#### • The two variants of .SYS files are responsible for restarting the malware\n • .SYS filenames mimic Jmicron and C-Media driver file names\n • Jmicron mimic file is not signed, and it is the earlier variant\n • Drivers are loaded at time of “Network group load”\n • They decrypt the PNF files and inject the resulting DLL into Services.exe, etc\n\n • Anti-firewall feature, Anti-BB feature\n • This DLL is responsible for decrypting the payload module from its resource section. The resource Id is the same for all modules: 302\n • The payload module is directly injected into running processes using the same method as Stuxnet\n • The DLL implement rootkit methods to hide this payload from user’s view\n\n\n-----\n\n#### The Keylogger component is a standalone module. It was delivered via C&C Server to target after the initial infection. \n It uses the same decryption routines as the other modules. It is capable of collecting different types of information from the target machine:\n • Keystroke data\n • Machine information (OS version, patches, machine name, users, etc)\n • Process list\n • Network information\n • List shared folders\n • List machines on the same network\n • Screen shots\n The Keylogger accepts command line parameter commands, and only works if the parameter “xxx” is the first parameter passed\n\n\n-----\n\n## data\n\n\n-----\n\n#### Once the DLL module is started, the known variants will try to contact the command and control server at the address below on tcp ports 80 and 443 (http/https)\n • 206.183.111.97 (India)\n The request may look like the one below:\n```\n    GET / HTTP/1.1\n    Cookie: PHPSESSID=o5ukre1ul0q6i2il1ij3ghi0j1\n    Cache-Control: no-cache\n    Pragma: no-cache\n    User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US;\n    rv:1.9.2.9) Gecko/20100824 Firefox/3.6.9 (.NET CLR 3.5.30729)\n    Host: x.x.x.x\n The PHPSESSID is an encrypted message sent to the command and control server. \n The User-Agent is hardcoded and may be used to identify machines\n\n```\n\n-----\n\n#### driver\n\n\n-----\n\n#### sign one of the known variants of Duqu)\n\n\n-----\n\n-----\n\n## Best Practices Against Duqu\n\n### • AV Signatures\n • Application Whitelisting\n • DeepSafe- McAfee/Intel techology targeting rootkits\n\n\n-----\n\n#### • McAfee Labs Blogs\n • Personal communication: Rob Meyers, Liam O Murchu, Guilherme Venere and Stuart McClure\n • McAfee Threats Report\n • Symantec Stuxnet File / Symantec Internet Security Threat Report\n • Ralph Langner on Stuxnet\n • Krebs on Security Blog\n • “The Art of Computer Virus Research and Defense”\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/ICS SCADA/Duqu/W32.Duqu Threat Analysis.pdf"
    ],
    "report_names": [
        "W32.Duqu Threat Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536202,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1319536712,
    "ts_modification_date": 1319536712,
    "files": {
        "pdf": "https://archive.orkl.eu/00ed8ff824930cc09fa3ce64165c8f25d476c290.pdf",
        "text": "https://archive.orkl.eu/00ed8ff824930cc09fa3ce64165c8f25d476c290.txt",
        "img": "https://archive.orkl.eu/00ed8ff824930cc09fa3ce64165c8f25d476c290.jpg"
    }
}