{
    "id": "59b601b7-9704-4355-9221-84207e1a4910",
    "created_at": "2023-01-12T15:00:44.1804Z",
    "updated_at": "2025-03-27T02:09:29.850765Z",
    "deleted_at": null,
    "sha1_hash": "2c8f0970ad3aeedf1f02f231ebc86dd4120ec06c",
    "title": "2021-06-16 - DirtyMoe- Introduction and General Overview of Modularized Malware",
    "authors": "",
    "file_creation_date": "2022-05-27T22:37:25Z",
    "file_modification_date": "2022-05-27T22:37:25Z",
    "file_size": 513718,
    "plain_text": "# DirtyMoe: Introduction and General Overview of Modularized Malware\n\n**decoded.avast.io/martinchlumecky/dirtymoe-1/**\n\nJune 16, 2021\n\nby [Martin ChlumeckýJune 16, 202121 min read](https://decoded.avast.io/author/martinchlumecky/)\n\n## Abstract\n\nThe rising price of the cryptocurrency has caused a skyrocketing trend of malware samples in the\nwild. DDoS attacks go hand in hand with the mining of cryptocurrencies to increase the attackers’\nrevenue/profitability. Moreover, the temptation grows if you have thousands of victims at your\ndisposal.\n\nThis article presents the result of our recent research on the DirtyMoe malware. We noticed that\nthe NuggetPhantom malware [1] had been the first version of DirtyMoe, and PurpleFox is its\nexploit kit [2]. We date the first mention of the malware to 2016. The malware has followed a\nfascinating evolution during the last few years. The first samples were often unstable and\nproduced obvious symptoms. Nonetheless, the current samples are at par with other malware in\nthe use of anti-forensic, anti-tracking, and anti-debugging techniques nowadays.\n\nThe DirtyMoe malware uses a simple idea of how to be modularized, undetectable, and\nuntrackable at the same time. The aim of this malware is focused on Cryptojacking and DDoS\nattacks. DirtyMoe is run as a Windows service under system-level privileges via EternalBlue and\nat least three other exploits. The particular functionality is controlled remotely by the malware\nauthors who can reconfigure thousands of DirtyMoe instances to the desired functionality within a\nfew hours. DirtyMoe just downloads an encrypted payload, corresponding to the required\nfunctionality, and injects the payload into itself.\n\nDirtyMoe’s self-defense and hiding techniques can be found at local and network malware layers.\nThe core of the DirtyMoe is the service that is protected by VMProtect. It extracts a Windows\ndriver that utilizes various rootkit capabilities such as service, registry entry, and driver hiding.\nAdditionally, the driver can hide selected files on the system volume and can inject an arbitrary\nDLL into each newly created process in the system. The network communication with a mother\nserver is not hard-coded and is not invoked directly. DirtyMoe makes a DNS request to one hard\n\n-----\n\ncoded domain using a set of hardcoded DNS servers. However, the final IP address and port are\nderived using another sequence of DNS requests. So, blocking one final IP address does not\nneutralize the malware, and we also cannot block DNS requests to DNS servers such as Google,\nCloudflare, etc.\n\nThis is the first article of the DirtyMoe series. We present a high-level overview of the complex\nDirtyMoe’s architecture in this article. The following articles will be focused on detailed aspects of\nthe DirtyMoe architecture, such as the driver, services, modules, etc. In this article, We describe\nDirtyMoe’s kill chain, sophisticated network communication, self-protecting techniques, and\nsignificant symptoms. Further, we present statistical information about the prevalence and\nlocation of the malware and C&C servers. Finally, we discuss and summarize the relationship\nbetween DirtyMoe and PurpleFox. Indicators of Compromise lists will be published in future posts\nfor each malware component.\n\n## 1. Kill Chain\n\nThe following Figures illustrate two views of DirtyMoe architecture. The first one is delivery and\nthe second one is exploration including installation. Individual Kill Chain items are described in\nthe following subsections.\n\n**Figure 1. Kill Chain: Delivery**\n\n\n-----\n\n**Figure 2. Kill Chain: Exploitation and Installation**\n\n## 1.2 Reconnaissance\n\nThrough port-scanning and open-database of vulnerabilities, the attackers find and target a large\nnumber of weak computers. PurpleFox is the commonly used exploit kit for DirtyMoe.\n\n## 1.3 Weaponization\n\nThe DirtyMoe authors apply several explicit techniques to gain admin privileges for a DirtyMoe\ndeployment.\n\nOne of the favorite exploits is EternalBlue ( CVE-2017-0144 ), although this vulnerability is well\nknown from 2017. Avast still blocks around 20 million EternalBlue attack attempts every month.\nUnfortunately, a million machines still operate with the vulnerable SMBv1 protocol and hence\nopening doors to malware include DirtyMoe via privilege escalation [3]. Recently, a new infection\nvector that cracks Windows machines through SMB password brute force is on the rise [2].\n\nAnother way to infect a victim machine with DirtyMoe is phishing emails containing URLs that can\nexploit targets via Internet Explorer; for instance, the Scripting Engine Memory Corruption\nVulnerability ( CVE-2020-0674 ). The vulnerability can inject and damage memory so that\nexecuted code is run in the current user context. So, if the attacker is lucky enough to\nadministrator user login, the code takes control over the affected machine [4]. It is wondering how\nmany users frequently use Internet Explorer with this vulnerability.\n\n\n-----\n\nFurther, a wide range of infected files is a way to deploy DirtyMoe. Crack, Keygen, but even legitlooking applications could consist of malicious code that installs malware into victim machines as\na part of their execution process. Customarily, the malware installation is done in the background\nand silently without user interaction or user’s knowledge. Infected macros, self-extracting archive,\nand repacked installers of popular applications are the typical groups.\n\nWe have given the most well-known examples above, but how to deploy malware is unlimited. All\nways have one thing in common; it is Common Vulnerabilities and Exposures (CVE). Description\nof the exact method to install DirtyMoe is out of this article’s scope. However, we list a shortlist of\nused CVE for DirtyMoe as follows:\n```\n   CVE-2019-1458, CVE-2015-1701, CVE-2018-8120 : Win32k Elevation of Privilege\n\n```\nVulnerability\n```\n   CVE-2014-6332 : Windows OLE Automation Array Remote Code Execution Vulnerability\n\n## 1.4 Delivery\n\n```\nWhen one of the exploits is successful and gains system privileges, DirtyMoe can be installed on\na victim’s machine. We observe that DirtyMoe utilizes Windows MSI Installer to deploy the\nmalware. MSI Installer provides an easy way to install proper software across several platforms\nand versions of Windows. Each version requires a different location of installed files and registry\nentries. The malware author can comfortably set up DirtyMoe configurations for the target system\nand platform.\n\n### 1.4.1 MSI Installer Package\n\nThe malware authors via MSI installer prepare a victim environment to a proper state. They focus\non disabling anti-spyware and file protection features. Additionally, the MSI package uses one\nsystem feature which helps to overwrite system files for malware deployment.\n\n**Registry Manipulation**\n\nThere are several registry manipulations during MSI installation. The most crucial registry entries\nare described in the following overview:\n\nMicrosoft Defender Antivirus can be disabled by the `DisableAntiSpyware registry key set`\nto `1 .`\n```\n      HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware\n\n```\nWindows File Protection (WFP) of critical Windows system files is disabled.\n```\n      HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SFCDisable\n      HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SFCScan\n\n```\nDisables SMB sharing due to the prevention of another malware infection\n\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Services\\NetBT\\Parameters\\SMBDeviceEnabled\n\n```\n\n-----\n\nReplacing system files by the malware ones\n\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\Session\n\n```\n```\nManager\\AllowProtectedRenames\n\n```\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\Session\n\n```\n```\n   Manager\\PendingFileRenameOperations\n\n```\nSets the threshold to the maximum value to ensure that each service is run as a thread and\nthe service is not a normal process.\n\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\SvcHostSplitThresholdInKB\n\n```\n\n**File Manipulation**\n\nThe MSI installer copies files to defined destinations if an appropriate condition is met, as the\nfollowing table summarizes.\n\n**File** **Destination** **Condition**\n\nsysupdate.log WindowsFolder Always\n\nwinupdate32.log WindowsFolder NOT VersionNT64\n\nwinupdate64.log WindowsFolder VersionNT64\n\nWindows Session Manager ( smss.exe ) copies the files during Windows startup according to\nregistry value of `PendingFileRenameOperations entry as follows:`\n\nDelete (if exist) `\\\\[WindowsFolder]\\\\AppPatch\\\\Acpsens.dll`\nMove `\\\\[SystemFolder]\\\\sens.dll to` `\\\\`\n```\n   [WindowsFolder]\\\\AppPatch\\\\Acpsens.dll\n\n```\nMove `\\\\[WindowsFolder]\\\\winupdate[64,32].log to` `\\\\`\n```\n   [SystemFolder]\\\\sens.dll\n\n```\nDelete (if exist) `\\\\[WindowsFolder]\\\\AppPatch\\\\Ke583427.xsl`\nMove `\\\\[WindowsFolder]\\\\sysupdate.log to` `\\\\`\n```\n   [WindowsFolder]\\\\AppPatch\\\\Ke583427.xsl\n\n### 1.4.2 MSI Installation\n\n```\nThe MSI installer can be run silently without the necessity of the user interaction. The installation\nrequires the system restart to apply all changes, but the MSI installer supports delayed restart,\nand a user does not detect any suspicious symptoms. The MSI installer prepares all necessary\nfiles and configurations to deploy the DirtyMoe malware. After the system reboot, the system\noverwrites defined system files, and the malware is run. We will describe the detailed analysis of\nthe MSI package in a separate article.\n\n## 1.5 Exploitation\n\nThe MSI package overwrites the system file `sens.dll via the Windows Session Manager.`\nTherefore, DirtyMoe abuses the Windows System Event Notification (SENS) to be started by the\nsystem. The infected SENS Service is a mediator which deploys a DirtyMoe Service.\n\n\n-----\n\nIn the first phase, the abused service ensures that DirtyMoe will be loaded after the system\nreboot and restores the misused Windows service to the original state. Secondly, the main\nDirtyMoe service is started, and a rootkit driver hides the DirtyMoe’s services, registry entries,\nand files.\n\n### 1.5.1 Infected SENS Service\n\nWindows runs the original SENS under NT AUTHORITY\\SYSTEM user. So, DirtyMoe gains\nsystem-level privileges. DirtyMoe must complete three basic objectives on the first run of the\ninfected SENS Service.\n\n1. Rootkit Driver Loading\n\nDirtyMoe runs in user mode, but the malware needs support from the kernel space. Most\nkernel actions try to hide or anti-track DirtyMoe activities. A driver binary is embedded in the\nDirtyMoe service that loads the driver during DirtyMoe starts.\n2. DirtyMoe Service Registration\n\nThe infected SENS Service registers the DirtyMoe Service in the system as a regular\nWindows service. Consequently, the DirtyMoe malware can survive the system reboot. The\nDirtyMoe driver is activated at this time; hence the newly created service is hidden too.\nDirtyMoe Service is the main executive unit that maintains all malware activities.\n3. System Event Notification Service Recovery\n\nIf the DirtyMoe installation and service deployment is successful, the last step of the\ninfected SENS Service is to recover the original SENS service from the `Acpsens.dll`\nbackup file; see File Manipulation.\n\n### 1.5.2 DirtyMoe Service\n\nDirtyMoe Service is registered in the system during the maware’s deployment. At the start, the\nservice extracts and loads the DirtyMoe driver to protect itself. When the driver is loaded, the\nservice cleans up all evidence about the driver from the file system and registry.\n\nThe DirtyMoe malware is composed of two processes, namely DirtyMoe Core and DirtyMoe\n_Executioner, created by DirtyMoe service that terminates itself if the processes are created and_\nconfigured. DirtyMoe Service creates the Core and Executioner process through several\nprocesses and threads that are terminated over time. Forensic and tracking methods are\ntherefore more difficult. The DirtyMoe services, processes, and their details will be described in\nthe future article in detail.\n\n## 1.6 Installation\n\nAll we described above is only preparation for malicious execution. DirtyMoe Core is the\nmaintenance process that manages downloading, updating, encrypting, backuping, and\nprotecting DirtyMoe malware. DirtyMoe Core is responsible for the injection of malicious code into\n_DirtyMoe Executioner that executes it. The injected code, called MOE Object or Module, is_\ndownloaded from a C&C server. MOE Objects are encrypted PE files that DirtyMoe Core\ndecrypts and injects into DirtyMoe Executioner.\n\n\n-----\n\nAdditionally, the initial payload that determines the introductory behavior of DirtyMoe Core is\ndeployed by the MSI Installer as the `sysupdate.log file. Therefore, DirtyMoe Core can update`\nor change its own functionality by payload injection.\n\n## 1.7 Command and Control\n\n_DirtyMoe Core and DirtyMoe Executioner provide an interface for the malware authors who can_\nmodularize DirtyMoe remotely and change the purpose and configuration via MOE Objects.\n_DirtyMoe Core communicates with the command and control (C&C) server to obtain attacker_\ncommands. Accordingly, the whole complex hierarchy is highly modularized and is very flexible to\nconfiguration and control.\n\nThe insidiousness of the C&C communication is that DirtyMoe does not use fixed IP addresses\nbut implements a unique mechanism to obfuscate the final C&C server address. So, it is\nimpossible to block the C&C server on a victim’s machine since the server address is different for\neach C&C communication. Moreover, the mechanism is based on DNS requests which cannot be\neasily blocked because it would affect everyday communications.\n\n## 1.8 Actions on Objective\n\nRegarding DirtyMoe modularization, crypto-mining seems to be a continuous activity that uses\nvictim machines permanently if malware authors do not need to make targeted attacks. So,\ncrypto-mining is an activity at a time of peace. However, the NSFOCUS Threat Intelligence center\ndiscovered distributed denial-of-service (DDoS) attacks [1]. In general, DirtyMoe can deploy\narbitrary malware into infected systems, such as information stealer, ransomware, trojan, etc.\n\n## 2. Network Communication\n\nAs we announced, the network communication with the C&C server is sophisticated. The IP\naddress of the C&C server is not hardcoded because it is derived from DNS requests. There are\nthree pieces of information hardcoded in the code.\n\n1. A list of public DNS servers such as Google, Cloudflare, etc.\n2. A hard-coded domain `rpc[.]1qw[.]us is an entry point to get the final IP address of the`\n\nC&C server.\n3. Bulgarian constants that are used for a translation of IP addresses.1)\n\nA DNS request to the `1qw[.]us domain returns a list of live servers, but it is not the final C&C`\nserver. DirtyMoe converts the returned IP address to integer and subtracts the first Bulgarian\nconstant (anything making the result correct) to calculate the final C&C IP address. A C&C port is\nalso derived from the final IP address using the second Bulgarian’s constant to make things even\nworse.\n\nThe insidiousness of the translation is an application of DNS requests that cannot be easily\nblocked because users need the IP translations. DirtyMoe sends requests to public DNS servers\nthat resolve the `1qw[.]us domain recursively. Therefore, user machines do not contact the`\n\n\n-----\n\nmalicious domain directly but via one of the hardcoded domain name servers. Moreover, the list\nof returned IP addresses is different for each minute.\n\nWe record approx. 2,000 IP addresses to date. Many translated IP addresses lead to live web\nservers, mostly with Chinese content. It is unclear whether the malware author owns the web\nservers or the web servers are just compromised by DirtyMoe.\n\n## 3. Statistics\n\nAccording to our observation, the first significant occurrence of DirtyMoe was observed in 2017.\nThe number of DirtyMoe hits was in the thousands between 2018 – 2020.\n\n## 3.1 DirtyMoe Hits\n\nThe increase of incidences has been higher in orders of magnitude this year, as the logarithmic\nscale of Figure 3 indicates. On the other hand, it must be noted that we have improved our\ndetection for DirtyMoe in 2020. We record approx. one hundred thousand infected and active\nmachines to date. However, it is evident that DirtyMoe malware is still active and on the rise.\nTherefore, we will have to watch out and stay sharp.\n\n**Figure 3. Annual occurrences of DirtyMoe hits**\nThe dominant county of DirtyMoe hits is Russia; specifically, 65 k of 245 k hits; see Figure 4.\nDirtyMoe leads in Europe and Asia, as Figure 5 illustrates. America also has a significant share\nof hits.\n\n\n-----\n\n**Figure 4. Distribution of hits in point of the country view**\n\nDistribution of hits in point of the continent view\n\n## 3.2 C&C Servers\n\n\n**Figure 5.**\n\n\nWe observed the different distribution of countries and continents for C&C servers (IP addresses)\nand sample hits. Most of the C&C servers are located in China, as Figures 6 and 7 demonstrate.\nWe can deduce that the location of the malware source is in China. It is evident that the malware\nauthors are a well-organized group that operates on all major continents.\n\n\n-----\n\n**Figure 6. Distribution of C&C servers in point of the country view**\n\nDistribution of C&C servers in point of the continent view\n\n## 3.3 VMProtect\n\n\n**Figure 7.**\n\n\nIn the last two years, DirtyMoe has used a volume ID of the victim’s machines as a name for the\nservice DLL. The first versions of DirtyMoe applied a windows service name selected at random.\nIt was dominant in 2018; see Figure 8.\n\n\n-----\n\n**Figure 8.**\n\nDistribution of cases using service names\nWe detected the first significant occurrence of VMProtect at the end of 2018. The obfuscation via\nVMprotect has been continuously observed since 2019. Before VMProtect, the malware authors\nrelied on common obfuscation methods that are still present in the VMProtected versions of\nDirtyMoe.\n\n## 4. Self Protecting Techniques\n\nEvery good malware must implement a set of protection, anti-forensics, anti-tracking, and antidebugging techniques. DirtyMoe uses rootkit methods to hide system activities. Obfuscation is\nimplemented via the VMProtect software and via its own encrypting/decrypting algorithm.\nNetwork communications are utilized by a multilevel architecture so that no IP addresses of the\nmother servers are hardcoded. Last but not least is the protection of DirtyMoe processes to each\nother.\n\n## 4.1 DirtyMoe Driver\n\nThe DirtyMoe driver provides a wide scale of functionality; see the following shortlist:\n\nMinifilter: affection (hide, insert, modify) of a directory enumeration\nRegistry Hiding: can hide defined registry keys\nService Hiding: patches `service.exe structures to hide a required service`\nDriver Hiding: can hide itself in the system\n\nThe DirtyMoe driver is a broad topic that we will discuss in a future post.\n\n## 4.2 Obfuscation and VMProtect\n\n\n-----\n\nDirtyMoe code contains many malicious patterns that would be caught by most AV. The malware\nauthor used VMprotect to obfuscate the DirtyMoe Service DLL file. DirtyMoe Objects that\ndownload are encrypted with symmetric ciphers using hardcoded keys. We have seen several\nMOE objects which contained, in essence, the same PE files differing in PE headers only.\nNevertheless, even these slight modifications were enough for the used cipher to produce\ncompletely different MOE objects. Therefore, static detections cannot be applied to MOE\nencrypted objects. Moreover, DirtyMoe does not dump a decrypted MOE object (PE file) into the\nfile system but directly injects the MOE object into the memory.\n\nDirtyMoe stores its configuration in registry entry as follows:\n\n```\nHKLM\\SOFTWARE\\Microsoft\\DirectPlay8\\Direct3D\n\n```\n\nThe configuration values are also encrypted by the symmetric cipher and hardcoded key. Figure\n**9 demonstrates the decryption method for the** `DirectPlay8\\Direct3D registry key. A detailed`\nexplanation of the method will be published in a future post.\n\n**Figure 9. Decryption method for the Direct3D registry value**\n\n\n-----\n\n## 4.3 Anti-Forensic and Protections\n\nAs we mentioned in the Exploitation section, the forensic and tracking methods are more\ncomplicated since DirtyMoe workers are started over several processes and threads. The\nworkers are initially run as `svchost.exe, but the DirtyMoe driver changes the worker’s process`\nnames to `fontdrvhost.exe . DirtyMoe has two worker processes (Core and Executioner) that`\nare guarded to each other. So, if the first worker is killed, the second one starts a new instance of\nthe first one and vice versa.\n\n## 5. Symptoms and Deactivation\n\nAlthough DirtyMoe uses advanced protection and anti-forensics techniques, several symptoms\nindicate the presence of DirtyMoe.\n\n## 5.1 Registry\n\nThe marked indicator of DrityMoe existence is a registry key\n```\nHKLM\\SOFTWARE\\Microsoft\\DirectPlay8\\Direct3D .\n\n```\nThe DirtyMoe stores the configuration in this registry key.\n\nAdditionally, if the system registry contains duplicate keys in the path\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Services, it can point to unauthorized manipulation in the\n\n```\nWindows kernel structures. The DirtyMoe driver implements techniques to hide registry keys that\ncan cause inconsistency in the registry.\n\nThe MSI installer leaves the following flag if the installation is successful:\n\n```\nHKEY_LOCAL_MACHINE\\SOFTWARE\\SoundResearch\\UpdaterLastTimeChecked[1-3]\n\n```\n\n## 5.2 Files\n\nThe working directory of DirtyMoe is `C:\\Windows\\AppPatch . The DirtyMoe malware backups`\nthe original SENS DLL file to the working directory under the `Acpsens.dll file.`\n\nRarely, the DirtyMoe worker fails during `.moe file injection, and the`\n```\nC:\\Windows\\AppPatch\\Custom folder may contain unprocessed MOE files.\n\n```\nSometimes, DirtyMoe “forgot” to delete a temporary DLL file used for the malware deployment.\nThe temporary service is present in Windows services, and the service name pattern is\n```\nms<five-digit_random_number>app . So, the System32 folder can contain the DLL file in the\n\n```\nform: `C:\\Windows\\System32\\ms<five-digit-random-number>app.dll`\n\nThe MSI installer often creates a directory in `C:\\Program Files folder with the name of the`\nMSI product name:\n```\nFONDQXIMSYHLISNDBCFPGGQDFFXNKBARIRJH or a similar format: [A-Z]{36}\n\n## 5.3 Processes\n\n```\n\n-----\n\nOn Windows 10, the DirtyMoe processes have no live parent process since the parent is killed\ndue to anti-tracking. The workers are based on `svchost.exe . Nonetheless, the processes are`\nvisible as `fontdrvhost.exe under SYSTEM users with the following command-line arguments:`\n```\nsvchost.exe -k LocalService\nsvchost.exe -k NetworkService\n\n## 5.4 Deactivation\n\n```\nIt is necessary to stop or delete the DirtyMoe service named `Ms<volume-id>App . Unfortunately,`\nthe DirtyMoe driver hides the service even in the safe mode. So, the system should be started via\nany installation disk to avoid the driver effect and then remove/rename the service DLL file\nlocated in `C:\\Windows\\System32\\Ms<volume-id>App.dll .`\n\nThen, the DirtyMoe service is not started, and the following action can be taken:\n\nRemove `Ms<volume-id>App service`\nDelete the service DLL file\nRemove the core payload and their backup files from `C:\\Windows\\AppPatch`\n```\n      Ke<five-digit_random_number>.xsl and Ac<volume-id>.sdb\n\n```\nRemove DirtyMoe Objects from `C:\\Windows\\AppPatch\\Custom`\n```\n      <md5>.mos ; <md5>.moe ; <md5>.mow\n\n## 6. Discussion\n\n```\nParts of the DirtyMoe malware have been seen throughout the last four years. Most notably,\nNSFOCUS Technologies described these parts as Nugget Phantom [1]. However, DirtyMoe\nneeds some exploit kit for its deployment. We have clues that PurpleFox [5] and DirtyMoe are\nrelated together. The question is still whether PurpleFox and DirtyMoe are different malware\ngroups or whether PurpleFox is being paid to distribute DirtyMoe. Otherwise, both malware\nfamilies come from the same factory. Both have complex and sophisticated network\ninfrastructures. Hence, malware could be a work of the same group.\n\nThe DirtyMoe authors are probably from China. The DirtyMoe service and MOE Modules are\nwritten in Delphi. On the other hand, the DirtyMoe driver is written in Microsoft Visual C++.\nHowever, the driver is composed of rootkit techniques that are freely accessible on the internet.\nThe authors are not familiar with rootkit writing since the drive code contains many bugs that\nhave been copied from the internet. Moreover, Delphi malicious patterns would be easily\ndetectable, so the authors have been using VMProtect for the code obfuscation.\n\nThe incidence of PurpleFox and DirtyMoe has increased in the last year by order of magnitude,\nand expected occurrence indicates that DirtyMoe is and will be very active. Furthermore, the\nmalware authors seem to be a large and organized group. Therefore, DirtyMoe should be closely\nmonitored.\n\n## 7. Conclusion\n\n\n-----\n\nCryptojacking and DDoS attacks are still popular methods, and our findings indicate that\nDirtyMoe is still active and on the rise. DirtyMoe is a complex malware that has been designed as\na modular system. PurpleFox is one of the most used exploit kits for DirtyMoe deployment.\nDirtyMoe can execute arbitrary functionality based on a loaded MOE object such as DDoS, etc.,\nmeaning that it can basically do anything. In the meantime, the malware aims at crypto-mining.\n\nThe malware implements many self-defense and hiding techniques applied on local, network, and\nkernel layers. Communication with C&C servers is based on DNS requests and it uses a special\nmechanism translating DNS results to a real IP address. Therefore, blocking of C&C servers is\nnot an easy task since C&C addresses are different each time and they are not hard-coded.\n\nBoth PurpleFox and DirtyMoe are still active malware and gaining strength. Attacks performed by\nPurpleFox have significantly increased in 2020. Similarly, the number of DirtyMoe hits also\nincreases since both malware are clearly linked together. We have registered approx. 100k\ninfected computers to date. In each case, DirtyMoe and Purple Fox are still active in the wild.\nFurthermore, one MOE object aims to worm into other machines, so PurpleFox and DirtyMoe will\ncertainly increase their activity. Therefore, both should be closely monitored for the time being.\n\nThis article summarizes the DirtyMoe malware in point of high-level overview. We described\ndeploying, installation, purpose, communication, self-protecting, and statistics of DirtyMoe in\ngeneral. The following articles of the DirtyMoe series will aim to give a detailed description of the\nMSI installer package, DirtyMoe driver, services, MOE objects, and other interesting topics\nrelated to the whole DirtyMoe architecture.\n\n**References**\n\n[1] [Nugget Phantom Analysis](https://blog.nsfocusglobal.com/threats/vulnerability-analysis/nuggetphantom-analysis-report)\n\n[2] [Purple Fox Rootkit Now Propagates as a Worm](https://www.guardicore.com/labs/purple-fox-rootkit-now-propagates-as-a-worm)\n\n[3] [EternalBlue Still Relevant](https://www.avast.com/c-eternalblue)\n\n[4] [Scripting Engine Memory Corruption Vulnerability](https://securitynews.sonicwall.com/xmlpost/scripting-engine-memory-corruption-vulnerability-cve-2020-0674)\n\n[5] [Purple Fox malware](https://resources.infosecinstitute.com/topic/purple-fox-malware-what-it-is-how-it-works-how-to-prevent-it)\n\n[Tagged asbackdoor,](https://decoded.avast.io/tag/backdoor/) [cryptomining,](https://decoded.avast.io/tag/cryptomining/) [DirtyMoe,](https://decoded.avast.io/tag/dirtymoe/) [modularized,](https://decoded.avast.io/tag/modularized/) [series](https://decoded.avast.io/tag/series/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-16 - DirtyMoe- Introduction and General Overview of Modularized Malware.pdf"
    ],
    "report_names": [
        "2021-06-16 - DirtyMoe- Introduction and General Overview of Modularized Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535644,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653691045,
    "ts_modification_date": 1653691045,
    "files": {
        "pdf": "https://archive.orkl.eu/2c8f0970ad3aeedf1f02f231ebc86dd4120ec06c.pdf",
        "text": "https://archive.orkl.eu/2c8f0970ad3aeedf1f02f231ebc86dd4120ec06c.txt",
        "img": "https://archive.orkl.eu/2c8f0970ad3aeedf1f02f231ebc86dd4120ec06c.jpg"
    }
}