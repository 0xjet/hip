{
    "id": "d2a96877-02c4-494f-a9dd-9f346b038ad1",
    "created_at": "2023-01-12T15:09:18.514706Z",
    "updated_at": "2025-03-27T02:17:16.724915Z",
    "deleted_at": null,
    "sha1_hash": "dd807fc919bddec940c86039f10cc5701ee863b1",
    "title": "2020-06-25 - A close look at the advanced techniques used in a Malaysian-focused APT campaign",
    "authors": "",
    "file_creation_date": "2022-05-27T21:48:36Z",
    "file_modification_date": "2022-05-27T21:48:36Z",
    "file_size": 1642209,
    "plain_text": "# A close look at the advanced techniques used in a Malaysian-focused APT campaign\n\n**[elastic.co/blog/advanced-techniques-used-in-malaysian-focused-apt-campaign](https://www.elastic.co/blog/advanced-techniques-used-in-malaysian-focused-apt-campaign)**\n\nJune 25, 2020\n\nThe Elastic Security Intelligence & Analytics Team researches adversary innovations of\nmany kinds, and has recently focused on an activity group that leveraged remote templates,\nVBA code evasion, and DLL side-loading techniques. Based on code similarity and shared\ntactics, techniques, and procedures (TTPs), the team assessed this activity to be possibly\nlinked to a Chinese-based group known as APT40, or Leviathan. The group’s campaign\nappears to target Malaysian government officials with a lure regarding the 2020 Malaysian\npolitical crisis.\n\n## Anatomy of the attack\n\n\n-----\n\nFigure 1: Original image Figure 2: Lure document image\n\nTo initiate their advanced persistent threat (APT) campaign, the group likely delivered a\nMicrosoft Word document as a phishing lure attachment. The image used in the lure (Figure\n2) appears to be crafted from a broadcast announcement shared by a Malaysian blogger\n(Figure 1). The lure image includes the same broadcast time, but the date and speech topic\nare removed. Once this attachment is opened, a decoy document is presented while behind\nthe scenes, taking the following actions:\n\nThe lure document downloads the remote template RemoteLoad.dotm\nThe remote template executes VBA macro code\nThe VBA macro code unpacks and executes two embedded base64-encoded DLLs\n(sl1.tmp and sl2.tmp) to c:\\users\\public\\\n\nThis technique is known as template injection, which you may recall from our Playing\ndefense against Gamaredon Group blog post. This an effective approach used by\nadversaries to bypass perimeter controls such as email gateways.\n\nFigure 3: Remote template injection – RemoteLoad.dotm\n\n\n-----\n\nFigure 4: Obfuscation of MZ/PE header base64\nBoth embedded DLLs ( sl1.tmp and `sl2.tmp ) are similar and export the same function`\nnames: `RCT and` `RCP . The first DLL ( sl1.tmp ) is used to download a benign executable`\ncalled `LogiMailApp.exe and an associated library` `LogiMail.dll, and the second DLL`\n( sl2.tmp ) is used to execute `LogiMailApp.exe, which automatically attempts to`\nexecute `LogiMail.dll due to an inherent DLL search order vulnerability we’ll cover`\nshortly.\n\n\n**File name** **File**\n**type**\n\nLogiMailApp.exe Win32\nEXE\n\nLogiMail.dll Win32\nDLL\n\nsl1.tmp Win32\nDLL\n\nsl2.tmp Win32\nDLL\n\n\n**Size**\n**(bytes)**\n\n\n311656 850a163ce1f9cff0367854038d8cfa7e 2012-09-26\n22:13:13+00:00\n\n105984 b5a5dc78fb392fae927e9461888f354d 2020-06-03\n04:08:29+00:00\n\n3072 ccbdda7217ba439dfb6bbc6c3bd594f8 2019-11-29\n17:15:29+00:00\n\n3072 dbfa006d64f39cde78b0efda1373309c 2019-11-29\n21:23:44+00:00\n\n\n**MD5** **Compile time**\n\n\nTable 1: Dropped files metadata\n\n\n-----\n\nFigure 5: Download and execution of LogiMailApp.exe and LogiMail.dll\nThis implementation stood out to our researchers due to a behavioral idiosyncrasy:\n\nThe Microsoft Office application winword.exe loads sl1.tmp and sl2.tmp DLLs uses the\nLoadLibraryA method, which is moderately rare\nThese DLLs run explicit commands or install a payload from a URL using the\nCallWindowProcA method, which appears to be exceptionally rare\nBoth DLLs are deleted after execution\n\nFigure 6: Download and execution module deletion\n\n## Embedded DLLs\n\nThe embedded DLLs, `sl1.tmp and` `sl2.tmp, have very limited functionality — exporting`\nthe RCP and RCT functions. The RCP function implements the `WinExec method to`\nexecute commands where the RCT function uses the `URLDownloadToFileA method to`\ndownload a file from a specified URL.\n\n\n-----\n\nFigure 7: Exported functions – RCP and RCT\n\n## DLL side-loading a backdoor\n```\nLogiMailApp.exe, which is downloaded by sl1.tmp and executed by sl2.tmp, is vulnerable\n\n```\nto a form of DLL search-order hijacking called side-loading, which automatically searches for\nand executes `LogiMail.dll if found in the same directory. Forms of DLL search-order`\nhijacking can be used with many third-party software applications. In this case, search-order\nhijacking was used to load a backdoor that exports the following notable functions:\n\n\n-----\n\nFigure 8: LogiMail.dll exports table\n\nFigure 9: LogiMailApp.exe – Logitech camera software\n\n\n-----\n\nFigure 10: LogiMail.dll side-loading\nThe adversary-created binary LogiMail.dll exports the function `DllGetClassObject that`\ncontains critical logic for the execution flow of this sample:\n\n1. Download an AES-encrypted second stage object to `%TEMP%\\~liseces1.pcs`\n2. Derive a 128-bit AES key and initialization vector from SHA256 of a hardcoded string\n3. Read and decrypt `%TEMP%\\~liseces1.pcs in memory using the ReadFile and`\n\nCryptDecrypt functions\n4. Delete `%TEMP%\\~liseces1.pcs from disk`\n\nFigure 11: Encrypted URL and hardcoded key\n\nFigure 12: Decrypted second stage URL and temp staging file\n\n\n-----\n\nFigure 13: Second stage download, in-memory decryption, execution, and file deletion\n\n## Second stage backdoor\n\nThe decrypted second stage backdoor is mapped into memory and then its original entry\npoint (OEP) is called, thus bypassing successful detections based on file system scanning.\n\n\n-----\n\nFigure 14: LogiMail.dll — Resolving needed functions to map second stage PE into memory\n\nFigure 15: The second stage implant mapped in LogiMailApp.exe memory\nBoth the payload staging server and the second stage infrastructure use dynamic DNS:\n\nFigure 16: C2 HTTP POST request to /postlogin\nThis payload supports the following capabilities:\n\nBasic anti-debug checks\nSystem and user discovery\nExecution via command line\nFile discovery, upload, and download\nPersistence via run registry\nEncrypt C2 traffic using same AES key\n\n\n-----\n\nFigure 17: System and user discovery\n\nFigure 18: Execution via command-line\n\n\n-----\n\nFigure 19: File discovery, upload, and download\n\n## Possible APT40/Leviathan connection\n\nEarlier in the year, the Malaysian Computer Emergency Response Team (MyCERT) issued\nan [advisory related to espionage activity targeting their country. The report listed different](https://www.mycert.org.my/portal/advisory?id=MA-774.022020)\nTTPs and included multiple samples and other technical indicators that align with a threat\ngroup known as APT40/Leviathan.\n\nAt a high level, this sample follows the continued trend of targeting Malaysian victims using\nspecific TTPs such as remote templates, employing macros, using DLL side-loading\ntechniques, and leveraging an in-memory implant with dynamic DNS for command and\ncontrol. More specifically, the second stage implant from this lure shares unique strings and\nURL references and contains similar functionality that correlates with the previous reporting\nfor APT40/Leviathan. With these similarities, our Intelligence & Analytics Team assesses\nwith moderate confidence that this activity is linked to APT40/Leviathan.\n\nImplant String Similarities with MyCERT Sample:\n\n/list_direction\n/post_document\n/post_login\nOpen Remote File %s Failed For: %s\nOpen Pipe Failed %s\nDownload Read Path Failed %s\n%02X-%02X-%02X-%02X-%02X-%02X\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run\n\n\n-----\n\nntkd\n\nFigure 20: Shared strings with MyCERT sample - 8a133a382499e08811dceadcbe07\n\n## Conclusion\n\nIn this post, we highlighted a recent sample that most likely represents the work of a highly\norganized adversary. Activity groups like this are significant for everyone to take notice of, if\nonly because they represent a higher maturity level of post-exploit innovation. Their cutting\nedge TTPs today end up being everyone’s run of the mill tomorrow; it’s important to learn\nfrom these events.\n\nWe hope that by sharing some of these insights, we can help raise awareness and continue\nto focus on protecting the world's data from attack. To enable organizations further, we’ve\nadded all the observed MITRE ATT&CK techniques and indicators of compromise (IoCs)®\nbelow.\n\n\n### MITRE ATT&CK techniques®\n\n Indicators of Compromise (IOCs)\n\n**File names and paths**\n\n\n-----\n\n```\nBubar Parlimen.zip\nBubar Parlimen.docx\nRemoteLoad.dotm\nC:\\Users\\Public\\sl1.tmp\nC:\\Users\\Public\\sl2.tmp\nC:\\Users\\*\\AppData\\Local\\Temp\\~liseces1.pcs\nC:\\Users\\*\\AppData\\Local\\Microsoft\\Office\\LogiMailApp.exe\nC:\\Users\\*\\AppData\\Local\\Microsoft\\Office\\LogiMail.dll\n\n```\n**Registry keys**\n```\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ntkd\n\n```\n**URLs**\n```\nhxxps[:]//armybar[.]hopto[.]org/LogiMail.dll\nhxxps[:]//armybar[.]hopto[.]org/LogiMailApp[.]exe\nhxxps[:]//armybar[.]hopto[.]org/Encrypted\nhxxp[:]//tomema.myddns[.]me/postlogin\nhxxp[:]//tomema[.]myddns[.]me/list_direction\nhxxp[:]//tomema[.]myddns[.]me/post_document\n\n```\n**IPs**\n```\n104[.]248[.]148[.]156\n139[.]59[.]31[.]188\n\n```\n**HTTPS certificate**\n```\n74b5e317527c93539dbaaf84d6a61da92a56012a\n\n```\n**Hashes**\n```\n523cbdaf31ddc920e5b6c873f3ab42fb791fb4c9d1f4d9e6a7f174105d4f72a1\nab541df861c6045a17006969dac074a7d300c0a8edd0a5815c8b871b62ecdda7\n145daf50aefb7beec32556fd011e10c9eaa71e356649edfce4404409c1e8fa30\n93810c5fd9a287d85c182d2ad13e7d30f99df76e55bb40e5bc7a486d259810c8\n925f404b0207055f2a524d9825c48aa511199da95120ed7aafa52d3f7594b0c9\nfeca9ad5058bc8571d89c9d5a1eebce09e709cc82954f8dce1564e8cc6750a77\n06a4246be400ad0347e71b3c4ecd607edda59fbf873791d3772ce001f580c1d3\n77ef350639b767ce0a748f94f723a6a88609c67be485b9d8ff8401729b8003d2\n\n### YARA\n\n```\n\n-----\n\n```\nrule APT_APT40_Implant_June2020 {\n  meta:\n    version = \"1.0\"\n    author = \"Elastic Security\"\n    date_added = \"2020-06-19\"\n    description = \"APT40 second stage implant\"\n  strings:\n    $a = \"/list_direction\" fullword wide\n    $b = \"/post_document\" fullword wide\n    $c = \"/postlogin\" fullword wide\n    $d = \"Download Read Path Failed %s\" fullword ascii\n    $e = \"Open Pipe Failed %s\" fullword ascii\n    $f = \"Open Remote File %s Failed For: %s\" fullword ascii\n    $g = \"Download Read Path Failed %s\" fullword ascii\n    $h = \"\\\\cmd.exe\" fullword wide\n  condition:\n    all of them\n}\n\n### References\n\n```\n**We're hiring**\n\nWork for a global, distributed team where finding someone like you is just a Zoom\nmeeting away. Flexible work with impact? Development opportunities from the start?\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-25 - A close look at the advanced techniques used in a Malaysian-focused APT campaign.pdf"
    ],
    "report_names": [
        "2020-06-25 - A close look at the advanced techniques used in a Malaysian-focused APT campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "81bd7107-6b2d-45c9-9eea-1843d4b9b308",
            "created_at": "2022-10-25T15:50:23.320841Z",
            "updated_at": "2025-03-27T02:00:55.441723Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Gamaredon Group",
                "IRON TILDEN",
                "Primitive Bear",
                "ACTINIUM",
                "Armageddon",
                "Shuckworm",
                "DEV-0157",
                "Aqua Blizzard"
            ],
            "source_name": "MITRE:Gamaredon Group",
            "tools": [
                "QuietSieve",
                "Pteranodon",
                "PowerPunch"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d5156b55-5d7d-4fb2-836f-861d2e868147",
            "created_at": "2023-01-06T13:46:38.557326Z",
            "updated_at": "2025-03-27T02:00:02.861124Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Aqua Blizzard",
                "Actinium",
                "DEV-0157",
                "Blue Otso",
                "G0047",
                "PRIMITIVE BEAR",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder",
                "ACTINIUM",
                "BlueAlpha",
                "IRON TILDEN"
            ],
            "source_name": "MISPGALAXY:Gamaredon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "16f2436b-5f84-44e3-a306-f1f9e92f7bea",
            "created_at": "2023-01-06T13:46:38.745572Z",
            "updated_at": "2025-03-27T02:00:02.907444Z",
            "deleted_at": null,
            "main_name": "APT40",
            "aliases": [
                "ISLANDDREAMS",
                "TEMP.Jumper",
                "BRONZE MOHAWK",
                "GADOLINIUM",
                "KRYPTONITE PANDA",
                "TA423",
                "MUDCARP",
                "Gingham Typhoon",
                "TEMP.Periscope",
                "G0065",
                "ATK29",
                "Red Ladon",
                "ITG09"
            ],
            "source_name": "MISPGALAXY:APT40",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "61940e18-8f90-4ecc-bc06-416c54bc60f9",
            "created_at": "2022-10-25T16:07:23.659529Z",
            "updated_at": "2025-03-27T02:02:09.912404Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Actinium",
                "Aqua Blizzard",
                "Armageddon",
                "Blue Otso",
                "BlueAlpha",
                "Callisto",
                "DEV-0157",
                "Iron Tilden",
                "Operation STEADY#URSA",
                "Primitive Bear",
                "SectorC08",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder"
            ],
            "source_name": "ETDA:Gamaredon Group",
            "tools": [
                "Aversome infector",
                "BoneSpy",
                "DessertDown",
                "DilongTrash",
                "DinoTrain",
                "EvilGnome",
                "FRAUDROP",
                "Gamaredon",
                "GammaDrop",
                "GammaLoad",
                "GammaSteel",
                "Gussdoor",
                "ObfuBerry",
                "ObfuMerry",
                "PlainGnome",
                "PowerPunch",
                "Pteranodon",
                "Pterodo",
                "QuietSieve",
                "Remote Manipulator System",
                "Resetter",
                "RuRAT",
                "SUBTLE-PAWS",
                "UltraVNC"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "59be3740-c8c7-47aa-84c8-e80d0cb7ea3a",
            "created_at": "2022-10-25T15:50:23.481057Z",
            "updated_at": "2025-03-27T02:00:55.480695Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "MUDCARP",
                "Kryptonite Panda",
                "Gadolinium",
                "BRONZE MOHAWK",
                "TEMP.Jumper",
                "APT40",
                "TEMP.Periscope",
                "Gingham Typhoon"
            ],
            "source_name": "MITRE:Leviathan",
            "tools": [
                "Windows Credential Editor",
                "BITSAdmin",
                "HOMEFRY",
                "Derusbi",
                "at",
                "BLACKCOFFEE",
                "BADFLICK",
                "gh0st RAT",
                "PowerSploit",
                "MURKYTOP",
                "NanHaiShu",
                "Orz",
                "Cobalt Strike",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "236a8303-bf12-4787-b6d0-549b44271a19",
            "created_at": "2024-06-04T02:03:07.966137Z",
            "updated_at": "2025-03-27T02:05:17.410356Z",
            "deleted_at": null,
            "main_name": "IRON TILDEN",
            "aliases": [
                "Aqua Blizzard ",
                "Armageddon",
                "Blue Otso ",
                "BlueAlpha ",
                "Dancing Salome ",
                "Gamaredon",
                "Gamaredon Group",
                "Hive0051 ",
                "Primitive Bear ",
                "Shuckworm ",
                "Trident Ursa ",
                "UAC-0010 ",
                "UNC530 ",
                "WinterFlounder ",
                "ACTINIUM "
            ],
            "source_name": "Secureworks:IRON TILDEN",
            "tools": [
                "Pterodo"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b9806584-4d82-4f32-ae97-18a2583e8d11",
            "created_at": "2022-10-25T16:07:23.787833Z",
            "updated_at": "2025-03-27T02:02:09.978883Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "APT 40",
                "ATK 29",
                "Bronze Mohawk",
                "Gadolinium",
                "Gingham Typhoon",
                "ISLANDDREAMS",
                "ITG09",
                "Kryptonite Panda",
                "Mudcarp",
                "Red Ladon",
                "TA423",
                "TEMP.Jumper",
                "TEMP.Periscope"
            ],
            "source_name": "ETDA:Leviathan",
            "tools": [
                "AIRBREAK",
                "Agent.dhwf",
                "Agentemis",
                "AngryRebel",
                "BADFLICK",
                "BlackCoffee",
                "CHINACHOPPER",
                "China Chopper",
                "Cobalt Strike",
                "CobaltStrike",
                "DADJOKE",
                "Dadstache",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "GRILLMARK",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEFRY",
                "Hellsing Backdoor",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LUNCHMONEY",
                "Living off the Land",
                "MURKYTOP",
                "Moudour",
                "Mydoor",
                "NanHaiShu",
                "Orz",
                "PCRat",
                "PNGRAT",
                "PlugX",
                "RedDelta",
                "SeDLL",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "cobeacon",
                "gresim",
                "scanbox"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "83025f5e-302e-46b0-baf6-650a4d313dfc",
            "created_at": "2024-05-01T02:03:07.971863Z",
            "updated_at": "2025-03-27T02:05:17.278721Z",
            "deleted_at": null,
            "main_name": "BRONZE MOHAWK",
            "aliases": [
                "Flaccid Rose ",
                "GADOLINIUM ",
                "Kryptonite Panda ",
                "Leviathan ",
                "Nanhaishu ",
                "Pickleworm ",
                "Temp.Jumper ",
                "Temp.Periscope ",
                "APT40 "
            ],
            "source_name": "Secureworks:BRONZE MOHAWK",
            "tools": [
                " BlackCoffee",
                " China Chopper",
                " Cobalt Strike",
                " Derusbi",
                " Derusbi Trojan",
                " FUSIONBLAZE",
                " GreenCrash",
                " HOMEFRY",
                " MURKYTOP",
                " Metasploit",
                " Metasploit / Meterpreter",
                " Nanhaishu",
                " Orz",
                " ScanBox",
                " SeDll",
                "AIRBREAK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536158,
    "ts_updated_at": 1743041836,
    "ts_creation_date": 1653688116,
    "ts_modification_date": 1653688116,
    "files": {
        "pdf": "https://archive.orkl.eu/dd807fc919bddec940c86039f10cc5701ee863b1.pdf",
        "text": "https://archive.orkl.eu/dd807fc919bddec940c86039f10cc5701ee863b1.txt",
        "img": "https://archive.orkl.eu/dd807fc919bddec940c86039f10cc5701ee863b1.jpg"
    }
}