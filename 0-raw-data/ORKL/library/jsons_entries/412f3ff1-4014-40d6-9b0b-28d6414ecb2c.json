{
    "id": "412f3ff1-4014-40d6-9b0b-28d6414ecb2c",
    "created_at": "2023-06-24T02:09:24.071695Z",
    "updated_at": "2025-03-27T02:06:00.981098Z",
    "deleted_at": null,
    "sha1_hash": "c12ca984f50e4cd5b6100424c2c6127398fc2851",
    "title": "",
    "authors": "",
    "file_creation_date": "2023-06-22T11:56:20Z",
    "file_modification_date": "2023-06-22T11:56:20Z",
    "file_size": 385018,
    "plain_text": "# BlackLotus Mitigation Guide\n\n## Executive summary\n\nBlackLotus is a recently publicized malware product garnering significant attention within tech\nmedia. Similar to 2020’s BootHole (CVE-2020-10713), BlackLotus takes advantage of a boot\nloader flaw—specifically CVE-2022-21894 Secure Boot bypass known as “Baton Drop”—to\n\ntake control of an endpoint from the earliest phase of software boot. Microsoft[®] issued patches\n\nfor supported versions of Windows to correct boot loader logic. However, patches were not\n\nissued to revoke trust in unpatched boot loaders via the Secure Boot Deny List Database\n(DBX). Administrators should not consider the threat fully remediated as boot loaders\nvulnerable to Baton Drop are still trusted by Secure Boot.\n\nAs described in this Cybersecurity Information Sheet (CSI), NSA recommends infrastructure\nowners take action by hardening user executable policies and monitoring the integrity of the\nboot partition. An optional advanced mitigation is to customize Secure Boot policy by adding\n\nDBX records to Windows[®] endpoints or removing the Windows Production CA certificate from\n\nLinux[®] endpoints.\n\n## BlackLotus boot security threat\n\nNSA recognizes significant confusion regarding the threat posed by BlackLotus. Some\norganizations use terms like “unstoppable,” “unkillable,” and “unpatchable” to describe the\nthreat. Other organizations believe there is no threat due to patches that Microsoft released in\nJanuary 2022 and early 2023 for supported versions of Windows. [1] The risk exists\nsomewhere between both extremes.\n\nBlackLotus shares some characteristics with Boot Hole (CVE-2020-10713). [2] Instead of\nbreaking the Linux boot security chain, BlackLotus targets Windows boot by exploiting a flaw in\nolder boot loaders—also called boot managers—to set off a chain of malicious actions that\n\ncompromise endpoint security. Exploitation of Baton Drop (CVE-2022-21894) allows\nBlackLotus to strip the Secure Boot policy and prevent its enforcement. Unlike Boot Hole, the\nvulnerable boot loaders have not been added to the Secure Boot DBX revocation list. Because\nthe vulnerable boot loaders are not listed within the DBX, attackers can substitute fully patched\nboot loaders with vulnerable versions to execute BlackLotus.\n\nNSA recommends system administrators within DoD and other networks take action.\nBlackLotus is not a firmware threat, but instead targets the earliest software stage of boot.\n\n\n-----\n\nDefensive software solutions can be configured to detect and prevent the installation of the\nBlackLotus payload or the reboot event that starts its execution and implantation. NSA\nbelieves that currently published patches could provide a false sense of security for some\ninfrastructures. Because BlackLotus integrates Shim and GRUB into its implantation routine,\nLinux administrators should also be vigilant for variants affecting popular Linux distributions.\n\n## Mitigation recommendations\n\n### Action 1: Update recovery media and activate optional mitigations\n\n**Recommended for all Windows infrastructures. Not applicable to Linux infrastructures.**\n\nNSA recommends Windows administrators install the latest security patches for their\nendpoints. Microsoft patches from May 2023 contain optional software mitigations to prevent\nrollback of the boot manager and kernel to versions vulnerable to Baton Drop and BlackLotus.\nThe optional mitigations – including a Code Integrity Boot Policy – should be enabled after the\norganization has updated its Windows installation, recovery, and diagnostic software to the\nlatest available versions. [3]\n\nInfrastructure administrators should note that Windows 10 and 11 have applicable security\nupdates and ongoing mitigation deployments for BlackLotus. Older, unsupported Windows\nversions will not receive the full complement of BlackLotus mitigation measures. Windows\ninfrastructures should migrate to supported versions of Windows if running an unsupported\nrelease. [3]\n\n### Action 2: Harden defensive policies\n\n**Recommended for all infrastructures. The malware install process for BlackLotus places an**\n\nolder Windows boot loader Extensible Firmware Interface (EFI) binary into the boot partition,\ndisables Memory Integrity, disables BitLocker, and reboots the device. Many endpoint security\nproducts (e.g., Endpoint Detection and Response, host-based security suites, user-monitoring\npackages) can be configured to block one or more of these events outside of a legitimate,\nscheduled update. Configure defensive software to scrutinize changes to the EFI boot partition\nin particular. Alternatively, leverage application allow lists to permit only known and trusted\nexecutables.\n\n### Action 3: Monitor device integrity measurements and boot configuration\n\n**Recommended for most infrastructures. Many endpoint security products and firmware**\n\nmonitoring tools provide integrity-scanning features. Configure these products and tools to\nmonitor the composition of the EFI boot partition. Leverage these tools to look for unexpected\n\n\n-----\n\nchanges in bootmgfw.efi, bootmgr.efi, or the introduction of additional unexpected EFI binaries\n(e.g., shimx64.efi or grubx64.efi). Changes to the boot partition are infrequent and warrant\nadditional scrutiny.\n\nIf unexpected changes are detected within the EFI boot partition, prevent the device from\nrebooting. Endpoint and host defensive suites may allow creating rules or triggers that can be\npaired with group policies to temporarily restrict reboot. Remediate the boot partition to a\nknown good state before permitting reboot. A reboot will execute EFI binaries and can implant\nBlackLotus.\n\nMicrosoft has published specific information regarding the staging of BlackLotus components,\nalterations to Windows registry values, and network indicators. Full specifics can be found at\nthe Microsoft Incident Response blog. [4]\n\n### Action 4: Customize UEFI Secure Boot\n\n**4.A. Instructions for Windows infrastructures. Expertly administered and exposed**\n**infrastructures only. Not recommended due to limited long-term effectiveness.**\n\nBlackLotus relies upon older (pre-January 2022), signed Windows boot loader images to\nimplant a system. Secure Boot can be updated with DBX deny list hashes that prevent\nexecuting older and vulnerable boot loaders. Public reporting [5] provides indications as to\n\nwhich boot managers are observed exploited in the wild. In 2020, NSA published \"UEFI\nSecure Boot Customization\" to provide guidance on modifying Secure Boot. Adding DBX\nhashes qualifies as a partial customization action covered in section 4 \"Customization,\"\nstarting on page 7, and continuing through section 4.4.3 “Update the DB or DBX.” [6]\nAdditionally, a GitHub.com repository has been set up with some helpful scripts and guides to\naccomplish customization. [7]\n\n**Note: Adding boot loader hashes to the DBX may render many Windows install and recovery**\n\nimages, discs, and removable media drives unbootable. Microsoft provides updated install and\nrecovery images for Windows 11 and 10. Only update the DBX after acquiring install and\n\nrecovery media with the January 2022 or later patch assortment applied (e.g., version 22H1 or\nnewer).\n\n**Warning: The following DBX hashes may be combined with the Secure Boot Customization**\n\nsteps to revoke trust in select boot loaders vulnerable to Baton Drop. [6] However, more\nvulnerable boot loaders exist than the DBX can contain. BlackLotus developers can rapidly\nswitch to alternate vulnerable boot loaders to evade DBX customization. Mitigating BlackLotus\n\n\n-----\n\nvia DBX updates is not recommended. Action 1’s patches and optional mitigations are\nrecommended instead.\n\n**_Table: DBX hashes_**\n\n**#** **UEFI Secure Boot DBX Hashes**\n```\n1 B22A7B3CEBB32C80C36EAABB6F77D164AE8B76BF161F423B6E2FBF9DCBC96C02\n2 D355041DFBA41F8AE2CE6766ECBC88C93A743FC74F95E7E7AA3EF32CA6E4B390\n3 D9F629F6D1D83AC7A15DCB1116E4B9BF128758EC2EA389AA1E0DA3B8F2951150\n4 53FCE58746C4B042B101B8682B4E52CE8B620D3C68F69034996E33D3DDDCA1FF\n5 F7357DD5000E1FBADBF17CC6025243A243D1BFA705801051119277A30D717B71\n6 39C6475B3F00D92EEC049D8F6EFA010CB06F1240ED1CE7E40611278C73817471\n7 2E094D21DC457CC4826FCD48395B92DC782F978EEF8210E4B6F5E708527907FF\n8 BFE0E68889A750E699788C11F08AFAE940770ED83C1B4A5DB27E10933B29CAD1\n\n```\n**4.B. Instructions for Linux infrastructures. Expertly administered and exposed**\n**infrastructures only.**\n\nLinux system administrators may forego adding DBX hashes in favor of removing the Microsoft\nWindows Production CA 2011 certificate from Secure Boot’s DB. The total number of Baton\nDrop-vulnerable boot loaders signed by the key associated with the Production CA’s certificate\nis thought to exceed the available DBX memory. Removing the certificate negates the need to\nadd DBX entries related to Baton Drop and BlackLotus. Linux administrators will still need the\nMicrosoft Unified Extensible Firmware Interface (UEFI) Third Party Marketplace CA 2011\ncertificate to utilize Secure Boot with leading Linux distributions. [6]\n\nDo not place the Windows Production CA 2011 certificate in the Machine Owner Key Exclusion\n(MOKX) list in lieu of removing it from the DB. Utilizing MOKX in this way will cause the\nrevoked certificate to still be trusted between firmware initialization and the initialization of\nShim’s Secure Boot extensions.\n\nThe Windows Production CA 2011 certificate must be restored if converting the device from\nLinux to Windows. Microsoft provides the certificate for download via their resources for\nsystem manufacturers. [9]\n\n|#|UEFI Secure Boot DBX Hashes|\n|---|---|\n|1|B22A7B3CEBB32C80C36EAABB6F77D164AE8B76BF161F423B6E2FBF9DCBC96C02|\n|2|D355041DFBA41F8AE2CE6766ECBC88C93A743FC74F95E7E7AA3EF32CA6E4B390|\n|3|D9F629F6D1D83AC7A15DCB1116E4B9BF128758EC2EA389AA1E0DA3B8F2951150|\n|4|53FCE58746C4B042B101B8682B4E52CE8B620D3C68F69034996E33D3DDDCA1FF|\n|5|F7357DD5000E1FBADBF17CC6025243A243D1BFA705801051119277A30D717B71|\n|6|39C6475B3F00D92EEC049D8F6EFA010CB06F1240ED1CE7E40611278C73817471|\n|7|2E094D21DC457CC4826FCD48395B92DC782F978EEF8210E4B6F5E708527907FF|\n|8|BFE0E68889A750E699788C11F08AFAE940770ED83C1B4A5DB27E10933B29CAD1|\n\n\n-----\n\n## Frequently asked questions\n\n### 1. Is BlackLotus a firmware implant? \n\nNo. BlackLotus is boot software. The UEFI boot process involves several phases. Execution\ncontrol flow transitions from firmware to software following the Boot Device Select phase. [8]\n\n### 2. Can BlackLotus be removed or quarantined?\n\nYes, prior to execution. Devices that boot to a BlackLotus EFI binary will need to be completely\nreimaged. Attempts to remove BlackLotus following installation result in kernel errors.\n\n### 3. Does BlackLotus bypass Secure Boot?\n\nAn initial bypass is followed by poisoning that configures Secure Boot to trust the malware. An\nolder, vulnerable boot loader that is trusted by Secure Boot is necessary to strip the Secure\nBoot policy from being enforced so that BlackLotus can implant its entire software stack.\nSubsequent boots extend the Microsoft UEFI signing ecosystem with a malicious BlackLotus\ncertificate. Thus, Secure Boot will trust the malware.\n\n### 4. Which version of Windows is affected?\n\nBlackLotus targets Windows 11 and 10. Variants may exist to target older, UEFI-booting\nversions of Windows. Patches are available for Windows 8.1, 10, and 11.\n\n### 5. Is Linux affected? Is there a version of BlackLotus that targets Linux?\n\nNo, not that has been identified at this time. BlackLotus does incorporate some Linux boot\nbinaries, but the malware targets Windows OS software. No Linux-targeting variant has been\nobserved.\n\n### 6. Is BlackLotus really unstoppable?\n\nNo – BlackLotus is very stoppable on fully updated Windows endpoints, Secure Bootcustomized devices, or Linux endpoints. Microsoft has released patches and continues to\nharden mitigations against BlackLotus and Baton Drop. [1], [3], [4] The Linux community may\nremove the Microsoft Windows Production CA 2011 certificate on devices that exclusively boot\nLinux. Mitigation options available today will be reinforced by changes to vendor Secure Boot\ncertificates in the future (some certificates are expiring starting in 2026).\n\n### 7. Where can I find more public information?\n\nNSA is aware of several technically deep analysis reports posted online from security\nresearchers and vendors. One thorough source of public information is ESET Security’s blog\n\n\n-----\n\nreferenced as [5] in this report. Another source of information is the Microsoft Security\nResponse Center. [3], [4]\n\n### 8. Should I reconfigure Secure Boot?\n\nNo. Secure Boot is best left enabled in standard mode. Only advanced infrastructures and\nexpert administrators should engage the custom/user-defined mode. Some security software\nmay require additional certificates or hashes to be added to the DB allow list or DBX deny list.\nNo one should disable Secure Boot on an endpoint built within the past 5 years.\n\n### 9. Can a Trusted Platform Module (TPM) stop BlackLotus?\n\nNo. A TPM can only detect BlackLotus. Implant boot binaries are delivered to the EFI boot\npartition after the TPM has recorded boot time measurements. Upon the next reboot, the TPM\ncaptures measurements showing a BlackLotus infection. However, a TPM can only detect –\nnot prevent – implantation as the TPM is an observer and container of integrity indicator data.\nA TPM does not have an active enforcement capability.\n\nIn a Network Access Control (NAC) infrastructure based on TPM attestation, NAC would\nprevent infected machines from accessing protected resources by indicating changes in\nPlatform Configuration Registers (PCRs) 4-7. NAC also provides an opportunity to remediate\naffected endpoints prior to connecting to a protected resource.\n\n### 10. Can TPM-extended Shim / TrustedShim (T-Shim) stop BlackLotus?\n\nNo. T-Shim checks TPM measurements recorded prior to the main boot loader. Secure Boot is\nresponsible for enforcement following T-Shim.\n\n### 11. What is Secure Boot customization?\n\nCustomization involves one of the following:\n\n  - **Partial customization – augmenting the Microsoft and system vendor Secure Boot**\n\necosystem with additional DB and DBX entries as necessary to enable signature and\n\nhash checks on unsupported/custom software or block unwanted software.\n\n  - **Full customization – replacing all vendor and Microsoft certificates and hashes with**\n\nthose generated and selected by the infrastructure owner (requires specialized\nknowledge of hardware values).\n\n\n-----\n\n### 12. How does BlackLotus compare to Boot Hole?\n\nBoot Hole involved flaws in Secure Boot-signed GRUB boot loaders. A configuration file could\nbe created to cause buffer overflows and arbitrary code execution at boot time. Secure Boot\ncould be ignored and completely bypassed.\n\nBlackLotus is sophisticated malware observed in the wild. It exploits a flaw (known as Baton\nDrop) in Secure Boot-signed copies of the Windows Boot Manager to truncate the Secure Boot\npolicy values. Instead of stopping due to the lack DB and DBX values, the vulnerable boot\nmanager allows boot to continue. BlackLotus injects a version of Shim utilizing its own\nMachine Owner Key (MOK) – similar to the allow list DB – to vouch for signatures on its own\nmalicious binaries. The result is Secure Boot remains enforcing while silently poisoned and\npermitting malware to execute.\n\n### 13. Why doesn’t NSA recommend setting up a custom Secure Boot ecosystem as a mitigation?\n\nNSA has internally piloted efforts to exclusively rely on custom certificates and hashes to\ndefine Secure Boot policy. Pilot efforts have proven effective at preventing threats like\nBlackLotus, Baton Drop, BootHole, and similar prior to discovery. However, the administrative\noverhead and vendor collaboration necessary represent a resource investment not appropriate\nfor most enterprise infrastructures. The process of fully customizing Secure Boot is also not\ncapable of being automated outside of a narrow selection of workstation and server products.\n\n### 14. Can Trusted eXecution Technology (TXT) stop BlackLotus?\n\nYes, if and only if the TPM non-volatile memory (NVRAM) policy is set to boot a specific boot\nloader. In practice, setting a specific boot loader has caused administrative challenges when\nhandling updates that affect the EFI boot partition. TXT is not a recommended mitigation given\nthe likelihood to render endpoints temporarily unbootable.\n\n### 15. Are virtual machines affected?\n\nYes. VMs boot into a virtual UEFI environment. BlackLotus targets the OS software boot\n\nloaders that execute following the virtual firmware initialization.\n\n## Works cited\n\n[1] Microsoft Security Response Center (2022), January 2022 Security Updates.\n\n[https://msrc.microsoft.com/update-guide/releaseNote/2022-Jan](https://msrc.microsoft.com/update-guide/releaseNote/2022-Jan)\n\n[2] [Eclypsium (2020), There’s a Hole in the Boot. https://eclypsium.com/2020/07/29/theres-a-hole-in-the-boot](https://eclypsium.com/2020/07/29/theres-a-hole-in-the-boot)\n\n[3] Microsoft Security Response Center (2023), KB5025885: How to manage the Windows Boot Manager\n\nrevocations for Secure Boot changes associated with CVE-2023-24932.\n[https://support microsoft com/help/5025885](https://support.microsoft.com/help/5025885)\n\n\n-----\n\n[4] Microsoft Incident Response (2023), Guidance for investigating attacks using CVE-2022-21894: The\n\n[BlackLotus campaign. https://www.microsoft.com/en-us/blog/2023/04/11/guidance-for-investigating-](https://www.microsoft.com/en-us/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign)\n[attacks-using-cve-2022-21894-the-blacklotus-campaign](https://www.microsoft.com/en-us/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign)\n\n[5] Smolar, Martin (2023), BlackLotus UEFI Bootkit: Myth Confirmed.\n\n[https://www.welivesecurity.com/2023/03/01/blacklotus-uefi-bootkit-myth-confirmed](https://www.welivesecurity.com/2023/03/01/blacklotus-uefi-bootkit-myth-confirmed)\n\n[6] National Security Agency (2020), UEFI Secure Boot Customization [S/N: U/OO/168873-20].\n\n[https://media.defense.gov/2020/Sep/15/2002497594/-1/-1/0/CTR-UEFI-SECURE-BOOT-](https://media.defense.gov/2020/Sep/15/2002497594/-1/-1/0/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF)\n[CUSTOMIZATION-20200915.PDF/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF](https://media.defense.gov/2020/Sep/15/2002497594/-1/-1/0/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF)\n\n[7] National Security Agency (2020), UEFI Secure Boot Customization.\n\n[https://github.com/nsacyber/Hardware-and-Firmware-Security-Guidance/tree/master/secureboot](https://github.com/nsacyber/Hardware-and-Firmware-Security-Guidance/tree/master/secureboot)\n\n[8] Carnegie Mellon University (2022), UEFI – Terra Firma for Attackers.\n\n[https://insights.sei.cmu.edu/blog/uefi-terra-firma-for-attackers/](https://insights.sei.cmu.edu/blog/uefi-terra-firma-for-attackers/)\n\n[9] Microsoft (2022), Windows Secure Boot Key Creation and Management Guidance.\n\n[https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-secure-boot-key-](https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-secure-boot-key-creation-and-management-guidance)\n[creation-and-management-guidance](https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-secure-boot-key-creation-and-management-guidance)\n\n**_Disclaimer of endorsement_**\n\nThe information and opinions contained in this document are provided \"as is\" and without any warranties or guarantees.\nReference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or\notherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government. This\nguidance shall not be used for advertising or product endorsement purposes.\n\n**_Purpose_**\n\nThis document was developed in furtherance of NSA’s cybersecurity missions, including its responsibilities to identify and\ndisseminate threats to National Security Systems, Department of Defense, and Defense Industrial Base information systems,\nand to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all\nappropriate stakeholders.\n\n**_Contact_**\n\n[Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov](mailto:CybersecurityReports@nsa.gov)\n[Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov](mailto:DIB_Defense@cyber.nsa.gov)\nMedia Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://media.defense.gov/2023/Jun/22/2003245723/-1/-1/0/CSI_BlackLotus_Mitigation_Guide.PDF"
    ],
    "report_names": [
        "CSI_BlackLotus_Mitigation_Guide.PDF"
    ],
    "threat_actors": [],
    "ts_created_at": 1687572564,
    "ts_updated_at": 1743041160,
    "ts_creation_date": 1687434980,
    "ts_modification_date": 1687434980,
    "files": {
        "pdf": "https://archive.orkl.eu/c12ca984f50e4cd5b6100424c2c6127398fc2851.pdf",
        "text": "https://archive.orkl.eu/c12ca984f50e4cd5b6100424c2c6127398fc2851.txt",
        "img": "https://archive.orkl.eu/c12ca984f50e4cd5b6100424c2c6127398fc2851.jpg"
    }
}