{
    "id": "67cf0d09-57e6-40d6-84fe-7dae9981462f",
    "created_at": "2022-10-25T16:48:23.755723Z",
    "updated_at": "2025-03-27T02:17:02.282241Z",
    "deleted_at": null,
    "sha1_hash": "4ef2ac990d902dd57573c84d2a9e32073419be36",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-10-27T10:07:04Z",
    "file_modification_date": "2021-10-27T10:07:04Z",
    "file_size": 3458026,
    "plain_text": "# Malware WinDealer used by LuoYu Attack Group\n\n**blogs.jpcert.or.jp/en/2021/10/windealer.html**\n\n増渕 [維摩(Yuma Masubuchi)](https://blogs.jpcert.or.jp/en/masubuchi/)\n\nOctober 26, 2021\n\n[Email](mailto:?subject=Malware%20WinDealer%20used%20by%20LuoYu%20Attack%20Group&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2021%2F10%2Fwindealer.html)\n\n[During JSAC2021 on 28 January 2021, there was a presentation about an attack group](https://jsac.jpcert.or.jp/archive/2021/en/index.html)\nLuoYu, which targets Korean and Japanese organisations since 2014 [1][2]. Recently,\nJPCERT/CC came across malware WinDealer used by this group. This article introduces\nsome findings of our analysis.\n\n### Malware WinDealer overview\n\nWinDealer steals information of an infected PC and sends it to a C2 server as described in\nFigure 1.\n\n\n-----\n\nFigure 1： Malware WinDealer behaviour overview\n\nOnce launched, the malware reads configuration from a file under C:\\ProgramData and\nloads a DLL module on its memory. It steals information about the victim PC, network\nconfiguration and SNS applications etc. and saves them in a file with an “.a” extension\nunder %TEMP%, which is then sent to a C2 server.\n\nThe following points will be described in the next sections.\n\nRead configuration\nCommunicate with C2 servers\nProcess and send stolen data\nFunctions of modules loaded on memory\n\n### Read configuration\n\nThe malware stores its configuration in several folders under C:\\ProgramData and reads\nit when executed. The contents are encoded based on XOR with its key value\n“b6a7%7486”. Please refer to Appendix A for the configuration file path and its contents.\nFigure 2 shows a function to decode configuration.\n\n\n-----\n\nFigure 2：Function to decode a file storing configuration\n\n### Communicate with C2 servers\n\nIf the following configuration files exist in the designated folder, WinDealer loads the C2\nserver information from them and starts communicating.\n\nC:\\ProgramData\\ad5f82e8\nC:\\ProgramData\\1c76cbfe\nC:\\ProgramData\\9c3b6294\n\n\n-----\n\nIf no such file exists, WinDealer communicates to a random IP address in one of the\nfollowing ranges (port 6999/UDP or 55556/TCP). It switches to an IP address in the\nother range at a certain interval.\n\n113.62.0.0 - 113.63.255.255\n111.120.0.0 - 111.123.255.255\n\nFigure 3 shows the malware’s communication flow with its C2 server. First, it encrypts an\nAES key with RSA algorithm and sends to a C2 server. Information stolen from a victim\nPC is encrypted with this AES key and sent to a C2 server at a certain interval. After that,\nC2 server sends a command to the victim PC. The malware executes it and sends the\nresult to the C2 server after encryption. Besides the data exchange, the malware also\ncommunicates with domains such as www[.]microsoftcom (non-existent at the moment)\nand icanhazip[.]com.\n\nFigure 3: Communication flow with a C2 server\n\nFigure 4 describes the communication contents when delivering an AES key. AES key and\nits CRC32 checksum value are encrypted with RSA1024bit public key. The public key is\nhardcoded in the sample, which is also used for other samples as well.\n\n\n-----\n\nFigure 4： Example of contents sent with AES key\n\nFrom the second round of communication and onwards, data is encrypted in AES128bit\nECB mode based on the AES key which was dynamically generated during the initial\ncommunication. Please refer to Appendix B for the details of data format.\n\n### Process and send stolen data\n\nWinDealer processes a series of stolen data as “.a” file in a folder under %TEMP%,\nencrypts it with AES and send it to a C2 server. The flow of event is illustrated in Figure 5.\nThe modules steal and process the data, while WinDealer itself monitors the files under\n%TEMP%, encrypts the file and sends it to a C2 server.\n\n\n-----\n\nFigure 5：Flow of events by WinDealer and modules\n\nA part of the code for generating “.a” file by a module is as follows (Figure 6):\n\nFigure 6： DLL module’s code to generate “.a” file\n\nThe stolen data is first stored in a file with an “.t” extension, which is then renamed to\n“.a”. The series of data is stored in different directories based on the data category, and\nthey are taken out when “.a” file is created. Please refer to Appendix E for the details of\neach directory.\n\nBefore writing and reading the files, the data is encoded/decoded by XOR-based function\nwith its key value “YYYY” as in Figure 7.\n\n\n-----\n\nFigure 7：A function for XOR-based encoding when accessing “.a” file\n\n### Functions of modules loaded on memory\n\nOnce launched, WinDealer loads a DLL module in a PE format (encoded in the sample)\non the memory and executes it (Figure 8).\n\n\n-----\n\nFigure 8： Encoded module data\n\nThe malware obtains its file path, searches for a byte string “0xFF3456FF00” and extracts\ndata from its offset 0xE. Using its offset 0x4 value and a XOR-based decode routine\n(Figure 9), a DLL module is loaded on the memory and then executed.\n\nFigure 9： Decoding module\n\n\n-----\n\nThe loaded DLL module is named as “MozillaDll.dll”. There are 3 Export functions as\nfollows:\n\nAutoGetSystemInfo: Steal data\nGetConfigInfo: Set configuration\npartInitOpt: Set commands\n\nThe loaded DLL module monitors the below items, saves related items in a separate file\nand obtains them to send out to a C2 server.\n\nFiles stored in a USB memory\nFiles under Documents, desktop and recycle bin\nFiles under folders related to SNS applications\n\nPlease see Appendix D for the details of commands that C2 server sends and its contents.\n\n### In closing\n\nBesides WinDealer, it has been confirmed that LuoYu uses other kinds of malware that\noperate in various platforms. We will report if we observe a new type of malware.\n\nFor your reference, SHA256 hash values of similar samples are listed in Appendix F.\n\n- Yuma Masubuchi\n\n(Translated by Yukako Uchida)\n\n## Reference\n\n[1] “LuoYu” The eavesdropper sneaking in multiple platforms\n\n[https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_301_shui-leon_en.pdf](https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_301_shui-leon_en.pdf)\n\n[2] Japan Security Analyst Conference 2021 -3rd Track\n[https://blogs.jpcert.or.jp/en/2021/02/jsac2021report1.html](https://blogs.jpcert.or.jp/en/2021/02/jsac2021report1.html)\n\n## Appendix A WinDealer configuration\n\nFile path String in Contents\nmalware\n\nC:\\ProgramData\\923b5fd7 remark \nC:\\ProgramData\\ad5f82e8 remotedomain Domain name\n\nC:\\ProgramData\\8fe4c114 password \n|File path|String in malware|Contents|\n|---|---|---|\n|C:\\ProgramData\\923b5fd7|remark|-|\n|C:\\ProgramData\\ad5f82e8|remotedomain|Domain name|\n\n\n-----\n\n|C:\\ProgramData\\1c76cbfe|remoteip|C2 server IP|\n|---|---|---|\n|C:\\ProgramData\\9c3b6294|reverseip|C2 server IP (reconfigured)|\n|C:\\ProgramData\\789406d0|-|Result of connection to a dummy host|\n|C:\\ProgramData\\c25549fe|otherinfo|-|\n|C:\\ProgramData\\f46d373b|-|Created when launched|\n|C:\\ProgramData\\windows.inf|-|-|\n|C:\\ProgramData\\Destro|-|Name information to register in run key|\n\n\n：\nTable A List of configuration\n\n## Appendix B WinDealer Contents of data exchanged\n\nOffset Length Contents\n(byte)\n\n0x00 4 0x91DA8106\n\n0x04 4 0x439FC7CE\n\n0x08 4 Victim PC identifier\n\n0x0C 1 Generated based on the contents of a configuration file\n\"789406d0\"\n\n0x0D 3 0x001400\n\n0x10 128 AES key + RSA-encrypted data of AES key’s CRC32 value\n\n：\nTable B-1 Format of data sent for first communication\n\n|Offset|Length (byte)|Contents|\n|---|---|---|\n|0x00|4|0x91DA8106|\n|0x04|4|0x439FC7CE|\n|0x08|4|Victim PC identifier|\n|0x0C|1|Generated based on the contents of a configuration file \"789406d0\"|\n|0x0D|3|0x001400|\n|0x10|128|AES key + RSA-encrypted data of AES key’s CRC32 value|\n\n\n-----\n\n|Offset|Length (byte)|Contents|\n|---|---|---|\n|0x00|4|0x91DA8106|\n|0x04|4|0x439FC7CE|\n|0x08|4|Victim PC identifier|\n|0x0C|1|Generated based on the contents of a configuration file \"789406d0\"|\n|0x0D|1|Type|\n|0x0E|2|0x1400|\n|0x10|1|Length|\n|0x11|1|0x6|\n|0x12|1|remark length|\n|0x13||remark|\n|-|1|0x3|\n|-|1|password length|\n|-|-|password|\n|-|1|0x5|\n|-|1|otherinfo length|\n|-|-|otherinfo|\n|-|-|System information|\n\n\n-----\n\n：\nTable B-2 Format of data sent for second communication onwards\n\nOffset Length (byte) Contents\n\n0x00 4 0x91DA8106\n\n0x04 4 0x439FC7CE\n\n0x0D 1 Commands\n\n0x10 2 command data length\n\n0x12 2 Unused\n\n0x14 2 Unused\n\n0x16 2 Unused\n\n0x18 Command data length Command data\n\n：\nTable B-3 Format of data received\n\n## Appendix C WinDealer List of commands\n\n|Offset|Length (byte)|Contents|\n|---|---|---|\n|0x00|4|0x91DA8106|\n|0x04|4|0x439FC7CE|\n|0x0D|1|Commands|\n|0x10|2|command data length|\n|0x12|2|Unused|\n|0x14|2|Unused|\n|0x16|2|Unused|\n|0x18|Command data length|Command data|\n\n|Value|Parameter string*|Contents|\n|---|---|---|\n|0x06|content-length: 2|uninstall|\n|0x09|content-length, filename, time|Delete files under %TEMP%|\n|0xC|filename, flg|CreateProcess|\n|0x1F|speed|Configure Sleep time|\n|0x2D|filepath|Obtain contents of selected file|\n\n\n-----\n\n|0x50|filename, md5|Delete selected file|\n|---|---|---|\n|0x51|filepos,filename, filelen, block, md5|Write on selected file|\n|0x5A|datastate|Write on \"C:\\ProgramData\\windows.inf\"|\n|0x5B|-|Perpetuation settings for registries|\n|0x5C|list|Perpetuation after process check|\n|0x5D|yes|Set a value to SType of {HKCU}\\\\Softwaware\\Microsoft|\n|0x5E|otherinfo|Write on \"c25549fe\"|\n|0x60|headsign, 1, 2|Write on \"789406d0\"|\n|0x61|reverseip|Write on \"9c3b6294\"|\n|0x63|-|Obtain configuration|\n|0x64|-|Read time|\n|0x66|remoteip, remark, password|Write on configuration files|\n|0x67|sessionid:|-|\n|0x8F|Hkey, subkey, valuename, classesroot, currentuser, localmachine, users, currentconfig|Execute RegQueryValue|\n|0xAA|pname|Screen capture|\n|0xAB|-|Configuration on screen capture|\n\n\n-----\n\n|0xAD|-|Configuration on screen capture|\n|---|---|---|\n\n\n：\nTable C List of commands\n\n*Parameter string: These strings are parsed from the received command and used as a\ncommand parameter\n\n## Appendix D List of commands of loaded modules\n\n|Value|Parameter string*|Contents|\n|---|---|---|\n|0x02|-|Related to screen capture|\n|0x03|bootdir, filetype|Related to folder/files|\n|0x05|filename, monitortype, begpos, block|Send files|\n|0x07|-|Obtain drive information|\n|0x0A|-|Configure for lnk files|\n|0x0D|-|Execute commands 0xC0, 0xC5, 0xC3, 0xC1, 0xC2, 0xC4, 0xC6|\n|0x12|freq, storetm, quality, type|Configure parameter|\n|0x1E|srhdir, srhcont, srhnum, sessid|-|\n|0x28|filename|Obtain file information|\n|0x29|filefilter, settype, usbfilter, checkdirfilter|Configure parameter for monitoring|\n|0x2A|monitortype, monitorvalue|Obtain files of monitoring results|\n|0x2B|-|-|\n\n\n-----\n\n|0x30|-|Write contents such as \"c:\\windows\", \"c:\\program files\" on \"~BF24\"|\n|---|---|---|\n|0x32|freq, storetm|Configure parameter|\n|0x3E|file|Create jpeg file under %TEMP%|\n|0x65|filename, fileoffset|Obtain contents from selected files and offsets|\n|0x69|filename, delete, yes|Delete selected files|\n|0x7A|cmdtype, command:,reset, downfile, getmypath, dealmd5|Execute cmd.exe|\n|0x7B|session, command, reset, downfile, exit, getmypath|Execute remote shell|\n|0xC0|-|Write list of processes on \"28e4-20a6acec\"|\n|0xC1|-|Write list of applications on \"28e4- 20a6acec\"|\n|0xC2|-|Write keyboard information on \"28e4- 20a6acec\"|\n|0xC3|-|Write SNS-related registry contents on \"28e4-20a6acec\"|\n|0xC4|-|Write configuration of Skype, QQ, WeChat and wangwang on \"28e4-20a6acec\"|\n|0xC5|-|Write MAC address etc. on \"28e4- 20a6acec\"|\n|0xC6|-|Write network configuration on \"28e4- 20a6acec\"|\n\n\n：\nTable D List of commands\n\n\n-----\n\n*Parameter string: These strings are parsed from the received command and used as a\ncommand parameter\n\n## Appendix E List of generated directories\n\nID Path String in malware\n\n(none) %TEMP%\\\\~FEFEFE \n0x01 %TEMP%\\\\070a-cf37dcf5 \n0x02 %TEMP%\\\\d0c8-b9baa92f audio\n\n0x03 %TEMP%\\\\~B5D9 keylog\n\n0x04 %TEMP%\\\\632c-0ef22957 \n0x05 %TEMP%\\\\8e98-fb8010fb filelist\n\n0x06 %TEMP%\\\\7a4a-90e18681 \n0x07 %TEMP%\\\\d4a5-30d3fff6 \n0x08 %TEMP%\\\\d4dc-3165f4cf \n0x09 %TEMP%\\\\~CE14 monitortype\n\n0x0A %TEMP%\\\\~CE2E \n0x0B %TEMP%\\\\~B5BE skypeaudio\n\n0x0C %TEMP%\\\\~B61A skypeshoot\n\n0x0E %TEMP%\\\\5a7e-42ccdb67 \n0x0F %TEMP%\\\\~BF24 browser\n\n0x10 %TEMP%\\\\65ce-731bffbb md5filter\n\n|ID|Path|String in malware|\n|---|---|---|\n|(none)|%TEMP%\\\\~FEFEFE|-|\n|0x01|%TEMP%\\\\070a-cf37dcf5|-|\n|0x02|%TEMP%\\\\d0c8-b9baa92f|audio|\n|0x03|%TEMP%\\\\~B5D9|keylog|\n|0x04|%TEMP%\\\\632c-0ef22957|-|\n|0x05|%TEMP%\\\\8e98-fb8010fb|filelist|\n|0x06|%TEMP%\\\\7a4a-90e18681|-|\n|0x07|%TEMP%\\\\d4a5-30d3fff6|-|\n|0x08|%TEMP%\\\\d4dc-3165f4cf|-|\n|0x09|%TEMP%\\\\~CE14|monitortype|\n|0x0A|%TEMP%\\\\~CE2E|-|\n|0x0B|%TEMP%\\\\~B5BE|skypeaudio|\n|0x0C|%TEMP%\\\\~B61A|skypeshoot|\n|0x0E|%TEMP%\\\\5a7e-42ccdb67|-|\n|0x0F|%TEMP%\\\\~BF24|browser|\n\n\n-----\n\n|0x11|%TEMP%\\\\~BF34|browsercookie|\n|---|---|---|\n|0x12|%TEMP%\\\\28e4-20a6acec|systeminfo|\n|0x61|%TEMP%\\\\~FFFE|otherfile|\n|0x62|%TEMP%\\\\FFFF|otherdata|\n|0x63|%TEMP%\\\\63ae-a20cf808|-|\n\n\n：\nTable E List of directory\n\n## Appendix F SHA256 hash values of similar samples\n\nEXE\n\n1e9fc7f32bd5522dd0222932eb9f1d8bd0a2e132c7b46cfcc622ad97831e6128\nb9f526eea625eec1ddab25a0fc9bd847f37c9189750499c446471b7a52204d5a\n\nDLL\n\n0c365d9730a10f1a3680d24214682f79f88aa2a2a602d3d80ef4c1712210ab07\n2eef273af0c768b514db6159d7772054d27a6fa8bc3d862df74de75741dbfb9c\n\n[Email](mailto:?subject=Malware%20WinDealer%20used%20by%20LuoYu%20Attack%20Group&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2021%2F10%2Fwindealer.html)\n\nAuthor\n\n増渕 [維摩(Yuma Masubuchi)](https://blogs.jpcert.or.jp/en/masubuchi/)\n\nYuma has been engaged in malware analysis and coordination of cyber\nsecurity incidents in JPCERT/CC Incident Response Group since\nNovember 2020.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.10.26.WinDealer_LuoYu_Group/Malware%20WinDealer%20used%20by%20LuoYu%20Attack%20Group%20-%20JPCERT_CC%20Eyes%20_%20JPCERT%20Coordination%20Center%20official%20Blog.pdf"
    ],
    "report_names": [
        "Malware WinDealer used by LuoYu Attack Group - JPCERT_CC Eyes _ JPCERT Coordination Center official Blog"
    ],
    "threat_actors": [
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1635329224,
    "ts_modification_date": 1635329224,
    "files": {
        "pdf": "https://archive.orkl.eu/4ef2ac990d902dd57573c84d2a9e32073419be36.pdf",
        "text": "https://archive.orkl.eu/4ef2ac990d902dd57573c84d2a9e32073419be36.txt",
        "img": "https://archive.orkl.eu/4ef2ac990d902dd57573c84d2a9e32073419be36.jpg"
    }
}