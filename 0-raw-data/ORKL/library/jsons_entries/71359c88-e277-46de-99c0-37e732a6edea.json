{
    "id": "71359c88-e277-46de-99c0-37e732a6edea",
    "created_at": "2023-01-12T15:04:53.598459Z",
    "updated_at": "2025-03-27T02:17:01.62129Z",
    "deleted_at": null,
    "sha1_hash": "87fe3849ff2cb554be168d38569456a083db2d61",
    "title": "2021-08-11 - ReverseRat Reemerges With A (Night)Fury New Campaign And New Developments, Same Familiar Side-Actor",
    "authors": "",
    "file_creation_date": "2022-05-28T05:01:05Z",
    "file_modification_date": "2022-05-28T05:01:05Z",
    "file_size": 1204064,
    "plain_text": "# ReverseRat Reemerges with a (Night)Fury New Campaign and New Developments, Same Familiar Side-Actor\n\n**blog.lumen.com/reverserat-reemerges-with-a-nightfury-new-campaign-and-new-developments-same-familiar-side-**\nactor/\n\nAugust 11, 2021\n\n[Black Lotus Labs Posted On August 11, 2021](https://blog.lumen.com/author/black-lotus-labs/)\n\n[0](https://blog.lumen.com/reverserat-reemerges-with-a-nightfury-new-campaign-and-new-developments-same-familiar-side-actor/#respond)\n\n## Executive Summary\n\n[In early June 2021, Black Lotus Labs identified ReverseRat, a remote access trojan (RAT)](https://blog.lumen.com/suspected-pakistani-actor-compromises-indian-power-company-with-new-reverserat/)\noperated by a suspected Pakistan actor that was targeting government and energy sector\norganizations in South and Central Asia. After publishing our initial research, we have\ncontinued to track this actor and recently uncovered an updated version of the ReverseRat\nagent, which we are calling ReverseRat 2.0. Some of the more prominent modifications\nallowed for added functionality such as taking remote photos via webcams and retrieving\nfiles on USB devices inserted into the compromised machines. We also uncovered an\nupdated version of the preBotHta loader file, which included new evasion techniques to\n\n\n-----\n\ncounter Kaspersky or Quick Heal antivirus (AV) products, if either were detected on the host\nmachine. Lastly, we observed a new agent the actor referred to as NightFury, which was\nsideloaded with a legitimate Microsoft binary charmap.exe. Metadata from the campaign\nindicates that it began on June 28, 2021. Once the tools were deployed, we observed\nnetwork telemetry from at least one government entity in addition to other targeted\norganizations located in Afghanistan, and to a lesser extent, Jordan, India and Iran.\n\n## Introduction\n\nReverseRat 2.0 differs from its predecessor in three main ways. First, the AllaKore agent that\nwas installed in parallel is now replaced by a new agent that runs before ReverseRat 2.0.\nThe second is that ReverseRat 2.0 leverages new functionality and modified command calls\nfrom the original version, including commands relating to creating, listing and deleting\nregistry keys. Finally, ReverseRat 2.0 adds new capabilities to take photos via webcams from\ninfected machines and to steal files from USB connections.\n\nFigure 1: Multi-step infection process observed in the campaign – updated for ReverseRat\n2.0\n\n## Technical Details\n\n### Microsoft Shortcut File Retrieves preBotHta\n\nIn this campaign, the infection process began when a victim received a zip file that contained\na Microsoft shortcut file (.lnk) posing as a PDF. If invoked by the user, the shortcut file\ndownloaded an HTA file from a presumed compromised WordPress domain,\nhxxps://medizz[.]co/wp-content/base/phr/shareddocuments/Agenda/1.hta. The HTA file then\ndecoded and executed preBotHta, which displayed a benign PDF file, as depicted in Figure\n2. The PDF served as a decoy to distract the user as the shortcut file covertly executed the\nHTA file. One rather odd feature of the shortcut file was that it contained an unused PDF\ntitled “Offense Security Kali Linux User Guide” that was not displayed during execution.\n\n\n-----\n\n**First PreBotHta**\n\nOnce downloaded, the HTA deobfuscated and executed the first of two “preBotHta” loader\nfiles. The file checked for the presence of AV products that are installed on the host machine\nusing Windows Management Instrumentation (WMI):\n\nvar WaMISeerviceObjective =\n\nGetObject(“winmgmts:\\\\\\\\.\\\\root\\\\SecurityCenter2”);\n\nvar WaMIQuueryReesult = WaMISeerviceObjective.ExecQuery(“Select * From\nAntiVirusProduct”, null, 48).\n\nIt then called the start function within the .NET file and its execution flow was altered\ndepending on the AV products that were detected; in all cases, though, it loaded a decoy\nPDF document and then at least one, if not both, of the agents. The PDF titled “Agenda”\nappeared to be a briefing document with an agenda for a United Nations meeting on\norganized crime with a Microsoft Teams link. While the Teams link appears to be valid and\nuses the teams.windows.com domain, the document itself appears to have been fabricated\nas the [UN Journal lists no such meeting on that topic.](https://journal.un.org/en/meeting/officials/19001efe-15d5-eb11-9120-0050569e8b67/2021-06-30)\n\n\n-----\n\nFigure 2: Decoy United Nations briefing document\n\nOnce it was running in memory, the preBotHta file deleted itself and decompressed another\nfile with the internal name “preBotHta” that was written to disk with the hardcoded path:\n\nC:\\Windows\\Tasks\\Updater.hta.\n\n\n-----\n\nFigure 3: preBotHTA checks for the presence of AV products on the host machine\n\nThere were three possible infection paths depending on the AV detected:\n\n1. If “Kaspersky” was found in the detected AV list, preBotHta dropped both NightFury and\n\nReverseRat 2.0. Notably, while ReverseRat 2.0 was dropped when Kaspersky was\ndetected, it was not executed. We suspect this was to allow the actor to execute it in\nthe future. The preBotHTA then copied the legitimate Windows binary charmap.exe\nfrom the system directory to C:\\Windows\\Tasks\\ and decompressed the NightFury DLL\npassed to the first preBotHTA file from the HTA file, saving it as\nC:\\Windows\\Tasks\\MSFTEDIT.dll. The valid C:\\Windows\\Tasks\\charmap.exe was then\nexecuted using PowerShell, which sideloaded the malicious MSFTEDIT.dll.\n\n\n-----\n\n2. In the second path, Quick was searched for in the detected AV list. We believe this to\n\nbe related to the Quick Heal security products. Quick Heal is based in India and fits the\ntargeting that we have seen in previous campaigns. If “Quick” was found, the second\npreBotHta first launched NightFury as described above and then ReverseRat 2.0 via\nPowerShell from where it was dropped in C:\\Windows\\Tasks\\Updater.hta.\n\nFigure 4: Execution of charmap.exe in ExecuteCommandLine\n\n3. In the final path, the preBotHTA dropped both the new agent and ReverseRat 2.0. The\n\npreBotHTA also dropped, executed and finally deleted the file ‘regadd.bat’ that created\na registry key to run charmap.exe:REG ADD\n“HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run” /V “Security Updater” /t\nREG_SZ /F /D “C:\\Windows\\Tasks\\charmap.exe”. This allowed the threat actor to\nachieve persistence on the infected machine via the Run registry key. Upon reboot, the\nvalid charmap.exe was executed, which in turn sideloaded the malicious MSFTEDIT.dll.\n\nIn all three paths, the function copyRunBat was called (lines 27, 36 and 44 in Figure 3) to\ndrop the batch file C:\\Windows\\Tasks\\run.bat, which executed the dropped ReverseRat 2.0\nwith the following commands:\n\n@echo off\\r\\nstart /b mshta.exe “C:\\\\Windows\\\\Tasks\\\\Updater.hta”\\r\\nexit.\n\n\n-----\n\nWe hypothesize that during testing, the threat actor realized Kaspersky and Quick Heal\nproducts signatured and blocked certain aspects of the infection chain. Therefore, the threat\nactor added these different logic paths to avoid AV-specific detection and to ensure the ability\nto infect the targeted machines.\n\n## NightFury\n\nOne of the files that was written to disk by the preBotHta file was named MSFTEDIT.dll;\nhowever, internal debug strings suggest that this was part of a project called NightFury,\nhence the name we’re using to refer to it. One interesting note is that the same project name\n[“NightFury” was discovered in samples from a 2019 report by Seqrite called Operation](https://www.seqrite.com/documents/en/white-papers/Seqrite-WhitePaper-Operation-SideCopy.pdf)\nSideCopy. Note the typo “NigthFury” in the file paths.\n\nF:\\OpenRATs\\NigthFury\\NightFury_Final\\Current_Working_Version\\DUser\\SystemInfo.cpp\n\nThe new agent first checked for the existence of two .lnk files at the following file paths:\n\n_C:\\Users\\<username>\\AppData\\Roaming\\Microsoft\\Windows\\Start_\n_Menu\\Programs\\Startup\\Security Updater.lnk_\n\n_C:\\Users\\<username>\\AppData\\Roaming\\Microsoft\\Windows\\Start_\n_Menu\\Programs\\Startup\\Windows Updater.lnk._\n\nIf they were not present, the new agent created them. The first lnk file, “Security\nUpdated.lnk”, dropped by NightFury executed the previously mentioned run.bat file:\n\nC:\\Windows\\System32\\cmd.exe /c start /b C:\\Windows\\Tasks\\run.bat.\n\nThe second lnk file, “Windows Update.lnk”, called charmap.exe from the C:\\windows\\tasks\nfolder which initiated the execution of the NightFury agent. The agent then initiated a “recv”\ncall to the C2 located at 62.171.191[.]230:5310.\n\nThe response from the C2 dictated the subsequent action of the agent. Through debugging\nthe executable, we identified that there were 20 pre-built functions; however, not all functions\nwere utilized. In fact, eleven of them resulted in a loop and attempted to recontact the C2.\nThis suggests that NightFury is still under development and is not yet fully implemented.\n\nIf NightFury received a response of 0x0, it collected information about the infected computer\nincluding computer name, username and Windows version information, and then sent the\ncollected information to the C2.\n\n\n-----\n\nFigure 5: Initial beacon to C2\n\nNightFury then searched the computer for document files (txt, pdf, xlsx, xls, pptx, ppt, docx,\ndoc, jpg, png, accdb, mdb) and put the file names and related metadata into a new file\nlocated at the path: C:\\Users\\<username>\\AppData\\Local\\Temp\\MVC\\wordpress.in. It did the\nsame for archive files (zip and rar) and saved the output to C:\\Users\\\n<username>\\AppData\\Local\\Temp\\MVC\\rar.in. The format for the output was:\n\n**Filename | Last modified date | File creation date | File Size | Terminator(?)**\n\nExample: C:\\Users\\<username>\\Desktop\\filename.doc|2021-07-01|2021-06-29|446|00\\r\\n.\n\nIn another case (response 0x01), NightFury sent the wordpress.in file containing the\ninformation for the document files to the C2. Many of the other functions relied on soliciting a\nresponse from the C2, which did not respond at the time of investigation. However, through\ndebugging the agent, we were able to identify other commands that allowed for remote file\ntransfers enabling the agent to download and execute additional payloads. Based upon the\nfunctionally detailed above, we suspect that this is a first stage agent, and that the threat\nactor has subsequent payloads at its disposal that allow for more functionality on targeted\nmachines.\n\n## The ReverseRat 2.0\n\nReverseRat 2.0 leverages new and modified command calls from the original version. Where\nits predecessor called functions by numbers, ReverseRat 2.0 calls functions by command\nprompts such as, “list,” “run,” and so on. As before, when the agent was first executed it\ncollected information about the host machine. However, one new function is that it attempted\nto take a picture of the host environment with the web camera, which was a feature not\nobserved in the previous iteration. There was one other small change: it obtained the IP\naddress information by querying the network interface rather than making a request to an\nexternal third-party site.\n\nData gathered about the host environment included:\n\nMAC address\nPhysical memory on the device converted to MBs\nInformation about the processor\n\nMax clock speed in GHz\nData width converted to bits\nName (e.g. Intel Core i7-8569U CPU @ 2.80GHz)® ™\nManufacturer (e.g. GenuineIntel)\n\nIt also used the .NET framework to obtain the following:\n\nComputer name\n\n\n-----\n\nOperating system\nIP address\nPicture via the web camera\n\nThe updated agent called functions to create, list and delete registry keys, in addition to\npulling a list of installed programs on the machine by querying the following path:\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall.\n\nFigure 6: ReverseRat 2.0 list of commands\n\nLike the previous iteration of the agent, this version encrypted its communications with the\nC2, http://drigablockszip.sytes[.]net/, and used RC4 with the hardcoded key of\nexpress@dailyNews33. Finally, in addition to the functions listed in the core class of the\nbinary, there was a class called ‘Changeforfun’ that housed functions related to handling\nUSB devices connected to the infected machine which granted the actor the ability to steal\ndocuments stored on a USB drive inserted into an infected computer. Specifically, it looked\nfor and uploaded files that had the following extensions:\n\n.xlsx\n.doc\n.docx\n.ppt\n.pptx\n\n\n-----\n\n.txt\n.pdf\n.mdb\n.accdb\n\nIf found, these files were sent back to the aforementioned C2 server.\n\nFigure 7: ReverseRat 2.0 ‘Changeforfun’ functions\n\n## Black Lotus Labs Telemetry\n\n### Telemetry – Victim\n\nOnce we curated a list of indicators associated with this threat actor, we ran those and other\nindictors through our internal databases. Black Lotus Labs’ global visibility suggests that the\ncampaigns associated with this threat actor were quite targeted. A small number of entities\nexhibited bi-directional communications with the identified nodes.\n\nFor this campaign, most of the organizations that exhibited signs of compromise were in\nAfghanistan, with a handful of targets in Jordan, India and Iran. We were able to identify one\nentity that was associated with a government organization. We do not believe that this list\nentails the totality of their operations, as some potential victims were associated with\ndynamic IP addresses, making it difficult to correlate those IP addresses to a single\norganization.\n\n## Conclusion\n\n\n-----\n\nAs we have noted in our prior blog, this threat actor has continued to deploy agents to\nexpand functionality and implement new features to further evade detection. The most\nprominent example of evasion comes from the expansion of the logic paths in the preBotHta,\nwhich altered the flow and execution based upon AV products detected on the host\nmachines. The actor continues to diversify its tool set and began implementing different\ntechniques such as using different Microsoft binaries to sideload their agents. This allows the\nactor to wean off some open-source tools such as AllaKore. We continue to believe that this\nactor poses a threat to government and energy organizations in the South and Central Asia\nregions.\n\nIn order to combat this particular campaign, Black Lotus Labs null-routed the threat actor\ninfrastructure across the Lumen global IP network and notified the affected organizations.\nBlack Lotus Labs continues to follow this threat group to detect and disrupt similar\ncompromises, and we encourage other organizations to alert on this and similar campaigns\nin their environments.\n\nFor additional IOCs such as file hashes associated with this campaign and this threat actor’s\nlarger activity cluster, [please visit our GitHub page.](https://github.com/blacklotuslabs/IOCs/blob/main/ReverseRat2.0_NightFury_IoCs.txt)\n\n**If you would like to collaborate on similar research, please contact us on**\n**Twitter** **[@BlackLotusLabs.](https://twitter.com/BlackLotusLabs)**\n\nThis information is provided “as is” without any warranty or condition of any kind, either\nexpress or implied. Use of this information is at the end user’s own risk.\n\nServices not available everywhere. ©2022 Lumen Technologies. All Rights Reserved.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-11 - ReverseRat Reemerges With A (Night)Fury New Campaign And New Developments, Same Familiar Side-Actor.pdf"
    ],
    "report_names": [
        "2021-08-11 - ReverseRat Reemerges With A (Night)Fury New Campaign And New Developments, Same Familiar Side-Actor.pdf"
    ],
    "threat_actors": [
        {
            "id": "b584b10a-7d54-4d05-9e21-b223563df7b8",
            "created_at": "2022-10-25T16:07:24.181589Z",
            "updated_at": "2025-03-27T02:02:10.134233Z",
            "deleted_at": null,
            "main_name": "SideCopy",
            "aliases": [],
            "source_name": "ETDA:SideCopy",
            "tools": [
                "ActionRAT",
                "AllaKore",
                "Allakore RAT",
                "AresRAT",
                "Bladabindi",
                "CetaRAT",
                "DetaRAT",
                "EpicenterRAT",
                "Jorik",
                "Lilith",
                "Lilith RAT",
                "MargulasRAT",
                "ReverseRAT",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "187a0668-a968-4cf0-8bfd-4bc97c02f6dc",
            "created_at": "2022-10-27T08:27:12.955905Z",
            "updated_at": "2025-03-27T02:00:55.41311Z",
            "deleted_at": null,
            "main_name": "SideCopy",
            "aliases": [
                "SideCopy"
            ],
            "source_name": "MITRE:SideCopy",
            "tools": [
                "AuTo Stealer",
                "Action RAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a4f0e383-f447-4cd6-80e3-ffc073ed4e00",
            "created_at": "2023-01-06T13:46:39.30167Z",
            "updated_at": "2025-03-27T02:00:03.045082Z",
            "deleted_at": null,
            "main_name": "SideCopy",
            "aliases": [],
            "source_name": "MISPGALAXY:SideCopy",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535893,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1653714065,
    "ts_modification_date": 1653714065,
    "files": {
        "pdf": "https://archive.orkl.eu/87fe3849ff2cb554be168d38569456a083db2d61.pdf",
        "text": "https://archive.orkl.eu/87fe3849ff2cb554be168d38569456a083db2d61.txt",
        "img": "https://archive.orkl.eu/87fe3849ff2cb554be168d38569456a083db2d61.jpg"
    }
}