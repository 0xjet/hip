{
    "id": "10e4bc56-ba84-419c-9403-6ef303499bf8",
    "created_at": "2023-01-12T15:00:40.430353Z",
    "updated_at": "2025-03-27T02:05:28.013887Z",
    "deleted_at": null,
    "sha1_hash": "d451d8c7aaf3b0ebcabe742569f64b7881195c0f",
    "title": "2018-11-28 - AutoCAD Malware - Computer Aided Theft",
    "authors": "",
    "file_creation_date": "2022-05-28T16:55:36Z",
    "file_modification_date": "2022-05-28T16:55:36Z",
    "file_size": 2072541,
    "plain_text": "# AutoCAD Malware - Computer Aided Theft\n\n**[forcepoint.com/blog/security-labs/autocad-malware-computer-aided-theft](https://www.forcepoint.com/blog/security-labs/autocad-malware-computer-aided-theft)**\n\nNovember 28, 2018\n\nComputer aided design (CAD) has played a vital role in the past decades building our\ntechnology-driven society, helping structures and engineering reach new levels of complexity\n– designing a building such as the Burj Khalifa by hand would be difficult if not impossible.\n\nOf course, where valuable documents are stored electronically, malware is typically never far\nbehind and, unsurprisingly, [malware targeting CAD files is not a new invention. On the other](https://www.welivesecurity.com/media_files/white-papers/ESET_ACAD_Medre_A_whitepaper.pdf)\nhand, the value inherent in these files makes any such campaign worth inspecting, as was\nthe case recently when we observed one using apparently already-stolen design documents\nfor major projects such as hotels, factory buildings, and even the Hong Kong-Zhuhai-Macau\n[bridge (which opened last month) as ‘lures’ to propagate further. The intention here is likely](https://www.theguardian.com/world/2018/oct/22/longest-sea-bridge-to-open-china-hong-kong-zhuhai-macau-permit)\nto acquire even more blueprints, either for direct use (i.e. espionage) or for sale on the black\nmarket.\n\n\n-----\n\n### 2018 Radicati Group Market Quadrant Reports Kit\n\n[Read the Report](https://www.forcepoint.com/resources/industry-analyst-reports/2018-radicati-group-market-quadrant-reports-kit)\n\n## AutoCAD\n\nAutoCAD – arguably one of the best known and most widely used CAD application –\nnaturally found itself in the malware spotlight fairly early in the history of cyber-attacks. This\nwas helped by a number of software features intended to enhance usability by providing\nways to automatically execute custom LISP-based scripts when launching AutoCAD or\nopening a project. This feature could be considered analogous to Office macros: legitimate\ntools that unfortunately also lend themselves to malicious use.\n\n\n-----\n\nAutoLISP is an AutoCAD-specific dialect of the LISP programming language – itself fairly\nunusual these days. AutoLISP files can take different form: either they keep the original textbased format (which pretty much look like any other human-readable script) or they can be\ncompiled into a Fast-Load AutoLISP (FAS) binary module.\n\nTo help protect proprietary custom scripts, AutoCAD even provides basic encryption for the\ncompiled FAS modules. The resulting file output doesn’t resemble anything meaningful if\nopened in a text editor.\n\nFigure 1 - Example of a Fast-Load AutoLISP module\n\n## How it works\n\n### Auto loading LISP modules\n\nMost historical malware for AutoCAD has exploited a basic auto-load feature of the software\nwhich enables users to create their own AutoLISP based scripts and execute them either on\napplication start or upon the loading of project files.\n\nThere is a limited – and to some extent customizable – number of locations where AutoCAD\nlooks for scripts or modules to be loaded but, of course, malicious content doesn’t just\nmagically manifest in these locations. One could manually place auto-load modules into the\nappropriate folders, however that would either involve preliminary presence on the target\ncomputer or a bit of [social engineering.](https://www.forcepoint.com/cyber-edu/social-engineering)\n\nThe easier and more obvious solution is to include the modules next to project files and let\nthe user do the work by loading them and automatically executing the script along with it.\nThe social engineering part – i.e. tricking the user into opening the project – uses a set of\n‘lure’ drawings (in this case, apparently real drawings from already-infected victims) which\nmay be selected to reflect the interests of the targeted company. For example, companies\ninterested in the construction business can be easily targeted with project names pretending\n\n\n-----\n\nto be concrete bases, metal alloy structures, or any element of a complex building design or\nongoing tender. These lures are often part of completely legitimate projects which have been\npreviously acquired and become ‘weaponized’.\n\nEither way, opening the drawing will typically display legitimate (or at least legitimate-looking)\ncontent, but also execute the malicious scripts.\n\nFigure 2 - Example of a project render from a lure package\n\n### What's in the box?\n\nWe have tracked and analysed a large number (over 300 ‘packages’ containing\napproximately 100 unique malicious modules) of acad.fas versions in the past few months,\nfrom what looks like an extended campaign based around a small downloader component.\n\nIn this case archives contain one or more acad.fas modules placed next to the lure drawings.\nThe file attributes of the FAS modules are often set to ‘hidden’ to prevent them being\ndisplayed in Windows Explorer once the archives have been extracted. The size of the\n_acad.fas files recorded varies between 2 and 20 kilobytes but, more importantly, once it has_\nbeen decrypted and decompiled the underlying script is almost always identical. In terms of\nfunctionality, the script is a simple downloader utilizing basic obfuscation techniques.\n\n\n-----\n\nFigure 3 - A reconstructed AutoLISP file after decryption and decompilation\nThe locations from which AutoCAD will attempt to load a FAS file vary with version and\nconfiguration, but once run the file will further copy itself into the following three locations:\n\nThe current user’s Documents folder (i.e. C:\\Users\\John Doe\\Documents\\acad.fas)\nAutoCAD’s main Support folder (i.e. C:\\John Doe\\Application Data\\Autodesk\\AutoCAD\n2019\\R23.0\\enu\\Support\\acad.fas)\nAutoCAD’s main Program Files folder (i.e. C:\\Program Files\\Autodesk\\AutoCAD\n2019\\acaddoc.fas)\n\nThe malicious FAS also sets a system variable (ACADLSPASDOC) which, combined with the\nreplications above, results in the module being loaded not only when AutoCAD starts but\nalso when any project is opened from then on: upon opening a project, it will further copy\nitself into the directory containing that project and – in all but the most recent variant – set the\nread-only and hidden file attributes for the new copy of acad.fas as noted earlier.\n\nNote that while all these replications let it spread in various project packages from one\ncomputer to another, by default, automatic execution of acad.fas is still restricted to certain\nlocations highlighted above. As such, there is likely still the need for some social\nengineering: one would still need to unpack drawings along with the malicious module into\nthe root of the user’s Documents folder. Even then, security features introduced as of\nAutoCAD 2014 will still present a popup warning.\n\n[Once replication is completed it will retrieve the value of AutoCAD’s ‘CDATE’ system variable](https://knowledge.autodesk.com/support/autocad/learn-explore/caas/CloudHelp/cloudhelp/2015/ENU/AutoCAD-Core/files/GUID-764D9293-3F87-4E63-802E-8B45F1B76F92-htm.html)\n(the current date and time). Using that, it will carry out some basic calculations and store the\nresult in environmental variables called ‘dlr’ and ‘dqs’. These variables reside in the registry\n\n\n-----\n\n(i.e. HKCU\\Software\\Autodesk\\AutoCAD\\R23.0\\ACAD-A001:409\\FixedProfile\\General ) and\nare used to limit the frequency of C2 connection attempts to approximately once every 24\nhours.\n\nWhen connecting to the C2, it will concatenate the values of the ‘dqs’ and ‘dlr’ variables, the\nsystem locale, and the version number of the actual AutoCAD build. At this stage a number\nof additional calculations are performed to provide basic obfuscation (e.g. the value of the\nsystem locale is multiplied by 8) with only the version string being used in its original form.\nThe following is an example of a complete query. Note that the upper-case letter ‘O’ is used\nas delimiter:\n```\nhxxp://sl.szmr.org/cj/?\n9c5d97bba87f468b9237c9b160c36a43142898157O102156291O8264O23.0s%20(LMS%20Tech)\n\n```\nIn the above example the system locale is set to 1033 (8264/8=1033) – this is the default\nEnglish language locale – and the version string is '23.0s (LMS Tech)' which corresponds to\nthe latest AutoCAD 2019 build.\n\nIf the connection is successful there is either a dummy byte provided as response or another\nFAS module called ‘slb.fas’ or 'tf.fas' in the versions analysed, which would then be silently\nrun and subsequently deleted. Unfortunately, during our research, we were unable to retrieve\nthe follow-on FAS module from the C2. It is unclear whether this was a result of additional\nserver-side checks in place to facilitate the targeting of specific victims or if it is merely an\nartefact of the campaign currently being ‘inactive’.\n\nOverall, we identified at least three clearly distinguishable versions of the downloader. There\nare some minor differences in the specifics of each version, e.g. earlier variants do not send\nany profiling data upon connecting. Furthermore, the registry based environmental variables\ndiffer between versions (‘dqs’, ‘dlr’, ‘dlbsf’) as does the level of obfuscation, the C2 address,\nthe method for retrieving the second stage FAS module, and – as previously noted – the\nname of the second stage module ('slb.fas', 'tf.fas'). However, the core functionality remains\nidentical.\n\n### Special Delivery\n\nOwing to the size of complex design documents and plans (hundreds of megabytes in some\ncases), delivering the package in the form of a ZIP or RAR archive as an email attachment is\nnot always feasible. Instead a more common practice is to host those large archives on a\nprivate or public file sharing service and only provide a link to the project.\n\nInterestingly, especially in this day and age, it is also not uncommon to choose a more\nintimate way of delivery: a postal package with content provided either on CD/DVD or USB\nstorage. This may seem unusual to many, but given the size of AutoCAD files and the\n\n\n-----\n\nsensitive nature of the data they contain it s not inconceivable that companies may prefer not\nto entrust their legitimate files to the internet, preferring instead traditional postal and courier\nservices.\n\nWhile the initial infection vector for ‘patient zero’ in any given case remains unclear, the\nmalware’s ability to infect the directory of any project opened on a machine almost certainly\ncontributes to its spread: employees sharing project files within companies – or indeed\nbetween two companies collaborating on the same project – could easily and unwittingly\ninfect their colleagues.\n\nFigure 4 - Example of a plan from a lure package\n\n## Server anomalies\n\nAll of the C2 subdomains identified with the campaign resolve to the same IP address, which\nappears to be running a Chinese-language installation of Microsoft Internet Information\nServer 6.0.\n\nCross-checking the address with similar AutoCAD campaigns from the past showed that the\nsame C2 IP has been in use for several years and further revealed a second IP address\n‘next to’ the current C2 IP with the same IIS configuration.\n\nThe use of ‘near neighbour’ IP addresses like this is not unusual and is likely indicative of the\nsame actors being behind all of these campaigns.\n\nThe table below shows details of the C2 servers seen to-date.\n\n\n-----\n\n**C2** **IP** **AS** **AS Name**\n\nsl.szmr.org 98.126.72.139 35908 VPLSNET - Krypt Technologies, US\n\nsq.szmr.org 98.126.72.139 35908 VPLSNET - Krypt Technologies, US\n\nsqer.szmr.org 98.126.72.139 35908 VPLSNET - Krypt Technologies, US\n\ny.szmr.org 98.126.72.139 35908 VPLSNET - Krypt Technologies, US\n\nzxb.isdun.com 98.126.72.139 35908 VPLSNET - Krypt Technologies, US\n\ncadgs.com 98.126.72.138 35908 VPLSNET - Krypt Technologies, US\n\n## Possible targets\n\nOur telemetry shows the infection extant at least as long ago as late 2014 and, further, that\nnew victims appear to have been infected as recently as mid-2018 with the majority of\ninfected machines appearing in China, India, Turkey, and the UAE.\n\nFigure 5 - Heatmap of affected countries based on GEOIP data for unique victim IP\n\n\n-----\n\naddresses\nPivoting on the C2 domains suggests that the actors have successfully targeted multiple\ncompanies across multiple regions with at least one campaign likely having been focused on\nthe energy sector – several companies either within or with links to the renewable energy\nindustry appear to have fallen victim to the malware – and another predominantly affecting\nthe automotive industry.\n\nIt should, however, be noted that the ease with which the malware spreads makes discerning\nspecific targets an imprecise art: also mixed in amongst the victims are everything ranging\nfrom construction companies to national road-maintenance authorities.\n\n## Protecting against unintended module execution\n\nAs with most vendors, Autodesk have been paying increasing attention to security\n[considerations and have implemented a number of safety checks to prevent malicious (or](https://knowledge.autodesk.com/support/autocad/learn-explore/caas/CloudHelp/cloudhelp/2018/ENU/AutoCAD-Core/files/GUID-9C7E997D-28F8-4605-8583-09606610F26D-htm.html)\nindeed any) scripts from being executed unintended.\n\nStarting with AutoCAD 2014 there are security variables (TRUSTEDPATHS, SECURELOAD,\netc.) in place that [control what executable files (modules) can be loaded automatically, from](https://knowledge.autodesk.com/support/autocad/learn-explore/caas/CloudHelp/cloudhelp/2018/ENU/AutoCAD-Core/files/GUID-C108E81C-7A06-477C-A5F8-10AA2FDEB050-htm.html)\nwhat location, and whether to display a pop-up warning, similar to Microsoft Word's macro\nsettings.\n\n[These can be easily controlled from within the application by the SECURITYOPTIONS](https://knowledge.autodesk.com/support/autocad/learn-explore/caas/CloudHelp/cloudhelp/2018/ENU/AutoCAD-Core/files/GUID-2199A941-E183-4CAC-914C-E4538468DE64-htm.html)\ncommand, by installing the external CAD Manager Control Utility, or by editing the\ncorresponding registry entries manually (i.e.\nHKCU\\Software\\Autodesk\\AutoCAD\\R23.0\\ACAD-2001:409\\Profiles\\<<Unnamed\nProfile>>\\Variables). If these are properly set and locked the risk of unwanted module\nexecution is greatly mitigated.\n\nNote that LT editions of AutoCAD do not support the external use of AutoLISP, and as such\nare not prone to this type of attack.\n\n## Conclusion\n\nCAD changed our modern life and as an unfortunate side effect, industrial espionage also\nchanged along with it. Design schemes, project plans and similar vital documents are being\nstored and shared between parties in a digital manner. The value of these documents –\nespecially in new and prospering industries such as renewable energy – have probably\nnever been this high. All this makes it attractive for the more skilled cybercriminal groups to\nchip in, instead of spamming out millions of emails and waiting for people to fall for it,\nsignificantly more money can be realised by selling blueprints to the highest bidder.\n\n\n-----\n\nWith all that in mind, by paying attention and carrying out some additional steps most\nAutoCAD based attacks can be mitigated. Disabling auto-load functionality from untrusted\nsources, making sure there is always a pop-up warning present before any module is\nexecuted, and enabling visibility for hidden files is easily achievable.\n\nAs most of these can be controlled via registry entries, we highly recommend IT\nadministrators to enforce them by group policies.\n\n## Protection statement\n\nForcepoint customers are protected against this threat at the following stages of attack:\n\n**Stage 4 (Exploitation) – Malicious files are identified and blocked**\n**Stage** **6 (Call Home) – Traffic to C2 nodes is identified and blocked**\n\n## Indicators of compromise\n\n### C2\n```\nsq.szmr.org\nsqer.szmr.org\nsl.szmr.org\ny.szmr.org\n\n SHA1 Hashes\n\n```\n\n-----\n\n```\n045bc8dc1d783b87bf33a6c95a7583fe24dd5944\n04a873ac179fb76049994a8db7cfed5a91387d80\n063c64dee624fb841802feace8a269250768bf82\n0682a65a64f11b3d0d7ea73d7db084fb2dcd8207\n0b25bb21b15ad7833c446e3d07f19e0cec815b61\n0f7b268ef3ea4f0161f12dcb7a070d32831774de\n12f0c858b96ec8e12a44ccf5397274282f4cd897\n15942294c1af46d3b29a30f44cda7f0ddbc9a7df\n15cd48d5b78ff3e884d5195caa5723c49908c965\n19cdc72912fd7a9249446d6328da34b8021b3378\n1ba453fd5c41f0fffd540a118867327febf3c055\n2042a8bfa7ecc0347566cd3c3feee8cba1a9a57d\n21f86116a83bef19422e80f4768717ac0b780f9e\n230c961d86a34d345496950cacc48b01de6d18ff\n24c14affc1d62c4a7d3765d1ba7e0b65db043ebf\n2738ac3107ae95d0ff959ab878cd2cd0b945ed6b\n289daec3781643ec9344bff1cf42d845aac55f8c\n2b748e5707ac66efe17eacbc0acaadb6343825e4\n2d2bcf97a150753ffd14847e2912a4e5ac93ea59\n2d8b207f5a6dac76928e06f248bf5c60ea7e043e\n2d9d2bc620d759707e55a02fde1caaaa13dcf7a5\n317cbbcb489f9e999514228064c3111e314be1ff\n3593f25936546a985aca124447caf7f77e0e15be\n3620a7bcf8a8761c80c5259e5aaf2815657b6285\n3832d479aedba957e33fe1245d50b04d5f11a8e0\n3c590e06df9bca553d831800898d85fe7e23498c\n3cd508d43eb062d5a4f6b9dc85bcafabd1abef00\n3f087707183ddbc08b0c3b0915441c53cab9a574\n4637ada61e595307807a6c83e7d4e2e0dad6da47\n48637f42ff0c41e91f88ef1a821ca9ce75b1e211\n49d6cd730ad1d9524577ed9db34680a6923935dc\n4c28af969bfc747a0684a04518be7da18c8f6823\n4e676cafbad01684ca7d0823ace4db9c7830bba3\n4fd3417d429ac4d16fd18f3a211bf08e637ea69b\n5175574779c064ed275d9321471ae196fd4443b1\n52f13e7e50871951213941d6d576f98a4e58982f\n56921b1e12bf1ac13332840645762940671d6412\n56a161ba0903c03d28f4dfadb8bab3e7e091681f\n5784c1ceffd9c74bb957aab76707912393ee4b4b\n580d0e583d89704138bdad5c51d1532a64ddfb1d\n588da678bffb85a8f39a898b36a3559105a3f990\n5990566e2b75c61ea1ea08eb1f4a1b85e4fd160b\n5c4598d0dcba47288a1a4182acb75640fc76037c\n5f89f9c151b493b27dc238d1b69c56a4d5d97a57\n603bd7647b7516f8c3872616ed5ead537ae4a678\n60a6688db793bd72f8351e13d0c180da48ce810a\n65135fb90f1578a048e973263fe200a0141ee40e\n6725b8d44bbdca239f41b6e29c5a7dd3b2adf7ef\n685d8f7d3d7a25a07b75a3f6fc1a20161b7449ac\n6a349988f530767031255224de12afc58c502854\n6bc63c3807cda549295419bbaa4eb83536099b0b\n6bda07f307316eb130fe156a779ac04dbdf86feb\n6d302c799eb482c28555c44e93c2d9f0315f1746\n6e37698cad532078807b1b02fc5dd0a8354a6233\n6e37cdeb1dc7f0166c8ecd95d62e6ee21c7937e8\n\n```\n\n-----\n\n```\n7170af33988f912cbe059858f54fa1d671a99284\n756c30f5d3a37896170462d02685c46edef30105\n7a0fdcc538daf5e3676959521a52326319f5ccc9\n7cb4ad3e4a272c16c16d3ca88bfe486b2018eea1\n7de0be9bad46a387122f407b5be76a66fecdf037\n81ed10856814b0fecc3a1d3a1ac0be7bb6b732b3\n8455cd93775eac739d2b1180cb0fd300094d48c5\n89a5539f35259e5f0d9678577aaf019b3ca7d8a2\n8c7186b2f94fe80efd8074d5db73398d3a3edece\n8d240bd4d436e19d2f02c4a128598430208ad737\n8f4e0233466b73609bc52fb961686cc72bee31f0\n99b711c931f7180a99095a817d435ef119e384f7\n9a5ae73ed770e84f44ae20408217858c43f192cb\n9ad69550c298543a0938d093ed7ed321d9c87ae7\n9b84d77754da6eb7b2bfda4fd1bfb5949cd4c317\n9c9aaa80c6f998f2467d6a919c5768c5965c9cf5\n9fbae8f3cda196e2c404d0ef9105d592bc894300\na14e1b9315c88508350b6bf582f27d51585f503d\na35bdb566dead82c5ed9dc6a141c7bb5ea87a116\na59c5ba8493cff74979c8962b5c36426f1475e33\na5bddc3a4057bfdc2b759bc4fd694cde3fe102b1\naa089077232f0a4c27824f25d5b4e18f72bd5aab\nab4bee09d4656cebd33e33e59be4945e3cda79b5\nb1bf66767040fe51f8362aaa58f2046be1034f21\nb318d8f4bc0cf4ef3fc8647c250a6ba99b027aac\nb46a47a51deb77f516d1de8b58c2470b3e3e2288\nb9118f3c3c28c48fb3594c24104109435decd8cd\nb91488262e057b236359a7591ed4b8094c8f9b42\nb9946724a652e9f5c0d822f833e2437196d1d713\nbfe5beec7b2525a27e77c1de3506a0e288b6dc1c\nc3fd9e6aaf1fdfea2afcd5f4aba7640555476206\nc56150bd4a64fd1977ef410ddea59ea71b604180\nc61ba2d2c73cce2e3a032c4bce334fd6426023e8\nc65cde9ffda885c895e7ca9d49f9e2ad81c13e5c\nc9b6ed45785cb4c890a399bd0b4ae8046cf314e5\ncb8b7dd80fa36115684a385bc61da4084d9cd64a\nccdf899b1c55279cb25c07f31ffd42e72483f428\ncd33209e633e52345564434b1515e8fdaf07aceb\ncd92b8925843d9e4144d8e70b2f6340442facd9c\ncf22a63d3443ee51f54423956ad79a251aa96cb8\nd01410bada0c24a8734d4c725220f8079a14c273\nd33cfbe50b4c0bf07eabf1dc8e5736f4507dff27\nd6c42b896b9b9afc598c03af77e9555fdbb77240\ndc2a70baaa3067f4f1293fd587f025a572b2a1ec\ne3bc169bc6c58d8320d52f405692c7234935cddd\ne7791fc2e2b5b2d4bf5b26f25cddccefe1877536\ne9aabf1cc51b59be85c5401831caa3c6bbbdc39d\nef9c13e62be77673c1ec5f68902a3d2260217846\nf1d599931953c71de8e1941dfb9917effc607c31\nf44f7b7c198f623890825bb89fb64b3220ab4392\nf5539cf0206fdf4216e5dfed45b63c5ac48720d4\nfb5af920004a4944d6cea373ba17e24b283aa77b\nfcc225598e0f2eff946ec0a3a435e9cf98090a6e\nfcda8380e6bdf8f3c722c6b7d9a076d625c43df9\n\n```\n\n-----\n\n### About Forcepoint\n\nForcepoint is the leading user and data protection cybersecurity company, entrusted to\nsafeguard organizations while driving digital transformation and growth. Our solutions adapt\nin real-time to how people interact with data, providing secure access while enabling\nemployees to create value.\n\n[Learn more about Forcepoint](https://www.forcepoint.com/company/about-us)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-28 - AutoCAD Malware - Computer Aided Theft.pdf"
    ],
    "report_names": [
        "2018-11-28 - AutoCAD Malware - Computer Aided Theft.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535640,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1653756936,
    "ts_modification_date": 1653756936,
    "files": {
        "pdf": "https://archive.orkl.eu/d451d8c7aaf3b0ebcabe742569f64b7881195c0f.pdf",
        "text": "https://archive.orkl.eu/d451d8c7aaf3b0ebcabe742569f64b7881195c0f.txt",
        "img": "https://archive.orkl.eu/d451d8c7aaf3b0ebcabe742569f64b7881195c0f.jpg"
    }
}