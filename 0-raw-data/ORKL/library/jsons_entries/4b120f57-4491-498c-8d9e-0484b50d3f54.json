{
    "id": "4b120f57-4491-498c-8d9e-0484b50d3f54",
    "created_at": "2022-10-25T16:48:14.20166Z",
    "updated_at": "2025-03-27T02:17:16.667218Z",
    "deleted_at": null,
    "sha1_hash": "b68432d09718bec3dcd78a55d09dc826f249f425",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-09-25T10:05:29Z",
    "file_modification_date": "2020-09-25T10:05:29Z",
    "file_size": 2374210,
    "plain_text": "# Microsoft Security—detecting empires in the cloud\n\n**[microsoft.com/security/blog/2020/09/24/gadolinium-detecting-empires-cloud](https://www.microsoft.com/security/blog/2020/09/24/gadolinium-detecting-empires-cloud/)**\n\nSeptember 24, 2020\n\nMicrosoft consistently tracks the most advanced threat actors and evolving attack\ntechniques. We use these findings to harden our products and platform and share them\nwith the security community to help defenders everywhere better protect the planet.\n\nRecently, the Microsoft Threat Intelligence Center (MSTIC) observed the evolution of\nattacker techniques by an actor we call GADOLINIUM using cloud services and open\nsource tools to enhance weaponization of their malware payload, attempt to gain\ncommand and control all the way to the server, and to obfuscate detection. These attacks\nwere delivered via spear-phishing emails with malicious attachments and detected and\nblocked by Microsoft Defender, formerly Microsoft Threat Protection (MTP), and able to\nbe detected using Azure Sentinel.\n\nAs these attacks were detected, Microsoft took proactive steps to prevent attackers from\nusing our cloud infrastructure to execute their attacks and suspended 18 Azure Active\nDirectory applications that we determined to be part of their malicious command &\ncontrol infrastructure. This action helped transparently protect our customers without\nrequiring additional work on their end.\n\nGADOLINIUM is a nation-state activity group that has been compromising targets for\nnearly a decade with a worldwide focus on the maritime and health industries. As with\nmost threat groups, GADOLINIUM tracks the tools and techniques of security\npractitioners looking for new techniques they can use or modify to create new exploit\nmethods.\n\n\n-----\n\nRecently, MSTIC has observed newly expanded targeting outside of those sectors to\ninclude the Asia Pacific region and other targets in higher education and regional\ngovernment organizations. As GADOLINIUM has evolved, MSTIC has continued to\nmonitor its activity and work alongside our product security teams to implement\ncustomer protections against these attacks.\n\nHistorically, GADOLINIUM used custom-crafted malware families that analysts can\nidentify and defend against. In response, over the last year GADOLINIUM has begun to\nmodify portions of its toolchain to use open-source toolkits to obfuscate their activity and\nmake it more difficult for analysts to track. Because cloud services frequently offer a free\ntrial or one-time payment (PayGo) account offerings, malicious actors have found ways to\ntake advantage of these legitimate business offerings. By establishing free or PayGo\naccounts, they can use cloud-based technology to create a malicious infrastructure that\ncan be established quickly then taken down before detection or given up at little cost.\n\nThe following GADOLINIUM technique profile is designed to give security practitioners\nwho may be targeted by this specific actor’s activity insight and information that will help\nthem better protect from these attacks.\n\n## 2016: Experimenting in the cloud\n\nGADOLINIUM has been experimenting with using cloud services to deliver their attacks\nto increase both operation speed and scale for years. The image in Figure 1 is from a\nGADOLINIUM controlled Microsoft TechNet profile established in 2016. This early use of\na TechNet profiles’ contact widget involved embedding a very small text link that\ncontained an encoded command for malware to read.\n\n_Figure 1: GADOLINIUM controlled TechNet profile with embedded malware link._\n\n\n-----\n\n## 2018: Developing attacks in the cloud\n\nIn 2018 GADOLINIUM returned to using Cloud services, but this time it chose to use\nGitHub to host commands. The image in Figure 2 shows GitHub Commit history on a\nforked repository GADOLINIUM controlled. In this repository, the actors updated\nmarkdown text to issue new commands to victim computers. MSTIC has worked with our\ncolleagues at GitHub to take down the actor accounts and disrupt GADOLINIUM\noperations on the GitHub platform.\n\n_Figure 2: GitHub repository controlled by GADOLINIUM._\n\n## 2019-2020: Hiding in plain sight using open source\n\n**GADOLINIUM’s evolving techniques**\nTwo of the most recent attack chains in 2019 and 2020 were delivered from\nGADOLINIUM using similar tactics and techniques. Below is a summary view of how\nthese attacks techniques have evolved followed by a detailed analysis of each step that\nsecurity practitioners can use to better understand the threat and what defenses to\nimplement to counter the attacks.\n\n\n-----\n\n**Weaponization**\nIn the last year, Microsoft has observed GADOLINIUM migrate portions of its toolchain\ntechniques based on open source kits. GADOLINIUM is not alone in this move. MSTIC\nhas noticed a slow trend of several nation-state activity groups migrating to open source\ntools in recent years. MSTIC assesses this move is an attempt to make discovery and\nattribution more difficult. The other added benefit to using open-source types of kits is\nthat the development and new feature creation is done and created by someone else at no\ncost. However, using open source tools isn’t always a silver bullet for obfuscation and\nblending into the noise.\n\n**Delivery & Exploitation (2019)**\nIn 2019, we discovered GADOLINIUM delivering malicious Access database files to\ntargets. The initial malicious file was an Access 2013 database (.accde format). This\ndropped a fake Word document that was opened along with an Excel spreadsheet and a\nfile called mm.accdb.core which was subsequently executed. The file mm.accdb.core is a\n[VBA dropper, based on the CactusTorch VBA module, which loads a .NET DLL payload,](https://github.com/mdsecactivebreach/CACTUSTORCH/blob/master/CACTUSTORCH.vba)\nsets configuration information, and then runs the payload. Defender for Office 365\ndetects and blocks malicious Microsoft Access database attachments in email. A redacted\nexample of the configuration is displayed below.\n\n\n-----\n\n_Figure 3: VBA setting config and calling the “Run” function of the payload_\n\n**Command and Control (2019)**\nHaving gained access to a victim machine the payload then uses attachments to Outlook\nTasks as a mechanism for command and control (C2). It uses a GADOLINIUM-controlled\nOAuth access token with login.microsoftonline.com and uses it to call the Outlook Task\nAPI to check for tasks. The attacker uses attachments to Outlook tasks as a means of\nsending commands or .NET payloads to execute; at the victim end, the malware adds the\noutput from executing these commands as a further attachment to the Outlook task.\n\nInterestingly, the malware had code compiled in a manner that doesn’t seem to be used in\nthe attacks we saw. In addition to the Outlook Tasks API method described above, the\nextra code contains two other ways of using Office365 as C2, via either the Outlook\nContacts API (get and add contacts) or the OneDrive API (list directory, get and add a\nfile).\n\n**Actions on Objective (2019)**\nGADOLINIUM used several different payloads to achieve its exploitation or intrusion\nobjectives including a range of PowerShell scripts to execute file commands\n(read/write/list etc.) to enable C2 or perform SMB commands (upload/download/delete\netc.) to potentially exfiltrate data.\n\nLazyCat, one of the tools used by GADOLINIUM, includes privilege escalation and\ncredential dumping capability to enable lateral movement across a victim network.\nMicrosoft Defender for Endpoint detects the privilege escalation technique used:\n\nLazyCat performs credential dumping through usage of the MiniDumpWriteDump\nWindows API call, also detected by Microsoft Defender for Endpoint:\n\n\n-----\n\n**Delivery (2020)**\nIn mid-April 2020 GADOLINIUM actors were detected sending spear-phishing emails\nwith malicious attachments. The filenames of these attachments were named to appeal to\nthe target’s interest in the COVID-19 pandemic. The PowerPoint file (20200423-sitrep_92-covid-19.ppt), when run, would drop a file, doc1.dotm. Similarly, to the 2019 example,_\nMicrosoft Defender for Office detects and blocks emails with these malicious PowerPoint\nand Word attachments.\n\n**Command and Control (2020)**\nThe malicious doc1.dotm had two payloads which run in succession.\n\nThe first payload turns off a type\ncheck DisableActivitySurrogateSelectorTypeCheck which the second stage\n[needs as discussed in this blog.](https://silentbreaksecurity.com/re-animating-activitysurrogateselector/)\nThe second payload loads an embedded .Net binary which downloads, decrypts +\nruns a .png file.\n\nThe .png is actually PowerShell which downloads and uploads fake png files using the\nMicrosoft Graph API to\n_https://graph.microsoft.com/v1.0/drive/root:/onlinework/contact/$($ID)_1.png:/con_\n_tent where $ID is the ID of the malware. The GADOLINIUM PowerShell is a modified_\n[version of the opensource PowershellEmpire toolkit.](https://github.com/EmpireProject/)\n\n**Actions on Objectives (2020)**\nThe GADOLINIUM PowerShell Empire toolkit allows the attacker to load additional\nmodules to victim computers seamlessly via Microsoft Graph API calls. It provides\n[a command and control module that uses the attacker’s Microsoft OneDrive account to](https://github.com/EmpireProject/Empire/blob/master/data/agent/stagers/onedrive.ps1)\nexecute commands and retrieve results between attacker and victim systems. The use of\nthis PowerShell Empire module is particularly challenging for traditional SOC monitoring\nto identify. The attacker uses an Azure Active Directory application to configure a victim\n\n\n-----\n\nendpoint with the permissions needed to exfiltrate data to the attacker’s own Microsoft\nOneDrive storage. From an endpoint or network monitoring perspective the activity\ninitially appears to be related to trusted applications using trusted cloud service APIs and,\nin this scenario,, no OAuth permissions consent prompts occur. Later in this blog post, we\nwill provide additional information about how Microsoft proactively prevents attackers\nfrom using our cloud infrastructure in these ways.\n\n**Command and Control—Server compromise**\nGADOLINIUM campaigns often involve installing web shells on legitimate web sites for\ncommand and control or traffic redirection. Microsoft Defender for Endpoint detects web\nshells by analyzing web server telemetry such as process creation and file modifications.\n[Microsoft blogged earlier in the year on the use of web shells by multiple groups and how](https://www.microsoft.com/security/blog/2020/02/04/ghost-in-the-shell-investigating-web-shell-attacks/)\nwe detect such activities.\n\n\n-----\n\n_Figure 6: Microsoft Defender for Endpoint alerts of suspicious web shell attacks._\n\nWeb shell alerts from Microsoft Defender for Endpoint can be explored in Azure Sentinel\nand enriched with additional information that can give key insights into the attack.\nMSTIC’s Azure Sentinel team recently published a blog outlining how such insights can\n[be derived by analyzing events from the W3CIISLog.](https://techcommunity.microsoft.com/t5/azure-sentinel/azure-sentinel-performing-additional-security-monitoring-of-high/ba-p/430740)\n\n**Microsoft’s proactive steps to defend customers**\nIn addition to detecting many of the individual components of the attacks through\nMicrosoft’s security products and services such as Microsoft Defender for Endpoint and\nfor Microsoft Defender for Office as described above, we also take proactive steps to\nprevent attackers from using our cloud infrastructure to perpetrate attacks. As a cloud\nprovider, Microsoft is uniquely positioned to disrupt this attacker technique. The\nPowerShell Empire scenario is a good example of this. During April 2020, the Microsoft\nIdentity Security team suspended 18 Azure Active Directory applications that we\ndetermined to be part of GADOLINIUM’s PowerShell Empire infrastructure (Application\nIDs listed in IOC section below). Such action is particularly beneficial to customers as\nsuspending these applications protects all customers transparently without any action\nbeing required at their end.)\n\nAs part of Microsoft’s broader work to foster a secure and trustworthy app ecosystem, we\nresearch and develop detection techniques for both known and novel malicious\napplications. Applications exhibiting malicious behavior are quickly suspended to ensure\nour customers are protected.\n\nGADOLINIUM will no doubt evolve their tactics in pursuit of its objectives. As those\nthreats target Microsoft customers, we will continue to build detections and implement\nprotections to defend against them. For security practitioners looking to expand your own\nhunting on GADOLINIUM, we are sharing the below indicators of compromise (IOCs)\nassociated with their activity.\n\n\n-----\n\n## List of related GADOLINIUM indicators\n\n**Hashes from malicious document attachments**\n\nfaebff04d7ca9cca92975e06c4a0e9ce1455860147d8432ff9fc24622b7cf675\nf61212ab1362dffd3fa6258116973fb924068217317d2bc562481b037c806a0a\n\n**Actor-owned email addresses**\n\nChris.sukkar@hotmail.com\nPhillipAdamsthird@hotmail.com\nsdfwfde234sdws@outlook.com\njenny1235667@outlook.com\nfghfert32423dsa@outlook.com\nsroggeveen@outlook.com\nRobertFetter.fdmed@hotmail.com\nHeather.mayx@outlook.com\n\n**Azure Active Directory App IDs associated with malicious apps**\n\nae213805-a6a2-476c-9c82-c37dfc0b6a6c\nafd7a273-982b-4873-984a-063d0d3ca23d\n58e2e113-b4c9-4f1a-927a-ae29e2e1cdeb\n8ba5106c-692d-4a86-ad3f-fc76f01b890d\nbe561020-ba37-47b2-99ab-29dd1a4312c4\n574b7f3b-36da-41ee-86b9-c076f999b1de\n941ec5a5-d5bf-419e-aa93-c5afd0b01eff\nd9404c7d-796d-4500-877e-d1b49f02c9df\n67e2bb25-1f61-47b6-9ae3-c6104e587882\n9085bb9e-9b56-4b84-b21e-bd5d5c7b0de0\n289d71ad-54ee-44a4-8d9a-9294f19b0069\na5ea2576-4191-4e9a-bfed-760fff616fbf\n802172dc-8014-42a9-b765-133c07039f9f\nfb33785b-f3f7-4b2b-b5c1-f688d3de1bde\nc196c17d-1e3c-4049-a989-c62f7afaf7f3\n79128217-d61e-41f9-a165-e06e1d672069\nf4a41d96-2045-4d75-a0ec-9970b0150b52\n88d43534-4128-4969-b5c4-ceefd9b31d02\n\n[To learn more about Microsoft Security solutions visit our website. Bookmark](https://www.microsoft.com/en-us/security/business/solutions)\n[the Security blog to keep up with our expert coverage on security matters. Also, follow us](https://www.microsoft.com/security/blog/)\n[at @MSFTSecurity for the latest news and updates on cybersecurity.](https://twitter.com/@MSFTSecurity)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.09.24.Empires_in_the_Cloud/Microsoft%20Security%E2%80%94detecting%20empires%20in%20the%20cloud%20-%20Microsoft%20Security.pdf"
    ],
    "report_names": [
        "Microsoft Security—detecting empires in the cloud - Microsoft Security"
    ],
    "threat_actors": [
        {
            "id": "16f2436b-5f84-44e3-a306-f1f9e92f7bea",
            "created_at": "2023-01-06T13:46:38.745572Z",
            "updated_at": "2025-03-27T02:00:02.907444Z",
            "deleted_at": null,
            "main_name": "APT40",
            "aliases": [
                "ISLANDDREAMS",
                "TEMP.Jumper",
                "BRONZE MOHAWK",
                "GADOLINIUM",
                "KRYPTONITE PANDA",
                "TA423",
                "MUDCARP",
                "Gingham Typhoon",
                "TEMP.Periscope",
                "G0065",
                "ATK29",
                "Red Ladon",
                "ITG09"
            ],
            "source_name": "MISPGALAXY:APT40",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "59be3740-c8c7-47aa-84c8-e80d0cb7ea3a",
            "created_at": "2022-10-25T15:50:23.481057Z",
            "updated_at": "2025-03-27T02:00:55.480695Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "MUDCARP",
                "Kryptonite Panda",
                "Gadolinium",
                "BRONZE MOHAWK",
                "TEMP.Jumper",
                "APT40",
                "TEMP.Periscope",
                "Gingham Typhoon"
            ],
            "source_name": "MITRE:Leviathan",
            "tools": [
                "Windows Credential Editor",
                "BITSAdmin",
                "HOMEFRY",
                "Derusbi",
                "at",
                "BLACKCOFFEE",
                "BADFLICK",
                "gh0st RAT",
                "PowerSploit",
                "MURKYTOP",
                "NanHaiShu",
                "Orz",
                "Cobalt Strike",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b9806584-4d82-4f32-ae97-18a2583e8d11",
            "created_at": "2022-10-25T16:07:23.787833Z",
            "updated_at": "2025-03-27T02:02:09.978883Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "APT 40",
                "ATK 29",
                "Bronze Mohawk",
                "Gadolinium",
                "Gingham Typhoon",
                "ISLANDDREAMS",
                "ITG09",
                "Kryptonite Panda",
                "Mudcarp",
                "Red Ladon",
                "TA423",
                "TEMP.Jumper",
                "TEMP.Periscope"
            ],
            "source_name": "ETDA:Leviathan",
            "tools": [
                "AIRBREAK",
                "Agent.dhwf",
                "Agentemis",
                "AngryRebel",
                "BADFLICK",
                "BlackCoffee",
                "CHINACHOPPER",
                "China Chopper",
                "Cobalt Strike",
                "CobaltStrike",
                "DADJOKE",
                "Dadstache",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "GRILLMARK",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEFRY",
                "Hellsing Backdoor",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LUNCHMONEY",
                "Living off the Land",
                "MURKYTOP",
                "Moudour",
                "Mydoor",
                "NanHaiShu",
                "Orz",
                "PCRat",
                "PNGRAT",
                "PlugX",
                "RedDelta",
                "SeDLL",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "cobeacon",
                "gresim",
                "scanbox"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "83025f5e-302e-46b0-baf6-650a4d313dfc",
            "created_at": "2024-05-01T02:03:07.971863Z",
            "updated_at": "2025-03-27T02:05:17.278721Z",
            "deleted_at": null,
            "main_name": "BRONZE MOHAWK",
            "aliases": [
                "Flaccid Rose ",
                "GADOLINIUM ",
                "Kryptonite Panda ",
                "Leviathan ",
                "Nanhaishu ",
                "Pickleworm ",
                "Temp.Jumper ",
                "Temp.Periscope ",
                "APT40 "
            ],
            "source_name": "Secureworks:BRONZE MOHAWK",
            "tools": [
                " BlackCoffee",
                " China Chopper",
                " Cobalt Strike",
                " Derusbi",
                " Derusbi Trojan",
                " FUSIONBLAZE",
                " GreenCrash",
                " HOMEFRY",
                " MURKYTOP",
                " Metasploit",
                " Metasploit / Meterpreter",
                " Nanhaishu",
                " Orz",
                " ScanBox",
                " SeDll",
                "AIRBREAK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041836,
    "ts_creation_date": 1601028329,
    "ts_modification_date": 1601028329,
    "files": {
        "pdf": "https://archive.orkl.eu/b68432d09718bec3dcd78a55d09dc826f249f425.pdf",
        "text": "https://archive.orkl.eu/b68432d09718bec3dcd78a55d09dc826f249f425.txt",
        "img": "https://archive.orkl.eu/b68432d09718bec3dcd78a55d09dc826f249f425.jpg"
    }
}