{
    "id": "b9801c0f-d2f7-4c09-ad95-0a06a7c3fe24",
    "created_at": "2022-10-25T16:48:19.477717Z",
    "updated_at": "2025-03-27T02:14:57.427087Z",
    "deleted_at": null,
    "sha1_hash": "c8f384ae75119626032d4b42f34e883269dbf2a4",
    "title": "Shooting Elephants",
    "authors": "Netzpolitik",
    "file_creation_date": "2015-02-17T16:02:10Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 456557,
    "plain_text": "# SHOOTING ELEPHANTS\n\n\n**page | 1**\n\n\n-----\n\n## SHOOTING ELEPHANTS\n\n###### DROPPER\n\n MD5 9fff114f15b86896d8d4978c0ad2813d SHA-1 27a0a98053f3eed82a51cdefbdfec7bb948e1f36 File Size 693.4 KB (710075 bytes) Compile Time 2011-08-29 11:48:42\n\n IMPLANT\n\n MD5 4525141d9e6e7b5a7f4e8c3db3f0c24c SHA-1 efbe18eb8a66e4b6289a5c53f22254f76e3a29bd File Size 585.4 KB (599438 bytes) Compile Time 2011-08-29 13:02:29\n\nSpecial thanks for their contribution in the making of this report go to Morgan Marquis-Boire, Joan Calvet,\n\n**Paul Rascagnéres, Alex Dulaunoy, Raphael Vinot and the remaining team of CIRCL Luxembourg.**\n\nYou guys rock \\m/\n\nComments or inquiries please direct to Marion Marschalek (0xF372F2CA).\n\nBabar and the related crowd of animalesque malware will be presented at SyScan'15 conference\n\n[(https://www.syscan.org/) in March 2015. No elephants were harmed in the making of this report.](https://www.syscan.org/)\n\nThis work is licensed under a\nCreative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.\n\n**page | 2**\n\n\n-----\n\n### CONTENT\n\n\n###### 1. SHOOTING ELEPHANTS....................................................................................4 2. MISCREANT'S DROPPER..................................................................................5 3. MISCREANT'S IMPLANT...................................................................................6\n 3.1 ANTI-ANALYSIS MEASURES........................................................................6 3.2 BABAR CAME TO STAY................................................................................7 3.3 CONFIGURATION DATA..............................................................................7 3.4 MODUS OPERANDI ELEPHANTI.................................................................9 3.5 FUNCTIONALITY.......................................................................................10\n 3.5.1 THE KEYLOGGER MODULE................................................................10 3.5.2 INVADING DESKTOP PROCESSES.......................................................11 3.5.3 I AM ROOT(kit)..................................................................................11 3.6 STOLEN GOODS........................................................................................13 3.7 CALLING HOME........................................................................................14 4. BEYOND BABAR.............................................................................................16 5. RESOURCES....................................................................................................18 6. APPENDICES..................................................................................................19\n\n**page | 3**\n\n\n-----\n\n#### 1. SHOOTING ELEPHANTS\n\n\nSubject of this analysis is a fascinating piece of malware, which invades Windows desktop\nmachines and aims at.. well, all the things. The analyzed malware consists of a dropper and an\nimplant, which invades Windows processes to steal data from instant messengers, softphones,\nbrowsers and office applications. A fully blown espionage kit, so to say, sophisticated almost. The\nimplant is able to hook APIs of interest in dedicated remote processes, to steal data on the fly.\n\nMore interesting than the malware itself though is the path to the associated symbol file, which\nappears embedded in the dropper. The analyzed malware samples come with the internal project\nname 'Babar64'.\n\n**Illustration 1 | The .pdb path embedded in Babar's dropper**\n\nThe myth of Babar has been around for a while in the intelligence community. Questions have\nbeen raised since Le Monde published an article on Babar in 2014 [1] and were recently fuelled by\na leaked government presentation found among a stash of documents published in January by\nSpiegel [2]. The leaked document was authored by the Communications Security Establishment\nCanada (CSEC) and reports about a potential nation state attack involving malware named Babar.\nThe actor behind the attacks is assumed to be French inteligence. Assumptions are based on\ncertain binary attributes, language and location of infrastructure as well as targets.\n\nThe binaries at hand fit well with the description CSEC provides, although it is quite clear they are a\nnewer version from what CSEC had uncovered around 2009. It is not clear whether the compilation\ntimestamps are falsified, but an earlier compilation time than the actual stamp seems unlikely.\n\nDoubtlessly though, the Babar binaries match with a malware strain representing itself as Bunny,\nas well as a family dubbed NBOT or TFC.\n\n**page | 4**\n\n\n-----\n\n#### 2. MISCREANT'S DROPPER\n\n\nThe dropper operates straight forward; it fetches the encrypted DLL from its own binary from\noutside its resource section, decrypts it and hides it in the file system. Then it goes on to load the\nDLL using Windows regsvr32.exe. To achieve this it spawns a dedicated process with the command\nline '\"regsvr32.exe\" /s /n /i \"%APPDATA%\\%DLLNAME%\"'.\n\nThe DLL name is random but legitimately looking and hardcoded for a specific dropper. It is also\nstored as encrypted string in the binary, and has been seen to decrypt to either 'perf585.dll' or\n'dump21cb.dll' depending on the dropper.\n\nThe encryption algorithm used is AES (Advanced Encryption Standard) with 128-bit keys. The keys\nused for decryption are '20 33 AF 73 A9 AC 72 D3 BE E6 A5 73 92 BA 37 6C' for the implant\nfilename and 'A0 0E 3E B3 3A 1C D3 AA A0 BE 3F B3 F9 0A 96 15' for decrypting the binary. AES is\nthe encryption algorithm of choice throughout the dropper and its implant's operations.\n\nInterestingly, the Babar dropper as well as the implant show a similar method of API name\nobfuscation as the Bunny malware and samples from the NBOT family. Dedicated APIs are loaded\nthrough a resolution function, which searches for library exports by comparing hashes of the\nexport names with a given hash. For the Babar project though the attackers used an adapted\nversion of SHA-1, as opposed to the simple XOR/ROL hash algorithm which was used in the Bunny\nproject.\n\nAfter infection the dropper executes a separate command line through spawning a cmd.exe\nprocess, which is instructed to wait for 1 second before deleting the dropper binary on disk. This\nway the malware reduces forensic artefacts, staying behind after infection. Curiously though, the\nregsvr32.exe process used to load the dropped implant remains running. This way Babar leaves a\nvisible process on the process list during execution.\n\nAs the project name 'Babar64' suggests, dropper and implant are designed to work on 32-bit and\non 64-bit Windows versions. However, process hooking and injection can only affect 32-bit\nprocesses due to the bitness of the implant itself.\n\n**page | 5**\n\n\n-----\n\n#### 3. MISCREANT'S IMPLANT\n\n\nBabar's implant is a 32-bit DLL written in C++, which upon start injects itself to running processes\nand invades desktop applications by applying a global Windows hooks. The implant is capable of\nlogging keystrokes, capture screen shots, spy on installed softphones and instant messengers next\nto a list of simpler espionage tricks. Babar is a fully blown espionage tool, built to excessively spy\non the user's activity on an infected machine.\n\nThe DLL dropped by Babar is placed into the application data folder, along with a directory named\n'MSI' where the runtime data will be stored. Babar operates through multiple instances, by\ninjecting its DLL to a maximum of three desktop processes. This is achieved by loading the Babar\nDLL to remote processes through a mapped memory object.\n\nApart from that, Babar comes with a userland rootkit component which applies global Windows\nhooks to invade all processes on its desktop. This way Babar can install API hooks for various APIs\nvia Windows Detours technique to actively steal data from arbitrary processes.\n\n##### 3.1 ANTI-ANALYSIS MEASURES\n\nBabar's anti-analysis measures are sparse. It is not protected by a runtime packer or crypter, it\ndoes not have sandbox detection or anti-debugging measures, most character strings are shown in\nclear-text.\n\nBabar does show the same obscure treatment for installed anti-virus products as the Bunny\nmalware though. Babar also enumerates the Windows Management Instrumentation for installed\nAV solutions, while the exact use of this information is not yet known. We do suspect large\nportions of the product enumeration to be based on the exact same source code as the module\nBunny used.\n\n**Illustration 2 | Querying anti-virus products installed on the machine**\n\nThe enumeration function issues the commands „SELECT * FROM AntiVirusProduct“ and retrieves\nattributes such as 'productState', 'DisplayName', 'VersionNumber' and 'productUptoDate'.\n\nThe anti-virus solutions searched for are again identified by 256-bit SHA hashes. Only some of the\n\n**page | 6**\n\n\n-----\n\nhashes could be mapped to known names of anti-virus solutions.\n\n4db3801a45802041baa44334303e0498c2640cd5dfd6892545487bf7c8c9219f ThreatFire\n522e5549af01c747329d923110c058b7bb7e112816de64bd7919d7b9194fba5b Rising\n2fd5c42d49f9e0fe2daae5b0f78cf9cfde9bfc7b0ed59fc68e0a79a3b16fe05b\n06e387bb79584cdff3672feadea0bf6f783ce1ddc1fa91962d1b5bcd94e1a308\nf1761a5e3856dceb3e14d4555af92d3d1ac47604841f69fc72328b53ab45ca56 Kaspersky\n588730213eb6ace35caadcb651217bfbde3f615d94a9cca41a31ee9fa09b186c ZoneAlarm\nc8e8248940830e9f1dc600c189640e91c40f95caae4f3187fb04427980cdc479\nb3fe0e3a3e3befa152c4237b0f3a96ffaa44a2d7e1aa6d379d3a1ab4659e1676 AntiVir\n\nBabar also implements an obfuscation technique to hide certain API names. Selected APIs are\nidentified by hashes, which are used to load the APIs dynamically at runtime. The hashes are\nhardcoded within the binary, and will be compared to hashed library exports by the API resolution\nroutine.\n\nThe hashing algorithm is different from the simple XOR/ROL technique Bunny uses. It seems to be\nbased on SHA-1, but generates 32-bit hashes instead of the standard 160-bit length.\n\nWhat Bunny, Babar and NBOT all have in common though is that the obfuscation technique is easy\nto break and only applied to a subset of APIs. As an anti-analysis trick this is considerably useless, it\ndoes make sense though to trick malware detection solutions which apply heuristics based on\nstatic analysis of API calls. This becomes evident when looking at the list of Babar's obfuscated API\nnames, which includes RegisterRawInputDevices, GetRawInputData, GetClipboardData or\nDirectSoundCaptureCreate.\n\n##### 3.2 BABAR CAME TO STAY\n\nThe startup routine of the Babar implant will create a registry key under\n'[HKU]\\..\\CurrentVersion\\Run' to assure persistence. The key is named 'MSSecurity' and executes\nthe exact same command line as the infector, every time the system boots - '\"regsvr32.exe\" /s /n /i\n\"%APPDATA%\\%DLLNAME%\"'. At system boot time the regsvr32.exe process will start, load the\nBabar DLL and thus 'deploy' the malware to various legitimate processes. As opposed to\npersistence, Babar also implements functionality to uninstall itself from the affected system.\n\nInteresting again, same as during infection, the regsvr32.exe process remains running even after\nBabar is readily set up.\n\n##### 3.3 CONFIGURATION DATA\n\nDuring initialization Babar loads and decrypts a set of configuration parameters which are\nappended to the DLL's relocation section. ASCII strings within the configuration data reveal a lot\nabout Babar's intentions:\n\n  - Office executable names and associated document abbreviations\n_excel.exe, winword.exe, powerpnt.exe, visio.exe, acrord32.exe, notepad.exe,_\n\n**page | 7**\n\n\n-----\n\n_wordpad.exe.txt, rtf, xls, xlsx, ppt, pptx, doc, docx, pdf, vsd_\n\n  - Softphone executable names\n_skype.exe, msnmsgr.exe, oovoo.exe, nimbuzz.exe, googletalk.exe, yahoomessenger.exe, x-_\n_lite.exe_\n\n  - A version number\n_12075-01_\n\n  - Path and filename of the dump file\n_%COMMON_APPDATA%\\MSI\\update.msi_\n\n  - Path to the runtime data directory\n_%COMMON_APPDATA%\\MSI_\n\n  - Two C&C server domains and request parameters\n_http://www.horizons-tourisme.com/_vti_bin/_vti_msc/bb/index.php_\n_http://www.gezelimmi.com/wp-includes/misc/bb/index.php_\n\n  - Web browser executable names, including MSN messenger\n_iexplore.exe,firefox.exe,opera.exe,chrome.exe,Safari.exe,msnmsgr.exe_\n\n  - The name of the dropped implant\n_perf_585.dll_\n\nAs could be seen already in binaries of related families, next to the hardcoded configuration data\nBabar maintains a system specific runtime configuration. The additional configuration consists of a\nset of local attributes and a set of values derived from the Windows environment. The attributes\nare dynamically generated or requested at runtime and not stored in memory.\n\n%USERHASH% - Hash of the login name\n%USER% - Login name\n%SEQ% - Assumed to be the sequence number of dump files created by Babar\n%KID% - Assumed to be the ID of a subsequently infected process\n%ID% - Value retrieved from hardcoded configuration\n%SELFDIR% - Executable directory\n%SELF% - Executable name\n\nValues retrieved from Windows environment:\n\n%APPDATA%\n%USERPROFILE%\n%WINDIR%\n%COMMON_APPDATA%\n%ALLUSERPROFILE%\n%CommonProgramFiles%\n\n**page | 8**\n\n\n-----\n\n##### 3.4 MODUS OPERANDI ELEPHANTI\n\nThe DLL when loaded in the context of an application seeks to invade a maximum of two more\nvictim processes. This for once is a resilience measure, so if the initially infected process stops\nrunning the malware remains in memory through additional instances. On the other hand it is\npractically a load balancing measure. The C&C communication module is located in an export of\nthe DLL, which will be executed through a remote thread, injected like the child processes, via a\nmemory-mapped file.\n\nThe process infection is achieved by mapping a shared object into the victim's process space and\ninvoking a function stub as remote thread. The steps being taken are:\n\n  - MapViewOfFile – mapped memory shared with the child instance\n\n  - OpenProcess – obtaining a handle to the chosen victim process\n\n  - VirtualAllocEx – allocate space in remote memory\n\n  - WriteProcessMemory – write function stub to remote memory\n\n  - CreateRemoteThread – execute function stub as remote process\n\nThe function stub will then go on to load the Babar DLL through LoadLibraryA and execute one of\nits exports, as indicated in the shared memory. The mapped object contains name and path to the\nmalicious DLL, the name of the pipe being used for communication between the instances, the\nname of the export from the DLL to be called as well as information about instances already\nrunning.\n\nFor picking a process to infect the malware randomly picks one from a list of prospects. These have\nto be 32-bit processes, not already infected and not among a list of processes to avoid such as\nwinlogon.exe, explorer.exe, cmd.exe or regsvr32.exe.\n\nThis way Babar always keeps three instances in memory. The first one to start up will be the 'main\ninstance'. If any of the instances dies, a new third instance will be created. If the main instance dies\nthe oldest child will take over.\n\nFor inter process communication Babar uses named pipes. The main instance generates a random\nGUID which is used as name and passed to child instances. At the same time, the main instance\ncreates six named pipes using the very same GUID. These pipes represent the server side for child\ninstances, and also the point to connect to for hooks Babar installs to spy on several system APIs.\n\n**page | 9**\n\n\n-----\n\n**Illustration 3 | Named pipes opened by the main instance**\n\n##### 3.5 FUNCTIONALITY\n\nThe spying activities are performed either through the Babar instance locally or via a global\nWindows hook invading all processes running in the same desktop. Instance-local capabilities are\nbasic spying on window names or snooping on the clipboard data, while the global hooks manage\nto steal information directly from Windows API calls.\n\nA summary of the capabilities would be as follows:\n\n- Logging keystrokes\n\n- Taking screenshots\n\n- Capture of audio streams from softphone applications\n\n- Stealing of clipboard data\n\n- System and user default language, keyboard layout\n\n- Names of desktop windows\n\n**3.5.1 THE KEYLOGGER MODULE**\n\nThe keylogger is based on the raw input model. The malware creates an invisible window, with no\nother purpose than to receive window messages. By processing the window message queue it\nfilters out input events and dispatches them to a raw input device object. Said object is configured\nto grab keyboard events through GetRawInputData.\n\n**page | 10**\n\n\n-----\n\n**Illustration 4 | The keylogger module uses Windows RAWINPUT to achieve its goal**\n\nThe snooped keystroke data is passed to a thread, which performs encryption and dumps the data\nto a log file. The file is located in Babar's working directory and named update.msi.\n\nThe design of the keylogging component is simple but effective. Babar is able to sniff all keystrokes\nhappening on the same desktop as its invisible window. Interesting though, the code seen in\nBabar's implant is remarkably similar to an example posted at [4].\n\n**3.5.2 INVADING DESKTOP PROCESSES**\n\nThe Babar implant applies global Windows hooks to load its DLL into the process space of other\nprocesses. A global hook is installed by calling SetWindowsHookEx by passing the thread ID zero. It\napplies to all processes running in the same desktop, having the same 'bitness' as the DLL to be\ninjected. In the given case this applies to all 32-bit processes.\n\nA global Windows hook is installed into the Windows event chain. This effectively means code\nprovided by the hooking DLL gets executed whenever an arbitrary desktop process receives an\nevent of a type specified by the hook.\n\nBabar installs hooks for type 2 and 3, which are WH_KEYBOARD and WH_GETMESSAGE. This way\nBabar has control over all keyboard and message events received by any application on the same\nWindows desktop.\n\n**3.5.3 I AM ROOT(kit)**\n\nThrough the hook mechanism Babar can be maximum invasive in the Windows userland. Once in\nthe context of a desired target process, the malware goes on to hook specific APIs of interest. This\nis achieved by applying the detours technique, which implements trampoline functions to be\ninvoked every time a hooked API is called [6]. To achieve this, Babar rewrites the in-memory code\nfor target APIs. A call to a hooked API then results in the calling application invoking a trampoline\nfunction, which performs malicious activity and then passes control on to the legitimate API.\n\n**page | 11**\n\n\n-----\n\nBabar supports trampoline functions for a limited list of APIs and limited to a set of processes of\ninterest, defined by its configuration. The list of APIs to hook is parted in three groups:\n\n  - Internet communication\n_WSARecv_\n_send_\n_closesocket_\n\n  - File creation\n_CreateFileW_\n\n  - Media\n_DirectSoundCreate_\n_DirectSoundCaptureCreate_\n_DirectSoundCreate8_\n_DirectSoundCaptureCreate8_\n_CoCreateInstance_\n_waveOutOpen_\n_waveOutClose_\n_waveOutWrite_\n_waveInOpen_\n_waveInClose_\n_waveInAddBuffer_\n\nAny set of hooks will only be applied to a defined set of processes. The predefined groups of\napplication names retrieved from the hardcoded configuration data set the scope of Babar's\nhooking advances:\n\n  - Internet communication\n_iexplore.exe,firefox.exe,opera.exe,chrome.exe,Safari.exe,msnmsgr.exe_\n\n  - File creation\n_excel.exe, winword.exe, powerpnt.exe, visio.exe, acrord32.exe, notepad.exe,_\n_wordpad.exe.txt, rtf, xls, xlsx, ppt, pptx, doc, docx, pdf, vsd_\n\n  - Media\n_skype.exe, msnmsgr.exe, oovoo.exe, nimbuzz.exe, googletalk.exe, yahoomessenger.exe, x-_\n_lite.exe_\n\nThe respective trampolines steal data going in or out of the hooked APIs on the fly. The parsing\nfunction for intercepted internet communication searches for chat traffic, more specifically for\nmessages conforming with the MSNP21 standard. Babar is searching for tags such as 'MessageType', 'Reliability', 'To', 'From' or 'Text' to pick out of the stream. A more detailed explanation\nconcerning the MSNP21 can be found at [7]. MSNP21 is the MSN messenger chat protocol that\nwas introduced with Windows Live 2010 beta. It is unclear though as of why only parsing for the\nMSN messenger is supported.\n\n**page | 12**\n\n\n-----\n\nThe data, like all stolen information, is handled by\na separate thread which compresses and encrypts\nit before dumping it to a file on disk.\n\nFor grabbing audio streams Babar includes code\nfrom the OpenCORE AMR library [8]. AMR\nenables the malware to encode and decode raw\naudio frames as they are passed to or grabbed\nfrom the audio devices. The very same malware\nmodule performs screen captures while dumping\nthe snooped data. This is assumed to happen to\nrecognize the parties involved in the conversation\nby capturing the GUI of the softphone\napplication.\n\n##### 3.6 STOLEN GOODS\n\n\n**Illustration 6 | MSNP21 tags**\n\n\nBabar comes with the Deflate algorithm, as used by Zlib, to be able to compress data before\nencrypting it and dumping it to disk. The data is encrypted with 128-bit AES using the key 24 FE C5\nAD 34 56 F7 F8 12 01 00 AE B6 7C DE AB for reading and writing files. The following files have been\nseen to be dumped to Babar's working directory under %APPDATA%\\MSI:\n\n  - update.msi\n\n  - 48fe7f28.msi\n\n  - 0c6b5d2d.msi\n\n  - 31e50daa.msi\n\n  - mpavdlta.vdm\n\nStolen information will be handled by the Babar main instance, which receives data through six\nnamed pipes from other instances or hooked processes. The update.msi-file stores data collected\nby the keylogging module. It posesses a file header which among other attributes keeps system\nspecific data. This is assumed to serve for mapping of logfiles to infected hosts.\n\nLog lines written for stolen data from browsers and the MSN messenger are built by the format\nstring \"%s%c%s|%s\\n\", where the first string is likely participant1 of a conversation, the second\nstring participant2. Both are parted by the characters '<' or '>' depending on the direction of the\nconversation.\n\nSimilar log lines accompany dumped sound data and saved documents. Sound data logs follow the\nformat \"A|%u|%S\", document logs the format \"%I64i|%I64i|%I64i|%s%s|%s\\n\". For documents\n\n**page | 13**\n\n\n-----\n\nthree timestamps are included as well as whether read or write access was requested, indicated by\n'R' or 'W' or '-'. The last placeholder is reserved for the filename. At the time of writing the content\nof the sound data log line remains unclear.\n\n##### 3.7 CALLING HOME\n\nThe internet communication module of Babar is located in a sparate export called\n'FindCtxSectionStringW', which will be invoked through remote thread injection at runtime.\nInjection is achieved the same way as the infection of child instances described in section 3.4.\n\nThe analyzed sample of Babar has two hard coded C&C server addresses which are included in its\nconfiguration data:\n\n  - http://www.horizons-tourisme.com/_vti_bin/_vti_msc/bb/index.php\n\n  - http://www.gezelimmi.com/wp-includes/misc/bb/index.php\n\nBoth servers were used to push spied information onto the remote site. It remains unclear though\nwhether the C&Cs also served to instruct the infected machines per commands, as Babar does not\nposess obvious command parsing functionality. Data exfiltration is assumed to be time triggered.\n\n**Illustration 7 | The website of horizons-tourisme.com today**\n\nThe domain horizons-tourisme.com is a legitimate website, operated by an Algerian travel agency,\nlocated in Algiers, Algeria. The website is in French and still online today. Gezelimmi.com is a\nTurkish domain, currently responding with an HTTP error message 403, access not permitted. Both\ndomains appear to be of legitimate use, but compromised and abused to host Babar's server side\ninfrastructure.\n\nAt the time of writing the server pointed to by horizons-tourisme.com is still hosting left overs\nfrom the C&C infrastructure used by Babar. With directory traversal activated researchers from\nESET could pull a minimalistic directory structure, showing directories named as follows:\n\n  - bb28\n\n  - d13\n\n  - tfc422\n\n**page | 14**\n\n\n-----\n\nObviously, the directory belonging to Babar is 'bb28'. 'tfc422' matches with strings found in the TFC\nbots (previously named NBOT). The purpose of the 'd13' directory remains unknown, although it is\nassumed to serve for requests of a third currently unknown family. Most of the directories pulled\nfrom horizons-tourisme.com are empty, or contain empty files. The only script inside the bb28\ndirectory though appears to be interesting. Its a .php-script named config.inc, containing variables\nwhich look familiar from Babar's config such as 'user', 'id' or 'seq', but also a handful of comments\nfrom the authors.\n\n<?php\n$uninstall = false; //true to uninstall\n$buninstall_id = false; //true to uninstall from ID\n$uninstall_id = \"0C124D55\"; //ID to uninstall in hex\n//$uninstall = true;\n$debug = false; //true to see errors messages FOR TEST ONLY!!\n$writelogs = false; //true to create logs file in logs directory\n$version = 3;\n$get_varname_user = \"user\";\n$get_varname_id = \"id\";\n$get_varname_seq = \"seq\";\n$storefile = \"storage/file\";\n$ext = \".kv\";\n$maxsize = 1024*1024*2; //0 = unlimited size if we choose predifined files\n$UOK_V3 = 0x7345d346;\n\nfunction disableCache() {\n\n$expires = 0;\n$gm_expires = gmdate('D, d M Y H:i:s', time() + $expires);\nheader(\"Cache-control: private, max-age=$expires, pre-check=$expires\");\nheader(\"Expires: $gm_expires GMT\");\nheader(\"Last-Modified: \" . gmdate(\"D, d M Y H:i:s\") . \" GMT\");\n}\nfunction listingFile($fn) {\n\nif (!file_exists($fn)) return false;\necho \"<A HREF= \\\"$fn\\\">$fn</A><BR>\" ;\nreturn true;\n}\n\nfunction resetStorageFile($fn) {\n\nif (!file_exists($fn)) return false;\n$fp = fopen($fn, \"wb\");\nif ($fp) fclose($fp);\nelse return false;\nreturn true;\n}\n\n?>\n\n**page | 15**\n\n\n-----\n\n#### 4. BEYOND BABAR\n\n\nAt the time of writing two Babar64 droppers are known, dropping one implant each. They both\nshow traits of the malware described by CSEC, being attributed to French intelligence with\n„moderate certainty“ [2].\n\nThe CSEC document mentions uncovering the attack in 2009. The compilation timestamps of the\nbinaries date back to August 2011. While these can be faked it is still unlikely that the authors\nwould change the 2009-timestamp to a future date. This, and the mentioning of 'Babar' instead of\n'Babar64' by CSEC indicates that the samples at hand stem from a more recent campaign.\n\nBesides the project name, Babar64 also shares the malformed user agent string described in the\ndocument, where a letter from the MSIE 6.0 name is missing.\n\n**Illustration 8 | The malformed user agent string showing 'MSI' instead of 'MSIE'**\n\nThe second Babar64 binary comes with its own set of C&C servers:\n\n  - http://www.alexpetro.com/images/training/courses/bb212/index.php\n\n  - http://www.etehadyie.ir/images/public/bb212/index.php\n\nThe first one is the legitimate website of AlexPetro Technical Services, a company operating in the\noil and gas industry in Kairo, Egypt. The second domain is Iranian, allegedly owned by a web design\ncompany named Radcom.\n\nWhat links Babar64 to other families analyzed beforehand, such as Bunny or TFC (also called NBOT)\nare shared portions of source code and re-used coding techniques. The enumeration of anti-virus\nsoftware and the code to query the system's proxy settings are almost identical. Furthermore, the\nsamples at hand show the same partial API name obfuscation as Bunny and TFC. What has\nchanged is the hashing algorithm. Also common among all of the families seems to be to hold\nsystem specific configuration data in memory at runtime, although this holds true for a lot of\nmalware.\n\nPutting Babar, Bunny and TFC in context a number of conclusion can be drawn. Looking at the\ncompilation timestamps and assuming they are not faked (which is backed by VirusTotal\nsubmission dates), the oldest family is TFC being active throughout 2010. These are DDoS bots,\nused to build a botnet which can be utilized to attack adversaries on the internet.\n\n**page | 16**\n\n\n-----\n\nNext on the timeline is Babar64, allegedly compiled middle of 2011 and first seen on VirusTotal\nmiddle of 2012. It is believed that this strain has been active from 2011 until 2013, spying on\ndedicated targets rather than being spread widely.\n\nLast comes Bunny, compiled second half of 2011 and making its first public appearance during the\nanalysis of the Adobe Reader exploit for CVE-2011-4369 [9]. At the time when Bunny was spread\nthrough CVE-2011-4369, before December 2011, the vulnerability was unknown to the public.\nBunny itself is a Lua script execution platform, not including any spying capabilities.\n\nAll three families leave the impression of being developed by a team of skilled software\ndevelopers, rather than being the product of a malware author operating in the criminal\nunderground. Also none of the binaries makes attempts of hiding its intentions, which is a\ncommon trait among targeted malware. Heavy obfuscation or the use of crypters easily raises\nsuspicion of heuristics based malware scanners.\n\nHowever, besides the CSEC document there was no obvious pointer found leading to the\nconclusion that Babar and its companions were set out by French inteligence services. As it is with\ndigital crime, chances are high no proof will ever evolve and research will be limited to educated\nconclusions. The drawing of personal educated conclusions is left as an exercise for the interested\nreader.\n\n**page | 17**\n\n\n-----\n\n#### 5. RESOURCES\n\n\n\n[1]\n\nQuand les Canadiens partent en chasse de « Babar », Le Monde\n\n[http://www.lemonde.fr/international/article/2014/03/21/quand-les-canadiens-partent-en-chasse-](http://www.lemonde.fr/international/article/2014/03/21/quand-les-canadiens-partent-en-chasse-de-babar_4387233_3210.html)\n\n[de-babar_4387233_3210.html](http://www.lemonde.fr/international/article/2014/03/21/quand-les-canadiens-partent-en-chasse-de-babar_4387233_3210.html)\n\n[2]\nSNOWGLOBE: From Discovery to Attribution, CSEC, published by Der Spiegel\n[http://www.spiegel.de/media/media-35683.pdf](http://www.spiegel.de/media/media-35683.pdf)\n\n[3]\nSlidedeck TS/NOFORN, Keynote Hack.lu 2014 on Bunny / TFC\n[http://2014.hack.lu/archive/2014/TSNOFORN.pdf](http://2014.hack.lu/archive/2014/TSNOFORN.pdf)\n\n[4]\nA Minimal Keylogger using RAWINPUT, CodeProject\n[http://www.codeproject.com/Articles/297312/Minimal-Key-Logger-using-RAWINPUT](http://www.codeproject.com/Articles/297312/Minimal-Key-Logger-using-RAWINPUT)\n\n[5]\nImplementing Keyloggers in Windows, Securelist\n[https://securelist.com/analysis/36358/keyloggers-implementing-keyloggers-in-windows-part-two/](https://securelist.com/analysis/36358/keyloggers-implementing-keyloggers-in-windows-part-two/)\n\n[6]\nDetours: Binary Interception of Win32 Functions, Proceedings of Usenix conference '99\n[http://research.microsoft.com/pubs/68568/huntusenixnt99.pdf](http://research.microsoft.com/pubs/68568/huntusenixnt99.pdf)\n\n[7]\nDocumentation for changes in MSN Protocol Version 21\n[https://code.google.com/p/msnp-sharp/wiki/KB_MSNP21](https://code.google.com/p/msnp-sharp/wiki/KB_MSNP21)\n\n[8]\nAMR Audio Encoding, Potluri Suresh\n[http://www.codeproject.com/Articles/332109/AMR-Audio-Encoding](http://www.codeproject.com/Articles/332109/AMR-Audio-Encoding)\n\n[9]\nAnalyzing CVE-2011-4369, 9bplus\n[http://blog.9bplus.com/analyzing-cve-2011-4369-part-one/](http://blog.9bplus.com/analyzing-cve-2011-4369-part-one/)\n\n**page | 18**\n\n\n-----\n\n#### 6. APPENDICES\n\n\nLists of passive DNS entries for horizons-tourisme.com and gezelimmi.com can be found below. For\ngezelimmi.com:\n\nResolve Location Network First Last\n104.153.45.38 N/A 104.153.45.0/24 31.12.2013 00:00 09.11.2014 00:00\n199.231.93.221 US 199.231.93.0/24 03.07.2011 00:00 31.12.2013 00:00\n199.119.202.195 US 199.119.200.0/21 10.04.2011 00:00 03.07.2011 00:00\n208.87.242.66 US 208.87.240.0/22 16.03.2008 00:00 10.04.2011 00:00\n209.62.21.228 US 209.62.0.0/17 26.08.2007 00:00 16.03.2008 00:00\n83.149.75.58 NL 83.149.64.0/18 24.06.2007 00:00 26.08.2007 00:00\n69.25.212.153 US 69.25.208.0/20 24.03.2007 00:00 24.06.2007 00:00\n64.20.43.107 US 64.20.32.0/19 18.11.2006 00:00 24.03.2007 00:00\n207.189.104.87 US 207.189.96.0/19 12.08.2006 00:00 18.11.2006 00:00\n207.189.104.86 US 207.189.96.0/19 05.08.2006 00:00 12.08.2006 00:00\n207.189.104.87 US 207.189.96.0/19 08.07.2006 00:00 05.08.2006 00:00\n207.189.104.86 US 207.189.96.0/19 01.07.2006 00:00 08.07.2006 00:00\n207.189.104.87 US 207.189.96.0/19 17.06.2006 00:00 01.07.2006 00:00\n207.189.104.86 US 207.189.96.0/19 10.06.2006 00:00 17.06.2006 00:00\n207.189.104.87 US 207.189.96.0/19 06.05.2006 00:00 10.06.2006 00:00\n207.189.104.86 US 207.189.96.0/19 29.04.2006 00:00 06.05.2006 00:00\n207.189.104.87 US 207.189.96.0/19 18.03.2006 00:00 29.04.2006 00:00\n207.189.104.86 US 207.189.96.0/19 05.03.2006 00:00 18.03.2006 00:00\n207.189.104.87 US 207.189.96.0/19 25.02.2006 00:00 05.03.2006 00:00\n207.189.104.86 US 207.189.96.0/19 12.02.2006 00:00 25.02.2006 00:00\n207.189.104.87 US 207.189.96.0/19 27.11.2005 00:00 12.02.2006 00:00\n216.152.252.55 US 216.152.240.0/20 21.11.2004 00:00 27.11.2005 00:00\n\nFor horizons-tourisme.com:\n\nResolve Location Network First Last\n192.185.113.148 US 192.185.64.0/18 28.04.11 00:00 10.02.15 00:00\n184.172.143.188 US 184.172.128.0/18 23.12.06 00:00 28.04.11 00:00\n212.27.35.109 FR 212.27.32.0/19 02.08.05 00:00 23.12.06 00:00\n206.41.94.190 CA 206.41.94.0/24 24.06.05 00:00 02.08.05 00:00\n\n**page | 19**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/qog0dtpldhebhlasl12z3j82e0uv8t26",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.02.18.Shooting_Elephants/Elephantosis.pdf"
    ],
    "report_names": [
        "Elephantosis"
    ],
    "threat_actors": [
        {
            "id": "e09a7338-fb16-4e39-b579-c3bfc3140c47",
            "created_at": "2022-10-25T16:07:24.207294Z",
            "updated_at": "2025-03-27T02:02:10.140203Z",
            "deleted_at": null,
            "main_name": "Snowglobe",
            "aliases": [
                "ATK 8",
                "Animal Farm",
                "SIG20",
                "Snowglobe"
            ],
            "source_name": "ETDA:Snowglobe",
            "tools": [
                "Babar",
                "Casper",
                "Chocopop",
                "Dino",
                "EvilBunny",
                "Nbot",
                "TFC",
                "Tafacalou"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "548a4081-aa8f-4e2a-bcb3-0c9dfa61944f",
            "created_at": "2023-01-06T13:46:38.443779Z",
            "updated_at": "2025-03-27T02:00:02.835042Z",
            "deleted_at": null,
            "main_name": "SNOWGLOBE",
            "aliases": [
                "Snowglobe",
                "ATK8",
                "Animal Farm"
            ],
            "source_name": "MISPGALAXY:SNOWGLOBE",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041697,
    "ts_creation_date": 1424188930,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/c8f384ae75119626032d4b42f34e883269dbf2a4.pdf",
        "text": "https://archive.orkl.eu/c8f384ae75119626032d4b42f34e883269dbf2a4.txt",
        "img": "https://archive.orkl.eu/c8f384ae75119626032d4b42f34e883269dbf2a4.jpg"
    }
}