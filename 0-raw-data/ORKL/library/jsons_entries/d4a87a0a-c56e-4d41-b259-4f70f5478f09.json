{
    "id": "d4a87a0a-c56e-4d41-b259-4f70f5478f09",
    "created_at": "2023-01-12T15:05:38.431981Z",
    "updated_at": "2025-03-27T02:05:34.839208Z",
    "deleted_at": null,
    "sha1_hash": "e09272148c603131f340e42b59d211e938df898c",
    "title": "2014-08-04 - New Release- Decrypting NetWire C2 Traffic",
    "authors": "",
    "file_creation_date": "2022-05-28T19:32:19Z",
    "file_modification_date": "2022-05-28T19:32:19Z",
    "file_size": 120600,
    "plain_text": "# New Release: Decrypting NetWire C2 Traffic\n\n**[researchcenter.paloaltonetworks.com/2014/08/new-release-decrypting-netwire-c2-traffic/](http://researchcenter.paloaltonetworks.com/2014/08/new-release-decrypting-netwire-c2-traffic/)**\n\nPhil Da Silva, Rob Downs, Ryan Olson August 4, 2014\n\nBy [Phil Da Silva,](https://unit42.paloaltonetworks.com/author/phil-da-silva/) [Rob Downs and](https://unit42.paloaltonetworks.com/author/rob-downs/) [Ryan Olson](https://unit42.paloaltonetworks.com/author/ryan-olson/)\n\nAugust 4, 2014 at 9:05 AM\n\n[Category: Threat Advisories - Advisories,](https://unit42.paloaltonetworks.com/category/threat-briefs-assessments/threat-advisories-advisories/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [419 Scam,](https://unit42.paloaltonetworks.com/tag/419-scam/) [NetWire,](https://unit42.paloaltonetworks.com/tag/netwire/) [Research,](https://unit42.paloaltonetworks.com/tag/research/) [Tool,](https://unit42.paloaltonetworks.com/tag/tool/) [Unit 42](https://unit42.paloaltonetworks.com/tag/unit-42/)\n\nOn July 22, Palo Alto Networks threat intelligence team, Unit 42, released our first report on\n[the evolution of “Silver Spaniel” 419 scammers. Of particular note is how these actors use a](http://connect.paloaltonetworks.com/adversary-report)\nRemote Administration Tool (RAT) named NetWire (part of the NetWiredRC malware family).\nThis RAT gives a remote attacker complete control over a Windows, Mac OS X, or Linux\nsystem through a simple graphical user interface.\n\nTo better understand this RAT, our team reverse engineered the communication protocol that\n[NetWire uses. Today we have released a tool that decrypts NetWire traffic and outputs any](https://github.com/pan-unit42/public_tools/tree/master/netwire)\ncommands issued by the attacker.\n\n## NetWire Encrytion Protocol\n\nNetWire uses a custom, TCP-based protocol. The producer of the NetWire WorldWiredLabs,\nstates that the tool uses [256-bit AES encryption, which we found to be accurate. The tool](http://www.worldwiredlabs.com/netwire-features/security/)\ngenerates two encryption keys using a static password that the attacker chooses when\ncreating the NetWire binary. Each packet has the following structure:\n\n< 4 Byte Little-Endian length > < 1 Byte Command > < Data >\n\nThe shortest possible packet is the “HeartBeat” command, which NetWire generates every\n10 seconds.\n\n## Key Generation\n\nThe initial packet from the client to the server shows a data and command length of 65 bytes\n(0x41 listed at the beginning of the packet) with a command byte of 0x03\n\n\n-----\n\nWithin that data is a 32-byte seed value followed by a 16-byte initialization vector (IV) value.\nThe client then combines the 32-byte seed value with the static password in a predetermined\nfashion to form an AES key.\n\nUpon receiving the initial packet, the server uses the seed value and password to generate\nthe client’s session key. It then generates its own 32-byte seed value to create it’s own\nsession key and sends the seed value to the client. The client combines this with the\npassword and generates the same key. At this point, the key exchange is complete and both\nclient and server hold the same two keys, which they can use to encrypt and decrypt traffic.\n\nWith the two keys in place, the malware uses the AES algorithm to encrypt traffic using\nOutput Feedback (OFB) mode (Picture courtesy of Wikipedia). The output of the block\ncipher encryption is eXclusive OR’ed (XOR’d) with 16 bytes of ciphertext to decrypt. Each\nsubsequent block of ciphertext will use the previous encrypted data as the IV passed into the\nblock cipher encryption function.\n\n## Command Parsing\n\nThe malware has a full suite of possible commands, 76 to be exact. Upon receipt of a\ncommand from the server, a single function is called to decrypt the payload data and execute\nthe received instruction. The value in the command byte determines which of the commands\nis run through a 76 way switch statement. A complete list of the possible commands\n[available in NetWire was documented by CIRCL in April.](http://www.circl.lu/pub/tr-23/)\n\n\n-----\n\n## NetWire Decoder\n\nThe [NetWire decoder uses data from a packet capture file to generate the client and server](https://github.com/pan-unit42/public_tools/tree/master/netwire)\nsession keys then decode the remaining encrypted packets. The user needs to know the IP\nof the infected client, the port used by malware and the encryption password to properly\ndecode the traffic. This password is set to “Password” by default, but can be retrieved from\nNetWire binaries if the attacker used something more secure. The usage for the tool is show\nbelow.\n\nAt this time the tool works against the latest version of NetWire, 1.5c. We hope this tool will\nbe valuable to incident responders and others who are plagued by NetWire infections.\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-08-04 - New Release- Decrypting NetWire C2 Traffic.pdf"
    ],
    "report_names": [
        "2014-08-04 - New Release- Decrypting NetWire C2 Traffic.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535938,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1653766339,
    "ts_modification_date": 1653766339,
    "files": {
        "pdf": "https://archive.orkl.eu/e09272148c603131f340e42b59d211e938df898c.pdf",
        "text": "https://archive.orkl.eu/e09272148c603131f340e42b59d211e938df898c.txt",
        "img": "https://archive.orkl.eu/e09272148c603131f340e42b59d211e938df898c.jpg"
    }
}