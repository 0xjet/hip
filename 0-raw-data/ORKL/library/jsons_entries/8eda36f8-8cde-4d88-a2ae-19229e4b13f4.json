{
    "id": "8eda36f8-8cde-4d88-a2ae-19229e4b13f4",
    "created_at": "2023-01-12T15:07:24.181427Z",
    "updated_at": "2025-03-27T02:05:45.083193Z",
    "deleted_at": null,
    "sha1_hash": "e07e9652cb72b23a2e71deb782dd80dcc5387ff8",
    "title": "2022-04-06 - Windows MetaStealer Malware",
    "authors": "",
    "file_creation_date": "2022-07-02T23:16:14Z",
    "file_modification_date": "2022-07-02T23:16:14Z",
    "file_size": 3183943,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/rss/28522**\n\n## Windows MetaStealer Malware\n\n**Published: 2022-04-06**\n\n**Last Updated: 2022-04-06 03:50:00 UTC**\n\n**by** [Brad Duncan (Version: 1)](https://isc.sans.edu/handler_list.html#brad-duncan)\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/Windows+MetaStealer+Malware/28522/#comments)\n**_Introduction_**\n\nSince Wednesday 2022-03-30, at least 16 samples of a specific Excel file have been\nsubmitted to VirusTotal.\nThese malicious Excel files are distributed as email attachments.\nPost-infection traffic triggers signatures for Win32/MetaStealer Related Activity from\nthe EmergingThreats Pro (ETPRO) ruleset.\nThis infection process uses data binaries to create the malicious EXE and DLL files\nused for the infection.\nThe malware abuses legitimate services by Github and transfer.sh to host these data\nbinaries.\nAll URLs, domains, and IP addresses were still active for the infection approximately 3\nhours before I posted this diary.\n\n\n-----\n\n_Shown above: Flow chart for the MetaStealer infection chain reviewed in today's diary._\n\n**_Images from an infection_**\n\n_Shown above: Screenshot from an email distributing the malicious Excel file._\n\n\n-----\n\n_Shown above: Screenshot of the malicious Excel file._\n\n\n-----\n\n_Shown above: Traffic from an infection on Tuesday 2022-04-05 filtered in Wireshark._\n\n_Shown above: Alerts from the infection Security Onion using the Suricata and the ETPRO_\n_ruleset._\n\n\n-----\n\n_Shown above: UAC alert generated by malicious EXE during the infection._\n\n_Shown above: Malicious EXE file generated during the infection._\n\n\n-----\n\n_Shown above: Malicious EXE persistent on the infected Windows host._\n\n**_Indicators of Compromise (IOCs)_**\n\nTraffic generated after enabling Excel macro:\n\nhxxps://github[.]com/michel15P/1/raw/main/notice.zip\nhxxps://raw.githubusercontent[.]com/michel15P/1/main/notice.zip\nNote: File returned from the above URL is a data binary and not a zip archive\n\nTraffic generated by persistent EXE created from the above binary:\n\nport 80 - transfer[.]sh - GET /get/qT523D/Wlniornez_Dablvtrq.bmp\nport 443 hxxps://transfer[.]sh/get/qT523D/Wlniornez_Dablvtrq.bmp\n\n193.106.191[.]162 port 1775 - 193.106.191[.]162:1775 - GET\n/avast_update\n193.106.191[.]162 port 1775 - 193.106.191[.]162:1775 - GET\n/api/client/new\n\n\n-----\n\n193.106.191[.]162 port 1775 - 193.106.191[.]162:1775 - POST /tasks/get_worker\n\nAlerts on traffic to 193.106.191[.]162 over TCP port 1775:\n\nETPRO MALWARE Win32/MetaStealer Related Activity (GET) sid: 2851362\nETPRO MALWARE Win32/MetaStealer Related Activity (POST) sid: 2851363\n\nAssociated malware and artifacts:\n\nSHA256 hash:\n[981247f5f23421e9ed736dd462801919fea2b60594a6ca0b6400ded463723a5e](https://www.virustotal.com/gui/file/981247f5f23421e9ed736dd462801919fea2b60594a6ca0b6400ded463723a5e)\n\nFile size: 88,069 bytes\nFile name: transfer_info2460.xls\nFile description: Example of email attachment, an Excel file with macro for malware\n[Sandbox analysis: https://app.any.run/tasks/02a6b252-5ea1-4f2b-96d3-4eb2eaec34ca](https://app.any.run/tasks/02a6b252-5ea1-4f2b-96d3-4eb2eaec34ca)\n\n[SHA256 hash: 81e77fb911c38ae18c268178492224fab7855dd6f78728ffedfff6b62d1279dc](https://www.virustotal.com/gui/file/81e77fb911c38ae18c268178492224fab7855dd6f78728ffedfff6b62d1279dc)\n\nFile size: 2,828 bytes\nFile name: open.vbs\nFile location: same directory as the above Excel file or the user's AppData/Local/Temp\ndirectory\nFile description: After enabling macro, this VBS file is used to create the persistent EXE\nNote: I could not find this file on my infected lab host\n\nSHA256 hash:\n[8cfa23b5f47ee072d894ee98b1522e3b8acc84a6e9654b71f50536e74a3579a5](https://www.virustotal.com/gui/file/8cfa23b5f47ee072d894ee98b1522e3b8acc84a6e9654b71f50536e74a3579a5)\n\nFile size: 417,512 bytes\nFile location: hxxps://raw.githubusercontent[.]com/michel15P/1/main/notice.zip\nFile type: data\nFile description: data binary retrieved by open.vbs used to persistent EXE (below)\n\n[SHA256 hash: f644bef519fc0243633d13f18c97c96d76b95b6f2cbad2a2507fb8177b7e4d1d](https://www.virustotal.com/gui/file/f644bef519fc0243633d13f18c97c96d76b95b6f2cbad2a2507fb8177b7e4d1d)\n\nFile size: 367,001,600 bytes\nFile location: C:\\Users\\[username]\\AppData\\Local\\Temp\\notice.exe\nFile location: C:\\Users\\[username]\\AppData\\Roaming\\qwveqwveqw.exe\nFile description: Malware EXE persistent on the infected Windows host\nNote: This binary is appended with more than 366 MB of zero byte filler\nNote: Persistent through \"Shell\" value at HKCU\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\Winlogon\n\n\n-----\n\nSHA256 hash:\n[7641ae596b53c5de724101bd6df35c999c9616d93503bce0ffd30b1c0d041e3b](https://www.virustotal.com/gui/file/7641ae596b53c5de724101bd6df35c999c9616d93503bce0ffd30b1c0d041e3b)\n\nFile size: 143,400 bytes\nFile description: Persistent malware EXE with most of the zero byte filler removed\n\nSHA256 hash:\n[fba945b78715297f922b585445c74a4d7663ea2436b8c32bcb0f4e24324d3b8b](https://www.virustotal.com/gui/file/fba945b78715297f922b585445c74a4d7663ea2436b8c32bcb0f4e24324d3b8b)\n\nFile size: 716,288 bytes\nFile location: hxxps://transfer[.]sh/get/qT523D/Wlniornez_Dablvtrq.bmp\nFile type: data\nFile description: Retrieved by persistent EXE, this binary is a Windows DLL file in\nreverse byte order\n\n[SHA256 hash: bf3b78329eccd049e04e248dd82417ce9a2bcaca021cda858affd04e513abe87](https://www.virustotal.com/gui/file/bf3b78329eccd049e04e248dd82417ce9a2bcaca021cda858affd04e513abe87)\n\nFile size: 716,288 bytes\nFile description: Windows DLL file created by reserving the above binary\nFile type: PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS\nWindows\nRun method: loaded/run by persistent EXE\n\nSHA256 hash:\n[cb6254808d1685977499a75ed2c0f18b44d15720c480fb407035f3804016ed89](https://www.virustotal.com/gui/file/cb6254808d1685977499a75ed2c0f18b44d15720c480fb407035f3804016ed89)\n\nFile size: 2,182,488 bytes\nFile location: hxxp://193.106.191[.]162:1775/avast_update\nFile description: base64 text representing a Windows DLL file\n\nSHA256 hash:\n[71e54b829631b93adc102824a4d3f99c804581ead8058b684df25f1c9039b738](https://www.virustotal.com/gui/file/71e54b829631b93adc102824a4d3f99c804581ead8058b684df25f1c9039b738)\n\nFile size: 1,636,864 bytes\nFile description: Windows DLL file converted from the above text\nFile type: PE32 executable (DLL) (console) Intel 80386, for MS Windows\nRun method: unknown, loaded/run by persistent EXE or previous DLL loaded/run by\npersistent EXE\n\n**_Final words_**\n\nEach time I rebooted my infected Windows host, the persistent EXE generated traffic to the\nsame transfer.sh URL and re-started the infection process without the Github traffic.\n\n\n-----\n\nMalware associated with this infection was first submitted to VT on Wednesday 2022-03-30.\nETPRO signatures identifying HTTP traffic generated by this malware as MetaStealer were\nreleased on Friday 2022-04-01.\n\nMy thanks to [Security Onion, Proofpoint's EmergingThreats team, and](https://securityonionsolutions.com/) Didier Stevens' tools\nfor reversing binaries. These three resources were a big help in my analysis for this diary.\n\n[A pcap of the infection traffic and the associated malware/artifacts can be found here.](https://www.malware-traffic-analysis.net/2022/04/06/index.html)\n\n--\nBrad Duncan\n\nbrad [at] malware-traffic-analysis.net\n\n[Keywords: DLL](https://isc.sans.edu/tag.html?tag=DLL) [Excel](https://isc.sans.edu/tag.html?tag=Excel) [EXE](https://isc.sans.edu/tag.html?tag=EXE) [Malspam](https://isc.sans.edu/tag.html?tag=Malspam) [Malware](https://isc.sans.edu/tag.html?tag=Malware) [MetaStealer](https://isc.sans.edu/tag.html?tag=MetaStealer) [Windows](https://isc.sans.edu/tag.html?tag=Windows)\n[0 comment(s)](https://isc.sans.edu/forums/diary/Windows+MetaStealer+Malware/28522/)\n\nJoin us at SANS! Attend [with Brad Duncan in starting](https://isc.sans.edu/diary/rss/28522)\n\nTop of page\n√ó\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-06 - Windows MetaStealer Malware.pdf"
    ],
    "report_names": [
        "2022-04-06 - Windows MetaStealer Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536044,
    "ts_updated_at": 1743041145,
    "ts_creation_date": 1656803774,
    "ts_modification_date": 1656803774,
    "files": {
        "pdf": "https://archive.orkl.eu/e07e9652cb72b23a2e71deb782dd80dcc5387ff8.pdf",
        "text": "https://archive.orkl.eu/e07e9652cb72b23a2e71deb782dd80dcc5387ff8.txt",
        "img": "https://archive.orkl.eu/e07e9652cb72b23a2e71deb782dd80dcc5387ff8.jpg"
    }
}