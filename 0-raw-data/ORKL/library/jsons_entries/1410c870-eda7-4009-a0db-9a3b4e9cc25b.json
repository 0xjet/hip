{
    "id": "1410c870-eda7-4009-a0db-9a3b4e9cc25b",
    "created_at": "2023-01-12T15:07:48.752438Z",
    "updated_at": "2025-03-27T02:06:13.492307Z",
    "deleted_at": null,
    "sha1_hash": "3750e7313592535f19d7b676f196d588c68c44ab",
    "title": "2018-02-07 - Threat Spotlight- URSNIF Infostealer Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T21:55:52Z",
    "file_modification_date": "2022-05-28T21:55:52Z",
    "file_size": 155983,
    "plain_text": "# Threat Spotlight: URSNIF Infostealer Malware\n\n**cylance.com/en_us/blog/threat-spotlight-ursnif-infostealer-malware.html**\n\nThe BlackBerry Cylance Threat Research Team\n\n[RESEARCH & INTELLIGENCE / 02.07.18 /](https://www.cylance.com/en/category/research-and-intelligence) [The BlackBerry Cylance Threat Research Team](https://www.cylance.com/en/author/the-cylance-threat-research-team)\n_Research by Yasmine Ison of the Cylance Threat Guidance Team_\n\nURSNIF (Gozi) is a multifaceted malware family with an emphasis on information stealing that has been leveraged to exfiltrate sensitive data\nfrom targets, and has been particularly pervasive throughout 2016 and 2017. Since 2007, variants of the malware have been detected in\nEurope, Japan, and Australia, with more recent outbreaks in the US and UK.\n\nThe malware is most often used to target banks, but has also been used to attack email, cloud, commercial, and cryptocurrency trading\nwebsites, and is typically propagated by way of phishing campaigns utilizing tainted email attachments. Based on memory analysis, the\nmalware also appears to have the capability to spread to external USB devices and hard drives.\n\nWhen an URSNIF infection is successful, it will fingerprint the system, monitor web browser traffic, and then send all the data out to the\ncommand and control (C&C) server. The server then will drop second stage malware based on the information that tailored the targeted\nsystem.\n\n## File Information  \n\n**SHA256: 3E840F21F0EAE2F688BA9E8204AEC22985CC69757B928202A8ADEF0885404EA2**\n\n**Type: Win32 EXE**\n\n**Size: 233472 bytes**\n\n**Timestamp: Tue Nov 28, 10:28:50 2017**\n\n**ITW Names: avicbrkr.exe, adprtext.exe, catsobby.exe, cmdlnsta.exe**\n\n## Technical Analysis\n\nThe payload is packed with a Delphi overlay, making it a little harder to disassemble and analyze on a binary level. With that being said,\nmemory analysis was also used to complete this analysis along with some disassembly. The file analyzed in the paper needs to run in\nWindows 7, 32-bit or later, unlike previous versions of URSNIF that were able to run on systems as early as Windows XP.\n\nThere, malware authors employ a check in the binary for the file C:\\%filename%.txt – if it exists, checks for a virtualized environment are\nignored. When the file is executed in a Virtual Machine (VM), it fingerprints the machine and later sends the information in a POST.\n\nThe file then creates two registry keys for persistence before calling out (Ref IoC Registry Keys). This version of URSNIF also has API hooks,\nwhich have been seen in other versions, that give the file the capability to collect email credentials, webcam footage, image files, audio files,\nand screen captures (Figure 1).\n\n_Figure 1: Known hooked API calls_\n\nURSNIF is known for hooking various executable files in order to monitor browsers. This version hooks WS2_32.DLL and KERNEL32.DLL\nand CHROME.DLL to monitor Google Chrome, NSS3.DLL and NSPR4.DLL to monitor Mozilla Firefox, and WININET.DLL to monitor Internet\nExplorer. Even though it was run on a Windows machine, it can also monitor Opera, as references in the code suggests it hooks to\nOpera.exe.\n\n\n-----\n\ne e test to see t s co ected to t e te et us g co a d p o pt a d s oo up, a d t a so use co a d to spa a sub\nprocess of itself (%AppData%\\Microsoft\\%randomfile%\\%randomfile%). The sub process creates a bat file that will later check for secondary\nmalware (%LocalAppData%\\Temp\\%randomfolder%\\%random%.bat) (Figure 2).\n\n_Figure 2: Temp file created._\n\nIf the test works, the file will inject code into a running process (explorer.exe) to send a POST to the C&C server, and hide while continuing to\nrun. The URL will contain \"/data.php?version=% &user=%&server=% &id=% &type=% &name=%\", replacing this temp data with the victim\nmachine information (Ref IoC Network).\n\nThen the URL data is XOR’ed and base64 encoded (with padding removed \"=\") and passed as part of the URL which is meant to look like an\nordinary image file (jpeg) (Figure 3). After that it will add \"/\" at random offsets of the string and change every unique letter which doesn’t\nmatch [a-zA-Z0-9] to its hexadecimal format starting with \"_\".\n\nThe last step, adding the \"/\" slash character at random offsets. The result will look something like this:\n\nLUk2l6EnlB57pGW/_2BdI_2Bw_2FMaug0Z/ZXD_2Fip0/epva0VXtqAj_2FEqP_2B/k2U5Gx_2BJhQW_2B_2B/II3nn6TLQFnbVVfZUpPCFz/FM_2F\n\n_Figure 3: Injected data into Explorer.exe_\n\nThe file has the capability to use DGA (domain name generator algorithm) to make a small list of malicious domains. It employs the open-topdomains algorithm and gathers a few DNS domains from OpenDNS, which is also sometimes seen in in the DreamBot variant of URSNIF.\n\nThe open-top-domains algorithm is possibly a backup feature because a known flaw in the code doesn’t allocate enough space to correctly\nconstruct URLs from a word list. However, this specific sample uses hardcoded network indicators, which can be seen in the network traffic\n(Ref IoC Network).\n\nWhen the file calls out to them, it will attempt to download secondary/tertiary stage malware and store in the %temp% directory. A temporary\nfolder and file, or sometimes just a file, will be created.\n\nThe file will check to see if the secondary/tertiary stage malware file was downloaded. If it is not, it will delete the temp file. If it is downloaded,\nthe bat file will delete the original malware file.\n\n## Conclusion:\n\nBased on recent activity, URSNIF (Gozi) attacks are likely to remain a prevalent threat to high value targets, and organizations who fit the\nvictim profile should exercise diligence in not only basic security hygiene but also in phishing awareness education for staff and others who\nhave access to critical operations systems.\n\n[If you are a Cylance customer using CylancePROTECT®, you were already protected from this attack.](http://cylance.com/en_us/products/our-products/protect.html?utm_medium=Blog)\n\n## IOCs\n\n**•  Files/Folders:**\n\n◦ %AppData%\\Microsoft\\Cmipprop\\catsobby.exe\n◦ %LocalAppData%\\Temp\\4B78\\2F91.bat\n\n**•  Registry Keys:**\n\n◦ HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n◦ HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\n\n**•  SHA-256:**\n\n◦ 3E840F21F0EAE2F688BA9E8204AEC22985CC69757B928202A8ADEF0885404EA2\n\n- Network:\n\n◦ http|://|constitution|.|org/usdeclar.txt\n◦ myip|.|opendns|.|com\n◦ resolver1|.|opendns|.|com\n◦ curlmyip|.|net\n\n**◦ GET REQUEST:**\nadvisevisa|.|com/wp-content/themes/porto/css/a|.|zip\n\nli i i | | / t t/th /k i /f t /b| |bi\n\n\n-----\n\na a dbo a| | / p co te t/t e es/apoa/ ages/a| | p\nbaharguzellik|.|com/assets/lib/gui/a|.|bin\nfarimon|.|at/jvassets/lg/fsdmkuir_xx|.|rar\nfarimon|.|at/jvassets/lg/xclek4f|.|zip\n\n**◦ POST:**\ndeepmoler|.|cn/infolot\nfarimon|.|at/infolot\narimon|.|at/infolot\numbrapo|.|su/infolot\nwlanoer|.|su/infolot\nenzenco|.|at/infolot\nfjroom|.|su/infolot\nfvnoop|.|at/infolot\nglencon|.|at/infolot\ngolangland|.|cn/infolot\nhheepet|.|at/infolot\n\n**◦ TOR Traffic**\njesteoq7glp3cpkf|.|onion/infolot\npzgxy5elkuywloqc|.|onion/infolot\nq7nxkpgras35dwxk|.|onion/infolot\nrbhqdxwdwrlp67g6|.|onion/infolot\n\n**References:**\n\nhttps://securityintelligence.com/ursnif-campaign-waves-breaking-on-japanese-shores/\n\n**About the Cylance Threat Guidance Team**\n\n_The Cylance Threat Guidance team examines malware and suspected malware to better identify its abilities, function and attack vectors._\n_Threat Guidance is on the frontline of information security and often deeply examines malicious software, which puts them in a unique_\n_position to discuss never-seen-before threats._\n\nThe BlackBerry Cylance Threat Research Team\n\n## About The BlackBerry Cylance Threat Research Team\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware to better identify its abilities, function and attack\nvectors. Threat Research is on the frontline of information security and often deeply examines malicious software, which puts us in a unique\nposition to discuss never-seen-before threats.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-02-07 - Threat Spotlight- URSNIF Infostealer Malware.pdf"
    ],
    "report_names": [
        "2018-02-07 - Threat Spotlight- URSNIF Infostealer Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536068,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653774952,
    "ts_modification_date": 1653774952,
    "files": {
        "pdf": "https://archive.orkl.eu/3750e7313592535f19d7b676f196d588c68c44ab.pdf",
        "text": "https://archive.orkl.eu/3750e7313592535f19d7b676f196d588c68c44ab.txt",
        "img": "https://archive.orkl.eu/3750e7313592535f19d7b676f196d588c68c44ab.jpg"
    }
}