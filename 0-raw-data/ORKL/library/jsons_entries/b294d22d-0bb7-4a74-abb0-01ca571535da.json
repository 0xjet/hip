{
    "id": "b294d22d-0bb7-4a74-abb0-01ca571535da",
    "created_at": "2023-01-12T15:08:51.990519Z",
    "updated_at": "2025-03-27T02:08:40.733881Z",
    "deleted_at": null,
    "sha1_hash": "b9d9c9d7f95df6a30362597a7518728d7f21cb1b",
    "title": "2020-09-24 - Email-delivered MoDi RAT attack pastes PowerShell commands",
    "authors": "",
    "file_creation_date": "2022-05-28T19:46:52Z",
    "file_modification_date": "2022-05-28T19:46:52Z",
    "file_size": 774162,
    "plain_text": "# Email-delivered MoDi RAT attack pastes PowerShell commands\n\n**[news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/](https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/)**\n\nSeptember 24, 2020\n\nSophosLabs researchers Fraser Howard and Andrew O’Donnell stumbled upon an unusual\n_reflective loader attack method last month while hunting through threat telemetry. The attack_\nchain started with a malicious email message that contained some hostile VB scripting code,\nand concluded by delivering a commodity remote access Trojan named MoDi RAT.\n\nThese kinds of detections often lead to interesting, divergent attacks, which is what the\ndetection teams are looking for. Diving down the rabbit hole, Howard and O’Donnell\ndiscovered a few intriguing twists to the convoluted attack, which included a Scheduled Task\nthat started a Visual Basic Script file that, in turn, launches PowerShell and then literally\n_pasted the text of the commands into the PowerShell window, rather than passing the_\ncommand string as a parameter.\n\nBut let’s not get ahead of ourselves. Here is Howard’s root cause analysis (RCA) of the\nattack chain.\n\n**AMSI vs. MoDi RAT**\n\nThe attack analysis pivoted on some of the data collected from Sophos endpoint products\nusing Microsoft’s [Antimalware Scan Interface (AMSI). The root cause of the attack triggered](https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal)\nour telemetry: a malicious script, delivered (most likely) via spam. In the example below, the\nuser’s browser (Edge, highlighted in red below) started the attack chain, which you can see\nin this snippet of the threat case.\n\n\n-----\n\nThe attack begins when a recipient of the malspam opens the message attachment. The\nVisual Basic Script in the message attachment connects to a remote site, which is the entry\npoint into a series of HTTP 302 redirects that eventually lead to a .Zip archive, hosted in\nOneDrive cloud storage, that contains an encoded VBS (VBE) file.\n\nWith the VBE file in hand, we set about reproducing the entire attack to get a complete\npicture, right through to the payload.\n\nThe initial VBScript writes out a second VBS file to the filesystem, and inserts three new\nentries into the Windows Registry that contain binary data, written out as 8-digit binary\nnumbers. It then launches a system utility to create a new Scheduled Task that, at a\npredetermined time in the future, launches the VBS script.\n\n\n-----\n\nWhen the Scheduled Task runs, it uses wscript.exe to launch the VBS. The VBS code\nlaunches PowerShell and then runs this code, which takes data from the VBS and inserts it\ninto the system’s clipboard, where it can then programmatically “paste” the commands into\nthe PowerShell window using the VBS SendKeys command.\n\nThis neat little trick to deliver the powershell commands seems designed to evade detection\nby keeping the commands they execute under the radar, rather than attracting attention by\nspawning an instance of PowerShell with some interesting command-line parameters that\nmight trigger all sorts of security product alerts. From this point on, the attack is fileless.\n\nIn the next step, PowerShell extracts a .NET decoder executable from one of the Registry\nblobs (labeled Entreur in the Registry) that the VBE had created earlier, and reflectively\nloads it by injecting it into a system process.\n\n\n-----\n\nThe decoder executable, in turn, extracts the .NET injector and payload blobs (labeled in the\nRegistry as inj and Myfile, respectively) from the Registry. Then the injector loads the\npayload (injecting into the host application, msbuild.exe).\n\nNotably, the initial Zip payload name (“Timbres-electroniques”) and several other strings,\nincluding the Entreur Registry key were comprised of words from the French language.\nSome of the targets of these attacks were French firms.\n\nThe diagram below summarizes all this and illustrates the key components of the attack\nchain.\n\n\n-----\n\nThe three .NET executable layers (decoder, injector, and payload) do not touch the disk, but\nwe proactively blocked the attack based on our recognition of the technique the attackers\nemploy to deliver the payload filelessly.\n\nDespite already proactively blocking this attack, as a result of our further investigation we\nwere able to enhance existing detections to provide additional resilience against similar\nattacks we might see in the future.\n\n## Why you should upgrade from older Windows\n\nMicrosoft’s [AMSI framework that](https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal) [helps us intercept and neutralize these kinds of attacks is](https://support.sophos.com/support/s/article/KB-000039096?language=en_US)\nonly available on certain recent flavors of Windows (Windows 10, Windows Server 2016 and\nWindows Server 2019). If there’s one single reason why users of older versions of Windows\nshould upgrade, it’s this: AMSI protection is crucial to helping us defend against many of\ntoday’s attacks, particularly those that use fileless techniques.\n\nThis attack typifies how most of the fileless attacks that we see work. AMSI provides the\ncapability for Sophos to proactively protect customers against a range of similar attacks, and\nthe telemetry we’re able to get lets us dive into these rabbit holes so we can identify and\nenhance our protections more effectively.\n\nSophos endpoint products will detect the components of this attack as AMSI/Reflect-D,\n**Troj/VBSInj-D, and AMSI/ModiRat-A.**\n\n## Indicators of compromise\n\n[IoCs relating to this investigation have been posted to the SophosLabs Github.](https://github.com/sophoslabs/IoCs/blob/master/MoDi-RAT-reflective-injection.csv)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-24 - Email-delivered MoDi RAT attack pastes PowerShell commands.pdf"
    ],
    "report_names": [
        "2020-09-24 - Email-delivered MoDi RAT attack pastes PowerShell commands.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536131,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653767212,
    "ts_modification_date": 1653767212,
    "files": {
        "pdf": "https://archive.orkl.eu/b9d9c9d7f95df6a30362597a7518728d7f21cb1b.pdf",
        "text": "https://archive.orkl.eu/b9d9c9d7f95df6a30362597a7518728d7f21cb1b.txt",
        "img": "https://archive.orkl.eu/b9d9c9d7f95df6a30362597a7518728d7f21cb1b.jpg"
    }
}