{
    "id": "5a2ff7bf-6a40-4849-a75e-ac07164410ac",
    "created_at": "2023-01-12T15:06:27.643194Z",
    "updated_at": "2025-03-27T02:16:25.829732Z",
    "deleted_at": null,
    "sha1_hash": "24628fb853b00862307dd4877423d68cd08ab7a8",
    "title": "2017-05-05 - loki-parse",
    "authors": "",
    "file_creation_date": "2022-05-28T17:50:03Z",
    "file_modification_date": "2022-05-28T17:50:03Z",
    "file_size": 110233,
    "plain_text": "# R3MRUM/loki-parse: A python script that can detect and parse loki-bot (malware) related network traffic. This script can be helpful to DFIR analysts and security researchers who want to know what data is being exfiltrated to the C2, bot tracking, etc...\n\n**github.com/R3MRUM/loki-parse**\n\nR3MRUM\n\n## loki-parse\n\nA python script that can detect and parse loki-bot (malware) related network traffic between a\ncompromised host and a C2 server. This script can be helpful to DFIR analysts and security\nresearchers who want to know what data is being exfiltrated to the C2, bot tracking, etc...\n\nThis script can either sniff the wire directly (no switch) or read in a PCAP of network traffic\n(using --pcap $pcap_file) . When the script detects loki-bot related network traffic, it will dump\nout the data contained within the packets out to the screen in JSON format.\n\nSome of the packets contain data being exfiltrated that is compressed with aPLib. The script\nwill decompress that data and display it to your screen but know that there is additional\nprocessing that has not been incorporated into this script...YET. This being said, it is\n**important that you also download the aplib.py script and keep it in the same directory**\n**as loki-parse.py. This script is required in order for loki-parse to execute successfully.**\n\n\n-----\n\nFinally, there is an issue with the code used for sniffing network traffic where the data portion\nof the packet can get chopped off. It appears to be related to how scapy parses the traffic.\nThis will likely happen with larger packets that have compressed data. If this happens, the\nfollowing dictionary key will be created:\n\n**Decompressed Application/Credential Data': 'ERROR: Incomplete Packet Detected**\n\nThis issue does not seem to occur within saved PCAPs so, if you receive this error, try\nsaving the network traffic into a pcap file and rerunning loki-parse on the pcap.\n\nIf the script is able to successfully decompress the data within the packet, this data is simply\ndumped to the screen (not in JSON format). I plan to address this in later versions.\n\nI've provided loki-bot_network_traffic.pcap as an example pcap for you to play with.\n\n## Example Output\n\n**$ sudo ./loki_parse.py**\n\nSniffing PCAPS from the wire\n\n\n-----\n\n```\n{\n  \"Compromised Host/User Data\": {\n    \"Compressed Application/Credential Data Size (Bytes)\": 2310, \n    \"Compression Type\": 0, \n    \"Data Compressed\": true, \n    \"Encoded\": false, \n    \"Encoding\": 0, \n    \"Original Application/Credential Data Size (Bytes)\": 8545\n  }, \n  \"Compromised Host/User Description\": {\n    \"64bit OS\": false, \n    \"Built-In Admin\": true, \n    \"Domain Hostname\": \"REMWorkstation\", \n    \"Hostname\": \"REMWORKSTATION\", \n    \"Local Admin\": true, \n    \"Operating System\": \"Windows 8.1 Workstation\", \n    \"Screen Resolution\": \"3440x1440\", \n    \"User Name\": \"REM\"\n  }, \n  \"Malware Artifacts/IOCs\": {\n    \"Binary ID\": \"XXXXX11111\", \n    \"Loki-Bot Version\": 1.8, \n    \"Mutex\": \"B7E1C2CC98066B250DDB2123\", \n    \"Potential Hidden File [Hash Database]\": \"%APPDATA%\\\\C98066\\\\6B250D.hdb\", \n    \"Potential Hidden File [Keylogger Database]\":\n\"%APPDATA%\\\\C98066\\\\6B250D.kdb\", \n    \"Potential Hidden File [Lock File]\": \"%APPDATA%\\\\C98066\\\\6B250D.lck\", \n    \"Potential Hidden File [Malware Exe]\": \"%APPDATA%\\\\C98066\\\\6B250D.exe\", \n    \"Unique Key\": \"g5cy2\", \n    \"User-Agent String\": \"Mozilla/4.08 (Charon; Inferno)\"\n  }, \n  \"Network\": {\n    \"Data Transmission Time\": \"2017-04-27T15:03:20.921806\", \n    \"Destination Host\": \"185.141.27.187\", \n    \"Destination IP\": \"185.141.27.187\", \n    \"Destination Port\": 80, \n    \"First Transmission\": true, \n    \"HTTP Method\": \"POST\", \n    \"HTTP URI\": \"/danielsden/ver.php\", \n    \"Source IP\": \"172.16.0.130\", \n    \"Source Port\": 49344, \n    \"Traffic Purpose\": \"Exfiltrate Application/Credential Data\"\n  }\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-05 - loki-parse.pdf"
    ],
    "report_names": [
        "2017-05-05 - loki-parse.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535987,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653760203,
    "ts_modification_date": 1653760203,
    "files": {
        "pdf": "https://archive.orkl.eu/24628fb853b00862307dd4877423d68cd08ab7a8.pdf",
        "text": "https://archive.orkl.eu/24628fb853b00862307dd4877423d68cd08ab7a8.txt",
        "img": "https://archive.orkl.eu/24628fb853b00862307dd4877423d68cd08ab7a8.jpg"
    }
}