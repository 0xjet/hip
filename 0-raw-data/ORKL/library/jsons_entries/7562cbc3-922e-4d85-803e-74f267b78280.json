{
    "id": "7562cbc3-922e-4d85-803e-74f267b78280",
    "created_at": "2023-05-06T02:09:10.415173Z",
    "updated_at": "2025-03-27T02:09:29.933738Z",
    "deleted_at": null,
    "sha1_hash": "6c4d9d9d7d3d117fa57fa0186320ca02a91dc6f2",
    "title": "2023-03-30 - 3CX VoIP Software Compromise & Supply Chain Threats",
    "authors": "",
    "file_creation_date": "2023-05-05T01:44:22Z",
    "file_modification_date": "2023-05-05T01:44:22Z",
    "file_size": 5873757,
    "plain_text": "# 3CX VoIP Software Compromise & Supply Chain Threats\n\n**[huntress.com/blog/3cx-voip-software-compromise-supply-chain-threats](https://www.huntress.com/blog/3cx-voip-software-compromise-supply-chain-threats)**\n\nThe 3CX VoIP Desktop Application has been compromised to deliver malware via legitimate\n3CX updates. Huntress has been investigating this incident and working to validate and\nassess the current supply chain threat to the security community.\n\nUPDATE #1 - 3/30/23 @ 2pm ET: Added a [PowerShell script that can be used to check](https://github.com/huntresslabs/threat-intel/blob/main/2023/2023-03/30-3CX/tools/Check-3cxVulnerability.ps1)\nlocations/versions of 3CX and run against the hashes to see if they're bad to be run in an\nRMM.\n\nAt 11:40 AM EDT on March 29, 2023, Huntress received an inbound support request from a\n[partner, concerned with a new advisory and discussion on Reddit shared just 30 minutes](https://www.reddit.com/r/crowdstrike/comments/125r3uu/20230329_situational_awareness_crowdstrike/)\nprior. CrowdStrike was first to sound the alarm on a breaking incident: 3CX VoIP software\ninstallations were compromised, delivering malware to hosts running the 3CX desktop app.\n\nHuntress immediately added increased monitoring for malicious activity related to the 3CX\napplication, while working to validate this attack vector so that we could provide as much\ninformation as possible to the community.\n\nFrom 3CX’s [recently released notification, the currently known affected 3CX DesktopApp](https://www.3cx.com/blog/news/desktopapp-security-alert/)\nversions are 18.12.407 and 18.12.416 for Windows and 18.11.1213, 18.12.402,\n```\n18.12.407 and 18.12.416 for Mac.\n\n## Impact\n\n```\nAt the time of writing, [Shodan reports there are 242,519 publicly exposed 3CX phone](https://www.shodan.io/search?query=http.title%3A%223CX+Phone+System+Management+Console%22)\nmanagement systems.\n\n\n-----\n\n3CX claims to have over 600,000 customers, and it goes without saying, this has the\n[potential to be a massive supply chain attack, likened well enough to the SolarWinds incident](https://www.huntress.com/blog/rapid-response-supply-chain-exploitation-of-solarwinds-orion-software)\nor the [Kaseya VSA ransomware attack in years past.](https://www.huntress.com/blog/rapid-response-kaseya-vsa-mass-msp-ransomware-incident)\n\nWithin our partner base, Huntress has sent out 2,783 incident reports where the\n3CXDesktopApp.exe binary matches known malicious hashes and was signed by 3CX on\nMarch 13, 2023. We currently have a pool of ~8,000 hosts running 3CX software.\n\nWhile Huntress has notified appropriate partners, we decided not to automatically isolate\n3CX hosts, in the event it could result in taking phone communication systems offline. We\nstrongly urge you to remove the software if at all possible, as 3CX has promised a nonmalicious update in the near future.\n\n## Analysis & Investigation\n\nOn March 29, numerous EDR providers and antivirus solutions began to trigger and flag on\nthe legitimate signed binary 3CXDesktopApp.exe. This application had begun an update\nprocess that ultimately led to malicious behavior and command-and-control communication\nto numerous external servers.\n\nUnfortunately in the early timeline of the community's investigation, there was confusion on\nwhether or not this was a legitimate antivirus alert.\n\n\n-----\n\nThe 3CX download available on the official public website had included malware.\nInstallations already deployed will update, and ultimately pull down this malware that\n[includes a backdoored DLL file, ffmpeg.dll and an anomalous d3dcompiler_47.dll.](https://www.virustotal.com/gui/file/7986bbaee8940da11ce089383521ab420c443ab7b15ed42aed91fd31ce833896)\n\nFor an overall visual of the attack chain, take a quick look at this primitive graph.\n\n\n-----\n\n_[Massive kudos to our security researcher and resident binary ninja Matthew Brennan for this](https://twitter.com/embee_research)_\n_deep-dive!_\n\nThis backdoored ffmpeg.dll primarily acts as loader for the d3dcompiler_47.dll file.\n\n\n-----\n\nRight from the DLL entrypoint, it eventually enters a new function (that we have renamed\nmw_main_function for our reverse engineering purposes) -\nThat creates a new event AVMonitorRefreshEvent, resolves the current file path, and looks\nfor the subsequent d3dcompiler_47.dll file to load into memory.\n\n\n-----\n\nFrom our analysis, we see d3dcompiler_47.dll is signed by Microsoft, but contains an\nembedded secondary encrypted payload. This payload is denoted by a specific byte marker,\nFE ED FA CE, [as others have also observed.](https://twitter.com/dez_/status/1641204732445478912)\n\n\n-----\n\nAfter retrieving d3dcompiler_47.dll, the ffmpeg.dll binary locates and unravels this secondary\npayload by decrypting an RC4 stream with the key 3jB(2bsG#@c7. According to other threat\nintelligence, this static key is known to be attributed to DPRK threat actors.\n\nFollowing calls to VirtualProtect to prepare this payload, we could extract the decrypted\nshellcode for further examination.\n\n\n-----\n\nDigging further within GHIDRA, x64dbg and other analysis tools, we discovered there is yet\nanother DLL file embedded within the shellcode. It appears this shellcode is just another PE\nloader.\n\nOne very important note regarding this shellcode-embedded PE file: it would sleep for 7 days\nand wait to call out to external C2 servers. The 7-day delay is peculiar, as you may not have\nseen further indicators immediately... and it may explain why some users have not yet seen\nmalicious activity. (Perhaps an interesting observation considering these new malicious 3CX\nupdates were first seen on March 22, and the industry caught wind of this malicious activity\non March 29)\n\nThis final PE file ultimately reaches out to a Github repository and raw file contents:\n```\nhttps://raw[.]githubusercontent[.]com/IconStorages/images/main/icon%d.ico\n\n```\n\n-----\n\nThis Github repository, https[:]//github[.]com/IconStorages/images, stored 16 separate .ICO\nicon files.\n\nEach one was in fact a valid icon file, however, at the very end of each file was a Base64\nencoded string.\n\nAttempting to decode these Base64 strings, they were -- as we might expect -- seemingly\nmore encrypted data.\n\n\n-----\n\nIn between the internet HTTP requests to Github, we observed decryption routines. These\nhelped clue in how we could decrypt what looked to be AES encrypted data -- ultimately\nunraveling to these plaintext strings and URLs referenced at the end of each .ICO file:\n```\nhttps[:]//www[.]3cx[.]com/blog/event-trainings/\nhttps[:]//akamaitechcloudservices[.]com/v2/storage\nhttps[:]//akamaitechcloudservices[.]com/v2/storage\nhttps[:]//azureonlinestorage[.]com/azure/storage\nhttps[:]//msedgepackageinfo[.]com/microsoft-edge\nhttps[:]//glcloudservice[.]com/v1/console\nhttps[:]//pbxsources[.]com/exchange\nhttps[:]//msstorageazure[.]com/window\nhttps[:]//officestoragebox[.]com/api/session\nhttps[:]//visualstudiofactory[.]com/workload\nhttps[:]//azuredeploystore[.]com/cloud/services\nhttps[:]//msstorageboxes[.]com/office\nhttps[:]//officeaddons[.]com/technologies\nhttps[:]//sourceslabs[.]com/downloads\nhttps[:]//zacharryblogs[.]com/feed\nhttps[:]//pbxcloudeservices[.]com/phonesystem\nhttps[:]//pbxphonenetwork[.]com/voip\nhttps[:]//msedgeupdate[.]net/Windows\n\n```\nThese URLs match the same handful of domain IOCs shared by others. The final payload\nwould randomly choose which icon number, and ultimately decrypted URL, to be selected as\nthe external C2 server.\n\n\n-----\n\nInterestingly enough, the very first .ICO file, icon0.ico had pointed to\nhttps[:]//www[.]3cx[.]com/blog/event-trainings/ ... however trawling through the past commits\nof the IconStorage Github repository, it originally referenced\nhttps[:]//msedgeupdate[.]net/Windows\n\nThe https[:]//github[.]com/IconStorages/images repository hosting these C2 server endpoints\n[has been taken offline. While this may hinder the execution of hosts updating to the current](https://twitter.com/_JohnHammond/status/1641270384023719937)\nmalicious version of 3CX, the real impact is unknown at this time. It is not yet clear whether\nor not adversaries still have access to the 3CX supply chain in order to poison future updates\n\n- perhaps this may change the tradecraft we see in the coming days.\n\nRight now I see the github[.]com/IconStorages/images repository included in the 3CX\nsupply chain attack has now been taken down.\n\nI reported the user to Github earlier today. [pic.twitter.com/ltWen5TnLo](https://t.co/ltWen5TnLo)\n\n[— John Hammond (@_JohnHammond) March 30, 2023](https://twitter.com/_JohnHammond/status/1641270384023719937?ref_src=twsrc%5Etfw)\n\nWe have not yet seen any sample network data communicating with these C2 URLs for us to\nanalyze.\n\n## Detection Efforts\n\n[UPDATE 3/30/23 @ 2pm ET: Our team has created a PowerShell script that can be used to](https://github.com/huntresslabs/threat-intel/blob/main/2023/2023-03/30-3CX/tools/Check-3cxVulnerability.ps1)\ncheck locations/versions of 3CX to run against the hashes and see if they're bad to be run in\nan RMM.\n\nWindows Defender is currently detecting this attack chain with the threat name\n[Trojan:Win64/SamScissors.](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win64/SamScissors)\n\n\n-----\n\nFor detection efforts, Huntress has observed -- at least for the malicious initial outreach to\nGithub-related IP address -- a particular process tree and process command line:\n\n\n-----\n\nThe parent lineage has been:\n```\nexplorer.exe\n  \\_\n     3CXDesktopApp.exe\n        \\_\n          3CXDesktopApp.exe\n\n```\n… with the parent 3CXDesktopApp.exe having one of the known malicious hashes, and the\ncorresponding child 3CXDesktopApp.exe invoked with a command line of:\n```\n[DRIVE]:\\Users\\Username\\Local\\Programs\\3CXDesktopApp.exe\\3CXDesktopApp.exe autoLaunch\n\n```\nTo note, we have observed processes with this lineage and command line that have not\nreached out to a Github related domain... but the distinguishing factor appears to be the\nprocess lineage criteria paired with the malicious hashes for the parent 3CXDesktopApp.exe.\n\n\n-----\n\nThese known SHA256 hashes offer quality indicators:\n\n**a60a61bf844bc181d4540c9fac53203250a982e7c3ad6153869f01e19cc36203**\n(18.12.416)\n\n**5d99efa36f34aa6b43cd81e77544961c5c8d692c96059fef92c2df2624550734**\n(18.12.416)\n\n**54004dfaa48ca5fa91e3304fb99559a2395301c570026450882d6aad89132a02**\n(18.12.407)\n\n**d45674f941be3cca2fbc1af42778043cc18cd86d95a2ecb9e6f0e212ed4c74ae**\n(18.12.407)\n\n[Additionally, Huntress researcher Matthew Brennan has crafted a YARA rule to help detect](https://twitter.com/embee_research)\nthese malicious files.\n\n[You can find this YARA rule included within this Github gist:](https://gist.github.com/JohnHammond/b9912e2d2ba4418a8a4450a166b35cb4)\n\n## Attribution\n\nWhile definitive attribution is not yet clear, the current consensus across the security\ncommunity is that this attack was performed by a DPRK nation-state threat actor.\n\n## 3CX Official Messaging\n\n[The latest recommendations from the 3CX CEO and](https://www.3cx.com/community/threads/3cx-desktopapp-security-alert.119951/) [CISO are to uninstall the desktop client](https://www.3cx.com/blog/news/desktopapp-security-alert/)\nfor 3CX. They report they are preparing a new release and update to the 3CXDesktopApp to\nbe made available soon.\n\n## Huntress Assistance\n\n\n-----\n\nFully aware of the severity of this incident, we realize our efforts are just one pebble in the\npond. With that said, our goal is always to keep our partners safe and do as much as we can\nto help the broader small and mid-size business (SMB) community prevent this from\nescalating further.\n\nIf you are using 3CX and aren’t already working with our team, Huntress is offering a free,\n30-day trial of our Managed EDR services through the month of April. For more information,\n[check out the details here: https://www.huntress.com/3cx-response.](https://www.huntress.com/3cx-response)\n\n## Resources and References\n\nThe latest from 3CX\n\n[https://www.3cx.com/blog/news/desktopapp-security-alert-updates/](https://www.3cx.com/blog/news/desktopapp-security-alert-updates/)\nCrowdStrike’s original Reddit reporting\n\nhttps://www.reddit.com/r/crowdstrike/comments/125r3uu/20230329_situational_awaren\ness_crowdstrike/\nCrowdStrike’s formal blog post\n\nhttps://www.crowdstrike.com/blog/crowdstrike-detects-and-prevents-active-intrusioncampaign-targeting-3cxdesktopapp-customers/\nTodyl’s reporting\n\n[https://www.todyl.com/blog/post/threat-advisory-3cx-softphone-telephony-campaign](https://www.todyl.com/blog/post/threat-advisory-3cx-softphone-telephony-campaign)\nSentinelOne’s reporting\n\n[https://s1.ai/smoothoperator](https://s1.ai/smoothoperator)\nDiscussion on the 3CX forum and public bulletin board\n3CX CEO first official notification\n\nhttps://www.3cx.com/community/threads/3cx-desktopapp-securityalert.119951/#post-558907\nNextron System’s Sigma and YARA rules for detection\n\nhttps://github.com/Neo23x0/signaturebase/blob/master/yara/gen_mal_3cx_compromise_mar23.yar\nUnofficial OTX AlientVault Pulse\n\n[https://otx.alienvault.com/pulse/64249206b02aa3531a78d020](https://otx.alienvault.com/pulse/64249206b02aa3531a78d020)\nKevin Beaumont’s commentary\n\n[https://cyberplace.social/@GossiTheDog/110108640236492867](https://cyberplace.social/@GossiTheDog/110108640236492867)\nVolexity's timeline, including what each of the icon files were and some of the network\nindicators\n\nhttps://www.volexity.com/blog/2023/03/30/3cx-supply-chain-compromise-leads-toiconic-incident/\n\n## Indicators of Attack (IOAs)\n\n### Domains:\n\n\n-----\n\n```\nakamaicontainer[.]com\nakamaitechcloudservices[.]com\nazuredeploystore[.]com\nazureonlinecloud[.]com\nazureonlinestorage[.]com\ndunamistrd[.]com\nglcloudservice[.]com\njournalide[.]org\nmsedgepackageinfo[.]com\nmsstorageazure[.]com\nmsstorageboxes[.]com\nofficeaddons[.]com\nofficestoragebox[.]com\npbxcloudeservices[.]com\npbxphonenetwork[.]com\npbxsources[.]com\nqwepoi123098[.]com\nsbmsa[.]wiki\nsourceslabs[.]com\nvisualstudiofactory[.]com\nzacharryblogs[.]com\n\n### 3CXDesktopApp.exe SHA256 hashes\na60a61bf844bc181d4540c9fac53203250a982e7c3ad6153869f01e19cc36203 (18.12.416)\n5d99efa36f34aa6b43cd81e77544961c5c8d692c96059fef92c2df2624550734 (18.12.416)\n54004dfaa48ca5fa91e3304fb99559a2395301c570026450882d6aad89132a02 (18.12.407)\nd45674f941be3cca2fbc1af42778043cc18cd86d95a2ecb9e6f0e212ed4c74ae (18.12.407)\n\n 3CXDesktopApp MSI Installer SHA256 hashes\naa124a4b4df12b34e74ee7f6c683b2ebec4ce9a8edcf9be345823b4fdcf5d868\n59e1edf4d82fae4978e97512b0331b7eb21dd4b838b850ba46794d9c7a2c0983\n\n 3CXDesktopApp macOS SHA256 hashes\n92005051ae314d61074ed94a52e76b1c3e21e7f0e8c1d1fdd497a006ce45fa61\nb86c695822013483fa4e2dfdf712c5ee777d7b99cbad8c2fa2274b133481eadb\na64fa9f1c76457ecc58402142a8728ce34ccba378c17318b3340083eeb7acc67\n\n 3CXDesktopApp macOS DMG Installer hashes\n5407cda7d3a75e7b1e030b1f33337a56f293578ffa8b3ae19c671051ed314290\ne6bbc33815b9f20b0cf832d7401dd893fbc467c800728b5891336706da0dbcec\n\n```\n\n-----\n\n**John Hammond**\n\nThreat hunter. Education enthusiast. Senior Security Researcher at Huntress.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-30 - 3CX VoIP Software Compromise & Supply Chain Threats.pdf"
    ],
    "report_names": [
        "2023-03-30 - 3CX VoIP Software Compromise & Supply Chain Threats.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1683338950,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1683251062,
    "ts_modification_date": 1683251062,
    "files": {
        "pdf": "https://archive.orkl.eu/6c4d9d9d7d3d117fa57fa0186320ca02a91dc6f2.pdf",
        "text": "https://archive.orkl.eu/6c4d9d9d7d3d117fa57fa0186320ca02a91dc6f2.txt",
        "img": "https://archive.orkl.eu/6c4d9d9d7d3d117fa57fa0186320ca02a91dc6f2.jpg"
    }
}