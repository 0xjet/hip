{
    "id": "a9800cb9-9ebc-487a-95b4-73aa24140713",
    "created_at": "2022-10-25T16:48:24.676721Z",
    "updated_at": "2025-03-27T02:06:15.469922Z",
    "deleted_at": null,
    "sha1_hash": "9afebcbec06e6e6d9db177fd5a41dba40a3a4b08",
    "title": "",
    "authors": "",
    "file_creation_date": "2011-12-05T15:17:25Z",
    "file_modification_date": "2011-12-05T15:17:25Z",
    "file_size": 2017644,
    "plain_text": "# Win32/Carberp \n\n## When You’re in a Black Hole, Stop Digging\n\n#### Aleksandr Matrosov, ESET\n\n Eugene Rodionov, ESET\n\n Dmitry Volkov, Group-IB\n\n David Harley, ESET \n\n\n-----\n\n#### Introduction \n\nESET and Group-IB researchers have seen and analysed a good deal of Russian malware, but some of\nthe most interesting examples have been malicious programs that steal money from Remote\nBanking Systems (RBS), targeting major companies that carry out thousands of financial transactions\na day. This type of malware was discussed at some length in a presentation at CARO 2011 on\n\n[“Cybercrime in Russia: Trends and issues” and some later presentations.](http://go.eset.com/us/resources/white-papers/CARO_2011.pdf)\n\nIn November 2011, we examined some interesting modifications to Win32/Carberp, discussing the\nuse of the Zerokit bootkit builder – also associated with the Rovnix bootkit – and considering the\nlikelihood that the gang concerned is working on the development of more effective ways of evading\nantivirus detection.\n\nIn December, we published another blog discussing the dramatic rise in Carberp-related incidents\nand linking it with the Black Hole exploit kit, as well as with the parallel development and evolution\nof SpyEye, indicating the way in which cybercriminal activity has been growing and evolving with\nrespect to various payment systems, in Russia in particular.\n\nThis paper summarizes this information in a single document, and also includes a resources list for\nfurther reading.\n\n\n-----\n\n### Deep Diving\n\nIn November 2011 we discovered new information on a new modification of Trojan of\nWin32/TrojanDownloader.Carberp family. This trojan is notorious as one of the most widely spread\nmalicious programs in Russia, stealing money from remote banking systems and primarily targeting\ncompanies which perform a huge number of financial transactions a day. We already shed some\n[light on this malware in our CARO 2011 presentation “Cybercrime in Russia: Trends and issues”. The](http://go.eset.com/us/resources/white-papers/CARO_2011.pdf)\ncybercrime group behind this Trojan is very active in the territory of Russia and the former Soviet\nrepublics. We spotted the first cases related to the Carberp trojan around the end of 2010 and in the\nmiddle of the summer of 2011 we can see from the following graph that there was a big spike in the\nnumber of detections, a pattern which has been repeated at the beginning of the fall.\n\nThe Russian Federation is the country where the largest number of installations of Carberp has been\nseen, as confirmed by the statistics below:\n\n\n-----\n\nThe criminal gang behind Carberp is one of the biggest cybercrime groups engaged in banking fraud.\nThe group’s average weekly income is estimated to be several million US dollars. Furthermore, these\nguys are heavily investing money in the development of malware technologies, as is confirmed for\ninstance, by the evolution of the [Hodprot dropper: this has been implicated in installations of](http://go.eset.com/us/resources/white-papers/Hodprot-Report.pdf)\nCarberp, RDPdoor and [Sheldor. RDPdoor, by the way, installs Carberp to open a backdoor in the](http://blog.eset.com/2011/01/14/sheldor-shocked)\ninfected system and manually perform fraudulent banking transactions. We have ascertained that\nthese examples of malicious software are products of single cybercrime group.\n\nAt the beginning of this year advertising appeared on some cybercrime forums for a new bootkit\nbuilder which wasn’t detected by antivirus software. The price of the builder was estimated to be\ntens of thousands of US dollars and seemed incredibly high compared with that of the SpyEye and\nZeus Trojans.\n\nIt isn’t known how many groups bought the builder. We managed to obtain a sample of the\ncompiled dropper with the builder which loads a stub driver. The code in the sample is identical to\nthose of some other examples of malicious software. At the time the only known malware utilizing\n\n\n-----\n\n[the same bootkit component was the Rovnix bootkit (http://blog.eset.com/2011/08/23/hasta-la-vista-](http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr)\n\n[bootkit-exploiting-the-vbr). Testing of the Carperb Trojan with bootkit functionality started early in](http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr)\nthe fall and during this period its distribution was very limited. There are two facts that suggest that\nthe bot is working in the test mode. The first is that there is an abundance of debugging and tracing\ninformation relating to bot installation and the binary’s behavior. Secondly we managed to gain\naccess to log files from the bot C&C server that also support the probability that Carberp was under\ntest:\n\n**C&C for tested bot version**\n\nThere is also a lot of debugging information to be found in the installer of the new version of\nCarberp:\n\n**String found in the unpacked Carberp module**\n\n\n-----\n\nThe bootkit component of the new version remains the same and is almost identical to that of\n[Rovnix bootkit. You can also find technical details of the Rovnix bookit in the slides of the \"Defeating](http://go.eset.com/us/resources/white-papers/Ekoparty2011_preso.pdf)\n[x64: Modern Trends of Kernel-Mode Rootkits\" talk given at the Ekoparty 2011 Security conference.](http://go.eset.com/us/resources/white-papers/Ekoparty2011_preso.pdf)\n\nAt the same time, its installer has been changed significantly. Besides installing the bootkit in the\nsystem it tries to exploit several vulnerabilities in the target system so as to escalate its privileges.\nCarberp utilizes these exploits as it requires administrative privileges in order to install the bootkit.\nPrimarily, the Carberp Trojan targets corporate users using RBS (Remote Banking Systems) software\nwhich in many cases lack administrative privileges, so that a social engineering attack isn’t applicable\nor sufficient in this scenario. Therefore the installer exploits the following vulnerabilities in the\nsystem software in order to escalate privilege: \n\nMS10-073 (win32k.sys KeyboardLayout vuln) \nMS10-092 (Task Scheduler vuln) \nMS11-011 (win32k.sys SystemDefaultEUDCFont vuln) \n[.NET Runtime Optimization vulnerability (http://osvdb.org/show/osvdb/71013)](http://osvdb.org/show/osvdb/71013)\n\n\n-----\n\nYet another interesting feature of the installer of the new version of Carberp is that it removes\nvarious hooks from the following list of system routines just before installing the trojan or bootkit\nonto the system:\n\nThis is done with the intention of evading sandboxes and other monitoring software that employs\nuser-mode hooks.\n\nThe bootkit itself is intended to load a kernel-mode driver which in turn injects a malicious DLL into\naddress spaces of processes running on the system. In the new version of Carberp we found only a\n32-bit kernel-mode driver, but the technology in use makes it possible to load a 64-bit unsigned\nkernel-mode driver on 64-bit operating systems.\n\nAfter unpacking the injected kernel-mode driver we can find the compiler version and date of build:\n\n\n-----\n\nBased on the data provided above the driver was built at the beginning of November and is being\ntested right now. The linker has left an interesting string in the driver binary containing the path to\ndebugging symbols on the developer’s computers:\n\nIt seems that this is not the first and possibly not the last version of the malware to appear recently.\nSince there are only two known examples of malware (Carberp and Rovnix) employing this particular\nbootkit technique, the development of which requires highly qualified specialists, it is possible that\nthe group which originally developed this bootkit is currently supporting it.\n\nAs was mentioned earlier in this article, the main task of the driver is to inject its payload into usermode address space of the process in the system.\n\nAfter unpacking the DLL injected by the kernel-mode driver we can see that the date of its\ncompilation is different to that of kernel-mode driver.\n\n\n-----\n\nInside the binary we found a string pointing to other directory containing debugging symbols. We\ncan see “GSVSoft” as the name of a root-level directory.\n\nSince the dates of compilation and paths to debugging symbols directories are not the same it may\nbe that there are two independent groups of people working on the malware. By the way, there is a\nreal company with the name “GSVSoft” (gsvsoft.ru) but we don’t have enough information to draw\nany conclusions from that.\n\nThe main functionality of the injected library is very close to that of the previous version of Carberp.\nIts main task is to inject JS-scripts into internet banking webpages, downloading additional plugins\nand communicating with the C&C server.\n\nBased on the information presented above we can conclude that the authors of the malware aren’t\nsatisfied with current methods of concealing malware in the system, and so are investing money into\ndeveloping their own techniques for bypassing antivirus software. The evolution of this malware led\nCarberp to become the number one malware attacking the clients of Russian banks (there also\ngovernmental organizations that became victims of this trojan). The new version of Carberb with\nbootkit can be compared to such advanced malware as TDL4 and Rovnix.\n\nEven though Carberp is currently targeting only Russian banks, this situation might rapidly change as\nthere are no obstacles to applying the same fraudulent techniques in order to target banks in other\ncountries. A possible reason that the cybercrime group doesn’t attempt to target other regions is\nthat it is satisfied with current conditions and revenue, at least until a new partnership draws them\nto spread to other parts of the world. In the last year we have noticed some Carperp activity in\nEurope, but this declined rapidly.\n\nIn recent years there has been a tremendous increase in the Russian region in the number of sites\nredirecting users to the Black Hole exploit kit In most cases, successful exploitation of a vulnerability\nin client software leads to the installation onto the victim’s machine of either the trojan\nWin32/TrojanDownloader.Carberp or or of Win32/Carberp (the version updated to incorporate\n[bootkit functionality, as described in http://blog.eset.com/2011/11/21/evolution-of-win32carberp-](http://blog.eset.com/2011/11/21/evolution-of-win32carberp-going-deeper)\n[going-deeper). One of the most intriguing aspects is that distribution of the malware was restricted](http://blog.eset.com/2011/11/21/evolution-of-win32carberp-going-deeper)\nto the most popular web sites for people managing finances in companies: these sites are visited\nseveral hundred thousand times a day. The statistics presented below clearly reflect an increase in\nCarberp detections in the Russian region during November. This trojan takes fifth place in the list of\nthe most widely spread malware: Win32/TrojanDownloader.Carberp.AF - 1.73 %.\n\nThe number of detections of the Carberp family in general has more than tripled in November:\n\n\n-----\n\nThe distribution model is essentially a standard approach, but what makes it interesting is the\nnumber of legitimate web resources used to deliver Carberp onto the victim’s computers. The\ndistribution scheme is depicted below:\n\nBased on the statistics obtained from one of the nodes hosting an active Black Hole exploit pack, the\nmost frequently exploited vulnerabilities leading to system infection with malware are found in Java\nsoftware.\n\n\n-----\n\nIn the last year Java has outpaced last year’s “leaders” in exploitable application formats such as\n[PDF and SWF (Adobe Flash file format), which are now more or less equal in second place (Figure 3).](http://en.wikipedia.org/wiki/Portable_Document_Format)\nThe vulnerabilities in Java are easier and more consistently exploitable than those in PDF and SWF.\nThe code required for aworking exploit is fairly small, and may be only a page in length. The\nexploited vulnerabilities aren’t really new: some of them are more than a year old.\n\nBelow you can see a screenshot demonstrating the configuration window for an address to which\nusers are redirected from legitimate web sites. There may be many such addresses. Sometimes the\naddress is generated dynamically, based on parameters determined from the victim’s browser.\n\n\n-----\n\nOnce the vulnerability has been successfully exploited the dropper is executed: in this case it is\nCarberp that is being dropped. To prevent antivirus software detecting the dropper the Black Hole\nexploit kit includes functionality for measuring dropper detections by the most widely used antivirus\nsoftware. When the number of detections reaches a defined value the dropper is repacked by the\nservice responsible for it.\n\nAs we can see this is quite an effective system for exploiting vulnerabilities and installing malware on\nthe victims’ machines. The price for Black hole – including support – is in the order of several\nthousand US dollars, but cyber criminals offer rather flexible pricing: thus, it is possible to rent the\nservice for up to a day.\n\nThis is what exploitation of a Java vulnerability looks like:\n\n\n-----\n\nAnd this is a gate configuration file for distributing the Carberp dropper:\n\nRecently we’ve been finding targeting plugins installed by Carberp in case it detects SberBank and\nCyberPlat payment software in the system.\n\nIn most cases the plugins are stored in publicly accessible directories and are downloaded by the\nmalware on demand. In order to conceal the functionality of the downloaded modules they are\ndownloaded encrypted. Here is the script to encipher the plugins:\n\nAn RC2 cipher and BASE64 encoding algorithm are used to encrypt data. In most cases the\nencryption key is stored inside BASE64-encoded data.\n\nAnother malicious program worth some attention is SpyEye. From the following chart we can see\nthat its activity has increased significantly in November.\n\n\n-----\n\n**Figure 9**\n\nSpyEye is distributed by regions as shown in the next chart:\n\nRussia takes second place in distribution of SpyEye. There is a reason for this: we’ve recently\ndetected a SpyEye sample which downloaded plugins into the system for stealing money from\nRussian RBS (Remote Banking Service) systems.\n\n\n-----\n\nA more interesting feature is that the configuration file includes rules for taking screenshots which\ncontain not only names of banks but also of big Russian companies:\n\nAll these features indicate that cybercriminal activity has been growing and evolving with respect to\nvarious payment systems.\n\n\n-----\n\n#### Resources and Further Reading\n\n[CARO 2011 presentation: “Cybercrime in Russia: Trends and issues”](http://go.eset.com/us/resources/white-papers/CARO_2011.pdf)\n\n[Hodprot Report: http://go.eset.com/us/resources/white-papers/Hodprot-Report.pdf](http://go.eset.com/us/resources/white-papers/Hodprot-Report.pdf)\n\n[Hodprot: Hot to Bot](http://go.eset.com/us/resources/white-papers/Hodprot-Report.pdf)\n\nCarberp, RDPdoor and Sheldor: [http://blog.eset.com/2011/01/14/sheldor-shocked](http://blog.eset.com/2011/01/14/sheldor-shocked)\n\nRovnix bootkit: [http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr](http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr)\n\nEkoparty 2011 presentation: [\"Defeating x64: Modern Trends of Kernel-Mode Rootkits\"](http://go.eset.com/us/resources/white-papers/Ekoparty2011_preso.pdf)\n\nESET on SpyEye: [http://blog.eset.com/?s=spyeye](http://blog.eset.com/?s=spyeye)\n\n[Hasta La Vista, Bootkit: Exploiting the VBR](http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr)\n\n[Modern Bootkit Trends: Bypassing Kernel-Mode Signing Policy](http://go.eset.com/us/resources/white-papers/Rodionov-Matrosov.pdf)\n\n[Defeating x64: Modern Trends of Kernel-Mode Rootkits](http://go.eset.com/us/resources/white-papers/Ekoparty2011_preso.pdf)\n\n[Carberp Evolution: http://blog.eset.com/2011/11/21/evolution-of-win32carberp-going-deeper](http://blog.eset.com/2011/11/21/evolution-of-win32carberp-going-deeper)\n\n[Carberp + Black Hole: http://blog.eset.com/2011/12/04/carberp-blackhole-growing-fraud-incidents](http://blog.eset.com/2011/12/04/carberp-blackhole-growing-fraud-incidents)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://cdn1.esetstatic.com/eset/US/resources/docs/white-papers/white-papers-win-32-carberp.pdf",
        "https://www.eset.com/fileadmin/eset/US/resources/docs/white-papers/white-papers-win-32-carberp.pdf"
    ],
    "report_names": [
        "white-papers-win-32-carberp.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041175,
    "ts_creation_date": 1323098245,
    "ts_modification_date": 1323098245,
    "files": {
        "pdf": "https://archive.orkl.eu/9afebcbec06e6e6d9db177fd5a41dba40a3a4b08.pdf",
        "text": "https://archive.orkl.eu/9afebcbec06e6e6d9db177fd5a41dba40a3a4b08.txt",
        "img": "https://archive.orkl.eu/9afebcbec06e6e6d9db177fd5a41dba40a3a4b08.jpg"
    }
}