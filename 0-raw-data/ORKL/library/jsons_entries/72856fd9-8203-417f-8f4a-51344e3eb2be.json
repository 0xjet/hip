{
    "id": "72856fd9-8203-417f-8f4a-51344e3eb2be",
    "created_at": "2023-01-12T15:06:19.82552Z",
    "updated_at": "2025-03-27T02:17:22.840563Z",
    "deleted_at": null,
    "sha1_hash": "ea62610e2a711007e299db47672019afde9bfdd5",
    "title": "2021-02-17 - Malware Analysis Report (AR21-048D)- AppleJeus- Kupay Wallet",
    "authors": "",
    "file_creation_date": "2022-05-27T22:50:25Z",
    "file_modification_date": "2022-05-27T22:50:25Z",
    "file_size": 1164737,
    "plain_text": "# MAR-10322463-4.v1 - AppleJeus: Kupay Wallet\n\n**us-cert.cisa.gov/ncas/analysis-reports/ar21-048d**\n\nMalware Analysis Report\n\n10322463.r4.v1\n\n2021-04-08\n\n## Notification\n\nThis report is provided \"as is\" for informational purposes only. The Department of Homeland Security (DHS) does not provide any warranties of an\ninformation contained herein. The DHS does not endorse any commercial product or service referenced in this bulletin or otherwise.\n\nThis document is marked TLP:WHITE--Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeab\naccordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distribute\nmore information on the Traffic Light Protocol (TLP), see http://www.us-cert.gov/tlp.\n\n## Summary\n\nDescription\n\nThis Malware Analysis Report (MAR) is the result of analytic efforts among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infras\n(CISA), and the Department of Treasury (Treasury) to highlight the cyber threat to cryptocurrency posed by North Korea, formally known as the D\nRepublic of Korea (DPRK), and provide mitigation recommendations. Working with U.S. government partners, FBI, CISA, and Treasury assess th\nthese agencies attribute to North Korean state-sponsored advanced persistent threat (APT) actors—is targeting individuals and companies, includ\nexchanges and financial service companies, through the dissemination of cryptocurrency trading applications that have been modified to include m\ntheft of cryptocurrency.\n\nThis MAR highlights this cyber threat posed by North Korea and provides detailed indicators of compromise (IOCs) used by the North Korean gov\nGovernment refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on other versions of Ap\nrecommended steps to mitigate this threat, see Joint Cybersecurity Advisory AA21-048A: AppleJeus: Analysis of Lazarus Group Cryptocurrency M\ncert.cisa.gov/ncas/alerts/AA21-048A.\n\nThere have been multiple versions of AppleJeus malware discovered since its initial discovery in August 2018. In most versions, the malware app\nlegitimate-looking cryptocurrency trading company and website, whereby an unsuspecting individual downloads a third-party application from a w\nlegitimate.\n\nThe U.S. Government has identified AppleJeus malware version—Kupay Wallet—and associated IOCs used by the North Korean government in\n\nKupay Wallet, discovered in March 2020, is a legitimate-looking cryptocurrency trading software that is marketed and distributed by a company an\nService and kupaywallet[.]com, respectively—that appear legitimate. Some information has been redacted from this report to preserve victim anon\n[For a downloadable copy of IOCs, see: MAR-10322463-4.v1.stix.](https://us-cert.cisa.gov/sites/default/files/publications/MAR-10322463-4.v1.WHITE_stix.xml)\n\nSubmitted Files (7)\n\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba (kupay_upgrade)\n\n1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6 (Kupay.exe)\n\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9 (Kupay.dmg)\n\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8 (Kupay.msi)\n\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd (kupayupdate_stage2)\n\na0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492 (kupay)\n\nfc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d (KupayUpgrade.exe)\n\nDomains (2)\n\nkupaywallet.com\n\nlevelframeblog.com\n\n## Findings\n\n**6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8**\n\nTags\n\ndropper\n\nDetails\n\n**Name** Kupay.msi\n\n**Size** 143568384 bytes\n\n\n-----\n\n**Type**\n\n\nComposite Document File V2 Document, Little Endian, Os: Windows, Version 10.0, MSI Installer, Last Printed: Fri Dec 11 11:47:44 20\nFri Dec 11 11:47:44 2009, Last Saved Time/Date: Fri Dec 11 11:47:44 2009, Security: 0, Code page: 1252, Revision Number: {9DCFF\nAF38D7F3E338}, Number of Words: 2, Subject: Kupay, Author: Kupay Service, Name of Creating Application: Advanced Installer 14.5\nTemplate: ;1033, Comments: This installer database contains the logic and data required to install Kupay., Title: Installation Database\nMSI, Database, Number of Pages: 200\n\n\n**MD5** afdf3dd62dafd401be4bbeca65b42635\n\n**SHA1** 8b45d12ed8c058ea0ce3122da9a82b9fb045d6a3\n\n**SHA256** 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n**SHA512** bdc7a8904ad154046ade472442810c0007e5494665b429d847eef74b05567422600dd543bd8ae632128cd8def853926f2a86eab0e7d9\n\n**ssdeep** 3145728:M8yVXZLQX6rw3cJRGmMEuwRNiPTdy68L04oIRHndNQGOx:9yVXZfrw3CGtw3iPTdytmIRHdlw\n\n**Entropy** 7.997013\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\n6b945159b4... Contains 1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\n\n6b945159b4... Contains fc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\n\n6b945159b4... Downloaded_By kupaywallet.com\n\nDescription\n\nThis Windows program from the Kupay Service site is a Windows MSI Installer with the file name Kupay[GUID].msi. The installer was hosted at\nhxxps[:]kupaywallet.com/product/[GUID]. The [GUID] is a unique file that is crated for a specific victim and is being withheld to preserve the identit\nrecipient.\n\nThe installer looks legitimate and will install the \"Kupay.exe\" (1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6) file in\n(x86)\\Kupay” folder. It also installs \"KupayUpgrade.exe\" (fc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d) in the “C:\\U\n<username>\\AppData\\Roaming\\KupaySupport” folder. Immediately after installation, the installer launches the \"KupayUpgrade.exe\" binary.\nScreenshots\n\n**Figure 1 - Screenshot of \"Kupay.msi\" installation.**\n\n**kupaywallet.com**\n\nTags\n\ncommand and control\n\n\n-----\n\nkupaywallet.com/kupay_update.php\nkupaywallet.com/product/\n\nWhois\n\nWhois for kupaywallet.com had the following information:\nRegistrar: NAMECHEAP INC\nCreation Date: 2020-02-21\nRegistrar Registration Expiration Date: 2021-02-21\n\nRelationships\n\nkupaywallet.com Downloaded 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\nkupaywallet.com Downloaded 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\nkupaywallet.com Connected_From 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\nDescription\n\nThe domain kupaywallet.com had a legitimately signed Sectigo Secure Sockets Layer (SSL) certificate, which was “Domain Control Validated” jus\nAppleJeus domain certificates. Investigation revealed the point of contact listed for verification was admin[@]kupaywallet.com. No other contact in\nas the administrative or technical contact for the kupaywallet.com domain.\n\nThe domain is registered with NameCheap at the IP address 104.200.67.96 with ASN 8100.\n\nIn addition to the site kupaywallet.com, a Twitter account @kupayservice is associated with the company. This account tweets out general cryptoc\ninformation and replies to various related tweets. The first tweet was on May 23, 2019, while the last was on July 11, 2019. Twitter lists the joined\nbe October 2018.\nScreenshots\n\n**Figure 2 - Screenshot of KupayService Twitter account.**\n\n**1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6**\n\nTags\n\ntrojan\n\nDetails\n\n**Name** Kupay.exe\n\n**Size** 97686016 bytes\n\n**Type** PE32+ executable (GUI) x86-64, for MS Windows\n\n**MD5** 668d696582f9c00029e2e8253470e9db\n\n**SHA1** e83ebe43da7bbfb9c95d34163383d1b3926e663f\n\n**SHA256** 1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\n\n\n-----\n\n**SHA512** 0b370636ea2b7211d691a3bfcfc9017cb12df6874becb9b6334ca735bc325f59c50e99fc3b57c8db2d265e0c631651c7280109ffdbb3b48\n\n**ssdeep** 1572864:MdJvugr82jf19dUM/1T8+1VJRukUhkmG:Mdhg6Pm\n\n**Entropy** 6.674838\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\n**97** 78b56a1385f2a92f3c9404f71731088646aac6c2c84cc19a449976272dab418f\n\nPE Metadata\n\n**Compile Date** 2019-12-16 00:00:00-05:00\n\n**Import Hash** bb1d46df79ee2045d0bc2529cf6c7458\n\n**Company Name** BitPay\n\n**File Description** Kupay\n\n**Internal Name** Kupay\n\n**Legal Copyright** Copyright © 2020 BitPay\n\n**Product Name** Kupay\n\n**Product Version** 9.1.0.0\n\nPE Sections\n\n**MD5** **Name** **Raw Size** **Entropy**\n\n32b731864b0ff3d1c427c97d582e7897 header 1024 2.990247\n\n36430f041d87935dcb34adde2e7d625d .text 78234112 6.471421\n\nee7e02e8e2958ff79f25c8fd8b7d33e5 .rdata 15596032 6.376243\n\n65c59271f5c2bab26a7d0838e9f04bcf .data 262144 3.484705\n\n00406f1d9355757d80cbf48242fdf344 .pdata 2768896 6.805097\n\n6a6a225bfe091e65d3f82654179fbc50 .00cfg 512 0.195869\n\n786f587a97128c401be15c90fe059b72 .rodata 6144 4.219562\n\n9efa43af7b1faae15ffbd428d0485819 .tls 512 0.136464\n\n60d3ea61d541c9be2e845d2787fb9574 CPADinfo 512 0.122276\n\nbf619eac0cdf3f68d496ea9344137e8b prot 512 0.000000\n\n85237257867935c227d2f2f39316b12a .rsrc 106496 4.912524\n\nfb3216031225fdb1902888e247009d0c .reloc 709120 5.476445\n\nPackers/Compilers/Cryptors\n\nMicrosoft Visual C++ 8.0 (DLL)\n\nRelationships\n\n1b60a6d35c... Contained_Within 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\nDescription\n\nThis file is a 64-bit Windows executable contained within the Windows MSI Installer \"Kupay.msi.\" When executed, \"Kupay.exe\" loads a legitimate\nwallet application with no signs of malicious activity. This application appears to be a modification of the open source cryptocurrency wallet Copay\nAtlanta based company BitPay. According to their website bitpay.com, “BitPay builds powerful, enterprise-grade tools for crypto acceptance and s\n\n\n-----\n\npp pp g, q p y y y q p y\ncompany listed in the version information for Kupay is Bitpay.\n\nLastly, the GitHub “Commit Hash” listed in the Dorusio application “638b2b1” is to a branch of Copay found at hxxps[:]//github.com/flean/copay-1 (\nScreenshots\n\n**Figure 3 - Screenshot of the Kupay Wallet application.**\n\n**Figure 4 - Screenshot of the Bitpay site displaying the application.**\n\n**Figure 5 - Copay GitHub branch matching Dorusio.**\n\n**fc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d**\n\nTags\n\ntrojan\n\nDetails\n\n**Name** KupayUpgrade.exe\n\n**Size** 115712 bytes\n\n**Type** PE32+ executable (GUI) x86-64, for MS Windows\n\n\n-----\n\n**MD5** 60c2efdafbffc5bd6709c8e461f7b77d\n\n**SHA1** dbddccba18422eea5d7bb1bdfe66ceee90446a45\n\n**SHA256** fc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\n\n**SHA512** 5543d4e5872ef5b0f12ba180425d2ab94131c03f4fec7195f3a74d051d5a867ad580ea794a1af6c6bd16e4bc27337cc138fe71aab96007\n\n**ssdeep** 3072:oHAqeXaeHx9pdpqw6IQIsMF6s3yvPxdOBU:kWXaeHxrvB6X9M33\n\n**Entropy** 6.128091\n\nAntivirus\n\n**Ahnlab** Trojan/Win64.FakeCoinTrader\n\n**ESET** a variant of Win64/NukeSped.DE trojan\n\n**K7** Trojan ( 00569b451 )\n\n**Zillya!** Trojan.Generic.Win32.1058845\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\n**94** 572a124f5665be68eaa472590f3ba75bf34b0ea2942b5fcbfd3e74654202dd09\n\nPE Metadata\n\n**Compile Date** 2020-02-25 03:46:13-05:00\n\n**Import Hash** 565005404f00b7def4499142ade5e3dd\n\nPE Sections\n\n**MD5** **Name** **Raw Size** **Entropy**\n\n695567cdbccfbe54b19634abe3bb1e5b header 1024 2.723717\n\ne35b1061d665602ed7e1c2d9de87f059 .text 65536 6.456115\n\n1578510ae509e46d8f3201edb3349d54 .rdata 39936 5.084900\n\ndbf3b39f579f6cafbdf3960f0a87f5f9 .data 2560 1.851526\n\ncb3735cf6fde4690ee7a6cd2026eb4de .pdata 4096 4.957030\n\n90e2eb1b90616d039eca5e2627ea1134 .gfids 512 1.320519\n\n3f1861d2a0b1dc2d1329c9d2b3353924 .reloc 2048 4.762609\n\nPackers/Compilers/Cryptors\n\nMicrosoft Visual C++ 8.0 (DLL)\n\nRelationships\n\nfc1aafd2ed... Contained_Within 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\nDescription\n\nThis file is a 64-bit Windows executable contained within the Windows MSI Installer \"Kupay.msi.\" When executed, \"KupayUpgrade.exe\" first instal\nwill automatically start when any user logs on. The service is installed with a description stating “Automatic Kupay Upgrade.\"\n\nOn startup, \"KupayUpgrade.exe\" allocates memory in order to later write a file. After allocating the memory and storing the hard-coded string “Lat\nprogram attempts to open a network connection. The connection is named “Kupay Wallet 9.0.1 (Check Update Windows)”, likely to avoid suspicio\n\nSimilarly to previous AppleJeus variants, \"KupayUpgrade.exe \"collects some basic information from the system as well as a timestamp, and place\nformat strings. Specifically, the timestamp is placed into a format string “ver=%d&timestamp=%lu” where ver is set as the 90001, possibly referring\nversion previously mentioned (Figure 7).\n\nThis basic information and hard-coded strings are sent via a POST to the C2 kupaywallet.com/kupay_update.php. If the POST is successful (i.e. r\nstatus code of 200) but fails any of multiple different checks, \"KupayUpgrade.exe\" will sleep for two minutes and then regenerate the timestamp a\n\n\n-----\n\ng p y, p g p y y p y\n\nThe payload for the Windows malware could not be downloaded, as the C2 server \"kupaywallet.com/kupay_update.php\" was no longer accessibl\nwas not identified in open source reporting for this sample.\nScreenshots\n\n**Figure 6 - Screenshot of Kupay service.**\n\n**Figure 7 - Screenshot of the format string.**\n\n**55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9**\n\nTags\n\ndropper\n\nDetails\n\n**Name** Kupay.dmg\n\n**Size** 132870749 bytes\n\n**Type** zlib compressed data\n\n**MD5** 2f6573b3ae4262f04227468aab353387\n\n**SHA1** dd9058e3a6c791b18bf561a3177788cf60cd6e91\n\n**SHA256** 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n**SHA512** a26f1e0673563fea0d134f3238fe36b12dcd4567c6ae7e962113e9531e1847e9195b010a2b10ee087382163a973164c795052788ab450\n\n**ssdeep** 3145728:ttCQsiN4OYPdJvjr78vjHPZBs3CI0s9KVzcGesHiYhR7SsH:ttCQsiNmPjLXqvsgS/AusH\n\n**Entropy** 7.993885\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\n55eacc25e9... Contains a0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\n\n55eacc25e9... Downloaded_By kupaywallet.com\n\n\n-----\n\n55eacc25e9... Contains 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\nDescription\n\nIn March 2020, a download link for the OSX version of Kupay Wallet was found to be hosted at hxxps[:]//kupaywallet.com/[GUID]. The OSX progr\ndownload link is an Apple DMG installer. The [GUID] is a unique file that is crafted for a specific victim and is being withheld to preserve the identi\nrecipient. The OSX program uses a DMG installer with the file name Kupay[GUID].dmg.\n\nThe OSX program does not have digital signature, and will warn of that before installation. Just as JMTTrader, CelasTradePro, and UnionCrypto,\nappears to be legitimate, and installs both “Kupay” in the “/Applications/Kupay.app/Contents/MacOS/” folder and a program named kupay_upgrad\n“/Applications/Kupay.app/Contents/MacOS/” folder. The installer contains a postinstall script (Figure 8).\n\nThe postinstall script is identical in functionality to the postinstall scripts from previous AppleJeus variants, though accomplishes the same function\npreviously done. The postinstall script creates a “KupayDaemon” folder in the OSX “/Library/Application Support” folder, and moves kupay_upgrad\nSupport” folder contains both system and third-party support files which are necessary for program operation. Typically, the subfolders have name\nactual applications. At installation, Kupay placed the plist file (com.kupay.pkg.wallet.plist) in “/Library/LaunchDaemons/”.\n\nWhile previous versions of AppleJeus simply moved the plist file to the LaunchDaemons folder and waited for a restart for it to be loaded, the Kup\ncommand “launchctl load” to load the plist without a restart. The postinstall then launches the kupay_upgrade program in the background.\nScreenshots\n\n**Figure 8 - Screenshot of the postinstall script.**\n\n**Figure 9 - Screenshot of \"com.kupay.pkg.wallet.plist.\"**\n\n**a0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492**\n\nDetails\n\n**Name** kupay\n\n**Size** 186044 bytes\n\n**Type** Mach-O 64-bit x86_64 executable, flags:<NOUNDEFS|DYLDLINK|TWOLEVEL|PIE>\n\n**MD5** 4a43bafb4af0a038a7f430417bcc1b6e\n\n**SHA1** 438243575764a5e856951126674f72f20b2a0d6f\n\n**SHA256** a0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\n\n**SHA512** 51d37b27f390bc7f124f2cb8efb2b9c940d7a0c21b0912d06634f7f6af46a35e3221d25945bcad4b39748699ba8a33b17c350a480560e5\n\n**ssdeep** 3072:RiD/8kxClwjnLFycZ+xzknUapR+Nghc1VeY1HhNGKBqzoJGUNKFsJuMuixQdf:RiDUSyQnLFycZ+a8yhUVeY1LngzofKFF\n\n**Entropy** 6.083001\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\na0c461c94b... Contained_Within 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\nDescription\n\n\n-----\n\np pp p y g p y y py p yp y pp\nlooking wallet program, which is fully functional, and is identical to the Windows Kupay.exe program. Although this executable is not inherently ma\nidentify the hash and a \"kupay[GUID].dmg\" present on a system should assume they are compromised if it is present with other files or activity de\n\n**0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba**\n\nTags\n\ntrojan\n\nDetails\n\n**Name** kupay_upgrade\n\n**Size** 33248 bytes\n\n**Type** Mach-O 64-bit x86_64 executable, flags:<NOUNDEFS|DYLDLINK|TWOLEVEL|PIE>\n\n**MD5** f00bde07d9f8b7af1da425c23cc47e47\n\n**SHA1** c0670e18e1e3fbde58a25cbb94ba11558c02e7d3\n\n**SHA256** 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n**SHA512** 266746da74bda3aed3af13d0b51adaee0e2e56d13ff8b1f68e1766b96b12dd2d5dadca143b7f5fc8693bd24aaa008c3a24161e69625c6\n\n**ssdeep** 192:AShk5sZUIyfKaTuy+YZ+qyepkfLYrs4eL:AShmxfKaTuQr\n\n**Entropy** 1.652634\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\n0bc7517aa2... Contained_Within 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n0bc7517aa2... Connected_To kupaywallet.com\n\n0bc7517aa2... Downloaded 91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\nDescription\n\nThis OSX sample was contained within Apple DMG \"Kupay.dmg.\" When executed, \"kupay_upgrade\" immediately sleeps for five seconds and the\ncoded value stored in “isReady” is a 0 or a 1. If it is a 0, the program sleeps again, and if it is a 1, the function “CheckUpdate” is called. This functi\nlogic functionality of the malware. \"CheckUpdate\" sends a POST to the C2 hxxps[:]//kupaywallet.com/kupay_update.php with a connection named\n(Check Update Osx).\"\n\nJust as the Windows malware, the timestamp is placed into a format string “ver=%d&timestamp=%ld” where ver is set as the 90001, possibly refe\nversion 4 Kupay Wallet (Figure 11).\n\nIf the C2 server returns a file, it is decoded and written to “/private/tmp/kupay_update”, with permissions by the command chmod 700 (only the us\nexecute). The stage2 (/private/tmp/kupay_update) is then launched, and the malware kupay_upgrade returns to sleeping and checking in with the\nScreenshots\n\n**Figure 10 - Screenshot of the C2 loaded into variable.**\n\n**Figure 11 - Screenshot of the format string.**\n\n**91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd**\n\n\n-----\n\ntrojan\n\nDetails\n\n**Name** kupayupdate_stage2\n\n**Size** 40176 bytes\n\n**Type** Mach-O 64-bit x86_64 executable, flags:<NOUNDEFS|DYLDLINK|TWOLEVEL|PIE>\n\n**MD5** 17ab2927a235a0b98480945285767bcf\n\n**SHA1** d4b96e9d966b0f1e9ff1ef61a8d09c9020254652\n\n**SHA256** 91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n**SHA512** 51a5279db7b0074c83aac19f7f426b8a1dadd939e3ee660f71be3e5da110f0af8ae5bb781ad0b57c6ded19ae74aa95dbc2a8887443f638\n\n**ssdeep** 192:HZpt4Xnd+9EQbpvhyN1pQhO9de0II+pldd6gH1h8h/XbARs8xpDOL3ySoAk8+4uT:5pMUq6DaxaI+rddNH16VXbXDP4\n\n**Entropy** 3.266343\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\n91eaf215be... Connected_To levelframeblog.com\n\n91eaf215be... Downloaded_By 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\nDescription\n\nThis file is the stage 2 payload for the OSX KupayWallet. The stage 2 payload for the OSX KupayWallet was decoded and analyzed, and file prop\ndecoded file. The stage 2 kupay_update has a variety of functionalities. Most importantly, kupay_update checks in with the C2 levelframeblog.com\nconnecting to the C2, kupay_update can send or receive a payload, read and write files, execute commands via the terminal, etc.\n\nIf a payload is received or is going to be sent, kupay_update will base64 encode/decode and XOR encode/decode the data before sending or afte\nwhich base64 encode and decode are named b64_encode and b64_decode.\n\nThe functions which XOR encodes and decodes is XEncoding, and it uses a 32-byte XOR key which is hardcoded into kupay_update. The key is\n“wLqfM]%wTx`~tUTbw>R^0x18#yG5R(30x7FC:;” where all values are in ASCII except for 0x18 and 0x7F as those are non-readable characters in\nused in the DecryptPayload and CryptPayload functions. These two functions implement the XOR encode or decode without calling XEncoding, a\nb64_decode and b64_encode functions.\n\nKupay_update checks in with the C2 frequently, in order to execute or preform whatever commands and requests the server sends. There are mu\nthroughout the function to dictate when the contact with the C2 is made.\nScreenshots\n\n**Figure 12 - Screenshot of the portion of b64_encode.**\n\n\n-----\n\n**g** p g\n\n**levelframeblog.com**\n\nTags\n\ncommand-and-control\n\nURLs\n\nlevelframeblog.com/felix.php\n\nWhois\n\nWhois for levelframeblog.com had the following information:\nRegistrar: NAMECHEAP INC\nCreated: 2019-11-14\nExpires: 2020-11-14\n\nRelationships\n\nlevelframeblog.com Connected_From 91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\nDescription\n\nThis domain is the C2 for 2nd stage malware. The domain is registered with NameCheap at the IP address 23.152.0.101 with ASN 8100.\n\n## Relationship Summary\n\n6b945159b4... Contains 1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\n\n6b945159b4... Contains fc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\n\n6b945159b4... Downloaded_By kupaywallet.com\n\nkupaywallet.com Downloaded 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\nkupaywallet.com Downloaded 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\nkupaywallet.com Connected_From 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n1b60a6d35c... Contained_Within 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\nfc1aafd2ed... Contained_Within 6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n55eacc25e9... Contains a0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\n\n55eacc25e9... Downloaded_By kupaywallet.com\n\n55eacc25e9... Contains 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\na0c461c94b... Contained_Within 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n0bc7517aa2... Contained_Within 55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n0bc7517aa2... Connected_To kupaywallet.com\n\n0bc7517aa2... Downloaded 91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n91eaf215be... Connected_To levelframeblog.com\n\n91eaf215be... Downloaded_By 0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\nlevelframeblog.com Connected_From 91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n## Recommendations\n\nCISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organizatio\nconfiguration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.\n\nMaintain up-to-date antivirus signatures and engines.\nKeep operating system patches up-to-date.\nDisable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.\nRestrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators group unl\nEnforce a strong password policy and implement regular password changes.\nExercise caution when opening e-mail attachments even if the attachment is expected and the sender appears to be known.\nEnable a personal firewall on agency workstations, configured to deny unsolicited connection requests.\nDisable unnecessary services on agency workstations and servers.\nScan for and remove suspicious e-mail attachments; ensure the scanned attachment is its \"true file type\" (i.e., the extension matches the file\nMonitor users' web browsing habits; restrict access to sites with unfavorable content.\nExercise caution when using removable media (e.g., USB thumb drives, external drives, CDs, etc.).\nScan all software downloaded from the Internet prior to executing\n\n\n-----\n\np pp p ( )\n\nAdditional information on malware incident prevention and handling can be found in National Institute of Standards and Technology (NIST) Specia\n**\"Guide to Malware Incident Prevention & Handling for Desktops and Laptops\".**\n\n## Contact Information\n\nCISA continuously strives to improve its products and services. You can help by answering a very short series of questions about this product at t\n[https://us-cert.cisa.gov/forms/feedback/](https://us-cert.cisa.gov/forms/feedback/)\n\n## Document FAQ\n\n**What is a MIFR? A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely manner. In most**\nprovide initial indicators for computer and network defense. To request additional analysis, please contact CISA and provide information regarding\nanalysis.\n\n**What is a MAR? A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired via manua**\nrequest additional analysis, please contact CISA and provide information regarding the level of desired analysis.\n\n**Can I edit this document? This document is not to be edited in any way by recipients. All comments or questions related to this document should**\n[at 1-888-282-0870 or CISA Service Desk.](http://10.10.0.46/mailto:CISAservicedesk@cisa.dhs.gov)\n\n**Can I submit malware to CISA? Malware samples can be submitted via three methods:**\n\nWeb: [https://malware.us-cert.gov](https://malware.us-cert.gov/)\nE-Mail: [submit@malware.us-cert.gov](http://10.10.0.46/mailto:submit@malware.us-cert.gov)\nFTP: ftp.malware.us-cert.gov (anonymous)\n\nCISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and ph\n[Reporting forms can be found on CISA's homepage at www.cisa.gov.](http://www.cisa.gov/)\n\n## Revisions\n\nFebruary 17, 2021: Initial Version\n\nApril 15, 2021: AppleJeus: Kupay Wallet, clarified that a malware sample contained within Apple DMG \"Kupay.dmg\" is not inherently malicious\nand provided guidance on what organizations should look for to determine compromise\n\n[This product is provided subject to this Notification and this](https://us-cert.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/analysis-reports/ar21-048d)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-17 - Malware Analysis Report (AR21-048D)- AppleJeus- Kupay Wallet.pdf"
    ],
    "report_names": [
        "2021-02-17 - Malware Analysis Report (AR21-048D)- AppleJeus- Kupay Wallet.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535979,
    "ts_updated_at": 1743041842,
    "ts_creation_date": 1653691825,
    "ts_modification_date": 1653691825,
    "files": {
        "pdf": "https://archive.orkl.eu/ea62610e2a711007e299db47672019afde9bfdd5.pdf",
        "text": "https://archive.orkl.eu/ea62610e2a711007e299db47672019afde9bfdd5.txt",
        "img": "https://archive.orkl.eu/ea62610e2a711007e299db47672019afde9bfdd5.jpg"
    }
}