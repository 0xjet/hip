{
    "id": "678d4cdd-49a4-4cde-bfe0-6a42b27a7039",
    "created_at": "2022-10-25T16:48:13.082573Z",
    "updated_at": "2025-03-27T02:05:34.768112Z",
    "deleted_at": null,
    "sha1_hash": "a32e1a4407cc82ee190feded10e009fa13854f4c",
    "title": "Sality",
    "authors": "",
    "file_creation_date": "2015-11-26T15:24:13Z",
    "file_modification_date": "2015-11-26T15:24:13Z",
    "file_size": 1567275,
    "plain_text": "# SALITY\n\n###### 2003 – TODAY.\n\n##### PRESENTER:\n\n\n-----\n\n# About\n\n\n\n####  In business since 2003 [1], allegedly from Russia [1]\n  File infector (infects all executable files)\n  Multi-purpose botnet\n\n  Is reportedly doing: Stealing, distributed attacks, spam, multi-purpose\n  Features a P2P algorithm: 2 separate main botnets\n  Highest version numbers: 241 and 96 (of the 2 botnets)\n\n  More than 2 million infections per day reported by Virus Tracker\n  Estimated about 4 million total worldwide infections\n\n  Not many people are aware of Sality’s evilness !\n\n\n-----\n\n# Timeline\n\n#### 2003 First appearance [1]\n\n 2004-2008 New improved variants\n\n 2008 Peer-to-peer algorithm added, early test networks 1 and 2 (dead) 2009 P2P network 3 created (still alive, bigger one) 2010 P2P network 4 created (still alive)\n\n 2015 Still in business!\n\n\n-----\n\n# Originally named Win32.HLLP.Kuku?\n\n#### Sophos https://www.sophos.com/en-us/threat-center/threat-analyses/viruses-and-spyware/W32~Sality-H/detailed-analysis.aspx: “On the 10-12th of the month, when the minute equals the hour, the following message is displayed\n###### with the title 'Win32.HLLP.Kuku v2.91':\n```\n<<<<<Hey, Lamer! Say \"Bye-bye\" to your data! >>>>>\nCopyright (c) by Sector' ”\n\n```\n|String in Binary|Title in Email|\n|---|---|\n|Win32.HLLP.Kuku v1.02||\n|Win32.HLLP.Kuku v1.09||\n|Win32.HLLP.Kuku v2.05|Message from ST v2.05 - Sector(c), Salavat-city 2003|\n|Win32.HLLP.Kuku v2.91||\n|Win32.HLLP.Kuku v2.92|Message from ST v2.92 - Sector(c), Salavat-city 2003|\n\n```\nMessage from ST v2.93 - Sector(c), Salavat-city 2004\n\n```\n\n-----\n\n# Author of Sality\n\n\n-----\n\n# Author of Sality?\n\n#### According to Symantec [1]: “the curious reader asking where the name “Sality” originated from now has the answer: it is derived from “Salavat City”, a Russian town from which the author may originate. This threat bears a couple of other names, also related to strings found inside the payload: “Kuku” (which means Hide-and-Seek in Russian), or “Sector” (the nickname of the author).”\n\n\n-----\n\n#### In those old emails there appear 3 nick-names: 1. Sector 2. iMAGER 3. Alien-Z\n\n Those emails were used in the early samples: Sender: 11581@mail.ru Receiver: lamercool@rambler.ru, alien-z@mail.ru, imager@mail.ru\n\n\n# Author of Sality?\n```\nFrom sample 52AE3B7F8F383F169363B5D4F5D5DECA via Wireshark:\n220 smtp47.i.mail.ru ESMTP ready\nHELO MAIL.RU\n250 smtp47.i.mail.ru\nMAIL FROM:<11581@MAIL.RU>\n250 2.0.0 OK\nRCPT TO:<11581@MAIL.RU>\n550 SMTP is available only with SSL or TLS connection enabled.\n220 smtp19.mail.ru ESMTP ready\nHELO MAIL.RU\n250 smtp19.mail.ru\nMAIL FROM:<11581@MAIL.RU>\n250 2.0.0 OK\n\n```\n\n-----\n\n# Statistics\n\n\n-----\n\n# Statistics\n\n\n#### Up to 2 million per day monitored at Virus Tracker via sinkholing\n\n\n-----\n\n# Statistics\n\n\n#### Per country on 9/23/2015\n\n###### 20% observed via P2P 80% observed on domain sinkholes\n\n\n\n##### > 1% infections listed:\n\n###### 21.21 284.029 Other 19.67 263.403 India 8.99 120.421 Egypt 8.69 116.346 Vietnam 6.27 83.975 Pakistan 5.51 73.763 Iran, Islamic Republic of 4.73 63.282 Indonesia 3.97 53.154 China 3.33 44.616 Thailand 2.62 35.111 Turkey 2.57 34.376 Philippines 2.48 33.198 Brazil 2.29 30.644 Russian Federation\n\n\n-----\n\n# Statistics\n\n\n#### The reasons mostly 3[rd] world countries are affected are:\n\n 1. Pirated Windows with updates disabled 2. Often no AV installed; Sality’s detection is VERY high, pretty much any AV detects & removes it\n\n\n-----\n\n# DdoS attacks allegedly from Sality\n\n#### 4 ddos attacks against Virus Tracker:\n\n\n-----\n\n# Link between ddos attacks and Sality\n\n\n#### Ddos #1 on 11/27/2014:\n```\nTop 10 flows by bits per second for dst IP: 69.195.129.70\n Duration Proto   Src IP Addr Src Pt Dst Pt Packets   pps bps\n   0.067 UDP   178.78.246.45   53 62933   2048  30567 370.2 M\n   0.008 TCP    78.171.31.7 54245   80   2048  255999 281.6 M\n  101.264 UDP   204.145.94.87 47446   80  16.4 M  161794 119.1 M\n   0.019 ICMP  94.203.140.192   5  0.1   3072  161684  90.5 M\n   0.340 UDP    178.47.45.22   53 62933   2048   6023  73.0 M\n  98.668 UDP   209.119.225.25   53 12162  421888   4275  51.8 M\n  179.829 UDP   162.249.122.2   53 12162  753664   4191  50.8 M\n  98.318 UDP   209.122.107.49   53 12162  411648   4186  50.7 M\n  98.282 UDP     80.73.1.1   53 12162  387072   3938  47.7 M\n  97.400 UDP   216.174.102.25   53 12162  367616   3774  45.7 M\n\n```\n\n#### Ddos #2 on 1/30/2015:\n```\nTop 10 flows by bits per second for dst IP: 69.195.129.70\n Duration Proto   Src IP Addr Src Pt Dst Pt Packets   pps bps\n   0.006 UDP   61.93.224.130 56576 64265   2048  341333  4.1 G\n   0.006 UDP   111.17.216.35 59563 36767   2048  341333  4.1 G\n   0.006 UDP   89.27.129.254  123   80   2048  341333  1.3 G\n   0.019 UDP   61.93.224.130 64356 49110   2048  107789  1.3 G\n   0.055 TCP  201.172.228.114 49532   80   2048  37236  29.5 M\n  284.252 UDP   202.32.138.21  123   80  1.3 M   4657  18.0 M\n  284.131 UDP   182.19.66.178  123   80  950272   3344  12.9 M\n  286.991 UDP   213.56.30.120  123   80  826368   2879  11.1 M\n  287.132 UDP   206.196.172.14  123   80  822272   2863  11.0 M\n  286.758 UDP   199.192.104.10  123   80  806912   2813  10.9 M\n\n```\n\n#### Each time the only TCP attacker is a known Sality infection:\n\n\n-----\n\n# Technical Information\n\n\n-----\n\n# Botnets?\n\n####  Only active botnets are #3 and #4, both are independent P2P botnets\n\n######  Network 1/2: Both dead\n  Network 3: Since 2009, current version 241\n  Network 4: Since 2010, current version 96\n\n####  Version numbers here are via URL packs\n\n######  So 241 + 96 different sets of C&C URLs\n  If you know all the URL packs you can sinkhole them and find out info of old infections!\n\n####  You can find many domains from the URL packs in reports on the internet\n\n\n-----\n\n# Network #2 Sample\n\n#### Injects into explorer.exe, starts immediately with the P2P algorithm and then falls back to a hard-coded list of domains.\n\n###### MD5 334B385F8DD9A8C70CF70D0D2BF9F9E7 SHA1 9B11CD8822F780275F23155AC0F92B44E9081A04\n\n\n-----\n\n# Network #3 Sample\n\n#### Injects into a random process Annoying port behavior – reinventing the TCP wheel over UDP:\n\n###### MD5 B2FB74393D65E8CF91158D6DAAADC70A\n\n\n-----\n\n# P2P Algorithm\n\n####  UDP; default port 9674 but calculated from the computer name\n  Peers keep a “goodcount” value -> makes fake peer injection more difficult\n  Networks 3/4 have nearly the same commands (only the URL pack payload is\n slightly different):\n\n######  Network 4 uses 2048 RSA instead of 1024 for the certificate\n  Network 4 opens a TCP port on default 9673 for file transfer\n\n\n-----\n\n# P2P Algorithm\n\n####  Reinventing the TCP wheel\n\n######  “OK” responses\n  One UDP port per connection (annoying); has a time-out\n  One port always open for incoming control connections\n\n####  Basic commands:\n\n######  1 = Announcement & Promotion (“here I am!”, shares port number)\n  2 = Peer Exchange (exchanging 1 single peer: IP:Port)\n  3 = Pack Exchange (exchanging the URL list, both ways)\n\n####  Assigning internal (NOT shared) peer ids:\n\n######  < 16000000: low peer id, not reachable from outside (NAT)\n  >: High peer id, supernode\n\n\n-----\n\n# P2P Statistics\n\n\n#### 7/22/2014:\n\n 9/24/2015:\n\n|Network|Inactive|Active|Supernode|Total|\n|---|---|---|---|---|\n|#3|85|414.688|923|415.696|\n|#4|195|91.644|157|91.996|\n|Total|280|506.332|1.080|507.692|\n\n|Network|Inactive|Active|Supernode|Total|\n|---|---|---|---|---|\n|#3|19|251.279|161|251.459|\n|#4|218|68.919|56|69.193|\n|Total|237|320.198|217|320.652|\n\n\n-----\n\n# URL Packs\n\n\n\n####  Examples (they always use hacked servers):\n\n|221|http://mersinescortlari.com/logo.gif|Criminals|192.168.25.8|\n|---|---|---|---|\n||http://www.plsexpress.com/images/logo.gif|Ghosted||\n||http://paepailin.com/logo.gif|Criminals|61.19.249.48|\n||http://deresut.com/logo.gif|Criminals|79.98.132.170|\n||http://smtrofeus.com.br/logo.gif|Criminals|187.63.191.11|\n||http://nbfix.net/logo.gif|Parked/expired|119.59.124.56|\n||http://refkajparis.fr/logo.gif|Criminals|213.186.33.3|\n\n|185|http://doasoil.gov.np/images/logo.gif|Parked/expired|202.45.144.24|\n|---|---|---|---|\n||http://earnestbiz.com/img/logof.gif|Criminals|119.252.152.151|\n||http://fotozenistanbul.com/images/logo.gif|Criminals|178.210.174.10|\n||http://cmyj.co.th/images/logo.gif|Criminals|27.254.40.97|\n||http://chonkanya.ac.th/images/logo.gif|Parked/expired|27.254.83.226|\n||http://dinamikdekor.com/images/logof.gif|Criminals|94.103.35.2|\n||http://aniketkulkarni.in/images/logo.gif|Parked/expired|65.98.57.194|\n||http://alabousco.com/en/images/logof.gif|Sinkhole by K&A|69.195.129.70|\n||http://comsindia.com/images/logo.gif|Criminals|144.76.91.236|\n||http://muaythaiphuketschool.com/logos.gif|Not in namespace||\n\n\n-----\n\n# URL Packs\n\n####  The P2P crawler writes them all out to a text file, that way Lookingglass knows\n first-hand all the (previous) domains!\n\n  URL Packs already in the trap: 0, 8, 10, 11, 12, 14, 15, 20, 30, 31, 63, 64, 65,\n 66, 69, 71, 77, 78, 80, 82, 83, 84, 85, 87, 88, 89, 91, 92, 93, 94, 95, 96, 138, 156, 160, 165, 179, 195, 219, 223, 224, 226, 227, 68, 116, 124, 129, 130, 131, 133, 136, 137, 141, 142, 144, 145, 147, 152, 153, 154, 155, 157, 158, 159, 161, 162, 164, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 197, 198, 200, 201, 202, 203, 204, 205, 206, 207, 208, 210, 211, 212, 213, 214, 215, 216, 217, 218, 220, 221, 222, 225, 228, 229, 230, 231, 234, 236, 240, 241\n\n  K&A targets to sinkhole every single Sality botnet\n\n\n-----\n\n# URL Packs\n\n\n\n####  Network 4 has many invalid C&C URLs in its URL packs:\n\nhttp://padrup.com.ds/sobaka1.gif Not in namespace\n95\nhttp://46.105.103.219/sobakavolos.gif IPv4 address\n\nhttp://slwocfd/sobaka1.gif Not in namespace\n96\nhttp://46.105.103.219/sobakavolos.gif IPv4 address\n\n####  There is no .ds TLD!\n  “slwocfd” is not a valid domain as well!\n\n  Unknown why they use invalid URLs.\n\n|95|http://padrup.com.ds/sobaka1.gif|Not in namespace|Col4|\n|---|---|---|---|\n||http://46.105.103.219/sobakavolos.gif|IPv4 address|46.105.103.219|\n|96|http://slwocfd/sobaka1.gif|Not in namespace||\n||http://46.105.103.219/sobakavolos.gif|IPv4 address|46.105.103.219|\n\n\n-----\n\n# More interesting observations\n\n#### One C&C domain: 0-0-1-1-1-0-1-1-1-0-0-1-1-0-1-0-1-1-0-0-1-0-0-1-1-1-1-1-1-1-1-.0-0-0-0-0-0-0- 0-0-0-0-0-0-49-0-0-0-0-0-0-0-0-0-0-0-0-0.info\n\n Yes that’s a valid domain.\n\n Domains are easy to find, they usually use “/logo.gif” or similar document paths. It creates the mutexes “purity_control_4428” and “kukutrusted!” to verify if it’s already running. [4]\n\n\n-----\n\n# URLs in the URL Packs\n\n####  Every URL points to an executable file that is simply RC4 encrypted in blocks\n  It is downloaded by Sality and executed\n```\n char * Sality_C2_Key = \"GdiPlus.dll\";\n for (unsigned n = 0; n < Sality_C2_Payload_Size; n += 1024)\n     rc4((BYTE *)Sality_C2_Payload + n, 1024, (BYTE *)Sality_C2_Key, strlen(Sality_C2_Key));\n\n  No certificate! Anyone can encrypt executables and distribute to Sality infections by taking over existing C&C URLs (registering expired ones).\n  (vs RSA signature in P2P commands)\n  (interestingly there is no C&C panel – just the plain binary on servers)\n\n```\n\n-----\n\n# Latest URL Pack File\n\n#### Latest URL pack version: 240 from 8/24/2015 19:42 http://frmaurice.org/images/bottom.gif\n\nhttp://tattooinindia.com/bottom.gif\nhttp://intermarc-ng.com/img/bottom.gif\nhttp://bajaparkingcommx.ipower.com/bottom.gif\n\n#### http://tattooinindia.com/bottom.gif 13 KB, RC4 encrypted http://79.96.88.43/bottom.gif\n\n\n-----\n\n# Rootkit\n\n#### Simple (5 KB) but effective rootkit (driver based), creates a device: [3]\n```\n\\Device\\amsint32\n\\DosDevices\\amsint32\n\n Kills processes by using NtTerminateProcess Filters IP packets and drops packets containing certain AV vendor strings (picture on the right [3])\n\n###### amsint.sys 4.56 Kb MD5 31DE33A273CF87952E94D3534335A9B1 SHA1 4DF636D4DE33D549A3A6E27CA75E8EB60E77C77A\n\n```\n\n-----\n\n# Simple Evilness\n\n###### Modifying simple but effective registry keys to stop Windows notifications:\n```\nSOFTWARE\\Microsoft\\Security Center\nAntiVirusOverride\nAntiVirusDisableNotify\nFirewallDisableNotify\nFirewallOverride\nUpdatesDisableNotify\nUacDisableNotify\nAntiSpywareOverride\n\n https://malwr.com/analysis/OGRiNTU2Y2U0ZmY1NGQ1YmI2MjU5ZTRiYjZiNDc4MjU/\n\n```\n\n-----\n\n# Remediation\n\n\n-----\n\n# How to remove on a single machine\n\n#### 1. Enable Windows update 2. Done!\n\n\n-----\n\n# How to remove on a single machine\n\n#### 1. Enable Windows update 2. Done!\n\n  MSRT will kill it\n\n###### http://blogs.technet.com/b/mmpc/archive/2012/02/21/pramro-and-sality-two-pes-in-a-pod.aspx\n\n “The second of the families added to the February release of the Microsoft Malicious Software Removal Tool (MSRT) is Win32/Pramro. Win32/Pramro is a family of trojans that can act as a SOCKS proxy on an infected computer. In this case, this proxy may be used to relay spam and HTTP traffic. Detection was first added for Pramro variants in January 2008.\n\n There is a strong connection with the polymorphic file infector Win32/Sality, which shares portions of code with Pramo.“\n\n\n-----\n\n# How to remove globally\n\n####  Enable Windows update everywhere?\n  P2P botnet control is not an option without having the secret RSA key to sign commands.\n  Potentially send a disinfector via the URL pack channels; however that would require takeover of legitimate websites\n\n\n-----\n\n# LIVE DEMO\n\n## P2P Crawler\n\n\n-----\n\n# Conclusion\n\n\n\n####  Simple file infector + rootkit + mass = success\n\n  Didn’t get much attention\n  Probably the oldest still actively maintained Trojan?\n\n\n-----\n\n### Thanks for attending the presentation! Questions?\n\n For any information please contact: virustracker@lgscout.com\n\n © 2015 LookingGlass Cyber Solutions\n\n\n-----\n\n# References\n\n###### [1] Symantec reports on Sality http://www.symantec.com/connect/blogs/all-one-malware-overview-sality http://www.symantec.com/connect/blogs/sality-botnet http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/sality_peer_to_peer_viral_network.pdf http://www.symantec.com/security_response/writeup.jsp?docid=2006-011714-3948-99\n\n [2] SoK: P2PWNED — Modeling and Evaluating the Resilience of Peer-to-Peer Botnets http://www.christian-rossow.de/publications/p2pwned-ieee2013.pdf\n\n [3] Sality Rootkit Analysis http://artemonsecurity.blogspot.cz/2013/01/sality-rootkit-analysis.html\n\n [4] Sality gets upgrade http://www.totaldefense.com/security-blog/sality-gets-upgrade\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.botconf.eu/wp-content/uploads/2015/12/OK-P18-Kleissner-Sality.pdf"
    ],
    "report_names": [
        "OK-P18-Kleissner-Sality.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1448551453,
    "ts_modification_date": 1448551453,
    "files": {
        "pdf": "https://archive.orkl.eu/a32e1a4407cc82ee190feded10e009fa13854f4c.pdf",
        "text": "https://archive.orkl.eu/a32e1a4407cc82ee190feded10e009fa13854f4c.txt",
        "img": "https://archive.orkl.eu/a32e1a4407cc82ee190feded10e009fa13854f4c.jpg"
    }
}