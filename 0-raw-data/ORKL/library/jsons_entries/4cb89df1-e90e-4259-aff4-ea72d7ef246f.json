{
    "id": "4cb89df1-e90e-4259-aff4-ea72d7ef246f",
    "created_at": "2023-01-12T15:00:17.206141Z",
    "updated_at": "2025-03-27T02:05:52.215604Z",
    "deleted_at": null,
    "sha1_hash": "a643483249d08de54940bcf72afeca290d16699e",
    "title": "2020-04-08 - Deep Dive Into TrickBot Executor Module “mexec”- Hidden “Anchor” Bot Nexus Operations",
    "authors": "",
    "file_creation_date": "2022-05-28T17:57:42Z",
    "file_modification_date": "2022-05-28T17:57:42Z",
    "file_size": 689355,
    "plain_text": "# Deep Dive Into TrickBot Executor Module “mexec”: Hidden “Anchor” Bot Nexus Operations\n\n**[labs.sentinelone.com/deep-dive-into-trickbot-executor-module-mexec-hidden-anchor-bot-nexus-operations/](https://labs.sentinelone.com/deep-dive-into-trickbot-executor-module-mexec-hidden-anchor-bot-nexus-operations/)**\n\nJason Reaves\n\n_New “mexec” module delivers tertiary malware and allows TrickBot to pivot within a network,_\n_deploy a variety of payloads and evade common detection methods._\n\n**By Jason Reaves, Joshua Platt & Vitali Kremez**\n\n## Executive Summary\n\nTrickBot continues to be one of the most potent and actively developed malware\nframeworks in use on the crimeware landscape.\nTrickBot loads many modules leveraged for various tasks such as secondary tasks that\nnormally revolve around credential loss, system and network profiling, data harvesting\nand propagation.\nThe new executor `mexec module is special in that it is primarily deployed for`\ndelivering tertiary malware which allows the TrickBot group threat actors to pivot within\nthe compromised network environment while deploying different-purpose malware\npayloads and evading detection.\nThe `mexec module is primarily considered to be a loading module as its job is to load`\nanother malware payload onto the system.\n\n\n-----\n\nThe module comes in two flavors: one as a downloader that will download and\nexecute an arbitrary file and another as a “dropper” that embeds another malware\nwithin the `mexec body to be dropped on the system.`\n\n## Background\n\nTrickBot is the successor of Dyre [1,2], and at first was primarily focused on banking fraud\nand utilized injection systems in the same manner. Over the years, TrickBot has shifted focus\nto enterprise environments to incorporate everything from network profiling and mass data\ncollection to lateral traversal exploits. This focus shift is also prevalent in their incorporation\nof malware and techniques in their tertiary deliveries that are targeting enterprise\nenvironments. Such behavior is similar to a company where the focus will shift depending on\nwhat generates the best revenue.\n\n## Research Insights\n\nThe `mexec module, a possible initial internal naming for “memory executor”, acts as a`\ndownloader and can be described as a tool that can be detonated in memory designed to\ndownload and execute another executable. Most of the important strings are obfuscated as\nunicode strings that will be loaded in chunks.\n\n\n-----\n\nIn the screenshot above we can see the IP and URI that will be used as well as the\nobfuscation of dynamically rebuilding the strings on the fly that was previously mentioned.\n\nAfter downloading, the file will be written to disk:\n\n\n-----\n\nThe filename itself is hardcoded in the sample and remains static for all variants and\nsamples we have so far recovered.\n\nThe folder the file will be written to will depend on what the module has access to. First, it\nchecks if it can write to the Windows system folder; if not it tries the AppData folder and\nfinally tries the Temp folder.\n\n\n-----\n\nNotably, the downloader also sets up process security information to adjust downloader\npermission leveraging via a sequence of Windows API GetNamedSecurityInfoW,\nSetEntriesInAclW, SetNamedSecurityInfoW. The possible security control list implementation\nis aimed to bypass file execution prevention as downloaded from a remote location.\n\n\n-----\n\nTwo other samples of `mexec were recovered during our ongoing research:`\n\nSHA256: 5b729cd36cf3f0fdcfa0020b1f0f3bb98f9b456005814e61349bfdc50f390a7e\n\nSHA1: f82753b1d526da357e4cbcfa24e80e79422b8bce\n\nURL: 172.82[.]152[.]15/blueberry.exe\n\nSHA256: cd2e0341119cfbf734917f83d91a14d5855906a83066649bd49689e504181330\n\nSHA1: d0a1bcc0df0ff70b5fb90704adab7fee734fc21d\n\nURL: 172.82[.]152[.]15/aspen.exe\n\nPivoting on this IP in VirusTotal shows a number of URLs that look like TrickBot deliveries but\nalso an EXE file that has the same naming structure as previously seen.\n\n\n-----\n\nThe sample downloaded as cloudberry.exe turns out to be the DNS variant of Anchor\nTrickBot[3], which is referenced as the gtag ‘anchor_dns’.\n\nThe discovery of a `mexec module used by TrickBot that is designed to be a loader is`\nnotable and is further evidence of the link between TrickBot and Anchor operations. In many\naspects, the Anchor malware remains to be the adopted custom flexible version of the\nTrickBot fork codebase deployed on some of the most notable high-value government and\ncorporate targets.\n\nThe new module also brings to light a feature within TrickBot that is commonly taken for\ngranted: its ability to deliver other malware. This module adds another loading avenue to the\nexisting arsenal present within TrickBot. In a follow up to this report, we will discuss a variant\nof `mexec that delivers malware samples that are onboard instead of downloading them,`\nwhich sheds more light on this connection between TrickBot and Anchor.\n\n**Delivery Names Discovered for** `mexec Downloader Variant`\n\nmexecDll(32|64)\n\nmexectDll(32|64)\n\naexecDll(32|64)\n\nonixDll(32|64)\n\n**TrickBot File Indicators**\n\n\n-----\n\nAppDataRoaming[ ]+injectDll(32|64).dll\nAppDataRoaming[^]+systeminfo(32|64).dll\nAppDataRoaming[^]+pwgrab(32|64).dll\nAppDataRoaming[^]+anubis(32|64).dll\nAppDataRoaming[^]+shadnew(32|64).dll\nAppDataRoaming[^]+onixDll(32|64).dll\n\n**Generic**\n\nAppDataRoaming[^]+[a-zA-Z]+(32|64).dll$\n\nAppDataRoaming[^]+[a-zA-Z]+(32|64)_configs*\n\n**Observed** `mexec Filenames`\n\nWindowssystem32installapp.exe\n\nWindowssyswow64installapp.exe\n\n%AppData%installapp.exe\n\nTempinstallapp.exe\n\n## Indicators of Compromise\n\n**Download URLs**\n```\nhxxp://172[.]82[.]152[.]15/cloudberry.exe\nhxxp://64.91[.]251[.]250/UgaNda73n\nhxxp://85.204[.]116[.]245/chishir.exe\nhxxp://104[.]168[.]98[.]206/Nuclear.exe\nhxxp://198[.]46[.]161[.]242/cranberry.exe\nhxxp://185[.]98[.]87[.]185/Atomic.exe\nhxxp://107.173.160[.]14/blueberry.exe\nhxxp://107.173.160[.]14/cranberry.exe\n\n```\n**OSINT mexec samples**\n```\nSHA1: 3ef000cb90ab638ab0bae542c2d6e8e6ec146c53\nSHA1: 0e29a1f93b003c31af46ab1ab7c8d3df150123e0\nSHA1: dacd5b49ac628157fcb9cf8d6e537e851ef29a64\n\n## YARA\n\n```\n\n-----\n\n```\nrule anchor_dns_32\n{\nmeta:\nauthor=\"Jason Reaves\"\nstrings:\n  $a1 = \"/1001/\" ascii wide\n  $a2 = \":$GUID\" ascii wide\n  $a3 = \":$TASK\" ascii wide\n  $ua = \"WinHTTP loader/1.0\" ascii wide\n  $hexlify = {0f be ?? ?? b8 f0 00 00 00 0f 45 ?? 8b ?? c1 e1 02 23 d0}\n  $sdecode = {8a 04 0a 0f be c0 83 e8 ?? 88 04 0a 42 83}\n  $xor_data = {80 b4 05 ?? ?? ff ff ?? 40 3b c6}\ncondition:\n  3 of them\n}\nrule anchor_dns_64\n{\nmeta:\nauthor=\"Jason Reaves\"\nstrings:\n  $xor_data = {80 ?4 0? ?? ?? 48 ?? c? 48}\n  $hexlify = {81 c1 f0 00 00 00 23 d1 41 8? ?? c1 e1 02}\n  $a1 = \"/1001/\" ascii wide\n  $a2 = \":$GUID\" ascii wide\n  $a3 = \":$TASK\" ascii wide\n  $ua = \"WinHTTP loader/1.0\" ascii wide\ncondition:\n  3 of them\n}\n\n## References\n\n```\n1: [https://blog.malwarebytes.com/threat-analysis/2016/10/trick-bot-dyrezas-successor/](https://blog.malwarebytes.com/threat-analysis/2016/10/trick-bot-dyrezas-successor/)\n\n2: [https://www.fidelissecurity.com/threatgeek/archive/trickbot-we-missed-you-dyre/](https://www.fidelissecurity.com/threatgeek/archive/trickbot-we-missed-you-dyre/)\n\n3: https://www.sentinelone.com/wp-content/uploads/the-deadly-planeswalker-how-thetrickbot-group-united-high-tech-crimeware-apt/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-08 - Deep Dive Into TrickBot Executor Module “mexec”- Hidden “Anchor” Bot Nexus Operations.pdf"
    ],
    "report_names": [
        "2020-04-08 - Deep Dive Into TrickBot Executor Module “mexec”- Hidden “Anchor” Bot Nexus Operations.pdf"
    ],
    "threat_actors": [
        {
            "id": "e79324a2-bdae-4dc5-9421-578a59045288",
            "created_at": "2022-10-25T16:07:23.906087Z",
            "updated_at": "2025-03-27T02:02:10.022303Z",
            "deleted_at": null,
            "main_name": "Nightshade Panda",
            "aliases": [
                "APT 9",
                "FlowerLady",
                "FlowerShow",
                "Group 27",
                "Nightshade Panda",
                "Operation Seven Pointed Dagger"
            ],
            "source_name": "ETDA:Nightshade Panda",
            "tools": [
                "3102 RAT",
                "9002 RAT",
                "Agent.dhwf",
                "BKDR_EVILOGE",
                "BKDR_HGDER",
                "BKDR_NVICM",
                "Chymine",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "EvilGrab",
                "EvilGrab RAT",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "HidraQ",
                "Homux",
                "Hydraq",
                "Kaba",
                "Korplug",
                "McRAT",
                "MdmBot",
                "MoonWind",
                "MoonWind RAT",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "Vidgrab",
                "Wmonder",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535617,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1653760662,
    "ts_modification_date": 1653760662,
    "files": {
        "pdf": "https://archive.orkl.eu/a643483249d08de54940bcf72afeca290d16699e.pdf",
        "text": "https://archive.orkl.eu/a643483249d08de54940bcf72afeca290d16699e.txt",
        "img": "https://archive.orkl.eu/a643483249d08de54940bcf72afeca290d16699e.jpg"
    }
}