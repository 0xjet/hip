{
    "id": "52671625-96c0-44cf-a72d-018c445f7f13",
    "created_at": "2023-03-03T02:07:04.459175Z",
    "updated_at": "2025-03-27T02:05:52.794137Z",
    "deleted_at": null,
    "sha1_hash": "2d44ec279bad73fa3648c93082275f32ae4ff698",
    "title": "2023-02-07 - Cl0p Ransomware Targets Linux Systems with Flawed Encryption - Decryptor Available",
    "authors": "",
    "file_creation_date": "2023-03-01T09:13:41Z",
    "file_modification_date": "2023-03-01T09:13:41Z",
    "file_size": 999012,
    "plain_text": "# Cl0p Ransomware Targets Linux Systems with Flawed Encryption | Decryptor Available\n\n**[sentinelone.com/labs/cl0p-ransomware-targets-linux-systems-with-flawed-encryption-decryptor-available/](https://www.sentinelone.com/labs/cl0p-ransomware-targets-linux-systems-with-flawed-encryption-decryptor-available/)**\n\nAntonis Terefos\n\n## Executive Summary\n\nSentinelLabs has observed the first Linux variant of Cl0p ransomware.\nThe ELF executable contains a flawed encryption algorithm making it possible to\ndecrypt locked files without paying the ransom.\n[SentinelLabs has published a free decryptor for this variant here.](https://github.com/SentineLabs/Cl0p-ELF-Decryptor)\n\n## Background\n\n[SentinelLabs observed the first ELF variant of Cl0p (also known as Clop) ransomware](https://www.virustotal.com/gui/file/09d6dab9b70a74f61c41eaa485b37de9a40c86b6d2eae7413db11b4e6a8256ef)\nvariant targeting Linux systems on the 26th of December 2022. The new variant is similar to\nthe Windows variant, using the same encryption method and similar process logic.\n\nThe mentioned sample appears to be part of a bigger attack that possibly occurred around\n[the 24th of December against a University in Colombia (sample1,](https://www.virustotal.com/gui/file/a9741b16f4169f56ae0f2e49c87f3c5360ed5ab4370e6d16bd86179999f11795) [sample2,](https://www.virustotal.com/gui/file/c793a9225d799150538f058c886e2806083f6bc33813a3bd8231ab2775b7ec2f) [sample3,](https://www.virustotal.com/gui/file/dd2f458a29b666bbfe5a5dbf6a36c906d0140e0ae15b599e8b4da1863e7e41ff)\n[sample4,](https://www.virustotal.com/gui/file/46cd508b7e77bb2c1d47f7fef0042a13c516f8163f9373ef9dfac180131c65ed) [sample5). On the](https://www.virustotal.com/gui/file/f1b8c7b2d20040f1dd9728de9808925fdcf035a1a289d42f63e5faa967f50664) [5th of January the cybercrime group leaked victim’s data on their](https://twitter.com/TMRansomMonitor/status/1610779008332959745)\nonion page.\n\n## ELF Technical Analysis\n\nThe ELF Cl0p variant is developed in a similar logic to the Windows variant, though it\ncontains small differences mostly attributed to OS differences such as API calls. It appears to\nbe in its initial development phases as some functionalities present in the Windows versions\ndo not currently exist in this new Linux version.\n\nA reason for this could be that the threat actor has not needed to dedicate time and\nresources to improve obfuscation or evasiveness due to the fact that it is currently\n[undetected by all 64 security engines on VirusTotal.](https://www.virustotal.com/gui/file/09d6dab9b70a74f61c41eaa485b37de9a40c86b6d2eae7413db11b4e6a8256ef) [SentinelOne Singularity detects Cl0p](https://www.sentinelone.com/platform/)\nransomware on both Linux and Windows devices.\n\n\n-----\n\nSentinelOne Singularity detects Cl0p Linux ransomware\n[Initially, the ransomware creates a new process by calling fork and exits the parent-process.](https://man7.org/linux/man-pages/man2/fork.2.html)\nThe child-process sets its file mode creation mask to any permission (read, write, execute)\n[by calling umask(0). It then calls](https://man7.org/linux/man-pages/man2/umask.2.html) [setsid, creates a session and sets the process group ID. It](https://man7.org/linux/man-pages/man2/setsid.2.html)\n[tries to access root by changing the working directory to “/” (chdir(“/”)). Once the permissions](https://man7.org/linux/man-pages/man2/chdir.2.html)\nare set, the ransomware proceeds encrypting other directories.\n\n## Targeted Folders & Files\n\nWhile the Windows versions contain a hashing algorithm in order to avoid encrypting specific\nfolders and files, such functionality was not observed in the Linux variant. The ELF variant\ntargets specific folders, subfolders and all files/types.\n\nThe discovered ELF sample targets files contained in the following directories for encryption,\nthough we do not exclude the possibility of future versions including more directories.\n\n**Folder** **Description**\n\n/opt Contains subdirectories for optional software packages\n\n/u01 Oracle Directory, mount point used for the Oracle software only.\n\n/u02 Oracle Directory, used for the database files.\n\n/u03 Oracle Directory, used for the database files.\n\n/u04 Oracle Directory, used for the database files.\n\n/home Contains the home directory of each user.\n\n/root Contains the home directory of the root user.\n\n## Encryption Flaw\n\n\n-----\n\n[Windows versions of Cl0p ransomware use a Mersenne Twister PRNG (MT19937) to](https://dl.acm.org/doi/10.1145/272991.272995)\ngenerate a 0x75 bytes size RC4 key for each file. This key is then validated (checks if the\nfirst five bytes are NULL) and used for file encryption. Then, by using the RSA public key, it\nencrypts the generated RC4 key and stores it to $filename.$clop_extension. Victims who\npay the ransom demand receive a decryptor which decrypts the generated Cl0p file using the\nRSA private key, retrieves the generated RC4 key, and then decrypts the encrypted file.\n\nThis core functionality is missing in the Linux variant. Instead, we discovered a flawed\nransomware-encryption logic which makes it possible to retrieve the original files without\npaying for a decryptor.\n\nThe Linux variant contains a hardcoded RC4 “master-key” which, during the execution of the\nmain function, is copied into the global variable szKeyKey.\n\nSample’s RC4 “master-key”:\n```\nJfkdskfku2ir32y7432uroduw8y7318i9018urewfdsZ2Oaifwuieh~~cudsffdsd\n\n\n```\nDuring the file encryption phase, the ransomware – similar to the Windows version –\ngenerates a 0x75 bytes size RC4 key, with the use of a lookup table and a PRNG byte. This\ngenerated RC4 key is used to encrypt the mappedAddress and write it back to the file.\n\nThen by using the RC4 “master-key” the ransomware encrypts the generated RC4 key and\nstores it to $filename.$clop_extension. By using a symmetric algorithm (second RC4) to\n“encrypt” the file’s RC4 key, we were able to take advantage of this flaw and decrypt Cl0pELF encrypted files.\n\nCl0p-ELF encryption flaw\nCl0p-ELF Decryption Logic:\n\n1. Retrieve RC4 “master-key”.\n2. Read all $filename.$clop_extension.\n3. Decrypt with RC4 using the RC4 “master-key”, the generated RC4 key.\n4. Decrypt $filename with RC4 using the generated RC4 key.\n5. Write decrypted to $filename.\n\n[We packed all this logic into the following Python script.](https://github.com/SentineLabs/Cl0p-ELF-Decryptor)\n\n\n-----\n\n## Cl0p File-Key Creation Flaw\n\nThe 0x75 bytes size PRNG RC4 key is encrypted with RC4 using the RC4 “master-key”. The\nencrypted RC4 output is 0x75 bytes size, though writes 0x100 bytes into the created Cl0p\nkey $filename.$clop_extension. This results in writing memory data to the file and more\nspecifically stack variables.\n\nCl0p-ELF file-key creation flaw.\nThis flaw provides some information regarding the file before encryption. This includes:\n\nFile [fstat64 result](https://man7.org/linux/man-pages/man2/lstat.2.html)\n\ntotal size, in bytes, file size (st_size)\ntime of last status change, exact time of file encryption (st_ctime)\nand more forensics information regarding the file before the encryption.\nSize of buffer for file encryption (with check of >= 0x5f5e100 )\n\n\n-----\n\nRC4 master-key size\nRC4 PRNG key size\n```\nstruct clopelfkeyfile {\n\n     byte encr_rc4key[117]; // encrypted RC4 PRNG key, size 0x75 bytes\n\n     stat fdstat; // stat(fd, &fdstat), size 0x58 bytes\n\n     long fdid; // file node unique id, size 0x8 bytes\n\n     int fd; // file descriptor, size 0x4 bytes\n\n     int fdmappedaddr; // file mapped address, size 0x4 bytes\n\n     off_t fdsize; // file size, size 0x8 bytes\n\n     int rc4_msize; // RC4 \"master-key\" size, size 0x4 bytes\n\n     long rc4_fsize; // RC4 PRNG key size, size 0x8 bytes\n\n     int fdnameaddr; // filename string address, size 0x4 bytes\n\n     int frameaddr; // frame pointer address, size 0x4 bytes\n\n     int retaddr; // function return address, size 0x4 bytes\n\n     byte fdpathaddr[3]; // part of filepath strings address, size 0x3 bytes\n\n}\n\n\n## Developed Functions & Names\n\n```\nIn ELF binaries the .symtab, [Symbol Table Section, holds information needed to locate and](https://refspecs.linuxbase.org/elf/gabi4+/ch4.symtab.html)\nrelocate a program’s symbolic definitions and references, allowing us to retrieve function and\nglobal variable names.\n\n**Function Name** **Description**\n\ndo_heartbeat(void) Main function which starts the encryption of various folders.\n\n\nfind(char *,char\nconst*)\n\nCreateRadMe(char\n*)\n\n\nMultiple calls of this function are done by do_heartbeat; this function\ntakes as parameter 1) the starting folder to encrypt (example, “/opt”)\n2) regex of files to encrypt (example, “*.*”) and performs a recursive\nsearch from the starting folder until encrypts the “matching” regex\nfiles.\n\nThis function takes as parameter the folder to create the ransom\nnote.\n\n\nEncrFile(char *) Encrypts given filepath.\n\nexistsFile(char *) Checks if File exists, or if the process has the permissions to open.\n\n\n_rc4Full(void\nconst*,ushort,void\n*,ulong)\n\nCreatekey(char\n*,uchar *)\n\n\nWrapper function to _rc4Init and _rc4, which is used to encrypt a\nbuffer with a given key.\n\nCreates and writes into “%s.C_I_0P” the encrypted buffer.\n\n\n-----\n\n**Global**\n**Variable**\n\n\n**Description**\n\n\nszKeyKey Global variable of 0x64 bytes size, initialized during main function, containing\nRC4 “master-key” which encrypts the “randomly” generated 0x75 bytes size\nRC4 key.\n\n## Differences to Windows Variant\n\nRather than simply port the Windows version of Cl0p directly, the authors have chosen to\nbuild bespoke Linux payloads. We understand this to be the primary reason for the lack of\nfeature parity between the new Linux version and the far more established Windows variant.\n\nSentinelLabs expects future versions of the Linux variant to start eliminating those\ndifferences and for each updated functionality to be applied in both variants simultaneously.\n\nSome of the differences worth highlighting are detailed below:\n\n**Differences** **Description**\n\n\nFiles/Folders\nexclusions\n\nExtension\nexclusions\n\nDifferent\nmethods of\nReading/Writing\ndepending on\nfile size.\n\nRansom Note\nDecryption\n\nDrive\nenumeration\n\nRC4 default\nKey\n\n\nThe Windows variant contains a hashing algorithm which excludes\nspecific folders and files from encryption. This functionality was not\nobserved in the Linux variant.\n\nThe Windows variant contains a hardcoded list of extensions to exclude\nfrom encryption. This functionality was not observed in the Linux\nvariant.\n\nThe Windows variant, depending on the size of the file, will choose\ndifferent methods of reading a file and writing the encrypted buffer.\nSmall files are ignored, medium-sized files will make use of\n[ReadFile/WriteFile, large files will use](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-readfile)\n[CreateFileMappingW/MapViewOfFile/UnmapViewOfFile. The Linux](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-createfilemappingw)\n[variant encrypts all the files using mmap64/munmap. Both variants only](https://linux.die.net/man/3/mmap64)\nencrypt the first 0x5f5e100 bytes of large files.\n\nThe Windows variant stores the encrypted ransom note as a resource\nand decrypts it with a simple XOR algorithm. The Linux variant stores\nthe note as plain text in “.rodata”.\n\nThe Windows variant initially enumerates through drives in order to\n“find” the starting point to recursively encrypt the folders. The Linux\nvariant contains hardcoded “starting” folders.\n\nOnce the Windows variant generates a 0x75 size PRNG RC4 Key, it will\ncheck if the first 5 bytes are NULL; if so, it uses the default key for\nencryption. The Linux version does not perform this validation and does\nnot contain a default RC4 key in case the first 5 bytes of the PRNG RC4\nare NULL.\n\n\n-----\n\nCommand Line\nParameters\n\nRC4 Key\nEncryption\n\n\nThe Windows variant can be executed in three ways: 1) without\nparameters encrypting all local and network drives, 2) with “runrun”\nparameter encrypting only network drives, 3) with a file as parameter\nwhich contains the folders to be encrypted (observed\ntemp.ocx/temp.dat). The Linux variant does not accept command line\nparameters and recursively encrypts the specified hardcoded folders.\n\nThe Windows variant encrypts the generated RC4 key responsible for\nthe file encryption using the asymmetric algorithm RSA and a public key.\nIn the Linux variant, the generated RC4 key is encrypted with a RC4\n“master-key” (flawed logic).\n\n\n## Ransom Notes\n\nThe Linux variant of Clop ransomware drops a ransom note on victim machines with a .txt\nformat.\n\nELF sample ransom note, “README_C_I_0P.TXT”.\nThis differs somewhat from the Windows .rtf ransom note, although both use the email\n[addresses [email protected][.]com and](https://www.sentinelone.com/cdn-cgi/l/email-protection) `[email protected][.]com as ways for victims to`\ncontact the attackers.\n\n\n-----\n\nWindow samples ransom note, “!_READ_ME.RTF”.\n\n## Conclusion\n\n[Over the last twelve months or so we have continued to observe the increased targeting of](https://www.sentinelone.com/blog/watchtower-trends-and-top-cybersecurity-takeaways-from-2022/)\nmultiple platforms by individual ransomware operators or variants. The discovery of an ELF[variant of Cl0p adds to the growing list of the likes of Hive,](https://www.sentinelone.com/labs/hive-attacks-analysis-of-the-human-operated-ransomware-targeting-healthcare/) [Qilin,](https://www.youtube.com/watch?v=Ouzwu79abbs&t=5s) [Snake,](https://www.sentinelone.com/labs/new-snake-ransomware-adds-itself-to-the-increasing-collection-of-golang-crimeware/) [Smaug,](https://www.sentinelone.com/labs/multi-platform-smaug-raas-aims-to-see-off-competitors/) [Qyick and](https://www.sentinelone.com/labs/crimeware-trends-ransomware-developers-turn-to-intermittent-encryption-to-evade-detection/)\nnumerous others.\n\n[We know that Cl0p operations have shown little if no slow-down since the](https://www.bleepingcomputer.com/news/security/clop-ransomware-is-back-in-business-after-recent-arrests/) [disruption in June](https://cyberpolice.gov.ua/news/kiberpolicziya-vykryla-xakerske-ugrupovannya-u-rozpovsyudzhenni-virusu-shyfruvalnyka-ta-nanesenni-inozemnym-kompaniyam-piv-milyarda-dolariv-zbytkiv-2402/)\n2021. While the Linux-flavored variation of Cl0p is, at this time, in its infancy, its development\nand the almost ubiquitous use of Linux in servers and cloud workloads suggests that\ndefenders should expect to see more Linux-targeted ransomware campaigns going forward.\n\nSentinelLabs continues to monitor the activity associated with Cl0p. SentinelOne Singularity\nprotects against malicious artifacts and behaviors associated with Cl0p attacks including the\nELF variant described in this post.\n\n## Indicators of Compromise\n\n**IOC Type** **IOC Value**\n\n\n-----\n\nSHA1\nELF Cl0p\n\nSHA1\nWin Cl0p\n\nSHA1\nWin Cl0p\n\nSHA1\nWin Cl0p\n\nSHA1\nWin Cl0p\n\nSHA1\nWin Cl0p\n\nSHA1\nELF Cl0p\nNote\n\nSHA1\nWin Cl0p\nNote\n\nELF\nRansom\nNote\n\nWin\nRansom\nNote\n\nCl0p\nRansom\nExtension\n\nCl0p\nContact\nEmail\n\nCl0p\nContact\nEmail\n\nCl0p\nOnion\nLeak\nPage\n\n\n46b02cc186b85e11c3d59790c3a0bfd2ae1f82a5\n\n40b7b386c2c6944a6571c6dcfb23aaae026e8e82\n\n4fa2b95b7cde72ff81554cfbddc31bbf77530d4d\n\na1a628cca993f9455d22ca2c248ddca7e743683e\n\na6e940b1bd92864b742fbd5ed9b2ef763d788ea7\n\nac71b646b0237b487c08478736b58f208a98eebf\n\nba5c5b5cbd6abdf64131722240703fb585ee8b56\n\n77ea0fd635a37194efc1f3e0f5012a4704992b0e\n\nREADME_C_I_0P.TXT\n\n!_READ_ME.RTF\n\n.C_I_0P\n\nunlock[@]support-mult.com\n\nunlock[@]rsv-box.com\n\nhxxp[:]//santat7kpllt6iyvqbr7q4amdv6dzrh6paatvyrzl7ry3zm72zigf4ad[.]onion\n\n\n-----\n\nCl0p\nOnion\nChat\nPage\n\n\nhxxp[:]//6v4q5w7di74grj2vtmikzgx2tnq5eagyg2cubpcnqrvvee2ijpmprzqd[.]onion\n\n\n## YARA Rule\n```\nrule ClopELF\n\n{\n\n  meta:\n\n    author = \"@Tera0017/@SentinelLabs\"\n\n    description = \"Temp Clop ELF variant yara rule based on $hash\"\n\n    reference = \"https://s1.ai/Clop-ELF”\n\n    hash = \"09d6dab9b70a74f61c41eaa485b37de9a40c86b6d2eae7413db11b4e6a8256ef\"\n\n  strings:\n\n    $code1 = {C7 45 ?? 00 E1 F5 05}\n\n    $code2 = {81 7D ?? 00 E1 F5 05}\n\n    $code3 = {C7 44 24 ?? 75 00 00 00}\n\n    $code4 = {C7 44 24 ?? 80 01 00 00}\n\n    $code5 = {C7 00 2E [3] C7 40 04}\n\n    $code6 = {25 00 F0 00 00 3D 00 40 00 00}\n\n    $code7 = {C7 44 24 04 [4] C7 04 24 [4] E8 [4] C7 04 24 FF FF FF FF E8 [4] C9\nC3}\n\n  condition:\n\n    uint32(0) == 0x464c457f and all of them\n\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-07 - Cl0p Ransomware Targets Linux Systems with Flawed Encryption - Decryptor Available.pdf"
    ],
    "report_names": [
        "2023-02-07 - Cl0p Ransomware Targets Linux Systems with Flawed Encryption - Decryptor Available.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1677809224,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1677662021,
    "ts_modification_date": 1677662021,
    "files": {
        "pdf": "https://archive.orkl.eu/2d44ec279bad73fa3648c93082275f32ae4ff698.pdf",
        "text": "https://archive.orkl.eu/2d44ec279bad73fa3648c93082275f32ae4ff698.txt",
        "img": "https://archive.orkl.eu/2d44ec279bad73fa3648c93082275f32ae4ff698.jpg"
    }
}