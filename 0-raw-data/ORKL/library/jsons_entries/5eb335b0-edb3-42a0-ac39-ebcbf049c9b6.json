{
    "id": "5eb335b0-edb3-42a0-ac39-ebcbf049c9b6",
    "created_at": "2022-10-25T16:48:12.513103Z",
    "updated_at": "2025-03-27T02:08:33.332138Z",
    "deleted_at": null,
    "sha1_hash": "732e4e99e7023b758261dc360489db982f68348e",
    "title": "LIFARS  Vjw0rm - Case Study Whitepaper",
    "authors": "",
    "file_creation_date": "2021-09-07T13:55:33Z",
    "file_modification_date": "2021-09-07T10:58:20Z",
    "file_size": 5263052,
    "plain_text": "# Vjw0rm Worm/RAT\n\n### Prepared by:   LIFARS, LLC Date:  09/02/2021\n\n\n-----\n\n## EXECUTIVE SUMMARY\n\n\nVjw0rm is a worm that usually spreads via USB drives. It's also classified as a RAT because it executes\ncommands received from the C2 server. This malware achieves persistence using a Registry Run key and\nby copying itself to the Startup folder.\n\n\n## ANALYSIS AND FINDINGS\n\n\nWe will analyze a Javascript file called 45678-INVOICE.js, which can be downloaded from\nhttps://app.any.run/tasks/6a900492-4f4b-42a2-ab80-7f5a7262458b/. This is a hybrid worm/RAT called\nVjw0rm.\n\nJSTool is a Notepad++ plugin that is used to display the code in JavaScript format:\n\n###### Figure 1\n\n\n-----\n\nIn order to debug the code, we can add “<html> <script>” at the beginning of the file and\n“</script></html>” at the end of the file and save the file in the html format. We’ll use the\nDeveloper Tools from Internet Explorer and the “debugger” statement, which stops the execution of the\nJavaScript and calls the debugging function (note a long string that seems to be base64-encoded):\n\n###### Figure 2\n\n##### Figure 3\n\n\n-----\n\nInternet Explorer does its job and displays a warning message. One of the methods to analyze Javascript\nfiles consists of replacing the eval function with document.write (write a string to a document stream)\nbecause this way we can see what code would be executed. After performing the transformation, we can\nopen the html file again using Internet Explorer:\n\n\n###### Figure 4\n\n\nThe malware replaced “@!” from the long string that we’ve seen with “m”, as displayed in the figure below:\n\n\n###### Figure 5\n\n\nThe script decodes the long string using Base64 and executes it. We can use CyberChef\n(https://gchq.github.io/CyberChef/) to perform this operation and save the new script as 45678INVOICE_Layer2.js:\n\n\n###### Figure 6\n\n\nAs in the first script, the 2[nd] one decodes a base64-encoded string and then saves it as a js file called\n“laeapoOSVO.js” in the %AppData% directory. The malware executes the newly created file, as shown in\nfigure 7 (we’ll come back to this file in a few paragraphs).\n\n\n-----\n\n###### Figure 7\n\n\nThe process verifies if the registry key called “HKCU\\vjw0rm” exists, which indicates that the host has\nalready been infected with this RAT. If there is no such key, it is created and populated with “TRUE” or\n“FALSE” depending on the result of a comparison:\n\n\n###### Figure 8\n\n\nThe malware performs a POST request to “http[:]//194.5.97.156:7657/Vre” with a custom user agent. The\nresponse from the C2 server is saved for later use:\n\n\n-----\n\n###### Figure 9\n\n\nThe user agent from above contains a lot of information about the local host, such as computer name, user\nname, caption property that contains the OS version, antivirus software installed on the machine, a value\nwhich denotes if the .NET VBC (Visual Basic Compiler) v.2.0.50727 is installed on the host and the value of\nthe registry key “HKCU\\vjw0rm”, as shown in the next pictures:\n\n\n###### Figure 10\n\n\n##### Figure 11\n\n\n-----\n\nThe response from the C2 server has the following structure: “Command|V|Script|V|Filename”. The\nfollowing commands are implemented: “Cl”, “Sc”, “Ex”, “Rn”, “Up”, “Un” and “RF”, as shown in figure 12:\n\n\n###### Figure 12\n\n\n-----\n\nCl command\n\n  - exit the script\nSc command\n\n  - create a temporary file called “Filename” (provided by the C2 server)\n\n  - populate the new file with malicious payload sent by the server\n\n  - execute the malicious file\nEx command\n\n  - execute additional JS code provided by the C2 server\nRn command\n\n  - open and read the current file\n\n  - replace “SUCCESS” with a parameter received from the C2 server\n\n  - save and execute the script using wscript.exe\nUp command\n\n  - create a temporary file called “Filename” (provided by the C2 server)\n\n  - modify the payload received from the server by replacing “|U|” with “|V|”\n\n  - write the modified payload to the newly created file\n\n  - execute the script using wscript.exe\nUn command\n\n  - execute additional code received from the C2 server\n\n  - F-Secure reported at https://www.f-secure.com/v-descs/worm_js_vjw0rm.shtml that this\ncommand is used to uninstall the worm module\nRF command\n\n  - create a temporary file called “Filename” (provided by the C2 server)\n\n  - populate the new file with malicious payload sent by the server\n\n  - execute the malicious file\n\nFor our analysis, we renamed the “laeapoOSVO.js” file as “45678-INVOICE_Layer3.js”. This code is\nsimilar to the first script, however, there are a few differences. A snippet of the 3[rd] script is displayed in\nfigure 13.\n\n\n-----\n\n###### Figure 13\n\n\nWe apply the same transformation for the base64-encoded string as in the first case (“@!” is replaced with\n“m”). CyberChef is utilized to decode the string and the result is saved as 45678-INVOICE_Layer4.js:\n\n\n-----\n\n###### Figure 14\n\n\nThis script is similar to the Layer2 file, however the C2 server changes to\nhttp[:]//myroyailrubin2019.duia.ro:5000 (figure 15). The same commands as before are implemented by\nthis script.\n\n\n###### Figure 15\n\n\n-----\n\nThe script establishes persistence by creating a Run registry key called “SEJOKAOI5S” and by copying itself\nto the Startup folder, as displayed in figure 16.\n\n\n###### Figure 16\n\n\n### Indicators of Compromise\n\nC2 domains: - http[:]//194.5.97.156:7657\n\n       - http[:]//myroyailrubin2019.duia.ro:5000\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://lifars.com/wp-content/uploads/2021/09/Vjw0rm-.pdf"
    ],
    "report_names": [
        "Vjw0rm-.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041313,
    "ts_creation_date": 1631022933,
    "ts_modification_date": 1631012300,
    "files": {
        "pdf": "https://archive.orkl.eu/732e4e99e7023b758261dc360489db982f68348e.pdf",
        "text": "https://archive.orkl.eu/732e4e99e7023b758261dc360489db982f68348e.txt",
        "img": "https://archive.orkl.eu/732e4e99e7023b758261dc360489db982f68348e.jpg"
    }
}