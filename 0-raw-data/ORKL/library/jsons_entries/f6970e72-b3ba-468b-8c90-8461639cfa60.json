{
    "id": "f6970e72-b3ba-468b-8c90-8461639cfa60",
    "created_at": "2023-01-12T15:10:13.185107Z",
    "updated_at": "2025-03-27T02:09:07.813568Z",
    "deleted_at": null,
    "sha1_hash": "2e330f9e2f40c3c82b7a190fe66bbd9feaec173a",
    "title": "2022-01-11 - New SysJoker Backdoor Targets Windows, Linux, and macOS",
    "authors": "",
    "file_creation_date": "2022-05-28T15:52:21Z",
    "file_modification_date": "2022-05-28T15:52:21Z",
    "file_size": 1865565,
    "plain_text": "# New SysJoker Backdoor Targets Windows, Linux, and macOS\n\n**intezer.com/blog/malware-analysis/new-backdoor-sysjoker/**\n\nJanuary 11, 2022\n\nWritten by [Avigayil Mechtinger,](https://www.intezer.com/author/avigayil/) [Ryan Robinson and](https://www.intezer.com/author/ryanrobinson/) [Nicole Fishbein - 11 January 2022](https://www.intezer.com/author/nicolefishbein/)\n\n### Get Free Account\n\nJoin Now\n\n### Top Blogs\n\n**[Elephant Framework Delivered in Phishing Attacks Against Ukrainian Organizations](https://www.intezer.com/blog/research/elephant-malware-targeting-ukrainian-orgs/)**\n\nA recently developed malware framework called Elephant is being delivered in targeted spear\nphishing campaigns... [Read more](https://www.intezer.com/blog/research/elephant-malware-targeting-ukrainian-orgs/)\n\n**[New Conversation Hijacking Campaign Delivering IcedID](https://www.intezer.com/blog/research/conversation-hijacking-campaign-delivering-icedid/)**\n\nThis post describes the technical analysis of a new campaign detected by Intezer’s research\nteam,... [Read more](https://www.intezer.com/blog/research/conversation-hijacking-campaign-delivering-icedid/)\n\n**[Scale Incident Response with Detection Engineering: Intezer Detect & Hunt](https://www.intezer.com/blog/threat-hunting/scale-incident-response-detection-engineering/)**\n\nAdversaries are highly motivated, constantly expanding and improving their tools and techniques.\nOn the other... [Read more](https://www.intezer.com/blog/threat-hunting/scale-incident-response-detection-engineering/)\n\nMalware targeting multiple operating systems has become no exception in the malware threat\n[landscape. Vermilion Strike, which was documented just last September, is among the latest](https://www.intezer.com/blog/malware-analysis/vermilionstrike-reimplementation-cobaltstrike/)\nexamples until now.\n\n\n-----\n\nIn December 2021, we discovered a new multi-platform backdoor that targets Windows, Mac, and\nLinux. The Linux and Mac versions are fully undetected in VirusTotal. We named this backdoor\n**SysJoker.**\n\nSysJoker was first discovered during an active attack on a Linux-based web server of a leading\neducational institution. After further investigation, we found that SysJoker also has Mach-O and\nWindows PE versions. Based on Command and Control (C2) domain registration and samples\nfound in VirusTotal, we estimate that the SysJoker attack was initiated during the second half\nof 2021.\n\nSysJoker masquerades as a system update and generates its C2 by decoding a string retrieved\nfrom a text file hosted on Google Drive. During our analysis the C2 changed three times, indicating\nthe attacker is active and monitoring for infected machines. Based on victimology and malware’s\nbehavior, we assess that SysJoker is after specific targets.\n\nSysJoker was uploaded to VirusTotal with the suffix .ts which is used for [TypeScript files. A possible](https://en.wikipedia.org/wiki/TypeScript)\nattack vector for this malware is via an infected npm package.\n\nBelow we provide a technical analysis of this malware together with IoCs and detection and\nresponse mitigations.\n\n## Technical Analysis of SysJoker\n\nThe malware is written in C++ and each sample is tailored for the specific operating system it\ntargets. Both the macOS and Linux samples are fully undetected in VirusTotal.\n\n**e06e06752509f9cd8bc85aa1aa24dba2 in VirusTotal targeting Mac M1 processor**\n\n## Behavioral Analysis\n\nSysJoker’s behavior is similar for all three operating systems. We will analyze SysJoker’s behavior\non Windows.\n\n\n-----\n\nUnlike Mac and Linux samples, the Windows version contains a first-stage dropper. The dropper\n(d71e1a6ee83221f1ac7ed870bc272f01) is a DLL that was uploaded to VirusTotal as style_loader.ts and has only 6 detections at the time of this writing._\n\nThe Dropper drops a zipped SysJoker (53f1bb23f670d331c9041748e7e8e396) from C2\n_https[://]github[.]url-mini[.]com/msg.zip, copies it to_\n_C:\\ProgramData\\RecoverySystem\\recoveryWindows.zip, unzips it and executes it. All of these_\nactions are executed via PowerShell commands.\n\nProcess tree showing PowerShell commands.\n\nOnce SysJoker (d90d0f4d6dad402b5d025987030cc87c) is executed it sleeps for a random\nduration between 90 to 120 seconds. Then, it will create the C:\\ProgramData\\SystemData\\\ndirectory and copy itself under this directory, masquerading as igfxCUIService.exe (igfxCUIService\nstands for Intel Graphics Common User Interface Service). Next, it will gather information about the\nmachine using Living off the Land (LOtL) commands. SysJoker uses different temporary text files to\nlog the results of the commands. These text files are deleted immediately, stored in a JSON object,\nand then encoded and written to a file named microsoft_windows.dll. The figure below shows the\nJSON object built in memory by SysJoker.\n\nJSON object built in memory by SysJoker.\n\nIt will gather the MAC address, user name, physical media serial number, and IP address (see IoCs\nsection for the full commands list). SysJoker will create persistence by adding an entry to the\nregistry run key HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run.\nBetween each of the steps above, the malware sleeps for a random duration.\n\nThe following screenshot shows the processes tree and commands.\n\n\n-----\n\nProcesses tree and commands.\n\nNext, SysJoker will begin its C2 communication.\n\n## Decoding/Encoding Scheme \n\nSysJoker holds within the binary a hardcoded XOR key which is used for decoding and encoding\nstrings from within the binary and data sent and received from the C2. The XOR key is an RSA\npublic key that is not used in the decoding scheme. The same XOR key exists in all versions of\nSysJoker:\n\n_MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDkfNl+Se7jm7sGSrSSUpV3HUl3vEwuh+xn4q\\_\n\n_BY6aRFL91x0HIgcH2AM2rOlLdoV8v1vtG1oPt9QpC1jSxShnFw8evGrYnqaou7gLsY5J2B06eq5UW7\\_\n\n_+OXgb77WNbU90vyUbZAucfzy0eF1HqtBNbkXiQ6SSbquuvFPUepqUEjUSQIDAQAB_\n\n## Resolving C2\n\nTo get an available C2 and start communication, SysJoker first decodes a hardcoded Google Drive\nlink.\n\n\n-----\n\n[Decoding with CyberChef.](https://gchq.github.io/CyberChef/)\n\nThe Google Drive link hosts a text file named domain.txt that holds an encoded C2. The text file’s\ncontent changes over time, depending on the current available C2. SysJoker will decode the C2\nand send the collected user’s information to the C2’s /api/attach directory as an initial handshake.\nThe C2 replies with a unique token which will be used as an identifier from now on when the\nmalware communicates with the C2.\n\n\n-----\n\n## C2 Instructions\n\nSysJoker runs a while(1) loop that sends a request to the C2’s /api/req directory with the unique\n[token and will process the C2’s response which is built as JSON using functions from this library.](https://github.com/nlohmann/json)\nThis is how SysJoker pings the C2 for instructions (see step 2 in the image below):\n\nSteps.\n\nIf the server responds with data, SysJoker will parse the received payload (see step 3 in the image\nbelow). SysJoker can receive the following instruction from the C2: exe, cmd, remove_reg, and\n_exit._\n\nThe following image shows the flow of SysJoker’s communication with the C2.\n\n\n-----\n\n_remove_reg and exit are not implemented in this current version. Based on the instruction names,_\nwe can assume that they are in charge of self-deletion of the malware. Let’s look into exe and cmd\ninstructions:\n\n**exe – This command is in charge of dropping and running an executable. SysJoker will receive a**\nURL to a zip file, a directory for the path the file should be dropped to, and a filename that the\nmalware should use on the extracted executable. It will download this file, unzip it and execute it.\n\n\n-----\n\nIDA code snippet of the parsing function, if exe part.\n\nAfter execution, the malware will reply to the C2’s /api/req/res API with either “success” if the\nprocess went successful or “exception” if not (step 4 in the image above).\n\nIDA code snippet of the parsing function, building response status.\n\n\n-----\n\n**cmd – This instruction is in charge of running a command and uploading its response to the C2.**\nSysJoker will decode the command, execute it and upload the command’s response to the C2 via\n**/api/req/res API (step 4 in the image above).**\n\nIDA code snippet of the parsing function, building cmd command response.\n\nDuring our analysis, the C2 hasn’t responded with a next stage instruction.\n\n## Detection & Response\n\nTo detect if a machine in your organization has been compromised, we recommend taking the\nfollowing steps:\n\n\n-----\n\n**1. Use memory scanners to detect SysJoker payload in memory**\n\n[For Linux machines, use Intezer Protect to gain full runtime visibility over the code in](https://www.intezer.com/intezer-protect)\nyour Linux-based systems and get alerted on any malicious or unauthorized code. We\nhave a free community edition.\nFor Windows machines, use Intezer’s [Endpoint Scanner. The Endpoint Scanner will](https://analyze.intezer.com/?tab=endpoint)\nprovide you with visibility into the type and origin of all binary code that resides in your\nmachine’s memory. The figure below shows an example of an endpoint infected with\nSysJoker:\n\n**2. Use detection content to search in your EDR or SIEM. We provided you with IoCs and a rich**\nlist of detection content for each operating system below. Use these with your EDR to hunt for\ninfected machines. We will publish a dedicated blog soon discussing how to use detection\n**content for detecting SysJoker.**\n\nIf you have been compromised, take the following steps:\n\n1. Kill the processes related to SysJoker, delete the relevant persistence mechanism, and all\n\nfiles related to SysJoker (see detection content section below)\n2. Make sure that the infected machine is clean by running a memory scanner\n3. Investigate the initial entry point of the malware. If a server was infected with SysJoker, in the\n\ncourse of this investigation, check:\n\nConfiguration status and password complexity for publicly facing services\nUsed software versions and possible known exploits\n\n[SysJoker’s Linux and Windows versions are now indexed in Intezer Analyze.](https://analyze.intezer.com/)\n\n\n-----\n\n## Final Points\n\nThere are indications that SysJoker attack is performed by an advanced threat actor:\n\n1. The fact that the code was written from scratch and hasn’t been seen before in other attacks.\n\nOn top of that, it is rare to find previously unseen Linux malware in a live attack.\n2. The attacker registered at least 4 different domains and wrote from scratch the malware for\n\nthree different operating systems.\n3. During our analysis, we haven’t witnessed a second stage or command sent from the\n\nattacker. This suggests that the attack is specific which usually fits for an advanced actor.\n\nBased on the malware’s capabilities we assess that the goal of the attack is espionage together\nwith lateral movement which might also lead to a ransomware attack as one of the next stages.\n\n## IoCs\n\n### ELF\n\nbd0141e88a0d56b508bc52db4dab68a49b6027a486e4d9514ec0db006fe71eed\n\nd028e64bf4ec97dfd655ccd1157a5b96515d461a710231ac8a529d7bdb936ff3\n\n### Mac\n\n1a9a5c797777f37463b44de2b49a7f95abca786db3977dcdac0f79da739c08ac\n\nfe99db3268e058e1204aff679e0726dc77fd45d06757a5fda9eafc6a28cfb8df\n\n\n-----\n\nd0febda3a3d2d68b0374c26784198dc4309dbe4a8978e44bb7584fd832c325f0\n\n### Windows\n\n61df74731fbe1eafb2eb987f20e5226962eeceef010164e41ea6c4494a4010fc\n\n1ffd6559d21470c40dcf9236da51e5823d7ad58c93502279871c3fe7718c901c\n\nd476ca89674c987ca399a97f2d635fe30a6ba81c95f93e8320a5f979a0563517\n\n36fed8ab1bf473714d6886b8dcfbcaa200a72997d50ea0225a90c28306b7670e\n\n### C2\n\nhttps[://]bookitlab[.]tech\n\nhttps[://]winaudio-tools[.]com\n\nhttps[://]graphic-updater[.]com\n\nhttps[://]github[.]url-mini[.]com\n\nhttps[://]office360-update[.]com\n\nhttps[://]drive[.]google[.]com/uc?export=download&id=1-NVty4YX0dPHdxkgMrbdCldQCpCaE-Hn\n\nhttps[://]drive[.]google[.]com/uc?export=download&id=1W64PQQxrwY3XjBnv_QAeBQu-ePr537eu\n\n## Detection Content\n\n### Windows\n\n**Files and directories created on the machine:**\n\n_C:\\ProgramData\\RecoverySystem_\n\n_C:\\ProgramData\\RecoverySystem\\recoveryWindows.zip_\n\n_C:\\ProgramData\\RecoverySystem\\msg.exe_\n\n_C:\\ProgramData\\SystemData_\n\n_C:\\ProgramData\\SystemData\\igfxCUIService.exe_\n\n_C:\\ProgramData\\SystemData\\tempo1.txt_\n\n_C:\\ProgramData\\SystemData\\tempo2.txt_\n\n_C:\\ProgramData\\SystemData\\tempi1.txt_\n\n_C:\\ProgramData\\SystemData\\tempi2.txt_\n\n\n-----\n\n_C:\\ProgramData\\SystemData\\temps1.txt_\n\n_C:\\ProgramData\\SystemData\\temps2.txt_\n\n_C:\\ProgramData\\SystemData\\tempu.txt_\n\n_C:\\ProgramData\\SystemData\\microsoft_windows.dll_\n\n_C:\\ProgramData\\xAE Operating System\\ServiceHub.exe_\n\n**Persistence:**\n\n**_HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRun_**\n\n**_Name: igfxCUIService Type: REG_SZ Data: “C:\\ProgramData\\SystemData\\igfxCUIService.exe”_**\n\n**Commands:**\n\n_“C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe” getmac | Out-File -Encoding_\n_‘Default’ ‘C:\\ProgramData\\SystemData\\temps1.txt’ ; wmic path win32_physicalmedia get_\n_SerialNumber | Out-File -Encoding ‘Default’ ‘C:\\ProgramData\\SystemData\\temps2.txt’_\n\n_“C:\\Windows\\System32\\Wbem\\WMIC.exe” path win32_physicalmedia get SerialNumber_\n\n_“C:\\Windows\\system32\\getmac.exe”_\n\n_“C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe” $env:username | Out-File -_\n_Encoding ‘Default’ ‘C:\\ProgramData\\SystemData\\tempu.txt’_\n\n_“C:\\Windows\\System32\\cmd.exe” /c wmic OS get Caption, CSDVersion, OSArchitecture, Version /_\n_value > “C:\\ProgramData\\SystemData\\tempo1.txt” && type_\n_“C:\\ProgramData\\SystemData\\tempo1.txt” > “C:\\ProgramData\\SystemData\\tempo2.txt”_\n\n_wmic OS get Caption, CSDVersion, OSArchitecture, Version / value_\n\n_“C:\\Windows\\System32\\cmd.exe” /c wmic nicconfig where ‘IPEnabled = True’ get ipaddress >_\n_“C:\\ProgramData\\SystemData\\tempi1.txt” && type “C:\\ProgramData\\SystemData\\tempi1.txt” >_\n_“C:\\ProgramData\\SystemData\\tempi2.txt”_\n\n_wmic nicconfig where ‘IPEnabled = True’ get ipaddress_\n\n_“C:\\Windows\\System32\\cmd.exe” /c REG ADD_\n_HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /V igfxCUIService /t REG_SZ /D_\n_“C:\\ProgramData\\SystemData\\igfxCUIService.exe” /F_\n\n_REG ADD HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /V igfxCUIService /t_\n_REG_SZ /D “C:\\ProgramData\\SystemData\\igfxCUIService.exe” /F_\n\n### Linux\n\n**Files and directories created on the machine:**\n\n\n-----\n\n_/.Library/_\n\n_/.Library/SystemServices/updateSystem_\n\n_/.Library/SystemNetwork_\n\n_/.Library/log.txt_\n\n**Persistence:**\n\nCreates the cron job:\n\n_@reboot (/.Library/SystemServices/updateSystem)_\n\n**Commands:**\n\n_crontab -l | egrep -v “^(#|$)” | grep -e “@reboot (/.Library/SystemServices/updateSystem)”_\n\n_cp -rf <sample name> /.Library/SystemServices/updateSystem_\n\n_nohup ‘/.Library/SystemServices/updateSystem’ >/dev/null 2>&1 &_\n\n_ifconfig | grep -v 127.0.0.1 | grep -E “inet ([0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3})” | awk ‘{print $2}’_\n\n_ip address | awk ‘/ether/{print $2}’_\n\n_id -u_\n\n_uname -mrs_\n\n### Mac\n\n**Files and directories created on the machine:**\n\n_/Library/MacOsServices_\n\n_/Library/MacOsServices/updateMacOs_\n\n_/Library/SystemNetwork_\n\n_/Library/LaunchAgents/com.apple.update.plist_\n\n**Persistence:**\n\nCreates persistence via LaunchAgent under the path\n_/Library/LaunchAgents/com.apple.update.plist._\n\n**Content:**\n\n\n-----\n\n_<?xml version= 1.0 encoding= UTF-8 ?>_\n\n_<!DOCTYPE plist PUBLIC “-//Apple//DTD PLIST 1.0//EN”_\n_“http://www.apple.com/DTDs/PropertyList-1.0.dtd”>_\n\n_<plist version=”1.0″>_\n\n_<dict>_\n\n_<key>Label</key>_\n\n_<string>com.apple.update</string>_\n\n_<key>LimitLoadToSessionType</key>_\n\n_<string>Aqua</string>_\n\n_<key>ProgramArguments</key>_\n\n_<array>_\n\n_<string>/Library/MacOsServices/updateMacOs</string>_\n\n_</array>_\n\n_<key>KeepAlive</key>_\n\n_<dict>_\n\n_<key>SuccessfulExit</key>_\n\n_<true/>_\n\n_</dict>_\n\n_<key>RunAtLoad</key>_\n\n_<true/>_\n\n_</dict>_\n\n_</plist>_\n\n**You can find more information about SysJoker in** **[Intezer Analyze, which now has the Linux](https://analyze.intezer.com/)**\n**and Windows versions indexed.**\n\n**Avigayil Mechtinger**\n\n\n-----\n\nAvigayil is a product manager at Intezer, leading Intezer Analyze product lifecycle. Prior to this role,\nAvigayil was part of Intezer's research team and specialized in malware analysis and threat\nhunting. During her time at Intezer, she has uncovered and documented different malware targeting\nboth Linux and Windows platforms.\n\n**Ryan Robinson**\nRyan is a security researcher analyzing malware and scripts. Formerly, he was a researcher on\nAnomali's Threat Research Team.\n\n**Nicole Fishbein**\nNicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded\nresearcher in the Israel Defense Forces (IDF) Intelligence Corps.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-11 - New SysJoker Backdoor Targets Windows, Linux, and macOS.pdf"
    ],
    "report_names": [
        "2022-01-11 - New SysJoker Backdoor Targets Windows, Linux, and macOS.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536213,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1653753141,
    "ts_modification_date": 1653753141,
    "files": {
        "pdf": "https://archive.orkl.eu/2e330f9e2f40c3c82b7a190fe66bbd9feaec173a.pdf",
        "text": "https://archive.orkl.eu/2e330f9e2f40c3c82b7a190fe66bbd9feaec173a.txt",
        "img": "https://archive.orkl.eu/2e330f9e2f40c3c82b7a190fe66bbd9feaec173a.jpg"
    }
}