{
    "id": "735db0b9-f36e-477d-a2bf-192d3d0311f4",
    "created_at": "2023-01-12T15:05:15.011991Z",
    "updated_at": "2025-03-27T02:16:34.79917Z",
    "deleted_at": null,
    "sha1_hash": "474978de9800f5728eb5ffe891b32ac670391131",
    "title": "2021-01-04 - Detecting Supernova Malware- SolarWinds Continued",
    "authors": "",
    "file_creation_date": "2022-05-28T19:57:15Z",
    "file_modification_date": "2022-05-28T19:57:15Z",
    "file_size": 291468,
    "plain_text": "# Detecting Supernova Malware: SolarWinds Continued\n\n**[splunk.com/en_us/blog/security/detecting-supernova-malware-solarwinds-continued.html](https://www.splunk.com/en_us/blog/security/detecting-supernova-malware-solarwinds-continued.html)**\n\nJanuary 4, 2021\n\nBy [John Stoner January 04, 2021](https://www.splunk.com/en_us/blog/author/jstoner.html)\nTL;DR: Supernova exposes SolarWinds Orion to attack via an in-memory web shell. It\nneeds to be patched and detections below can help identify adversary actions.\n\n\n-----\n\nAs organizations were catching their breath and winding down for the holidays, a\n[fascinating twist in the SolarWinds Orion “Sunburst” intrusions began to appear.](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html)\n\n## Supernova Timeline\n\nOn December 15, [GuidePoint Security posted their analysis of a .NET webshell called](https://www.guidepointsecurity.com/supernova-solarwinds-net-webshell-analysis/)\n“Supernova” that was originally disclosed in the initial FireEye investigation. Two days later,\n[Palo Alto Networks followed up with their analysis of Supernova. On December 18,](https://unit42.paloaltonetworks.com/solarstorm-supernova/)\n[Microsoft released a comprehensive report on “Solorigate”, the compromised supply chain](https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/)\nDLL that was part of the Sunburst intrusion first reported by FireEye. Under the “Additional\nMalware Discovered” section, Microsoft calls out the Supernova malware that was\nuncovered during their research, as well as the hypothesis that because the malware does\nnot conform to the other aspects of the Sunburst attack, Supernova may have originated\nfrom another APT group!\n\n[On December 24, SolarWinds released its first Security Advisory that included both](https://www.solarwinds.com/securityadvisory)\nSunburst and Supernova. This advisory has been updated multiple times since then as new\ninformation has been made available. Supernova, SolarWinds clarified, appeared to be\nseparate from the Sunburst attack and the malware leveraged a vulnerability found in the\nOrion platform. This new vulnerability and associated malware allows adversaries another\nmethod of access. [DHS CISA has updated their initial guidance to include this new vector.](https://cyber.dhs.gov/ed/21-01/#supplemental-guidance)\n\n\n-----\n\nBased on this newly released research (and this really is the Reader s Digest version,\nbelieve me), we are going to take a look at Supernova – what it is and how it is leveraged.\nWe will also take a look at various detection methods, using data models and SPL that can\nidentify an adversary leveraging this attack vector.\n\n## What Is Supernova?\n\nSupernova was originally identified during the analysis of Sunburst, the SolarWinds Orion\n[intrusions. During this initial analysis, Supernova Yara rules were created alongside other](https://github.com/fireeye/sunburst_countermeasures/tree/hashes_update/rules/SUPERNOVA)\nelements of Sunburst because it was initially assumed to be part of the same intrusion.\nBased on the new hypothesis that Supernova is distinct from Sunburst, FireEye removed\nthe Yara rules from their GitHub repo but the original rules are still accessible.\n\n[Supernova leverages what was a zero-day vulnerability to install a trojanized .NET DLL. It is](https://www.kb.cert.org/vuls/id/843464)\nimportant to note that this DLL is not digitally signed like the Sunburst DLL was, which is\none of the reasons multiple researchers believe that this is a different threat actor using a\nvulnerability to load their malicious code to vulnerable systems.\n\nThe malware that is loaded is a web shell. This MITRE ATT&CK [technique, T1505, is used](https://attack.mitre.org/techniques/T1505/003/)\nby adversaries to backdoor web servers and establish persistent access to systems. For a\n[deeper dive, here is a nice primer of web shells by Acunetix. Go ahead, I will wait. What](https://www.acunetix.com/blog/articles/introduction-web-shells-part-1/)\nmakes this web shell extra nasty is that it is built to run in-memory which makes it more\ndifficult for detection and forensic analysts to do additional analysis post-breach. Notice I\nsaid more difficult, but not impossible.\n\n## What Can I Do?\n\nSolarWinds has continued to update their security advisory that lays out both the Sunburst\nAND Supernova issues and which versions of their software are impacted. Patches are\navailable for both issues. In fact, depending on the patch applied, both Sunburst and\nSupernova can be mitigated at the same time!\n\n## How Can I Detect Supernova In My Environment?\n\nIf you have read this far, you have a foundational understanding that Supernova and\nSunburst are separate issues and you are likely looking to take some action. Here are some\ndetections that may be useful to you in your environment.\n\n[Readers of this blog may be using Splunk Enterprise or Splunk Enterprise Security. While](https://www.splunk.com/en_us/software/enterprise-security.html)\nanyone can use data models, I recognize that not everyone does. With that in mind, the\ndetections below are provided in SPL, as well as using data models and the tstats\ncommand. Using the tstats command will provide a better overall search performance. If\n\n\n-----\n\nyou are not using data models, the SPL search should still be helpful because the search\ncriteria still applies. However, the field names may be different based on the sourcetypes in\nyour environment compared to the examples below.\n\nThese are somewhat broad searches as they stand but can be refined further based on IP\naddress or other attributes. Good asset management will help isolate systems to search\nagainst. If you are not using tstats and data models for your searches and just want to use\nSPL, don’t forget to use index=<insert index names> to narrow down the search to only\nindexes that contain the applicable events.\n\n[CERT/CC issued a new SolarWinds Orion API vulnerability alert on December 26th.](https://www.kb.cert.org/vuls/id/843464)\nAssuming you have a recent vulnerability scan with this latest alert added and you are\ningesting vulnerability scanning data into Splunk and populating the vulnerability data\nmodel, this search could potentially uncover vulnerable systems.\n```\n| tstats count from datamodel=Vulnerabilities.Vulnerabilities where \nVulnerabilities.cert=VU#843464 OR Vulnerabilities.cert=843464 OR \nVulnerabilities.cve=CVE-2020-10148 groupby Vulnerabilities.dest \nVulnerabilities.dvc Vulnerabilities.signature Vulnerabilities.vendor_product _time\nspan=1s\n\n```\nThe SPL search will be dependent on the event source, whether that is Nessus, Qualys or\nothers, but it could be as simple as this, provided the vulnerability vendor utilizes CERT/CC\nor CVE.\n```\nindex=<index where vulnerability data is stored> \nsourcetype=<vulnerability scanner> (VU#843464 OR 843464 OR CVE-2020-10148)\n\n```\nThe footprint of this intrusion is limited due to the absence of the web shell existing on disk,\n[but file hashes do exist for the trojanized .NET DLL. VirusTotal currently has 59 engines](https://www.virustotal.com/gui/file/c15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71/detection)\ndetecting it. Signature names are available to search against as well, but they will vary\nbased on your anti-virus vendor.\n\nDepending on how you are identifying file system events, the following search may allow\nyou to identify if the file hashes associated with the trojanized DLL have been written to\ndisk. Note that this will be dependent on the events collected being written to the Endpoint\ndata model.\n```\n| tstats count from datamodel=Endpoint.Filesystem where \nFilesystem.file_name=*logoimagehandler.ashx* OR \nFilesystem.file_hash=C15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71\nOR Filesystem.file_hash=75af292f34789a1c782ea36c7127bf6106f595e8 OR \nFilesystem.file_hash=56ceb6d0011d87b6e4d7023d7ef85676 groupby \nFilesystem.file_name Filesystem.file_path Filesystem.dest \nFilesystem.file_hash Filesystem.vendor_product Filesystem.user _time span=1s\n\n```\n\n-----\n\nFor those running Sysmon, searching for EventCode 11 (FileCreate) can also be helpful to\ndetermine if and when the DLL was written to disk.\n```\nindex=<index where endpoint data is stored> \nsourcetype=xmlwineventlog:microsoft-windows-sysmon/operational EventCode=11 \nfile_name=*logoimagehandler.ashx* \n| table _time host Image Computer TargetFilename\n\n```\nAt the very least, a search for these three hashes (SHA256, SHA1 and MD5) will provide a\nplace to start to determine if the malware exists on your Solarwinds Orion systems.\n\nSHA256: C15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71\nSHA1: 75af292f34789a1c782ea36c7127bf6106f595e8\nMD5: 56ceb6d0011d87b6e4d7023d7ef85676\n\nIf you are looking for DLLs being loaded in a specific process, Sysmon Event Code 7\n(Image loaded) can also be used to look for the trojanized .NET DLL being invoked.\n```\nindex=<index where endpoint data is stored>\nsourcetype=xmlwineventlog:microsoft-windows-sysmon/operational EventCode=7 \n(file_name=*logoimagehandler.ashx* OR \nSHA256=C15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71 OR \nSHA1=75af292f34789a1c782ea36c7127bf6106f595e8 OR \nMD5=56ceb6d0011d87b6e4d7023d7ef85676)\n| table _time Image ImageLoaded Computer\n\n```\n[SentinelOne also released a blog where they developed a proof of concept that used the](https://labs.sentinelone.com/solarwinds-understanding-detecting-the-supernova-webshell-trojan/)\nsame technique that Supernova uses for in-memory compilation of .NET. They identified\nthat CSC.exe and CVTRES.exe are created as child processes during execution. Please\nkeep in mind this is a tactic to hunt, not to deploy as a signature with your SIEM. Because\nmany .NET apps can do this, I want to caution that this is not an indicator of compromise\nbut, it may be worth the time to run a search that looks something like this to determine if\n.NET assemblies are being compiled and then hunt for additional actions occurring\nimmediately after this behavior on vulnerable systems.\n```\n| tstats count from datamodel=Endpoint.Processes where\nProcesses.process_exec=cvtres.exe Processes.parent_process_exec=csc.exe \ngroupby Processes.process_exec Processes.process_id Processes.process \nProcesses.parent_process_exec Processes.parent_process \nProcesses.parent_process_id Processes.dest Processes.user \nProcesses.vendor_product _time span=1s\nindex=<index where endpoint data is stored>\nsourcetype=xmlwineventlog:microsoft-windows-sysmon/operational EventCode=1 \nCommandLine=*cvtres.exe* ParentCommandLine=*csc.exe*\n| table _time CommandLine ParentCommandLine User host ProcessId ParentProcessId\n\n```\nBecause the web shell exists in memory, the best opportunity to see this will be found in\nevents like web or network traffic events. Guidepoint’s [blog provides some pseudo query](https://www.guidepointsecurity.com/supernova-solarwinds-net-webshell-analysis/)\n[that can be adapted to be used with Stream for Splunk or Bro/Zeek or other data sets that](https://splunkbase.splunk.com/app/1809/)\n\n\n-----\n\ncontain information around http and URI filenames and parameters. Even in the absence of\nendpoint data, if web or network traffic data exists, searches like these could be used as a\nstarting point. As previously mentioned, if you are not using Splunk for Stream, the SPL can\nbe adapted to your specific data source.\n```\n| tstats count from datamodel=Web.Web where\nweb.url=*logoimagehandler.ashx*codes* OR\nWeb.url=*logoimagehandler.ashx*clazz* OR\nWeb.url=*logoimagehandler.ashx*method* OR\nWeb.url=*logoimagehandler.ashx*args* groupby Web.src Web.dest Web.url\nWeb.vendor_product Web.user Web.http_user_agent _time span=1s\nindex=<index where network/web data is stored> sourcetype=stream:http \n(url=*logoimagehandler.ashx*codes* OR Web.url=*logoimagehandler.ashx*clazz*\nOR Web.url=*logoimagehandler.ashx*method* OR\nWeb.url=*logoimagehandler.ashx*args*)\n| table _time src_ip src_port dest_ip dest_port url transport status\n| tstats count from datamodel=Web.Web where Web.http_content_type=text/plain\nWeb.dest=(insert your SolarWinds IP here, we are looking for inbound traffic)\nWeb.url=*logoimagehandler.ashx* groupby Web.src Web.dest Web.url\nWeb.vendor_product Web.user Web.http_user_agent _time span=1s\nindex=<index where network/web data is stored> sourcetype=stream:http\ndest_ip=(insert your SolarWinds IP here, we are looking for inbound traffic) \nurl=*logoimagehandler.ashx*\n| table _time src_ip src_port dest_ip dest_port url transport status\n\n```\nI recognize that dealing with another vulnerability and its associated malicious code so soon\nafter Sunburst is probably not the way anyone wanted to wrap up the year and start a new\none but hopefully, this provides a way forward to jump-start your detections as your\norganization patches its vulnerable SolarWinds systems.\n\n\n-----\n\nPosted by\n\n**[John Stoner](https://www.splunk.com/en_us/blog/author/jstoner.html)**\n\n\n-----\n\nI grew up in Virginia, graduated from Penn State and came back to Virginia where I have\nworked with databases and cyber for over 20 years. A job or two felt like I really was a cast\nmember of The Office or Office Space, but every one of them taught me something new.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-04 - Detecting Supernova Malware- SolarWinds Continued.pdf"
    ],
    "report_names": [
        "2021-01-04 - Detecting Supernova Malware- SolarWinds Continued.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535915,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653767835,
    "ts_modification_date": 1653767835,
    "files": {
        "pdf": "https://archive.orkl.eu/474978de9800f5728eb5ffe891b32ac670391131.pdf",
        "text": "https://archive.orkl.eu/474978de9800f5728eb5ffe891b32ac670391131.txt",
        "img": "https://archive.orkl.eu/474978de9800f5728eb5ffe891b32ac670391131.jpg"
    }
}