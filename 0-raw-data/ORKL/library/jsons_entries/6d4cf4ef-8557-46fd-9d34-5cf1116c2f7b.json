{
    "id": "6d4cf4ef-8557-46fd-9d34-5cf1116c2f7b",
    "created_at": "2023-01-12T15:10:53.017993Z",
    "updated_at": "2025-03-27T02:05:42.750882Z",
    "deleted_at": null,
    "sha1_hash": "c68eea859006b8be21a80961ca0aedda106b93ee",
    "title": "2022-04-13 - Emotet modules and recent attacks",
    "authors": "",
    "file_creation_date": "2022-05-27T19:02:37Z",
    "file_modification_date": "2022-05-27T19:02:37Z",
    "file_size": 461240,
    "plain_text": "# Emotet modules and recent attacks\n\n**[securelist.com/emotet-modules-and-recent-attacks/106290/](https://securelist.com/emotet-modules-and-recent-attacks/106290/)**\n\nAuthors\n\nAMR\n\n## Anti-Malware Research\n\nEmotet was first found in the wild in 2014. Back then its main functionality was stealing user\n[banking credentials. Since then it has survived numerous transformations, started delivering](https://securelist.com/the-chronicles-of-emotet/99660/)\nother malware and finally became a powerful botnet. In January 2021 Emotet was disrupted\nby a joint effort of different countries’ authorities. It took the threat actors almost 10 months to\nrebuild the infrastructure, whereupon Emotet returned in November. At that time, Trickbot\nmalware was used to deliver Emotet. Now, Emotet is spreading by itself in malicious spam\ncampaigns.\n\nBased on recent Emotet protocol analysis and C2 responses, we can say that now Emotet\ncan download 16 additional modules. We were able to retrieve 10 of them (including two\ndifferent copies of the Spam module), used by Emotet for Credential/Password/Account/Email stealing and spamming. In this post, we provide a brief analysis of these modules, as\nwell as statistics on recent Emotet attacks.\n\n\n-----\n\n## Emotet technical analysis\n\n### Infection chain\n\nA typical Emotet infection begins with spam e-mails delivered with Microsoft Office (Word,\nExcel) attachments. Malicious macros are used to start PowerShell, and download and\nexecute an Emotet DLL. Depending on the available access, Emotet creates a subdirectory\nwith a random name in the %Windows%\\SysWOW64\\ or %User%\\AppData\\Local\\ directory,\nand copies itself there under a randomly generated name and extension. The exported\nControl_RunDLL function is used to run the main activity of the Emotet DLL.\n\n**_Emotet infection execution chain_**\n\nAfter being run, the Emotet malware creates a service by calling the CreateServiceW()\nfunction. A randomly generated name and extension, which were used to create a copy, act\nas service names.\n\n**_CreateServiceW() function with arguments_**\n\nIf the attempt to create a new service fails, Emotet creates a new registry key in\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run with the\nsame names that were used when creating the service.\n\n**_Autostart key in registry_**\n\n\n-----\n\nAs soon as the Emotet DLL is launched, it registers with one of the 20 C2 IPs that are\nhardcoded in encrypted form into the malware body. Downloaded modules can also include\nadditional C2 IPs. The following data is used for bot registration:\n\n**_Registration data_**\n\nTogether with the registration data, the victim’s public key that is generated in every run is\nalso sent to the C2. Unlike previous versions that used RSA to encrypt the generated AES\nkey, this newest Emotet sample uses the ECDH (Elliptic curve Diffie–Hellman) algorithm,\nusing the victim’s generated key pair together with Emotet’s public key hardcoded into the\ncode to derive the AES key for encrypting the communication. This is done with use of the\nWindows API BCryptSecretAgreement.\n\nDuring our monitoring we have observed that after registration the C2 replies with the\nProcess List module payload. The module comes in the form of a DLL that is parsed and\nloaded directly into the Rundll32 process. Its entry point is called by passing a specific\nstructure to its DllMain function. It is also worth noting that Emotet uses the ECDSA (Elliptic\nCurve Digital Signature Algorithm) to verify the payload integrity before loading it.\n\n\n-----\n\n**_Pseudo code to load Emotet’s second-stage DLL directly into memory_**\n\nAside from loading the DLL into memory, there are other ways to run the payload. For\nexample:\n\nwrite the DLL payload to disk and run it through regsvr32.exe -s “%s” or rundll32.exe\n“%s”,Control_RunDLL\nwrite the payload to disk and attempt to call CreateProcess or duplicate the user token\nto call CreateProcessAsUser\n\nDuring communication, C2 returns the module bodies and configuration. Based on the\nconfiguration, the malware selects the way to run the payload module. During our research,\nall the modules we retrieved were launched in the parent process, but a separate thread is\nstarted for each new module. Each module has its own numeric ID, and contains its own C2\nlist. However, all the modules we retrieved contained the same list of C2, except the Spam\nmodule. Emotet modules are delivered on demand, and there are always a few junk bytes\nthat vary in different samples of the same module. This is likely to avoid cloud scanning or\nfile hash detection.\n\n**_Random bytes changed between “Process List” module binaries_**\n\n### Process List module\n\nThis module sends the list of running processes back to C2. Usually C2 does not send any\nother modules until it gets a response from this one.\n\n\n-----\n\n**_Emotet Process List module request_**\n\n### Mail PassView module\n\nThe module contains an embedded executable called Nir Sofer’s Mail PassView, a password\nrecovery tool that reveals passwords and account details for various e-mail clients. In order\nto execute the password recovery tool, the Emotet module copies certutil.exe into a\n%Temp% directory under a random name with the .exe extension, starts the copied\n[executable and uses the process hollowing technique to inject the password recovery tool](https://attack.mitre.org/techniques/T1055/012/)\nexecutable into the newly created process. The CertUtil process is started with command\nline arguments to force the recovery tool to save the results to file.\n\n\n-----\n\n**_CertUtil with command line for password recovery tool_**\n\nAccording to the official website, the utility is capable of revealing passwords and other\naccount details for various e-mail clients, including Outlook and Thunderbird.\n\n### WebBrowser PassView module\n\nThis module is mostly the same as the previous one, except it uses the Nir Sofer’s\nWebBrowser PassView password recovery tool for revealing passwords and account details\nin browsers.\n\nAccording to the official website, the utility is capable of revealing passwords and other\naccount details in various web browsers, including Internet Explorer, Mozilla Firefox, Google\nChrome, Safari and Opera.\n\n\n-----\n\n**_Pseudocode of function from WebBrowser PassView module_**\n\nEmotet has used code obfuscation for years, and this module is no exception. In the figure\nabove, we can see that the control flow obfuscation technique is used with the variable ‘state’\n(yellow-colored). Also, all API calls are resolved during runtime. This is why this API\nresolution layer can use junk arguments (red-framed). Code listings can be larger and more\nobfuscated, which is why it makes no sense to show them for all modules.\n\n### Outlook Address Grabber module\n\nA data exfiltration module for Outlook. The module uses the Outlook Messaging API\ninterface, iterates through Outlook profiles and extracts all displayed names and mail\naddresses from each found mail. It then sends the collected e-mail addresses to C2.\n\n\n-----\n\n### Outlook E-mails Grabber module\n\nA data exfiltration module for Outlook. The module uses the Outlook Messaging API\ninterface, iterates through all personal folders (Inbox, Sent items, Deleted Items, etc),\nextracts all displayed names and mail addresses of sender and recipient, and extracts the email subject and body. It then sends the collected e-mails to C2.\n\n### Thunderbird Address Grabber module\n\nA data exfiltration module for Thunderbird. The module iterates through Thunderbird profiles\nlocated in %AppData%\\Roaming\\Thunderbird\\Profiles\\, parses Thunderbird data files and\nextracts displayed names and mail addresses. It then sends the collected e-mail addresses\nto C2.\n\n### Thunderbird E-mails Grabber module\n\nA data exfiltration module for Thunderbird. The module iterates through Thunderbird profiles\nlocated in %AppData%\\Roaming\\Thunderbird\\Profiles\\, parses Thunderbird data files and\nextracts displayed names and mail addresses of sender and recipient, and extracts the email subject and body. It then sends the collected e-mails to C2.\n\n### Spam module\n\nThe module is responsible for sending spam. It queries C2 until it receives a response with a\nspam task that usually consist of three parts:\n\nA list of e-mail servers and compromised accounts to be used to send spam; dozens of\ncompromised accounts are stored in a single task.\nA list of targeted e-mails, recipient e-mail and name, sender e-mail and name.\nA spam template with subject, body and attachments.\n\n\n-----\n\n**_Redacted list of email servers, compromised accounts used for spamming_**\n\nTwo of the 10 modules we were able to obtain were spam modules. Their functionality is one\nand the same, but the module IDs differ.\n\n### UPnP module\n\nAn auxiliary module for testing the possibility of connecting to the infected system from the\noutside. In the settings of this module, which are sent by C2, together with the module itself,\nthe external IP address of the infected system is transmitted. The first thing this module does\nis enumerate the network interfaces and compare their addresses with the IP address\nobtained from the module’s configuration settings. If a suitable network interface is found, the\nmodule opens ports for listening and waits for an incoming connection. The module can open\nthe following ports: 80, 443, 8080, 8090, 7080, 8443, 20, 21, 22, 53, 143, 465, 990, 993, 995.\nIf a suitable network interface is not found, it uses the SSDP protocol to find devices\n(modem, router, etc.) with Internet access. If suitable devices are found, the module tries to\nreconfigure them using AddPortMapping to allow port forwarding.\n\n\n-----\n\n**_Example of AddPortMapping for 443 port forwarding_**\n\n## Statistics\n\nSince Emotet’s return in November 2021, we have observed its activity gradually increase. In\nMarch 2022, however, based on our telemetry, the number of attacked users shot up from\n2,847 in February to 9,086 — more than threefold growth.\n\n_Dynamics of the number of attacked users in recent Emotet attacks, November 2021–March_\n_[2022 (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2022/04/12150829/02-en-emotet.png)_\n\nA similar upsurge we observed in March in the number of Emotet detections.\n\n_[Dynamics of the number of Emotet detections, November 2021–March 2022 (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2022/04/12150557/01-en-emotet.png)_\n\n## Victimology\n\nEmotet infects computers of companies and individual users all over the world. In Q1 2022,\naccording to our telemetry, users of the following countries were most often targeted by\nEmotet: Italy (10.04%), Russia (9.87%), Japan (8.55%), Mexico (8.36%), Brazil (6.88%),\nIndonesia (4.92%), India (3.21%), Vietnam (2.70%), China (2.62), Germany (2.19%) and\nMalaysia (2.13%).\n\n_[Geographical distribution of Emotet targets, Q1 2022 (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2022/04/12151050/03-en-emotet.png)_\n\n## Conclusion\n\nThe current set of modules is capable of performing a large set of malicious actions: stealing\ne-mails, passwords and login data from various sources; sending spam. All these modules,\nexcept those for Thunderbird, in one form or another, have been used before by Emotet.\nHowever, there are still modules that we have not been able to obtain yet. In addition, our\ntelemetry shows significant growth in the number of attacked users in March. We continue to\nactively monitor the Emotet family. More information about the malware we provide in our\n[private reports on Kaspersky Threat Intelligence Portal.](https://tip.kaspersky.com/)\n\n## Indicators of Compromise\n\nNote: Because Emotet is polymorphic malware, there are no IOC hashes.\n\n**C2 IP addresses**\n\n[70[.]36.102.35:443](https://opentip.kaspersky.com/70.36.102.35%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[197[.]242.150.244:8080](https://opentip.kaspersky.com/197.242.150.244%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[188[.]44.20.25:443](https://opentip.kaspersky.com/188.44.20.25%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[45[.]118.135.203:7080](https://opentip.kaspersky.com/45.118.135.203%3A7080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n\n-----\n\n[92[.]240.254.110:8080](https://opentip.kaspersky.com/92.240.254.110%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[103[.]43.46.182:443](https://opentip.kaspersky.com/103.43.46.182%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[1[.]234.2.232:8080](https://opentip.kaspersky.com/1.234.2.232%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[50[.]116.54.215:443](https://opentip.kaspersky.com/50.116.54.215%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[51[.]91.76.89:8080](https://opentip.kaspersky.com/51.91.76.89%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[206[.]188.212.92:8080](https://opentip.kaspersky.com/206.188.212.92%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[153[.]126.146.25:7080](https://opentip.kaspersky.com/153.126.146.25%3A7080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[178[.]79.147.66:8080](https://opentip.kaspersky.com/178.79.147.66%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[217[.]182.25.250:8080](https://opentip.kaspersky.com/217.182.25.250%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[196[.]218.30.83:443](https://opentip.kaspersky.com/196.218.30.83%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[51[.]91.7.5:8080](https://opentip.kaspersky.com/51.91.7.5%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[72[.]15.201.15:8080](https://opentip.kaspersky.com/72.15.201.15%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[119[.]193.124.41:7080](https://opentip.kaspersky.com/119.193.124.41%3A7080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[5[.]9.116.246:8080](https://opentip.kaspersky.com/5.9.116.246%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[151[.]106.112.196:8080](https://opentip.kaspersky.com/151.106.112.196%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[101[.]50.0.91:8080](https://opentip.kaspersky.com/101.50.0.91%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[45[.]142.114.231:8080](https://opentip.kaspersky.com/45.142.114.231%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[185[.]157.82.211:8080](https://opentip.kaspersky.com/185.157.82.211%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[46[.]55.222.11:443](https://opentip.kaspersky.com/46.55.222.11%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[103[.]75.201.2:443](https://opentip.kaspersky.com/103.75.201.2%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[176[.]56.128.118:443](https://opentip.kaspersky.com/176.56.128.118%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[176[.]104.106.96:8080](https://opentip.kaspersky.com/176.104.106.96%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[107[.]182.225.142:8080](https://opentip.kaspersky.com/107.182.225.142%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[31[.]24.158.56:8080](https://opentip.kaspersky.com/31.24.158.56%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[51[.]254.140.238:7080](https://opentip.kaspersky.com/51.254.140.238%3A7080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[159[.]65.88.10:8080](https://opentip.kaspersky.com/159.65.88.10%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[82[.]165.152.127:8080](https://opentip.kaspersky.com/82.165.152.127%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[146[.]59.226.45:443](https://opentip.kaspersky.com/146.59.226.45%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[173[.]212.193.249:8080](https://opentip.kaspersky.com/173.212.193.249%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[212[.]24.98.99:8080](https://opentip.kaspersky.com/212.24.98.99%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[212[.]237.17.99:8080](https://opentip.kaspersky.com/212.237.17.99%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[110[.]232.117.186:8080](https://opentip.kaspersky.com/110.232.117.186%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[131[.]100.24.231:80](https://opentip.kaspersky.com/131.100.24.231%3A80/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[209[.]250.246.206:443](https://opentip.kaspersky.com/209.250.246.206%3A443/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[195[.]201.151.129:8080](https://opentip.kaspersky.com/195.201.151.129%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[138[.]185.72.26:8080](https://opentip.kaspersky.com/138.185.72.26%3A8080/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[Botnets](https://securelist.com/tag/botnets/)\n[Emotet](https://securelist.com/tag/emotet/)\n[Malware](https://securelist.com/tag/malware/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Statistics](https://securelist.com/tag/malware-statistics/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n\n\n-----\n\n[Trojan Banker](https://securelist.com/tag/trojan-banker/)\n\nAuthors\n\nAMR\n\nEmotet modules and recent attacks\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-13 - Emotet modules and recent attacks.pdf"
    ],
    "report_names": [
        "2022-04-13 - Emotet modules and recent attacks.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536253,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1653678157,
    "ts_modification_date": 1653678157,
    "files": {
        "pdf": "https://archive.orkl.eu/c68eea859006b8be21a80961ca0aedda106b93ee.pdf",
        "text": "https://archive.orkl.eu/c68eea859006b8be21a80961ca0aedda106b93ee.txt",
        "img": "https://archive.orkl.eu/c68eea859006b8be21a80961ca0aedda106b93ee.jpg"
    }
}