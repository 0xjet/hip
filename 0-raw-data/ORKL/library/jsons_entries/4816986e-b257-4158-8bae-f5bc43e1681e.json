{
    "id": "4816986e-b257-4158-8bae-f5bc43e1681e",
    "created_at": "2023-01-12T15:09:47.82226Z",
    "updated_at": "2025-03-27T02:05:28.314014Z",
    "deleted_at": null,
    "sha1_hash": "daec7edfdb0a641a4f785d4acacd94ec318a55e8",
    "title": "2022-07-12 - Malware analysis with IDA-Radare2 - Multiple unpacking (Ramnit worm)",
    "authors": "",
    "file_creation_date": "2022-07-18T18:26:31Z",
    "file_modification_date": "2022-07-18T18:26:31Z",
    "file_size": 934283,
    "plain_text": "# Malware analysis with IDA/Radare2 - Multiple unpacking (Ramnit worm)\n\n**artik.blue/malware4**\n\n## Introduction\n\n Today we are following our previous post on these series unpacking a sample (Ramnit) that looks a bit more complex as it performs multiple unpacking, combining own methods with an open source packer. As this piece of malware is relatively old, I’ll be using a Windows 7 box with radare2, processhacker, pebear, pestudio and upx to go with it. The endgame here will be to go on unpacking the malware as many times as necessary until we reach to the final one, then get a general idea of what it does.\n\n About Ramnit\n\n Ramnit is a Computer worm affecting Windows users. It was estimated that it infected 800 000 Windows PCs between September and December 2011. The Ramnit botnet was dismantled by Europol and Symantec in 2015. At its peak in 2015, Ramnit was estimated to have infected 3,200,000 PCs. Ramnit infects removable media such as USB drives and also\n\n\n-----\n\n## hides itself within the master boot record. As soon as it infects a computer, it copies itself to all attached and removable drives. It also searches and infects files with the extensions .exe, .dll, .htm and .html.\n\n The sample we’ll be working with can be downloaded here and a similar one can be downloaded from anyrun\n\n First stage\n\n So considering that we are malware analysts who just received a fresh sample of a potential malware, let’s go step by step. Usually the first goal of the analysis will be to determine wether the malware is packed/encrypted or not, then to try to extract some configuration, go for the C2 mechanisms and basic capabilities/actions and finally we may try to perform more advanced reversing to determine its full capabilities and detailed workflow. Having donde that the next actions(s) to carry would include to extract signatures for yara, automate the unpacking/scan process maybe and to start with threat intelligence.\n\n Today we are focusing mainly on the unpacking part.\n\n So to start with the sample we’ll want to get some basic info on the binary. As we already know, knowing about the entropy may help in detecting packing, a high entropy may be a clear indicator. We can easily check that with rahash:\n```\nPS C:\\Users\\labo\\Desktop> rahash2.exe -a entropy '.\\Zeichnungen Muster.bin'\n\n.\\Zeichnungen Muster.bin: 0x00000000-0x001f91f6 entropy: 7.63339648\n\nPS C:\\Users\\labo\\Desktop>\n\n We can also check for the strings, a large number of nonesense strings along with strings related to api-calls may indicate suspicious behavior as well.\n\n```\n\n-----\n\n```\nPS C:\\Users\\lab\\Desktop > rafind2.exe Z .\\Zeichnungen Muster.bin | more\n\n0x0000004d !This program cannot be run in DOS mode.\\r\\r\\n$\n\n0x000000f8 RichR\n\n0x00000208 .text\n\n0x0000022f `.rdata\n\n0x00000257 @.data\n\n0x00000280 .rsrc\n\n0x000002a7 @.reloc\n\n0x000002cf B.text\n\n0x0040129d u\\bWV\n\n0x004012b5 u/;u\\f\n\n0x004012d3 u\\fj V\n\n0x00401306 9=thL\n\n0x00401330 =thL\n\n0x00401336 5xhL\n\n0x00401363 =lhL\n\n0x004013b4 =lhL\n\n0x004013f5 5dhL\n\n0x004013fb %hhL\n\n0x00401408 %dhL\n\n0x0040140f \\rthL\n\n0x00401491 \\bt\\\\HH\n\n0x004014c5 M\\b;S\\f|\n\n0x004014f7 t\\aWV\n\n0x0040156f 9^\\f~4\n\n0x0040158b 8\\bsS\n\n0x0040159c IU\\f;F\\f\n\n0x004015ec t +╦ì\n\n0x004016a4 u\\fj\\a\n\n0x00401759 u\\fh8\n\n0x0040176d \\\\SVW\n\n0x0040178a D$(P\n\n0x004017c8 %hhL\n\n## We can also check for the overall api calls/imports on the program. Calls related to network, file management, the register, virtual memory or process management may also indicate that the program has a suspiciously unusual interest in manipulating our operating system. LoadLibrary and GetprocessHandle may work in combination with hardcoded api-call strings! That is, to dynamically resolve them in memory (not usual on legitimate programs)\n\n```\n\n-----\n\n```\nPS C:\\Users\\labo\\Desktop > rabin2.exe I l s .\\Zeichnungen Muster.bin\n\n[Symbols]\n\nnth paddr   vaddr   bind type size lib     name\n\n---------------------------------------------------------\n116 0x0008ebc8 0x0048f7c8 NONE FUNC 0  WSOCK32.dll imp.WSACleanup\n\n23 0x0008ebcc 0x0048f7cc NONE FUNC 0  WSOCK32.dll imp.socket\n\n12 0x0008ebd0 0x0048f7d0 NONE FUNC 0  WSOCK32.dll imp.ioctlsocket\n\n21 0x0008ebd4 0x0048f7d4 NONE FUNC 0  WSOCK32.dll imp.setsockopt\n\n15 0x0008ebd8 0x0048f7d8 NONE FUNC 0  WSOCK32.dll imp.ntohs\n\n17 0x0008ebdc 0x0048f7dc NONE FUNC 0  WSOCK32.dll imp.recvfrom\n\n10 0x0008ebe0 0x0048f7e0 NONE FUNC 0  WSOCK32.dll imp.inet_addr\n\n9  0x0008ebe4 0x0048f7e4 NONE FUNC 0  WSOCK32.dll imp.htons\n\n115 0x0008ebe8 0x0048f7e8 NONE FUNC 0  WSOCK32.dll imp.WSAStartup\n\n151 0x0008ebec 0x0048f7ec NONE FUNC 0  WSOCK32.dll imp.__WSAFDIsSet\n\n18 0x0008ebf0 0x0048f7f0 NONE FUNC 0  WSOCK32.dll imp.select\n\n1  0x0008ebf4 0x0048f7f4 NONE FUNC 0  WSOCK32.dll imp.accept\n\n13 0x0008ebf8 0x0048f7f8 NONE FUNC 0  WSOCK32.dll imp.listen\n\n2  0x0008ebfc 0x0048f7fc NONE FUNC 0  WSOCK32.dll imp.bind\n\n3  0x0008ec00 0x0048f800 NONE FUNC 0  WSOCK32.dll imp.closesocket\n\n111 0x0008ec04 0x0048f804 NONE FUNC 0  WSOCK32.dll imp.WSAGetLastError\n\n16 0x0008ec08 0x0048f808 NONE FUNC 0  WSOCK32.dll imp.recv\n\n20 0x0008ec0c 0x0048f80c NONE FUNC 0  WSOCK32.dll imp.sendto\n\n19 0x0008ec10 0x0048f810 NONE FUNC 0  WSOCK32.dll imp.send\n\n11 0x0008ec14 0x0048f814 NONE FUNC 0  WSOCK32.dll imp.inet_ntoa\n\n52 0x0008ec18 0x0048f818 NONE FUNC 0  WSOCK32.dll imp.gethostbyname\n\n57 0x0008ec1c 0x0048f81c NONE FUNC 0  WSOCK32.dll imp.gethostname\n\n4  0x0008ec20 0x0048f820 NONE FUNC 0  WSOCK32.dll imp.connect\n\n108 0x0008e710 0x0048f310 NONE FUNC 0  KERNEL32.dll imp.GetWindowsDirectoryW\n\n109 0x0008e714 0x0048f314 NONE FUNC 0  KERNEL32.dll imp.GetCurrentProcessId\n\n110 0x0008e718 0x0048f318 NONE FUNC 0  KERNEL32.dll imp.GetProcessIoCounters\n\n111 0x0008e71c 0x0048f31c NONE FUNC 0  KERNEL32.dll imp.CreateProcessW\n\n112 0x0008e720 0x0048f320 NONE FUNC 0  KERNEL32.dll imp.GetProcessId\n\n113 0x0008e724 0x0048f324 NONE FUNC 0  KERNEL32.dll imp.SetPriorityClass\n\n114 0x0008e728 0x0048f328 NONE FUNC 0  KERNEL32.dll imp.LoadLibraryW\n\n115 0x0008e72c 0x0048f32c NONE FUNC 0  KERNEL32.dll imp.VirtualAlloc\n\n116 0x0008e730 0x0048f330 NONE FUNC 0  KERNEL32.dll imp.IsDebuggerPresent\n\n117 0x0008e734 0x0048f334 NONE FUNC 0  KERNEL32.dll imp.GetCurrentDirectoryW\n\n118 0x0008e738 0x0048f338 NONE FUNC 0  KERNEL32.dll imp.lstrcmpiW\n\n119 0x0008e73c 0x0048f33c NONE FUNC 0  KERNEL32.dll imp.DecodePointer\n\n120 0x0008e740 0x0048f340 NONE FUNC 0  KERNEL32.dll imp.GetLastError\n\n121 0x0008e744 0x0048f344 NONE FUNC 0  KERNEL32.dll imp.RaiseException\n\n122 0x0008e748 0x0048f348 NONE FUNC 0  KERNEL32.dll\nimp.InitializeCriticalSectionAndSpinCount\n\n3  0x0008ebc0 0x0048f7c0 NONE FUNC 0  WINMM.dll  imp.mciSendStringW\n\n1 [...]\n\n120 0x0008eaa8 0x0048f6a8 NONE FUNC 0  USER32.dll  imp.SetProcessWindowStation\n\n121 0x0008eaac 0x0048f6ac NONE FUNC 0  USER32.dll  imp.GetProcessWindowStation\n\n122 0x0008eab0 0x0048f6b0 NONE FUNC 0  USER32.dll  imp.OpenWindowStationW\n\n123 0x0008eab4 0x0048f6b4 NONE FUNC 0  USER32.dll  imp.GetUserObjectSecurity\n\n124 0x0008eab8 0x0048f6b8 NONE FUNC 0  USER32.dll  imp.MessageBoxW\n\n125 0x0008eabc 0x0048f6bc NONE FUNC 0  USER32.dll  imp.DefWindowProcW\n\n```\n\n-----\n\n```\n126 0x0008eac0 0x0048f6c0 NONE FUNC 0  USER32.dll  imp.SetClipboardData\n\n127 0x0008eac4 0x0048f6c4 NONE FUNC 0  USER32.dll  imp.EmptyClipboard\n\n128 0x0008eac8 0x0048f6c8 NONE FUNC 0  USER32.dll  imp.CountClipboardFormats\n\n129 0x0008eacc 0x0048f6cc NONE FUNC 0  USER32.dll  imp.CloseClipboard\n\n130 0x0008ead0 0x0048f6d0 NONE FUNC 0  USER32.dll  imp.GetClipboardData\n\n131 0x0008ead4 0x0048f6d4 NONE FUNC 0  USER32.dll  imp.IsClipboardFormatAvailable\n\n132 0x0008ead8 0x0048f6d8 NONE FUNC 0  USER32.dll  imp.OpenClipboard\n\n133 0x0008eadc 0x0048f6dc NONE FUNC 0  USER32.dll  imp.BlockInput\n\n3  0x0008e814 0x0048f414 NONE FUNC 0  OLEAUT32.dll imp.SysAllocStringLen\n\n6  0x0008e818 0x0048f418 NONE FUNC 0  OLEAUT32.dll imp.SysStringLen\n\n38 0x0008e81c 0x0048f41c NONE FUNC 0  OLEAUT32.dll imp.SafeArrayDestroyData\n\n39 0x0008e820 0x0048f420 NONE FUNC 0  OLEAUT32.dll imp.SafeArrayRedim\n\n24 0x0008e824 0x0048f424 NONE FUNC 0  OLEAUT32.dll imp.SafeArrayGetElement\n\n23 0x0008e828 0x0048f428 NONE FUNC 0  OLEAUT32.dll imp.SafeArrayUnaccessData\n\n37 0x0008e82c 0x0048f42c NONE FUNC 0  OLEAUT32.dll imp.SafeArrayDestroyDescriptor\n\n41 0x0008e830 0x0048f430 NONE FUNC 0  OLEAUT32.dll imp.SafeArrayCreateEx\n\n411 0x0008e834 0x0048f434 NONE FUNC 0  OLEAUT32.dll imp.SafeArrayCopyData\n\n163 0x0008e838 0x0048f438 NONE FUNC 0  OLEAUT32.dll imp.QueryPathOfRegTypeLib\n\n32 0x0008e83c 0x0048f43c NONE FUNC 0  OLEAUT32.dll imp.RegisterActiveObject\n\n146 0x0008e840 0x0048f440 NONE FUNC 0  OLEAUT32.dll imp.VariantChangeTypeEx\n\n12 0x0008e844 0x0048f444 NONE FUNC 0  OLEAUT32.dll imp.VariantTimeToDosDateTime\n\n7  0x0008e848 0x0048f448 NONE FUNC 0  OLEAUT32.dll imp.VariantInit\n\n185 0x0008e84c 0x0048f44c NONE FUNC 0  OLEAUT32.dll imp.UnRegisterTypeLib\n\n220 0x0008e850 0x0048f450 NONE FUNC 0  OLEAUT32.dll imp.VarDateFromI1\n\n77 0x0008e854 0x0048f454 NONE FUNC 0  OLEAUT32.dll imp.VarR8FromUI1\n\n10 0x0008e858 0x0048f458 NONE FUNC 0  OLEAUT32.dll imp.VariantCopyInd\n\n9  0x0008e85c 0x0048f45c NONE FUNC 0  OLEAUT32.dll imp.VariantCopy\n\n418 0x0008e860 0x0048f460 NONE FUNC 0  OLEAUT32.dll imp.OleCreatePictureIndirect\n\n164 0x0008e864 0x0048f464 NONE FUNC 0  OLEAUT32.dll imp.LHashValOfNameSys\n\n442 0x0008e868 0x0048f468 NONE FUNC 0  OLEAUT32.dll imp.UnRegisterTypeLibForUser\n\n443 0x0008e86c 0x0048f46c NONE FUNC 0  OLEAUT32.dll\nimp.OaEnablePerUserTLibRegistration\n\n186 0x0008e870 0x0048f470 NONE FUNC 0  OLEAUT32.dll imp.VarDecFix\n\n31 0x0008e874 0x0048f474 NONE FUNC 0  OLEAUT32.dll imp.CreateStdDispatch\n\n2  0x0008e878 0x0048f478 NONE FUNC 0  OLEAUT32.dll imp.SysReAllocString\n\n8  0x0008e87c 0x0048f47c NONE FUNC 0  OLEAUT32.dll imp.VariantClear\n\narch   x86\n\nbaddr  0x400000\n\nbinsz  2068983\n\nbintype pe\n\ncanary  true\n\nretguard false\n\nclass  PE32\n\ncmp.csum 0x002047e2\n\ncompiled Sun Apr 19 18:03:00 2020\n\ncrypto  false\n\nendian  little\n\nhavecode true\n\nhdr.csum 0x002047e2\n\nladdr  0x0\n\nlang   c\n\nlinenum false\n\n```\n\n-----\n\n```\nlsyms  false\n\nmachine i386\n\nnx    false\n\nos    windows\n\noverlay true\n\ncc    cdecl\n\npic   true\n\nrelocs  false\n\nsigned  false\n\nsanitize false\n\nstatic  false\n\nstripped false\n\nsubsys  Windows GUI\n\nva    true\n\n[Linked libraries]\n\nwsock32.dll\n\nversion.dll\n\nwinmm.dll\n\ncomctl32.dll\n\nmpr.dll\n\nwininet.dll\n\npsapi.dll\n\niphlpapi.dll\n\nuserenv.dll\n\nuxtheme.dll\n\nkernel32.dll\n\nuser32.dll\n\ngdi32.dll\n\ncomdlg32.dll\n\nadvapi32.dll\n\nshell32.dll\n\nole32.dll\n\noleaut32.dll\n\n18 libraries\n\nPS C:\\Users\\labo\\Desktop >\n\n## We can also check for the program sections:\n[0x005e4000]> iS\n\n[Sections]\n\nnth paddr      size vaddr     vsize perm name\n\n------------------------------------------------------\n0  0x00000400  0x8e000 0x00401000  0x8e000 -r-x .text\n\n1  0x0008e400  0x2fe00 0x0048f000  0x30000 -r-- .rdata\n\n2  0x000be200  0x5200 0x004bf000  0x9000 -rw- .data\n\n3  0x000c3400 0x113a00 0x004c8000 0x114000 -r-- .rsrc\n\n4  0x001d6e00  0x7200 0x005dc000  0x8000 -r-- .reloc\n\n5  0x001de000  0x1b000 0x005e4000  0x1b000 -rwx .text_1\n\n[0x005e4000]>\n\n```\n\n-----\n\n## In this case it s a bit suspicious to have a .text and a .text_1 both with X permissions, one of them RWX… Also it looks like the program won’t start from a typical mem addr…\n\n We can go check for the content of the sections, to see if any of them actually holds a bufer (other binary for example, compressed stuff etc):\n```\npxw 800 @ 0x005d4000\n\n0x005d4000 0x0000e860 0x8b5d0000 0xa8ed81c5 0x2b2001a6 `.....]....... +\n\n0x005d4010 0x01ae0f85 0x0b858920 0xb02001ae 0x40858600 .... ..... ....@\n\n0x005d4020 0x3c2001b0 0xbc850f01 0x83000001 0x01af3bbd .. <.........;..\n\n0x005d4030 0x33740020 0xaf3fbd83 0x74002001 0x0b858b2a  .t3..?.. .t*...\n\n0x005d4040 0x2b2001ae 0x01af3b85 0x89008b20 0x01af7885 .. +.;.. ....x..\n\n0x005d4050 0x0b858b20 0x2b2001ae 0x01af3f85 0x89008b20  ..... +.?.. ...\n\n0x005d4060 0x01af7c85 0x8361eb20 0x01af43bd 0x58740020 .|.. .a..C.. .tX\n\n0x005d4070 0xae0b858b 0x852b2001 0x2001af43 0x858d30ff ..... +.C.. .0..\n\n0x005d4080 0x2001aa94 0xc00bd0ff 0x85893e74 0x2001af47 ... ....t>..G..\n\n0x005d4090 0xaf4b858d 0xff502001 0x01af47b5 0x858d5520 ..K.. P..G.. U..\n\n0x005d40a0 0x2001aad3 0x8589d0ff 0x2001af78 0xaf58858d ... ....x.. ..X.\n\n0x005d40b0 0xff502001 0x01af47b5 0x858d5520 0x2001aad3 . P..G.. U.....\n\n0x005d40c0 0x8589d0ff 0x2001af7c 0xaf7cbd83 0x0f002001 ....|.. ..|.. ..\n\n[0x005e4000]> pxw @ 0x00401000\n\n0x00401000 0x4c5144b9 0xa507e800 0xa9680003 0xe80043b7 .DQL......h..C..\n\n0x00401010 0x00021f6c 0xb7e8c359 0x6800003a 0x0043b7b3 l...Y...:..h..C.\n\n0x00401020 0x021f5be8 0xe8c35900 0x000039e4 0x43b7b968 .[...Y...9..h..C\n\n0x00401030 0x1f4ae800 0xc3590002 0x43b7be68 0x1f3ee800 ..J...Y.h..C..>.\n\n0x00401040 0xc3590002 0x002c5fe8 0xb7c36800 0x2de80043 ..Y.._,..h..C..\n0x00401050 0x5900021f 0x15efe8c3 0xc8680000 0xe80043b7 ...Y......h..C..\n\n0x00401060 0x00021f1c 0xe851c359 0x0000e863 0x43b7cd68 ....Y.Q.c...h..C\n\n0x00401070 0x1f0ae800 0xc3590002 0x4c6310a1 0x408b5100 ......Y...cL.Q.@\n\n0x00401080 0x63100504 0xe850004c 0x0000615f 0x43b7e268 ...cL.P._a..h..C\n\n0x00401090 0x1eeae800 0xc3590002 0x003196e8 0xb7e76800 ......Y...1..h..\n\n0x004010a0 0xd9e80043 0x5900021e 0x7546e8c3 0xec680000 C......Y..Fu..h.\n\n0x004010b0 0xe80043b7 0x00021ec8 0xc7e8c359 0x6800014d .C......Y...M..h\n\n0x004010c0 0x0043b7f1 0x021eb7e8 0xb9c35900 0x004c7404 ..C......Y...tL.\n\n0x004010d0 0x0066f2e8 0xb8006800 0xa1e80043 0x5900021e ..f..h..C......Y\n\n0x004010e0 0xccccccc3 0xcccccccc 0xcccccccc 0xcccccccc ................\n\n0x004010f0 0x8b575653 0x5b0d6af1 0x016cbe8d 0xef830000 SVW..j.[..l.....\n\n But don’t expect to find a lot by just pxw’ing whats in there…\n\n And we can also go check the entropy for each sections, so in here we are already getting some hints:\n\n```\n\n-----\n\n```\n[0x005e4000]> iS entropy\n\n[Sections]\n\nnth paddr      size vaddr     vsize perm entropy  name\n\n-----------------------------------------------------------------\n0  0x00000400  0x8e000 0x00401000  0x8e000 -r-x 6.67524835 .text\n\n1  0x0008e400  0x2fe00 0x0048f000  0x30000 -r-- 5.76322253 .rdata\n\n2  0x000be200  0x5200 0x004bf000  0x9000 -rw- 1.19638192 .data\n\n3  0x000c3400 0x113a00 0x004c8000 0x114000 -r-- 7.98164843 .rsrc\n\n4  0x001d6e00  0x7200 0x005dc000  0x8000 -r-- 6.78395556 .reloc\n\n5  0x001de000  0x1b000 0x005e4000  0x1b000 -rwx 7.87108038 .text_1\n\n## And we can be even more precise…\nPS C:\\Users\\labo\\Desktop> radare2.exe -qfnc 'p=e 30'\n\"C:\\Users\\labo\\Desktop\\Zeichnungen Muster.bin.exe\"\n\n0x00000000 000 00d1 |#########################################\n\n0x00010d66 001 00c3 |####\n\n0x00021acc 002 00d5 |#\n\n0x00032832 003 00d7 |###########################################\n\n0x00043598 004 00d1 |#\n\n0x000542fe 005 00d3 |##########################################\n\n0x00065064 006 00cf |#\n\n0x00075dca 007 00d0 |#########################################\n\n0x00086b30 008 00c6 |#######################################\n\n0x00097896 009 00bd |#####################################\n\n0x000a85fc 00a 009f |###############################\n\n0x000b9362 00b 0086 |########################\n\n0x000ca0c8 00c 00fa |#\n\n0x000dae2e 00d 00fe |#\n\n0x000ebb94 00e 00fe |#\n\n0x000fc8fa 00f 00fe |#\n\n0x0010d660 010 00fe |#\n\n0x0011e3c6 011 00fe |#\n\n0x0012f12c 012 00fe |#\n\n0x0013fe92 013 00fe |#\n\n0x00150bf8 014 00fe |#\n\n0x0016195e 015 00fe |#\n\n0x001726c4 016 00fe |#\n\n0x0018342a 017 00fe |#\n\n0x00194190 018 00fe |#\n\n0x001a4ef6 019 00fe |#\n\n0x001b5c5c 01a 00fe |#\n\n0x001c69c2 01b 00fe |###################################################\n\n0x001d7728 01c 00f6 |#\n\n0x001e848e 01d 00f6 |#################################################\n\nPS C:\\Users\\labo\\Desktop>\n\n Having done this basic analysis I would be confident that the binary holds something packed into it. So the next step would involve opening it in radare2 to do the debugging:\n\n```\n\n-----\n\n```\nradare2 AAA\n\n[0x005e4000]> ood\n\nSpawned new process with pid 2904, tid = 2104\n\n= attach 2904 2104\n\nFile dbg://C:\\\\Users\\\\labo\\\\Desktop\\\\Zeichnungen\\ Muster.bin.exe reopened in readwrite mode\n\n2904\n\n[0x777b3820]> pd 10\n\n      ;-- rip:\n\n      0x777b3820   48       dec eax\n\n      0x777b3821   83ec48     sub esp, 0x48\n\n      0x777b3824   4c       dec esp\n\n      0x777b3825   8bc9      mov ecx, ecx\n\n      0x777b3827   48       dec eax\n\n      0x777b3828   8b055af40d00  mov eax, dword [0xdf45a]  ;\n[0xdf45a:4]=-1\n\n      0x777b382e   48       dec eax\n\n      0x777b382f   85c0      test eax, eax\n\n   ,=< 0x777b3831   740c      je 0x777b383f\n\n    |  0x777b3833   4c       dec esp\n\n[0x777b3820]> dcu entry0\n\nContinue until 0x00ad4000 using 1 bpsize\n\n(2904) loading library at 0x0000000077760000 (C:\\Windows\\System32\\ntdll.dll)\nntdll.dll\n\n(2904) loading library at 0x0000000077920000 (C:\\Windows\\SysWOW64\\ntdll.dll)\nntdll.dll\n\n(2904) loading library at 0x0000000074410000 (C:\\Windows\\System32\\wow64.dll)\nwow64.dll\n\n(2904) loading library at 0x00000000743B0000 (C:\\Windows\\System32\\wow64win.dll)\nwow64win.dll\n\n(2904) loading library at 0x00000000743A0000 (C:\\Windows\\System32\\wow64cpu.dll)\nwow64cpu.dll\n\n[0x77806fb1]> dcu entry0\n\nContinue until 0x00ad4000 using 1 bpsize\n\n(2904) loading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2904) unloading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2904) loading library at 0x00000000765F0000 (C:\\Windows\\SysWOW64\\kernel32.dll)\nkernel32.dll\n\n(2904) unloading library at 0x00000000765F0000 (C:\\Windows\\SysWOW64\\kernel32.dll)\nkernel32.dll\n\n(2904) loading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2904) unloading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2904) loading library at 0x0000000077660000 (C:\\Windows\\System32\\user32.dll)\nuser32.dll\n\n(2904) unloading library at 0x0000000077660000 (C:\\Windows\\System32\\user32.dll)\nuser32.dll\n\n(2904) loading library at 0x00000000765F0000 (C:\\Windows\\SysWOW64\\kernel32.dll)\nkernel32.dll\n\n```\n\n-----\n\n```\n(2904) loading library at 0x0000000076800000 (C:\\Windows\\SysWOW64\\KernelBase.dll)\nKernelBase.dll\n\n(2904) loading library at 0x0000000074390000 (C:\\Windows\\SysWOW64\\wsock32.dll)\nwsock32.dll\n\n(2904) loading library at 0x0000000076880000 (C:\\Windows\\SysWOW64\\ws2_32.dll)\nws2_32.dll\n\n(2904) loading library at 0x0000000077480000 (C:\\Windows\\SysWOW64\\msvcrt.dll)\nmsvcrt.dll\n\n(2904) loading library at 0x0000000075E60000 (C:\\Windows\\SysWOW64\\rpcrt4.dll)\nrpcrt4.dll\n\n(2904) loading library at 0x0000000075090000 (C:\\Windows\\SysWOW64\\sspicli.dll)\nsspicli.dll\n\n(2904) loading library at 0x0000000075080000 (C:\\Windows\\SysWOW64\\cryptbase.dll)\ncryptbase.dll\n\n(2904) loading library at 0x00000000761C0000 (C:\\Windows\\SysWOW64\\sechost.dll)\nsechost.dll\n\n(2904) loading library at 0x0000000077530000 (C:\\Windows\\SysWOW64\\nsi.dll) nsi.dll\n\n(2904) loading library at 0x0000000074380000 (C:\\Windows\\SysWOW64\\version.dll)\nversion.dll\n\n(2904) loading library at 0x0000000074340000 (C:\\Windows\\SysWOW64\\winmm.dll)\nwinmm.dll\n\n(2904) loading library at 0x0000000077370000 (C:\\Windows\\SysWOW64\\user32.dll)\nuser32.dll\n\n(2904) loading library at 0x00000000761F0000 (C:\\Windows\\SysWOW64\\gdi32.dll)\ngdi32.dll\n\n(2904) loading library at 0x0000000076410000 (C:\\Windows\\SysWOW64\\lpk.dll) lpk.dll\n\n(2904) loading library at 0x0000000075F60000 (C:\\Windows\\SysWOW64\\usp10.dll)\nusp10.dll\n\n(2904) loading library at 0x0000000076700000 (C:\\Windows\\SysWOW64\\advapi32.dll)\nadvapi32.dll\n\n(2904) loading library at 0x000000006E780000\n(C:\\Windows\\winsxs\\x86_microsoft.windows.common-controlll32.dll) comctl32.d\n\n(2904) loading library at 0x00000000750F0000 (C:\\Windows\\SysWOW64\\shlwapi.dll)\nshlwapi.dll\n\n(2904) loading library at 0x0000000074320000 (C:\\Windows\\SysWOW64\\mpr.dll) mpr.dll\n\n(2904) loading library at 0x0000000076A70000 (C:\\Windows\\SysWOW64\\wininet.dll)\nwininet.dll\n\n(2904) loading library at 0x00000000768C0000 (C:\\Windows\\SysWOW64\\api-ms-windownlevel-user32-l1-1-0.dllel-user32-l1-1-0\n\n(2904) loading library at 0x00000000764B0000 (C:\\Windows\\SysWOW64\\api-ms-windownlevel-shlwapi-l1-1--0.dlll-shlwapi-l1-1\n\n(2904) loading library at 0x0000000075E50000 (C:\\Windows\\SysWOW64\\api-ms-windownlevel-version-l1-1--0.dlll-version-l1-1\n\n(2904) loading library at 0x0000000077360000 (C:\\Windows\\SysWOW64\\api-ms-windownlevel-normaliz-l1-1-1-0.dll-normaliz-l1\n\n(2904) loading library at 0x00000000761B0000 (C:\\Windows\\SysWOW64\\normaliz.dll)\nnormaliz.dll\n\n(2904) loading library at 0x0000000076F30000 (C:\\Windows\\SysWOW64\\iertutil.dll)\niertutil.dll\n\n(2904) loading library at 0x0000000075F50000 (C:\\Windows\\SysWOW64\\api-ms-windownlevel-advapi32-l1-1-1-0.dll-advapi32-l1\n\n(2904) loading library at 0x0000000075150000 (C:\\Windows\\SysWOW64\\userenv.dll)\n\n```\n\n-----\n\n```\nuserenv.dll\n\n(2904) loading library at 0x0000000077470000 (C:\\Windows\\SysWOW64\\profapi.dll)\nprofapi.dll\n\n(2904) loading library at 0x00000000761E0000 (C:\\Windows\\SysWOW64\\psapi.dll)\npsapi.dll\n\n(2904) loading library at 0x0000000074300000 (C:\\Windows\\SysWOW64\\IPHLPAPI.DLL)\nIPHLPAPI.DLL\n\n(2904) loading library at 0x00000000742F0000 (C:\\Windows\\SysWOW64\\winnsi.dll)\nwinnsi.dll\n\n(2904) loading library at 0x0000000074210000 (C:\\Windows\\SysWOW64\\uxtheme.dll)\nuxtheme.dll\n\n(2904) loading library at 0x0000000076280000 (C:\\Windows\\SysWOW64\\comdlg32.dll)\ncomdlg32.dll\n\n(2904) loading library at 0x0000000075200000 (C:\\Windows\\SysWOW64\\shell32.dll)\nshell32.dll\n\n(2904) loading library at 0x0000000076020000 (C:\\Windows\\SysWOW64\\ole32.dll)\nole32.dll\n\n(2904) loading library at 0x0000000076310000 (C:\\Windows\\SysWOW64\\oleaut32.dll)\noleaut32.dll\n\n[0x779c0fc5]> dcu entry0\n\nContinue until 0x00ad4000 using 1 bpsize\n\n(2904) loading library at 0x0000000077300000 (C:\\Windows\\SysWOW64\\imm32.dll)\nimm32.dll\n\n(2904) loading library at 0x0000000076E60000 (C:\\Windows\\SysWOW64\\msctf.dll)\nmsctf.dll\n\nhit breakpoint at: 0xad4000\n\n[0x00ad4000]>\n\n## So we run the program until we reach the entry point (entry0) to allow it to load the requiered libraries.\n\n After that, we can try to pd/pdf and see if we can easily grasp something. But in many cases such as that its either we have a lot of time and/or a huge interesting in knowing everything or we’d just set breakpoints on relevant api calls and try to detect some behaviour.\n\n So the program starts with what looks like some decoding process:\n\n```\n\n-----\n\n```\n[0x00ad4000]> pd 20\n\n      ;-- section..text_1:\n\n      ;-- map.IMAGE____.__x:\n\n      ;-- rdx:\n\n      ;-- rip:\n\n/ 506: entry0 (int32_t arg_1ch);\n\n|      ; var int32_t var_1ch_2 @ rsp+0x1c\n\n|      ; var int32_t var_1ch @ rsp+0x60\n\n|      ; arg int32_t arg_1ch @ rsp+0x70\n\n|      0x00ad4000   60       pushal           ; [05] -rwx\nsection size 110592 named .text_1\n\n|      0x00ad4001   e800000000   call 0xad4006\n\n|      ; CALL XREF from entry0 @ 0xad4001\n\n|      0x00ad4006   5d       pop ebp\n\n|      0x00ad4007   8bc5      mov eax, ebp\n\n|      0x00ad4009   81eda8a60120  sub ebp, 0x2001a6a8\n\n|      0x00ad400f   2b850fae0120  sub eax, dword [ebp + 0x2001ae0f]\n\n|      0x00ad4015   89850bae0120  mov dword [ebp + 0x2001ae0b], eax\n\n|      0x00ad401b   b000      mov al, 0\n\n|      0x00ad401d   868540b00120  xchg byte [ebp + 0x2001b040], al\n\n|      0x00ad4023   3c01      cmp al, 1          ; 1\n\n|   ,=< 0x00ad4025   0f85bc010000  jne 0xad41e7\n\n|    |  0x00ad402b   83bd3baf0120. cmp dword [ebp + 0x2001af3b], 0\n\n|  ,==< 0x00ad4032   7433      je 0xad4067\n\n|   ||  0x00ad4034   83bd3faf0120. cmp dword [ebp + 0x2001af3f], 0\n\n|  ,===< 0x00ad403b   742a      je 0xad4067\n\n|   |||  0x00ad403d   8b850bae0120  mov eax, dword [ebp + 0x2001ae0b]\n\n|   |||  0x00ad4043   2b853baf0120  sub eax, dword [ebp + 0x2001af3b]\n\n|   |||  0x00ad4049   8b00      mov eax, dword [eax]\n\n|   |||  0x00ad404b   898578af0120  mov dword [ebp + 0x2001af78], eax\n\n|   |||  0x00ad4051   8b850bae0120  mov eax, dword [ebp + 0x2001ae0b]\n\n[0x00ad4000]>\n\n## Ok so the packed hypothesis gains traction. The next thing from this point on is to go for the breakpoint in api calls strategy. In order to do that, let’s go check the libraries we have:\n\n```\n\n-----\n\n```\n[0x005d4000]> dmi\n\n[0x00ad4000]> dmi\n\n0x008f0000 0x00aef000 C:\\Users\\labo\\Desktop\\Zeichnungen Muster.bin.exe\n\n0x77760000 0x778ff000 C:\\Windows\\SYSTEM32\\ntdll.dll\n\n0x74410000 0x7444f000 C:\\Windows\\SYSTEM32\\wow64.dll\n\n0x743b0000 0x7440c000 C:\\Windows\\SYSTEM32\\wow64win.dll\n\n0x743a0000 0x743a8000 C:\\Windows\\SYSTEM32\\wow64cpu.dll\n\n0x008f0000 0x00aef000 C:\\Users\\labo\\Desktop\\Zeichnungen Muster.bin.exe\n\n0x77920000 0x77aa0000 C:\\Windows\\SysWOW64\\ntdll.dll\n\n0x765f0000 0x76700000 C:\\Windows\\syswow64\\kernel32.dll\n\n0x76800000 0x76847000 C:\\Windows\\syswow64\\KERNELBASE.dll\n\n0x74390000 0x74397000 C:\\Windows\\SysWOW64\\WSOCK32.dll\n\n0x76880000 0x768b5000 C:\\Windows\\syswow64\\WS2_32.dll\n\n0x77480000 0x7752c000 C:\\Windows\\syswow64\\msvcrt.dll\n\n0x75e60000 0x75f50000 C:\\Windows\\syswow64\\RPCRT4.dll\n\n0x75090000 0x750f0000 C:\\Windows\\syswow64\\SspiCli.dll\n\n0x75080000 0x7508c000 C:\\Windows\\syswow64\\CRYPTBASE.dll\n\n0x761c0000 0x761d9000 C:\\Windows\\SysWOW64\\sechost.dll\n\n0x77530000 0x77536000 C:\\Windows\\syswow64\\NSI.dll\n\n0x74380000 0x74389000 C:\\Windows\\SysWOW64\\VERSION.dll\n\n0x74340000 0x74372000 C:\\Windows\\SysWOW64\\WINMM.dll\n\n0x77370000 0x77470000 C:\\Windows\\syswow64\\USER32.dll\n\n0x761f0000 0x76280000 C:\\Windows\\syswow64\\GDI32.dll\n\n0x76410000 0x7641a000 C:\\Windows\\syswow64\\LPK.dll\n\n0x75f60000 0x75ffd000 C:\\Windows\\syswow64\\USP10.dll\n\n0x76700000 0x767a1000 C:\\Windows\\syswow64\\ADVAPI32.dll\n\n0x6e780000 0x6e91e000 C:\\Windows\\WinSxS\\x86_microsoft.windows.commoncontrols_6595b64144ccf1df_6.0.2.dllbd5705d\\COMCTL\n\n0x750f0000 0x75147000 C:\\Windows\\syswow64\\SHLWAPI.dll\n\n0x74320000 0x74332000 C:\\Windows\\SysWOW64\\MPR.dll\n\n0x76a70000 0x76e51000 C:\\Windows\\syswow64\\WININET.dll\n\n0x768c0000 0x768c4000 C:\\Windows\\syswow64\\api-ms-win-downlevel-user32-l1-1-0.dll\n\n0x764b0000 0x764b4000 C:\\Windows\\syswow64\\api-ms-win-downlevel-shlwapi-l1-1-0.dll\n\n0x75e50000 0x75e54000 C:\\Windows\\syswow64\\api-ms-win-downlevel-version-l1-1-0.dll\n\n0x77360000 0x77363000 C:\\Windows\\syswow64\\api-ms-win-downlevel-normaliz-l1-1-0.dll\n\n0x761b0000 0x761b3000 C:\\Windows\\syswow64\\normaliz.DLL\n\n0x76f30000 0x77166000 C:\\Windows\\syswow64\\iertutil.dll\n\n0x75f50000 0x75f55000 C:\\Windows\\syswow64\\api-ms-win-downlevel-advapi32-l1-1-0.dll\n\n0x75150000 0x75167000 C:\\Windows\\syswow64\\USERENV.dll\n\n0x77470000 0x7747b000 C:\\Windows\\syswow64\\profapi.dll\n\n0x761e0000 0x761e5000 C:\\Windows\\syswow64\\PSAPI.DLL\n\n0x74300000 0x7431c000 C:\\Windows\\SysWOW64\\IPHLPAPI.DLL\n\n0x742f0000 0x742f7000 C:\\Windows\\SysWOW64\\WINNSI.DLL\n\n0x74210000 0x74290000 C:\\Windows\\SysWOW64\\UxTheme.dll\n\n0x76280000 0x762fb000 C:\\Windows\\syswow64\\COMDLG32.dll\n\n0x75200000 0x75e4c000 C:\\Windows\\syswow64\\SHELL32.dll\n\n0x76020000 0x7617d000 C:\\Windows\\syswow64\\ole32.dll\n\n0x76310000 0x763a1000 C:\\Windows\\syswow64\\OLEAUT32.dll\n\n0x77300000 0x77360000 C:\\Windows\\SysWOW64\\IMM32.DLL\n\n0x76e60000 0x76f2d000 C:\\Windows\\syswow64\\MSCTF.dll\n\n[0x00ad4000]>\n\n```\n\n-----\n\n## And then identify some interesting file / memory management / process injection related api calls in kernel32 and set those breakpoints there:\n```\n[0x00ad4000]> dmi kernel32 VirtualAlloc\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib                name\n\n---------------------------------------------------------------------------------\n1264 0x00011826 0x76601826 GLOBAL FUNC 0  KERNEL32.dll           \nVirtualAlloc\n\n4  0x00010908 0x76600908 NONE  FUNC 0  API-MS-Win-Core-Memory-L1-1-0.dll\nimp.VirtualAlloc\n\n[0x00ad4000]> dmi kernel32 VirtualProtect\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib                name\n\n---------------------------------------------------------------------------------\n1270 0x000143be 0x766043be GLOBAL FUNC 0  KERNEL32.dll           \nVirtualProtect\n\n8  0x00010918 0x76600918 NONE  FUNC 0  API-MS-Win-Core-Memory-L1-1-0.dll\nimp.VirtualProtect\n\n[0x00ad4000]> dmi kernel32 WriteFile\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib               name\n-------------------------------------------------------------------------------1324 0x00011282 0x76601282 GLOBAL FUNC 0  KERNEL32.dll          WriteFile\n\n9  0x000109e4 0x766009e4 NONE  FUNC 0  API-MS-Win-Core-File-L1-1-0.dll\nimp.WriteFile\n\n[0x00ad4000]> dmi kernel32 CreateProcessInternalW\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib     name\n\n-----------------------------------------------------------\n170 0x00023c23 0x76613c23 GLOBAL FUNC 0  KERNEL32.dll CreateProcessInternalW\n\n[0x00ad4000]> dmi kernel32 CreateProcessInternalA\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib     name\n\n-----------------------------------------------------------\n169 0x0002a507 0x7661a507 GLOBAL FUNC 0  KERNEL32.dll CreateProcessInternalA\n\n[\n\n[0x00ad4000]>\n\n[0x00ad4000]> dmi kernel32 IsDebuggerPresent\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib               name\n-------------------------------------------------------------------------------770 0x0001494d 0x7660494d GLOBAL FUNC 0  KERNEL32.dll          \nIsDebuggerPresent\n\n4  0x00010d94 0x76600d94 NONE  FUNC 0  API-MS-Win-Core-Debug-L1-1-0.dll\nimp.IsDebuggerPresent\n\n```\n\n-----\n\n## Basically we ll want to see if the program writes any content on disk and/or on memory and if it does we’ll also want to know if the malware tries to run that in some way.\n\n NtResumeThread/NtResumeProcess are useful for that same reason as well:\n```\n0x00ad4000]> dmi ntdll NtResumeThread\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib    name\n\n--------------------------------------------------------\n480 0x000691c0 0x777c9dc0 GLOBAL FUNC 0  ntdll.dll NtResumeThread\n\n Here’s a list of some breakpoints that I would set, based on the functions listed:\n[0x00ad4000]> db 0x7660494d\n\n[0x00ad4000]> db\n\n0x76601826 - 0x76601827 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x76601826\"\nmodule=\"\"\n\n0x766043be - 0x766043bf 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x766043be\"\nmodule=\"\"\n\n0x76601282 - 0x76601283 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x76601282\"\nmodule=\"\"\n\n0x76613c23 - 0x76613c24 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x76613c23\"\nmodule=\"\"\n\n0x7661a507 - 0x7661a508 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x7661a507\"\nmodule=\"\"\n\n0x777c9dc0 - 0x777c9dc1 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x777c9dc0\"\nmodule=\"\"\n\n0x7660494d - 0x7660494e 1 --x sw break enabled valid cmd=\"\" cond=\"\" name=\"0x7660494d\"\nmodule=\"\"\n\n[0x00ad4000]>\n\n Having set those, let’s do dc and see if we hit any:\n\n We hit the first breakpoint, and it corresponds to WriteFile. Let’s inspect the stack:\n[0x762c35b0]> pxr @rsp\n\n0x015ff9bc 0x005d46ed .F]. @ rsp IMAGE .text_1 R W X 'mov ebx, dword [ebp + 8]'\n'IMAGE '\n\n0x015ff9c0 0x00000210 .... 528 rdx\n\n0x015ff9c4 0x005d499f .I]. IMAGE .text_1 R W X 'dec ebp' 'IMAGE '\n\n0x015ff9c8 0x0001a600 ....\n\n0x015ff9cc 0x015ff9d8 .._. PRIVATE rax R W 0xca373ff5\n\n0x015ff9d0 ..[ null bytes ]..  00000000\n\n0x015ff9d4 0x00000210 .... 528 rdx\n\n0x015ff9d8 0xca373ff5 .?7. @ rax\n\n0x015ff9dc 0xe05b995e ^.[. @ rbp rbx\n\n0x015ff9e0 0x005d41c6 .A]. IMAGE .text_1 entry0 R W X 'cmp eax, 1' 'IMAGE '\n\n0x015ff9e4 0xe05b995e ^.[. rbx\n\n0x015ff9ec 0x005d499f .I]. IMAGE .text_1 R W X 'dec ebp' 'IMAGE '\n\n```\n\n-----\n\n## Ok si it s defefinetely writing something into the stack, what it is?\n```\n[0x76601282]> pxw 400 @ 0x00ad499f\n\n0x00ad499f 0x00905a4d 0x00000003 0x00000004 0x0000ffff MZ..............\n\n0x00ad49af 0x000000b8 0x00000000 0x00000040 0x00000000 ........@.......\n\n0x00ad49bf 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad49cf 0x00000000 0x00000000 0x00000000 0x00000088 ................\n\n0x00ad49df 0xc5f5da09 0x25ea24c8 0x7e5c05f0 0xfa1056b5 .....$.%..\\~.V..\n\n0x00ad49ef 0x8427934a 0x1bc0eb0a 0xcb8422dc 0xb1054f0c J.'......\"...O..\n\n0x00ad49ff 0x04feeb0e 0x2b7bbfa2 0x7338965b 0xbe932367 ......{+[.8sg#..\n\n0x00ad4a0f 0x6a7d9a28 0x17c1b915 0x10bcf4d0 0x0ce64e2f (.}j......../N..\n\n0x00ad4a1f 0x00000000 0x00000000 0x00004550 0x0003014c ........PE..L...\n\n0x00ad4a2f 0x356b0f6b 0x00000000 0x00000000 0x010f00e0 k.k5............\n\n0x00ad4a3f 0x0407010b 0x00013000 0x00008000 0x0003a000 .....0..........\n\n0x00ad4a4f 0x0004d240 0x0003b000 0x0004e000 0x00400000 @.............@.\n\n0x00ad4a5f 0x00001000 0x00000200 0x00000005 0x00020007 ................\n\n0x00ad4a6f 0x00000004 0x00000000 0x0005d000 0x00001000 ................\n\n0x00ad4a7f 0x00000000 0x00000002 0x00100000 0x00001000 ................\n\n0x00ad4a8f 0x00100000 0x00001000 0x00000000 0x00000010 ................\n\n0x00ad4a9f 0x00000000 0x00000000 0x00055874 0x000000e4 ........tX......\n\n0x00ad4aaf 0x0004e000 0x0000f000 0x00000000 0x00000000 ................\n\n0x00ad4abf 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad4acf 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad4adf 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad4aef 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad4aff 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad4b0f 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00ad4b1f 0x30585055 0x00000000 0x0003a000 0x00001000 UPX0............\n\n Nice it is writting something that looks like a UPX packed binary(so vintage)! Let’s move on, let’s see if it loads it/runs it at some point:\n\n And we hit dc and… we get to a CreateProcess* call!\n\n```\n\n-----\n\n```\nhit breakpoint at: 0x76613c23\n\n[0x76613c23]> pxr @ rsp\n\n0x0064f68c 0x7661a62a *.av @ rsp IMAGE  kernel32.dll | .text R X | .text'rd [ebp 0x1c], eax' 'IMAGE  kernel32.dll\n\n0x0064f690 ..[ null bytes ]..  00000000\n\n0x0064f698 0x006e77d8 .wn. PRIVATE  R W 0x3a0043\n\n0x0064f69c ..[ null bytes ]..  00000000\n\n0x0064f6b4 0x0064f6d0 ..d. PRIVATE  rax,rcx R W 0x48\n\n0x0064f6b8 0x0064f7d0 ..d. PRIVATE  R W 0x0\n\n0x0064f6bc ..[ null bytes ]..  00000000\n\n0x0064f6c0 0x55a1e22d -..U\n\n0x0064f6c4 0x0064f7e0 ..d. PRIVATE  R W 0x0\n\n0x0064f6c8 0x014d4795 .GM. IMAGE  Zeichnungen Muster.bin.exe | .text .text_1 R W\nXster.bin.exe | .text' r.binmgr.exee\n\n[0x76613c23]> pxw @ 0x006e77d8\n\n0x006e77d8 0x003a0043 0x0055005c 0x00650073 0x00730072 C.:.\\.U.s.e.r.s.\n\n0x006e77e8 0x006c005c 0x00620061 0x005c006f 0x00650044 \\.l.a.b.o.\\.D.e.\n\n0x006e77f8 0x006b0073 0x006f0074 0x005c0070 0x0065005a s.k.t.o.p.\\.Z.e.\n\n0x006e7808 0x00630069 0x006e0068 0x006e0075 0x00650067 i.c.h.n.u.n.g.e.\n\n0x006e7818 0x0020006e 0x0075004d 0x00740073 0x00720065 n. .M.u.s.t.e.r.\n\n0x006e7828 0x0062002e 0x006e0069 0x0067006d 0x002e0072 ..b.i.n.m.g.r...\n\n0x006e7838 0x00780065 0x00000065 0xabababab 0xabababab e.x.e...........\n\n0x006e7848 0x00000000 0x00000000 0x71fd6008 0x0000de77 .........`.qw...\n\n0x006e7858 0x006e9820 0x006e00c4 0x77fe600d 0x1800de65  .n...n..`.we...\n\n0x006e7868 0x00000000 0x00c70138 0x006e7ee0 0x006e35c8 ....8....~n..5n.\n\n0x006e7878 0x00000000 0x00000000 0x00000000 0xbaad0000 ................\n\n0x006e7888 0xabababab 0xabababab 0x00000000 0x00000000 ................\n\n0x006e7898 0x34fe604e 0x1800de60 0xfffde210 0xfffde210 N`.4`...........\n\n0x006e78a8 0x00000000 0x00c707e0 0x00000000 0x00000000 ................\n\n## And its creating a process on our newly created executable 8)\n\n So at this point, if we proceed hitting dc we’ll see a call to NtResumeProcess (as the created process will spawn in a suspended state), so the newly created binary will start its executing while the original one will go one, getting inside a loop checking for processes starting the second program if it stops somehow (more or less).\n\n As we are interested in the unpacking part, at this point we can either attach to the newly created process with (radare2 -d process id) or just open the generated binary for analysis/debug. I’ll go for the second option.\n\n Unpacking the second binary\n\n```\n\n-----\n\n## So as we detected, the second binary is UPX packed. We can either unpack it manually by checking for VirtualAlloc and stuff like that or we can just simply do upx -d (upx is included in the FLARE-VM or can be downloaded from the site)\n```\nPS C:\\Users\\labo\\Desktop> upx -d '.\\Zeichnungen Muster.binmgr.exe'\n\n            Ultimate Packer for eXecutables\n\n             Copyright (C) 1996 - 2020\n\nUPX 3.96w    Markus Oberhumer, Laszlo Molnar & John Reiser  Jan 23rd 2020\n\n    File size     Ratio   Format   Name\n\n  --------------------  ------  -----------  ----------\n  159232 <-  108032  67.85%  win32/pe   Zeichnungen Muster.binmgr.exe\n\nUnpacked 1 file.\n\nPS C:\\Users\\labo\\Desktop>\n\n After we unpack the program, its entropy descends to something that looks more normal:\nPS C:\\Users\\labo\\Desktop> rahash2.exe -a entropy '.\\Zeichnungen Muster.binmgr.exe'\n\n.\\Zeichnungen Muster.binmgr.exe: 0x00000000-0x00026dff entropy: 4.46272451\n\nPS C:\\Users\\labo\\Desktop>\n\n Also, we are not seeing weird stuff on its sections:\n[0x0040101a]> iS\n\n[Sections]\n\nnth paddr     size vaddr     vsize perm name\n\n----------------------------------------------------\n0  0x00000400  0x1200 0x00401000  0x2000 -r-x .text\n\n1  0x00001600 0x1cc00 0x00403000 0x3f000 -rw- .data\n\n2  0x0001e200  0x200 0x00442000  0x1000 -r-- .rdata\n\n3  0x0001e400  0x8a00 0x00443000  0x9000 -r-- .rsrc\n\n But still, let’s go on and debug:\n\n```\n\n-----\n\n```\n[0x0040101a]> ood\n\nSpawned new process with pid 2316, tid = 1172\n\n= attach 2316 1172\n\nFile dbg://C:\\\\Users\\\\labo\\\\Desktop\\\\Zeichnungen\\ Muster.binmgr.exe reopened in\nread-write mode\n\n2316\n\n[0x777b3820]> dcu entry0\n\nContinue until 0x0040101a using 1 bpsize\n\n(2316) loading library at 0x0000000077760000 (C:\\Windows\\System32\\ntdll.dll)\nntdll.dll\n\n(2316) loading library at 0x0000000077920000 (C:\\Windows\\SysWOW64\\ntdll.dll)\nntdll.dll\n\n(2316) loading library at 0x00000000743E0000 (C:\\Windows\\System32\\wow64.dll)\nwow64.dll\n\n(2316) loading library at 0x0000000074380000 (C:\\Windows\\System32\\wow64win.dll)\nwow64win.dll\n\n(2316) loading library at 0x0000000074450000 (C:\\Windows\\System32\\wow64cpu.dll)\nwow64cpu.dll\n\n[0x77806fb1]> dcu entry0\n\nContinue until 0x0040101a using 1 bpsize\n\n(2316) loading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2316) unloading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2316) loading library at 0x00000000765F0000 (C:\\Windows\\SysWOW64\\kernel32.dll)\nkernel32.dll\n\n(2316) unloading library at 0x00000000765F0000 (C:\\Windows\\SysWOW64\\kernel32.dll)\nkernel32.dll\n\n(2316) loading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2316) unloading library at 0x0000000077540000 (C:\\Windows\\System32\\kernel32.dll)\nkernel32.dll\n\n(2316) loading library at 0x0000000077660000 (C:\\Windows\\System32\\user32.dll)\nuser32.dll\n\n(2316) unloading library at 0x0000000077660000 (C:\\Windows\\System32\\user32.dll)\nuser32.dll\n\n(2316) loading library at 0x00000000765F0000 (C:\\Windows\\SysWOW64\\kernel32.dll)\nkernel32.dll\n\n(2316) loading library at 0x0000000076800000 (C:\\Windows\\SysWOW64\\KernelBase.dll)\nKernelBase.dll\n\n(2316) loading library at 0x0000000077370000 (C:\\Windows\\SysWOW64\\user32.dll)\nuser32.dll\n\n(2316) loading library at 0x00000000761F0000 (C:\\Windows\\SysWOW64\\gdi32.dll)\ngdi32.dll\n\n(2316) loading library at 0x0000000076410000 (C:\\Windows\\SysWOW64\\lpk.dll) lpk.dll\n\n(2316) loading library at 0x0000000075F60000 (C:\\Windows\\SysWOW64\\usp10.dll)\nusp10.dll\n\n(2316) loading library at 0x0000000077480000 (C:\\Windows\\SysWOW64\\msvcrt.dll)\nmsvcrt.dll\n\n(2316) loading library at 0x0000000076700000 (C:\\Windows\\SysWOW64\\advapi32.dll)\nadvapi32.dll\n\n(2316) loading library at 0x00000000761C0000 (C:\\Windows\\SysWOW64\\sechost.dll)\n\n```\n\n-----\n\n```\nsechost.dll\n\n(2316) loading library at 0x0000000075E60000 (C:\\Windows\\SysWOW64\\rpcrt4.dll)\nrpcrt4.dll\n\n(2316) loading library at 0x0000000075090000 (C:\\Windows\\SysWOW64\\sspicli.dll)\nsspicli.dll\n\n(2316) loading library at 0x0000000075080000 (C:\\Windows\\SysWOW64\\cryptbase.dll)\ncryptbase.dll\n\n[0x779c0fc5]> dcu entry0\n\nContinue until 0x0040101a using 1 bpsize\n\n(2316) loading library at 0x0000000077300000 (C:\\Windows\\SysWOW64\\imm32.dll)\nimm32.dll\n\n(2316) loading library at 0x0000000076E60000 (C:\\Windows\\SysWOW64\\msctf.dll)\nmsctf.dll\n\nhit breakpoint at: 0x40101a\n\n[0x0040101a]>\n\n## In here we follow the same process, I’ll look for memory management and potential process injection / infection techniques:\n\n```\n\n-----\n\n```\nhit breakpoint at: 0x40101a\n\n[0x0040101a]> dmi kernel32 VirtualAlloc\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib                name\n\n---------------------------------------------------------------------------------\n1264 0x00011826 0x76601826 GLOBAL FUNC 0  KERNEL32.dll           \nVirtualAlloc\n\n4  0x00010908 0x76600908 NONE  FUNC 0  API-MS-Win-Core-Memory-L1-1-0.dll\nimp.VirtualAlloc\n\n[0x0040101a]> dmi kernel32 VirtualProtect\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib                name\n\n---------------------------------------------------------------------------------\n1270 0x000143be 0x766043be GLOBAL FUNC 0  KERNEL32.dll           \nVirtualProtect\n\n8  0x00010918 0x76600918 NONE  FUNC 0  API-MS-Win-Core-Memory-L1-1-0.dll\nimp.VirtualProtect\n\n[0x0040101a]> dmi kernel32 WriteFile\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib               name\n-------------------------------------------------------------------------------1324 0x00011282 0x76601282 GLOBAL FUNC 0  KERNEL32.dll          WriteFile\n\n9  0x000109e4 0x766009e4 NONE  FUNC 0  API-MS-Win-Core-File-L1-1-0.dll\nimp.WriteFile\n\nnth paddr   vaddr   bind  type size lib                name\n\n---------------------------------------------------------------------------------\n1333 0x0002da28 0x7661da28 GLOBAL FUNC 0  KERNEL32.dll           \nWriteProcessMemory\n\n9  0x0001091c 0x7660091c NONE  FUNC 0  API-MS-Win-Core-Memory-L1-1-0.dll\nimp.WriteProcessMemory\n\n[0x0040101a]> dmi kernel32 IsDebuggerPresent\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib               name\n-------------------------------------------------------------------------------770 0x0001494d 0x7660494d GLOBAL FUNC 0  KERNEL32.dll          \nIsDebuggerPresent\n\n4  0x00010d94 0x76600d94 NONE  FUNC 0  API-MS-Win-Core-Debug-L1-1-0.dll\nimp.IsDebuggerPresent\n\n[0x0040101a]> dmi kernel32 CreateProcessInternalA\n\n[Symbols]\n\nnth paddr   vaddr   bind  type size lib     name\n\n-----------------------------------------------------------\n169 0x0002a507 0x7661a507 GLOBAL FUNC 0  KERNEL32.dll CreateProcessInternalA\n\n[0x0040101a]> dmi kernel32 CreateProcessInternalW\n\n[Symbols]\n\n```\n\n-----\n\n```\nnth paddr   vaddr   bind  type size lib     name\n\n-----------------------------------------------------------\n170 0x00023c23 0x76613c23 GLOBAL FUNC 0  KERNEL32.dll CreateProcessInternalW\n\n## And we hit dc, the program calls VirtualAlloc. When the program calls VirtualAlloc and the call returns RAX/EAX will contain a pointer to the newly allocated space. We will keep track of those spaces to see if something gets written into them as the execution goes on:\n[0x0040101a]> dc\n\nhit breakpoint at: 0x76601826\n\n[0x76601826]> dcr\n\nhit breakpoint at: 0x7680f13d\n\n[0x7680f13e]> dr eax\n\n0x00220000\n\n[0x7680f13e]>\n\n After the first call, some content gets written into the first buffer, mm not very clear:\n[0x7680f13e]> dc\n\nhit breakpoint at: 0x76601826\n\n[0x76601826]> pxw @ 0x00220000\n\n0x00220000 0x81ec8b55 0xfff448c4 0xe3e853ff 0x8b000006 U....H...S......\n\n0x00220010 0x4589fc45 0x18a164c8 0x8b000000 0x408b3040 E..E.d......@0.@\n\n0x00220020 0x4c858954 0x6afffff6 0x04408d04 0x48858d50 T..L...j..@.P..H\n\n0x00220030 0x50fffff4 0xbec1c368 0x080de836 0xa1680000 ...Ph...6.....h.\n\n0x00220040 0x50753cf4 0x00085fe8 0x8bd0ff00 0xfff44885 .<uP._.......H..\n\n0x00220050 0x75c00bff 0x4c858b0b 0x8bfffff6 0x03eb3840 ...u...L....@8..\n\n0x00220060 0x8b04408b 0x200d0440 0x3d002000 0x0077007c .@..@.. . .=|.w.\n\n0x00220070 0xc95b0374 0xa485c6c3 0x41fffffd 0xfda585c6 t.[........A....\n\n0x00220080 0xc644ffff 0xfffda685 0x85c656ff 0xfffffda7 ..D......V......\n\n0x00220090 0xa885c641 0x50fffffd 0xfda985c6 0xc649ffff A......P......I.\n\n0x002200a0 0xfffdaa85 0x85c633ff 0xfffffdab 0xac85c632 .....3......2...\n\n0x002200b0 0x2efffffd 0xfdad85c6 0xc644ffff 0xfffdae85 ..........D.....\n\n0x002200c0 0x85c64cff 0xfffffdaf 0xb085c64c 0x00fffffd .L......L.......\n\n0x002200d0 0xfda4858d 0xe850ffff 0x0000083c 0xf65485c6 ......P.<.....T.\n\n0x002200e0 0xc653ffff 0xfff65585 0x85c64fff 0xfffff656 ..S..U...O..V...\n\n0x002200f0 0x5785c646 0x54fffff6 0xf65885c6 0xc657ffff F..W...T..X...W.\n\n We run the second call till return, then check again:\n[0x76601826]> dcr\n\nhit breakpoint at: 0x7680f13d\n\n[0x7680f13e]> dr eax\n\n0x00230000\n\n And we do it another time:\n\n```\n\n-----\n\n```\n[0x7680f13e]> dc\n\nhit breakpoint at: 0x76601826\n\n[0x76601826]> dcr\n\nhit breakpoint at: 0x7680f13d\n\n[0x7680f13e]> dr eax\n\n0x00240000\n\n## Then look at this!\n[0x7680f13e]> dr eax\n\n0x00240000\n\n[0x7680f13e]> dc\n\nhit breakpoint at: 0x766043be\n\n[0x766043be]> pxw 600 @ 0x00240000\n\n0x00240000 0x00905a4d 0x00000003 0x00000004 0x0000ffff MZ..............\n\n0x00240010 0x000000b8 0x00000000 0x00000040 0x00000000 ........@.......\n\n0x00240020 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00240030 0x00000000 0x00000000 0x00000000 0x000000c8 ................\n\n0x00240040 0x0eba1f0e 0xcd09b400 0x4c01b821 0x685421cd ........!..L.!Th\n\n0x00240050 0x70207369 0x72676f72 0x63206d61 0x6f6e6e61 is program canno\n\n0x00240060 0x65622074 0x6e757220 0x206e6920 0x20534f44 t be run in DOS\n\n0x00240070 0x65646f6d 0x0a0d0d2e 0x00000024 0x00000000 mode....$.......\n\n0x00240080 0x55d9e2b7 0x06b783f3 0x06b783f3 0x06b783f3 ...U............\n\n0x00240090 0x06a49c7d 0x06b783c1 0x06a5a30f 0x06b783f2 }...............\n\n0x002400a0 0x06b18534 0x06b783f2 0x68636952 0x06b783f3 4.......Rich....\n\n0x002400b0 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x002400c0 0x00000000 0x00000000 0x00004550 0x0003014c ........PE..L...\n\n0x002400d0 0x4cdbdf6c 0x00000000 0x00000000 0x010f00e0 l..L............\n\n0x002400e0 0x0c05010b 0x0000b000 0x00001000 0x00015000 .............P..\n\n0x002400f0 0x000209e0 0x00016000 0x00021000 0x00400000 .....`........@.\n\n0x00240100 0x00001000 0x00000200 0x00000004 0x00000000 ................\n\n0x00240110 0x00000004 0x00000000 0x00022000 0x00001000 ......... ......\n\n0x00240120 0x00000000 0x00000002 0x00100000 0x00001000 ................\n\n0x00240130 0x00100000 0x00001000 0x00000000 0x00000010 ................\n\n0x00240140 0x00000000 0x00000000 0x000216b8 0x00000114 ................\n\n0x00240150 0x00021000 0x000006b8 0x00000000 0x00000000 ................\n\n0x00240160 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00240170 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00240180 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x00240190 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x002401a0 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x002401b0 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n0x002401c0 0x30585055 0x00000000 0x00015000 0x00001000 UPX0.....P......\n\n0x002401d0 0x00000000 0x00000400 0x00000000 0x00000000 ................\n\n0x002401e0 0x00000000 0xe0000080 0x31585055 0x00000000 ........UPX1....\n\n0x002401f0 0x0000b000 0x00016000 0x0000ac00 0x00000400 .....`..........\n\n0x00240200 0x00000000 0x00000000 0x00000000 0xe0000040 ............@...\n\n0x00240210 0x7273722e 0x00000063 0x00001000 0x00021000 .rsrc...........\n\n0x00240220 0x00000800 0x0000b000 0x00000000 0x00000000 ................\n\n0x00240230 0x00000000 0xc0000040 0x00000000 0x00000000 ....@...........\n\n0x00240240 0x00000000 0x00000000 0x00000000 0x00000000 ................\n\n```\n\n-----\n\n## Another UPX packed binary!!\n\n At this point, if we follow the execution of the program we’ll see calls on VirtualProtect, related to changing RWX/RW permissions on the program itself, some content being written/decoded and a call to the binary via some decoded shellcode\n```\n[0x766043be]> pxr @ rsp\n\n0x0018f3a0 0x002209db ..\". @ rsp PRIVATE  R W X 'leave' 'PRIVATE '\n\n0x0018f3a4 0x00400000 ..@. IMAGE  Zeichnungen Muster.binmgr.exe ascii ('\n\n0x0018f3a8 0x0004c000 ....\n\n0x0018f3ac 0x00000040 @... 64 ascii ('@')\n\n0x0018f3b0 0x0018f3b4 .... PRIVATE  R W 0x1e1f5b\n\n0x0018f3b4 0x001e1f5b [... MAPPED \n\\Device\\HarddiskVolume2\\Windows\\System32\\locale.nls rsi R 0x6e006500\n\n So if we want to move forward, we can just go dump the memory space of the UPX binary we detected. We can do it with process hacker or with radare itself + cat as we did on the previous post.\n\n Unpacking the final binary\n\n So we repeat the unpacking process with the final binary:\n\n```\n\n-----\n\n```\nPS C:\\Users\\labo\\Desktop> upx d .\\dumpZeichnungen Muster.binmgr.exe_0x240000\n0x1d000.exe'\n\n            Ultimate Packer for eXecutables\n\n             Copyright (C) 1996 - 2020\n\nUPX 3.96w    Markus Oberhumer, Laszlo Molnar & John Reiser  Jan 23rd 2020\n\n    File size     Ratio   Format   Name\n\n  --------------------  ------  -----------  ----------\n  189952 <-  118784  62.53%  win32/pe   dumpZeichnungen\nMuster.binmgr.exe_0x240000-0x1d000.exe\n\nUnpacked 1 file.\n\nPS C:\\Users\\labo\\Desktop>\n\n## And we will see that this time everything looks clearer, we can even get a general idea of what the malware does:\n\n```\n\n-----\n\n```\nPS C:\\Users\\labo\\Desktop> radare2.exe .\\dumpZeichnungen Muster.binmgr.exe_0x240000\n0x1d000.exe'\n\n -- Mess with the best, Die like the rest\n\n[0x00402c23]> aaa\n\n[Warning: set your favourite calling convention in `e anal.cc=?`\n\n[x] Analyze all flags starting with sym. and entry0 (aa)\n\n[x] Analyze function calls (aac)\n\n[x] Analyze len bytes of instructions for references (aar)\n\n[x] Finding and parsing C++ vtables (avrr)\n\n[x] Type matching analysis for all functions (aaft)\n\n[x] Propagate noreturn information (aanr)\n\n[x] Use -AA or aaaa to perform additional experimental analysis.\n\n[0x00402c23]> afl\n\n0x00402c23  6 245     entry0\n\n0x0040181b  17 396     fcn.0040181b\n\n0x00402d60  1 6      sub.KERNEL32.DLL_GetModuleHandleA\n\n0x00402d66  1 6      sub.KERNEL32.DLL_GetProcAddress\n\n0x00401000  1 24      fcn.00401000\n\n0x004016d6  12 325     fcn.004016d6\n\n0x00401611  6 106     fcn.00401611\n\n0x00402d48  1 6      sub.KERNEL32.DLL_GetCurrentProcess\n\n0x00402e02  1 6      sub.advapi32.dll_OpenProcessToken\n\n0x00402dfc  1 6      sub.advapi32.dll_LookupPrivilegeValueA\n\n0x00402df6  1 6      sub.advapi32.dll_AdjustTokenPrivileges\n\n0x00402d18  1 6      fcn.00402d18\n\n0x00402a32  1 92      fcn.00402a32\n\n0x00402786  1 14      fcn.00402786\n\n0x00402d4e  1 6      sub.KERNEL32.DLL_GetCurrentProcessId\n\n0x004026d8  13 174     fcn.004026d8\n\n0x0040289a  4 61      fcn.0040289a\n\n0x004027c2  5 216     fcn.004027c2\n\n0x00402dd2  1 6      sub.KERNEL32.DLL_VirtualProtect\n\n0x004027a2  3 32      fcn.004027a2\n\n0x00401dbf  1 25      fcn.00401dbf\n\n0x00401c61  62 350     fcn.00401c61\n\n0x00402dc0  1 6      sub.KERNEL32.DLL_VirtualAlloc\n\n0x00401018  3 37      fcn.00401018\n\n0x00402794  1 14      fcn.00402794\n\n0x00401223  1 93      fcn.00401223\n\n0x00402d24  1 6      sub.KERNEL32.DLL_CreateProcessA\n\n0x00402a8e  3 55      fcn.00402a8e\n\n0x004028d7  5 122     fcn.004028d7\n\n0x00402dcc  1 6      sub.KERNEL32.DLL_VirtualFree\n\n0x004014cc  4 290     fcn.004014cc\n\n0x00402d72  1 6      sub.KERNEL32.DLL_GetWindowsDirectoryA\n\n0x00401052  5 57      fcn.00401052\n\n0x00402d6c  1 6      sub.KERNEL32.DLL_GetVolumeInformationA\n\n0x004013e0  1 58      fcn.004013e0\n\n0x00402df0  1 6      sub.user32.dll_wsprintfA\n\n0x004015ee  3 35      fcn.004015ee\n\n0x00402d8a  1 6      sub.KERNEL32.DLL_OpenMutexA\n\n0x00402ac5  5 169     fcn.00402ac5\n\n```\n\n-----\n\n```\n0x00402da2  1 6      sub.KERNEL32.DLL_Sleep\n\n0x00402bd6  6 77      fcn.00402bd6\n\n0x00402d30  1 6      sub.KERNEL32.DLL_ExitProcess\n\n0x0040108b  5 55      fcn.0040108b\n\n0x00402d78  1 6      sub.KERNEL32.DLL_GlobalAlloc\n\n0x00402d42  1 6      sub.KERNEL32.DLL_FindFirstFileA\n\n0x00402d3c  1 6      sub.KERNEL32.DLL_FindClose\n\n0x00401280  4 20      fcn.00401280\n\n0x00401294  19 167     fcn.00401294\n\n0x0040133b  6 95      fcn.0040133b\n\n0x004013be  1 34      fcn.004013be\n\n0x0040139a  1 36      fcn.0040139a\n\n0x00402e0e  1 6      sub.advapi32.dll_RegOpenKeyA\n\n0x00402e14  1 6      sub.advapi32.dll_RegQueryValueExA\n\n0x0040103d  1 21      fcn.0040103d\n\n0x00402e08  1 6      sub.advapi32.dll_RegCloseKey\n\n0x00402dea  1 6      sub.KERNEL32.DLL_lstrlenA\n\n0x00402de4  1 6      sub.KERNEL32.DLL_lstrcpyA\n\n0x0040167b  8 91      fcn.0040167b\n\n0x004011df  4 68      fcn.004011df\n\n0x00402d36  1 6      sub.KERNEL32.DLL_ExpandEnvironmentStringsA\n\n0x004019d5  1 28      fcn.004019d5\n\n0x00401a3e  4 43      fcn.00401a3e\n\n0x00401a1e  4 32      fcn.00401a1e\n\n0x00401a69  4 63      fcn.00401a69\n\n0x00401aa8  4 72      fcn.00401aa8\n\n0x00401af0  4 66      fcn.00401af0\n\n0x00402dc6  1 6      sub.KERNEL32.DLL_VirtualAllocEx\n\n0x00402dde  1 6      sub.KERNEL32.DLL_WriteProcessMemory\n\n0x0040255c  15 380     fcn.0040255c\n\n0x00401dd8  12 84      fcn.00401dd8\n\n0x00401e2c  3 61      fcn.00401e2c\n\n0x00402d5a  1 6      sub.KERNEL32.DLL_GetModuleFileNameA\n\n0x004019a7  1 28      fcn.004019a7\n\n0x00402d96  1 6      sub.KERNEL32.DLL_ReadProcessMemory\n\n0x00402168  4 98      fcn.00402168\n\n0x00401b32  4 72      fcn.00401b32\n\n0x00401b7a  21 231 -> 229 fcn.00401b7a\n\n0x00402d54  1 6      sub.KERNEL32.DLL_GetCurrentThreadId\n\n0x00402d2a  1 6      sub.KERNEL32.DLL_CreateToolhelp32Snapshot\n\n0x00402dae  1 6      sub.KERNEL32.DLL_Thread32First\n\n0x00402d90  1 6      sub.KERNEL32.DLL_OpenThread\n\n0x00402da8  1 6      sub.KERNEL32.DLL_SuspendThread\n\n0x00402d9c  1 6      sub.KERNEL32.DLL_ResumeThread\n\n0x00402db4  1 6      sub.KERNEL32.DLL_Thread32Next\n\n0x004021ca  7 128     fcn.004021ca\n\n0x00401f0e  21 602     fcn.00401f0e\n\n0x00402dd8  1 6      sub.KERNEL32.DLL_VirtualProtectEx\n\n0x00402d1e  1 6      sub.KERNEL32.DLL_CreateFileMappingA\n\n0x00402d7e  1 6      sub.KERNEL32.DLL_MapViewOfFile\n\n0x00402d84  1 6      sub.KERNEL32.DLL_OpenFileMappingA\n\n```\n\n-----\n\n```\n0x00402dba  1 6      sub.KERNEL32.DLL_UnmapViewOfFile\n\n[0x00402c23]>\n\n## For what I see here, it looks like it performs some kind of process injection. It may also try to gain some persistance or information on the machine by the register and maybe resolve some more calls related to its actual behavior by GetModuleHandle, LoadLibrary etc.\n\n```\n\n-----\n\n```\n[0x00402c23]> pdf\n\n      ;-- eip:\n\n/ 245: entry0 ();\n\n|      0x00402c23   e8f3ebffff   call fcn.0040181b\n\n|      0x00402c28   83f801     cmp eax, 1         ; 1\n\n|   ,=< 0x00402c2b   0f85e0000000  jne 0x402d11\n\n|    |  0x00402c31   6800040000   push 0x400         ; 1024\n\n|    |  0x00402c36   6870da4100   push 0x41da70\n\n|    |  0x00402c3b   e8c0e3ffff   call fcn.00401000\n\n|    |  0x00402c40   6800040000   push 0x400         ; 1024\n\n|    |  0x00402c45   6870da4100   push 0x41da70\n\n|    |  0x00402c4a   e887eaffff   call fcn.004016d6\n\n|    |  0x00402c4f   83f801     cmp eax, 1         ; 1\n\n|  ,==< 0x00402c52   0f85b9000000  jne 0x402d11\n\n|   ||  0x00402c58   6821404000   push 0x404021        ; '!@@' ;\n\"SeDebugPrivilege\"\n\n|   ||  0x00402c5d   e8afe9ffff   call fcn.00401611\n\n|   ||  0x00402c62   6800100100   push 0x11000\n\n|   ||  0x00402c67   6870424000   push 0x404270        ; 'pB@' ;\n\"MZ\\x90\"\n\n|   ||  0x00402c6c   e8c1fdffff   call fcn.00402a32\n\n|   ||  0x00402c71   6a01      push 1           ; 1\n\n|   ||  0x00402c73   6870da4100   push 0x41da70\n\n|   ||  0x00402c78   e8a6e5ffff   call fcn.00401223\n\n|   ||  0x00402c7d   e80cfeffff   call fcn.00402a8e\n\n|   ||  0x00402c82   b800880000   mov eax, 0x8800\n\n|   ||  0x00402c87   83f801     cmp eax, 1         ; 1\n\n|  ,===< 0x00402c8a   0f8681000000  jbe 0x402d11\n\n|   |||  0x00402c90   6871de4100   push 0x41de71\n\n|   |||  0x00402c95   6a00      push 0\n\n|   |||  0x00402c97   68ea0d0000   push 0xdea         ; 3562\n\n|   |||  0x00402c9c   e82be8ffff   call fcn.004014cc\n\n|   |||  0x00402ca1   68b1de4100   push 0x41deb1\n\n|   |||  0x00402ca6   6a00      push 0\n\n|   |||  0x00402ca8   686b050000   push 0x56b         ; 1387\n\n|   |||  0x00402cad   e81ae8ffff   call fcn.004014cc\n\n|   |||  0x00402cb2   6871de4100   push 0x41de71\n\n|   |||  0x00402cb7   e832e9ffff   call fcn.004015ee\n\n|   |||  0x00402cbc   0bc0      or eax, eax\n\n| ,====< 0x00402cbe   7551      jne 0x402d11\n\n|  ||||  0x00402cc0   6860424000   push 0x404260        ; '`B@'\n\n|  ||||  0x00402cc5   6a00      push 0\n\n|  ||||  0x00402cc7   6800880000   push 0x8800\n\n|  ||||  0x00402ccc   6870524100   push 0x415270        ; 'pRA' ;\n\"MZ\\x90\"\n\n|  ||||  0x00402cd1   68b1de4100   push 0x41deb1\n\n|  ||||  0x00402cd6   e8eafdffff   call fcn.00402ac5\n\n|  ||||  0x00402cdb   6800880000   push 0x8800\n\n|  ||||  0x00402ce0   6870524100   push 0x415270        ; 'pRA' ;\n\"MZ\\x90\"\n\n|  ||||  0x00402ce5   e848fdffff   call fcn.00402a32\n\n|  ||||  0x00402cea   6a01      push 1           ; 1\n\n```\n\n-----\n\n```\n|  ||||  0x00402cec   6870da4100   push 0x41da70\n\n|  ||||  0x00402cf1   e82de5ffff   call fcn.00401223\n\n|  ||||  0x00402cf6   e893fdffff   call fcn.00402a8e\n\n|  ||||  0x00402cfb   6888130000   push 0x1388\n\n|  ||||  0x00402d00   e89d000000   call sub.KERNEL32.DLL_Sleep\n\n|  ||||  0x00402d05   6a01      push 1           ; 1\n\n|  ||||  0x00402d07   6860424000   push 0x404260        ; '`B@'\n\n|  ||||  0x00402d0c   e8c5feffff   call fcn.00402bd6\n\n|  ||||  ; CODE XREFS from entry0 @ 0x402c2b, 0x402c52, 0x402c8a, 0x402cbe\n\n|  ````-> 0x00402d11   6a00      push 0\n\n\\      0x00402d13   e818000000   call sub.KERNEL32.DLL_ExitProcess\n\n[0x00402c23]>\n\n## If we look at the imports, we see that same thing, we can also guess an infection / replication on the machine or network.\n\n```\n\n-----\n\n```\n[0x00402c23]> ii\n\n[Imports]\n\nnth vaddr   bind type lib     name\n\n-----------------------------------------\n1  0x0040301c NONE FUNC KERNEL32.DLL FindFirstFileA\n\n2  0x00403020 NONE FUNC KERNEL32.DLL GetCurrentProcess\n\n3  0x00403024 NONE FUNC KERNEL32.DLL GetCurrentProcessId\n\n4  0x00403028 NONE FUNC KERNEL32.DLL GetCurrentThreadId\n\n5  0x0040302c NONE FUNC KERNEL32.DLL GetModuleFileNameA\n\n6  0x00403030 NONE FUNC KERNEL32.DLL GetModuleHandleA\n\n7  0x00403034 NONE FUNC KERNEL32.DLL GetProcAddress\n\n8  0x00403038 NONE FUNC KERNEL32.DLL GetVolumeInformationA\n\n9  0x0040303c NONE FUNC KERNEL32.DLL GetWindowsDirectoryA\n\n10 0x00403040 NONE FUNC KERNEL32.DLL GlobalAlloc\n\n11 0x00403044 NONE FUNC KERNEL32.DLL MapViewOfFile\n\n12 0x00403048 NONE FUNC KERNEL32.DLL OpenFileMappingA\n\n13 0x0040304c NONE FUNC KERNEL32.DLL OpenMutexA\n\n14 0x00403050 NONE FUNC KERNEL32.DLL OpenThread\n\n15 0x00403054 NONE FUNC KERNEL32.DLL FindClose\n\n16 0x00403058 NONE FUNC KERNEL32.DLL ResumeThread\n\n17 0x0040305c NONE FUNC KERNEL32.DLL Sleep\n\n18 0x00403060 NONE FUNC KERNEL32.DLL SuspendThread\n\n19 0x00403064 NONE FUNC KERNEL32.DLL Thread32First\n\n20 0x00403068 NONE FUNC KERNEL32.DLL Thread32Next\n\n21 0x0040306c NONE FUNC KERNEL32.DLL UnmapViewOfFile\n\n22 0x00403070 NONE FUNC KERNEL32.DLL VirtualAlloc\n\n23 0x00403074 NONE FUNC KERNEL32.DLL VirtualAllocEx\n\n24 0x00403078 NONE FUNC KERNEL32.DLL VirtualFree\n\n25 0x0040307c NONE FUNC KERNEL32.DLL VirtualProtect\n\n26 0x00403080 NONE FUNC KERNEL32.DLL VirtualProtectEx\n\n27 0x00403084 NONE FUNC KERNEL32.DLL WriteProcessMemory\n\n28 0x00403088 NONE FUNC KERNEL32.DLL lstrcpyA\n\n29 0x0040308c NONE FUNC KERNEL32.DLL lstrlenA\n\n30 0x00403090 NONE FUNC KERNEL32.DLL ExpandEnvironmentStringsA\n\n31 0x00403094 NONE FUNC KERNEL32.DLL ExitProcess\n\n32 0x00403098 NONE FUNC KERNEL32.DLL CreateToolhelp32Snapshot\n\n33 0x0040309c NONE FUNC KERNEL32.DLL CreateProcessA\n\n34 0x004030a0 NONE FUNC KERNEL32.DLL CreateFileMappingA\n\n35 0x004030a4 NONE FUNC KERNEL32.DLL ReadProcessMemory\n\n36 0x004030a8 NONE FUNC KERNEL32.DLL CloseHandle\n\n1  0x00403000 NONE FUNC advapi32.dll OpenProcessToken\n\n2  0x00403004 NONE FUNC advapi32.dll LookupPrivilegeValueA\n\n3  0x00403008 NONE FUNC advapi32.dll AdjustTokenPrivileges\n\n4  0x0040300c NONE FUNC advapi32.dll RegOpenKeyA\n\n5  0x00403010 NONE FUNC advapi32.dll RegQueryValueExA\n\n6  0x00403014 NONE FUNC advapi32.dll RegCloseKey\n\n1  0x004030b0 NONE FUNC user32.dll  wsprintfA\n\n\n[0x00402c23]>\n\nizz\n\n```\n\n-----\n\n```\n204 0x00002a21 0x00404021 16 17  .data  ascii  SeDebugPrivilege\n\n205 0x00002a32 0x00404032 45 46  .data  ascii  %ProgramFiles%\\Internet\nExplorer\\iexplore.exe\n\n206 0x00002a60 0x00404060 64 65  .data  ascii \nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\IEXPLORE.EXE\n\n207 0x00002aa1 0x004040a1 23 24  .data  ascii  http\\shell\\open\\command\n\n## And the strings located inside point to interesting places.\n\n Conclusions\n\n So at this time I think we can confidentely say that we unpacked the malware, now we have three let’s say “modules” we can independently analyse, to see if they unpack anything else, to check their functionalities and see if they interact and how.\n\n The report on anyrun related to this malware, offers an intersting process diagram, that correctly corresponds to our findings!\n\n Tackling the problem on Windows 10\n\n If you tried to replicate this analysis but decided to use Windows 10 instad of Windows 7 you’ll probably come up with some errors leading to not being able to unpack the last stage or actually execute the program.\n\n So, to summ it up. This malware is not modern (it uses upx!!) it was developed and spread in a time where Win7 was the latest, so it is prepared for it. An important detail related to this, we see at least in the second binary is that at some point it allocates space, and write some random data that looks like shellcode into it. Well it is actually shellcode, and the execution flow of the program gets transfered there at some point…\n\n And if we dump it and manually reverse it, we’ll se plenty of references to “hardcoded” stuff, some calls that are not even present in Windows10, so thats the problem.\n\n```\n\n-----\n\n```\n[0x00000000]> pd 120\n\n      0x00000000   55       push rbp\n\n      0x00000001   8bec      mov ebp, esp\n\n      0x00000003   81c448f4ffff  add esp, 0xfffff448\n\n      0x00000009   53       push rbx\n\n      0x0000000a   e8e3060000   call 0x6f2\n\n      0x0000000f   8b45fc     mov eax, dword [rbp - 4]\n\n      0x00000012   8945c8     mov dword [rbp - 0x38], eax\n\n      0x00000015   64a118000000. movabs eax, dword fs:[0x8b30408b00000018]\n\n      0x0000001f   4054      push rsp\n\n      0x00000021   89854cf6ffff  mov dword [rbp - 0x9b4], eax\n\n      0x00000027   6a04      push 4\n\n      0x00000029   8d4004     lea eax, [rax + 4]\n\n      0x0000002c   50       push rax\n\n      0x0000002d   8d8548f4ffff  lea eax, [rbp - 0xbb8]\n\n      0x00000033   50       push rax\n\n      0x00000034   68c3c1be36   push 0x36bec1c3\n\n      0x00000039   e80d080000   call 0x84b\n\n      0x0000003e   68a1f43c75   push 0x753cf4a1\n\n      0x00000043   50       push rax\n\n      0x00000044   e85f080000   call 0x8a8\n\n      0x00000049   ffd0      call rax\n\n      0x0000004b   8b8548f4ffff  mov eax, dword [rbp - 0xbb8]\n\n      0x00000051   0bc0      or eax, eax\n\n   ,=< 0x00000053   750b      jne 0x60\n\n    |  0x00000055   8b854cf6ffff  mov eax, dword [rbp - 0x9b4]\n\n    |  0x0000005b   8b4038     mov eax, dword [rax + 0x38]\n\n   ,==< 0x0000005e   eb03      jmp 0x63\n\n    |`-> 0x00000060   8b4004     mov eax, dword [rax + 4]\n\n    `--> 0x00000063   8b4004     mov eax, dword [rax + 4]\n\n      0x00000066   0d20002000   or eax, 0x200020\n\n      0x0000006b   3d7c007700   cmp eax, 0x77007c\n\n   ,=< 0x00000070   7403      je 0x75\n\n    |  0x00000072   5b       pop rbx\n\n    |  0x00000073   c9       leave\n\n    |  0x00000074   c3       ret\n\n    `-> 0x00000075   c685a4fdffff. mov byte [rbp - 0x25c], 0x41 ; 'A'\n\n      0x0000007c   c685a5fdffff. mov byte [rbp - 0x25b], 0x44 ; 'D'\n\n      0x00000083   c685a6fdffff. mov byte [rbp - 0x25a], 0x56 ; 'V'\n\n      0x0000008a   c685a7fdffff. mov byte [rbp - 0x259], 0x41 ; 'A'\n\n      0x00000091   c685a8fdffff. mov byte [rbp - 0x258], 0x50 ; 'P'\n\n      0x00000098   c685a9fdffff. mov byte [rbp - 0x257], 0x49 ; 'I'\n\n      0x0000009f   c685aafdffff. mov byte [rbp - 0x256], 0x33 ; '3'\n\n      0x000000a6   c685abfdffff. mov byte [rbp - 0x255], 0x32 ; '2'\n\n      0x000000ad   c685acfdffff. mov byte [rbp - 0x254], 0x2e ; '.'\n\n      0x000000b4   c685adfdffff. mov byte [rbp - 0x253], 0x44 ; 'D'\n\n      0x000000bb   c685aefdffff. mov byte [rbp - 0x252], 0x4c ; 'L'\n\n      0x000000c2   c685affdffff. mov byte [rbp - 0x251], 0x4c ; 'L'\n\n      0x000000c9   c685b0fdffff. mov byte [rbp - 0x250], 0\n\n      0x000000d0   8d85a4fdffff  lea eax, [rbp - 0x25c]\n\n      0x000000d6   50       push rax\n\n      0x000000d7   e83c080000   call 0x918\n\n```\n\n-----\n\n```\n      0x000000dc   c68554f6ffff. mov byte [rbp 0x9ac], 0x53 ; S\n\n      0x000000e3   c68555f6ffff. mov byte [rbp - 0x9ab], 0x4f ; 'O'\n\n      0x000000ea   c68556f6ffff. mov byte [rbp - 0x9aa], 0x46 ; 'F'\n\n      0x000000f1   c68557f6ffff. mov byte [rbp - 0x9a9], 0x54 ; 'T'\n\n      0x000000f8   c68558f6ffff. mov byte [rbp - 0x9a8], 0x57 ; 'W'\n\n      0x000000ff   c68559f6ffff. mov byte [rbp - 0x9a7], 0x41 ; 'A'\n\n      0x00000106   c6855af6ffff. mov byte [rbp - 0x9a6], 0x52 ; 'R'\n\n      0x0000010d   c6855bf6ffff. mov byte [rbp - 0x9a5], 0x45 ; 'E'\n\n      0x00000114   c6855cf6ffff. mov byte [rbp - 0x9a4], 0x5c ; '\\\\'\n\n      0x0000011b   c6855df6ffff. mov byte [rbp - 0x9a3], 0x4d ; 'M'\n\n      0x00000122   c6855ef6ffff. mov byte [rbp - 0x9a2], 0x69 ; 'i'\n\n      0x00000129   c6855ff6ffff. mov byte [rbp - 0x9a1], 0x63 ; 'c'\n\n      0x00000130   c68560f6ffff. mov byte [rbp - 0x9a0], 0x72 ; 'r'\n\n      0x00000137   c68561f6ffff. mov byte [rbp - 0x99f], 0x6f ; 'o'\n\n      0x0000013e   c68562f6ffff. mov byte [rbp - 0x99e], 0x73 ; 's'\n\n      0x00000145   c68563f6ffff. mov byte [rbp - 0x99d], 0x6f ; 'o'\n\n      0x0000014c   c68564f6ffff. mov byte [rbp - 0x99c], 0x66 ; 'f'\n\n      0x00000153   c68565f6ffff. mov byte [rbp - 0x99b], 0x74 ; 't'\n\n      0x0000015a   c68566f6ffff. mov byte [rbp - 0x99a], 0x5c ; '\\\\'\n\n      0x00000161   c68567f6ffff. mov byte [rbp - 0x999], 0x57 ; 'W'\n\n      0x00000168   c68568f6ffff. mov byte [rbp - 0x998], 0x69 ; 'i'\n\n      0x0000016f   c68569f6ffff. mov byte [rbp - 0x997], 0x6e ; 'n'\n\n      0x00000176   c6856af6ffff. mov byte [rbp - 0x996], 0x64 ; 'd'\n\n      0x0000017d   c6856bf6ffff. mov byte [rbp - 0x995], 0x6f ; 'o'\n\n      0x00000184   c6856cf6ffff. mov byte [rbp - 0x994], 0x77 ; 'w'\n\n      0x0000018b   c6856df6ffff. mov byte [rbp - 0x993], 0x73 ; 's'\n\n      0x00000192   c6856ef6ffff. mov byte [rbp - 0x992], 0x20 ;\n\"T\\x89\\x85L\\xf6\\xff\\xffj\\x04\\x8d@\\x04P\\x8d\\x85H\\xf4\\xff\\xffPh\\xc3\\u007e6\\xe8\\r\\b\"\n\n      0x00000199   c6856ff6ffff. mov byte [rbp - 0x991], 0x4e ; 'N'\n\n      0x000001a0   c68570f6ffff. mov byte [rbp - 0x990], 0x54 ; 'T'\n\n      0x000001a7   c68571f6ffff. mov byte [rbp - 0x98f], 0x5c ; '\\\\'\n\n      0x000001ae   c68572f6ffff. mov byte [rbp - 0x98e], 0x43 ; 'C'\n\n      0x000001b5   c68573f6ffff. mov byte [rbp - 0x98d], 0x75 ; 'u'\n\n      0x000001bc   c68574f6ffff. mov byte [rbp - 0x98c], 0x72 ; 'r'\n\n      0x000001c3   c68575f6ffff. mov byte [rbp - 0x98b], 0x72 ; 'r'\n\n      0x000001ca   c68576f6ffff. mov byte [rbp - 0x98a], 0x65 ; 'e'\n\n      0x000001d1   c68577f6ffff. mov byte [rbp - 0x989], 0x6e ; 'n'\n\n      0x000001d8   c68578f6ffff. mov byte [rbp - 0x988], 0x74 ; 't'\n\n      0x000001df   c68579f6ffff. mov byte [rbp - 0x987], 0x56 ; 'V'\n\n      0x000001e6   c6857af6ffff. mov byte [rbp - 0x986], 0x65 ; 'e'\n\n      0x000001ed   c6857bf6ffff. mov byte [rbp - 0x985], 0x72 ; 'r'\n\n      0x000001f4   c6857cf6ffff. mov byte [rbp - 0x984], 0x73 ; 's'\n\n      0x000001fb   c6857df6ffff. mov byte [rbp - 0x983], 0x69 ; 'i'\n\n      0x00000202   c6857ef6ffff. mov byte [rbp - 0x982], 0x6f ; 'o'\n\n      0x00000209   c6857ff6ffff. mov byte [rbp - 0x981], 0x6e ; 'n'\n\n      0x00000210   c68580f6ffff. mov byte [rbp - 0x980], 0x5c ; '\\\\'\n\n      0x00000217   c68581f6ffff. mov byte [rbp - 0x97f], 0x57 ; 'W'\n\n      0x0000021e   c68582f6ffff. mov byte [rbp - 0x97e], 0x69 ; 'i'\n\n      0x00000225   c68583f6ffff. mov byte [rbp - 0x97d], 0x6e ; 'n'\n\n      0x0000022c   c68584f6ffff. mov byte [rbp - 0x97c], 0x6c ; 'l'\n\n      0x00000233   c68585f6ffff. mov byte [rbp - 0x97b], 0x6f ; 'o'\n\n      0x0000023a   c68586f6ffff. mov byte [rbp - 0x97a], 0x67 ; 'g'\n\n```\n\n-----\n\n```\n      0x00000241   c68587f6ffff. mov byte [rbp 0x979], 0x6f ; o\n\n      0x00000248   c68588f6ffff. mov byte [rbp - 0x978], 0x6e ; 'n'\n\n      0x0000024f   c68589f6ffff. mov byte [rbp - 0x977], 0x5c ; '\\\\'\n\n      0x00000256   c6858af6ffff. mov byte [rbp - 0x976], 0\n\n      0x0000025d   8d8550f6ffff  lea eax, [rbp - 0x9b0]\n\n      0x00000263   50       push rax\n\n      0x00000264   8d8554f6ffff  lea eax, [rbp - 0x9ac]\n\n      0x0000026a   50       push rax\n\n## So my advice in here would be to try to adjust the OS version to the Malware as much as possible, to avoid losing precious time in the analysis.\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-12 - Malware analysis with IDA-Radare2 - Multiple unpacking (Ramnit worm).pdf"
    ],
    "report_names": [
        "2022-07-12 - Malware analysis with IDA-Radare2 - Multiple unpacking (Ramnit worm).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536187,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1658168791,
    "ts_modification_date": 1658168791,
    "files": {
        "pdf": "https://archive.orkl.eu/daec7edfdb0a641a4f785d4acacd94ec318a55e8.pdf",
        "text": "https://archive.orkl.eu/daec7edfdb0a641a4f785d4acacd94ec318a55e8.txt",
        "img": "https://archive.orkl.eu/daec7edfdb0a641a4f785d4acacd94ec318a55e8.jpg"
    }
}