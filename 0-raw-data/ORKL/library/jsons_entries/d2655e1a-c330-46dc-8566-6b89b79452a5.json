{
    "id": "d2655e1a-c330-46dc-8566-6b89b79452a5",
    "created_at": "2023-01-12T15:08:33.570925Z",
    "updated_at": "2025-03-27T02:06:06.387223Z",
    "deleted_at": null,
    "sha1_hash": "2bc0faa16718b4b920d49bbaeff5588043772994",
    "title": "2019-04-25 - JasperLoader Emerges, Targets Italy with Gootkit Banking Trojan",
    "authors": "",
    "file_creation_date": "2022-05-27T21:31:43Z",
    "file_modification_date": "2022-05-27T21:31:43Z",
    "file_size": 5261680,
    "plain_text": "# JasperLoader Emerges, Targets Italy with Gootkit Banking Trojan\n\n**[blog.talosintelligence.com/2019/04/jasperloader-targets-italy.html](https://blog.talosintelligence.com/2019/04/jasperloader-targets-italy.html)**\n\n## Introduction to JasperLoader\n\nMalware loaders are playing an increasingly important role in malware distribution. They give\n\n\n-----\n\nadversaries the ability to gain an initial foothold on a system and are typically used to deliver\nvarious malware payloads following successful compromise. These attacks are popping up\n[more frequently, as we covered in July with Smoke Loader and](https://blog.talosintelligence.com/2018/07/smoking-guns-smoke-loader-learned-new.html) [Brushaloader earlier this](https://blog.talosintelligence.com/2019/02/combing-through-brushaloader.html)\nyear. Loaders allow attackers to decide which malware to drop based on how they feel they\ncan best monetize the access they gained. While malware loaders are commonly seen with\nemail-based threats, they have also been prevalent within the exploit kit landscape for years.\nRecently, Cisco Talos observed an increase in loader activity being used to deliver various\nmalware to systems located in various European countries.\n\nSpecifically, we're tracking a loader known as \"JasperLoader,\" which has been increasingly\nactive over the past few months and is currently being distributed via malicious spam\ncampaigns primarily targeting central European countries with a particular focus on Germany\nand Italy. JasperLoader employs a multi-stage infection process that features several\nobfuscation techniques that make analysis more difficult. It appears that this loader was\ndesigned with resiliency and flexibility in mind, as evidenced in later stages of the infection\nprocess.\n\nOver the past several months, we've seen several spam campaigns with signed emails\nattempting to infect victims with JasperLoader and ultimately the Gootkit banking trojan.\nMessage signing makes use of certificates' verification to confirm the authenticity of the\nperson sending the email, as only those with access to the private keys should be able to\nsign the message. Message signing is not the same as message encryption and is used only\nto validate the identity of the message sender not to guarantee the confidentiality of the\nmessage itself. Talos has identified several malicious campaigns making use of this type of\nmessage signing as a way to lend credibility to their messages and maximize the likelihood\nthat potential victims will open the malicious attachments.\n\n## Malicious spam campaigns\n\nAs with many email-based threats, Talos observed multiple distinct campaigns being\nleveraged to distribute JasperLoader. Each campaign featured various email templates and\ndownloader configurations. Each campaign was also relatively localized and featured\nmultiple languages specific to each of the countries that were being targeted. Most of the\ncampaign activity targeted European countries with a specific focus on Italy. However, we\nhave identified campaigns targeting countries outside of Europe. Below is an example of an\nemail associated with one of the campaigns targeting Germany.\n\n\n-----\n\n_Figure 1: Example email (German)_\n\nThe email is fairly basic and includes an attached ZIP archive. The subject line\n\"Zahlungserinnerung\" roughly translates to \"Payment Reminder,\" which is a theme consistent\nwith many of the malspam campaigns commonly observed in the wild. This particular\ncampaign leveraged a Visual Basic for Applications (VBS) script that was responsible for\ninitiating the JasperLoader infection process. We'll dive into the obfuscated script later. The\ncampaigns targeting Germany were some of the only ones that were observed using VBS\nfiles to initiate the JasperLoader infection. Most of the attacks generally used DOCM files to\ndownload JasperLoader, and ultimately Gootkit.\n\nAs previously mentioned, most of the JasperLoader campaign activity that has been\nobserved over the past few months has been targeting Italy. As can be seen in the\nscreenshot below, these emails are significantly different than those seen in the other\ncampaigns. Rather than containing a malicious file attachment, these emails purport that\nthey are notifications associated with the receipt of a \"certified email\" and contain an\nattached EML file.\n\nThe threat actors distributing JasperLoader are leveraging a legitimate certified email service\n[called Posta Elettronica Certificata (PEC) to distribute these emails. This is a certified email](https://www.pec.it/)\nservice related to legislation recently passed in Italy involving new requirements associated\n[with electronic invoicing that took effect at the beginning of 2019. This new legislation](https://www.tmf-group.com/en/news-insights/articles/2018/july/italy-mandatory-einvoicing/)\nrequires Italian businesses to use electronic invoicing to deliver invoices for both business-tobusiness (B2B) and business-to-consumer (B2C) transactions. Attackers have recognized\nthat this is an attractive way to leverage an already trusted email service to maximize the\nlikelihood that they can convince potential victims to open their malicious emails.\n\n\n-----\n\n_Figure 2: Example \"Certified\" email_\n\nOne of the requirements associated with this new legislation is that all electronic invoicing\nemails must be signed and sent using a new platform called \"Sistema di Interscambio (SDI).\"\nAdditionally, invoices should be sent using a specific XML-based format for consumption and\nthat format should be verified and its validity confirmed before being transmitted to the\nrecipient of the invoice.\n\nAs you can see, this particular campaign is leveraging this service, which allows them to\ntransmit messages that meet the requirements associated with this new legislation and\nabuse the trust between potential victims and the certified email service.\n\n\n-----\n\n_Figure 3: Certificate details_\n\nThe certificate itself is valid and associated with the PEC certified email service that was\ndescribed above. Using the PEC certified email service, organizations are allowed to send\nattachments of up to 30MB to recipients. Posta Elettronica Certificata (PEC) is currently\nbeing widely used in Italy, Switzerland and Hong Kong and allows people to send registered\nemail messages. The idea behind this project is to allow anyone — whether living in the\ncountry or not — to communicate through official channels, while allowing for the verification\nof the authenticity of the message sender. This service enables the communication of official\nbusiness-related information without relying on physical mail services, facilitating faster realtime communications.\n\n_Figure 4: Certificate properties_\n\n\n-----\n\nThe campaigns observed to be leveraging the PEC service contained emails that claim to be\nnotifications of the receipt of a \"certified email message\" and featured EML attachments. The\nscreenshot below shows what one of these EML attachments looks like when opened by\npotential victims.\n\n_Figure 5: Attached email message_\n\nAs can be seen above, the attached EML files contain attached ZIP archives that hold\nMicrosoft Word DOCM files that reference the same invoice as the emails to which they were\nattached. The DOCM files contain malicious embedded VBA macros that initiate the\nJasperLoader infection process. The metadata associated with the DOCM files used across\nmany of the campaigns have been observed containing the string value \"VPS2day\" in\nseveral of the metadata fields.\n\n_Figure 6: ZIP attachment contents_\n\n\n-----\n\n_Figure 7: Document properties_\n\nTalos identified multiple unique malicious DOCM files associated with JasperLoader\ncampaigns taking place over the course of several weeks. An example search for files with\n[metadata containing the string \"VPS2day\" resulted in 167 unique files in VirusTotal.](https://www.virustotal.com/)\n\n_Figure 8: Metadata search results_\n\nIn addition to the campaigns using malicious DOCM files to distribute JasperLoader, we also\nobserved messages containing malicious JS downloaders. There were also some campaigns\nthat featured legitimate and malicious file attachments. For example, some of the observed\ncampaigns included ZIP files containing JS and XML files and benign PDF invoices. In\nseveral of the campaigns, some of the files were improperly named. For example, the XML\nfiles were .XM instead of .XML and the PDF invoices were .PF instead of .PDF.\n\n\n-----\n\nSubtle changes like this can be surprisingly effective when attempting to convince potential\nvictims to open file attachments. Talos also observed campaigns that leveraged PDF\nattachments that contained no file extension whatsoever. Investigating the PEC certified\nemail service, we identified that this service is being widely abused by threat actors for a\nvariety of malicious purposes dating back to the beginning of 2019 when the legislative\nrequirements took effect.\n\n[One other interesting aspect of this campaign was its utilization of Domain Shadowing, a](https://blogs.cisco.com/security/talos/angler-domain-shadowing)\ntechnique Cisco Talos discovered, which was pioneered by exploit kit users back in 2015.\nThis technique allows the adversary to host malicious content on subdomains associated\nwith legitimate domains. This is typically achieved through abuse of the registrant account,\nallowing for the creation of subdomains pointing to adversary-owned infrastructure.\n\n## JasperLoader details\n\nMicrosoft Word documents were attached to several of these malicious emails. When\nopened, these documents displayed this decoy image:\n\n_Figure 9: Example of a malicious Word document_\n\nThe message displayed in the image is in Italian, and translates to:\n\n\n-----\n\n_This file was created with a prior Microsoft Office 365 version. To view the contents you need_\n_to click on the \"Enable modifications\" button, located on the yellow bar at the top, and then_\n_click on \"Enable content.\"_\n\n### JasperLoader Stage 1\n\nThe Microsoft Word documents contain malicious macros that execute JasperLoader and\n[start the infection process. Using the Python oletools package, we can further analyze the](https://github.com/decalage2/oletools/)\nmacro execution and determine how the infection process takes place.\n\n_Figure 10: Analysis results using oletools_\n\nAs displayed in the screenshot above, oletools detects the presence of the VBA macros\nembedded within the Word document. The macro is configured to execute when the Word\ndocument is opened and is responsible for executing the commands to initiate the infection.\nThe presence of \"Chr\" within the VBA macros may indicate that the macros have been\nobfuscated, which we will walk through to provide an example of the process analysts can\ntake to analyze these types of malware loaders.\n\nIn addition to the use of Microsoft Word documents, Talos also observed the use of ZIP\narchives that directly contain VBS downloaders. The infection process is the same in both\ncases. While the obfuscation differs slightly between the two types of campaigns, the\napproach is very similar. We will walk through the infection process using the VBS with the\nfollowing hash (SHA256):\ndc78dbd42216fdb64c1e40c6f7a2fad92921f70c40446d62eb1873d6b77ee04c.\n\nAs previously reported by oletools, the macros have been obfuscated to make static analysis\nmore difficult. The macros define a variable and then an array containing a large number of\nelements.\n\n\n-----\n\n_Figure 11: Obfuscated VBScript array_\n\nAt the end of the script, the following code is responsible for performing a mathematical\noperation on all of the numbers in the array, reconstructing it into code that can be executed,\nand then executing it to continue the infection process:\n\n_Figure 12: VBScript array reconstruction_\n\nThe value assigned to the variable d1 is 267. To identify what is actually going to be\nexecuted, we can subtract 267 from each of the numbers present in the array and convert\nthe resulting value into the corresponding VBScript character using a conversion table similar\n[to the one available here.](https://www.vbsedit.com/html/c60e2712-20e6-40f2-8fe2-cfb74ca6bca1.asp)\n\nOnce we have replaced the array values with the correct VBScript character value, we can\nsee that the VBScript is responsible for executing PowerShell commands. However, there\nare still a lot of artifacts from the VBScript obfuscation present, which makes additional\nanalysis difficult. Talos has observed that the value used for the subtraction changes\nfrequently across samples, but that the logic remains the same.\n\n_Figure 13: Converted VBScript character values_\n\n\n-----\n\nThe next step is to remove all of the unnecessary characters that were part of the VBScript\nobfuscation to recreate the VBScript, as well as the PowerShell associated with this stage of\nthe infection. Once we have removed these extra characters, we are left with the following\npartially obfuscated code:\n\n_Figure 14: Partially obfuscated script_\n\nSeveral string values have been inserted into the PowerShell that the VBScript will execute\nin order to avoid string-based detection and make much of the PowerShell unreadable. A\ncloser look at the portion of the PowerShell instructions that haven't been obfuscated show\nthat during the execution process, -replace will be used to remove these extra string values\nto allow for the reconstruction of the obfuscated Powershell. Examples of this operation can\nbe seen in the below syntax:\n```\n-replace '6ayBRVW',\"\";\n-replace 'uVRWRut',\"\";\n-replace '6xzQCRv',\"\";\n\n```\nThis code instructs the system to replace these three string values throughout the script with\nnothing, effectively removing them and allowing the Powershell code to properly execute.\nManually removing all references to these three strings results in the following:\n\n_Figure 15: Deobfuscated Stage 1 Powershell_\n\nThis script performs the following operations:\n\nCalls WScript and uses it to execute PowerShell.\n\n[PowerShell is used to invoke the Get-UICulture cmdlet to identify the language set](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-uiculture?view%3Dpowershell-6)\nused on the system.\n\n\n-----\n\nIf the language set is associated with one of the following countries, the infection\nprocess terminates:\n\nRussia\nUkraine\nBelarus\nThe People's Republic of China\n\nDownloads additional data from the following URLs:\n\nhxxp://cdn[.]zaczvk[.]pl/loadercrypt_823EF8A810513A4071485C36DDAD4CC3.php?\nvid=\n\nhxxps://www[.]telekom[.]de/resources/images/130468/eSS-illustrations-V006MeineErsteRechnung-FN-SG.png\n\nhxxp://cloud[.]diminishedvaluecalifornia[.]com/501?dwgvhgc\n\nThe data downloaded from the aforementioned URLs is saved to the following file\nlocation, respectively:\n\n%TEMP%\\SearchIE32.js\n%TEMP%\\illustrations5543.png\n%TEMP%\\AdobeAR.exe\n\nExecutes the downloaded files, continuing the infection process.\n\nThe infection process then continues with the execution of the contents that were retrieved\nfrom the attacker's distribution servers.\n\n### JasperLoader Stage 2\n\nAs previously mentioned, the PowerShell executed in Stage 1 is responsible for reaching out\nto three distinct URLs used to retrieve and execute content on infected systems. The first\nURL that is defined is: hxxp://cloud[.]diminishedvaluecalifornia[.]com/501?dwgvhgc.\n\nThe malware loader initiates an HTTP GET request for contents hosted at the\naforementioned URL and returns a numerical value from the attacker-controlled server. Note\nthat the code is present within the Content Body of the HTTP Server Response:\n\n\n-----\n\n_Figure 16: Example HTTP GET request_\n\nAs defined by the Powershell instructions in Stage 1, the returned content is then saved to\n%TEMP%\\AdobeAR.exe.\n\nIn addition to the value \"500\" that is returned to the client, Talos has also observed additional\ncodes being returned such as \"404,\" \"408,\" etc. In all of the cases Talos observed, the HTTP\nResponse Code remains 200 OK, but the code present in the Content Body varies.\n\nThe malware loader also reaches out to the attacker's server at\nhxxp://cdn[.]zaczvk[.]pl/loadercrypt_823EF8A810513A4071485C36DDAD4CC3.php?vid=.\n\nFollowing an HTTP GET request by the malware loader, the malicious server responds by\nsending back an HTTP response that contains obfuscated JavaScript:\n\n\n-----\n\n_Figure 17: Stage 2 obfuscated JavaScript_\n\nAs defined in Stage 1, the contents of the returned JavaScript are saved to the\n%TEMP%\\SearchIE32.js and executed. The contents have been obfuscated to make\nanalysis more difficult. Similar to what was seen with the VBScript obfuscation in the previous\nstage of the infection, the code defines an array, and then uses push() to create the string of\nobfuscated data. JavaScript code at the end of the returned content is responsible for\nreassembling, deobfuscating, and then using eval() to execute the JavaScript.\n\n_Figure 18: JavaScript execution functionality_\n\nThe good news with JavaScript obfuscation is that, typically, the code deobfuscates itself\nprior to execution. Rather than attempt to manually deobfuscate the JavaScript, we can rely\non this behavior to have the code deobfuscate itself automatically. In order to more efficiently\n[deobfuscate and analyze the malicious JavaScript, we can use an analysis tool like Malzilla.](http://malzilla.sourceforge.net/)\n\n\n-----\n\n_Figure 19: Malzilla decoder tab_\n\nMalzilla will deobfuscate the JavaScript and display it in the lower pane. In the case of\nJasperLoader, this results in another script containing a partially obfuscated set of\nPowerShell instructions that defines how the malware will continue the infection process.\n\n_Figure 20: Malzilla output_\n\nThe returned script is partially obfuscated using the same method we encountered\npreviously. As we saw before, we simply need to remove the junk strings included throughout\nthe script to fully deobfuscate it. Once those strings are removed, we are left with a script that\nlooks similar to what we saw earlier, with a few changes included:\n\n\n-----\n\n_Figure 21: Stage 2 PowerShell deobfuscated_\n\nThis script is responsible for performing the retrieval of the commands associated with the\nnext stage of the infection process. It performs the following actions:\n\nCalls WScript and uses it to execute PowerShell.\n\n[PowerShell is used to invoke the Get-UICulture cmdlet to identify the language set](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-uiculture?view%3Dpowershell-6)\nused on the system.\n\nIf the language set is associated with one of the following countries, the infection\nprocess terminates:\n\nRussia\nUkraine\nBelarus\nThe People's Republic of China\n\nDownloads additional data from:\nhxxp://cdn[.]zaczvk[.]pl/crypt0DD1D2637FDB71097213D70B94E86930.php\n\nSaves the downloaded contents to %TEMP%\\SearchIE32.txt\n\nReads the contents of the downloaded file and performs a Regex based\nreplacement to deobfuscate it.\n\nExecutes the deobfuscated code to continue the infection process.\n\nIn addition to retrieving the data required to continue the infection process, the script also\nimplements a Sleep cmdlet for 180 seconds then attempts to retrieve the latest obfuscated\nJavaScript that is hosted at the same URL that was referenced in Stage 1.\n\n_Figure 22: Stage 2 — JavaScript retrieval_\n\n\n-----\n\nThis JavaScript is then executed again. This is a mechanism that can be used to ensure that\nas the attackers modify the infection process, they can ensure that any previously infected\nsystems automatically retrieve the modifications and are updated accordingly. This\ndemonstrates an approach that ensures that this loader can be used repeatedly, potentially\nto deliver different malware payloads over time.\n\nAs previously mentioned, the malware makes an HTTP GET request to the following URL to\nobtain additional instructions from the attacker-controlled server:\nhxxp://cdn[.]zaczvk[.]pl/loadercrypt_823EF8A810513A4071485C36DDAD4CC3.php.\n\n_Figure 23: Stage 3 retrieval_\n\nThe obfuscated data that is returned by the server is then saved to\n%TEMP%\\SearchIE32.txt. The script then reads back the contents of this file and performs a\nregex replacement operation to deobfuscate it so that it can be executed:\n\n_Figure 24: Stage 3 deobfuscation instructions_\n\nIn order to further analyze the infection process, we need to deobfuscate the contents that\nwere retrieved by the PowerShell. One way is to manually perform the same operation as the\nPowerShell.\n\nIn the previous screenshot, the following line of PowerShell is responsible for deobfuscating\nthe code that was previously retrieved and adding it to the end of a variable assignment,\nwhich is later executed:\n\n\n-----\n\n_Figure 25: Stage 3 deobfuscation regex_\n\nAs the SearchIE32.txt file is read back in, the -replace statement is responsible for removing\ntwo of every three characters from the file to deobfuscate and reconstruct the PowerShell\ncommands to be executed. The operation looks like this:\n\nThe obfuscated code contains a lot of junk code:\n```\n0zig7fs9(y4 7b(i6G7aet5tvf-giUdtIacC4zuxelactd7u6wr53ehy)26.izNejahgm71ewf ga99mefau6twyctvhu6 6w'cxRf7Ua5|5aUuzAxi|4uBv6Yez|7eCd7N13'v3)66{v4 81eigxjyitct83;3e\nz4}e0\n\n```\nFor every three characters present in the obfuscated code, the first two characters are\nremoved and the remaining character is added to the end of the variable\n$jwihbyjzvhwwziwzadiuxat\n\nFor example, the string:\n```\n0zig7fs9(y4 7b(i6G7aet5tvf-giUdtIacC4zuxelactd7u6wr53ehy)26.izNejahgm71ewf ga99mefau6twyctvhu6 6w'cxRf7Ua5|5aUuzAxi|4uBv6Yez|7eCd7N13'v3)66{v4 81eigxjyitct83;3e\nz4}e0\n\n```\nBecomes the PowerShell command:\n```\nif( (Get-UICulture).Name -match 'RU|UA|BY|CN'){ exit; }\n\n```\nIn order to more efficiently deobfuscate the next stage of instructions, we will leverage the\nPowerShell ISE console to unpack the code for us. We can do this by copying the data\nretrieved from the server to our system and modifying the same PowerShell commands\nspecified in the aforementioned script:\n\n_Figure 26: PowerShell ISE Input_\n\nNow that the variable $jwihbyjzvhwwziwzadiuxat contains the deobfuscated code, we can\nsimply retrieve the current value stored in this variable:\n\n_Figure 27: Using PowerShell ISE to retrieve code_\n\n\n-----\n\nThis causes the PowerShell ISE console to provide the deobfuscated commands that will be\nused for the next series of operations. We can now retrieve this information and continue our\nanalysis.\n\n_Figure 28: PowerShell ISE Stage 3 output_\n\n### JasperLoader Stage 3\n\nNow that we have obtained the PowerShell responsible for the next stage of the infection\nprocess, we can begin to observe the main characteristics of the malware loader itself. Below\nis the Powershell code associated with this stage of operations.\n\n_Figure 29: Stage 3 deobfuscated PowerShell_\n\nAs can be seen in the screenshot above, this is where the majority of the activity associated\nwith JasperLoader takes place. The PowerShell present in this stage is responsible for the\noperations described in the following sections.\n\n**Geolocation checks**\n\nThe PowerShell associated with Stage 3 of the JasperLoader infection process performs\nexactly the same geolocational verification that we have observed in all previous stages of\nthe infection. It checks the UICulture of the system and terminates execution if the UICulture\nmatches Russia, Ukraine, Belarus, or People's Republic of China.\n\n\n-----\n\n_Figure 30: Stage 3 geolocation check_\n\n**Achieving persistence**\n\nThe next series of actions are associated with maintaining access to the system. A function\ncalled CreateShortcut() is defined that is responsible for achieving persistence by creating a\nLNK shortcut in the Startup folder of the infected system to ensure that the malware will\nexecute when the system reboots.\n\n_Figure 31: Stage 3 persistence mechanism_\n\n**Bot ID generation**\n\nThe malware also queries the system using WMI and retrieves various pieces of information\nthat are used to generate a unique identifier for the infected system. This information is later\ntransmitted to the C2 server to register the newly infected system and allow for it to be\nuniquely identified. These activities are performed by the CreateID() function that is defined,\nas shown below:\n\n\n-----\n\n_Figure 32: Stage 3 BotID generation_\n\n**Bot registration and command retrieval**\n\nThe infected system then uses an HTTP GET request to beacon out to the command and\ncontrol (C2) server and transmits the unique bot identifier to register the new bot. It also waits\nfor a response from the C2 server to determine how to proceed:\n\n_Figure 33: Stage 3 C2 registration_\n\nAs can be seen in the observed screenshot, the C2 server issues HTTP responses that\ninclude pipe-delimited parameters that provide additional commands to JasperLoader and\ndirect it how to proceed.\n\n\n-----\n\n### Supported commands:\n\nJasperLoader currently has support for three distinct commands that may be received from\nthe C2 server during this operation. They are denoted by the first character that is present in\nthe response received from the C2 server. (Such as the letter \"d\" in the previous screenshot.)\n\n**Update mechanism (\"u\")**\n\nThe \"u\" command may be received from the C2 server and directs JasperLoader to attempt\nto attempt to update itself using the parameters received from the C2 which are handled as\nvalues in an array assigned to the variable $action.\n\n_Figure 34: Stage 3 update mechanism_\n\n**Bot management mechanism (\"m\")**\n\n\n-----\n\nThe \"m\" command provides a mechanism with which the attacker can execute arbitrary\nsystem commands using Powershell on infected systems. The loader waits for a response\nfrom the C2 server that contains pipe-delimited information. It retrieves PowerShell\ncommands from C2 and passes them to the Invoke-Expression (IEX) PowerShell cmdlet so\nthat they can be executed.\n\n_Figure 35: Stage 3 bot management_\n\n**Download mechanism (\"d\")**\n\nThe \"d\" command directs the infected system to retrieve the final malware payload and\nprovides the parameters with which this operation should take place. It informs JasperLoader\nwhere to go to retrieve the final malware payload, where to save it, and where to send status\nupdates following successful deployment of the final payload.\n\n\n-----\n\n_Figure 36: Stage 3 download Function I_\n\n_Figure 37: Stage 3 download Function II_\n\nIt also creates a Windows Defender AV exclusion for the directory in which the PE32 will be\nstored if the system is running PowerShell version 4 or higher.\n\n\n-----\n\n_Figure 38: Stage 3 Windows defender exclusion_\n\nThe system then attempts to retrieve the PE32 file that is the malicious payload in this\nparticular infection. The screenshot below shows the C2 server delivering the malicious\nPE32 file to the infected system.\n\n_Figure 39: Stage 3 payload delivery_\n\nThe status of the successful deployment of the malware payload is then further\ncommunicated to the attacker's server.\n\n_Figure 40: Post-infection status update_\n\nIn this particular case, the malicious payload being delivered by JasperLoader is a widely\ndistributed banking trojan called \"Gootkit.\" This malware mainly looks to steal users'\ninformation and can act as a backdoor to the compromised machine.\n\n## Conclusion\n\nJasperLoader is a malware loader that features a multi-stage infection process. This process\nhas been constructed in a way that makes the loader resilient and provides flexibility to\n\n\n-----\n\nadversaries that are attempting to leverage it to spread malware. While it is currently being\nused to spread the Gootkit banking trojan, it will likely be used to distribute additional\nmalware payloads in the future, as it has been designed in a way that allows the operators of\nthe loader's infrastructure to use it for new payloads in the future as they choose to monetize\ntheir operation in different ways. The choice to abuse certified email services such as PEC\ndemonstrates that as attackers are always looking for new ways to lend credibility to their\nsocial engineering attacks. In this case, abusing a legitimate email service allowed them to\ndeliver their malicious emails in a way that would maximize the likelihood that a potential\nvictim would open the attachments and infect themselves with JasperLoader. In addition to\nthe various threats that we have already observed abusing these services, we expect\nadditional threats to begin leveraging them as well.\n\n## Coverage\n\nAdditional ways our customers can detect and block this threat are listed below.\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nmalware used by these threat actors.\n\n[Cisco Cloud Web Security (CWS) or](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html) [Web Security Appliance (WSA) web scanning prevents](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\naccess to malicious websites and detects malware used in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[Network Security appliances such as Next-Generation Firewall (NGFW), Next-Generation](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Intrusion Prevention System (NGIPS), andMeraki MX can detect malicious activity](https://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html)\nassociated with this threat.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n\n-----\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nAdditional protections with context to your specific environment and threat data are available\nfrom the [Firepower Management Center.](https://www.cisco.com/c/en/us/products/security/firepower-management-center/index.html)\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\n## Indicators of compromise\n\nThe following IOCs are associated with various malware distribution campaigns that were\nobserved during the analysis of JasperLoader activity.\n\n### Attachment hashes (SHA256)\n\nA list of hashes observed to be associated with malicious email attachments can be found\n[here.](https://alln-extcloud-storage.cisco.com/ciscoblogs/5cc1be63b4832.txt)\n\n### Domains\n\n[A list of domains observed to be associated with JasperLoader can be found here.](https://alln-extcloud-storage.cisco.com/ciscoblogs/5cc1bec0c2a0c.txt)\n\n### IP addresses\n\n[A list of IP addresses observed to be associated with JasperLoader can be found here.](https://alln-extcloud-storage.cisco.com/ciscoblogs/5ccaf8c3c182b.txt)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-04-25 - JasperLoader Emerges, Targets Italy with Gootkit Banking Trojan.pdf"
    ],
    "report_names": [
        "2019-04-25 - JasperLoader Emerges, Targets Italy with Gootkit Banking Trojan.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536113,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653687103,
    "ts_modification_date": 1653687103,
    "files": {
        "pdf": "https://archive.orkl.eu/2bc0faa16718b4b920d49bbaeff5588043772994.pdf",
        "text": "https://archive.orkl.eu/2bc0faa16718b4b920d49bbaeff5588043772994.txt",
        "img": "https://archive.orkl.eu/2bc0faa16718b4b920d49bbaeff5588043772994.jpg"
    }
}