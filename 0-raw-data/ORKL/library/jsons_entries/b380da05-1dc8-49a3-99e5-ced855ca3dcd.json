{
    "id": "b380da05-1dc8-49a3-99e5-ced855ca3dcd",
    "created_at": "2023-01-12T15:07:12.942328Z",
    "updated_at": "2025-03-27T02:06:02.065867Z",
    "deleted_at": null,
    "sha1_hash": "8eafccb99977b536410a0e114e9ac810a6b6b806",
    "title": "2020-04-16 - New AgentTesla variant steals WiFi credentials",
    "authors": "",
    "file_creation_date": "2022-05-28T03:32:22Z",
    "file_modification_date": "2022-05-28T03:32:22Z",
    "file_size": 660414,
    "plain_text": "# New AgentTesla variant steals WiFi credentials\n\n**[blog.malwarebytes.com/cybercrime/2020/04/new-agenttesla-variant-steals-wifi-credentials/](https://blog.malwarebytes.com/cybercrime/2020/04/new-agenttesla-variant-steals-wifi-credentials/)**\n\nHossein Jazi April 16, 2020\n\nAgentTesla is a .Net-based infostealer that has the capability to steal data from different\napplications on victim machines, such as browsers, FTP clients, and file downloaders. The\nactor behind this malware is constantly maintaining it by adding new modules. One of the\nnew modules that has been added to this malware is the capability to steal WiFi profiles.\n\nAgentTesla was first seen in 2014, and has been frequently used by cybercriminals in\nvarious malicious campaigns since. During the months of March and April 2020, it was\nactively distributed through spam campaigns in different formats, such as ZIP, CAB, MSI,\nIMG files, and Office documents.\n\n[Newer variants of AgentTesla seen in the wild have the capability to collect information about](https://twitter.com/James_inthe_box/status/1247629934559760384)\na victim’s WiFi profile, possibly to use it as a way to spread onto other machines. In this blog,\nwe review how this new feature works.\n\n## Technical analysis\n\nThe variant we analyzed was written in .Net. It has an executable embedded as an image\nresource, which is extracted and executed at run-time (Figure 1).\n\n\n-----\n\nFigure 1. Extract and execute the payload.\nThis executable (ReZer0V2) also has a resource that is encrypted. After doing several antidebugging, anti-sandboxing, and anti-virtualization checks, the executable decrypts and\ninjects the content of the resource into itself (Figure 2).\n\nFigure 2. Decrypt and execute the payload.\nThe second payload (owEKjMRYkIfjPazjphIDdRoPePVNoulgd) is the main component of\nAgentTesla that steals credentials from browsers, FTP clients, wireless profiles, and more\n(Figure 3). The sample is heavily obfuscated to make the analysis more difficult for\nresearchers.\n\nFigure 3. Second payload\nTo collect wireless profile credentials, a new “netsh” process is created by passing “wlan\nshow profile” as argument (Figure 4). Available WiFi names are then extracted by applying a\nregex: “All User Profile * : (?<profile>.*)”, on the stdout output of the process.\n\n\n-----\n\nFigure 4 Creating netsh process\nIn the next step for each wireless profile, the following command is executed to extract the\nprofile’s credential: “netsh wlan show profile PRPFILENAME key=clear” (Figure 5).\n\nFigure 5. Extract WiFi credentials\n\n## String encryption\n\n[All the strings used by the malware are encrypted and are decrypted by Rijndael symmetric](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rijndael?view=netframework-4.8)\nencryption algorithm in the “<Module>.\\u200E” function. This function receives a number as\nan input and generates three byte arrays containing input to be decrypted, key and IV\n(Figure 6).\n\n\n-----\n\nFigure 6. \\u200E function snippet\nFor example, in Figure 5, “119216” is decrypted into “wlan show profile name=” and “119196”\nis decrypted into “key=clear”.\n\nIn addition to WiFi profiles, the executable collects extensive information about the system,\nincluding FTP clients, browsers, file downloaders, and machine info (username, computer\nname, OS name, CPU architecture, RAM) and adds them to a list (Figure 7).\n\n\n-----\n\nFigure 7. List of collected info\nCollected information forms the body section of a SMTP message in html format (Figure 8):\n\n\n-----\n\nFigure 8 Collected data\n\nin html format in message body\nNote: If the final list has less than three elements, it won’t generate a SMTP message. If\neverything checks out, a message is finally sent via smtp.yandex.com, with SSL enabled\n(Figure 9):\n\nFigure 9. Build Smtp message\n\n\n-----\n\nThe following diagram shows the whole process explained above from extraction of first\npayload from the image resource to exfiltration of the stolen information over SMTP:\n\nFigure 10. Process diagram\n\n## Popular stealer looking to expand\n\nSince AgentTesla added the WiFi-stealing feature, we believe the threat actors may be\nconsidering using WiFi as a mechanism for spread, similar to what was observed with\nEmotet. Another possibility is using the WiFi profile to set the stage for future attacks.\n\nEither way, [Malwarebytes users were already protected from this new variant of AgentTesla](https://www.malwarebytes.com/)\nthrough our real-time protection technology.\n\n\n-----\n\n## Indicators of compromise\n\n**AgentTesla samples:**\n```\n91b711812867b39537a2cd81bb1ab10315ac321a1c68e316bf4fa84badbc09b\ndd4a43b0b8a68db65b00fad99519539e2a05a3892f03b869d58ee15fdf5aa044\n27939b70928b285655c863fa26efded96bface9db46f35ba39d2a1295424c07b\n\n```\n**First payload:**\n```\n249a503263717051d62a6d65a5040cf408517dd22f9021e5f8978a819b18063b\n\n```\n**Second payload:**\n```\n63393b114ebe2e18d888d982c5ee11563a193d9da3083d84a611384bc748b1b0\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-16 - New AgentTesla variant steals WiFi credentials.pdf"
    ],
    "report_names": [
        "2020-04-16 - New AgentTesla variant steals WiFi credentials.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536032,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1653708742,
    "ts_modification_date": 1653708742,
    "files": {
        "pdf": "https://archive.orkl.eu/8eafccb99977b536410a0e114e9ac810a6b6b806.pdf",
        "text": "https://archive.orkl.eu/8eafccb99977b536410a0e114e9ac810a6b6b806.txt",
        "img": "https://archive.orkl.eu/8eafccb99977b536410a0e114e9ac810a6b6b806.jpg"
    }
}