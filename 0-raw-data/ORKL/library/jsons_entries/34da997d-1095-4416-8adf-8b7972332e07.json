{
    "id": "34da997d-1095-4416-8adf-8b7972332e07",
    "created_at": "2023-01-12T15:05:46.997788Z",
    "updated_at": "2025-03-27T02:05:50.207421Z",
    "deleted_at": null,
    "sha1_hash": "67aedf7ef9865b89e2fb48d9a0cdbb3f6470c8d5",
    "title": "2021-04-15 - Mirai code re-use in Gafgyt",
    "authors": "",
    "file_creation_date": "2022-05-28T19:27:49Z",
    "file_modification_date": "2022-05-28T19:27:49Z",
    "file_size": 1399825,
    "plain_text": "# Mirai code re-use in Gafgyt\n\n**uptycs.com/blog/mirai-code-re-use-in-gafgyt**\n\n[Research by Siddharth Sharma](https://www.uptycs.com/blog/author/siddharth-sharma)\n\nUptycs' threat research team recently detected several variants of the Linux-based botnet\nmalware family, “Gafgyt”, via threat intelligence systems and our in-house osquery-based\nsandbox. Upon analysis, we identified several codes, techniques and implementations of\n[Gafgyt, re-used from the infamous Mirai botnet.](https://github.com/jgamblin/Mirai-Source-Code)\n\nIn this blog, we’ll take a look at some of the re-used Mirai modules, their functionality, and the\nUptycs EDR detection capabilities of Gafgyt.\n\n## Gafgyt\n\n[Gafgyt (also known as Bashlite) is a prominent malware family for *nix systems, which](https://en.wikipedia.org/wiki/BASHLITE)\nmainly target vulnerable IoT devices like Huawei routers, Realtek routers and ASUS devices.\nGafgyt also uses some of the existing exploits (CVE-2017-17215, CVE-2018-10561) to\ndownload the next stage payloads, which we will discuss further on.\n\nGafgyt malware variants have very similar functionality to Mirai, as a majority of the code\nwas copied.\n\n## Technical Analysis: Gafgyt; Re-used Mirai modules\n\n\n-----\n\nDuring our analysis of Gafgyt, we identified several recent variants that have re-used some\ncode modules from the Mirai source code. The modules are:\n\n1. HTTP flooding\n2. UDP flooding\n3. TCP flooding\n4. STD module\n5. Telnet Bruteforce\n\nWe will provide details of these modules and their functionality, but for the purpose of this\nblog we are using the hashes\n(da20bf020c083eb080bf75879c84f8885b11b6d3d67aa35e345ce1a3ee762444 and\n**1b3bb39a3d1eea8923ceb86528c8c38ecf9398da1bdf8b154e6b4d0d8798be49) and the**\nMirai leaked source code.\n\n### HTTP flooding module\n\nHTTP flooding is a kind of DDoS attack in which the attacker sends a large number of HTTP\nrequests to the targeted server to overwhelm it. The creators of Gafgyt have re-used this\ncode from the leaked Mirai source code.\n\nThe below figure (Figure 1) shows the comparison of the Gafgyt and Mirai HTTP flooding\nmodule.\n\n_[Figure 1: HTTP flooder module. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Fig%201_%20HTTP%20flooder%20module_.png)_\n\nIn the above image, the left is the Gafgyt decompiled code, which matches the Mirai source\ncode on the right.\n\n### UDP flood module\n\nUDP flooding is a type of DDoS attack in which an attacker sends several UDP packets to\nthe victim server as a means of exhausting it. Gafgyt contained this same functionality of\nUDP flooding, copied from the leaked Mirai source code (see Figure 2).\n\n\n-----\n\n_[Figure 2: UDP flooder module. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Fig%202_%20UDP%20flooder%20module_.png)_\n\n### TCP flood module\n\nGafgyt performs all types of TCP flood attacks like SYN, PSH, FIN, etc. In this type of attack,\nthe attacker exploits a normal three-way TCP handshake the victim server receives a heavy\nnumber of requests, resulting in the server becoming unresponsive.\n\nThe below image shows the TCP flooder module of Gafgyt, which contained the similar code\nfrom Mirai (see Figure 3).\n\n[Figure 3: TCP flooder module. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%203_%20TCP%20flooder%20module_.png)\n\n### STD module\n\nGafgyt contains an STD module which sends a random string (from a hardcoded array of\nstrings) to a particular IP address. This functionality has also been used by Mirai (see Figure\n4).\n\n\n-----\n\n[Figure 4: STD module. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%204_%C2%A0%20STD%20module_.png)\n\n### Brute force module\n\nNot only flooding modules are being used. Recent Gafgyt also contained other modules with\nlittle tweaks, like a telnet bruteforce scanner (see Figure 5).\n\n[Figure 5: Telnet bruteforce module. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%205_%20Telnet%20bruteforce%20module_.png)\n\n## CVEs used by Gafgyt\n\nGafgyt uses existing vulnerabilities in IoT devices to turn them into bots and later perform\nDDoS attacks on specifically targeted IP addresses. Some of the recent Gafgyt variants\n(e.g., 7fe8e2efba37466b5c8cd28ae6af2504484e1925187edffbcc63a60d2e4e1bd8 and\n**25461130a268f3728a0465722135e78fd00369f4bccdede4dd61e0c374d88eb8) also**\ncontained multiple exploits, like the RCE exploit in Huawei Routers and the authentication\nbypass exploit in GPON Home Routers (see Figure 6, 7, 8).\n\n\n-----\n\n[Figure 6: Huawei Exploit inside binary (CVE-2017-17215). (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%206_%20Huawei%20Exploit%20inside%20binary%20(CVE-2017-17215)_.png)\n\n[Figure 7: Realtek Exploit inside binary (CVE-2014-8361). (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%207_%20Realtek%20Exploit%20inside%20binary%20(CVE-2014-8361)_.png)\n\nIn Figures 6 and 7, you can see the Gafgyt malware binary embeds Remote Code Execution\nexploits for Huawei and Realtek routers, by which the malware binary:\n\n1. using wget command, fetches the payload.\n2. gives the execution permission to payload using chmod command.\n3. executes the payload.\n\nFigure 8: GPON Router Exploit inside binary (CVE-2018-10561). (Click to see larger\nversion )\n\n\n-----\n\n[In the same way, the Gafgyt malware binary uses CVE-2018-10561 for authentication](https://nvd.nist.gov/vuln/detail/CVE-2018-10561)\nbypass in vulnerable GPON routers; the malware binary fetches a malicious script using\n**wget command and then executes the script from /tmp location (bins.sh in Figure 8).**\n\n[Figure 9: Downloaded malicious script. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%209_%20Downloaded%20malicious%20script_.png)\n\nThe malicious script:\n\n1. using wget command, fetches the payload.\n2. gives the execution permission to payload using chmod command.\n3. executes the payload.\n4. removes the payload.\n\nThe IP addresses used for fetching the payloads in Figure 9 (above) were generally the open\ndirectories where malicious payloads for different architectures were hosted by the attacker\n(see Figure 10).\n\n[Figure 10: Malware programs hosted upon open directory. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%2010_%20Malwares%20hosted%20upon%20open%20directory_.png)\n\n## Uptycs EDR detection\n\n\n-----\n\n[Uptycs EDR capabilities, armed with YARA process scanning, detected both Gafgyt variants](https://www.uptycs.com/blog/fast-consolidated-and-context-rich-detections-from-uptycs-will-keep-security-analysts-sane)\nwith a threat score of 10/10 (see Figure 11, 12).\n\n[Figure 11: Uptycs detection for Gafgyt I. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%2011_%20Uptycs%20detection%20for%20Gafgyt%20I_.png)\n\n[Figure 12: Uptycs detection for Gafgyt II. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/Q1%202021-%20Blog%20Post%20Images%20-%20Mirai%20code%20re-use%20in%20Gafgyt/Figure%2012_%20Uptycs%20detection%20for%20Gafgyt%20II_.png)\n\n\n-----\n\nMalware authors may not always innovate, and researchers often discover that malware\nauthors copy and re-use leaked malware source code. In order to identify and protect against\nthese kinds of malware attacks, we recommend the following measures:\n\nRegularly monitor the suspicious processes, events, and network traffic spawned on\nthe execution of any untrusted binary.\nKeep systems and firmware updated with the latest releases and patches.\n\n## IOCs\n\n**Hashes**\n\n_da20bf020c083eb080bf75879c84f8885b11b6d3d67aa35e345ce1a3ee762444_\n\n_1b3bb39a3d1eea8923ceb86528c8c38ecf9398da1bdf8b154e6b4d0d8798be49_\n\n_7fe8e2efba37466b5c8cd28ae6af2504484e1925187edffbcc63a60d2e4e1bd8_\n\n_25461130a268f3728a0465722135e78fd00369f4bccdede4dd61e0c374d88eb8_\n\n_4883de90f71dcdac6936d10b1d2c0b38108863d9bf0f686a41d906fdfc3d81aa_\n\n_25461130a268f3728a0465722135e78fd00369f4bccdede4dd61e0c374d88eb8_\n\n**URLs**\n\n_37[.]228[.]188[.]12_\n\n_178[.]253[.]17[.]49_\n\n_156[.]226[.]57[.]56_\n\n_156[.]244[.]91[.]129_\n\n_212[.]139[.]167[.]234_\n\n_193[.]190[.]104[.]125_\n\n_37[.]251[.]254[.]238_\n\n_212[.]139[.]167[.]234_\n\n\n-----\n\nTag(s):\n\n## Siddharth Sharma\n\nSiddharth Sharma works as a Malware Researcher at Uptycs. He specializes in Malware\nAnalysis and Reverse Engineering on Linux and Windows platforms. He has worked as an\nIntern at CERT-In. His blogs have been published in well known security magazines.\n\nConnect with the author\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-15 - Mirai code re-use in Gafgyt.pdf"
    ],
    "report_names": [
        "2021-04-15 - Mirai code re-use in Gafgyt.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535946,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1653766069,
    "ts_modification_date": 1653766069,
    "files": {
        "pdf": "https://archive.orkl.eu/67aedf7ef9865b89e2fb48d9a0cdbb3f6470c8d5.pdf",
        "text": "https://archive.orkl.eu/67aedf7ef9865b89e2fb48d9a0cdbb3f6470c8d5.txt",
        "img": "https://archive.orkl.eu/67aedf7ef9865b89e2fb48d9a0cdbb3f6470c8d5.jpg"
    }
}