{
    "id": "7f5384e1-828f-4b48-a563-b2fed4673b87",
    "created_at": "2023-01-12T14:59:42.24453Z",
    "updated_at": "2025-03-27T02:08:41.247699Z",
    "deleted_at": null,
    "sha1_hash": "aa89e30ac7689f0f0e6a0b107a92605cddf1f3ae",
    "title": "2019-09-09 - ‘Purple Fox’ Fileless Malware with Rookit Component Delivered by Rig Exploit Kit Now Abuses PowerShell",
    "authors": "",
    "file_creation_date": "2022-05-29T00:53:09Z",
    "file_modification_date": "2022-05-29T00:53:09Z",
    "file_size": 149829,
    "plain_text": "# ‘Purple Fox’ Malware Can Rootkit and Abuse PowerShell\n\n**blog.trendmicro.com/trendlabs-security-intelligence/purple-fox-fileless-malware-with-rookit-component-delivered-by-**\nrig-exploit-kit-now-abuses-powershell/\n\nSeptember 9, 2019\n\n[Exploit kits may no longer be as prolific as it was back when their activities were detected in](https://www.trendmicro.com/vinfo/us/security/definition/exploit-kit)\n[the millions, but their recurring activities in the first half of 2019 indicate that they won’t be](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/threat-reports/roundup/evasive-threats-pervasive-effects)\ngoing away any time soon. The Rig exploit kit, for instance, is known for delivering various\n[payloads — such as downloader trojans,](https://blog.trendmicro.com/trendlabs-security-intelligence/pop-up-ads-and-over-a-hundred-sites-are-helping-distribute-botnets-cryptocurrency-miners-and-ransomware/) [ransomware,](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/-sodinokibi-ransomware-group-adds-malvertising-as-delivery-technique) [cryptocurrency-mining malware, and](https://blog.trendmicro.com/trendlabs-security-intelligence/rig-exploit-kit-now-using-cve-2018-8174-to-deliver-monero-miner/)\n[information stealers — whose arrival and delivery techniques are also constantly fine-tuned.](https://blog.trendmicro.com/trendlabs-security-intelligence/astrum-exploit-kit-abuses-diffie-hellman-key-exchange/)\n\n[The Purple Fox fileless downloader malware, which was reported to have at least affected](https://blog.360totalsecurity.com/en/purple-fox-trojan-burst-out-globally-and-infected-more-than-30000-users/)\n30,000 users last year, is a recent example. Also delivered by the Rig exploit kit, Purple Fox\npreviously used the Nullsoft Scriptable Install System (NSIS) tool to retrieve and execute its\npayload. We’ve also previously seen Purple Fox downloading and executing cryptocurrencymining malware.\n\nThis new iteration of Purple Fox that we came across, also being delivered by Rig, has a few\nnew tricks up its sleeve. It retains its rootkit component by abusing publicly available code. It\n[now also eschews its use of NSIS in favor of abusing PowerShell, making Purple Fox](https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-the-rise-of-fileless-threats-that-abuse-powershell)\ncapable of fileless infection. It also incorporated additional exploits to its infection chain, most\nlikely as a foolproof mechanism to ensure that it can still infect the system. Purple Fox is a\ndownloader malware; besides retrieving and executing cryptocurrency-mining threats, it can\nalso deliver other kinds of malware.\n\n\n-----\n\nFigure 1. Purple Fox s infection chain that abuses PowerShell\n\n## Purple Fox’s Infection Chain\n\nHere’s an overview of the infection chain of this new version of Purple Fox:\n\nOnce the user accesses a malicious site hosting one of Rig’s landing pages, there are\nthree methods used to ultimately redirect the user to a malicious PowerShell script that\nwill, in turn, either directly execute Purple Fox’s main component or escalate privileges\nin order to download and execute a file that would lead to Purple Fox:\n\n[Through a Flash (.swf) file that exploits CVE-2018-15982, which would lead to a](https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/patch-now-adobe-flash-zero-days-spread-via-spam)\nmalicious PowerShell script\n[Two .htm files that exploit CVE-2014-6332, a vulnerability in Internet Explorer’s](https://blog.trendmicro.com/trendlabs-security-intelligence/a-killer-combo-critical-vulnerability-and-godmode-exploitation-on-cve-2014-6332/)\n[VBScript engine; and CVE-2018-8174, a remote code execution (RCE)](https://blog.trendmicro.com/trendlabs-security-intelligence/microsoft-patch-tuesday-for-may-includes-updates-for-actively-exploited-vulnerabilities-2/)\nvulnerability in VBScript engine affecting various Windows versions (note that\nthese vulnerabilities have long been patched). The .htm file containing an exploit\nfor CVE-2018-8174 redirects to an HTML application (.hta) file.\nThe .hta file, which redirects to a malicious PowerShell script\nIf the current user account in the affected system has administrative access, the\nmalicious PowerShell script, posing as an image (.jpg) file, will abuse the application\nprogramming interface (API) of msi.dll — a dynamic-link library (DLL) that contains\nfunctions for installing Microsoft Installer (.msi) packages — in order to execute and\ninstall Purple Fox’s main component, which also poses as a randomly named image\nfile.\n\nIf the current user account does not have administration access, the PowerShell\n[script would instead abuse a PowerSploit module (normally used by penetration](https://attack.mitre.org/software/S0194/)\n[testers) that will, in turn, exploit two vulnerabilities: CVE-2015-1701 and](https://blog.trendmicro.com/trendlabs-security-intelligence/exploring-cve-2015-1701-a-win32k-elevation-of-privilege-vulnerability-used-in-targeted-attacks/) CVE2018-8120. Both of these are privilege escalation flaws in Win32k, a multiuser\ndriver in Windows.\nOnce the script successfully exploits CVE-2015-1701 and CVE-2018-8120, it will\n[gain elevated privileges, used to abuse msiexec.exe (an executable that enables](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec)\nthe installation or modification of .msi files via command line) to download and\nexecute Purple Fox’s main component.\n\nFigure 2. Snapshots of code showing: the .hta file, which leads to the malicious\nPowerShell script (top); how msi.dll is abused (center); and how msiexec.exe is abused to\ndownload and execute Purple Fox's main component (bottom)\n\n## Purple Fox’s Payload Delivery and Rootkit Component\n\n\n-----\n\nThe malware uses msi.dll s [MsiInstallProductA function to download and execute its payload](https://docs.microsoft.com/en-us/windows/win32/api/msi/nf-msi-msiinstallproducta)\n— an .msi file that contains an encrypted shellcode as well as 32-bit and 64-bit versions of\nthe payload. Once executed, the malware restarts the system and uses the\n_PendingFileRenameOperations registry (responsible for storing names of files that the OS_\nwill rename when it restarts) to rename its components.\n\nIt would then use its rootkit capability (hiding its files and registry entries) after the system is\nrestarted. It creates a suspended svchost process and injects a DLL that will then create a\ndriver with the rootkit capability. Before proceeding further to the payload, it sets up the\nfollowing in the injected DLL: a driver file (dump_{random hex}.sys), which is responsible for\nthe rootkit capability; and its main component in the form of a DLL file (Ms{random\n_hex}App.dll)._\n\nUnlike the previous version of Purple Fox, however, this new iteration abuses an opensource code to enable its rootkit components, which includes hiding and protecting its files\nand registry entries. Also of note is the way this new version of Purple Fox abuses a file\nutility software to hide its DLL component, which deters reverse engineering or cracking\nattempts.\n\nFigure 3. Snapshot of code showing how Purple Fox abuses an open-source code to hide\nand protect its components and registry entries\n\n## Best practices and Trend Micro solutions\n\nPurple Fox exemplifies what we’re seeing in this year’s threat landscape: a multilayered\napproach to how it “lives off the land.” Purple Fox’s emphasis on leaving a small footprint is\nalso notable, with its abuse of legitimate tools and use of fileless techniques (e.g., DLL\ninjection). Purple Fox also uses exploits for vulnerabilities with available patches. Its attack\nchain, for instance, exploits a vulnerability that was disclosed and patched five years ago.\nThis highlights the significance of patching, especially for enterprises. And given how Purple\n[Fox can deliver virtually any kind of threat, a defense-in-depth approach to securing online](https://www.trendmicro.com/vinfo/us/security/news/security-technology/risks-under-the-radar-understanding-fileless-threats)\n[infrastructures is important. Here are some best practices that users and organizations can](https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-defending-against-fileless-malware)\nadopt:\n\nEnforce the [principle of least privilege by restricting and securing the use of tools](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/best-practices-securing-sysadmin-tools)\nreserved for system administrators.\n[Regularly patch and update (or employ virtual patching for legacy or embedded](https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-virtual-patching)\nsystems or software).\nDeploy additional mechanisms that provide additional layers of security, such as\n[behavior monitoring, which thwarts malware-related routines from being executed in](https://success.trendmicro.com/solution/1122593-configuring-behavior-monitoring-settings-in-apex-one)\nthe system; [sandboxes, which can quarantine malicious files and further analyze](https://www.trendmicro.com/vinfo/us/security/news/security-technology/how-can-advanced-sandboxing-techniques-thwart-elusive-malware)\n[suspicious behaviors; and firewalls and](https://www.trendmicro.com/vinfo/us/security/news/security-technology/best-practices-deploying-an-effective-firewall) [intrusion prevention and detection systems that](https://www.trendmicro.com/en_us/business/capabilities/intrusion-prevention.html)\ncan deter incursions or flag data exfiltration attempts.\n\n\n-----\n\nCultivate cybersecurity awareness at home and in the workplace, especially against\n[email-borne threats that fileless threats could use as attack vectors or entry points.](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/infosec-guide-email-threats)\n\n[Trend Micro endpoint solutions such as the Smart Protection Suites and](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html) Worry-Free\nBusiness Security solutions, which have behavior monitoring capabilities, can protect users\nand businesses from these types of threats by detecting malicious files, scripts, and\n[messages as well as blocking all related malicious URLs. Trend Micro Apex One™](https://blog.trendmicro.com/en_us/business/products/user-protection/sps/endpoint.html)\nprotection employs a variety of threat detection capabilities, notably behavioral analysis,\nwhich protect against malicious scripts, injection, ransomware, memory and browser attacks\nrelated to fileless threats.\n\nThe [Trend Micro™ Deep Discovery Inspector solution protects customers from Rig exploit kit](https://blog.trendmicro.com/en_us/business/products/network/advanced-threat-protection/inspector.html)\nand Purple Fox via these DDI rules:\n\n3286: RIG - Exploit Kit - HTTP (Request)\n4220: RIG - Exploit Kit - HTTP (Request)\n\nThe indicators of compromise (IoCs) are in this appendix.\n\nCyber Threats\n\nThis new iteration of Purple Fox that we came across, delivered by Rig, has a few new tricks\nup its sleeve. It retains its rootkit component by abusing publicly available code. It also\nabuses PowerShell making it capable of fileless infection.\n\nBy: Johnlery Triunfante, Earle Maui Earnshaw, Michael Jhon Ofiaza September 09, 2019\nRead time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-09-09 - ‘Purple Fox’ Fileless Malware with Rookit Component Delivered by Rig Exploit Kit Now Abuses PowerShell.pdf"
    ],
    "report_names": [
        "2019-09-09 - ‘Purple Fox’ Fileless Malware with Rookit Component Delivered by Rig Exploit Kit Now Abuses PowerShell.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535582,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653785589,
    "ts_modification_date": 1653785589,
    "files": {
        "pdf": "https://archive.orkl.eu/aa89e30ac7689f0f0e6a0b107a92605cddf1f3ae.pdf",
        "text": "https://archive.orkl.eu/aa89e30ac7689f0f0e6a0b107a92605cddf1f3ae.txt",
        "img": "https://archive.orkl.eu/aa89e30ac7689f0f0e6a0b107a92605cddf1f3ae.jpg"
    }
}